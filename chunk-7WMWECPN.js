import{a as RE}from"./chunk-FOT4I5NM.js";import{a as LE,b as so,c as Yu}from"./chunk-DMY3GQFR.js";import{a as eM}from"./chunk-ZG5KVXQC.js";import{i as FE}from"./chunk-UDNVTHBX.js";import{c as DE}from"./chunk-YT77FPBW.js";import{a as la}from"./chunk-L2HEPCHX.js";import"./chunk-ASG7CGOZ.js";import{b as TE,c as PE,d as OE,e as Wu,f as Fg,g as ME}from"./chunk-NZQVPUIM.js";import{d as Lg,e as AE,f as IE}from"./chunk-RLQXEM26.js";import"./chunk-6ARMVIWK.js";import{k as Ks}from"./chunk-C5TAFYHE.js";import{$ as to,$b as vE,A as Qt,Aa as tE,Ab as pl,B as Qn,Ba as Fu,C as Hw,Ca as sa,Cb as lh,D as lt,Da as ku,E as Pu,Ea as bg,F as Gs,Fa as iE,G as wr,Ga as nE,H as zt,Ha as vg,I as Ii,Ia as sE,Ib as cE,J as Ti,Ja as rE,Jb as hE,K as Er,Ka as oE,L as kt,La as aE,M as $e,Mb as dE,N as ki,Nb as Og,O as cl,Oa as yg,Ob as Mg,P as Ni,Pa as _g,Pb as uE,Q as eo,Qb as pE,R as Ws,Rb as Rg,S as Gw,T as hl,Tb as fE,U as ta,Ub as mE,V as ia,Vb as fl,W as Ys,Wb as gE,X as Ww,Xb as bE,Y as gg,Yb as oa,Z as qs,Zb as Is,_ as sh,_b as mn,a as Rw,aa as Xs,ab as As,ac as Dg,b as fg,ba as Yw,bb as Nu,bc as yE,c as Dw,ca as Jn,cb as Uu,cc as ju,d as ea,da as Mn,dc as Hi,e as Lw,ea as _i,eb as oh,ec as _E,f as Fw,fa as Ou,fc as Hu,g as mg,ga as qw,gb as ah,gc as wE,h as xs,ha as Xw,hb as Bu,hc as aa,i as ll,ia as Ji,ib as lE,ic as Nn,j as kw,ja as Kw,jc as Gi,k as Nw,ka as $w,kc as ml,l as nh,la as rh,lb as wg,lc as EE,m as Tu,ma as Mu,mb as Eg,n as Uw,na as dl,o as Bw,oa as Ru,ob as Cg,oc as ch,p as zw,pa as io,pb as zu,pc as CE,q as Vw,qa as ul,qb as Vu,qc as xE,r as _r,ra as Zw,rc as SE,s as Bt,sa as Qw,sc as hh,t as Jr,ta as Du,tb as xg,u as js,ua as Lu,ub as Sg,v as Hs,va as na,vb as Ag,w as Ss,wa as no,wb as Ig,x as jw,xa as Jw,xb as Tg,xc as Gu,y as On,ya as en,yb as Pg,z as ce,za as eE,zb as ra}from"./chunk-4NDDJHS7.js";import"./chunk-OIPN42EH.js";import{F as Tw,G as Pw,L as Ow,f as th,ia as Mw,j as pg,l as ih,p as Iw,t as Pn}from"./chunk-L6BWHE7V.js";import{A as dw,Ab as ww,B as lg,Ba as Fi,Bb as Su,Bc as al,C as uw,Ca as eh,Cb as Zr,Da as Vt,Db as Qr,Eb as He,Fb as We,G as pw,Gb as _t,Hb as $n,I as fw,Ib as Zn,Jc as bt,Kb as mt,Mb as rt,Mc as at,Nb as Ze,Ob as Ew,Pb as Cw,Qb as xw,Sb as fi,T as mw,Tb as mi,U as gw,Ub as gi,V as ai,Vb as kn,Wb as fn,X as Cu,Xb as Jo,Yb as Au,Za as Ge,_ as yr,_a as Qi,a as sl,ac as dg,ba as Jc,bc as st,c as rl,da as Qo,ea as qe,f as pi,g as lw,gb as ol,i as cw,ia as nt,ib as yw,jb as _w,k as rg,ka as cg,l as og,lb as Ft,m as ag,mc as Sw,na as bw,ob as hg,oc as Iu,qa as Tn,r as hw,ra as pt,rc as ug,sa as ft,sb as dt,tc as zi,ub as Le,vb as $r,vc as Gt,wb as xu,wc as Aw,xa as vw,y as Ai}from"./chunk-NZYFJ7MV.js";import{a as Se,b as yt,c as sg,d as nl,f as vr,h as Cs,j as ie}from"./chunk-RZZ4GCVR.js";var SA=vr((Lv,Fv)=>{"use strict";(function(s,e){typeof Lv=="object"&&typeof Fv<"u"?Fv.exports=e():typeof define=="function"&&define.amd?define(e):s.Stats=e()})(Lv,function(){var s=function(){function e(h){return n.appendChild(h.dom),h}function t(h){for(var u=0;u<n.children.length;u++)n.children[u].style.display=u===h?"block":"none";i=h}var i=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",function(h){h.preventDefault(),t(++i%n.children.length)},!1);var r=(performance||Date).now(),o=r,a=0,l=e(new s.Panel("FPS","#0ff","#002")),c=e(new s.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var d=e(new s.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:n,addPanel:e,showPanel:t,begin:function(){r=(performance||Date).now()},end:function(){a++;var h=(performance||Date).now();if(c.update(h-r,200),h>o+1e3&&(l.update(1e3*a/(h-o),100),o=h,a=0,d)){var u=performance.memory;d.update(u.usedJSHeapSize/1048576,u.jsHeapSizeLimit/1048576)}return h},update:function(){r=this.end()},domElement:n,setMode:t}};return s.Panel=function(e,t,i){var n=1/0,r=0,o=Math.round,a=o(window.devicePixelRatio||1),l=80*a,c=48*a,d=3*a,h=2*a,u=3*a,p=15*a,f=74*a,m=30*a,g=document.createElement("canvas");g.width=l,g.height=c,g.style.cssText="width:80px;height:48px";var b=g.getContext("2d");return b.font="bold "+9*a+"px Helvetica,Arial,sans-serif",b.textBaseline="top",b.fillStyle=i,b.fillRect(0,0,l,c),b.fillStyle=t,b.fillText(e,d,h),b.fillRect(u,p,f,m),b.fillStyle=i,b.globalAlpha=.9,b.fillRect(u,p,f,m),{dom:g,update:function(v,E){n=Math.min(n,v),r=Math.max(r,v),b.fillStyle=i,b.globalAlpha=1,b.fillRect(0,0,l,p),b.fillStyle=t,b.fillText(o(v)+" "+e+" ("+o(n)+"-"+o(r)+")",d,h),b.drawImage(g,u+a,p,f-a,m,u,p,f-a,m),b.fillRect(u+f-a,p,a,m),b.fillStyle=i,b.globalAlpha=.9,b.fillRect(u+f-a,p,a,o((1-v/E)*m))}}},s})});var r_=vr(()=>{"use strict"});var kO=vr(()=>{"use strict"});var NO=vr(()=>{"use strict"});var UO=vr(()=>{"use strict"});var BO=vr(()=>{"use strict"});var zO=vr(()=>{"use strict"});var o_=vr((exports,module)=>{"use strict";(function(e,t){typeof exports=="object"&&typeof module=="object"?module.exports=t():typeof define=="function"&&define.amd?define("pdfjs-dist/build/pdf",[],t):typeof exports=="object"?exports["pdfjs-dist/build/pdf"]=t():e["pdfjs-dist/build/pdf"]=e.pdfjsLib=t()})(globalThis,()=>(()=>{"use strict";var __webpack_modules__=[,(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.VerbosityLevel=e.Util=e.UnknownErrorException=e.UnexpectedResponseException=e.UNSUPPORTED_FEATURES=e.TextRenderingMode=e.StreamType=e.RenderingIntentFlag=e.PermissionFlag=e.PasswordResponses=e.PasswordException=e.PageActionEventType=e.OPS=e.MissingPDFException=e.LINE_FACTOR=e.LINE_DESCENT_FACTOR=e.InvalidPDFException=e.ImageKind=e.IDENTITY_MATRIX=e.FormatError=e.FontType=e.FeatureTest=e.FONT_IDENTITY_MATRIX=e.DocumentActionEventType=e.CMapCompressionType=e.BaseException=e.AnnotationType=e.AnnotationStateModelType=e.AnnotationReviewState=e.AnnotationReplyType=e.AnnotationMode=e.AnnotationMarkedState=e.AnnotationFlag=e.AnnotationFieldFlag=e.AnnotationEditorType=e.AnnotationEditorPrefix=e.AnnotationEditorParamsType=e.AnnotationBorderStyleType=e.AnnotationActionEventType=e.AbortException=void 0,e.arrayByteLength=K,e.arraysToBytes=ee,e.assert=$,e.bytesToString=se,e.createPromiseCapability=dn,e.createValidAbsoluteUrl=U,e.escapeString=ni,e.getModificationDate=yi,e.getVerbosityLevel=k,e.info=B,e.isArrayBuffer=ti,e.isArrayEqual=ot,e.isAscii=Kt,e.objectFromMap=ge,e.objectSize=xe,e.setVerbosityLevel=X,e.shadow=W,e.string32=le,e.stringToBytes=re,e.stringToPDFString=ht,e.stringToUTF16BEString=It,e.stringToUTF8String=ci,e.unreachable=j,e.utf8StringToString=Ct,e.warn=R,t(2);let i=[1,0,0,1,0,0];e.IDENTITY_MATRIX=i;let n=[.001,0,0,.001,0,0];e.FONT_IDENTITY_MATRIX=n;let r=1.35;e.LINE_FACTOR=r;let o=.35;e.LINE_DESCENT_FACTOR=o;let a={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};e.RenderingIntentFlag=a;let l={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};e.AnnotationMode=l;let c="pdfjs_internal_editor_";e.AnnotationEditorPrefix=c;let d={DISABLE:-1,NONE:0,FREETEXT:3,INK:15};e.AnnotationEditorType=d;let h={FREETEXT_SIZE:1,FREETEXT_COLOR:2,FREETEXT_OPACITY:3,INK_COLOR:11,INK_THICKNESS:12,INK_OPACITY:13};e.AnnotationEditorParamsType=h;let u={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};e.PermissionFlag=u;let p={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};e.TextRenderingMode=p;let f={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};e.ImageKind=f;let m={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};e.AnnotationType=m;let g={MARKED:"Marked",REVIEW:"Review"};e.AnnotationStateModelType=g;let b={MARKED:"Marked",UNMARKED:"Unmarked"};e.AnnotationMarkedState=b;let v={ACCEPTED:"Accepted",REJECTED:"Rejected",CANCELLED:"Cancelled",COMPLETED:"Completed",NONE:"None"};e.AnnotationReviewState=v;let E={GROUP:"Group",REPLY:"R"};e.AnnotationReplyType=E;let y={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};e.AnnotationFlag=y;let w={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};e.AnnotationFieldFlag=w;let C={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};e.AnnotationBorderStyleType=C;let A={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};e.AnnotationActionEventType=A;let D={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};e.DocumentActionEventType=D;let M={O:"PageOpen",C:"PageClose"};e.PageActionEventType=M;let I={UNKNOWN:"UNKNOWN",FLATE:"FLATE",LZW:"LZW",DCT:"DCT",JPX:"JPX",JBIG:"JBIG",A85:"A85",AHX:"AHX",CCF:"CCF",RLX:"RLX"};e.StreamType=I;let O={UNKNOWN:"UNKNOWN",TYPE1:"TYPE1",TYPE1STANDARD:"TYPE1STANDARD",TYPE1C:"TYPE1C",CIDFONTTYPE0:"CIDFONTTYPE0",CIDFONTTYPE0C:"CIDFONTTYPE0C",TRUETYPE:"TRUETYPE",CIDFONTTYPE2:"CIDFONTTYPE2",TYPE3:"TYPE3",OPENTYPE:"OPENTYPE",TYPE0:"TYPE0",MMTYPE1:"MMTYPE1"};e.FontType=O;let F={ERRORS:0,WARNINGS:1,INFOS:5};e.VerbosityLevel=F;let V={NONE:0,BINARY:1,STREAM:2};e.CMapCompressionType=V;let x={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotations:78,endAnnotations:79,beginAnnotation:80,endAnnotation:81,paintJpegXObject:82,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};e.OPS=x;let N={unknown:"unknown",forms:"forms",javaScript:"javaScript",signatures:"signatures",smask:"smask",shadingPattern:"shadingPattern",font:"font",errorTilingPattern:"errorTilingPattern",errorExtGState:"errorExtGState",errorXObject:"errorXObject",errorFontLoadType3:"errorFontLoadType3",errorFontState:"errorFontState",errorFontMissing:"errorFontMissing",errorFontTranslate:"errorFontTranslate",errorColorSpace:"errorColorSpace",errorOperatorList:"errorOperatorList",errorFontToUnicode:"errorFontToUnicode",errorFontLoadNative:"errorFontLoadNative",errorFontBuildPath:"errorFontBuildPath",errorFontGetPath:"errorFontGetPath",errorMarkedContent:"errorMarkedContent",errorContentSubStream:"errorContentSubStream"};e.UNSUPPORTED_FEATURES=N;let z={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};e.PasswordResponses=z;let G=F.WARNINGS;function X(Fe){Number.isInteger(Fe)&&(G=Fe)}function k(){return G}function B(Fe){G>=F.INFOS&&console.log(`Info: ${Fe}`)}function R(Fe){G>=F.WARNINGS&&console.log(`Warning: ${Fe}`)}function j(Fe){throw new Error(Fe)}function $(Fe,he){Fe||j(he)}function T(Fe){if(!Fe)return!1;switch(Fe.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function U(Fe,he=null,we=null){if(!Fe)return null;try{if(we&&typeof Fe=="string"){if(we.addDefaultProtocol&&Fe.startsWith("www.")){let ut=Fe.match(/\./g);ut&&ut.length>=2&&(Fe=`http://${Fe}`)}if(we.tryConvertEncoding)try{Fe=ci(Fe)}catch{}}let it=he?new URL(Fe,he):new URL(Fe);if(T(it))return it}catch{}return null}function W(Fe,he,we){return Object.defineProperty(Fe,he,{value:we,enumerable:!0,configurable:!0,writable:!1}),we}let Q=function(){function he(we,it){this.constructor===he&&j("Cannot initialize BaseException."),this.message=we,this.name=it}return he.prototype=new Error,he.constructor=he,he}();e.BaseException=Q;class te extends Q{constructor(he,we){super(he,"PasswordException"),this.code=we}}e.PasswordException=te;class J extends Q{constructor(he,we){super(he,"UnknownErrorException"),this.details=we}}e.UnknownErrorException=J;class oe extends Q{constructor(he){super(he,"InvalidPDFException")}}e.InvalidPDFException=oe;class pe extends Q{constructor(he){super(he,"MissingPDFException")}}e.MissingPDFException=pe;class de extends Q{constructor(he,we){super(he,"UnexpectedResponseException"),this.status=we}}e.UnexpectedResponseException=de;class fe extends Q{constructor(he){super(he,"FormatError")}}e.FormatError=fe;class P extends Q{constructor(he){super(he,"AbortException")}}e.AbortException=P;function se(Fe){(typeof Fe!="object"||Fe===null||Fe.length===void 0)&&j("Invalid argument for bytesToString");let he=Fe.length,we=8192;if(he<we)return String.fromCharCode.apply(null,Fe);let it=[];for(let ut=0;ut<he;ut+=we){let Ut=Math.min(ut+we,he),jt=Fe.subarray(ut,Ut);it.push(String.fromCharCode.apply(null,jt))}return it.join("")}function re(Fe){typeof Fe!="string"&&j("Invalid argument for stringToBytes");let he=Fe.length,we=new Uint8Array(he);for(let it=0;it<he;++it)we[it]=Fe.charCodeAt(it)&255;return we}function K(Fe){if(Fe.length!==void 0)return Fe.length;if(Fe.byteLength!==void 0)return Fe.byteLength;j("Invalid argument for arrayByteLength")}function ee(Fe){let he=Fe.length;if(he===1&&Fe[0]instanceof Uint8Array)return Fe[0];let we=0;for(let Ut=0;Ut<he;Ut++)we+=K(Fe[Ut]);let it=0,ut=new Uint8Array(we);for(let Ut=0;Ut<he;Ut++){let jt=Fe[Ut];jt instanceof Uint8Array||(typeof jt=="string"?jt=re(jt):jt=new Uint8Array(jt));let Yn=jt.byteLength;ut.set(jt,it),it+=Yn}return ut}function le(Fe){return String.fromCharCode(Fe>>24&255,Fe>>16&255,Fe>>8&255,Fe&255)}function xe(Fe){return Object.keys(Fe).length}function ge(Fe){let he=Object.create(null);for(let[we,it]of Fe)he[we]=it;return he}function _e(){let Fe=new Uint8Array(4);return Fe[0]=1,new Uint32Array(Fe.buffer,0,1)[0]===1}function Ue(){try{return new Function(""),!0}catch{return!1}}class ke{static get isLittleEndian(){return W(this,"isLittleEndian",_e())}static get isEvalSupported(){return W(this,"isEvalSupported",Ue())}static get isOffscreenCanvasSupported(){return W(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}}e.FeatureTest=ke;let je=[...Array(256).keys()].map(Fe=>Fe.toString(16).padStart(2,"0"));class Qe{static makeHexColor(he,we,it){return`#${je[he]}${je[we]}${je[it]}`}static scaleMinMax(he,we){let it;he[0]?(he[0]<0&&(it=we[0],we[0]=we[1],we[1]=it),we[0]*=he[0],we[1]*=he[0],he[3]<0&&(it=we[2],we[2]=we[3],we[3]=it),we[2]*=he[3],we[3]*=he[3]):(it=we[0],we[0]=we[2],we[2]=it,it=we[1],we[1]=we[3],we[3]=it,he[1]<0&&(it=we[2],we[2]=we[3],we[3]=it),we[2]*=he[1],we[3]*=he[1],he[2]<0&&(it=we[0],we[0]=we[1],we[1]=it),we[0]*=he[2],we[1]*=he[2]),we[0]+=he[4],we[1]+=he[4],we[2]+=he[5],we[3]+=he[5]}static transform(he,we){return[he[0]*we[0]+he[2]*we[1],he[1]*we[0]+he[3]*we[1],he[0]*we[2]+he[2]*we[3],he[1]*we[2]+he[3]*we[3],he[0]*we[4]+he[2]*we[5]+he[4],he[1]*we[4]+he[3]*we[5]+he[5]]}static applyTransform(he,we){let it=he[0]*we[0]+he[1]*we[2]+we[4],ut=he[0]*we[1]+he[1]*we[3]+we[5];return[it,ut]}static applyInverseTransform(he,we){let it=we[0]*we[3]-we[1]*we[2],ut=(he[0]*we[3]-he[1]*we[2]+we[2]*we[5]-we[4]*we[3])/it,Ut=(-he[0]*we[1]+he[1]*we[0]+we[4]*we[1]-we[5]*we[0])/it;return[ut,Ut]}static getAxialAlignedBoundingBox(he,we){let it=Qe.applyTransform(he,we),ut=Qe.applyTransform(he.slice(2,4),we),Ut=Qe.applyTransform([he[0],he[3]],we),jt=Qe.applyTransform([he[2],he[1]],we);return[Math.min(it[0],ut[0],Ut[0],jt[0]),Math.min(it[1],ut[1],Ut[1],jt[1]),Math.max(it[0],ut[0],Ut[0],jt[0]),Math.max(it[1],ut[1],Ut[1],jt[1])]}static inverseTransform(he){let we=he[0]*he[3]-he[1]*he[2];return[he[3]/we,-he[1]/we,-he[2]/we,he[0]/we,(he[2]*he[5]-he[4]*he[3])/we,(he[4]*he[1]-he[5]*he[0])/we]}static apply3dTransform(he,we){return[he[0]*we[0]+he[1]*we[1]+he[2]*we[2],he[3]*we[0]+he[4]*we[1]+he[5]*we[2],he[6]*we[0]+he[7]*we[1]+he[8]*we[2]]}static singularValueDecompose2dScale(he){let we=[he[0],he[2],he[1],he[3]],it=he[0]*we[0]+he[1]*we[2],ut=he[0]*we[1]+he[1]*we[3],Ut=he[2]*we[0]+he[3]*we[2],jt=he[2]*we[1]+he[3]*we[3],Yn=(it+jt)/2,Hr=Math.sqrt((it+jt)**2-4*(it*jt-Ut*ut))/2,In=Yn+Hr||1,Pi=Yn-Hr||1;return[Math.sqrt(In),Math.sqrt(Pi)]}static normalizeRect(he){let we=he.slice(0);return he[0]>he[2]&&(we[0]=he[2],we[2]=he[0]),he[1]>he[3]&&(we[1]=he[3],we[3]=he[1]),we}static intersect(he,we){let it=Math.max(Math.min(he[0],he[2]),Math.min(we[0],we[2])),ut=Math.min(Math.max(he[0],he[2]),Math.max(we[0],we[2]));if(it>ut)return null;let Ut=Math.max(Math.min(he[1],he[3]),Math.min(we[1],we[3])),jt=Math.min(Math.max(he[1],he[3]),Math.max(we[1],we[3]));return Ut>jt?null:[it,Ut,ut,jt]}static bezierBoundingBox(he,we,it,ut,Ut,jt,Yn,Hr){let In=[],Pi=[[],[]],Bs,Ln,ii,Nt,Qa,fr,Gr,Wr;for(let Xn=0;Xn<2;++Xn){if(Xn===0?(Ln=6*he-12*it+6*Ut,Bs=-3*he+9*it-9*Ut+3*Yn,ii=3*it-3*he):(Ln=6*we-12*ut+6*jt,Bs=-3*we+9*ut-9*jt+3*Hr,ii=3*ut-3*we),Math.abs(Bs)<1e-12){if(Math.abs(Ln)<1e-12)continue;Nt=-ii/Ln,0<Nt&&Nt<1&&In.push(Nt);continue}Gr=Ln*Ln-4*ii*Bs,Wr=Math.sqrt(Gr),!(Gr<0)&&(Qa=(-Ln+Wr)/(2*Bs),0<Qa&&Qa<1&&In.push(Qa),fr=(-Ln-Wr)/(2*Bs),0<fr&&fr<1&&In.push(fr))}let Wo=In.length,Si,qn=Wo;for(;Wo--;)Nt=In[Wo],Si=1-Nt,Pi[0][Wo]=Si*Si*Si*he+3*Si*Si*Nt*it+3*Si*Nt*Nt*Ut+Nt*Nt*Nt*Yn,Pi[1][Wo]=Si*Si*Si*we+3*Si*Si*Nt*ut+3*Si*Nt*Nt*jt+Nt*Nt*Nt*Hr;return Pi[0][qn]=he,Pi[1][qn]=we,Pi[0][qn+1]=Yn,Pi[1][qn+1]=Hr,Pi[0].length=Pi[1].length=qn+2,[Math.min(...Pi[0]),Math.min(...Pi[1]),Math.max(...Pi[0]),Math.max(...Pi[1])]}}e.Util=Qe;let Et=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function ht(Fe){if(Fe[0]>="\xEF"){let we;if(Fe[0]==="\xFE"&&Fe[1]==="\xFF"?we="utf-16be":Fe[0]==="\xFF"&&Fe[1]==="\xFE"?we="utf-16le":Fe[0]==="\xEF"&&Fe[1]==="\xBB"&&Fe[2]==="\xBF"&&(we="utf-8"),we)try{let it=new TextDecoder(we,{fatal:!0}),ut=re(Fe);return it.decode(ut)}catch(it){R(`stringToPDFString: "${it}".`)}}let he=[];for(let we=0,it=Fe.length;we<it;we++){let ut=Et[Fe.charCodeAt(we)];he.push(ut?String.fromCharCode(ut):Fe.charAt(we))}return he.join("")}function ni(Fe){return Fe.replace(/([()\\\n\r])/g,he=>he===`
`?"\\n":he==="\r"?"\\r":`\\${he}`)}function Kt(Fe){return/^[\x00-\x7F]*$/.test(Fe)}function It(Fe){let he=["\xFE\xFF"];for(let we=0,it=Fe.length;we<it;we++){let ut=Fe.charCodeAt(we);he.push(String.fromCharCode(ut>>8&255),String.fromCharCode(ut&255))}return he.join("")}function ci(Fe){return decodeURIComponent(escape(Fe))}function Ct(Fe){return unescape(encodeURIComponent(Fe))}function ti(Fe){return typeof Fe=="object"&&Fe!==null&&Fe.byteLength!==void 0}function ot(Fe,he){if(Fe.length!==he.length)return!1;for(let we=0,it=Fe.length;we<it;we++)if(Fe[we]!==he[we])return!1;return!0}function yi(Fe=new Date){return[Fe.getUTCFullYear().toString(),(Fe.getUTCMonth()+1).toString().padStart(2,"0"),Fe.getUTCDate().toString().padStart(2,"0"),Fe.getUTCHours().toString().padStart(2,"0"),Fe.getUTCMinutes().toString().padStart(2,"0"),Fe.getUTCSeconds().toString().padStart(2,"0")].join("")}function dn(){let Fe=Object.create(null),he=!1;return Object.defineProperty(Fe,"settled",{get(){return he}}),Fe.promise=new Promise(function(we,it){Fe.resolve=function(ut){he=!0,we(ut)},Fe.reject=function(ut){he=!0,it(ut)}}),Fe}},(s,e,t)=>{var i=t(3)},(s,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.isNodeJS=void 0;let t=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");e.isNodeJS=t},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.build=exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,exports.getDocument=getDocument,exports.setPDFNetworkStreamFactory=setPDFNetworkStreamFactory,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(5),_display_utils=__w_pdfjs_require__(8),_font_loader=__w_pdfjs_require__(11),_canvas=__w_pdfjs_require__(12),_worker_options=__w_pdfjs_require__(15),_is_node=__w_pdfjs_require__(3),_message_handler=__w_pdfjs_require__(16),_metadata=__w_pdfjs_require__(17),_optional_content_config=__w_pdfjs_require__(18),_transport_stream=__w_pdfjs_require__(19),_xfa_text=__w_pdfjs_require__(20);let DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DefaultCanvasFactory=_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;let DefaultCMapReaderFactory=_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;let DefaultStandardFontDataFactory=_display_utils.DOMStandardFontDataFactory;if(exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory,_is_node.isNodeJS){let{NodeCanvasFactory:s,NodeCMapReaderFactory:e,NodeStandardFontDataFactory:t}=__w_pdfjs_require__(21);exports.DefaultCanvasFactory=DefaultCanvasFactory=s,exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory=e,exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory=t}let createPDFNetworkStream;function setPDFNetworkStreamFactory(s){createPDFNetworkStream=s}function getDocument(s){let e=new PDFDocumentLoadingTask,t;if(typeof s=="string"||s instanceof URL)t={url:s};else if((0,_util.isArrayBuffer)(s))t={data:s};else if(s instanceof PDFDataRangeTransport)t={range:s};else{if(typeof s!="object")throw new Error("Invalid parameter in getDocument, need either string, URL, TypedArray, or parameter object.");if(!s.url&&!s.data&&!s.range)throw new Error("Invalid parameter object: need either .data, .range or .url");t=s}let i=Object.create(null),n=null,r=null;for(let a in t){let l=t[a];switch(a){case"url":if(typeof window<"u")try{i[a]=new URL(l,window.location).href;continue}catch(c){(0,_util.warn)(`Cannot create valid URL: "${c}".`)}else if(typeof l=="string"||l instanceof URL){i[a]=l.toString();continue}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.");case"range":n=l;continue;case"worker":r=l;continue;case"data":if(_is_node.isNodeJS&&typeof Buffer<"u"&&l instanceof Buffer)i[a]=new Uint8Array(l);else{if(l instanceof Uint8Array)break;if(typeof l=="string")i[a]=(0,_util.stringToBytes)(l);else if(typeof l=="object"&&l!==null&&!isNaN(l.length))i[a]=new Uint8Array(l);else if((0,_util.isArrayBuffer)(l))i[a]=new Uint8Array(l);else throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}continue}i[a]=l}if(i.CMapReaderFactory=i.CMapReaderFactory||DefaultCMapReaderFactory,i.StandardFontDataFactory=i.StandardFontDataFactory||DefaultStandardFontDataFactory,i.ignoreErrors=i.stopAtErrors!==!0,i.fontExtraProperties=i.fontExtraProperties===!0,i.pdfBug=i.pdfBug===!0,i.enableXfa=i.enableXfa===!0,(!Number.isInteger(i.rangeChunkSize)||i.rangeChunkSize<1)&&(i.rangeChunkSize=DEFAULT_RANGE_CHUNK_SIZE),(typeof i.docBaseUrl!="string"||(0,_display_utils.isDataScheme)(i.docBaseUrl))&&(i.docBaseUrl=null),(!Number.isInteger(i.maxImageSize)||i.maxImageSize<-1)&&(i.maxImageSize=-1),typeof i.cMapUrl!="string"&&(i.cMapUrl=null),typeof i.standardFontDataUrl!="string"&&(i.standardFontDataUrl=null),typeof i.useWorkerFetch!="boolean"&&(i.useWorkerFetch=i.CMapReaderFactory===_display_utils.DOMCMapReaderFactory&&i.StandardFontDataFactory===_display_utils.DOMStandardFontDataFactory),typeof i.isEvalSupported!="boolean"&&(i.isEvalSupported=!0),typeof i.disableFontFace!="boolean"&&(i.disableFontFace=_is_node.isNodeJS),typeof i.useSystemFonts!="boolean"&&(i.useSystemFonts=!_is_node.isNodeJS&&!i.disableFontFace),(typeof i.ownerDocument!="object"||i.ownerDocument===null)&&(i.ownerDocument=globalThis.document),typeof i.disableRange!="boolean"&&(i.disableRange=!1),typeof i.disableStream!="boolean"&&(i.disableStream=!1),typeof i.disableAutoFetch!="boolean"&&(i.disableAutoFetch=!1),(0,_util.setVerbosityLevel)(i.verbosity),!r){let a={verbosity:i.verbosity,port:_worker_options.GlobalWorkerOptions.workerPort};r=a.port?PDFWorker.fromPort(a):new PDFWorker(a),e._worker=r}let o=e.docId;return r.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");let a=_fetchDocument(r,i,n,o),l=new Promise(function(c){let d;n?d=new _transport_stream.PDFDataTransportStream({length:i.length,initialData:i.initialData,progressiveDone:i.progressiveDone,contentDispositionFilename:i.contentDispositionFilename,disableRange:i.disableRange,disableStream:i.disableStream},n):i.data||(d=createPDFNetworkStream({url:i.url,length:i.length,httpHeaders:i.httpHeaders,withCredentials:i.withCredentials,rangeChunkSize:i.rangeChunkSize,disableRange:i.disableRange,disableStream:i.disableStream})),c(d)});return Promise.all([a,l]).then(function([c,d]){if(e.destroyed)throw new Error("Loading aborted");let h=new _message_handler.MessageHandler(o,c,r.port),u=new WorkerTransport(h,e,d,i);e._transport=u,h.send("Ready",null)})}).catch(e._capability.reject),e}function _fetchDocument(s,e,t,i){return ie(this,null,function*(){if(s.destroyed)throw new Error("Worker was destroyed");t&&(e.length=t.length,e.initialData=t.initialData,e.progressiveDone=t.progressiveDone,e.contentDispositionFilename=t.contentDispositionFilename);let n=yield s.messageHandler.sendWithPromise("GetDocRequest",{docId:i,apiVersion:"2.16.105",source:{data:e.data,url:e.url,password:e.password,disableAutoFetch:e.disableAutoFetch,rangeChunkSize:e.rangeChunkSize,length:e.length},maxImageSize:e.maxImageSize,disableFontFace:e.disableFontFace,docBaseUrl:e.docBaseUrl,ignoreErrors:e.ignoreErrors,isEvalSupported:e.isEvalSupported,fontExtraProperties:e.fontExtraProperties,enableXfa:e.enableXfa,useSystemFonts:e.useSystemFonts,cMapUrl:e.useWorkerFetch?e.cMapUrl:null,standardFontDataUrl:e.useWorkerFetch?e.standardFontDataUrl:null});if(e.data&&(e.data=null),s.destroyed)throw new Error("Worker was destroyed");return n})}class PDFDocumentLoadingTask{static#e=0;constructor(){this._capability=(0,_util.createPromiseCapability)(),this._transport=null,this._worker=null,this.docId=`d${PDFDocumentLoadingTask.#e++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null,this.onUnsupportedFeature=null}get promise(){return this._capability.promise}destroy(){return ie(this,null,function*(){this.destroyed=!0,yield this._transport?.destroy(),this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)})}}exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(e,t,i=!1,n=null){this.length=e,this.initialData=t,this.progressiveDone=i,this.contentDispositionFilename=n,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=(0,_util.createPromiseCapability)()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(let i of this._rangeListeners)i(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(let i of this._progressListeners)i(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(let t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(let e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(e,t){this._pdfInfo=e,this._transport=t,Object.defineProperty(this,"fingerprint",{get(){return(0,_display_utils.deprecated)("`PDFDocumentProxy.fingerprint`, please use `PDFDocumentProxy.fingerprints` instead."),this.fingerprints[0]}}),Object.defineProperty(this,"getStats",{value:()=>ie(this,null,function*(){return(0,_display_utils.deprecated)("`PDFDocumentProxy.getStats`, please use the `PDFDocumentProxy.stats`-getter instead."),this.stats||{streamTypes:{},fontTypes:{}}})})}get annotationStorage(){return this._transport.annotationStorage}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get stats(){return this._transport.stats}get isPureXfa(){return!!this._transport._htmlForXfa}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}saveDocument(){return this._transport.annotationStorage.size<=0&&(0,_display_utils.deprecated)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead."),this._transport.saveDocument()}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(e,t,i,n,r=!1){this._pageIndex=e,this._pageInfo=t,this._ownerDocument=n,this._transport=i,this._stats=r?new _display_utils.StatTimer:null,this._pdfBug=r,this.commonObjs=i.commonObjs,this.objs=new PDFObjects,this._bitmaps=new Set,this.cleanupAfterRender=!1,this.pendingCleanup=!1,this._intentStates=new Map,this._annotationPromises=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:i=0,offsetY:n=0,dontFlip:r=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:e,rotation:t,offsetX:i,offsetY:n,dontFlip:r})}getAnnotations({intent:e="display"}={}){let t=this._transport.getRenderingIntent(e),i=this._annotationPromises.get(t.cacheKey);return i||(i=this._transport.getAnnotations(this._pageIndex,t.renderingIntent),this._annotationPromises.set(t.cacheKey,i),i=i.then(n=>{for(let r of n)r.titleObj!==void 0&&Object.defineProperty(r,"title",{get(){return(0,_display_utils.deprecated)("`title`-property on annotation, please use `titleObj` instead."),r.titleObj.str}}),r.contentsObj!==void 0&&Object.defineProperty(r,"contents",{get(){return(0,_display_utils.deprecated)("`contents`-property on annotation, please use `contentsObj` instead."),r.contentsObj.str}});return n})),i}getJSActions(){return this._jsActionsPromise||=this._transport.getPageJSActions(this._pageIndex)}getXfa(){return ie(this,null,function*(){return this._transport._htmlForXfa?.children[this._pageIndex]||null})}render({canvasContext:e,viewport:t,intent:i="display",annotationMode:n=_util.AnnotationMode.ENABLE,transform:r=null,imageLayer:o=null,canvasFactory:a=null,background:l=null,optionalContentConfigPromise:c=null,annotationCanvasMap:d=null,pageColors:h=null,printAnnotationStorage:u=null}){arguments[0]?.renderInteractiveForms!==void 0&&((0,_display_utils.deprecated)("render no longer accepts the `renderInteractiveForms`-option, please use the `annotationMode`-option instead."),arguments[0].renderInteractiveForms===!0&&n===_util.AnnotationMode.ENABLE&&(n=_util.AnnotationMode.ENABLE_FORMS)),arguments[0]?.includeAnnotationStorage!==void 0&&((0,_display_utils.deprecated)("render no longer accepts the `includeAnnotationStorage`-option, please use the `annotationMode`-option instead."),arguments[0].includeAnnotationStorage===!0&&n===_util.AnnotationMode.ENABLE&&(n=_util.AnnotationMode.ENABLE_STORAGE)),this._stats&&this._stats.time("Overall");let p=this._transport.getRenderingIntent(i,n,u);this.pendingCleanup=!1,c||(c=this._transport.getOptionalContentConfig());let f=this._intentStates.get(p.cacheKey);f||(f=Object.create(null),this._intentStates.set(p.cacheKey,f)),f.streamReaderCancelTimeout&&(clearTimeout(f.streamReaderCancelTimeout),f.streamReaderCancelTimeout=null);let m=a||new DefaultCanvasFactory({ownerDocument:this._ownerDocument}),g=!!(p.renderingIntent&_util.RenderingIntentFlag.PRINT);f.displayReadyCapability||(f.displayReadyCapability=(0,_util.createPromiseCapability)(),f.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList(p));let b=y=>{f.renderTasks.delete(v),(this.cleanupAfterRender||g)&&(this.pendingCleanup=!0),this._tryCleanup(),y?(v.capability.reject(y),this._abortOperatorList({intentState:f,reason:y instanceof Error?y:new Error(y)})):v.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"))},v=new InternalRenderTask({callback:b,params:{canvasContext:e,viewport:t,transform:r,imageLayer:o,background:l},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:d,operatorList:f.operatorList,pageIndex:this._pageIndex,canvasFactory:m,useRequestAnimationFrame:!g,pdfBug:this._pdfBug,pageColors:h});(f.renderTasks||=new Set).add(v);let E=v.task;return Promise.all([f.displayReadyCapability.promise,c]).then(([y,w])=>{if(this.pendingCleanup){b();return}this._stats&&this._stats.time("Rendering"),v.initializeGraphics({transparency:y,optionalContentConfig:w}),v.operatorListChanged()}).catch(b),E}getOperatorList({intent:e="display",annotationMode:t=_util.AnnotationMode.ENABLE,printAnnotationStorage:i=null}={}){function n(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(a))}let r=this._transport.getRenderingIntent(e,t,i,!0),o=this._intentStates.get(r.cacheKey);o||(o=Object.create(null),this._intentStates.set(r.cacheKey,o));let a;return o.opListReadCapability||(a=Object.create(null),a.operatorListChanged=n,o.opListReadCapability=(0,_util.createPromiseCapability)(),(o.renderTasks||=new Set).add(a),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats&&this._stats.time("Page Request"),this._pumpOperatorList(r)),o.opListReadCapability.promise}streamTextContent({disableCombineTextItems:e=!1,includeMarkedContent:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,combineTextItems:e!==!0,includeMarkedContent:t===!0},{highWaterMark:100,size(n){return n.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(i=>_xfa_text.XfaText.textContent(i));let t=this.streamTextContent(e);return new Promise(function(i,n){function r(){o.read().then(function({value:l,done:c}){if(c){i(a);return}Object.assign(a.styles,l.styles),a.items.push(...l.items),r()},n)}let o=t.getReader(),a={items:[],styles:Object.create(null)};r()})}getStructTree(){return this._structTreePromise||=this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let e=[];for(let t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(let i of t.renderTasks)e.push(i.completed),i.cancel();this.objs.clear();for(let t of this._bitmaps)t.close();return this._bitmaps.clear(),this._annotationPromises.clear(),this._jsActionsPromise=null,this._structTreePromise=null,this.pendingCleanup=!1,Promise.all(e)}cleanup(e=!1){return this.pendingCleanup=!0,this._tryCleanup(e)}_tryCleanup(e=!1){if(!this.pendingCleanup)return!1;for(let{renderTasks:t,operatorList:i}of this._intentStates.values())if(t.size>0||!i.lastChunk)return!1;this._intentStates.clear(),this.objs.clear(),this._annotationPromises.clear(),this._jsActionsPromise=null,this._structTreePromise=null,e&&this._stats&&(this._stats=new _display_utils.StatTimer);for(let t of this._bitmaps)t.close();return this._bitmaps.clear(),this.pendingCleanup=!1,!0}_startRenderPage(e,t){let i=this._intentStates.get(t);i&&(this._stats&&this._stats.timeEnd("Page Request"),i.displayReadyCapability&&i.displayReadyCapability.resolve(e))}_renderPageChunk(e,t){for(let i=0,n=e.length;i<n;i++)t.operatorList.fnArray.push(e.fnArray[i]),t.operatorList.argsArray.push(e.argsArray[i]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(let i of t.renderTasks)i.operatorListChanged();e.lastChunk&&this._tryCleanup()}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageMap:i}){let r=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:i}).getReader(),o=this._intentStates.get(t);o.streamReader=r;let a=()=>{r.read().then(({value:l,done:c})=>{if(c){o.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(l,o),a())},l=>{if(o.streamReader=null,!this._transport.destroyed){if(o.operatorList){o.operatorList.lastChunk=!0;for(let c of o.renderTasks)c.operatorListChanged();this._tryCleanup()}if(o.displayReadyCapability)o.displayReadyCapability.reject(l);else if(o.opListReadCapability)o.opListReadCapability.reject(l);else throw l}})};a()}_abortOperatorList({intentState:e,reason:t,force:i=!1}){if(e.streamReader){if(!i){if(e.renderTasks.size>0)return;if(t instanceof _display_utils.RenderingCancelledException){e.streamReaderCancelTimeout=setTimeout(()=>{this._abortOperatorList({intentState:e,reason:t,force:!0}),e.streamReaderCancelTimeout=null},RENDERING_CANCELLED_TIMEOUT);return}}if(e.streamReader.cancel(new _util.AbortException(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(let[n,r]of this._intentStates)if(r===e){this._intentStates.delete(n);break}this.cleanup()}}}get stats(){return this._stats}}exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){this._listeners=[],this._deferred=Promise.resolve()}postMessage(e,t){let i={data:structuredClone(e,t)};this._deferred.then(()=>{for(let n of this._listeners)n.call(this,i)})}addEventListener(e,t){this._listeners.push(t)}removeEventListener(e,t){let i=this._listeners.indexOf(t);this._listeners.splice(i,1)}terminate(){this._listeners.length=0}}exports.LoopbackPort=LoopbackPort;let PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_is_node.isNodeJS&&typeof sg=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){let s=document?.currentScript?.src;s&&(PDFWorkerUtil.fallbackWorkerSrc=s.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(s,e){let t;try{if(t=new URL(s),!t.origin||t.origin==="null")return!1}catch{return!1}let i=new URL(e,t);return t.origin===i.origin},PDFWorkerUtil.createCDNWrapper=function(s){let e=`importScripts("${s}");`;return URL.createObjectURL(new Blob([e]))}}class PDFWorker{static#workerPorts=new WeakMap;constructor({name:s=null,port:e=null,verbosity:t=(0,_util.getVerbosityLevel)()}={}){if(e&&PDFWorker.#workerPorts.has(e))throw new Error("Cannot use more than one PDFWorker per port.");if(this.name=s,this.destroyed=!1,this.verbosity=t,this._readyCapability=(0,_util.createPromiseCapability)(),this._port=null,this._webWorker=null,this._messageHandler=null,e){PDFWorker.#workerPorts.set(e,this),this._initializeFromPort(e);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(s){this._port=s,this._messageHandler=new _message_handler.MessageHandler("main","worker",s),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve()}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:s}=PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,s)||(s=PDFWorkerUtil.createCDNWrapper(new URL(s,window.location).href));let e=new Worker(s),t=new _message_handler.MessageHandler("main","worker",e),i=()=>{e.removeEventListener("error",n),t.destroy(),e.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},n=()=>{this._webWorker||i()};e.addEventListener("error",n),t.on("test",o=>{if(e.removeEventListener("error",n),this.destroyed){i();return}o?(this._messageHandler=t,this._port=e,this._webWorker=e,this._readyCapability.resolve(),t.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),t.destroy(),e.terminate())}),t.on("ready",o=>{if(e.removeEventListener("error",n),this.destroyed){i();return}try{r()}catch{this._setupFakeWorker()}});let r=()=>{let o=new Uint8Array;t.send("test",o,[o.buffer])};r();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),PDFWorker._setupFakeWorkerGlobal.then(s=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}let e=new LoopbackPort;this._port=e;let t=`fake${PDFWorkerUtil.fakeWorkerId++}`,i=new _message_handler.MessageHandler(t+"_worker",t,e);s.setup(i,e);let n=new _message_handler.MessageHandler(t,t+"_worker",e);this._messageHandler=n,this._readyCapability.resolve(),n.send("configure",{verbosity:this.verbosity})}).catch(s=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${s.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),PDFWorker.#workerPorts.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(s){if(!s?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return this.#workerPorts.has(s.port)?this.#workerPorts.get(s.port):new PDFWorker(s)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _is_node.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){let loader=()=>ie(this,null,function*(){let mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_is_node.isNodeJS&&typeof sg=="function"){let worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return yield(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler});return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}}exports.PDFWorker=PDFWorker,PDFWorker.getWorkerSrc=function(){return(0,_display_utils.deprecated)("`PDFWorker.getWorkerSrc()`, please use `PDFWorker.workerSrc` instead."),this.workerSrc};class WorkerTransport{#e=null;#t=new Map;#i=new Map;#n=null;constructor(e,t,i,n){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({docId:t.docId,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),ownerDocument:n.ownerDocument,styleElement:n.styleElement}),this._params=n,n.useWorkerFetch||(this.CMapReaderFactory=new n.CMapReaderFactory({baseUrl:n.cMapUrl,isCompressed:n.cMapPacked}),this.StandardFontDataFactory=new n.StandardFontDataFactory({baseUrl:n.standardFontDataUrl})),this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=(0,_util.createPromiseCapability)(),this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}get stats(){return this.#e}getRenderingIntent(e,t=_util.AnnotationMode.ENABLE,i=null,n=!1){let r=_util.RenderingIntentFlag.DISPLAY,o=null;switch(e){case"any":r=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":r=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${e}`)}switch(t){case _util.AnnotationMode.DISABLE:r+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:r+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:r+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,o=(r&_util.RenderingIntentFlag.PRINT&&i instanceof _annotation_storage.PrintAnnotationStorage?i:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${t}`)}return n&&(r+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:r,cacheKey:`${r}_${_annotation_storage.AnnotationStorage.getHash(o)}`,annotationStorageMap:o}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=(0,_util.createPromiseCapability)(),this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));let e=[];for(let i of this.#t.values())e.push(i._destroy());this.#t.clear(),this.#i.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#n=null,this._getFieldObjectsPromise=null,this._hasJSActionsPromise=null,this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(i,n)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},n.onPull=()=>{this._fullReader.read().then(function({value:r,done:o}){if(o){n.close();return}(0,_util.assert)((0,_util.isArrayBuffer)(r),"GetReader - expected an ArrayBuffer."),n.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{n.error(r)})},n.onCancel=r=>{this._fullReader.cancel(r),n.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("ReaderHeadersReady",i=>{let n=(0,_util.createPromiseCapability)(),r=this._fullReader;return r.headersReady.then(()=>{(!r.isStreamingSupported||!r.isRangeSupported)&&(this._lastProgress&&t.onProgress?.(this._lastProgress),r.onProgress=o=>{t.onProgress?.({loaded:o.loaded,total:o.total})}),n.resolve({isStreamingSupported:r.isStreamingSupported,isRangeSupported:r.isRangeSupported,contentLength:r.contentLength})},n.reject),n.promise}),e.on("GetRangeReader",(i,n)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let r=this._networkStream.getRangeReader(i.begin,i.end);if(!r){n.close();return}n.onPull=()=>{r.read().then(function({value:o,done:a}){if(a){n.close();return}(0,_util.assert)((0,_util.isArrayBuffer)(o),"GetRangeReader - expected an ArrayBuffer."),n.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{n.error(o)})},n.onCancel=o=>{r.cancel(o),n.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("GetDoc",({pdfInfo:i})=>{this._numPages=i.numPages,this._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,t._capability.resolve(new PDFDocumentProxy(i,this))}),e.on("DocException",function(i){let n;switch(i.name){case"PasswordException":n=new _util.PasswordException(i.message,i.code);break;case"InvalidPDFException":n=new _util.InvalidPDFException(i.message);break;case"MissingPDFException":n=new _util.MissingPDFException(i.message);break;case"UnexpectedResponseException":n=new _util.UnexpectedResponseException(i.message,i.status);break;case"UnknownErrorException":n=new _util.UnknownErrorException(i.message,i.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}t._capability.reject(n)}),e.on("PasswordRequest",i=>{if(this._passwordCapability=(0,_util.createPromiseCapability)(),t.onPassword){let n=r=>{r instanceof Error?this._passwordCapability.reject(r):this._passwordCapability.resolve({password:r})};try{t.onPassword(n,i.code)}catch(r){this._passwordCapability.reject(r)}}else this._passwordCapability.reject(new _util.PasswordException(i.message,i.code));return this._passwordCapability.promise}),e.on("DataLoaded",i=>{t.onProgress?.({loaded:i.length,total:i.length}),this.downloadInfoCapability.resolve(i)}),e.on("StartRenderPage",i=>{if(this.destroyed)return;this.#t.get(i.pageIndex)._startRenderPage(i.transparency,i.cacheKey)}),e.on("commonobj",([i,n,r])=>{if(!this.destroyed&&!this.commonObjs.has(i))switch(n){case"Font":let o=this._params;if("error"in r){let c=r.error;(0,_util.warn)(`Error during font loading: ${c}`),this.commonObjs.resolve(i,c);break}let a=null;o.pdfBug&&globalThis.FontInspector?.enabled&&(a={registerFont(c,d){globalThis.FontInspector.fontAdded(c,d)}});let l=new _font_loader.FontFaceObject(r,{isEvalSupported:o.isEvalSupported,disableFontFace:o.disableFontFace,ignoreErrors:o.ignoreErrors,onUnsupportedFeature:this._onUnsupportedFeature.bind(this),fontRegistry:a});this.fontLoader.bind(l).catch(c=>e.sendWithPromise("FontFallback",{id:i})).finally(()=>{!o.fontExtraProperties&&l.data&&(l.data=null),this.commonObjs.resolve(i,l)});break;case"FontPath":case"Image":this.commonObjs.resolve(i,r);break;default:throw new Error(`Got unknown common object type ${n}`)}}),e.on("obj",([i,n,r,o])=>{if(this.destroyed)return;let a=this.#t.get(n);if(!a.objs.has(i))switch(r){case"Image":a.objs.resolve(i,o);let l=8e6;if(o){let c;if(o.bitmap){let{bitmap:d,width:h,height:u}=o;c=h*u*4,a._bitmaps.add(d)}else c=o.data?.length||0;c>l&&(a.cleanupAfterRender=!0)}break;case"Pattern":a.objs.resolve(i,o);break;default:throw new Error(`Got unknown object type ${r}`)}}),e.on("DocProgress",i=>{this.destroyed||t.onProgress?.({loaded:i.loaded,total:i.total})}),e.on("DocStats",i=>{this.destroyed||(this.#e=Object.freeze({streamTypes:Object.freeze(i.streamTypes),fontTypes:Object.freeze(i.fontTypes)}))}),e.on("UnsupportedFeature",this._onUnsupportedFeature.bind(this)),e.on("FetchBuiltInCMap",i=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.CMapReaderFactory?this.CMapReaderFactory.fetch(i):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),e.on("FetchStandardFontData",i=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.StandardFontDataFactory?this.StandardFontDataFactory.fetch(i):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}_onUnsupportedFeature({featureId:e}){this.destroyed||this.loadingTask.onUnsupportedFeature?.(e)}getData(){return this.messageHandler.sendWithPromise("GetData",null)}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));let t=e-1,i=this.#i.get(t);if(i)return i;let n=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");let o=new PDFPageProxy(t,r,this,this._params.ownerDocument,this._params.pdfBug);return this.#t.set(t,o),o});return this.#i.set(t,n),n}getPageIndex(e){return typeof e!="object"||e===null||!Number.isInteger(e.num)||e.num<0||!Number.isInteger(e.gen)||e.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen})}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}saveDocument(){return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:this.annotationStorage.serializable,filename:this._fullReader?.filename??null}).finally(()=>{this.annotationStorage.resetModified()})}getFieldObjects(){return this._getFieldObjectsPromise||=this.messageHandler.sendWithPromise("GetFieldObjects",null)}hasJSActions(){return this._hasJSActionsPromise||=this.messageHandler.sendWithPromise("HasJSActions",null)}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(e=>new _optional_content_config.OptionalContentConfig(e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){return this.#n||=this.messageHandler.sendWithPromise("GetMetadata",null).then(e=>({info:e[0],metadata:e[1]?new _metadata.Metadata(e[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}))}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}startCleanup(e=!1){return ie(this,null,function*(){if(yield this.messageHandler.sendWithPromise("Cleanup",null),!this.destroyed){for(let t of this.#t.values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),this.#n=null,this._getFieldObjectsPromise=null,this._hasJSActionsPromise=null}})}get loadingParams(){let e=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:e.disableAutoFetch,enableXfa:e.enableXfa})}}class PDFObjects{#e=Object.create(null);#t(e){let t=this.#e[e];return t||(this.#e[e]={capability:(0,_util.createPromiseCapability)(),data:null})}get(e,t=null){if(t){let n=this.#t(e);return n.capability.promise.then(()=>t(n.data)),null}let i=this.#e[e];if(!i?.capability.settled)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return i.data}has(e){return this.#e[e]?.capability.settled||!1}resolve(e,t=null){let i=this.#t(e);i.data=t,i.capability.resolve()}clear(){this.#e=Object.create(null)}}class RenderTask{#e=null;constructor(e){this.#e=e,this.onContinue=null}get promise(){return this.#e.capability.promise}cancel(){this.#e.cancel()}get separateAnnots(){let{separateAnnots:e}=this.#e.operatorList;if(!e)return!1;let{annotationCanvasMap:t}=this.#e;return e.form||e.canvas&&t?.size>0}}exports.RenderTask=RenderTask;class InternalRenderTask{static#e=new WeakSet;constructor({callback:e,params:t,objs:i,commonObjs:n,annotationCanvasMap:r,operatorList:o,pageIndex:a,canvasFactory:l,useRequestAnimationFrame:c=!1,pdfBug:d=!1,pageColors:h=null}){this.callback=e,this.params=t,this.objs=i,this.commonObjs=n,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=a,this.canvasFactory=l,this._pdfBug=d,this.pageColors=h,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=c===!0&&typeof window<"u",this.cancelled=!1,this.capability=(0,_util.createPromiseCapability)(),this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(InternalRenderTask.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");InternalRenderTask.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:i,viewport:n,transform:r,imageLayer:o,background:a}=this.params;this.gfx=new _canvas.CanvasGraphics(i,this.commonObjs,this.objs,this.canvasFactory,o,t,this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:r,viewport:n,transparency:e,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback&&this.graphicsReadyCallback()}cancel(e=null){this.running=!1,this.cancelled=!0,this.gfx&&this.gfx.endDrawing(),this._canvas&&InternalRenderTask.#e.delete(this._canvas),this.callback(e||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,"canvas"))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}this.stepper&&this.stepper.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}_next(){return ie(this,null,function*(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),this._canvas&&InternalRenderTask.#e.delete(this._canvas),this.callback())))})}}let version="2.16.105";exports.version=version;let build="172ccdbe5";exports.build=build},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PrintAnnotationStorage=e.AnnotationStorage=void 0;var i=t(1),n=t(6),r=t(10);class o{constructor(){this._storage=new Map,this._modified=!1,this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(c,d){let h=this._storage.get(c);return h===void 0?d:Object.assign(d,h)}getRawValue(c){return this._storage.get(c)}remove(c){if(this._storage.delete(c),this._storage.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(let d of this._storage.values())if(d instanceof n.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(c,d){let h=this._storage.get(c),u=!1;if(h!==void 0)for(let[p,f]of Object.entries(d))h[p]!==f&&(u=!0,h[p]=f);else u=!0,this._storage.set(c,d);u&&this.#e(),d instanceof n.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(d.constructor._type)}has(c){return this._storage.has(c)}getAll(){return this._storage.size>0?(0,i.objectFromMap)(this._storage):null}get size(){return this._storage.size}#e(){this._modified||(this._modified=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this._modified&&(this._modified=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new a(this)}get serializable(){if(this._storage.size===0)return null;let c=new Map;for(let[d,h]of this._storage){let u=h instanceof n.AnnotationEditor?h.serialize():h;u&&c.set(d,u)}return c}static getHash(c){if(!c)return"";let d=new r.MurmurHash3_64;for(let[h,u]of c)d.update(`${h}:${JSON.stringify(u)}`);return d.hexdigest()}}e.AnnotationStorage=o;class a extends o{#e=null;constructor(c){super(),this.#e=structuredClone(c.serializable)}get print(){(0,i.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#e}}e.PrintAnnotationStorage=a},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationEditor=void 0;var i=t(7),n=t(1);class r{#e=this.focusin.bind(this);#t=this.focusout.bind(this);#i=!1;#n=!1;#r=!1;#c=r._zIndex++;static _colorManager=new i.ColorManager;static _zIndex=1;constructor(a){this.constructor===r&&(0,n.unreachable)("Cannot initialize AnnotationEditor."),this.parent=a.parent,this.id=a.id,this.width=this.height=null,this.pageIndex=a.parent.pageIndex,this.name=a.name,this.div=null;let[l,c]=this.parent.viewportBaseDimensions;this.x=a.x/l,this.y=a.y/c,this.rotation=this.parent.viewport.rotation,this.isAttachedToDOM=!1}static get _defaultLineColor(){return(0,n.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#c}focusin(a){this.#i?this.#i=!1:this.parent.setSelected(this)}focusout(a){!this.isAttachedToDOM||a.relatedTarget?.closest(`#${this.id}`)||(a.preventDefault(),this.parent.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.parent.addToAnnotationStorage(this)}dragstart(a){let l=this.parent.div.getBoundingClientRect();this.startX=a.clientX-l.x,this.startY=a.clientY-l.y,a.dataTransfer.setData("text/plain",this.id),a.dataTransfer.effectAllowed="move"}setAt(a,l,c,d){let[h,u]=this.parent.viewportBaseDimensions;[c,d]=this.screenToPageTranslation(c,d),this.x=(a+c)/h,this.y=(l+d)/u,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}translate(a,l){let[c,d]=this.parent.viewportBaseDimensions;[a,l]=this.screenToPageTranslation(a,l),this.x+=a/c,this.y+=l/d,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}screenToPageTranslation(a,l){let{rotation:c}=this.parent.viewport;switch(c){case 90:return[l,-a];case 180:return[-a,-l];case 270:return[-l,a];default:return[a,l]}}setDims(a,l){let[c,d]=this.parent.viewportBaseDimensions;this.div.style.width=`${100*a/c}%`,this.div.style.height=`${100*l/d}%`}getInitialTranslation(){return[0,0]}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",this.#e),this.div.addEventListener("focusout",this.#t);let[a,l]=this.getInitialTranslation();return this.translate(a,l),(0,i.bindEvents)(this,this.div,["dragstart","pointerdown"]),this.div}pointerdown(a){let l=i.KeyboardManager.platform.isMac;if(a.button!==0||a.ctrlKey&&l){a.preventDefault();return}a.ctrlKey&&!l||a.shiftKey||a.metaKey&&l?this.parent.toggleSelected(this):this.parent.setSelected(this),this.#i=!0}getRect(a,l){let[c,d]=this.parent.viewportBaseDimensions,[h,u]=this.parent.pageDimensions,p=h*a/c,f=u*l/d,m=this.x*h,g=this.y*u,b=this.width*h,v=this.height*u;switch(this.rotation){case 0:return[m+p,u-g-f-v,m+p+b,u-g-f];case 90:return[m+f,u-g+p,m+f+v,u-g+p+b];case 180:return[m-p-b,u-g+f,m-p,u-g+f+v];case 270:return[m-f-v,u-g-p-b,m-f,u-g-p];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(a,l){let[c,d,h,u]=a,p=h-c,f=u-d;switch(this.rotation){case 0:return[c,l-u,p,f];case 90:return[c,l-d,f,p];case 180:return[h,l-d,p,f];case 270:return[h,l-u,f,p];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#r=!0}disableEditMode(){this.#r=!1}isInEditMode(){return this.#r}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",this.#e)}serialize(){(0,n.unreachable)("An editor must be serializable")}static deserialize(a,l){let c=new this.prototype.constructor({parent:l,id:l.getNextId()});c.rotation=a.rotation;let[d,h]=l.pageDimensions,[u,p,f,m]=c.getRectInCurrentCoords(a.rect,h);return c.x=u/d,c.y=p/h,c.width=f/d,c.height=m/h,c}remove(){this.div.removeEventListener("focusin",this.#e),this.div.removeEventListener("focusout",this.#t),this.isEmpty()||this.commit(),this.parent.remove(this)}select(){this.div?.classList.add("selectedEditor")}unselect(){this.div?.classList.remove("selectedEditor")}updateParams(a,l){}disableEditing(){}enableEditing(){}get propertiesToUpdate(){return{}}get contentDiv(){return this.div}get isEditing(){return this.#n}set isEditing(a){this.#n=a,a?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null)}}e.AnnotationEditor=r},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.KeyboardManager=e.CommandManager=e.ColorManager=e.AnnotationEditorUIManager=void 0,e.bindEvents=r,e.opacityToHex=o;var i=t(1),n=t(8);function r(p,f,m){for(let g of m)f.addEventListener(g,p[g].bind(p))}function o(p){return Math.round(Math.min(255,Math.max(1,255*p))).toString(16).padStart(2,"0")}class a{#e=0;getId(){return`${i.AnnotationEditorPrefix}${this.#e++}`}}class l{#e=[];#t=!1;#i;#n=-1;constructor(f=128){this.#i=f}add({cmd:f,undo:m,mustExec:g,type:b=NaN,overwriteIfSameType:v=!1,keepUndo:E=!1}){if(g&&f(),this.#t)return;let y={cmd:f,undo:m,type:b};if(this.#n===-1){this.#e.length>0&&(this.#e.length=0),this.#n=0,this.#e.push(y);return}if(v&&this.#e[this.#n].type===b){E&&(y.undo=this.#e[this.#n].undo),this.#e[this.#n]=y;return}let w=this.#n+1;w===this.#i?this.#e.splice(0,1):(this.#n=w,w<this.#e.length&&this.#e.splice(w)),this.#e.push(y)}undo(){this.#n!==-1&&(this.#t=!0,this.#e[this.#n].undo(),this.#t=!1,this.#n-=1)}redo(){this.#n<this.#e.length-1&&(this.#n+=1,this.#t=!0,this.#e[this.#n].cmd(),this.#t=!1)}hasSomethingToUndo(){return this.#n!==-1}hasSomethingToRedo(){return this.#n<this.#e.length-1}destroy(){this.#e=null}}e.CommandManager=l;class c{constructor(f){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;let m=c.platform.isMac;for(let[g,b]of f)for(let v of g){let E=v.startsWith("mac+");m&&E?(this.callbacks.set(v.slice(4),b),this.allKeys.add(v.split("+").at(-1))):!m&&!E&&(this.callbacks.set(v,b),this.allKeys.add(v.split("+").at(-1)))}}static get platform(){let f=typeof navigator<"u"?navigator.platform:"";return(0,i.shadow)(this,"platform",{isWin:f.includes("Win"),isMac:f.includes("Mac")})}#e(f){f.altKey&&this.buffer.push("alt"),f.ctrlKey&&this.buffer.push("ctrl"),f.metaKey&&this.buffer.push("meta"),f.shiftKey&&this.buffer.push("shift"),this.buffer.push(f.key);let m=this.buffer.join("+");return this.buffer.length=0,m}exec(f,m){if(!this.allKeys.has(m.key))return;let g=this.callbacks.get(this.#e(m));g&&(g.bind(f)(),m.stopPropagation(),m.preventDefault())}}e.KeyboardManager=c;class d{#e=null;copy(f){f&&(Array.isArray(f)?this.#e=f.map(m=>m.serialize()):this.#e=[f.serialize()],this.#e=this.#e.filter(m=>!!m),this.#e.length===0&&(this.#e=null))}paste(){return this.#e}isEmpty(){return this.#e===null}destroy(){this.#e=null}}class h{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){let f=new Map([["CanvasText",null],["Canvas",null]]);return(0,n.getColorValues)(f),(0,i.shadow)(this,"_colors",f)}convert(f){let m=(0,n.getRGB)(f);if(!window.matchMedia("(forced-colors: active)").matches)return m;for(let[g,b]of this._colors)if(b.every((v,E)=>v===m[E]))return h._colorsMapping.get(g);return m}getHexCode(f){let m=this._colors.get(f);return m?i.Util.makeHexColor(...m):f}}e.ColorManager=h;class u{#e=null;#t=new Map;#i=new Map;#n=new d;#r=new l;#c=0;#a=null;#s=null;#u=new a;#h=!1;#l=i.AnnotationEditorType.NONE;#o=new Set;#f=this.keydown.bind(this);#p=this.onEditingAction.bind(this);#v=this.onPageChanging.bind(this);#g={isEditing:!1,isEmpty:!0,hasEmptyClipboard:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1};#b=null;static _keyboardManager=new c([[["ctrl+a","mac+meta+a"],u.prototype.selectAll],[["ctrl+c","mac+meta+c"],u.prototype.copy],[["ctrl+v","mac+meta+v"],u.prototype.paste],[["ctrl+x","mac+meta+x"],u.prototype.cut],[["ctrl+z","mac+meta+z"],u.prototype.undo],[["ctrl+y","ctrl+shift+Z","mac+meta+shift+Z"],u.prototype.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete"],u.prototype.delete],[["Escape","mac+Escape"],u.prototype.unselectAll]]);constructor(f,m){this.#b=f,this.#s=m,this.#s._on("editingaction",this.#p),this.#s._on("pagechanging",this.#v)}destroy(){this.#_(),this.#s._off("editingaction",this.#p),this.#s._off("pagechanging",this.#v);for(let f of this.#i.values())f.destroy();this.#i.clear(),this.#t.clear(),this.#e=null,this.#o.clear(),this.#n.destroy(),this.#r.destroy()}onPageChanging({pageNumber:f}){this.#c=f-1}focusMainContainer(){this.#b.focus()}#E(){this.#b.addEventListener("keydown",this.#f)}#_(){this.#b.removeEventListener("keydown",this.#f)}keydown(f){this.getActive()?.shouldGetKeyboardEvents()||u._keyboardManager.exec(this,f)}onEditingAction(f){["undo","redo","cut","copy","paste","delete","selectAll"].includes(f.name)&&this[f.name]()}#d(f){Object.entries(f).some(([g,b])=>this.#g[g]!==b)&&this.#s.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#g,f)})}#C(f){this.#s.dispatch("annotationeditorparamschanged",{source:this,details:f})}setEditingState(f){f?(this.#E(),this.#d({isEditing:this.#l!==i.AnnotationEditorType.NONE,isEmpty:this.#y(),hasSomethingToUndo:this.#r.hasSomethingToUndo(),hasSomethingToRedo:this.#r.hasSomethingToRedo(),hasSelectedEditor:!1,hasEmptyClipboard:this.#n.isEmpty()})):(this.#_(),this.#d({isEditing:!1}))}registerEditorTypes(f){this.#a=f;for(let m of this.#a)this.#C(m.defaultPropertiesToUpdate)}getId(){return this.#u.getId()}addLayer(f){this.#i.set(f.pageIndex,f),this.#h?f.enable():f.disable()}removeLayer(f){this.#i.delete(f.pageIndex)}updateMode(f){if(this.#l=f,f===i.AnnotationEditorType.NONE)this.setEditingState(!1),this.#m();else{this.setEditingState(!0),this.#I();for(let m of this.#i.values())m.updateMode(f)}}updateToolbar(f){f!==this.#l&&this.#s.dispatch("switchannotationeditormode",{source:this,mode:f})}updateParams(f,m){for(let g of this.#o)g.updateParams(f,m);for(let g of this.#a)g.updateDefaultParams(f,m)}#I(){if(!this.#h){this.#h=!0;for(let f of this.#i.values())f.enable()}}#m(){if(this.unselectAll(),this.#h){this.#h=!1;for(let f of this.#i.values())f.disable()}}getEditors(f){let m=[];for(let g of this.#t.values())g.pageIndex===f&&m.push(g);return m}getEditor(f){return this.#t.get(f)}addEditor(f){this.#t.set(f.id,f)}removeEditor(f){this.#t.delete(f.id),this.unselect(f)}#x(f){let m=this.#i.get(f.pageIndex);m?m.addOrRebuild(f):this.addEditor(f)}setActiveEditor(f){this.#e!==f&&(this.#e=f,f&&this.#C(f.propertiesToUpdate))}toggleSelected(f){if(this.#o.has(f)){this.#o.delete(f),f.unselect(),this.#d({hasSelectedEditor:this.hasSelection});return}this.#o.add(f),f.select(),this.#C(f.propertiesToUpdate),this.#d({hasSelectedEditor:!0})}setSelected(f){for(let m of this.#o)m!==f&&m.unselect();this.#o.clear(),this.#o.add(f),f.select(),this.#C(f.propertiesToUpdate),this.#d({hasSelectedEditor:!0})}isSelected(f){return this.#o.has(f)}unselect(f){f.unselect(),this.#o.delete(f),this.#d({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#o.size!==0}undo(){this.#r.undo(),this.#d({hasSomethingToUndo:this.#r.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#y()})}redo(){this.#r.redo(),this.#d({hasSomethingToUndo:!0,hasSomethingToRedo:this.#r.hasSomethingToRedo(),isEmpty:this.#y()})}addCommands(f){this.#r.add(f),this.#d({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#y()})}#y(){if(this.#t.size===0)return!0;if(this.#t.size===1)for(let f of this.#t.values())return f.isEmpty();return!1}delete(){if(this.#e&&this.#e.commitOrRemove(),!this.hasSelection)return;let f=[...this.#o],m=()=>{for(let b of f)b.remove()},g=()=>{for(let b of f)this.#x(b)};this.addCommands({cmd:m,undo:g,mustExec:!0})}copy(){if(this.#e&&this.#e.commitOrRemove(),this.hasSelection){let f=[];for(let m of this.#o)m.isEmpty()||f.push(m);if(f.length===0)return;this.#n.copy(f),this.#d({hasEmptyClipboard:!1})}}cut(){this.copy(),this.delete()}paste(){if(this.#n.isEmpty())return;this.unselectAll();let f=this.#i.get(this.#c),m=this.#n.paste().map(v=>f.deserialize(v)),g=()=>{for(let v of m)this.#x(v);this.#w(m)},b=()=>{for(let v of m)v.remove()};this.addCommands({cmd:g,undo:b,mustExec:!0})}#w(f){this.#o.clear();for(let m of f)m.isEmpty()||(this.#o.add(m),m.select());this.#d({hasSelectedEditor:!0})}selectAll(){for(let f of this.#o)f.commit();this.#w(this.#t.values())}unselectAll(){if(this.#e){this.#e.commitOrRemove();return}if(this.#w.size!==0){for(let f of this.#o)f.unselect();this.#o.clear(),this.#d({hasSelectedEditor:!1})}}isActive(f){return this.#e===f}getActive(){return this.#e}getMode(){return this.#l}}e.AnnotationEditorUIManager=u},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StatTimer=e.RenderingCancelledException=e.PixelsPerInch=e.PageViewport=e.PDFDateString=e.DOMStandardFontDataFactory=e.DOMSVGFactory=e.DOMCanvasFactory=e.DOMCMapReaderFactory=e.AnnotationPrefix=void 0,e.deprecated=C,e.getColorValues=O,e.getCurrentTransform=F,e.getCurrentTransformInverse=V,e.getFilenameFromUrl=b,e.getPdfFilenameFromUrl=v,e.getRGB=I,e.getXfaPageViewport=M,e.isDataScheme=m,e.isPdfFile=g,e.isValidFetchUrl=y,e.loadScript=w;var i=t(9),n=t(1);let r="http://www.w3.org/2000/svg",o="pdfjs_internal_id_";e.AnnotationPrefix=o;class a{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}e.PixelsPerInch=a;class l extends i.BaseCanvasFactory{constructor({ownerDocument:N=globalThis.document}={}){super(),this._document=N}_createCanvas(N,z){let G=this._document.createElement("canvas");return G.width=N,G.height=z,G}}e.DOMCanvasFactory=l;function c(x,N=!1){return ie(this,null,function*(){if(y(x,document.baseURI)){let z=yield fetch(x);if(!z.ok)throw new Error(z.statusText);return N?new Uint8Array(yield z.arrayBuffer()):(0,n.stringToBytes)(yield z.text())}return new Promise((z,G)=>{let X=new XMLHttpRequest;X.open("GET",x,!0),N&&(X.responseType="arraybuffer"),X.onreadystatechange=()=>{if(X.readyState===XMLHttpRequest.DONE){if(X.status===200||X.status===0){let k;if(N&&X.response?k=new Uint8Array(X.response):!N&&X.responseText&&(k=(0,n.stringToBytes)(X.responseText)),k){z(k);return}}G(new Error(X.statusText))}},X.send(null)})})}class d extends i.BaseCMapReaderFactory{_fetchData(N,z){return c(N,this.isCompressed).then(G=>({cMapData:G,compressionType:z}))}}e.DOMCMapReaderFactory=d;class h extends i.BaseStandardFontDataFactory{_fetchData(N){return c(N,!0)}}e.DOMStandardFontDataFactory=h;class u extends i.BaseSVGFactory{_createSVG(N){return document.createElementNS(r,N)}}e.DOMSVGFactory=u;class p{constructor({viewBox:N,scale:z,rotation:G,offsetX:X=0,offsetY:k=0,dontFlip:B=!1}){this.viewBox=N,this.scale=z,this.rotation=G,this.offsetX=X,this.offsetY=k;let R=(N[2]+N[0])/2,j=(N[3]+N[1])/2,$,T,U,W;switch(G%=360,G<0&&(G+=360),G){case 180:$=-1,T=0,U=0,W=1;break;case 90:$=0,T=1,U=1,W=0;break;case 270:$=0,T=-1,U=-1,W=0;break;case 0:$=1,T=0,U=0,W=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}B&&(U=-U,W=-W);let Q,te,J,oe;$===0?(Q=Math.abs(j-N[1])*z+X,te=Math.abs(R-N[0])*z+k,J=Math.abs(N[3]-N[1])*z,oe=Math.abs(N[2]-N[0])*z):(Q=Math.abs(R-N[0])*z+X,te=Math.abs(j-N[1])*z+k,J=Math.abs(N[2]-N[0])*z,oe=Math.abs(N[3]-N[1])*z),this.transform=[$*z,T*z,U*z,W*z,Q-$*z*R-U*z*j,te-T*z*R-W*z*j],this.width=J,this.height=oe}clone({scale:N=this.scale,rotation:z=this.rotation,offsetX:G=this.offsetX,offsetY:X=this.offsetY,dontFlip:k=!1}={}){return new p({viewBox:this.viewBox.slice(),scale:N,rotation:z,offsetX:G,offsetY:X,dontFlip:k})}convertToViewportPoint(N,z){return n.Util.applyTransform([N,z],this.transform)}convertToViewportRectangle(N){let z=n.Util.applyTransform([N[0],N[1]],this.transform),G=n.Util.applyTransform([N[2],N[3]],this.transform);return[z[0],z[1],G[0],G[1]]}convertToPdfPoint(N,z){return n.Util.applyInverseTransform([N,z],this.transform)}}e.PageViewport=p;class f extends n.BaseException{constructor(N,z){super(N,"RenderingCancelledException"),this.type=z}}e.RenderingCancelledException=f;function m(x){let N=x.length,z=0;for(;z<N&&x[z].trim()==="";)z++;return x.substring(z,z+5).toLowerCase()==="data:"}function g(x){return typeof x=="string"&&/\.pdf$/i.test(x)}function b(x){let N=x.indexOf("#"),z=x.indexOf("?"),G=Math.min(N>0?N:x.length,z>0?z:x.length);return x.substring(x.lastIndexOf("/",G)+1,G)}function v(x,N="document.pdf"){if(typeof x!="string")return N;if(m(x))return(0,n.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),N;let z=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,G=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,X=z.exec(x),k=G.exec(X[1])||G.exec(X[2])||G.exec(X[3]);if(k&&(k=k[0],k.includes("%")))try{k=G.exec(decodeURIComponent(k))[0]}catch{}return k||N}class E{constructor(){this.started=Object.create(null),this.times=[]}time(N){N in this.started&&(0,n.warn)(`Timer is already running for ${N}`),this.started[N]=Date.now()}timeEnd(N){N in this.started||(0,n.warn)(`Timer has not been started for ${N}`),this.times.push({name:N,start:this.started[N],end:Date.now()}),delete this.started[N]}toString(){let N=[],z=0;for(let G of this.times){let X=G.name;X.length>z&&(z=X.length)}for(let G of this.times){let X=G.end-G.start;N.push(`${G.name.padEnd(z)} ${X}ms
`)}return N.join("")}}e.StatTimer=E;function y(x,N){try{let{protocol:z}=N?new URL(x,N):new URL(x);return z==="http:"||z==="https:"}catch{return!1}}function w(x,N=!1){return new Promise((z,G)=>{let X=document.createElement("script");X.src=x,X.onload=function(k){N&&X.remove(),z(k)},X.onerror=function(){G(new Error(`Cannot load script at: ${X.src}`))},(document.head||document.documentElement).append(X)})}function C(x){console.log("Deprecated API usage: "+x)}let A;class D{static toDateObject(N){if(!N||typeof N!="string")return null;A||(A=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));let z=A.exec(N);if(!z)return null;let G=parseInt(z[1],10),X=parseInt(z[2],10);X=X>=1&&X<=12?X-1:0;let k=parseInt(z[3],10);k=k>=1&&k<=31?k:1;let B=parseInt(z[4],10);B=B>=0&&B<=23?B:0;let R=parseInt(z[5],10);R=R>=0&&R<=59?R:0;let j=parseInt(z[6],10);j=j>=0&&j<=59?j:0;let $=z[7]||"Z",T=parseInt(z[8],10);T=T>=0&&T<=23?T:0;let U=parseInt(z[9],10)||0;return U=U>=0&&U<=59?U:0,$==="-"?(B+=T,R+=U):$==="+"&&(B-=T,R-=U),new Date(Date.UTC(G,X,k,B,R,j))}}e.PDFDateString=D;function M(x,{scale:N=1,rotation:z=0}){let{width:G,height:X}=x.attributes.style,k=[0,0,parseInt(G),parseInt(X)];return new p({viewBox:k,scale:N,rotation:z})}function I(x){if(x.startsWith("#")){let N=parseInt(x.slice(1),16);return[(N&16711680)>>16,(N&65280)>>8,N&255]}return x.startsWith("rgb(")?x.slice(4,-1).split(",").map(N=>parseInt(N)):x.startsWith("rgba(")?x.slice(5,-1).split(",").map(N=>parseInt(N)).slice(0,3):((0,n.warn)(`Not a valid color format: "${x}"`),[0,0,0])}function O(x){let N=document.createElement("span");N.style.visibility="hidden",document.body.append(N);for(let z of x.keys()){N.style.color=z;let G=window.getComputedStyle(N).color;x.set(z,I(G))}N.remove()}function F(x){let{a:N,b:z,c:G,d:X,e:k,f:B}=x.getTransform();return[N,z,G,X,k,B]}function V(x){let{a:N,b:z,c:G,d:X,e:k,f:B}=x.getTransform().invertSelf();return[N,z,G,X,k,B]}},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BaseStandardFontDataFactory=e.BaseSVGFactory=e.BaseCanvasFactory=e.BaseCMapReaderFactory=void 0;var i=t(1);class n{constructor(){this.constructor===n&&(0,i.unreachable)("Cannot initialize BaseCanvasFactory.")}create(c,d){if(c<=0||d<=0)throw new Error("Invalid canvas size");let h=this._createCanvas(c,d);return{canvas:h,context:h.getContext("2d")}}reset(c,d,h){if(!c.canvas)throw new Error("Canvas is not specified");if(d<=0||h<=0)throw new Error("Invalid canvas size");c.canvas.width=d,c.canvas.height=h}destroy(c){if(!c.canvas)throw new Error("Canvas is not specified");c.canvas.width=0,c.canvas.height=0,c.canvas=null,c.context=null}_createCanvas(c,d){(0,i.unreachable)("Abstract method `_createCanvas` called.")}}e.BaseCanvasFactory=n;class r{constructor({baseUrl:c=null,isCompressed:d=!1}){this.constructor===r&&(0,i.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=c,this.isCompressed=d}fetch(d){return ie(this,arguments,function*({name:c}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!c)throw new Error("CMap name must be specified.");let h=this.baseUrl+c+(this.isCompressed?".bcmap":""),u=this.isCompressed?i.CMapCompressionType.BINARY:i.CMapCompressionType.NONE;return this._fetchData(h,u).catch(p=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${h}`)})})}_fetchData(c,d){(0,i.unreachable)("Abstract method `_fetchData` called.")}}e.BaseCMapReaderFactory=r;class o{constructor({baseUrl:c=null}){this.constructor===o&&(0,i.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=c}fetch(d){return ie(this,arguments,function*({filename:c}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!c)throw new Error("Font filename must be specified.");let h=`${this.baseUrl}${c}`;return this._fetchData(h).catch(u=>{throw new Error(`Unable to load font data at: ${h}`)})})}_fetchData(c){(0,i.unreachable)("Abstract method `_fetchData` called.")}}e.BaseStandardFontDataFactory=o;class a{constructor(){this.constructor===a&&(0,i.unreachable)("Cannot initialize BaseSVGFactory.")}create(c,d,h=!1){if(c<=0||d<=0)throw new Error("Invalid SVG dimensions");let u=this._createSVG("svg:svg");return u.setAttribute("version","1.1"),h||(u.setAttribute("width",`${c}px`),u.setAttribute("height",`${d}px`)),u.setAttribute("preserveAspectRatio","none"),u.setAttribute("viewBox",`0 0 ${c} ${d}`),u}createElement(c){if(typeof c!="string")throw new Error("Invalid SVG element type");return this._createSVG(c)}_createSVG(c){(0,i.unreachable)("Abstract method `_createSVG` called.")}}e.BaseSVGFactory=a},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MurmurHash3_64=void 0;var i=t(1);let n=3285377520,r=4294901760,o=65535;class a{constructor(c){this.h1=c?c&4294967295:n,this.h2=c?c&4294967295:n}update(c){let d,h;if(typeof c=="string"){d=new Uint8Array(c.length*2),h=0;for(let A=0,D=c.length;A<D;A++){let M=c.charCodeAt(A);M<=255?d[h++]=M:(d[h++]=M>>>8,d[h++]=M&255)}}else if((0,i.isArrayBuffer)(c))d=c.slice(),h=d.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");let u=h>>2,p=h-u*4,f=new Uint32Array(d.buffer,0,u),m=0,g=0,b=this.h1,v=this.h2,E=3432918353,y=461845907,w=E&o,C=y&o;for(let A=0;A<u;A++)A&1?(m=f[A],m=m*E&r|m*w&o,m=m<<15|m>>>17,m=m*y&r|m*C&o,b^=m,b=b<<13|b>>>19,b=b*5+3864292196):(g=f[A],g=g*E&r|g*w&o,g=g<<15|g>>>17,g=g*y&r|g*C&o,v^=g,v=v<<13|v>>>19,v=v*5+3864292196);switch(m=0,p){case 3:m^=d[u*4+2]<<16;case 2:m^=d[u*4+1]<<8;case 1:m^=d[u*4],m=m*E&r|m*w&o,m=m<<15|m>>>17,m=m*y&r|m*C&o,u&1?b^=m:v^=m}this.h1=b,this.h2=v}hexdigest(){let c=this.h1,d=this.h2;c^=d>>>1,c=c*3981806797&r|c*36045&o,d=d*4283543511&r|((d<<16|c>>>16)*2950163797&r)>>>16,c^=d>>>1,c=c*444984403&r|c*60499&o,d=d*3301882366&r|((d<<16|c>>>16)*3120437893&r)>>>16,c^=d>>>1;let h=(c>>>0).toString(16),u=(d>>>0).toString(16);return h.padStart(8,"0")+u.padStart(8,"0")}}e.MurmurHash3_64=a},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FontLoader=e.FontFaceObject=void 0;var i=t(1);class n{constructor({docId:l,onUnsupportedFeature:c,ownerDocument:d=globalThis.document,styleElement:h=null}){this.constructor===n&&(0,i.unreachable)("Cannot initialize BaseFontLoader."),this.docId=l,this._onUnsupportedFeature=c,this._document=d,this.nativeFontFaces=[],this.styleElement=null}addNativeFontFace(l){this.nativeFontFaces.push(l),this._document.fonts.add(l)}insertRule(l){let c=this.styleElement;c||(c=this.styleElement=this._document.createElement("style"),c.id=`PDFJS_FONT_STYLE_TAG_${this.docId}`,this._document.documentElement.getElementsByTagName("head")[0].append(c));let d=c.sheet;d.insertRule(l,d.cssRules.length)}clear(){for(let l of this.nativeFontFaces)this._document.fonts.delete(l);this.nativeFontFaces.length=0,this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}bind(l){return ie(this,null,function*(){if(l.attached||l.missingFile)return;if(l.attached=!0,this.isFontLoadingAPISupported){let d=l.createNativeFontFace();if(d){this.addNativeFontFace(d);try{yield d.loaded}catch(h){throw this._onUnsupportedFeature({featureId:i.UNSUPPORTED_FEATURES.errorFontLoadNative}),(0,i.warn)(`Failed to load font '${d.family}': '${h}'.`),l.disableFontFace=!0,h}}return}let c=l.createFontFaceRule();if(c){if(this.insertRule(c),this.isSyncFontLoadingSupported)return;yield new Promise(d=>{let h=this._queueLoadingCallback(d);this._prepareFontLoadEvent([c],[l],h)})}})}_queueLoadingCallback(l){(0,i.unreachable)("Abstract method `_queueLoadingCallback`.")}get isFontLoadingAPISupported(){let l=!!this._document?.fonts;return(0,i.shadow)(this,"isFontLoadingAPISupported",l)}get isSyncFontLoadingSupported(){(0,i.unreachable)("Abstract method `isSyncFontLoadingSupported`.")}get _loadTestFont(){(0,i.unreachable)("Abstract method `_loadTestFont`.")}_prepareFontLoadEvent(l,c,d){(0,i.unreachable)("Abstract method `_prepareFontLoadEvent`.")}}let r;e.FontLoader=r,e.FontLoader=r=class extends n{constructor(l){super(l),this.loadingContext={requests:[],nextRequestId:0},this.loadTestFontId=0}get isSyncFontLoadingSupported(){let l=!1;return(typeof navigator>"u"||/Mozilla\/5.0.*?rv:(\d+).*? Gecko/.exec(navigator.userAgent)?.[1]>=14)&&(l=!0),(0,i.shadow)(this,"isSyncFontLoadingSupported",l)}_queueLoadingCallback(l){function c(){for((0,i.assert)(!h.done,"completeRequest() cannot be called twice."),h.done=!0;d.requests.length>0&&d.requests[0].done;){let u=d.requests.shift();setTimeout(u.callback,0)}}let d=this.loadingContext,h={id:`pdfjs-font-loading-${d.nextRequestId++}`,done:!1,complete:c,callback:l};return d.requests.push(h),h}get _loadTestFont(){let l=function(){return atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==")};return(0,i.shadow)(this,"_loadTestFont",l())}_prepareFontLoadEvent(l,c,d){function h(V,x){return V.charCodeAt(x)<<24|V.charCodeAt(x+1)<<16|V.charCodeAt(x+2)<<8|V.charCodeAt(x+3)&255}function u(V,x,N,z){let G=V.substring(0,x),X=V.substring(x+N);return G+z+X}let p,f,m=this._document.createElement("canvas");m.width=1,m.height=1;let g=m.getContext("2d"),b=0;function v(V,x){if(b++,b>30){(0,i.warn)("Load test font never loaded."),x();return}if(g.font="30px "+V,g.fillText(".",0,20),g.getImageData(0,0,1,1).data[3]>0){x();return}setTimeout(v.bind(null,V,x))}let E=`lt${Date.now()}${this.loadTestFontId++}`,y=this._loadTestFont;y=u(y,976,E.length,E);let C=16,A=1482184792,D=h(y,C);for(p=0,f=E.length-3;p<f;p+=4)D=D-A+h(E,p)|0;p<E.length&&(D=D-A+h(E+"XXX",p)|0),y=u(y,C,4,(0,i.string32)(D));let M=`url(data:font/opentype;base64,${btoa(y)});`,I=`@font-face {font-family:"${E}";src:${M}}`;this.insertRule(I);let O=[];for(let V of c)O.push(V.loadedName);O.push(E);let F=this._document.createElement("div");F.style.visibility="hidden",F.style.width=F.style.height="10px",F.style.position="absolute",F.style.top=F.style.left="0px";for(let V of O){let x=this._document.createElement("span");x.textContent="Hi",x.style.fontFamily=V,F.append(x)}this._document.body.append(F),v(E,()=>{F.remove(),d.complete()})}};class o{constructor(l,{isEvalSupported:c=!0,disableFontFace:d=!1,ignoreErrors:h=!1,onUnsupportedFeature:u,fontRegistry:p=null}){this.compiledGlyphs=Object.create(null);for(let f in l)this[f]=l[f];this.isEvalSupported=c!==!1,this.disableFontFace=d===!0,this.ignoreErrors=h===!0,this._onUnsupportedFeature=u,this.fontRegistry=p}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let l;if(!this.cssFontInfo)l=new FontFace(this.loadedName,this.data,{});else{let c={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(c.style=`oblique ${this.cssFontInfo.italicAngle}deg`),l=new FontFace(this.cssFontInfo.fontFamily,this.data,c)}return this.fontRegistry&&this.fontRegistry.registerFont(this),l}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;let l=(0,i.bytesToString)(this.data),c=`url(data:${this.mimetype};base64,${btoa(l)});`,d;if(!this.cssFontInfo)d=`@font-face {font-family:"${this.loadedName}";src:${c}}`;else{let h=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(h+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),d=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${h}src:${c}}`}return this.fontRegistry&&this.fontRegistry.registerFont(this,c),d}getPathGenerator(l,c){if(this.compiledGlyphs[c]!==void 0)return this.compiledGlyphs[c];let d;try{d=l.get(this.loadedName+"_path_"+c)}catch(h){if(!this.ignoreErrors)throw h;return this._onUnsupportedFeature({featureId:i.UNSUPPORTED_FEATURES.errorFontGetPath}),(0,i.warn)(`getPathGenerator - ignoring character: "${h}".`),this.compiledGlyphs[c]=function(u,p){}}if(this.isEvalSupported&&i.FeatureTest.isEvalSupported){let h=[];for(let u of d){let p=u.args!==void 0?u.args.join(","):"";h.push("c.",u.cmd,"(",p,`);
`)}return this.compiledGlyphs[c]=new Function("c","size",h.join(""))}return this.compiledGlyphs[c]=function(h,u){for(let p of d)p.cmd==="scale"&&(p.args=[u,-u]),h[p.cmd].apply(h,p.args)}}}e.FontFaceObject=o},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CanvasGraphics=void 0;var i=t(8),n=t(1),r=t(13),o=t(14),a=t(3);let l=16,c=100,d=4096,h=15,u=10,p=a.isNodeJS&&typeof Path2D>"u"?-1:1e3,f=16;function m(k,B){if(k._removeMirroring)throw new Error("Context is already forwarding operations.");k.__originalSave=k.save,k.__originalRestore=k.restore,k.__originalRotate=k.rotate,k.__originalScale=k.scale,k.__originalTranslate=k.translate,k.__originalTransform=k.transform,k.__originalSetTransform=k.setTransform,k.__originalResetTransform=k.resetTransform,k.__originalClip=k.clip,k.__originalMoveTo=k.moveTo,k.__originalLineTo=k.lineTo,k.__originalBezierCurveTo=k.bezierCurveTo,k.__originalRect=k.rect,k.__originalClosePath=k.closePath,k.__originalBeginPath=k.beginPath,k._removeMirroring=()=>{k.save=k.__originalSave,k.restore=k.__originalRestore,k.rotate=k.__originalRotate,k.scale=k.__originalScale,k.translate=k.__originalTranslate,k.transform=k.__originalTransform,k.setTransform=k.__originalSetTransform,k.resetTransform=k.__originalResetTransform,k.clip=k.__originalClip,k.moveTo=k.__originalMoveTo,k.lineTo=k.__originalLineTo,k.bezierCurveTo=k.__originalBezierCurveTo,k.rect=k.__originalRect,k.closePath=k.__originalClosePath,k.beginPath=k.__originalBeginPath,delete k._removeMirroring},k.save=function(){B.save(),this.__originalSave()},k.restore=function(){B.restore(),this.__originalRestore()},k.translate=function(j,$){B.translate(j,$),this.__originalTranslate(j,$)},k.scale=function(j,$){B.scale(j,$),this.__originalScale(j,$)},k.transform=function(j,$,T,U,W,Q){B.transform(j,$,T,U,W,Q),this.__originalTransform(j,$,T,U,W,Q)},k.setTransform=function(j,$,T,U,W,Q){B.setTransform(j,$,T,U,W,Q),this.__originalSetTransform(j,$,T,U,W,Q)},k.resetTransform=function(){B.resetTransform(),this.__originalResetTransform()},k.rotate=function(j){B.rotate(j),this.__originalRotate(j)},k.clip=function(j){B.clip(j),this.__originalClip(j)},k.moveTo=function(R,j){B.moveTo(R,j),this.__originalMoveTo(R,j)},k.lineTo=function(R,j){B.lineTo(R,j),this.__originalLineTo(R,j)},k.bezierCurveTo=function(R,j,$,T,U,W){B.bezierCurveTo(R,j,$,T,U,W),this.__originalBezierCurveTo(R,j,$,T,U,W)},k.rect=function(R,j,$,T){B.rect(R,j,$,T),this.__originalRect(R,j,$,T)},k.closePath=function(){B.closePath(),this.__originalClosePath()},k.beginPath=function(){B.beginPath(),this.__originalBeginPath()}}class g{constructor(B){this.canvasFactory=B,this.cache=Object.create(null)}getCanvas(B,R,j){let $;return this.cache[B]!==void 0?($=this.cache[B],this.canvasFactory.reset($,R,j)):($=this.canvasFactory.create(R,j),this.cache[B]=$),$}delete(B){delete this.cache[B]}clear(){for(let B in this.cache){let R=this.cache[B];this.canvasFactory.destroy(R),delete this.cache[B]}}}function b(k,B,R,j,$,T,U,W,Q,te){let[J,oe,pe,de,fe,P]=(0,i.getCurrentTransform)(k);if(oe===0&&pe===0){let K=U*J+fe,ee=Math.round(K),le=W*de+P,xe=Math.round(le),ge=(U+Q)*J+fe,_e=Math.abs(Math.round(ge)-ee)||1,Ue=(W+te)*de+P,ke=Math.abs(Math.round(Ue)-xe)||1;return k.setTransform(Math.sign(J),0,0,Math.sign(de),ee,xe),k.drawImage(B,R,j,$,T,0,0,_e,ke),k.setTransform(J,oe,pe,de,fe,P),[_e,ke]}if(J===0&&de===0){let K=W*pe+fe,ee=Math.round(K),le=U*oe+P,xe=Math.round(le),ge=(W+te)*pe+fe,_e=Math.abs(Math.round(ge)-ee)||1,Ue=(U+Q)*oe+P,ke=Math.abs(Math.round(Ue)-xe)||1;return k.setTransform(0,Math.sign(oe),Math.sign(pe),0,ee,xe),k.drawImage(B,R,j,$,T,0,0,ke,_e),k.setTransform(J,oe,pe,de,fe,P),[ke,_e]}k.drawImage(B,R,j,$,T,U,W,Q,te);let se=Math.hypot(J,oe),re=Math.hypot(pe,de);return[se*Q,re*te]}function v(k){let{width:B,height:R}=k;if(B>p||R>p)return null;let j=1e3,$=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),T=B+1,U=new Uint8Array(T*(R+1)),W,Q,te,J=B+7&-8,oe=new Uint8Array(J*R),pe=0;for(let re of k.data){let K=128;for(;K>0;)oe[pe++]=re&K?0:255,K>>=1}let de=0;for(pe=0,oe[pe]!==0&&(U[0]=1,++de),Q=1;Q<B;Q++)oe[pe]!==oe[pe+1]&&(U[Q]=oe[pe]?2:1,++de),pe++;for(oe[pe]!==0&&(U[Q]=2,++de),W=1;W<R;W++){pe=W*J,te=W*T,oe[pe-J]!==oe[pe]&&(U[te]=oe[pe]?1:8,++de);let re=(oe[pe]?4:0)+(oe[pe-J]?8:0);for(Q=1;Q<B;Q++)re=(re>>2)+(oe[pe+1]?4:0)+(oe[pe-J+1]?8:0),$[re]&&(U[te+Q]=$[re],++de),pe++;if(oe[pe-J]!==oe[pe]&&(U[te+Q]=oe[pe]?2:4,++de),de>j)return null}for(pe=J*(R-1),te=W*T,oe[pe]!==0&&(U[te]=8,++de),Q=1;Q<B;Q++)oe[pe]!==oe[pe+1]&&(U[te+Q]=oe[pe]?4:8,++de),pe++;if(oe[pe]!==0&&(U[te+Q]=4,++de),de>j)return null;let fe=new Int32Array([0,T,-1,0,-T,0,0,0,1]),P=new Path2D;for(W=0;de&&W<=R;W++){let re=W*T,K=re+B;for(;re<K&&!U[re];)re++;if(re===K)continue;P.moveTo(re%T,W);let ee=re,le=U[re];do{let xe=fe[le];do re+=xe;while(!U[re]);let ge=U[re];ge!==5&&ge!==10?(le=ge,U[re]=0):(le=ge&51*le>>4,U[re]&=le>>2|le<<2),P.lineTo(re%T,re/T|0),U[re]||--de}while(ee!==re);--W}return oe=null,U=null,function(re){re.save(),re.scale(1/B,-1/R),re.translate(0,-R),re.fill(P),re.beginPath(),re.restore()}}class E{constructor(B,R){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=n.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=n.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=n.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps=null,this.startNewPathAndClipBox([0,0,B,R])}clone(){let B=Object.create(this);return B.clipBox=this.clipBox.slice(),B}setCurrentPoint(B,R){this.x=B,this.y=R}updatePathMinMax(B,R,j){[R,j]=n.Util.applyTransform([R,j],B),this.minX=Math.min(this.minX,R),this.minY=Math.min(this.minY,j),this.maxX=Math.max(this.maxX,R),this.maxY=Math.max(this.maxY,j)}updateRectMinMax(B,R){let j=n.Util.applyTransform(R,B),$=n.Util.applyTransform(R.slice(2),B);this.minX=Math.min(this.minX,j[0],$[0]),this.minY=Math.min(this.minY,j[1],$[1]),this.maxX=Math.max(this.maxX,j[0],$[0]),this.maxY=Math.max(this.maxY,j[1],$[1])}updateScalingPathMinMax(B,R){n.Util.scaleMinMax(B,R),this.minX=Math.min(this.minX,R[0]),this.maxX=Math.max(this.maxX,R[1]),this.minY=Math.min(this.minY,R[2]),this.maxY=Math.max(this.maxY,R[3])}updateCurvePathMinMax(B,R,j,$,T,U,W,Q,te,J){let oe=n.Util.bezierBoundingBox(R,j,$,T,U,W,Q,te);if(J){J[0]=Math.min(J[0],oe[0],oe[2]),J[1]=Math.max(J[1],oe[0],oe[2]),J[2]=Math.min(J[2],oe[1],oe[3]),J[3]=Math.max(J[3],oe[1],oe[3]);return}this.updateRectMinMax(B,oe)}getPathBoundingBox(B=r.PathType.FILL,R=null){let j=[this.minX,this.minY,this.maxX,this.maxY];if(B===r.PathType.STROKE){R||(0,n.unreachable)("Stroke bounding box must include transform.");let $=n.Util.singularValueDecompose2dScale(R),T=$[0]*this.lineWidth/2,U=$[1]*this.lineWidth/2;j[0]-=T,j[1]-=U,j[2]+=T,j[3]+=U}return j}updateClipFromPath(){let B=n.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(B||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(B){this.clipBox=B,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(B=r.PathType.FILL,R=null){return n.Util.intersect(this.clipBox,this.getPathBoundingBox(B,R))}}function y(k,B,R=null){if(typeof ImageData<"u"&&B instanceof ImageData){k.putImageData(B,0,0);return}let j=B.height,$=B.width,T=j%f,U=(j-T)/f,W=T===0?U:U+1,Q=k.createImageData($,f),te=0,J,oe=B.data,pe=Q.data,de,fe,P,se,re,K,ee,le;if(R)switch(R.length){case 1:re=R[0],K=R[0],ee=R[0],le=R[0];break;case 4:re=R[0],K=R[1],ee=R[2],le=R[3];break}if(B.kind===n.ImageKind.GRAYSCALE_1BPP){let xe=oe.byteLength,ge=new Uint32Array(pe.buffer,0,pe.byteLength>>2),_e=ge.length,Ue=$+7>>3,ke=4294967295,je=n.FeatureTest.isLittleEndian?4278190080:255;for(le&&le[0]===255&&le[255]===0&&([ke,je]=[je,ke]),de=0;de<W;de++){for(P=de<U?f:T,J=0,fe=0;fe<P;fe++){let Qe=xe-te,Et=0,ht=Qe>Ue?$:Qe*8-7,ni=ht&-8,Kt=0,It=0;for(;Et<ni;Et+=8)It=oe[te++],ge[J++]=It&128?ke:je,ge[J++]=It&64?ke:je,ge[J++]=It&32?ke:je,ge[J++]=It&16?ke:je,ge[J++]=It&8?ke:je,ge[J++]=It&4?ke:je,ge[J++]=It&2?ke:je,ge[J++]=It&1?ke:je;for(;Et<ht;Et++)Kt===0&&(It=oe[te++],Kt=128),ge[J++]=It&Kt?ke:je,Kt>>=1}for(;J<_e;)ge[J++]=0;k.putImageData(Q,0,de*f)}}else if(B.kind===n.ImageKind.RGBA_32BPP){let xe=!!(re||K||ee);for(fe=0,se=$*f*4,de=0;de<U;de++){if(pe.set(oe.subarray(te,te+se)),te+=se,xe)for(let ge=0;ge<se;ge+=4)re&&(pe[ge+0]=re[pe[ge+0]]),K&&(pe[ge+1]=K[pe[ge+1]]),ee&&(pe[ge+2]=ee[pe[ge+2]]);k.putImageData(Q,0,fe),fe+=f}if(de<W){if(se=$*T*4,pe.set(oe.subarray(te,te+se)),xe)for(let ge=0;ge<se;ge+=4)re&&(pe[ge+0]=re[pe[ge+0]]),K&&(pe[ge+1]=K[pe[ge+1]]),ee&&(pe[ge+2]=ee[pe[ge+2]]);k.putImageData(Q,0,fe)}}else if(B.kind===n.ImageKind.RGB_24BPP){let xe=!!(re||K||ee);for(P=f,se=$*P,de=0;de<W;de++){for(de>=U&&(P=T,se=$*P),J=0,fe=se;fe--;)pe[J++]=oe[te++],pe[J++]=oe[te++],pe[J++]=oe[te++],pe[J++]=255;if(xe)for(let ge=0;ge<J;ge+=4)re&&(pe[ge+0]=re[pe[ge+0]]),K&&(pe[ge+1]=K[pe[ge+1]]),ee&&(pe[ge+2]=ee[pe[ge+2]]);k.putImageData(Q,0,de*f)}}else throw new Error(`bad image kind: ${B.kind}`)}function w(k,B){if(B.bitmap){k.drawImage(B.bitmap,0,0);return}let R=B.height,j=B.width,$=R%f,T=(R-$)/f,U=$===0?T:T+1,W=k.createImageData(j,f),Q=0,te=B.data,J=W.data;for(let oe=0;oe<U;oe++){let pe=oe<T?f:$;({srcPos:Q}=(0,o.applyMaskImageData)({src:te,srcPos:Q,dest:J,width:j,height:pe})),k.putImageData(W,0,oe*f)}}function C(k,B){let R=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font"];for(let j=0,$=R.length;j<$;j++){let T=R[j];k[T]!==void 0&&(B[T]=k[T])}k.setLineDash!==void 0&&(B.setLineDash(k.getLineDash()),B.lineDashOffset=k.lineDashOffset)}function A(k,B){k.strokeStyle=k.fillStyle=B||"#000000",k.fillRule="nonzero",k.globalAlpha=1,k.lineWidth=1,k.lineCap="butt",k.lineJoin="miter",k.miterLimit=10,k.globalCompositeOperation="source-over",k.font="10px sans-serif",k.setLineDash!==void 0&&(k.setLineDash([]),k.lineDashOffset=0)}function D(k,B,R,j){let $=k.length;for(let T=3;T<$;T+=4){let U=k[T];if(U===0)k[T-3]=B,k[T-2]=R,k[T-1]=j;else if(U<255){let W=255-U;k[T-3]=k[T-3]*U+B*W>>8,k[T-2]=k[T-2]*U+R*W>>8,k[T-1]=k[T-1]*U+j*W>>8}}}function M(k,B,R){let j=k.length,$=1/255;for(let T=3;T<j;T+=4){let U=R?R[k[T]]:k[T];B[T]=B[T]*U*$|0}}function I(k,B,R){let j=k.length;for(let $=3;$<j;$+=4){let T=k[$-3]*77+k[$-2]*152+k[$-1]*28;B[$]=R?B[$]*R[T>>8]>>8:B[$]*T>>16}}function O(k,B,R,j,$,T,U,W,Q,te,J){let oe=!!T,pe=oe?T[0]:0,de=oe?T[1]:0,fe=oe?T[2]:0,P;$==="Luminosity"?P=I:P=M;let re=Math.min(j,Math.ceil(1048576/R));for(let K=0;K<j;K+=re){let ee=Math.min(re,j-K),le=k.getImageData(W-te,K+(Q-J),R,ee),xe=B.getImageData(W,K+Q,R,ee);oe&&D(le.data,pe,de,fe),P(le.data,xe.data,U),B.putImageData(xe,W,K+Q)}}function F(k,B,R,j){let $=j[0],T=j[1],U=j[2]-$,W=j[3]-T;U===0||W===0||(O(B.context,R,U,W,B.subtype,B.backdrop,B.transferMap,$,T,B.offsetX,B.offsetY),k.save(),k.globalAlpha=1,k.globalCompositeOperation="source-over",k.setTransform(1,0,0,1,0,0),k.drawImage(R.canvas,0,0),k.restore())}function V(k,B){let R=n.Util.singularValueDecompose2dScale(k);R[0]=Math.fround(R[0]),R[1]=Math.fround(R[1]);let j=Math.fround((globalThis.devicePixelRatio||1)*i.PixelsPerInch.PDF_TO_CSS_UNITS);return B!==void 0?B:R[0]<=j||R[1]<=j}let x=["butt","round","square"],N=["miter","round","bevel"],z={},G={};class X{constructor(B,R,j,$,T,U,W,Q){this.ctx=B,this.current=new E(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=R,this.objs=j,this.canvasFactory=$,this.imageLayer=T,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=[],this.optionalContentConfig=U,this.cachedCanvases=new g(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=W,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.backgroundColor=Q?.background||null,this.foregroundColor=Q?.foreground||null,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(B,R=null){return typeof B=="string"?B.startsWith("g_")?this.commonObjs.get(B):this.objs.get(B):R}beginDrawing({transform:B,viewport:R,transparency:j=!1,background:$=null}){let T=this.ctx.canvas.width,U=this.ctx.canvas.height,W=$||"#ffffff";if(this.ctx.save(),this.foregroundColor&&this.backgroundColor){this.ctx.fillStyle=this.foregroundColor;let Q=this.foregroundColor=this.ctx.fillStyle;this.ctx.fillStyle=this.backgroundColor;let te=this.backgroundColor=this.ctx.fillStyle,J=!0,oe=W;if(this.ctx.fillStyle=W,oe=this.ctx.fillStyle,J=typeof oe=="string"&&/^#[0-9A-Fa-f]{6}$/.test(oe),Q==="#000000"&&te==="#ffffff"||Q===te||!J)this.foregroundColor=this.backgroundColor=null;else{let[pe,de,fe]=(0,i.getRGB)(oe),P=re=>(re/=255,re<=.03928?re/12.92:((re+.055)/1.055)**2.4),se=Math.round(.2126*P(pe)+.7152*P(de)+.0722*P(fe));this.selectColor=(re,K,ee)=>{let le=.2126*P(re)+.7152*P(K)+.0722*P(ee);return Math.round(le)===se?te:Q}}}if(this.ctx.fillStyle=this.backgroundColor||W,this.ctx.fillRect(0,0,T,U),this.ctx.restore(),j){let Q=this.cachedCanvases.getCanvas("transparent",T,U);this.compositeCtx=this.ctx,this.transparentCanvas=Q.canvas,this.ctx=Q.context,this.ctx.save(),this.ctx.transform(...(0,i.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),A(this.ctx,this.foregroundColor),B&&(this.ctx.transform(...B),this.outputScaleX=B[0],this.outputScaleY=B[0]),this.ctx.transform(...R.transform),this.viewportScale=R.scale,this.baseTransform=(0,i.getCurrentTransform)(this.ctx),this.imageLayer&&((0,i.deprecated)("The `imageLayer` functionality will be removed in the future."),this.imageLayer.beginLayout())}executeOperatorList(B,R,j,$){let T=B.argsArray,U=B.fnArray,W=R||0,Q=T.length;if(Q===W)return W;let te=Q-W>u&&typeof j=="function",J=te?Date.now()+h:0,oe=0,pe=this.commonObjs,de=this.objs,fe;for(;;){if($!==void 0&&W===$.nextBreakPoint)return $.breakIt(W,j),W;if(fe=U[W],fe!==n.OPS.dependency)this[fe].apply(this,T[W]);else for(let P of T[W]){let se=P.startsWith("g_")?pe:de;if(!se.has(P))return se.get(P,j),W}if(W++,W===Q)return W;if(te&&++oe>u){if(Date.now()>J)return j(),W;oe=0}}}#e(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#e(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(let B of this._cachedBitmapsMap.values()){for(let R of B.values())typeof HTMLCanvasElement<"u"&&R instanceof HTMLCanvasElement&&(R.width=R.height=0);B.clear()}this._cachedBitmapsMap.clear(),this.imageLayer&&this.imageLayer.endLayout()}_scaleImage(B,R){let j=B.width,$=B.height,T=Math.max(Math.hypot(R[0],R[1]),1),U=Math.max(Math.hypot(R[2],R[3]),1),W=j,Q=$,te="prescale1",J,oe;for(;T>2&&W>1||U>2&&Q>1;){let pe=W,de=Q;T>2&&W>1&&(pe=Math.ceil(W/2),T/=W/pe),U>2&&Q>1&&(de=Math.ceil(Q/2),U/=Q/de),J=this.cachedCanvases.getCanvas(te,pe,de),oe=J.context,oe.clearRect(0,0,pe,de),oe.drawImage(B,0,0,W,Q,0,0,pe,de),B=J.canvas,W=pe,Q=de,te=te==="prescale1"?"prescale2":"prescale1"}return{img:B,paintWidth:W,paintHeight:Q}}_createMaskCanvas(B){let R=this.ctx,{width:j,height:$}=B,T=this.current.fillColor,U=this.current.patternFill,W=(0,i.getCurrentTransform)(R),Q,te,J,oe;if((B.bitmap||B.data)&&B.count>1){let _e=B.bitmap||B.data.buffer,Ue=W.slice(0,4);te=JSON.stringify(U?Ue:[Ue,T]),Q=this._cachedBitmapsMap.get(_e),Q||(Q=new Map,this._cachedBitmapsMap.set(_e,Q));let ke=Q.get(te);if(ke&&!U){let je=Math.round(Math.min(W[0],W[2])+W[4]),Qe=Math.round(Math.min(W[1],W[3])+W[5]);return{canvas:ke,offsetX:je,offsetY:Qe}}J=ke}J||(oe=this.cachedCanvases.getCanvas("maskCanvas",j,$),w(oe.context,B));let pe=n.Util.transform(W,[1/j,0,0,-1/$,0,0]);pe=n.Util.transform(pe,[1,0,0,1,0,-$]);let de=n.Util.applyTransform([0,0],pe),fe=n.Util.applyTransform([j,$],pe),P=n.Util.normalizeRect([de[0],de[1],fe[0],fe[1]]),se=Math.round(P[2]-P[0])||1,re=Math.round(P[3]-P[1])||1,K=this.cachedCanvases.getCanvas("fillCanvas",se,re),ee=K.context,le=Math.min(de[0],fe[0]),xe=Math.min(de[1],fe[1]);ee.translate(-le,-xe),ee.transform(...pe),J||(J=this._scaleImage(oe.canvas,(0,i.getCurrentTransformInverse)(ee)),J=J.img,Q&&U&&Q.set(te,J)),ee.imageSmoothingEnabled=V((0,i.getCurrentTransform)(ee),B.interpolate),b(ee,J,0,0,J.width,J.height,0,0,j,$),ee.globalCompositeOperation="source-in";let ge=n.Util.transform((0,i.getCurrentTransformInverse)(ee),[1,0,0,1,-le,-xe]);return ee.fillStyle=U?T.getPattern(R,this,ge,r.PathType.FILL):T,ee.fillRect(0,0,j,$),Q&&!U&&(this.cachedCanvases.delete("fillCanvas"),Q.set(te,K.canvas)),{canvas:K.canvas,offsetX:Math.round(le),offsetY:Math.round(xe)}}setLineWidth(B){B!==this.current.lineWidth&&(this._cachedScaleForStroking=null),this.current.lineWidth=B,this.ctx.lineWidth=B}setLineCap(B){this.ctx.lineCap=x[B]}setLineJoin(B){this.ctx.lineJoin=N[B]}setMiterLimit(B){this.ctx.miterLimit=B}setDash(B,R){let j=this.ctx;j.setLineDash!==void 0&&(j.setLineDash(B),j.lineDashOffset=R)}setRenderingIntent(B){}setFlatness(B){}setGState(B){for(let R=0,j=B.length;R<j;R++){let $=B[R],T=$[0],U=$[1];switch(T){case"LW":this.setLineWidth(U);break;case"LC":this.setLineCap(U);break;case"LJ":this.setLineJoin(U);break;case"ML":this.setMiterLimit(U);break;case"D":this.setDash(U[0],U[1]);break;case"RI":this.setRenderingIntent(U);break;case"FL":this.setFlatness(U);break;case"Font":this.setFont(U[0],U[1]);break;case"CA":this.current.strokeAlpha=$[1];break;case"ca":this.current.fillAlpha=$[1],this.ctx.globalAlpha=$[1];break;case"BM":this.ctx.globalCompositeOperation=U;break;case"SMask":this.current.activeSMask=U?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.current.transferMaps=U}}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let B=this.inSMaskMode;this.current.activeSMask&&!B?this.beginSMaskMode():!this.current.activeSMask&&B&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");let B=this.ctx.canvas.width,R=this.ctx.canvas.height,j="smaskGroupAt"+this.groupLevel,$=this.cachedCanvases.getCanvas(j,B,R);this.suspendedCtx=this.ctx,this.ctx=$.context;let T=this.ctx;T.setTransform(...(0,i.getCurrentTransform)(this.suspendedCtx)),C(this.suspendedCtx,T),m(T,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),C(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(B){if(!this.current.activeSMask)return;B?(B[0]=Math.floor(B[0]),B[1]=Math.floor(B[1]),B[2]=Math.ceil(B[2]),B[3]=Math.ceil(B[3])):B=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let R=this.current.activeSMask,j=this.suspendedCtx;F(j,R,this.ctx,B),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(C(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let B=this.current;this.stateStack.push(B),this.current=B.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),C(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null)}transform(B,R,j,$,T,U){this.ctx.transform(B,R,j,$,T,U),this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null}constructPath(B,R,j){let $=this.ctx,T=this.current,U=T.x,W=T.y,Q,te,J=(0,i.getCurrentTransform)($),oe=J[0]===0&&J[3]===0||J[1]===0&&J[2]===0,pe=oe?j.slice(0):null;for(let de=0,fe=0,P=B.length;de<P;de++)switch(B[de]|0){case n.OPS.rectangle:U=R[fe++],W=R[fe++];let se=R[fe++],re=R[fe++],K=U+se,ee=W+re;$.moveTo(U,W),se===0||re===0?$.lineTo(K,ee):($.lineTo(K,W),$.lineTo(K,ee),$.lineTo(U,ee)),oe||T.updateRectMinMax(J,[U,W,K,ee]),$.closePath();break;case n.OPS.moveTo:U=R[fe++],W=R[fe++],$.moveTo(U,W),oe||T.updatePathMinMax(J,U,W);break;case n.OPS.lineTo:U=R[fe++],W=R[fe++],$.lineTo(U,W),oe||T.updatePathMinMax(J,U,W);break;case n.OPS.curveTo:Q=U,te=W,U=R[fe+4],W=R[fe+5],$.bezierCurveTo(R[fe],R[fe+1],R[fe+2],R[fe+3],U,W),T.updateCurvePathMinMax(J,Q,te,R[fe],R[fe+1],R[fe+2],R[fe+3],U,W,pe),fe+=6;break;case n.OPS.curveTo2:Q=U,te=W,$.bezierCurveTo(U,W,R[fe],R[fe+1],R[fe+2],R[fe+3]),T.updateCurvePathMinMax(J,Q,te,U,W,R[fe],R[fe+1],R[fe+2],R[fe+3],pe),U=R[fe+2],W=R[fe+3],fe+=4;break;case n.OPS.curveTo3:Q=U,te=W,U=R[fe+2],W=R[fe+3],$.bezierCurveTo(R[fe],R[fe+1],U,W,U,W),T.updateCurvePathMinMax(J,Q,te,R[fe],R[fe+1],U,W,U,W,pe),fe+=4;break;case n.OPS.closePath:$.closePath();break}oe&&T.updateScalingPathMinMax(J,pe),T.setCurrentPoint(U,W)}closePath(){this.ctx.closePath()}stroke(B){B=typeof B<"u"?B:!0;let R=this.ctx,j=this.current.strokeColor;R.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof j=="object"&&j?.getPattern?(R.save(),R.strokeStyle=j.getPattern(R,this,(0,i.getCurrentTransformInverse)(R),r.PathType.STROKE),this.rescaleAndStroke(!1),R.restore()):this.rescaleAndStroke(!0)),B&&this.consumePath(this.current.getClippedPathBoundingBox()),R.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(B){B=typeof B<"u"?B:!0;let R=this.ctx,j=this.current.fillColor,$=this.current.patternFill,T=!1;$&&(R.save(),R.fillStyle=j.getPattern(R,this,(0,i.getCurrentTransformInverse)(R),r.PathType.FILL),T=!0);let U=this.current.getClippedPathBoundingBox();this.contentVisible&&U!==null&&(this.pendingEOFill?(R.fill("evenodd"),this.pendingEOFill=!1):R.fill()),T&&R.restore(),B&&this.consumePath(U)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=z}eoClip(){this.pendingClip=G}beginText(){this.current.textMatrix=n.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let B=this.pendingTextPaths,R=this.ctx;if(B===void 0){R.beginPath();return}R.save(),R.beginPath();for(let j of B)R.setTransform(...j.transform),R.translate(j.x,j.y),j.addToPath(R,j.fontSize);R.restore(),R.clip(),R.beginPath(),delete this.pendingTextPaths}setCharSpacing(B){this.current.charSpacing=B}setWordSpacing(B){this.current.wordSpacing=B}setHScale(B){this.current.textHScale=B/100}setLeading(B){this.current.leading=-B}setFont(B,R){let j=this.commonObjs.get(B),$=this.current;if(!j)throw new Error(`Can't find font for ${B}`);if($.fontMatrix=j.fontMatrix||n.FONT_IDENTITY_MATRIX,($.fontMatrix[0]===0||$.fontMatrix[3]===0)&&(0,n.warn)("Invalid font matrix for font "+B),R<0?(R=-R,$.fontDirection=-1):$.fontDirection=1,this.current.font=j,this.current.fontSize=R,j.isType3Font)return;let T=j.loadedName||"sans-serif",U="normal";j.black?U="900":j.bold&&(U="bold");let W=j.italic?"italic":"normal",Q=`"${T}", ${j.fallbackName}`,te=R;R<l?te=l:R>c&&(te=c),this.current.fontSizeScale=R/te,this.ctx.font=`${W} ${U} ${te}px ${Q}`}setTextRenderingMode(B){this.current.textRenderingMode=B}setTextRise(B){this.current.textRise=B}moveText(B,R){this.current.x=this.current.lineX+=B,this.current.y=this.current.lineY+=R}setLeadingMoveText(B,R){this.setLeading(-R),this.moveText(B,R)}setTextMatrix(B,R,j,$,T,U){this.current.textMatrix=[B,R,j,$,T,U],this.current.textMatrixScale=Math.hypot(B,R),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(B,R,j,$){let T=this.ctx,U=this.current,W=U.font,Q=U.textRenderingMode,te=U.fontSize/U.fontSizeScale,J=Q&n.TextRenderingMode.FILL_STROKE_MASK,oe=!!(Q&n.TextRenderingMode.ADD_TO_PATH_FLAG),pe=U.patternFill&&!W.missingFile,de;(W.disableFontFace||oe||pe)&&(de=W.getPathGenerator(this.commonObjs,B)),W.disableFontFace||pe?(T.save(),T.translate(R,j),T.beginPath(),de(T,te),$&&T.setTransform(...$),(J===n.TextRenderingMode.FILL||J===n.TextRenderingMode.FILL_STROKE)&&T.fill(),(J===n.TextRenderingMode.STROKE||J===n.TextRenderingMode.FILL_STROKE)&&T.stroke(),T.restore()):((J===n.TextRenderingMode.FILL||J===n.TextRenderingMode.FILL_STROKE)&&T.fillText(B,R,j),(J===n.TextRenderingMode.STROKE||J===n.TextRenderingMode.FILL_STROKE)&&T.strokeText(B,R,j)),oe&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,i.getCurrentTransform)(T),x:R,y:j,fontSize:te,addToPath:de})}get isFontSubpixelAAEnabled(){let{context:B}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);B.scale(1.5,1),B.fillText("I",0,10);let R=B.getImageData(0,0,10,10).data,j=!1;for(let $=3;$<R.length;$+=4)if(R[$]>0&&R[$]<255){j=!0;break}return(0,n.shadow)(this,"isFontSubpixelAAEnabled",j)}showText(B){let R=this.current,j=R.font;if(j.isType3Font)return this.showType3Text(B);let $=R.fontSize;if($===0)return;let T=this.ctx,U=R.fontSizeScale,W=R.charSpacing,Q=R.wordSpacing,te=R.fontDirection,J=R.textHScale*te,oe=B.length,pe=j.vertical,de=pe?1:-1,fe=j.defaultVMetrics,P=$*R.fontMatrix[0],se=R.textRenderingMode===n.TextRenderingMode.FILL&&!j.disableFontFace&&!R.patternFill;T.save(),T.transform(...R.textMatrix),T.translate(R.x,R.y+R.textRise),te>0?T.scale(J,-1):T.scale(J,1);let re;if(R.patternFill){T.save();let ge=R.fillColor.getPattern(T,this,(0,i.getCurrentTransformInverse)(T),r.PathType.FILL);re=(0,i.getCurrentTransform)(T),T.restore(),T.fillStyle=ge}let K=R.lineWidth,ee=R.textMatrixScale;if(ee===0||K===0){let ge=R.textRenderingMode&n.TextRenderingMode.FILL_STROKE_MASK;(ge===n.TextRenderingMode.STROKE||ge===n.TextRenderingMode.FILL_STROKE)&&(K=this.getSinglePixelWidth())}else K/=ee;U!==1&&(T.scale(U,U),K/=U),T.lineWidth=K;let le=0,xe;for(xe=0;xe<oe;++xe){let ge=B[xe];if(typeof ge=="number"){le+=de*ge*$/1e3;continue}let _e=!1,Ue=(ge.isSpace?Q:0)+W,ke=ge.fontChar,je=ge.accent,Qe,Et,ht=ge.width;if(pe){let Kt=ge.vmetric||fe,It=-(ge.vmetric?Kt[1]:ht*.5)*P,ci=Kt[2]*P;ht=Kt?-Kt[0]:ht,Qe=It/U,Et=(le+ci)/U}else Qe=le/U,Et=0;if(j.remeasure&&ht>0){let Kt=T.measureText(ke).width*1e3/$*U;if(ht<Kt&&this.isFontSubpixelAAEnabled){let It=ht/Kt;_e=!0,T.save(),T.scale(It,1),Qe/=It}else ht!==Kt&&(Qe+=(ht-Kt)/2e3*$/U)}if(this.contentVisible&&(ge.isInFont||j.missingFile)){if(se&&!je)T.fillText(ke,Qe,Et);else if(this.paintChar(ke,Qe,Et,re),je){let Kt=Qe+$*je.offset.x/U,It=Et-$*je.offset.y/U;this.paintChar(je.fontChar,Kt,It,re)}}let ni;pe?ni=ht*P-Ue*te:ni=ht*P+Ue*te,le+=ni,_e&&T.restore()}pe?R.y-=le:R.x+=le*J,T.restore(),this.compose()}showType3Text(B){let R=this.ctx,j=this.current,$=j.font,T=j.fontSize,U=j.fontDirection,W=$.vertical?1:-1,Q=j.charSpacing,te=j.wordSpacing,J=j.textHScale*U,oe=j.fontMatrix||n.FONT_IDENTITY_MATRIX,pe=B.length,de=j.textRenderingMode===n.TextRenderingMode.INVISIBLE,fe,P,se,re;if(!(de||T===0)){for(this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,R.save(),R.transform(...j.textMatrix),R.translate(j.x,j.y),R.scale(J,U),fe=0;fe<pe;++fe){if(P=B[fe],typeof P=="number"){re=W*P*T/1e3,this.ctx.translate(re,0),j.x+=re*J;continue}let K=(P.isSpace?te:0)+Q,ee=$.charProcOperatorList[P.operatorListId];if(!ee){(0,n.warn)(`Type3 character "${P.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=P,this.save(),R.scale(T,T),R.transform(...oe),this.executeOperatorList(ee),this.restore()),se=n.Util.applyTransform([P.width,0],oe)[0]*T+K,R.translate(se,0),j.x+=se*J}R.restore(),this.processingType3=null}}setCharWidth(B,R){}setCharWidthAndBounds(B,R,j,$,T,U){this.ctx.rect(j,$,T-j,U-$),this.ctx.clip(),this.endPath()}getColorN_Pattern(B){let R;if(B[0]==="TilingPattern"){let j=B[1],$=this.baseTransform||(0,i.getCurrentTransform)(this.ctx),T={createCanvasGraphics:U=>new X(U,this.commonObjs,this.objs,this.canvasFactory)};R=new r.TilingPattern(B,j,this.ctx,T,$)}else R=this._getPattern(B[1],B[2]);return R}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(B,R,j){let $=this.selectColor?.(B,R,j)||n.Util.makeHexColor(B,R,j);this.ctx.strokeStyle=$,this.current.strokeColor=$}setFillRGBColor(B,R,j){let $=this.selectColor?.(B,R,j)||n.Util.makeHexColor(B,R,j);this.ctx.fillStyle=$,this.current.fillColor=$,this.current.patternFill=!1}_getPattern(B,R=null){let j;return this.cachedPatterns.has(B)?j=this.cachedPatterns.get(B):(j=(0,r.getShadingPattern)(this.objs.get(B)),this.cachedPatterns.set(B,j)),R&&(j.matrix=R),j}shadingFill(B){if(!this.contentVisible)return;let R=this.ctx;this.save();let j=this._getPattern(B);R.fillStyle=j.getPattern(R,this,(0,i.getCurrentTransformInverse)(R),r.PathType.SHADING);let $=(0,i.getCurrentTransformInverse)(R);if($){let T=R.canvas,U=T.width,W=T.height,Q=n.Util.applyTransform([0,0],$),te=n.Util.applyTransform([0,W],$),J=n.Util.applyTransform([U,0],$),oe=n.Util.applyTransform([U,W],$),pe=Math.min(Q[0],te[0],J[0],oe[0]),de=Math.min(Q[1],te[1],J[1],oe[1]),fe=Math.max(Q[0],te[0],J[0],oe[0]),P=Math.max(Q[1],te[1],J[1],oe[1]);this.ctx.fillRect(pe,de,fe-pe,P-de)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,n.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,n.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(B,R){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(B)&&B.length===6&&this.transform(...B),this.baseTransform=(0,i.getCurrentTransform)(this.ctx),R)){let j=R[2]-R[0],$=R[3]-R[1];this.ctx.rect(R[0],R[1],j,$),this.current.updateRectMinMax((0,i.getCurrentTransform)(this.ctx),R),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(B){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let R=this.ctx;B.isolated||(0,n.info)("TODO: Support non-isolated groups."),B.knockout&&(0,n.warn)("Knockout groups not supported.");let j=(0,i.getCurrentTransform)(R);if(B.matrix&&R.transform(...B.matrix),!B.bbox)throw new Error("Bounding box is required.");let $=n.Util.getAxialAlignedBoundingBox(B.bbox,(0,i.getCurrentTransform)(R)),T=[0,0,R.canvas.width,R.canvas.height];$=n.Util.intersect($,T)||[0,0,0,0];let U=Math.floor($[0]),W=Math.floor($[1]),Q=Math.max(Math.ceil($[2])-U,1),te=Math.max(Math.ceil($[3])-W,1),J=1,oe=1;Q>d&&(J=Q/d,Q=d),te>d&&(oe=te/d,te=d),this.current.startNewPathAndClipBox([0,0,Q,te]);let pe="groupAt"+this.groupLevel;B.smask&&(pe+="_smask_"+this.smaskCounter++%2);let de=this.cachedCanvases.getCanvas(pe,Q,te),fe=de.context;fe.scale(1/J,1/oe),fe.translate(-U,-W),fe.transform(...j),B.smask?this.smaskStack.push({canvas:de.canvas,context:fe,offsetX:U,offsetY:W,scaleX:J,scaleY:oe,subtype:B.smask.subtype,backdrop:B.smask.backdrop,transferMap:B.smask.transferMap||null,startTransformInverse:null}):(R.setTransform(1,0,0,1,0,0),R.translate(U,W),R.scale(J,oe),R.save()),C(R,fe),this.ctx=fe,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(R),this.groupLevel++}endGroup(B){if(!this.contentVisible)return;this.groupLevel--;let R=this.ctx,j=this.groupStack.pop();if(this.ctx=j,this.ctx.imageSmoothingEnabled=!1,B.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let $=(0,i.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...$);let T=n.Util.getAxialAlignedBoundingBox([0,0,R.canvas.width,R.canvas.height],$);this.ctx.drawImage(R.canvas,0,0),this.ctx.restore(),this.compose(T)}}beginAnnotation(B,R,j,$,T){if(this.#e(),A(this.ctx,this.foregroundColor),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(R)&&R.length===4){let U=R[2]-R[0],W=R[3]-R[1];if(T&&this.annotationCanvasMap){j=j.slice(),j[4]-=R[0],j[5]-=R[1],R=R.slice(),R[0]=R[1]=0,R[2]=U,R[3]=W;let[Q,te]=n.Util.singularValueDecompose2dScale((0,i.getCurrentTransform)(this.ctx)),{viewportScale:J}=this,oe=Math.ceil(U*this.outputScaleX*J),pe=Math.ceil(W*this.outputScaleY*J);this.annotationCanvas=this.canvasFactory.create(oe,pe);let{canvas:de,context:fe}=this.annotationCanvas;this.annotationCanvasMap.set(B,de),this.annotationCanvas.savedCtx=this.ctx,this.ctx=fe,this.ctx.setTransform(Q,0,0,-te,0,W*te),A(this.ctx,this.foregroundColor)}else A(this.ctx,this.foregroundColor),this.ctx.rect(R[0],R[1],U,W),this.ctx.clip(),this.endPath()}this.current=new E(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...j),this.transform(...$)}endAnnotation(){this.annotationCanvas&&(this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(B){if(!this.contentVisible)return;let R=B.count;B=this.getObject(B.data,B),B.count=R;let j=this.ctx,$=this.processingType3;if($&&($.compiled===void 0&&($.compiled=v(B)),$.compiled)){$.compiled(j);return}let T=this._createMaskCanvas(B),U=T.canvas;j.save(),j.setTransform(1,0,0,1,0,0),j.drawImage(U,T.offsetX,T.offsetY),j.restore(),this.compose()}paintImageMaskXObjectRepeat(B,R,j=0,$=0,T,U){if(!this.contentVisible)return;B=this.getObject(B.data,B);let W=this.ctx;W.save();let Q=(0,i.getCurrentTransform)(W);W.transform(R,j,$,T,0,0);let te=this._createMaskCanvas(B);W.setTransform(1,0,0,1,0,0);for(let J=0,oe=U.length;J<oe;J+=2){let pe=n.Util.transform(Q,[R,j,$,T,U[J],U[J+1]]),[de,fe]=n.Util.applyTransform([0,0],pe);W.drawImage(te.canvas,de,fe)}W.restore(),this.compose()}paintImageMaskXObjectGroup(B){if(!this.contentVisible)return;let R=this.ctx,j=this.current.fillColor,$=this.current.patternFill;for(let T of B){let{data:U,width:W,height:Q,transform:te}=T,J=this.cachedCanvases.getCanvas("maskCanvas",W,Q),oe=J.context;oe.save();let pe=this.getObject(U,T);w(oe,pe),oe.globalCompositeOperation="source-in",oe.fillStyle=$?j.getPattern(oe,this,(0,i.getCurrentTransformInverse)(R),r.PathType.FILL):j,oe.fillRect(0,0,W,Q),oe.restore(),R.save(),R.transform(...te),R.scale(1,-1),b(R,J.canvas,0,0,W,Q,0,-1,1,1),R.restore()}this.compose()}paintImageXObject(B){if(!this.contentVisible)return;let R=this.getObject(B);if(!R){(0,n.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(R)}paintImageXObjectRepeat(B,R,j,$){if(!this.contentVisible)return;let T=this.getObject(B);if(!T){(0,n.warn)("Dependent image isn't ready yet");return}let U=T.width,W=T.height,Q=[];for(let te=0,J=$.length;te<J;te+=2)Q.push({transform:[R,0,0,j,$[te],$[te+1]],x:0,y:0,w:U,h:W});this.paintInlineImageXObjectGroup(T,Q)}paintInlineImageXObject(B){if(!this.contentVisible)return;let R=B.width,j=B.height,$=this.ctx;this.save(),$.scale(1/R,-1/j);let T;if(typeof HTMLElement=="function"&&B instanceof HTMLElement||!B.data)T=B;else{let te=this.cachedCanvases.getCanvas("inlineImage",R,j),J=te.context;y(J,B,this.current.transferMaps),T=te.canvas}let U=this._scaleImage(T,(0,i.getCurrentTransformInverse)($));$.imageSmoothingEnabled=V((0,i.getCurrentTransform)($),B.interpolate);let[W,Q]=b($,U.img,0,0,U.paintWidth,U.paintHeight,0,-j,R,j);if(this.imageLayer){let[te,J]=n.Util.applyTransform([0,-j],(0,i.getCurrentTransform)(this.ctx));this.imageLayer.appendImage({imgData:B,left:te,top:J,width:W,height:Q})}this.compose(),this.restore()}paintInlineImageXObjectGroup(B,R){if(!this.contentVisible)return;let j=this.ctx,$=B.width,T=B.height,U=this.cachedCanvases.getCanvas("inlineImage",$,T),W=U.context;y(W,B,this.current.transferMaps);for(let Q of R){if(j.save(),j.transform(...Q.transform),j.scale(1,-1),b(j,U.canvas,Q.x,Q.y,Q.w,Q.h,0,-1,1,1),this.imageLayer){let[te,J]=n.Util.applyTransform([Q.x,Q.y],(0,i.getCurrentTransform)(this.ctx));this.imageLayer.appendImage({imgData:B,left:te,top:J,width:$,height:T})}j.restore()}this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(B){}markPointProps(B,R){}beginMarkedContent(B){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(B,R){B==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(R)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(B){let R=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(B);let j=this.ctx;this.pendingClip&&(R||(this.pendingClip===G?j.clip("evenodd"):j.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),j.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let B=(0,i.getCurrentTransform)(this.ctx);if(B[1]===0&&B[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(B[0]),Math.abs(B[3]));else{let R=Math.abs(B[0]*B[3]-B[2]*B[1]),j=Math.hypot(B[0],B[2]),$=Math.hypot(B[1],B[3]);this._cachedGetSinglePixelWidth=Math.max(j,$)/R}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(!this._cachedScaleForStroking){let{lineWidth:B}=this.current,R=(0,i.getCurrentTransform)(this.ctx),j,$;if(R[1]===0&&R[2]===0){let T=Math.abs(R[0]),U=Math.abs(R[3]);if(B===0)j=1/T,$=1/U;else{let W=T*B,Q=U*B;j=W<1?1/W:1,$=Q<1?1/Q:1}}else{let T=Math.abs(R[0]*R[3]-R[2]*R[1]),U=Math.hypot(R[0],R[1]),W=Math.hypot(R[2],R[3]);if(B===0)j=W/T,$=U/T;else{let Q=B*T;j=W>Q?W/Q:1,$=U>Q?U/Q:1}}this._cachedScaleForStroking=[j,$]}return this._cachedScaleForStroking}rescaleAndStroke(B){let{ctx:R}=this,{lineWidth:j}=this.current,[$,T]=this.getScaleForStroking();if(R.lineWidth=j||1,$===1&&T===1){R.stroke();return}let U,W,Q;B&&(U=(0,i.getCurrentTransform)(R),W=R.getLineDash().slice(),Q=R.lineDashOffset),R.scale($,T);let te=Math.max($,T);R.setLineDash(R.getLineDash().map(J=>J/te)),R.lineDashOffset/=te,R.stroke(),B&&(R.setTransform(...U),R.setLineDash(W),R.lineDashOffset=Q)}isContentVisible(){for(let B=this.markedContentStack.length-1;B>=0;B--)if(!this.markedContentStack[B].visible)return!1;return!0}}e.CanvasGraphics=X;for(let k in n.OPS)X.prototype[k]!==void 0&&(X.prototype[n.OPS[k]]=X.prototype[k])},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TilingPattern=e.PathType=void 0,e.getShadingPattern=f;var i=t(1),n=t(8),r=t(3);let o={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};e.PathType=o;function a(b,v){if(!v||r.isNodeJS)return;let E=v[2]-v[0],y=v[3]-v[1],w=new Path2D;w.rect(v[0],v[1],E,y),b.clip(w)}class l{constructor(){this.constructor===l&&(0,i.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,i.unreachable)("Abstract method `getPattern` called.")}}class c extends l{constructor(v){super(),this._type=v[1],this._bbox=v[2],this._colorStops=v[3],this._p0=v[4],this._p1=v[5],this._r0=v[6],this._r1=v[7],this.matrix=null}_createGradient(v){let E;this._type==="axial"?E=v.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(E=v.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(let y of this._colorStops)E.addColorStop(y[0],y[1]);return E}getPattern(v,E,y,w){let C;if(w===o.STROKE||w===o.FILL){let A=E.current.getClippedPathBoundingBox(w,(0,n.getCurrentTransform)(v))||[0,0,0,0],D=Math.ceil(A[2]-A[0])||1,M=Math.ceil(A[3]-A[1])||1,I=E.cachedCanvases.getCanvas("pattern",D,M,!0),O=I.context;O.clearRect(0,0,O.canvas.width,O.canvas.height),O.beginPath(),O.rect(0,0,O.canvas.width,O.canvas.height),O.translate(-A[0],-A[1]),y=i.Util.transform(y,[1,0,0,1,A[0],A[1]]),O.transform(...E.baseTransform),this.matrix&&O.transform(...this.matrix),a(O,this._bbox),O.fillStyle=this._createGradient(O),O.fill(),C=v.createPattern(I.canvas,"no-repeat");let F=new DOMMatrix(y);try{C.setTransform(F)}catch(V){(0,i.warn)(`RadialAxialShadingPattern.getPattern: "${V?.message}".`)}}else a(v,this._bbox),C=this._createGradient(v);return C}}function d(b,v,E,y,w,C,A,D){let M=v.coords,I=v.colors,O=b.data,F=b.width*4,V;M[E+1]>M[y+1]&&(V=E,E=y,y=V,V=C,C=A,A=V),M[y+1]>M[w+1]&&(V=y,y=w,w=V,V=A,A=D,D=V),M[E+1]>M[y+1]&&(V=E,E=y,y=V,V=C,C=A,A=V);let x=(M[E]+v.offsetX)*v.scaleX,N=(M[E+1]+v.offsetY)*v.scaleY,z=(M[y]+v.offsetX)*v.scaleX,G=(M[y+1]+v.offsetY)*v.scaleY,X=(M[w]+v.offsetX)*v.scaleX,k=(M[w+1]+v.offsetY)*v.scaleY;if(N>=k)return;let B=I[C],R=I[C+1],j=I[C+2],$=I[A],T=I[A+1],U=I[A+2],W=I[D],Q=I[D+1],te=I[D+2],J=Math.round(N),oe=Math.round(k),pe,de,fe,P,se,re,K,ee;for(let le=J;le<=oe;le++){if(le<G){let ke;le<N?ke=0:ke=(N-le)/(N-G),pe=x-(x-z)*ke,de=B-(B-$)*ke,fe=R-(R-T)*ke,P=j-(j-U)*ke}else{let ke;le>k?ke=1:G===k?ke=0:ke=(G-le)/(G-k),pe=z-(z-X)*ke,de=$-($-W)*ke,fe=T-(T-Q)*ke,P=U-(U-te)*ke}let xe;le<N?xe=0:le>k?xe=1:xe=(N-le)/(N-k),se=x-(x-X)*xe,re=B-(B-W)*xe,K=R-(R-Q)*xe,ee=j-(j-te)*xe;let ge=Math.round(Math.min(pe,se)),_e=Math.round(Math.max(pe,se)),Ue=F*le+ge*4;for(let ke=ge;ke<=_e;ke++)xe=(pe-ke)/(pe-se),xe<0?xe=0:xe>1&&(xe=1),O[Ue++]=de-(de-re)*xe|0,O[Ue++]=fe-(fe-K)*xe|0,O[Ue++]=P-(P-ee)*xe|0,O[Ue++]=255}}function h(b,v,E){let y=v.coords,w=v.colors,C,A;switch(v.type){case"lattice":let D=v.verticesPerRow,M=Math.floor(y.length/D)-1,I=D-1;for(C=0;C<M;C++){let O=C*D;for(let F=0;F<I;F++,O++)d(b,E,y[O],y[O+1],y[O+D],w[O],w[O+1],w[O+D]),d(b,E,y[O+D+1],y[O+1],y[O+D],w[O+D+1],w[O+1],w[O+D])}break;case"triangles":for(C=0,A=y.length;C<A;C+=3)d(b,E,y[C],y[C+1],y[C+2],w[C],w[C+1],w[C+2]);break;default:throw new Error("illegal figure")}}class u extends l{constructor(v){super(),this._coords=v[2],this._colors=v[3],this._figures=v[4],this._bounds=v[5],this._bbox=v[7],this._background=v[8],this.matrix=null}_createMeshCanvas(v,E,y){let D=Math.floor(this._bounds[0]),M=Math.floor(this._bounds[1]),I=Math.ceil(this._bounds[2])-D,O=Math.ceil(this._bounds[3])-M,F=Math.min(Math.ceil(Math.abs(I*v[0]*1.1)),3e3),V=Math.min(Math.ceil(Math.abs(O*v[1]*1.1)),3e3),x=I/F,N=O/V,z={coords:this._coords,colors:this._colors,offsetX:-D,offsetY:-M,scaleX:1/x,scaleY:1/N},G=F+2*2,X=V+2*2,k=y.getCanvas("mesh",G,X,!1),B=k.context,R=B.createImageData(F,V);if(E){let $=R.data;for(let T=0,U=$.length;T<U;T+=4)$[T]=E[0],$[T+1]=E[1],$[T+2]=E[2],$[T+3]=255}for(let $ of this._figures)h(R,$,z);return B.putImageData(R,2,2),{canvas:k.canvas,offsetX:D-2*x,offsetY:M-2*N,scaleX:x,scaleY:N}}getPattern(v,E,y,w){a(v,this._bbox);let C;if(w===o.SHADING)C=i.Util.singularValueDecompose2dScale((0,n.getCurrentTransform)(v));else if(C=i.Util.singularValueDecompose2dScale(E.baseTransform),this.matrix){let D=i.Util.singularValueDecompose2dScale(this.matrix);C=[C[0]*D[0],C[1]*D[1]]}let A=this._createMeshCanvas(C,w===o.SHADING?null:this._background,E.cachedCanvases);return w!==o.SHADING&&(v.setTransform(...E.baseTransform),this.matrix&&v.transform(...this.matrix)),v.translate(A.offsetX,A.offsetY),v.scale(A.scaleX,A.scaleY),v.createPattern(A.canvas,"no-repeat")}}class p extends l{getPattern(){return"hotpink"}}function f(b){switch(b[0]){case"RadialAxial":return new c(b);case"Mesh":return new u(b);case"Dummy":return new p}throw new Error(`Unknown IR type: ${b[0]}`)}let m={COLORED:1,UNCOLORED:2};class g{static get MAX_PATTERN_SIZE(){return(0,i.shadow)(this,"MAX_PATTERN_SIZE",3e3)}constructor(v,E,y,w,C){this.operatorList=v[2],this.matrix=v[3]||[1,0,0,1,0,0],this.bbox=v[4],this.xstep=v[5],this.ystep=v[6],this.paintType=v[7],this.tilingType=v[8],this.color=E,this.ctx=y,this.canvasGraphicsFactory=w,this.baseTransform=C}createPatternCanvas(v){let E=this.operatorList,y=this.bbox,w=this.xstep,C=this.ystep,A=this.paintType,D=this.tilingType,M=this.color,I=this.canvasGraphicsFactory;(0,i.info)("TilingType: "+D);let O=y[0],F=y[1],V=y[2],x=y[3],N=i.Util.singularValueDecompose2dScale(this.matrix),z=i.Util.singularValueDecompose2dScale(this.baseTransform),G=[N[0]*z[0],N[1]*z[1]],X=this.getSizeAndScale(w,this.ctx.canvas.width,G[0]),k=this.getSizeAndScale(C,this.ctx.canvas.height,G[1]),B=v.cachedCanvases.getCanvas("pattern",X.size,k.size,!0),R=B.context,j=I.createCanvasGraphics(R);j.groupLevel=v.groupLevel,this.setFillAndStrokeStyleToContext(j,A,M);let $=O,T=F,U=V,W=x;return O<0&&($=0,U+=Math.abs(O)),F<0&&(T=0,W+=Math.abs(F)),R.translate(-(X.scale*$),-(k.scale*T)),j.transform(X.scale,0,0,k.scale,0,0),R.save(),this.clipBbox(j,$,T,U,W),j.baseTransform=(0,n.getCurrentTransform)(j.ctx),j.executeOperatorList(E),j.endDrawing(),{canvas:B.canvas,scaleX:X.scale,scaleY:k.scale,offsetX:$,offsetY:T}}getSizeAndScale(v,E,y){v=Math.abs(v);let w=Math.max(g.MAX_PATTERN_SIZE,E),C=Math.ceil(v*y);return C>=w?C=w:y=C/v,{scale:y,size:C}}clipBbox(v,E,y,w,C){let A=w-E,D=C-y;v.ctx.rect(E,y,A,D),v.current.updateRectMinMax((0,n.getCurrentTransform)(v.ctx),[E,y,w,C]),v.clip(),v.endPath()}setFillAndStrokeStyleToContext(v,E,y){let w=v.ctx,C=v.current;switch(E){case m.COLORED:let A=this.ctx;w.fillStyle=A.fillStyle,w.strokeStyle=A.strokeStyle,C.fillColor=A.fillStyle,C.strokeColor=A.strokeStyle;break;case m.UNCOLORED:let D=i.Util.makeHexColor(y[0],y[1],y[2]);w.fillStyle=D,w.strokeStyle=D,C.fillColor=D,C.strokeColor=D;break;default:throw new i.FormatError(`Unsupported paint type: ${E}`)}}getPattern(v,E,y,w){let C=y;w!==o.SHADING&&(C=i.Util.transform(C,E.baseTransform),this.matrix&&(C=i.Util.transform(C,this.matrix)));let A=this.createPatternCanvas(E),D=new DOMMatrix(C);D=D.translate(A.offsetX,A.offsetY),D=D.scale(1/A.scaleX,1/A.scaleY);let M=v.createPattern(A.canvas,"repeat");try{M.setTransform(D)}catch(I){(0,i.warn)(`TilingPattern.getPattern: "${I?.message}".`)}return M}}e.TilingPattern=g},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.applyMaskImageData=n;var i=t(1);function n({src:r,srcPos:o=0,dest:a,destPos:l=0,width:c,height:d,inverseDecode:h=!1}){let u=i.FeatureTest.isLittleEndian?4278190080:255,[p,f]=h?[0,u]:[u,0],m=c>>3,g=c&7,b=r.length;a=new Uint32Array(a.buffer);for(let v=0;v<d;v++){for(let y=o+m;o<y;o++){let w=o<b?r[o]:255;a[l++]=w&128?f:p,a[l++]=w&64?f:p,a[l++]=w&32?f:p,a[l++]=w&16?f:p,a[l++]=w&8?f:p,a[l++]=w&4?f:p,a[l++]=w&2?f:p,a[l++]=w&1?f:p}if(g===0)continue;let E=o<b?r[o++]:255;for(let y=0;y<g;y++)a[l++]=E&1<<7-y?f:p}return{srcPos:o,destPos:l}}},(s,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GlobalWorkerOptions=void 0;let t=Object.create(null);e.GlobalWorkerOptions=t,t.workerPort=t.workerPort===void 0?null:t.workerPort,t.workerSrc=t.workerSrc===void 0?"":t.workerSrc},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MessageHandler=void 0;var i=t(1);let n={UNKNOWN:0,DATA:1,ERROR:2},r={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function o(l){switch(l instanceof Error||typeof l=="object"&&l!==null||(0,i.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),l.name){case"AbortException":return new i.AbortException(l.message);case"MissingPDFException":return new i.MissingPDFException(l.message);case"PasswordException":return new i.PasswordException(l.message,l.code);case"UnexpectedResponseException":return new i.UnexpectedResponseException(l.message,l.status);case"UnknownErrorException":return new i.UnknownErrorException(l.message,l.details);default:return new i.UnknownErrorException(l.message,l.toString())}}class a{constructor(c,d,h){this.sourceName=c,this.targetName=d,this.comObj=h,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=u=>{let p=u.data;if(p.targetName!==this.sourceName)return;if(p.stream){this._processStreamMessage(p);return}if(p.callback){let m=p.callbackId,g=this.callbackCapabilities[m];if(!g)throw new Error(`Cannot resolve callback ${m}`);if(delete this.callbackCapabilities[m],p.callback===n.DATA)g.resolve(p.data);else if(p.callback===n.ERROR)g.reject(o(p.reason));else throw new Error("Unexpected callback case");return}let f=this.actionHandler[p.action];if(!f)throw new Error(`Unknown action from worker: ${p.action}`);if(p.callbackId){let m=this.sourceName,g=p.sourceName;new Promise(function(b){b(f(p.data))}).then(function(b){h.postMessage({sourceName:m,targetName:g,callback:n.DATA,callbackId:p.callbackId,data:b})},function(b){h.postMessage({sourceName:m,targetName:g,callback:n.ERROR,callbackId:p.callbackId,reason:o(b)})});return}if(p.streamId){this._createStreamSink(p);return}f(p.data)},h.addEventListener("message",this._onComObjOnMessage)}on(c,d){let h=this.actionHandler;if(h[c])throw new Error(`There is already an actionName called "${c}"`);h[c]=d}send(c,d,h){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:c,data:d},h)}sendWithPromise(c,d,h){let u=this.callbackId++,p=(0,i.createPromiseCapability)();this.callbackCapabilities[u]=p;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:c,callbackId:u,data:d},h)}catch(f){p.reject(f)}return p.promise}sendWithStream(c,d,h,u){let p=this.streamId++,f=this.sourceName,m=this.targetName,g=this.comObj;return new ReadableStream({start:b=>{let v=(0,i.createPromiseCapability)();return this.streamControllers[p]={controller:b,startCall:v,pullCall:null,cancelCall:null,isClosed:!1},g.postMessage({sourceName:f,targetName:m,action:c,streamId:p,data:d,desiredSize:b.desiredSize},u),v.promise},pull:b=>{let v=(0,i.createPromiseCapability)();return this.streamControllers[p].pullCall=v,g.postMessage({sourceName:f,targetName:m,stream:r.PULL,streamId:p,desiredSize:b.desiredSize}),v.promise},cancel:b=>{(0,i.assert)(b instanceof Error,"cancel must have a valid reason");let v=(0,i.createPromiseCapability)();return this.streamControllers[p].cancelCall=v,this.streamControllers[p].isClosed=!0,g.postMessage({sourceName:f,targetName:m,stream:r.CANCEL,streamId:p,reason:o(b)}),v.promise}},h)}_createStreamSink(c){let d=c.streamId,h=this.sourceName,u=c.sourceName,p=this.comObj,f=this,m=this.actionHandler[c.action],g={enqueue(b,v=1,E){if(this.isCancelled)return;let y=this.desiredSize;this.desiredSize-=v,y>0&&this.desiredSize<=0&&(this.sinkCapability=(0,i.createPromiseCapability)(),this.ready=this.sinkCapability.promise),p.postMessage({sourceName:h,targetName:u,stream:r.ENQUEUE,streamId:d,chunk:b},E)},close(){this.isCancelled||(this.isCancelled=!0,p.postMessage({sourceName:h,targetName:u,stream:r.CLOSE,streamId:d}),delete f.streamSinks[d])},error(b){(0,i.assert)(b instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,p.postMessage({sourceName:h,targetName:u,stream:r.ERROR,streamId:d,reason:o(b)}))},sinkCapability:(0,i.createPromiseCapability)(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:c.desiredSize,ready:null};g.sinkCapability.resolve(),g.ready=g.sinkCapability.promise,this.streamSinks[d]=g,new Promise(function(b){b(m(c.data,g))}).then(function(){p.postMessage({sourceName:h,targetName:u,stream:r.START_COMPLETE,streamId:d,success:!0})},function(b){p.postMessage({sourceName:h,targetName:u,stream:r.START_COMPLETE,streamId:d,reason:o(b)})})}_processStreamMessage(c){let d=c.streamId,h=this.sourceName,u=c.sourceName,p=this.comObj,f=this.streamControllers[d],m=this.streamSinks[d];switch(c.stream){case r.START_COMPLETE:c.success?f.startCall.resolve():f.startCall.reject(o(c.reason));break;case r.PULL_COMPLETE:c.success?f.pullCall.resolve():f.pullCall.reject(o(c.reason));break;case r.PULL:if(!m){p.postMessage({sourceName:h,targetName:u,stream:r.PULL_COMPLETE,streamId:d,success:!0});break}m.desiredSize<=0&&c.desiredSize>0&&m.sinkCapability.resolve(),m.desiredSize=c.desiredSize,new Promise(function(g){g(m.onPull&&m.onPull())}).then(function(){p.postMessage({sourceName:h,targetName:u,stream:r.PULL_COMPLETE,streamId:d,success:!0})},function(g){p.postMessage({sourceName:h,targetName:u,stream:r.PULL_COMPLETE,streamId:d,reason:o(g)})});break;case r.ENQUEUE:if((0,i.assert)(f,"enqueue should have stream controller"),f.isClosed)break;f.controller.enqueue(c.chunk);break;case r.CLOSE:if((0,i.assert)(f,"close should have stream controller"),f.isClosed)break;f.isClosed=!0,f.controller.close(),this._deleteStreamController(f,d);break;case r.ERROR:(0,i.assert)(f,"error should have stream controller"),f.controller.error(o(c.reason)),this._deleteStreamController(f,d);break;case r.CANCEL_COMPLETE:c.success?f.cancelCall.resolve():f.cancelCall.reject(o(c.reason)),this._deleteStreamController(f,d);break;case r.CANCEL:if(!m)break;new Promise(function(g){g(m.onCancel&&m.onCancel(o(c.reason)))}).then(function(){p.postMessage({sourceName:h,targetName:u,stream:r.CANCEL_COMPLETE,streamId:d,success:!0})},function(g){p.postMessage({sourceName:h,targetName:u,stream:r.CANCEL_COMPLETE,streamId:d,reason:o(g)})}),m.sinkCapability.reject(o(c.reason)),m.isCancelled=!0,delete this.streamSinks[d];break;default:throw new Error("Unexpected stream case")}}_deleteStreamController(c,d){return ie(this,null,function*(){yield Promise.allSettled([c.startCall&&c.startCall.promise,c.pullCall&&c.pullCall.promise,c.cancelCall&&c.cancelCall.promise]),delete this.streamControllers[d]})}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}e.MessageHandler=a},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Metadata=void 0;var i=t(1);class n{#e;#t;constructor({parsedData:o,rawData:a}){this.#e=o,this.#t=a}getRaw(){return this.#t}get(o){return this.#e.get(o)??null}getAll(){return(0,i.objectFromMap)(this.#e)}has(o){return this.#e.has(o)}}e.Metadata=n},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.OptionalContentConfig=void 0;var i=t(1);let n=Symbol("INTERNAL");class r{#e=!0;constructor(l,c){this.name=l,this.intent=c}get visible(){return this.#e}_setVisible(l,c){l!==n&&(0,i.unreachable)("Internal method `_setVisible` called."),this.#e=c}}class o{#e=!0;#t=new Map;#i=null;#n=null;constructor(l){if(this.name=null,this.creator=null,l!==null){this.name=l.name,this.creator=l.creator,this.#n=l.order;for(let c of l.groups)this.#t.set(c.id,new r(c.name,c.intent));if(l.baseState==="OFF")for(let c of this.#t.values())c._setVisible(n,!1);for(let c of l.on)this.#t.get(c)._setVisible(n,!0);for(let c of l.off)this.#t.get(c)._setVisible(n,!1);this.#i=new Map;for(let[c,d]of this.#t)this.#i.set(c,d.visible)}}#r(l){let c=l.length;if(c<2)return!0;let d=l[0];for(let h=1;h<c;h++){let u=l[h],p;if(Array.isArray(u))p=this.#r(u);else if(this.#t.has(u))p=this.#t.get(u).visible;else return(0,i.warn)(`Optional content group not found: ${u}`),!0;switch(d){case"And":if(!p)return!1;break;case"Or":if(p)return!0;break;case"Not":return!p;default:return!0}}return d==="And"}isVisible(l){if(this.#t.size===0)return!0;if(!l)return(0,i.warn)("Optional content group not defined."),!0;if(l.type==="OCG")return this.#t.has(l.id)?this.#t.get(l.id).visible:((0,i.warn)(`Optional content group not found: ${l.id}`),!0);if(l.type==="OCMD"){if(l.expression)return this.#r(l.expression);if(!l.policy||l.policy==="AnyOn"){for(let c of l.ids){if(!this.#t.has(c))return(0,i.warn)(`Optional content group not found: ${c}`),!0;if(this.#t.get(c).visible)return!0}return!1}else if(l.policy==="AllOn"){for(let c of l.ids){if(!this.#t.has(c))return(0,i.warn)(`Optional content group not found: ${c}`),!0;if(!this.#t.get(c).visible)return!1}return!0}else if(l.policy==="AnyOff"){for(let c of l.ids){if(!this.#t.has(c))return(0,i.warn)(`Optional content group not found: ${c}`),!0;if(!this.#t.get(c).visible)return!0}return!1}else if(l.policy==="AllOff"){for(let c of l.ids){if(!this.#t.has(c))return(0,i.warn)(`Optional content group not found: ${c}`),!0;if(this.#t.get(c).visible)return!1}return!0}return(0,i.warn)(`Unknown optional content policy ${l.policy}.`),!0}return(0,i.warn)(`Unknown group type ${l.type}.`),!0}setVisibility(l,c=!0){if(!this.#t.has(l)){(0,i.warn)(`Optional content group not found: ${l}`);return}this.#t.get(l)._setVisible(n,!!c),this.#e=null}get hasInitialVisibility(){if(this.#e!==null)return this.#e;for(let[l,c]of this.#t){let d=this.#i.get(l);if(c.visible!==d)return this.#e=!1}return this.#e=!0}getOrder(){return this.#t.size?this.#n?this.#n.slice():[...this.#t.keys()]:null}getGroups(){return this.#t.size>0?(0,i.objectFromMap)(this.#t):null}getGroup(l){return this.#t.get(l)||null}}e.OptionalContentConfig=o},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFDataTransportStream=void 0;var i=t(1),n=t(8);class r{constructor(c,d){(0,i.assert)(d,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=c.progressiveDone||!1,this._contentDispositionFilename=c.contentDispositionFilename||null;let h=c.initialData;if(h?.length>0){let u=new Uint8Array(h).buffer;this._queuedChunks.push(u)}this._pdfDataRangeTransport=d,this._isStreamingSupported=!c.disableStream,this._isRangeSupported=!c.disableRange,this._contentLength=c.length,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((u,p)=>{this._onReceiveData({begin:u,chunk:p})}),this._pdfDataRangeTransport.addProgressListener((u,p)=>{this._onProgress({loaded:u,total:p})}),this._pdfDataRangeTransport.addProgressiveReadListener(u=>{this._onReceiveData({chunk:u})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData(c){let d=new Uint8Array(c.chunk).buffer;if(c.begin===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(d):this._queuedChunks.push(d);else{let h=this._rangeReaders.some(function(u){return u._begin!==c.begin?!1:(u._enqueue(d),!0)});(0,i.assert)(h,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(c){if(c.total===void 0){let d=this._rangeReaders[0];d?.onProgress&&d.onProgress({loaded:c.loaded})}else{let d=this._fullRequestReader;d?.onProgress&&d.onProgress({loaded:c.loaded,total:c.total})}}_onProgressiveDone(){this._fullRequestReader&&this._fullRequestReader.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(c){let d=this._rangeReaders.indexOf(c);d>=0&&this._rangeReaders.splice(d,1)}getFullReader(){(0,i.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let c=this._queuedChunks;return this._queuedChunks=null,new o(this,c,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(c,d){if(d<=this._progressiveDataLength)return null;let h=new a(this,c,d);return this._pdfDataRangeTransport.requestDataRange(c,d),this._rangeReaders.push(h),h}cancelAllRequests(c){this._fullRequestReader&&this._fullRequestReader.cancel(c);for(let d of this._rangeReaders.slice(0))d.cancel(c);this._pdfDataRangeTransport.abort()}}e.PDFDataTransportStream=r;class o{constructor(c,d,h=!1,u=null){this._stream=c,this._done=h||!1,this._filename=(0,n.isPdfFile)(u)?u:null,this._queuedChunks=d||[],this._loaded=0;for(let p of this._queuedChunks)this._loaded+=p.byteLength;this._requests=[],this._headersReady=Promise.resolve(),c._fullRequestReader=this,this.onProgress=null}_enqueue(c){this._done||(this._requests.length>0?this._requests.shift().resolve({value:c,done:!1}):this._queuedChunks.push(c),this._loaded+=c.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}read(){return ie(this,null,function*(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let c=(0,i.createPromiseCapability)();return this._requests.push(c),c.promise})}cancel(c){this._done=!0;for(let d of this._requests)d.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class a{constructor(c,d,h){this._stream=c,this._begin=d,this._end=h,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(c){if(!this._done){if(this._requests.length===0)this._queuedChunk=c;else{this._requests.shift().resolve({value:c,done:!1});for(let h of this._requests)h.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}read(){return ie(this,null,function*(){if(this._queuedChunk){let d=this._queuedChunk;return this._queuedChunk=null,{value:d,done:!1}}if(this._done)return{value:void 0,done:!0};let c=(0,i.createPromiseCapability)();return this._requests.push(c),c.promise})}cancel(c){this._done=!0;for(let d of this._requests)d.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(s,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.XfaText=void 0;class t{static textContent(n){let r=[],o={items:r,styles:Object.create(null)};function a(l){if(!l)return;let c=null,d=l.name;if(d==="#text")c=l.value;else if(t.shouldBuildText(d))l?.attributes?.textContent?c=l.attributes.textContent:l.value&&(c=l.value);else return;if(c!==null&&r.push({str:c}),!!l.children)for(let h of l.children)a(h)}return a(n),o}static shouldBuildText(n){return!(n==="textarea"||n==="input"||n==="option"||n==="select")}}e.XfaText=t},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.NodeStandardFontDataFactory=e.NodeCanvasFactory=e.NodeCMapReaderFactory=void 0;var i=t(9);let n=function(l){return new Promise((c,d)=>{r_().readFile(l,(u,p)=>{if(u||!p){d(new Error(u));return}c(new Uint8Array(p))})})};class r extends i.BaseCanvasFactory{_createCanvas(c,d){return kO().createCanvas(c,d)}}e.NodeCanvasFactory=r;class o extends i.BaseCMapReaderFactory{_fetchData(c,d){return n(c).then(h=>({cMapData:h,compressionType:d}))}}e.NodeCMapReaderFactory=o;class a extends i.BaseStandardFontDataFactory{_fetchData(c){return n(c)}}e.NodeStandardFontDataFactory=a},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationEditorLayer=void 0;var i=t(7),n=t(1),r=t(23),o=t(24);let a=(()=>{class l{#e;#t=!1;#i=this.pointerup.bind(this);#n=this.pointerdown.bind(this);#r=new Map;#c=!1;#a=!1;#s;static _initialized=!1;constructor(d){l._initialized||(l._initialized=!0,r.FreeTextEditor.initialize(d.l10n),o.InkEditor.initialize(d.l10n),d.uiManager.registerEditorTypes([r.FreeTextEditor,o.InkEditor])),this.#s=d.uiManager,this.annotationStorage=d.annotationStorage,this.pageIndex=d.pageIndex,this.div=d.div,this.#e=d.accessibilityManager,this.#s.addLayer(this)}updateToolbar(d){this.#s.updateToolbar(d)}updateMode(d=this.#s.getMode()){this.#o(),d===n.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),this.#s.unselectAll()}addInkEditorIfNeeded(d){if(!d&&this.#s.getMode()!==n.AnnotationEditorType.INK)return;if(!d){for(let u of this.#r.values())if(u.isEmpty()){u.setInBackground();return}}this.#l({offsetX:0,offsetY:0}).setInBackground()}setEditingState(d){this.#s.setEditingState(d)}addCommands(d){this.#s.addCommands(d)}enable(){this.div.style.pointerEvents="auto";for(let d of this.#r.values())d.enableEditing()}disable(){this.div.style.pointerEvents="none";for(let d of this.#r.values())d.disableEditing()}setActiveEditor(d){this.#s.getActive()!==d&&this.#s.setActiveEditor(d)}enableClick(){this.div.addEventListener("pointerdown",this.#n),this.div.addEventListener("pointerup",this.#i)}disableClick(){this.div.removeEventListener("pointerdown",this.#n),this.div.removeEventListener("pointerup",this.#i)}attach(d){this.#r.set(d.id,d)}detach(d){this.#r.delete(d.id),this.#e?.removePointerInTextLayer(d.contentDiv)}remove(d){this.#s.removeEditor(d),this.detach(d),this.annotationStorage.remove(d.id),d.div.style.display="none",setTimeout(()=>{d.div.style.display="",d.div.remove(),d.isAttachedToDOM=!1,document.activeElement===document.body&&this.#s.focusMainContainer()},0),this.#a||this.addInkEditorIfNeeded(!1)}#u(d){d.parent!==this&&(this.attach(d),d.pageIndex=this.pageIndex,d.parent?.detach(d),d.parent=this,d.div&&d.isAttachedToDOM&&(d.div.remove(),this.div.append(d.div)))}add(d){if(this.#u(d),this.#s.addEditor(d),this.attach(d),!d.isAttachedToDOM){let h=d.render();this.div.append(h),d.isAttachedToDOM=!0}this.moveEditorInDOM(d),d.onceAdded(),this.addToAnnotationStorage(d)}moveEditorInDOM(d){this.#e?.moveElementInDOM(this.div,d.div,d.contentDiv,!0)}addToAnnotationStorage(d){!d.isEmpty()&&!this.annotationStorage.has(d.id)&&this.annotationStorage.setValue(d.id,d)}addOrRebuild(d){d.needsToBeRebuilt()?d.rebuild():this.add(d)}addANewEditor(d){let h=()=>{this.addOrRebuild(d)},u=()=>{d.remove()};this.addCommands({cmd:h,undo:u,mustExec:!0})}addUndoableEditor(d){let h=()=>{this.addOrRebuild(d)},u=()=>{d.remove()};this.addCommands({cmd:h,undo:u,mustExec:!1})}getNextId(){return this.#s.getId()}#h(d){switch(this.#s.getMode()){case n.AnnotationEditorType.FREETEXT:return new r.FreeTextEditor(d);case n.AnnotationEditorType.INK:return new o.InkEditor(d)}return null}deserialize(d){switch(d.annotationType){case n.AnnotationEditorType.FREETEXT:return r.FreeTextEditor.deserialize(d,this);case n.AnnotationEditorType.INK:return o.InkEditor.deserialize(d,this)}return null}#l(d){let h=this.getNextId(),u=this.#h({parent:this,id:h,x:d.offsetX,y:d.offsetY});return u&&this.add(u),u}setSelected(d){this.#s.setSelected(d)}toggleSelected(d){this.#s.toggleSelected(d)}isSelected(d){return this.#s.isSelected(d)}unselect(d){this.#s.unselect(d)}pointerup(d){let h=i.KeyboardManager.platform.isMac;if(!(d.button!==0||d.ctrlKey&&h)&&d.target===this.div&&this.#c){if(this.#c=!1,!this.#t){this.#t=!0;return}this.#l(d)}}pointerdown(d){let h=i.KeyboardManager.platform.isMac;if(d.button!==0||d.ctrlKey&&h||d.target!==this.div)return;this.#c=!0;let u=this.#s.getActive();this.#t=!u||u.isEmpty()}drop(d){let h=d.dataTransfer.getData("text/plain"),u=this.#s.getEditor(h);if(!u)return;d.preventDefault(),d.dataTransfer.dropEffect="move",this.#u(u);let p=this.div.getBoundingClientRect(),f=d.clientX-p.x,m=d.clientY-p.y;u.translate(f-u.startX,m-u.startY),this.moveEditorInDOM(u),u.div.focus()}dragover(d){d.preventDefault()}destroy(){this.#s.getActive()?.parent===this&&this.#s.setActiveEditor(null);for(let d of this.#r.values())this.#e?.removePointerInTextLayer(d.contentDiv),d.isAttachedToDOM=!1,d.div.remove(),d.parent=null;this.div=null,this.#r.clear(),this.#s.removeLayer(this)}#o(){this.#a=!0;for(let d of this.#r.values())d.isEmpty()&&d.remove();this.#a=!1}render(d){this.viewport=d.viewport,(0,i.bindEvents)(this,this.div,["dragover","drop"]),this.setDimensions();for(let h of this.#s.getEditors(this.pageIndex))this.add(h);this.updateMode()}update(d){this.viewport=d.viewport,this.setDimensions(),this.updateMode()}get scaleFactor(){return this.viewport.scale}get pageDimensions(){let[d,h,u,p]=this.viewport.viewBox,f=u-d,m=p-h;return[f,m]}get viewportBaseDimensions(){let{width:d,height:h,rotation:u}=this.viewport;return u%180===0?[d,h]:[h,d]}setDimensions(){let{width:d,height:h,rotation:u}=this.viewport,p=u%180!==0,f=Math.floor(d)+"px",m=Math.floor(h)+"px";this.div.style.width=p?m:f,this.div.style.height=p?f:m,this.div.setAttribute("data-main-rotation",u)}}return l})();e.AnnotationEditorLayer=a},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FreeTextEditor=void 0;var i=t(1),n=t(7),r=t(6);class o extends r.AnnotationEditor{#e=this.editorDivBlur.bind(this);#t=this.editorDivFocus.bind(this);#i=this.editorDivKeydown.bind(this);#n;#r="";#c=!1;#a;static _freeTextDefaultContent="";static _l10nPromise;static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static _keyboardManager=new n.KeyboardManager([[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],o.prototype.commitOrRemove]]);static _type="freetext";constructor(l){super(yt(Se({},l),{name:"freeTextEditor"})),this.#n=l.color||o._defaultColor||r.AnnotationEditor._defaultLineColor,this.#a=l.fontSize||o._defaultFontSize}static initialize(l){this._l10nPromise=new Map(["free_text_default_content","editor_free_text_aria_label"].map(d=>[d,l.get(d)]));let c=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(c.getPropertyValue("--freetext-padding"))}static updateDefaultParams(l,c){switch(l){case i.AnnotationEditorParamsType.FREETEXT_SIZE:o._defaultFontSize=c;break;case i.AnnotationEditorParamsType.FREETEXT_COLOR:o._defaultColor=c;break}}updateParams(l,c){switch(l){case i.AnnotationEditorParamsType.FREETEXT_SIZE:this.#s(c);break;case i.AnnotationEditorParamsType.FREETEXT_COLOR:this.#u(c);break}}static get defaultPropertiesToUpdate(){return[[i.AnnotationEditorParamsType.FREETEXT_SIZE,o._defaultFontSize],[i.AnnotationEditorParamsType.FREETEXT_COLOR,o._defaultColor||r.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[i.AnnotationEditorParamsType.FREETEXT_SIZE,this.#a],[i.AnnotationEditorParamsType.FREETEXT_COLOR,this.#n]]}#s(l){let c=h=>{this.editorDiv.style.fontSize=`calc(${h}px * var(--scale-factor))`,this.translate(0,-(h-this.#a)*this.parent.scaleFactor),this.#a=h,this.#l()},d=this.#a;this.parent.addCommands({cmd:()=>{c(l)},undo:()=>{c(d)},mustExec:!0,type:i.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#u(l){let c=this.#n;this.parent.addCommands({cmd:()=>{this.#n=l,this.editorDiv.style.color=l},undo:()=>{this.#n=c,this.editorDiv.style.color=c},mustExec:!0,type:i.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}getInitialTranslation(){return[-o._internalPadding*this.parent.scaleFactor,-(o._internalPadding+this.#a)*this.parent.scaleFactor]}rebuild(){super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(i.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.enableEditing(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this.div.draggable=!1,this.editorDiv.addEventListener("keydown",this.#i),this.editorDiv.addEventListener("focus",this.#t),this.editorDiv.addEventListener("blur",this.#e))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.disableEditing(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.draggable=!0,this.editorDiv.removeEventListener("keydown",this.#i),this.editorDiv.removeEventListener("focus",this.#t),this.editorDiv.removeEventListener("blur",this.#e),this.div.focus(),this.isEditing=!1)}focusin(l){super.focusin(l),l.target!==this.editorDiv&&this.editorDiv.focus()}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus())}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent.setEditingState(!0),super.remove()}#h(){let l=this.editorDiv.getElementsByTagName("div");if(l.length===0)return this.editorDiv.innerText;let c=[];for(let d=0,h=l.length;d<h;d++){let p=l[d].firstChild;p?.nodeName==="#text"?c.push(p.data):c.push("")}return c.join(`
`)}#l(){let[l,c]=this.parent.viewportBaseDimensions,d=this.div.getBoundingClientRect();this.width=d.width/l,this.height=d.height/c}commit(){super.commit(),this.#c||(this.#c=!0,this.parent.addUndoableEditor(this)),this.disableEditMode(),this.#r=this.#h().trimEnd(),this.#l()}shouldGetKeyboardEvents(){return this.isInEditMode()}dblclick(l){this.enableEditMode(),this.editorDiv.focus()}keydown(l){l.target===this.div&&l.key==="Enter"&&(this.enableEditMode(),this.editorDiv.focus())}editorDivKeydown(l){o._keyboardManager.exec(this,l)}editorDivFocus(l){this.isEditing=!0}editorDivBlur(l){this.isEditing=!1}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let l,c;this.width&&(l=this.x,c=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",`${this.id}-editor`),this.enableEditing(),o._l10nPromise.get("editor_free_text_aria_label").then(h=>this.editorDiv?.setAttribute("aria-label",h)),o._l10nPromise.get("free_text_default_content").then(h=>this.editorDiv?.setAttribute("default-content",h)),this.editorDiv.contentEditable=!0;let{style:d}=this.editorDiv;if(d.fontSize=`calc(${this.#a}px * var(--scale-factor))`,d.color=this.#n,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,n.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){let[h,u]=this.parent.viewportBaseDimensions;this.setAt(l*h,c*u,this.width*h,this.height*u);for(let p of this.#r.split(`
`)){let f=document.createElement("div");f.append(p?document.createTextNode(p):document.createElement("br")),this.editorDiv.append(f)}this.div.draggable=!0,this.editorDiv.contentEditable=!1}else this.div.draggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(l,c){let d=super.deserialize(l,c);return d.#a=l.fontSize,d.#n=i.Util.makeHexColor(...l.color),d.#r=l.value,d}serialize(){if(this.isEmpty())return null;let l=o._internalPadding*this.parent.scaleFactor,c=this.getRect(l,l),d=r.AnnotationEditor._colorManager.convert(getComputedStyle(this.editorDiv).color);return{annotationType:i.AnnotationEditorType.FREETEXT,color:d,fontSize:this.#a,value:this.#r,pageIndex:this.parent.pageIndex,rect:c,rotation:this.rotation}}}e.FreeTextEditor=o},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.InkEditor=void 0,Object.defineProperty(e,"fitCurve",{enumerable:!0,get:function(){return r.fitCurve}});var i=t(1),n=t(6),r=t(25),o=t(7);let a=16,l=(()=>{class c extends n.AnnotationEditor{#e=0;#t=0;#i=0;#n=this.canvasPointermove.bind(this);#r=this.canvasPointerleave.bind(this);#c=this.canvasPointerup.bind(this);#a=this.canvasPointerdown.bind(this);#s=!1;#u=!1;#h=null;#l=null;#o=0;#f=0;#p=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _l10nPromise;static _type="ink";constructor(h){super(yt(Se({},h),{name:"inkEditor"})),this.color=h.color||null,this.thickness=h.thickness||null,this.opacity=h.opacity||null,this.paths=[],this.bezierPath2D=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0}static initialize(h){this._l10nPromise=new Map(["editor_ink_canvas_aria_label","editor_ink_aria_label"].map(u=>[u,h.get(u)]))}static updateDefaultParams(h,u){switch(h){case i.AnnotationEditorParamsType.INK_THICKNESS:c._defaultThickness=u;break;case i.AnnotationEditorParamsType.INK_COLOR:c._defaultColor=u;break;case i.AnnotationEditorParamsType.INK_OPACITY:c._defaultOpacity=u/100;break}}updateParams(h,u){switch(h){case i.AnnotationEditorParamsType.INK_THICKNESS:this.#v(u);break;case i.AnnotationEditorParamsType.INK_COLOR:this.#g(u);break;case i.AnnotationEditorParamsType.INK_OPACITY:this.#b(u);break}}static get defaultPropertiesToUpdate(){return[[i.AnnotationEditorParamsType.INK_THICKNESS,c._defaultThickness],[i.AnnotationEditorParamsType.INK_COLOR,c._defaultColor||n.AnnotationEditor._defaultLineColor],[i.AnnotationEditorParamsType.INK_OPACITY,Math.round(c._defaultOpacity*100)]]}get propertiesToUpdate(){return[[i.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||c._defaultThickness],[i.AnnotationEditorParamsType.INK_COLOR,this.color||c._defaultColor||n.AnnotationEditor._defaultLineColor],[i.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??c._defaultOpacity))]]}#v(h){let u=this.thickness;this.parent.addCommands({cmd:()=>{this.thickness=h,this.#A()},undo:()=>{this.thickness=u,this.#A()},mustExec:!0,type:i.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#g(h){let u=this.color;this.parent.addCommands({cmd:()=>{this.color=h,this.#m()},undo:()=>{this.color=u,this.#m()},mustExec:!0,type:i.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#b(h){h/=100;let u=this.opacity;this.parent.addCommands({cmd:()=>{this.opacity=h,this.#m()},undo:()=>{this.opacity=u,this.#m()},mustExec:!0,type:i.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){super.rebuild(),this.div!==null&&(this.canvas||(this.#y(),this.#w()),this.isAttachedToDOM||(this.parent.add(this),this.#S()),this.#A())}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#l.disconnect(),this.#l=null,super.remove())}enableEditMode(){this.#s||this.canvas===null||(super.enableEditMode(),this.div.draggable=!1,this.canvas.addEventListener("pointerdown",this.#a),this.canvas.addEventListener("pointerup",this.#c))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this.div.draggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",this.#a),this.canvas.removeEventListener("pointerup",this.#c))}onceAdded(){this.div.draggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}#E(){let{width:h,height:u,rotation:p}=this.parent.viewport;switch(p){case 90:return[0,h,h,u];case 180:return[h,u,h,u];case 270:return[u,0,h,u];default:return[0,0,h,u]}}#_(){this.ctx.lineWidth=this.thickness*this.parent.scaleFactor/this.scaleFactor,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.miterLimit=10,this.ctx.strokeStyle=`${this.color}${(0,o.opacityToHex)(this.opacity)}`}#d(h,u){this.isEditing=!0,this.#u||(this.#u=!0,this.#S(),this.thickness||=c._defaultThickness,this.color||=c._defaultColor||n.AnnotationEditor._defaultLineColor,this.opacity??=c._defaultOpacity),this.currentPath.push([h,u]),this.#h=null,this.#_(),this.ctx.beginPath(),this.ctx.moveTo(h,u),this.#p=()=>{this.#p&&(this.#h&&(this.isEmpty()?(this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)):this.#m(),this.ctx.lineTo(...this.#h),this.#h=null,this.ctx.stroke()),window.requestAnimationFrame(this.#p))},window.requestAnimationFrame(this.#p)}#C(h,u){let[p,f]=this.currentPath.at(-1);h===p&&u===f||(this.currentPath.push([h,u]),this.#h=[h,u])}#I(h,u){this.ctx.closePath(),this.#p=null,h=Math.min(Math.max(h,0),this.canvas.width),u=Math.min(Math.max(u,0),this.canvas.height);let[p,f]=this.currentPath.at(-1);(h!==p||u!==f)&&this.currentPath.push([h,u]);let m;if(this.currentPath.length!==1)m=(0,r.fitCurve)(this.currentPath,30,null);else{let E=[h,u];m=[[E,E.slice(),E.slice(),E]]}let g=c.#M(m);this.currentPath.length=0;let b=()=>{this.paths.push(m),this.bezierPath2D.push(g),this.rebuild()},v=()=>{this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(this.#y(),this.#w()),this.#A())};this.parent.addCommands({cmd:b,undo:v,mustExec:!0})}#m(){if(this.isEmpty()){this.#T();return}this.#_();let{canvas:h,ctx:u}=this;u.setTransform(1,0,0,1,0,0),u.clearRect(0,0,h.width,h.height),this.#T();for(let p of this.bezierPath2D)u.stroke(p)}commit(){this.#s||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#s=!0,this.div.classList.add("disabled"),this.#A(!0),this.parent.addInkEditorIfNeeded(!0),this.parent.moveEditorInDOM(this),this.div.focus())}focusin(h){super.focusin(h),this.enableEditMode()}canvasPointerdown(h){h.button!==0||!this.isInEditMode()||this.#s||(this.setInForeground(),h.type!=="mouse"&&this.div.focus(),h.stopPropagation(),this.canvas.addEventListener("pointerleave",this.#r),this.canvas.addEventListener("pointermove",this.#n),this.#d(h.offsetX,h.offsetY))}canvasPointermove(h){h.stopPropagation(),this.#C(h.offsetX,h.offsetY)}canvasPointerup(h){h.button===0&&this.isInEditMode()&&this.currentPath.length!==0&&(h.stopPropagation(),this.#x(h),this.setInBackground())}canvasPointerleave(h){this.#x(h),this.setInBackground()}#x(h){this.#I(h.offsetX,h.offsetY),this.canvas.removeEventListener("pointerleave",this.#r),this.canvas.removeEventListener("pointermove",this.#n),this.parent.addToAnnotationStorage(this)}#y(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",c._l10nPromise.get("editor_ink_canvas_aria_label").then(h=>this.canvas?.setAttribute("aria-label",h)),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#w(){this.#l=new ResizeObserver(h=>{let u=h[0].contentRect;u.width&&u.height&&this.setDimensions(u.width,u.height)}),this.#l.observe(this.div)}render(){if(this.div)return this.div;let h,u;this.width&&(h=this.x,u=this.y),super.render(),c._l10nPromise.get("editor_ink_aria_label").then(b=>this.div?.setAttribute("aria-label",b));let[p,f,m,g]=this.#E();if(this.setAt(p,f,0,0),this.setDims(m,g),this.#y(),this.width){let[b,v]=this.parent.viewportBaseDimensions;this.setAt(h*b,u*v,this.width*b,this.height*v),this.#u=!0,this.#S(),this.setDims(this.width*b,this.height*v),this.#m(),this.#D(),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return this.#w(),this.div}#S(){if(!this.#u)return;let[h,u]=this.parent.viewportBaseDimensions;this.canvas.width=Math.ceil(this.width*h),this.canvas.height=Math.ceil(this.height*u),this.#T()}setDimensions(h,u){let p=Math.round(h),f=Math.round(u);if(this.#o===p&&this.#f===f)return;this.#o=p,this.#f=f,this.canvas.style.visibility="hidden",this.#e&&Math.abs(this.#e-h/u)>.01&&(u=Math.ceil(h/this.#e),this.setDims(h,u));let[m,g]=this.parent.viewportBaseDimensions;this.width=h/m,this.height=u/g,this.#s&&this.#O(h,u),this.#S(),this.#m(),this.canvas.style.visibility="visible"}#O(h,u){let p=this.#P(),f=(h-p)/this.#i,m=(u-p)/this.#t;this.scaleFactor=Math.min(f,m)}#T(){let h=this.#P()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+h,this.translationY*this.scaleFactor+h)}static#M(h){let u=new Path2D;for(let p=0,f=h.length;p<f;p++){let[m,g,b,v]=h[p];p===0&&u.moveTo(...m),u.bezierCurveTo(g[0],g[1],b[0],b[1],v[0],v[1])}return u}#L(h,u,p,f){let g=[],b=this.thickness/2,v,E;for(let y of this.paths){v=[],E=[];for(let w=0,C=y.length;w<C;w++){let[A,D,M,I]=y[w],O=h*(A[0]+u)+b,F=f-h*(A[1]+p)-b,V=h*(D[0]+u)+b,x=f-h*(D[1]+p)-b,N=h*(M[0]+u)+b,z=f-h*(M[1]+p)-b,G=h*(I[0]+u)+b,X=f-h*(I[1]+p)-b;w===0&&(v.push(O,F),E.push(O,F)),v.push(V,x,N,z,G,X),this.#F(O,F,V,x,N,z,G,X,4,E)}g.push({bezier:v,points:E})}return g}#F(h,u,p,f,m,g,b,v,E,y){if(this.#k(h,u,p,f,m,g,b,v)){y.push(b,v);return}for(let w=1;w<E-1;w++){let C=w/E,A=1-C,D=C*h+A*p,M=C*u+A*f,I=C*p+A*m,O=C*f+A*g,F=C*m+A*b,V=C*g+A*v;D=C*D+A*I,M=C*M+A*O,I=C*I+A*F,O=C*O+A*V,D=C*D+A*I,M=C*M+A*O,y.push(D,M)}y.push(b,v)}#k(h,u,p,f,m,g,b,v){let y=(3*p-2*h-b)**2,w=(3*f-2*u-v)**2,C=(3*m-h-2*b)**2,A=(3*g-u-2*v)**2;return Math.max(y,C)+Math.max(w,A)<=10}#R(){let h=1/0,u=-1/0,p=1/0,f=-1/0;for(let m of this.paths)for(let[g,b,v,E]of m){let y=i.Util.bezierBoundingBox(...g,...b,...v,...E);h=Math.min(h,y[0]),p=Math.min(p,y[1]),u=Math.max(u,y[2]),f=Math.max(f,y[3])}return[h,p,u,f]}#P(){return this.#s?Math.ceil(this.thickness*this.parent.scaleFactor):0}#A(h=!1){if(this.isEmpty())return;if(!this.#s){this.#m();return}let u=this.#R(),p=this.#P();this.#i=Math.max(a,u[2]-u[0]),this.#t=Math.max(a,u[3]-u[1]);let f=Math.ceil(p+this.#i*this.scaleFactor),m=Math.ceil(p+this.#t*this.scaleFactor),[g,b]=this.parent.viewportBaseDimensions;this.width=f/g,this.height=m/b,this.#e=f/m,this.#D();let v=this.translationX,E=this.translationY;this.translationX=-u[0],this.translationY=-u[1],this.#S(),this.#m(),this.#o=f,this.#f=m,this.setDims(f,m);let y=h?p/this.scaleFactor/2:0;this.translate(v-this.translationX-y,E-this.translationY-y)}#D(){let{style:h}=this.div;this.#e>=1?(h.minHeight=`${a}px`,h.minWidth=`${Math.round(this.#e*a)}px`):(h.minWidth=`${a}px`,h.minHeight=`${Math.round(a/this.#e)}px`)}static deserialize(h,u){let p=super.deserialize(h,u);p.thickness=h.thickness,p.color=i.Util.makeHexColor(...h.color),p.opacity=h.opacity;let[f,m]=u.pageDimensions,g=p.width*f,b=p.height*m,v=u.scaleFactor,E=h.thickness/2;p.#e=g/b,p.#s=!0,p.#o=Math.round(g),p.#f=Math.round(b);for(let{bezier:w}of h.paths){let C=[];p.paths.push(C);let A=v*(w[0]-E),D=v*(b-w[1]-E);for(let I=2,O=w.length;I<O;I+=6){let F=v*(w[I]-E),V=v*(b-w[I+1]-E),x=v*(w[I+2]-E),N=v*(b-w[I+3]-E),z=v*(w[I+4]-E),G=v*(b-w[I+5]-E);C.push([[A,D],[F,V],[x,N],[z,G]]),A=z,D=G}let M=this.#M(C);p.bezierPath2D.push(M)}let y=p.#R();return p.#i=Math.max(a,y[2]-y[0]),p.#t=Math.max(a,y[3]-y[1]),p.#O(g,b),p}serialize(){if(this.isEmpty())return null;let h=this.getRect(0,0),u=this.rotation%180===0?h[3]-h[1]:h[2]-h[0],p=n.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:i.AnnotationEditorType.INK,color:p,thickness:this.thickness,opacity:this.opacity,paths:this.#L(this.scaleFactor/this.parent.scaleFactor,this.translationX,this.translationY,u),pageIndex:this.parent.pageIndex,rect:h,rotation:this.rotation}}}return c})();e.InkEditor=l},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.fitCurve=void 0;let i=t(26);e.fitCurve=i},s=>{function e(f,m,g){if(!Array.isArray(f))throw new TypeError("First argument should be an array");if(f.forEach(y=>{if(!Array.isArray(y)||y.some(w=>typeof w!="number")||y.length!==f[0].length)throw Error("Each point should be an array of numbers. Each point should have the same amount of numbers.")}),f=f.filter((y,w)=>w===0||!y.every((C,A)=>C===f[w-1][A])),f.length<2)return[];let b=f.length,v=h(f[1],f[0]),E=h(f[b-2],f[b-1]);return t(f,v,E,m,g)}function t(f,m,g,b,v){var y,w,C,A,D,M,I,O,F,V,x,N,z;if(f.length===2)return N=u.vectorLen(u.subtract(f[0],f[1]))/3,y=[f[0],u.addArrays(f[0],u.mulItems(m,N)),u.addArrays(f[1],u.mulItems(g,N)),f[1]],[y];if(w=a(f),[y,A,M]=i(f,w,w,m,g,v),A===0||A<b)return[y];if(A<b*b)for(C=w,D=A,I=M,z=0;z<20;z++){if(C=r(y,f,C),[y,A,M]=i(f,w,C,m,g,v),A<b)return[y];if(M===I){let G=A/D;if(G>.9999&&G<1.0001)break}D=A,I=M}return x=[],O=u.subtract(f[M-1],f[M+1]),O.every(G=>G===0)&&(O=u.subtract(f[M-1],f[M]),[O[0],O[1]]=[-O[1],O[0]]),F=u.normalize(O),V=u.mulItems(F,-1),x=x.concat(t(f.slice(0,M+1),m,F,b,v)),x=x.concat(t(f.slice(M),V,g,b,v)),x}function i(f,m,g,b,v,E){var y,w,C;return y=n(f,g,b,v,E),[w,C]=l(f,y,m),E&&E({bez:y,points:f,params:m,maxErr:w,maxPoint:C}),[y,w,C]}function n(f,m,g,b){var v,E,y,w,C,A,D,M,I,O,F,V,x,N,z,G,X,k=f[0],B=f[f.length-1];for(v=[k,null,null,B],E=u.zeros_Xx2x2(m.length),x=0,N=m.length;x<N;x++)G=m[x],X=1-G,y=E[x],y[0]=u.mulItems(g,3*G*(X*X)),y[1]=u.mulItems(b,3*X*(G*G));for(w=[[0,0],[0,0]],C=[0,0],x=0,N=f.length;x<N;x++)G=m[x],y=E[x],w[0][0]+=u.dot(y[0],y[0]),w[0][1]+=u.dot(y[0],y[1]),w[1][0]+=u.dot(y[0],y[1]),w[1][1]+=u.dot(y[1],y[1]),z=u.subtract(f[x],p.q([k,k,B,B],G)),C[0]+=u.dot(y[0],z),C[1]+=u.dot(y[1],z);return A=w[0][0]*w[1][1]-w[1][0]*w[0][1],D=w[0][0]*C[1]-w[1][0]*C[0],M=C[0]*w[1][1]-C[1]*w[0][1],I=A===0?0:M/A,O=A===0?0:D/A,V=u.vectorLen(u.subtract(k,B)),F=1e-6*V,I<F||O<F?(v[1]=u.addArrays(k,u.mulItems(g,V/3)),v[2]=u.addArrays(B,u.mulItems(b,V/3))):(v[1]=u.addArrays(k,u.mulItems(g,I)),v[2]=u.addArrays(B,u.mulItems(b,O))),v}function r(f,m,g){return g.map((b,v)=>o(f,m[v],b))}function o(f,m,g){var b=u.subtract(p.q(f,g),m),v=p.qprime(f,g),E=u.mulMatrix(b,v),y=u.sum(u.squareItems(v))+2*u.mulMatrix(b,p.qprimeprime(f,g));return y===0?g:g-E/y}function a(f){var m=[],g,b,v;return f.forEach((E,y)=>{g=y?b+u.vectorLen(u.subtract(E,v)):0,m.push(g),b=g,v=E}),m=m.map(E=>E/b),m}function l(f,m,g){var b,v,E,y,w,C,A,D;v=0,E=Math.floor(f.length/2);let M=c(m,10);for(w=0,C=f.length;w<C;w++)A=f[w],D=d(m,g[w],M,10),y=u.subtract(p.q(m,D),A),b=y[0]*y[0]+y[1]*y[1],b>v&&(v=b,E=w);return[v,E]}var c=function(f,m){for(var g,b=[0],v=f[0],E=0,y=1;y<=m;y++)g=p.q(f,y/m),E+=u.vectorLen(u.subtract(g,v)),b.push(E),v=g;return b=b.map(w=>w/E),b};function d(f,m,g,b){if(m<0)return 0;if(m>1)return 1;for(var v,E,y,w,C,A=1;A<=b;A++)if(m<=g[A]){w=(A-1)/b,y=A/b,E=g[A-1],v=g[A],C=(m-E)/(v-E)*(y-w)+w;break}return C}function h(f,m){return u.normalize(u.subtract(f,m))}class u{static zeros_Xx2x2(m){for(var g=[];m--;)g.push([0,0]);return g}static mulItems(m,g){return m.map(b=>b*g)}static mulMatrix(m,g){return m.reduce((b,v,E)=>b+v*g[E],0)}static subtract(m,g){return m.map((b,v)=>b-g[v])}static addArrays(m,g){return m.map((b,v)=>b+g[v])}static addItems(m,g){return m.map(b=>b+g)}static sum(m){return m.reduce((g,b)=>g+b)}static dot(m,g){return u.mulMatrix(m,g)}static vectorLen(m){return Math.hypot(...m)}static divItems(m,g){return m.map(b=>b/g)}static squareItems(m){return m.map(g=>g*g)}static normalize(m){return this.divItems(m,this.vectorLen(m))}}class p{static q(m,g){var b=1-g,v=u.mulItems(m[0],b*b*b),E=u.mulItems(m[1],3*b*b*g),y=u.mulItems(m[2],3*b*g*g),w=u.mulItems(m[3],g*g*g);return u.addArrays(u.addArrays(v,E),u.addArrays(y,w))}static qprime(m,g){var b=1-g,v=u.mulItems(u.subtract(m[1],m[0]),3*b*b),E=u.mulItems(u.subtract(m[2],m[1]),6*b*g),y=u.mulItems(u.subtract(m[3],m[2]),3*g*g);return u.addArrays(u.addArrays(v,E),y)}static qprimeprime(m,g){return u.addArrays(u.mulItems(u.addArrays(u.subtract(m[2],u.mulItems(m[1],2)),m[0]),6*(1-g)),u.mulItems(u.addArrays(u.subtract(m[3],u.mulItems(m[2],2)),m[1]),6*g))}}s.exports=e,s.exports.fitCubic=t,s.exports.createTangent=h},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AnnotationLayer=void 0;var i=t(1),n=t(8),r=t(5),o=t(28),a=t(29);let l=1e3,c=9,d=new WeakSet;function h($){return{width:$[2]-$[0],height:$[3]-$[1]}}class u{static create(T){switch(T.data.annotationType){case i.AnnotationType.LINK:return new f(T);case i.AnnotationType.TEXT:return new m(T);case i.AnnotationType.WIDGET:switch(T.data.fieldType){case"Tx":return new b(T);case"Btn":return T.data.radioButton?new E(T):T.data.checkBox?new v(T):new y(T);case"Ch":return new w(T)}return new g(T);case i.AnnotationType.POPUP:return new C(T);case i.AnnotationType.FREETEXT:return new D(T);case i.AnnotationType.LINE:return new M(T);case i.AnnotationType.SQUARE:return new I(T);case i.AnnotationType.CIRCLE:return new O(T);case i.AnnotationType.POLYLINE:return new F(T);case i.AnnotationType.CARET:return new x(T);case i.AnnotationType.INK:return new N(T);case i.AnnotationType.POLYGON:return new V(T);case i.AnnotationType.HIGHLIGHT:return new z(T);case i.AnnotationType.UNDERLINE:return new G(T);case i.AnnotationType.SQUIGGLY:return new X(T);case i.AnnotationType.STRIKEOUT:return new k(T);case i.AnnotationType.STAMP:return new B(T);case i.AnnotationType.FILEATTACHMENT:return new R(T);default:return new p(T)}}}class p{constructor(T,{isRenderable:U=!1,ignoreBorder:W=!1,createQuadrilaterals:Q=!1}={}){this.isRenderable=U,this.data=T.data,this.layer=T.layer,this.page=T.page,this.viewport=T.viewport,this.linkService=T.linkService,this.downloadManager=T.downloadManager,this.imageResourcesPath=T.imageResourcesPath,this.renderForms=T.renderForms,this.svgFactory=T.svgFactory,this.annotationStorage=T.annotationStorage,this.enableScripting=T.enableScripting,this.hasJSActions=T.hasJSActions,this._fieldObjects=T.fieldObjects,this._mouseState=T.mouseState,U&&(this.container=this._createContainer(W)),Q&&(this.quadrilaterals=this._createQuadrilaterals(W))}_createContainer(T=!1){let U=this.data,W=this.page,Q=this.viewport,te=document.createElement("section"),{width:J,height:oe}=h(U.rect),[pe,de,fe,P]=Q.viewBox,se=fe-pe,re=P-de;te.setAttribute("data-annotation-id",U.id);let K=i.Util.normalizeRect([U.rect[0],W.view[3]-U.rect[1]+W.view[1],U.rect[2],W.view[3]-U.rect[3]+W.view[1]]);if(!T&&U.borderStyle.width>0){te.style.borderWidth=`${U.borderStyle.width}px`;let le=U.borderStyle.horizontalCornerRadius,xe=U.borderStyle.verticalCornerRadius;if(le>0||xe>0){let _e=`calc(${le}px * var(--scale-factor)) / calc(${xe}px * var(--scale-factor))`;te.style.borderRadius=_e}else if(this instanceof E){let _e=`calc(${J}px * var(--scale-factor)) / calc(${oe}px * var(--scale-factor))`;te.style.borderRadius=_e}switch(U.borderStyle.style){case i.AnnotationBorderStyleType.SOLID:te.style.borderStyle="solid";break;case i.AnnotationBorderStyleType.DASHED:te.style.borderStyle="dashed";break;case i.AnnotationBorderStyleType.BEVELED:(0,i.warn)("Unimplemented border style: beveled");break;case i.AnnotationBorderStyleType.INSET:(0,i.warn)("Unimplemented border style: inset");break;case i.AnnotationBorderStyleType.UNDERLINE:te.style.borderBottomStyle="solid";break;default:break}let ge=U.borderColor||null;ge?te.style.borderColor=i.Util.makeHexColor(ge[0]|0,ge[1]|0,ge[2]|0):te.style.borderWidth=0}te.style.left=`${100*(K[0]-pe)/se}%`,te.style.top=`${100*(K[1]-de)/re}%`;let{rotation:ee}=U;return U.hasOwnCanvas||ee===0?(te.style.width=`${100*J/se}%`,te.style.height=`${100*oe/re}%`):this.setRotation(ee,te),te}setRotation(T,U=this.container){let[W,Q,te,J]=this.viewport.viewBox,oe=te-W,pe=J-Q,{width:de,height:fe}=h(this.data.rect),P,se;T%180===0?(P=100*de/oe,se=100*fe/pe):(P=100*fe/oe,se=100*de/pe),U.style.width=`${P}%`,U.style.height=`${se}%`,U.setAttribute("data-main-rotation",(360-T)%360)}get _commonActions(){let T=(U,W,Q)=>{let te=Q.detail[U];Q.target.style[W]=o.ColorConverters[`${te[0]}_HTML`](te.slice(1))};return(0,i.shadow)(this,"_commonActions",{display:U=>{let W=U.detail.display%2===1;this.container.style.visibility=W?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:W,print:U.detail.display===0||U.detail.display===3})},print:U=>{this.annotationStorage.setValue(this.data.id,{print:U.detail.print})},hidden:U=>{this.container.style.visibility=U.detail.hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:U.detail.hidden})},focus:U=>{setTimeout(()=>U.target.focus({preventScroll:!1}),0)},userName:U=>{U.target.title=U.detail.userName},readonly:U=>{U.detail.readonly?U.target.setAttribute("readonly",""):U.target.removeAttribute("readonly")},required:U=>{this._setRequired(U.target,U.detail.required)},bgColor:U=>{T("bgColor","backgroundColor",U)},fillColor:U=>{T("fillColor","backgroundColor",U)},fgColor:U=>{T("fgColor","color",U)},textColor:U=>{T("textColor","color",U)},borderColor:U=>{T("borderColor","borderColor",U)},strokeColor:U=>{T("strokeColor","borderColor",U)},rotation:U=>{let W=U.detail.rotation;this.setRotation(W),this.annotationStorage.setValue(this.data.id,{rotation:W})}})}_dispatchEventFromSandbox(T,U){let W=this._commonActions;for(let Q of Object.keys(U.detail)){let te=T[Q]||W[Q];te&&te(U)}}_setDefaultPropertiesFromJS(T){if(!this.enableScripting)return;let U=this.annotationStorage.getRawValue(this.data.id);if(!U)return;let W=this._commonActions;for(let[Q,te]of Object.entries(U)){let J=W[Q];if(J){let oe={detail:{[Q]:te},target:T};J(oe),delete U[Q]}}}_createQuadrilaterals(T=!1){if(!this.data.quadPoints)return null;let U=[],W=this.data.rect;for(let Q of this.data.quadPoints)this.data.rect=[Q[2].x,Q[2].y,Q[1].x,Q[1].y],U.push(this._createContainer(T));return this.data.rect=W,U}_createPopup(T,U){let W=this.container;this.quadrilaterals&&(T=T||this.quadrilaterals,W=this.quadrilaterals[0]),T||(T=document.createElement("div"),T.className="popupTriggerArea",W.append(T));let te=new A({container:W,trigger:T,color:U.color,titleObj:U.titleObj,modificationDate:U.modificationDate,contentsObj:U.contentsObj,richText:U.richText,hideWrapper:!0}).render();te.style.left="100%",W.append(te)}_renderQuadrilaterals(T){for(let U of this.quadrilaterals)U.className=T;return this.quadrilaterals}render(){(0,i.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(T,U=null){let W=[];if(this._fieldObjects){let Q=this._fieldObjects[T];if(Q)for(let{page:te,id:J,exportValues:oe}of Q){if(te===-1||J===U)continue;let pe=typeof oe=="string"?oe:null,de=document.querySelector(`[data-element-id="${J}"]`);if(de&&!d.has(de)){(0,i.warn)(`_getElementsByName - element not allowed: ${J}`);continue}W.push({id:J,exportValue:pe,domElement:de})}return W}for(let Q of document.getElementsByName(T)){let{id:te,exportValue:J}=Q;te!==U&&d.has(Q)&&W.push({id:te,exportValue:J,domElement:Q})}return W}static get platform(){let T=typeof navigator<"u"?navigator.platform:"";return(0,i.shadow)(this,"platform",{isWin:T.includes("Win"),isMac:T.includes("Mac")})}}class f extends p{constructor(T,U=null){super(T,{isRenderable:!0,ignoreBorder:!!U?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=T.data.isTooltipOnly}render(){let{data:T,linkService:U}=this,W=document.createElement("a");W.setAttribute("data-element-id",T.id);let Q=!1;return T.url?(U.addLinkAttributes(W,T.url,T.newWindow),Q=!0):T.action?(this._bindNamedAction(W,T.action),Q=!0):T.dest?(this._bindLink(W,T.dest),Q=!0):(T.actions&&(T.actions.Action||T.actions["Mouse Up"]||T.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(W,T),Q=!0),T.resetForm?(this._bindResetFormAction(W,T.resetForm),Q=!0):this.isTooltipOnly&&!Q&&(this._bindLink(W,""),Q=!0)),this.quadrilaterals?this._renderQuadrilaterals("linkAnnotation").map((te,J)=>{let oe=J===0?W:W.cloneNode();return te.append(oe),te}):(this.container.className="linkAnnotation",Q&&this.container.append(W),this.container)}_bindLink(T,U){T.href=this.linkService.getDestinationHash(U),T.onclick=()=>(U&&this.linkService.goToDestination(U),!1),(U||U==="")&&(T.className="internalLink")}_bindNamedAction(T,U){T.href=this.linkService.getAnchorUrl(""),T.onclick=()=>(this.linkService.executeNamedAction(U),!1),T.className="internalLink"}_bindJSAction(T,U){T.href=this.linkService.getAnchorUrl("");let W=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let Q of Object.keys(U.actions)){let te=W.get(Q);te&&(T[te]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:U.id,name:Q}}),!1))}T.onclick||(T.onclick=()=>!1),T.className="internalLink"}_bindResetFormAction(T,U){let W=T.onclick;if(W||(T.href=this.linkService.getAnchorUrl("")),T.className="internalLink",!this._fieldObjects){(0,i.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),W||(T.onclick=()=>!1);return}T.onclick=()=>{W&&W();let{fields:Q,refs:te,include:J}=U,oe=[];if(Q.length!==0||te.length!==0){let fe=new Set(te);for(let P of Q){let se=this._fieldObjects[P]||[];for(let{id:re}of se)fe.add(re)}for(let P of Object.values(this._fieldObjects))for(let se of P)fe.has(se.id)===J&&oe.push(se)}else for(let fe of Object.values(this._fieldObjects))oe.push(...fe);let pe=this.annotationStorage,de=[];for(let fe of oe){let{id:P}=fe;switch(de.push(P),fe.type){case"text":{let re=fe.defaultValue||"";pe.setValue(P,{value:re});break}case"checkbox":case"radiobutton":{let re=fe.defaultValue===fe.exportValues;pe.setValue(P,{value:re});break}case"combobox":case"listbox":{let re=fe.defaultValue||"";pe.setValue(P,{value:re});break}default:continue}let se=document.querySelector(`[data-element-id="${P}"]`);if(se){if(!d.has(se)){(0,i.warn)(`_bindResetFormAction - element not allowed: ${P}`);continue}}else continue;se.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:de,name:"ResetForm"}}),!1}}}class m extends p{constructor(T){let U=!!(T.data.hasPopup||T.data.titleObj?.str||T.data.contentsObj?.str||T.data.richText?.str);super(T,{isRenderable:U})}render(){this.container.className="textAnnotation";let T=document.createElement("img");return T.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",T.alt="[{{type}} Annotation]",T.dataset.l10nId="text_annotation_type",T.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.hasPopup||this._createPopup(T,this.data),this.container.append(T),this.container}}class g extends p{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}_getKeyModifier(T){let{isWin:U,isMac:W}=p.platform;return U&&T.ctrlKey||W&&T.metaKey}_setEventListener(T,U,W,Q){U.includes("mouse")?T.addEventListener(U,te=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:W,value:Q(te),shift:te.shiftKey,modifier:this._getKeyModifier(te)}})}):T.addEventListener(U,te=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:W,value:Q(te)}})})}_setEventListeners(T,U,W){for(let[Q,te]of U)(te==="Action"||this.data.actions?.[te])&&this._setEventListener(T,Q,te,W)}_setBackgroundColor(T){let U=this.data.backgroundColor||null;T.style.backgroundColor=U===null?"transparent":i.Util.makeHexColor(U[0],U[1],U[2])}_setTextStyle(T){let U=["left","center","right"],{fontColor:W}=this.data.defaultAppearanceData,Q=this.data.defaultAppearanceData.fontSize||c,te=T.style,J;if(this.data.multiLine){let oe=Math.abs(this.data.rect[3]-this.data.rect[1]),pe=Math.round(oe/(i.LINE_FACTOR*Q))||1,de=oe/pe;J=Math.min(Q,Math.round(de/i.LINE_FACTOR))}else{let oe=Math.abs(this.data.rect[3]-this.data.rect[1]);J=Math.min(Q,Math.round(oe/i.LINE_FACTOR))}te.fontSize=`calc(${J}px * var(--scale-factor))`,te.color=i.Util.makeHexColor(W[0],W[1],W[2]),this.data.textAlignment!==null&&(te.textAlign=U[this.data.textAlignment])}_setRequired(T,U){U?T.setAttribute("required",!0):T.removeAttribute("required"),T.setAttribute("aria-required",U)}}class b extends g{constructor(T){let U=T.renderForms||!T.data.hasAppearance&&!!T.data.fieldValue;super(T,{isRenderable:U})}setPropertyOnSiblings(T,U,W,Q){let te=this.annotationStorage;for(let J of this._getElementsByName(T.name,T.id))J.domElement&&(J.domElement[U]=W),te.setValue(J.id,{[Q]:W})}render(){let T=this.annotationStorage,U=this.data.id;this.container.className="textWidgetAnnotation";let W=null;if(this.renderForms){let Q=T.getValue(U,{value:this.data.fieldValue}),te=Q.formattedValue||Q.value||"",J=T.getValue(U,{charLimit:this.data.maxLen}).charLimit;J&&te.length>J&&(te=te.slice(0,J));let oe={userValue:te,formattedValue:null,valueOnFocus:""};this.data.multiLine?(W=document.createElement("textarea"),W.textContent=te,this.data.doNotScroll&&(W.style.overflowY="hidden")):(W=document.createElement("input"),W.type="text",W.setAttribute("value",te),this.data.doNotScroll&&(W.style.overflowX="hidden")),d.add(W),W.setAttribute("data-element-id",U),W.disabled=this.data.readOnly,W.name=this.data.fieldName,W.tabIndex=l,this._setRequired(W,this.data.required),J&&(W.maxLength=J),W.addEventListener("input",de=>{T.setValue(U,{value:de.target.value}),this.setPropertyOnSiblings(W,"value",de.target.value,"value")}),W.addEventListener("resetform",de=>{let fe=this.data.defaultFieldValue??"";W.value=oe.userValue=fe,oe.formattedValue=null});let pe=de=>{let{formattedValue:fe}=oe;fe!=null&&(de.target.value=fe),de.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){W.addEventListener("focus",fe=>{oe.userValue&&(fe.target.value=oe.userValue),oe.valueOnFocus=fe.target.value}),W.addEventListener("updatefromsandbox",fe=>{let P={value(se){oe.userValue=se.detail.value??"",T.setValue(U,{value:oe.userValue.toString()}),se.target.value=oe.userValue},formattedValue(se){let{formattedValue:re}=se.detail;oe.formattedValue=re,re!=null&&se.target!==document.activeElement&&(se.target.value=re),T.setValue(U,{formattedValue:re})},selRange(se){se.target.setSelectionRange(...se.detail.selRange)},charLimit:se=>{let{charLimit:re}=se.detail,{target:K}=se;if(re===0){K.removeAttribute("maxLength");return}K.setAttribute("maxLength",re);let ee=oe.userValue;!ee||ee.length<=re||(ee=ee.slice(0,re),K.value=oe.userValue=ee,T.setValue(U,{value:ee}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:U,name:"Keystroke",value:ee,willCommit:!0,commitKey:1,selStart:K.selectionStart,selEnd:K.selectionEnd}}))}};this._dispatchEventFromSandbox(P,fe)}),W.addEventListener("keydown",fe=>{let P=-1;if(fe.key==="Escape"?P=0:fe.key==="Enter"?P=2:fe.key==="Tab"&&(P=3),P===-1)return;let{value:se}=fe.target;oe.valueOnFocus!==se&&(oe.userValue=se,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:U,name:"Keystroke",value:se,willCommit:!0,commitKey:P,selStart:fe.target.selectionStart,selEnd:fe.target.selectionEnd}}))});let de=pe;pe=null,W.addEventListener("blur",fe=>{let{value:P}=fe.target;oe.userValue=P,this._mouseState.isDown&&oe.valueOnFocus!==P&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:U,name:"Keystroke",value:P,willCommit:!0,commitKey:1,selStart:fe.target.selectionStart,selEnd:fe.target.selectionEnd}}),de(fe)}),this.data.actions?.Keystroke&&W.addEventListener("beforeinput",fe=>{let{data:P,target:se}=fe,{value:re,selectionStart:K,selectionEnd:ee}=se,le=K,xe=ee;switch(fe.inputType){case"deleteWordBackward":{let ge=re.substring(0,K).match(/\w*[^\w]*$/);ge&&(le-=ge[0].length);break}case"deleteWordForward":{let ge=re.substring(K).match(/^[^\w]*\w*/);ge&&(xe+=ge[0].length);break}case"deleteContentBackward":K===ee&&(le-=1);break;case"deleteContentForward":K===ee&&(xe+=1);break}fe.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:U,name:"Keystroke",value:re,change:P||"",willCommit:!1,selStart:le,selEnd:xe}})}),this._setEventListeners(W,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],fe=>fe.target.value)}if(pe&&W.addEventListener("blur",pe),this.data.comb){let fe=(this.data.rect[2]-this.data.rect[0])/J;W.classList.add("comb"),W.style.letterSpacing=`calc(${fe}px * var(--scale-factor) - 1ch)`}}else W=document.createElement("div"),W.textContent=this.data.fieldValue,W.style.verticalAlign="middle",W.style.display="table-cell";return this._setTextStyle(W),this._setBackgroundColor(W),this._setDefaultPropertiesFromJS(W),this.container.append(W),this.container}}class v extends g{constructor(T){super(T,{isRenderable:T.renderForms})}render(){let T=this.annotationStorage,U=this.data,W=U.id,Q=T.getValue(W,{value:U.exportValue===U.fieldValue}).value;typeof Q=="string"&&(Q=Q!=="Off",T.setValue(W,{value:Q})),this.container.className="buttonWidgetAnnotation checkBox";let te=document.createElement("input");return d.add(te),te.setAttribute("data-element-id",W),te.disabled=U.readOnly,this._setRequired(te,this.data.required),te.type="checkbox",te.name=U.fieldName,Q&&te.setAttribute("checked",!0),te.setAttribute("exportValue",U.exportValue),te.tabIndex=l,te.addEventListener("change",J=>{let{name:oe,checked:pe}=J.target;for(let de of this._getElementsByName(oe,W)){let fe=pe&&de.exportValue===U.exportValue;de.domElement&&(de.domElement.checked=fe),T.setValue(de.id,{value:fe})}T.setValue(W,{value:pe})}),te.addEventListener("resetform",J=>{let oe=U.defaultFieldValue||"Off";J.target.checked=oe===U.exportValue}),this.enableScripting&&this.hasJSActions&&(te.addEventListener("updatefromsandbox",J=>{let oe={value(pe){pe.target.checked=pe.detail.value!=="Off",T.setValue(W,{value:pe.target.checked})}};this._dispatchEventFromSandbox(oe,J)}),this._setEventListeners(te,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],J=>J.target.checked)),this._setBackgroundColor(te),this._setDefaultPropertiesFromJS(te),this.container.append(te),this.container}}class E extends g{constructor(T){super(T,{isRenderable:T.renderForms})}render(){this.container.className="buttonWidgetAnnotation radioButton";let T=this.annotationStorage,U=this.data,W=U.id,Q=T.getValue(W,{value:U.fieldValue===U.buttonValue}).value;typeof Q=="string"&&(Q=Q!==U.buttonValue,T.setValue(W,{value:Q}));let te=document.createElement("input");if(d.add(te),te.setAttribute("data-element-id",W),te.disabled=U.readOnly,this._setRequired(te,this.data.required),te.type="radio",te.name=U.fieldName,Q&&te.setAttribute("checked",!0),te.tabIndex=l,te.addEventListener("change",J=>{let{name:oe,checked:pe}=J.target;for(let de of this._getElementsByName(oe,W))T.setValue(de.id,{value:!1});T.setValue(W,{value:pe})}),te.addEventListener("resetform",J=>{let oe=U.defaultFieldValue;J.target.checked=oe!=null&&oe===U.buttonValue}),this.enableScripting&&this.hasJSActions){let J=U.buttonValue;te.addEventListener("updatefromsandbox",oe=>{let pe={value:de=>{let fe=J===de.detail.value;for(let P of this._getElementsByName(de.target.name)){let se=fe&&P.id===W;P.domElement&&(P.domElement.checked=se),T.setValue(P.id,{value:se})}}};this._dispatchEventFromSandbox(pe,oe)}),this._setEventListeners(te,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],oe=>oe.target.checked)}return this._setBackgroundColor(te),this._setDefaultPropertiesFromJS(te),this.container.append(te),this.container}}class y extends f{constructor(T){super(T,{ignoreBorder:T.data.hasAppearance})}render(){let T=super.render();T.className="buttonWidgetAnnotation pushButton",this.data.alternativeText&&(T.title=this.data.alternativeText);let U=T.lastChild;return this.enableScripting&&this.hasJSActions&&U&&(this._setDefaultPropertiesFromJS(U),U.addEventListener("updatefromsandbox",W=>{this._dispatchEventFromSandbox({},W)})),T}}class w extends g{constructor(T){super(T,{isRenderable:T.renderForms})}render(){this.container.className="choiceWidgetAnnotation";let T=this.annotationStorage,U=this.data.id,W=T.getValue(U,{value:this.data.fieldValue}),Q=document.createElement("select");d.add(Q),Q.setAttribute("data-element-id",U),Q.disabled=this.data.readOnly,this._setRequired(Q,this.data.required),Q.name=this.data.fieldName,Q.tabIndex=l;let te=this.data.combo&&this.data.options.length>0;this.data.combo||(Q.size=this.data.options.length,this.data.multiSelect&&(Q.multiple=!0)),Q.addEventListener("resetform",de=>{let fe=this.data.defaultFieldValue;for(let P of Q.options)P.selected=P.value===fe});for(let de of this.data.options){let fe=document.createElement("option");fe.textContent=de.displayValue,fe.value=de.exportValue,W.value.includes(de.exportValue)&&(fe.setAttribute("selected",!0),te=!1),Q.append(fe)}let J=null;if(te){let de=document.createElement("option");de.value=" ",de.setAttribute("hidden",!0),de.setAttribute("selected",!0),Q.prepend(de),J=()=>{de.remove(),Q.removeEventListener("input",J),J=null},Q.addEventListener("input",J)}let oe=(de,fe)=>{let P=fe?"value":"textContent",se=de.target.options;return de.target.multiple?Array.prototype.filter.call(se,re=>re.selected).map(re=>re[P]):se.selectedIndex===-1?null:se[se.selectedIndex][P]},pe=de=>{let fe=de.target.options;return Array.prototype.map.call(fe,P=>({displayValue:P.textContent,exportValue:P.value}))};return this.enableScripting&&this.hasJSActions?(Q.addEventListener("updatefromsandbox",de=>{let fe={value(P){J?.();let se=P.detail.value,re=new Set(Array.isArray(se)?se:[se]);for(let K of Q.options)K.selected=re.has(K.value);T.setValue(U,{value:oe(P,!0)})},multipleSelection(P){Q.multiple=!0},remove(P){let se=Q.options,re=P.detail.remove;se[re].selected=!1,Q.remove(re),se.length>0&&Array.prototype.findIndex.call(se,ee=>ee.selected)===-1&&(se[0].selected=!0),T.setValue(U,{value:oe(P,!0),items:pe(P)})},clear(P){for(;Q.length!==0;)Q.remove(0);T.setValue(U,{value:null,items:[]})},insert(P){let{index:se,displayValue:re,exportValue:K}=P.detail.insert,ee=Q.children[se],le=document.createElement("option");le.textContent=re,le.value=K,ee?ee.before(le):Q.append(le),T.setValue(U,{value:oe(P,!0),items:pe(P)})},items(P){let{items:se}=P.detail;for(;Q.length!==0;)Q.remove(0);for(let re of se){let{displayValue:K,exportValue:ee}=re,le=document.createElement("option");le.textContent=K,le.value=ee,Q.append(le)}Q.options.length>0&&(Q.options[0].selected=!0),T.setValue(U,{value:oe(P,!0),items:pe(P)})},indices(P){let se=new Set(P.detail.indices);for(let re of P.target.options)re.selected=se.has(re.index);T.setValue(U,{value:oe(P,!0)})},editable(P){P.target.disabled=!P.detail.editable}};this._dispatchEventFromSandbox(fe,de)}),Q.addEventListener("input",de=>{let fe=oe(de,!0),P=oe(de,!1);T.setValue(U,{value:fe}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:U,name:"Keystroke",value:P,changeEx:fe,willCommit:!0,commitKey:1,keyDown:!1}})}),this._setEventListeners(Q,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"]],de=>de.target.checked)):Q.addEventListener("input",function(de){T.setValue(U,{value:oe(de,!0)})}),this.data.combo&&this._setTextStyle(Q),this._setBackgroundColor(Q),this._setDefaultPropertiesFromJS(Q),this.container.append(Q),this.container}}class C extends p{constructor(T){let U=!!(T.data.titleObj?.str||T.data.contentsObj?.str||T.data.richText?.str);super(T,{isRenderable:U})}render(){let T=["Line","Square","Circle","PolyLine","Polygon","Ink"];if(this.container.className="popupAnnotation",T.includes(this.data.parentType))return this.container;let U=`[data-annotation-id="${this.data.parentId}"]`,W=this.layer.querySelectorAll(U);if(W.length===0)return this.container;let Q=new A({container:this.container,trigger:Array.from(W),color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText}),te=this.page,J=i.Util.normalizeRect([this.data.parentRect[0],te.view[3]-this.data.parentRect[1]+te.view[1],this.data.parentRect[2],te.view[3]-this.data.parentRect[3]+te.view[1]]),oe=J[0]+this.data.parentRect[2]-this.data.parentRect[0],pe=J[1],[de,fe,P,se]=this.viewport.viewBox,re=P-de,K=se-fe;return this.container.style.left=`${100*(oe-de)/re}%`,this.container.style.top=`${100*(pe-fe)/K}%`,this.container.append(Q.render()),this.container}}class A{constructor(T){this.container=T.container,this.trigger=T.trigger,this.color=T.color,this.titleObj=T.titleObj,this.modificationDate=T.modificationDate,this.contentsObj=T.contentsObj,this.richText=T.richText,this.hideWrapper=T.hideWrapper||!1,this.pinned=!1}render(){let U=document.createElement("div");U.className="popupWrapper",this.hideElement=this.hideWrapper?U:this.container,this.hideElement.hidden=!0;let W=document.createElement("div");W.className="popup";let Q=this.color;if(Q){let oe=.7*(255-Q[0])+Q[0],pe=.7*(255-Q[1])+Q[1],de=.7*(255-Q[2])+Q[2];W.style.backgroundColor=i.Util.makeHexColor(oe|0,pe|0,de|0)}let te=document.createElement("h1");te.dir=this.titleObj.dir,te.textContent=this.titleObj.str,W.append(te);let J=n.PDFDateString.toDateObject(this.modificationDate);if(J){let oe=document.createElement("span");oe.className="popupDate",oe.textContent="{{date}}, {{time}}",oe.dataset.l10nId="annotation_date_string",oe.dataset.l10nArgs=JSON.stringify({date:J.toLocaleDateString(),time:J.toLocaleTimeString()}),W.append(oe)}if(this.richText?.str&&(!this.contentsObj?.str||this.contentsObj.str===this.richText.str))a.XfaLayer.render({xfaHtml:this.richText.html,intent:"richText",div:W}),W.lastChild.className="richText popupContent";else{let oe=this._formatContents(this.contentsObj);W.append(oe)}Array.isArray(this.trigger)||(this.trigger=[this.trigger]);for(let oe of this.trigger)oe.addEventListener("click",this._toggle.bind(this)),oe.addEventListener("mouseover",this._show.bind(this,!1)),oe.addEventListener("mouseout",this._hide.bind(this,!1));return W.addEventListener("click",this._hide.bind(this,!0)),U.append(W),U}_formatContents({str:T,dir:U}){let W=document.createElement("p");W.className="popupContent",W.dir=U;let Q=T.split(/(?:\r\n?|\n)/);for(let te=0,J=Q.length;te<J;++te){let oe=Q[te];W.append(document.createTextNode(oe)),te<J-1&&W.append(document.createElement("br"))}return W}_toggle(){this.pinned?this._hide(!0):this._show(!0)}_show(T=!1){T&&(this.pinned=!0),this.hideElement.hidden&&(this.hideElement.hidden=!1,this.container.style.zIndex=parseInt(this.container.style.zIndex)+1e3)}_hide(T=!0){T&&(this.pinned=!1),!this.hideElement.hidden&&!this.pinned&&(this.hideElement.hidden=!0,this.container.style.zIndex=parseInt(this.container.style.zIndex)-1e3)}}class D extends p{constructor(T){let U=!!(T.data.hasPopup||T.data.titleObj?.str||T.data.contentsObj?.str||T.data.richText?.str);super(T,{isRenderable:U,ignoreBorder:!0}),this.textContent=T.data.textContent}render(){if(this.container.className="freeTextAnnotation",this.textContent){let T=document.createElement("div");T.className="annotationTextContent",T.setAttribute("role","comment");for(let U of this.textContent){let W=document.createElement("span");W.textContent=U,T.append(W)}this.container.append(T)}return this.data.hasPopup||this._createPopup(null,this.data),this.container}}class M extends p{constructor(T){let U=!!(T.data.hasPopup||T.data.titleObj?.str||T.data.contentsObj?.str||T.data.richText?.str);super(T,{isRenderable:U,ignoreBorder:!0})}render(){this.container.className="lineAnnotation";let T=this.data,{width:U,height:W}=h(T.rect),Q=this.svgFactory.create(U,W,!0),te=this.svgFactory.createElement("svg:line");return te.setAttribute("x1",T.rect[2]-T.lineCoordinates[0]),te.setAttribute("y1",T.rect[3]-T.lineCoordinates[1]),te.setAttribute("x2",T.rect[2]-T.lineCoordinates[2]),te.setAttribute("y2",T.rect[3]-T.lineCoordinates[3]),te.setAttribute("stroke-width",T.borderStyle.width||1),te.setAttribute("stroke","transparent"),te.setAttribute("fill","transparent"),Q.append(te),this.container.append(Q),this._createPopup(te,T),this.container}}class I extends p{constructor(T){let U=!!(T.data.hasPopup||T.data.titleObj?.str||T.data.contentsObj?.str||T.data.richText?.str);super(T,{isRenderable:U,ignoreBorder:!0})}render(){this.container.className="squareAnnotation";let T=this.data,{width:U,height:W}=h(T.rect),Q=this.svgFactory.create(U,W,!0),te=T.borderStyle.width,J=this.svgFactory.createElement("svg:rect");return J.setAttribute("x",te/2),J.setAttribute("y",te/2),J.setAttribute("width",U-te),J.setAttribute("height",W-te),J.setAttribute("stroke-width",te||1),J.setAttribute("stroke","transparent"),J.setAttribute("fill","transparent"),Q.append(J),this.container.append(Q),this._createPopup(J,T),this.container}}class O extends p{constructor(T){let U=!!(T.data.hasPopup||T.data.titleObj?.str||T.data.contentsObj?.str||T.data.richText?.str);super(T,{isRenderable:U,ignoreBorder:!0})}render(){this.container.className="circleAnnotation";let T=this.data,{width:U,height:W}=h(T.rect),Q=this.svgFactory.create(U,W,!0),te=T.borderStyle.width,J=this.svgFactory.createElement("svg:ellipse");return J.setAttribute("cx",U/2),J.setAttribute("cy",W/2),J.setAttribute("rx",U/2-te/2),J.setAttribute("ry",W/2-te/2),J.setAttribute("stroke-width",te||1),J.setAttribute("stroke","transparent"),J.setAttribute("fill","transparent"),Q.append(J),this.container.append(Q),this._createPopup(J,T),this.container}}class F extends p{constructor(T){let U=!!(T.data.hasPopup||T.data.titleObj?.str||T.data.contentsObj?.str||T.data.richText?.str);super(T,{isRenderable:U,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;let T=this.data,{width:U,height:W}=h(T.rect),Q=this.svgFactory.create(U,W,!0),te=[];for(let oe of T.vertices){let pe=oe.x-T.rect[0],de=T.rect[3]-oe.y;te.push(pe+","+de)}te=te.join(" ");let J=this.svgFactory.createElement(this.svgElementName);return J.setAttribute("points",te),J.setAttribute("stroke-width",T.borderStyle.width||1),J.setAttribute("stroke","transparent"),J.setAttribute("fill","transparent"),Q.append(J),this.container.append(Q),this._createPopup(J,T),this.container}}class V extends F{constructor(T){super(T),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class x extends p{constructor(T){let U=!!(T.data.hasPopup||T.data.titleObj?.str||T.data.contentsObj?.str||T.data.richText?.str);super(T,{isRenderable:U,ignoreBorder:!0})}render(){return this.container.className="caretAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class N extends p{constructor(T){let U=!!(T.data.hasPopup||T.data.titleObj?.str||T.data.contentsObj?.str||T.data.richText?.str);super(T,{isRenderable:U,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline"}render(){this.container.className=this.containerClassName;let T=this.data,{width:U,height:W}=h(T.rect),Q=this.svgFactory.create(U,W,!0);for(let te of T.inkLists){let J=[];for(let pe of te){let de=pe.x-T.rect[0],fe=T.rect[3]-pe.y;J.push(`${de},${fe}`)}J=J.join(" ");let oe=this.svgFactory.createElement(this.svgElementName);oe.setAttribute("points",J),oe.setAttribute("stroke-width",T.borderStyle.width||1),oe.setAttribute("stroke","transparent"),oe.setAttribute("fill","transparent"),this._createPopup(oe,T),Q.append(oe)}return this.container.append(Q),this.container}}class z extends p{constructor(T){let U=!!(T.data.hasPopup||T.data.titleObj?.str||T.data.contentsObj?.str||T.data.richText?.str);super(T,{isRenderable:U,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("highlightAnnotation"):(this.container.className="highlightAnnotation",this.container)}}class G extends p{constructor(T){let U=!!(T.data.hasPopup||T.data.titleObj?.str||T.data.contentsObj?.str||T.data.richText?.str);super(T,{isRenderable:U,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("underlineAnnotation"):(this.container.className="underlineAnnotation",this.container)}}class X extends p{constructor(T){let U=!!(T.data.hasPopup||T.data.titleObj?.str||T.data.contentsObj?.str||T.data.richText?.str);super(T,{isRenderable:U,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("squigglyAnnotation"):(this.container.className="squigglyAnnotation",this.container)}}class k extends p{constructor(T){let U=!!(T.data.hasPopup||T.data.titleObj?.str||T.data.contentsObj?.str||T.data.richText?.str);super(T,{isRenderable:U,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("strikeoutAnnotation"):(this.container.className="strikeoutAnnotation",this.container)}}class B extends p{constructor(T){let U=!!(T.data.hasPopup||T.data.titleObj?.str||T.data.contentsObj?.str||T.data.richText?.str);super(T,{isRenderable:U,ignoreBorder:!0})}render(){return this.container.className="stampAnnotation",this.data.hasPopup||this._createPopup(null,this.data),this.container}}class R extends p{constructor(T){super(T,{isRenderable:!0});let{filename:U,content:W}=this.data.file;this.filename=(0,n.getFilenameFromUrl)(U),this.content=W,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:U,content:W})}render(){this.container.className="fileAttachmentAnnotation";let T=document.createElement("div");return T.className="popupTriggerArea",T.addEventListener("dblclick",this._download.bind(this)),!this.data.hasPopup&&(this.data.titleObj?.str||this.data.contentsObj?.str||this.data.richText)&&this._createPopup(T,this.data),this.container.append(T),this.container}_download(){this.downloadManager?.openOrDownloadData(this.container,this.content,this.filename)}}class j{static#e(T,U,W,Q){let te=T.firstChild||T;te.id=`${n.AnnotationPrefix}${U}`,W.append(T),Q?.moveElementInDOM(W,T,te,!1)}static render(T){let{annotations:U,div:W,viewport:Q,accessibilityManager:te}=T;this.#t(W,Q);let J=0;for(let oe of U){if(oe.annotationType!==i.AnnotationType.POPUP){let{width:de,height:fe}=h(oe.rect);if(de<=0||fe<=0)continue}let pe=u.create({data:oe,layer:W,page:T.page,viewport:Q,linkService:T.linkService,downloadManager:T.downloadManager,imageResourcesPath:T.imageResourcesPath||"",renderForms:T.renderForms!==!1,svgFactory:new n.DOMSVGFactory,annotationStorage:T.annotationStorage||new r.AnnotationStorage,enableScripting:T.enableScripting,hasJSActions:T.hasJSActions,fieldObjects:T.fieldObjects,mouseState:T.mouseState||{isDown:!1}});if(pe.isRenderable){let de=pe.render();if(oe.hidden&&(de.style.visibility="hidden"),Array.isArray(de))for(let fe of de)fe.style.zIndex=J++,j.#e(fe,oe.id,W,te);else de.style.zIndex=J++,pe instanceof C?W.prepend(de):j.#e(de,oe.id,W,te)}}this.#i(W,T.annotationCanvasMap)}static update(T){let{annotationCanvasMap:U,div:W,viewport:Q}=T;this.#t(W,Q),this.#i(W,U),W.hidden=!1}static#t(T,{width:U,height:W,rotation:Q}){let{style:te}=T,J=Q%180!==0,oe=Math.floor(U)+"px",pe=Math.floor(W)+"px";te.width=J?pe:oe,te.height=J?oe:pe,T.setAttribute("data-main-rotation",Q)}static#i(T,U){if(U){for(let[W,Q]of U){let te=T.querySelector(`[data-annotation-id="${W}"]`);if(!te)continue;let{firstChild:J}=te;J?J.nodeName==="CANVAS"?J.replaceWith(Q):J.before(Q):te.append(Q)}U.clear()}}}e.AnnotationLayer=j},(s,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ColorConverters=void 0;function t(n){return Math.floor(Math.max(0,Math.min(1,n))*255).toString(16).padStart(2,"0")}class i{static CMYK_G([r,o,a,l]){return["G",1-Math.min(1,.3*r+.59*a+.11*o+l)]}static G_CMYK([r]){return["CMYK",0,0,0,1-r]}static G_RGB([r]){return["RGB",r,r,r]}static G_HTML([r]){let o=t(r);return`#${o}${o}${o}`}static RGB_G([r,o,a]){return["G",.3*r+.59*o+.11*a]}static RGB_HTML([r,o,a]){let l=t(r),c=t(o),d=t(a);return`#${l}${c}${d}`}static T_HTML(){return"#00000000"}static CMYK_RGB([r,o,a,l]){return["RGB",1-Math.min(1,r+l),1-Math.min(1,a+l),1-Math.min(1,o+l)]}static CMYK_HTML(r){let o=this.CMYK_RGB(r).slice(1);return this.RGB_HTML(o)}static RGB_CMYK([r,o,a]){let l=1-r,c=1-o,d=1-a,h=Math.min(l,c,d);return["CMYK",l,c,d,h]}}e.ColorConverters=i},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.XfaLayer=void 0;var i=t(20);class n{static setupStorage(o,a,l,c,d){let h=c.getValue(a,{value:null});switch(l.name){case"textarea":if(h.value!==null&&(o.textContent=h.value),d==="print")break;o.addEventListener("input",u=>{c.setValue(a,{value:u.target.value})});break;case"input":if(l.attributes.type==="radio"||l.attributes.type==="checkbox"){if(h.value===l.attributes.xfaOn?o.setAttribute("checked",!0):h.value===l.attributes.xfaOff&&o.removeAttribute("checked"),d==="print")break;o.addEventListener("change",u=>{c.setValue(a,{value:u.target.checked?u.target.getAttribute("xfaOn"):u.target.getAttribute("xfaOff")})})}else{if(h.value!==null&&o.setAttribute("value",h.value),d==="print")break;o.addEventListener("input",u=>{c.setValue(a,{value:u.target.value})})}break;case"select":if(h.value!==null)for(let u of l.children)u.attributes.value===h.value&&(u.attributes.selected=!0);o.addEventListener("input",u=>{let p=u.target.options,f=p.selectedIndex===-1?"":p[p.selectedIndex].value;c.setValue(a,{value:f})});break}}static setAttributes({html:o,element:a,storage:l=null,intent:c,linkService:d}){let{attributes:h}=a,u=o instanceof HTMLAnchorElement;h.type==="radio"&&(h.name=`${h.name}-${c}`);for(let[p,f]of Object.entries(h))if(f!=null)switch(p){case"class":f.length&&o.setAttribute(p,f.join(" "));break;case"dataId":break;case"id":o.setAttribute("data-element-id",f);break;case"style":Object.assign(o.style,f);break;case"textContent":o.textContent=f;break;default:(!u||p!=="href"&&p!=="newWindow")&&o.setAttribute(p,f)}u&&d.addLinkAttributes(o,h.href,h.newWindow),l&&h.dataId&&this.setupStorage(o,h.dataId,a,l)}static render(o){let a=o.annotationStorage,l=o.linkService,c=o.xfaHtml,d=o.intent||"display",h=document.createElement(c.name);c.attributes&&this.setAttributes({html:h,element:c,intent:d,linkService:l});let u=[[c,-1,h]],p=o.div;if(p.append(h),o.viewport){let m=`matrix(${o.viewport.transform.join(",")})`;p.style.transform=m}d!=="richText"&&p.setAttribute("class","xfaLayer xfaFont");let f=[];for(;u.length>0;){let[m,g,b]=u.at(-1);if(g+1===m.children.length){u.pop();continue}let v=m.children[++u.at(-1)[1]];if(v===null)continue;let{name:E}=v;if(E==="#text"){let w=document.createTextNode(v.value);f.push(w),b.append(w);continue}let y;if(v?.attributes?.xmlns?y=document.createElementNS(v.attributes.xmlns,E):y=document.createElement(E),b.append(y),v.attributes&&this.setAttributes({html:y,element:v,storage:a,intent:d,linkService:l}),v.children&&v.children.length>0)u.push([v,-1,y]);else if(v.value){let w=document.createTextNode(v.value);i.XfaText.shouldBuildText(E)&&f.push(w),y.append(w)}}for(let m of p.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))m.setAttribute("readOnly",!0);return{textDivs:f}}static update(o){let a=`matrix(${o.viewport.transform.join(",")})`;o.div.style.transform=a,o.div.hidden=!1}}e.XfaLayer=n},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TextLayerRenderTask=void 0,e.renderTextLayer=v;var i=t(1),n=t(8);let r=1e5,o=30,a=.8,l=new Map,c=/^\s+$/g;function d(E,y){let w=l.get(E);if(w)return w;y.save(),y.font=`${o}px ${E}`;let C=y.measureText(""),A=C.fontBoundingBoxAscent,D=Math.abs(C.fontBoundingBoxDescent);if(A){y.restore();let I=A/(A+D);return l.set(E,I),I}y.strokeStyle="red",y.clearRect(0,0,o,o),y.strokeText("g",0,0);let M=y.getImageData(0,0,o,o).data;D=0;for(let I=M.length-1-3;I>=0;I-=4)if(M[I]>0){D=Math.ceil(I/4/o);break}y.clearRect(0,0,o,o),y.strokeText("A",0,o),M=y.getImageData(0,0,o,o).data,A=0;for(let I=0,O=M.length;I<O;I+=4)if(M[I]>0){A=o-Math.floor(I/4/o);break}if(y.restore(),A){let I=A/(A+D);return l.set(E,I),I}return l.set(E,a),a}function h(E,y,w,C){let A=document.createElement("span"),D=E._enhanceTextSelection?{angle:0,canvasWidth:0,hasText:y.str!=="",hasEOL:y.hasEOL,originalTransform:null,paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0,scale:1,fontSize:0}:{angle:0,canvasWidth:0,hasText:y.str!=="",hasEOL:y.hasEOL,fontSize:0};E._textDivs.push(A);let M=i.Util.transform(E._viewport.transform,y.transform),I=Math.atan2(M[1],M[0]),O=w[y.fontName];O.vertical&&(I+=Math.PI/2);let F=Math.hypot(M[2],M[3]),V=F*d(O.fontFamily,C),x,N;I===0?(x=M[4],N=M[5]-V):(x=M[4]+V*Math.sin(I),N=M[5]-V*Math.cos(I)),A.style.left=`${x}px`,A.style.top=`${N}px`,A.style.fontSize=`${F}px`,A.style.fontFamily=O.fontFamily,D.fontSize=F,A.setAttribute("role","presentation"),A.textContent=y.str,A.dir=y.dir,E._fontInspectorEnabled&&(A.dataset.fontName=y.fontName),I!==0&&(D.angle=I*(180/Math.PI));let z=!1;if(y.str.length>1||E._enhanceTextSelection&&c.test(y.str))z=!0;else if(y.str!==" "&&y.transform[0]!==y.transform[3]){let G=Math.abs(y.transform[0]),X=Math.abs(y.transform[3]);G!==X&&Math.max(G,X)/Math.min(G,X)>1.5&&(z=!0)}if(z&&(O.vertical?D.canvasWidth=y.height*E._viewport.scale:D.canvasWidth=y.width*E._viewport.scale),E._textDivProperties.set(A,D),E._textContentStream&&E._layoutText(A),E._enhanceTextSelection&&D.hasText){let G=1,X=0;I!==0&&(G=Math.cos(I),X=Math.sin(I));let k=(O.vertical?y.height:y.width)*E._viewport.scale,B=F,R,j;I!==0?(R=[G,X,-X,G,x,N],j=i.Util.getAxialAlignedBoundingBox([0,0,k,B],R)):j=[x,N,x+k,N+B],E._bounds.push({left:j[0],top:j[1],right:j[2],bottom:j[3],div:A,size:[k,B],m:R})}}function u(E){if(E._canceled)return;let y=E._textDivs,w=E._capability,C=y.length;if(C>r){E._renderingDone=!0,w.resolve();return}if(!E._textContentStream)for(let A=0;A<C;A++)E._layoutText(y[A]);E._renderingDone=!0,w.resolve()}function p(E,y,w){let C=0;for(let A=0;A<w;A++){let D=E[y++];D>0&&(C=C?Math.min(D,C):D)}return C}function f(E){let y=E._bounds,w=E._viewport,C=m(w.width,w.height,y);for(let A=0;A<C.length;A++){let D=y[A].div,M=E._textDivProperties.get(D);if(M.angle===0){M.paddingLeft=y[A].left-C[A].left,M.paddingTop=y[A].top-C[A].top,M.paddingRight=C[A].right-y[A].right,M.paddingBottom=C[A].bottom-y[A].bottom,E._textDivProperties.set(D,M);continue}let I=C[A],O=y[A],F=O.m,V=F[0],x=F[1],N=[[0,0],[0,O.size[1]],[O.size[0],0],O.size],z=new Float64Array(64);for(let X=0,k=N.length;X<k;X++){let B=i.Util.applyTransform(N[X],F);z[X+0]=V&&(I.left-B[0])/V,z[X+4]=x&&(I.top-B[1])/x,z[X+8]=V&&(I.right-B[0])/V,z[X+12]=x&&(I.bottom-B[1])/x,z[X+16]=x&&(I.left-B[0])/-x,z[X+20]=V&&(I.top-B[1])/V,z[X+24]=x&&(I.right-B[0])/-x,z[X+28]=V&&(I.bottom-B[1])/V,z[X+32]=V&&(I.left-B[0])/-V,z[X+36]=x&&(I.top-B[1])/-x,z[X+40]=V&&(I.right-B[0])/-V,z[X+44]=x&&(I.bottom-B[1])/-x,z[X+48]=x&&(I.left-B[0])/x,z[X+52]=V&&(I.top-B[1])/-V,z[X+56]=x&&(I.right-B[0])/x,z[X+60]=V&&(I.bottom-B[1])/-V}let G=1+Math.min(Math.abs(V),Math.abs(x));M.paddingLeft=p(z,32,16)/G,M.paddingTop=p(z,48,16)/G,M.paddingRight=p(z,0,16)/G,M.paddingBottom=p(z,16,16)/G,E._textDivProperties.set(D,M)}}function m(E,y,w){let C=w.map(function(D,M){return{x1:D.left,y1:D.top,x2:D.right,y2:D.bottom,index:M,x1New:void 0,x2New:void 0}});g(E,C);let A=new Array(w.length);for(let D of C){let M=D.index;A[M]={left:D.x1New,top:0,right:D.x2New,bottom:0}}w.map(function(D,M){let I=A[M],O=C[M];O.x1=D.top,O.y1=E-I.right,O.x2=D.bottom,O.y2=E-I.left,O.index=M,O.x1New=void 0,O.x2New=void 0}),g(y,C);for(let D of C){let M=D.index;A[M].top=D.x1New,A[M].bottom=D.x2New}return A}function g(E,y){y.sort(function(A,D){return A.x1-D.x1||A.index-D.index});let C=[{start:-1/0,end:1/0,boundary:{x1:-1/0,y1:-1/0,x2:0,y2:1/0,index:-1,x1New:0,x2New:0}}];for(let A of y){let D=0;for(;D<C.length&&C[D].end<=A.y1;)D++;let M=C.length-1;for(;M>=0&&C[M].start>=A.y2;)M--;let I,O,F,V,x=-1/0;for(F=D;F<=M;F++){I=C[F],O=I.boundary;let G;O.x2>A.x1?G=O.index>A.index?O.x1New:A.x1:O.x2New===void 0?G=(O.x2+A.x1)/2:G=O.x2New,G>x&&(x=G)}for(A.x1New=x,F=D;F<=M;F++)I=C[F],O=I.boundary,O.x2New===void 0?O.x2>A.x1?O.index>A.index&&(O.x2New=O.x2):O.x2New=x:O.x2New>x&&(O.x2New=Math.max(x,O.x2));let N=[],z=null;for(F=D;F<=M;F++){I=C[F],O=I.boundary;let G=O.x2>A.x2?O:A;z===G?N.at(-1).end=I.end:(N.push({start:I.start,end:I.end,boundary:G}),z=G)}for(C[D].start<A.y1&&(N[0].start=A.y1,N.unshift({start:C[D].start,end:A.y1,boundary:C[D].boundary})),A.y2<C[M].end&&(N.at(-1).end=A.y2,N.push({start:A.y2,end:C[M].end,boundary:C[M].boundary})),F=D;F<=M;F++){if(I=C[F],O=I.boundary,O.x2New!==void 0)continue;let G=!1;for(V=D-1;!G&&V>=0&&C[V].start>=O.y1;V--)G=C[V].boundary===O;for(V=M+1;!G&&V<C.length&&C[V].end<=O.y2;V++)G=C[V].boundary===O;for(V=0;!G&&V<N.length;V++)G=N[V].boundary===O;G||(O.x2New=x)}Array.prototype.splice.apply(C,[D,M-D+1,...N])}for(let A of C){let D=A.boundary;D.x2New===void 0&&(D.x2New=Math.max(E,D.x2))}}class b{constructor({textContent:y,textContentStream:w,container:C,viewport:A,textDivs:D,textContentItemsStr:M,enhanceTextSelection:I}){I&&(0,n.deprecated)("The `enhanceTextSelection` functionality will be removed in the future."),this._textContent=y,this._textContentStream=w,this._container=C,this._document=C.ownerDocument,this._viewport=A,this._textDivs=D||[],this._textContentItemsStr=M||[],this._enhanceTextSelection=!!I,this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._layoutTextLastFontSize=null,this._layoutTextLastFontFamily=null,this._layoutTextCtx=null,this._textDivProperties=new WeakMap,this._renderingDone=!1,this._canceled=!1,this._capability=(0,i.createPromiseCapability)(),this._renderTimer=null,this._bounds=[],this._devicePixelRatio=globalThis.devicePixelRatio||1,this._capability.promise.finally(()=>{this._enhanceTextSelection||(this._textDivProperties=null),this._layoutTextCtx&&(this._layoutTextCtx.canvas.width=0,this._layoutTextCtx.canvas.height=0,this._layoutTextCtx=null)}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new i.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._renderTimer!==null&&(clearTimeout(this._renderTimer),this._renderTimer=null),this._capability.reject(new Error("TextLayer task cancelled."))}_processItems(y,w){for(let C=0,A=y.length;C<A;C++){if(y[C].str===void 0){if(y[C].type==="beginMarkedContentProps"||y[C].type==="beginMarkedContent"){let D=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),y[C].id!==null&&this._container.setAttribute("id",`${y[C].id}`),D.append(this._container)}else y[C].type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(y[C].str),h(this,y[C],w,this._layoutTextCtx)}}_layoutText(y){let w=this._textDivProperties.get(y),C="";if(w.canvasWidth!==0&&w.hasText){let{fontFamily:A}=y.style,{fontSize:D}=w;(D!==this._layoutTextLastFontSize||A!==this._layoutTextLastFontFamily)&&(this._layoutTextCtx.font=`${D*this._devicePixelRatio}px ${A}`,this._layoutTextLastFontSize=D,this._layoutTextLastFontFamily=A);let{width:M}=this._layoutTextCtx.measureText(y.textContent);if(M>0){let I=this._devicePixelRatio*w.canvasWidth/M;this._enhanceTextSelection&&(w.scale=I),C=`scaleX(${I})`}}if(w.angle!==0&&(C=`rotate(${w.angle}deg) ${C}`),C.length>0&&(this._enhanceTextSelection&&(w.originalTransform=C),y.style.transform=C),w.hasText&&this._container.append(y),w.hasEOL){let A=document.createElement("br");A.setAttribute("role","presentation"),this._container.append(A)}}_render(y=0){let w=(0,i.createPromiseCapability)(),C=Object.create(null),A=this._document.createElement("canvas");if(A.height=A.width=o,this._layoutTextCtx=A.getContext("2d",{alpha:!1}),this._textContent){let D=this._textContent.items,M=this._textContent.styles;this._processItems(D,M),w.resolve()}else if(this._textContentStream){let D=()=>{this._reader.read().then(({value:M,done:I})=>{if(I){w.resolve();return}Object.assign(C,M.styles),this._processItems(M.items,C),D()},w.reject)};this._reader=this._textContentStream.getReader(),D()}else throw new Error('Neither "textContent" nor "textContentStream" parameters specified.');w.promise.then(()=>{C=null,y?this._renderTimer=setTimeout(()=>{u(this),this._renderTimer=null},y):u(this)},this._capability.reject)}expandTextDivs(y=!1){if(!this._enhanceTextSelection||!this._renderingDone)return;this._bounds!==null&&(f(this),this._bounds=null);let w=[],C=[];for(let A=0,D=this._textDivs.length;A<D;A++){let M=this._textDivs[A],I=this._textDivProperties.get(M);I.hasText&&(y?(w.length=0,C.length=0,I.originalTransform&&w.push(I.originalTransform),I.paddingTop>0?(C.push(`${I.paddingTop}px`),w.push(`translateY(${-I.paddingTop}px)`)):C.push(0),I.paddingRight>0?C.push(`${I.paddingRight/I.scale}px`):C.push(0),I.paddingBottom>0?C.push(`${I.paddingBottom}px`):C.push(0),I.paddingLeft>0?(C.push(`${I.paddingLeft/I.scale}px`),w.push(`translateX(${-I.paddingLeft/I.scale}px)`)):C.push(0),M.style.padding=C.join(" "),w.length&&(M.style.transform=w.join(" "))):(M.style.padding=null,M.style.transform=I.originalTransform))}}}e.TextLayerRenderTask=b;function v(E){let y=new b({textContent:E.textContent,textContentStream:E.textContentStream,container:E.container,viewport:E.viewport,textDivs:E.textDivs,textContentItemsStr:E.textContentItemsStr,enhanceTextSelection:E.enhanceTextSelection});return y._render(E.timeout),y}},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SVGGraphics=void 0;var i=t(8),n=t(1),r=t(3);let o=class{constructor(){(0,n.unreachable)("Not implemented: SVGGraphics")}};e.SVGGraphics=o;{let m=function(w){let C=[],A=[];for(let D of w){if(D.fn==="save"){C.push({fnId:92,fn:"group",items:[]}),A.push(C),C=C.at(-1).items;continue}D.fn==="restore"?C=A.pop():C.push(D)}return C},g=function(w){if(Number.isInteger(w))return w.toString();let C=w.toFixed(10),A=C.length-1;if(C[A]!=="0")return C;do A--;while(C[A]==="0");return C.substring(0,C[A]==="."?A:A+1)},b=function(w){if(w[4]===0&&w[5]===0){if(w[1]===0&&w[2]===0)return w[0]===1&&w[3]===1?"":`scale(${g(w[0])} ${g(w[3])})`;if(w[0]===w[3]&&w[1]===-w[2]){let C=Math.acos(w[0])*180/Math.PI;return`rotate(${g(C)})`}}else if(w[0]===1&&w[1]===0&&w[2]===0&&w[3]===1)return`translate(${g(w[4])} ${g(w[5])})`;return`matrix(${g(w[0])} ${g(w[1])} ${g(w[2])} ${g(w[3])} ${g(w[4])} ${g(w[5])})`},a={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},l="http://www.w3.org/XML/1998/namespace",c="http://www.w3.org/1999/xlink",d=["butt","round","square"],h=["miter","round","bevel"],u=function(w,C="",A=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!A)return URL.createObjectURL(new Blob([w],{type:C}));let D="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",M=`data:${C};base64,`;for(let I=0,O=w.length;I<O;I+=3){let F=w[I]&255,V=w[I+1]&255,x=w[I+2]&255,N=F>>2,z=(F&3)<<4|V>>4,G=I+1<O?(V&15)<<2|x>>6:64,X=I+2<O?x&63:64;M+=D[N]+D[z]+D[G]+D[X]}return M},p=function(){let w=new Uint8Array([137,80,78,71,13,10,26,10]),C=12,A=new Int32Array(256);for(let x=0;x<256;x++){let N=x;for(let z=0;z<8;z++)N&1?N=3988292384^N>>1&2147483647:N=N>>1&2147483647;A[x]=N}function D(x,N,z){let G=-1;for(let X=N;X<z;X++){let k=(G^x[X])&255,B=A[k];G=G>>>8^B}return G^-1}function M(x,N,z,G){let X=G,k=N.length;z[X]=k>>24&255,z[X+1]=k>>16&255,z[X+2]=k>>8&255,z[X+3]=k&255,X+=4,z[X]=x.charCodeAt(0)&255,z[X+1]=x.charCodeAt(1)&255,z[X+2]=x.charCodeAt(2)&255,z[X+3]=x.charCodeAt(3)&255,X+=4,z.set(N,X),X+=N.length;let B=D(z,G+4,X);z[X]=B>>24&255,z[X+1]=B>>16&255,z[X+2]=B>>8&255,z[X+3]=B&255}function I(x,N,z){let G=1,X=0;for(let k=N;k<z;++k)G=(G+(x[k]&255))%65521,X=(X+G)%65521;return X<<16|G}function O(x){if(!r.isNodeJS)return F(x);try{let N;parseInt(process.versions.node)>=8?N=x:N=Buffer.from(x);let z=NO().deflateSync(N,{level:9});return z instanceof Uint8Array?z:new Uint8Array(z)}catch(N){(0,n.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+N)}return F(x)}function F(x){let N=x.length,z=65535,G=Math.ceil(N/z),X=new Uint8Array(2+N+G*5+4),k=0;X[k++]=120,X[k++]=156;let B=0;for(;N>z;)X[k++]=0,X[k++]=255,X[k++]=255,X[k++]=0,X[k++]=0,X.set(x.subarray(B,B+z),k),k+=z,B+=z,N-=z;X[k++]=1,X[k++]=N&255,X[k++]=N>>8&255,X[k++]=~N&65535&255,X[k++]=(~N&65535)>>8&255,X.set(x.subarray(B),k),k+=x.length-B;let R=I(x,0,x.length);return X[k++]=R>>24&255,X[k++]=R>>16&255,X[k++]=R>>8&255,X[k++]=R&255,X}function V(x,N,z,G){let X=x.width,k=x.height,B,R,j,$=x.data;switch(N){case n.ImageKind.GRAYSCALE_1BPP:R=0,B=1,j=X+7>>3;break;case n.ImageKind.RGB_24BPP:R=2,B=8,j=X*3;break;case n.ImageKind.RGBA_32BPP:R=6,B=8,j=X*4;break;default:throw new Error("invalid format")}let T=new Uint8Array((1+j)*k),U=0,W=0;for(let de=0;de<k;++de)T[U++]=0,T.set($.subarray(W,W+j),U),W+=j,U+=j;if(N===n.ImageKind.GRAYSCALE_1BPP&&G){U=0;for(let de=0;de<k;de++){U++;for(let fe=0;fe<j;fe++)T[U++]^=255}}let Q=new Uint8Array([X>>24&255,X>>16&255,X>>8&255,X&255,k>>24&255,k>>16&255,k>>8&255,k&255,B,R,0,0,0]),te=O(T),J=w.length+C*3+Q.length+te.length,oe=new Uint8Array(J),pe=0;return oe.set(w,pe),pe+=w.length,M("IHDR",Q,oe,pe),pe+=C+Q.length,M("IDATA",te,oe,pe),pe+=C+te.length,M("IEND",new Uint8Array(0),oe,pe),u(oe,"image/png",z)}return function(N,z,G){let X=N.kind===void 0?n.ImageKind.GRAYSCALE_1BPP:N.kind;return V(N,X,z,G)}}();class f{constructor(){this.fontSizeScale=1,this.fontWeight=a.fontWeight,this.fontSize=0,this.textMatrix=n.IDENTITY_MATRIX,this.fontMatrix=n.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=n.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=a.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(C,A){this.x=C,this.y=A}}let v=0,E=0,y=0;e.SVGGraphics=o=class{constructor(w,C,A=!1){(0,i.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new i.DOMSVGFactory,this.current=new f,this.transformMatrix=n.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=w,this.objs=C,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!A,this._operatorIdMapping=[];for(let D in n.OPS)this._operatorIdMapping[n.OPS[D]]=D}save(){this.transformStack.push(this.transformMatrix);let w=this.current;this.extraStack.push(w),this.current=w.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(w){this.save(),this.executeOpTree(w),this.restore()}loadDependencies(w){let C=w.fnArray,A=w.argsArray;for(let D=0,M=C.length;D<M;D++)if(C[D]===n.OPS.dependency)for(let I of A[D]){let O=I.startsWith("g_")?this.commonObjs:this.objs,F=new Promise(V=>{O.get(I,V)});this.current.dependencies.push(F)}return Promise.all(this.current.dependencies)}transform(w,C,A,D,M,I){let O=[w,C,A,D,M,I];this.transformMatrix=n.Util.transform(this.transformMatrix,O),this.tgrp=null}getSVG(w,C){this.viewport=C;let A=this._initialize(C);return this.loadDependencies(w).then(()=>(this.transformMatrix=n.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(w)),A))}convertOpList(w){let C=this._operatorIdMapping,A=w.argsArray,D=w.fnArray,M=[];for(let I=0,O=D.length;I<O;I++){let F=D[I];M.push({fnId:F,fn:C[F],args:A[I]})}return m(M)}executeOpTree(w){for(let C of w){let A=C.fn,D=C.fnId,M=C.args;switch(D|0){case n.OPS.beginText:this.beginText();break;case n.OPS.dependency:break;case n.OPS.setLeading:this.setLeading(M);break;case n.OPS.setLeadingMoveText:this.setLeadingMoveText(M[0],M[1]);break;case n.OPS.setFont:this.setFont(M);break;case n.OPS.showText:this.showText(M[0]);break;case n.OPS.showSpacedText:this.showText(M[0]);break;case n.OPS.endText:this.endText();break;case n.OPS.moveText:this.moveText(M[0],M[1]);break;case n.OPS.setCharSpacing:this.setCharSpacing(M[0]);break;case n.OPS.setWordSpacing:this.setWordSpacing(M[0]);break;case n.OPS.setHScale:this.setHScale(M[0]);break;case n.OPS.setTextMatrix:this.setTextMatrix(M[0],M[1],M[2],M[3],M[4],M[5]);break;case n.OPS.setTextRise:this.setTextRise(M[0]);break;case n.OPS.setTextRenderingMode:this.setTextRenderingMode(M[0]);break;case n.OPS.setLineWidth:this.setLineWidth(M[0]);break;case n.OPS.setLineJoin:this.setLineJoin(M[0]);break;case n.OPS.setLineCap:this.setLineCap(M[0]);break;case n.OPS.setMiterLimit:this.setMiterLimit(M[0]);break;case n.OPS.setFillRGBColor:this.setFillRGBColor(M[0],M[1],M[2]);break;case n.OPS.setStrokeRGBColor:this.setStrokeRGBColor(M[0],M[1],M[2]);break;case n.OPS.setStrokeColorN:this.setStrokeColorN(M);break;case n.OPS.setFillColorN:this.setFillColorN(M);break;case n.OPS.shadingFill:this.shadingFill(M[0]);break;case n.OPS.setDash:this.setDash(M[0],M[1]);break;case n.OPS.setRenderingIntent:this.setRenderingIntent(M[0]);break;case n.OPS.setFlatness:this.setFlatness(M[0]);break;case n.OPS.setGState:this.setGState(M[0]);break;case n.OPS.fill:this.fill();break;case n.OPS.eoFill:this.eoFill();break;case n.OPS.stroke:this.stroke();break;case n.OPS.fillStroke:this.fillStroke();break;case n.OPS.eoFillStroke:this.eoFillStroke();break;case n.OPS.clip:this.clip("nonzero");break;case n.OPS.eoClip:this.clip("evenodd");break;case n.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case n.OPS.paintImageXObject:this.paintImageXObject(M[0]);break;case n.OPS.paintInlineImageXObject:this.paintInlineImageXObject(M[0]);break;case n.OPS.paintImageMaskXObject:this.paintImageMaskXObject(M[0]);break;case n.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(M[0],M[1]);break;case n.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case n.OPS.closePath:this.closePath();break;case n.OPS.closeStroke:this.closeStroke();break;case n.OPS.closeFillStroke:this.closeFillStroke();break;case n.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case n.OPS.nextLine:this.nextLine();break;case n.OPS.transform:this.transform(M[0],M[1],M[2],M[3],M[4],M[5]);break;case n.OPS.constructPath:this.constructPath(M[0],M[1]);break;case n.OPS.endPath:this.endPath();break;case 92:this.group(C.items);break;default:(0,n.warn)(`Unimplemented operator ${A}`);break}}}setWordSpacing(w){this.current.wordSpacing=w}setCharSpacing(w){this.current.charSpacing=w}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(w,C,A,D,M,I){let O=this.current;O.textMatrix=O.lineMatrix=[w,C,A,D,M,I],O.textMatrixScale=Math.hypot(w,C),O.x=O.lineX=0,O.y=O.lineY=0,O.xcoords=[],O.ycoords=[],O.tspan=this.svgFactory.createElement("svg:tspan"),O.tspan.setAttributeNS(null,"font-family",O.fontFamily),O.tspan.setAttributeNS(null,"font-size",`${g(O.fontSize)}px`),O.tspan.setAttributeNS(null,"y",g(-O.y)),O.txtElement=this.svgFactory.createElement("svg:text"),O.txtElement.append(O.tspan)}beginText(){let w=this.current;w.x=w.lineX=0,w.y=w.lineY=0,w.textMatrix=n.IDENTITY_MATRIX,w.lineMatrix=n.IDENTITY_MATRIX,w.textMatrixScale=1,w.tspan=this.svgFactory.createElement("svg:tspan"),w.txtElement=this.svgFactory.createElement("svg:text"),w.txtgrp=this.svgFactory.createElement("svg:g"),w.xcoords=[],w.ycoords=[]}moveText(w,C){let A=this.current;A.x=A.lineX+=w,A.y=A.lineY+=C,A.xcoords=[],A.ycoords=[],A.tspan=this.svgFactory.createElement("svg:tspan"),A.tspan.setAttributeNS(null,"font-family",A.fontFamily),A.tspan.setAttributeNS(null,"font-size",`${g(A.fontSize)}px`),A.tspan.setAttributeNS(null,"y",g(-A.y))}showText(w){let C=this.current,A=C.font,D=C.fontSize;if(D===0)return;let M=C.fontSizeScale,I=C.charSpacing,O=C.wordSpacing,F=C.fontDirection,V=C.textHScale*F,x=A.vertical,N=x?1:-1,z=A.defaultVMetrics,G=D*C.fontMatrix[0],X=0;for(let R of w){if(R===null){X+=F*O;continue}else if(typeof R=="number"){X+=N*R*D/1e3;continue}let j=(R.isSpace?O:0)+I,$=R.fontChar,T,U,W=R.width;if(x){let te,J=R.vmetric||z;te=R.vmetric?J[1]:W*.5,te=-te*G;let oe=J[2]*G;W=J?-J[0]:W,T=te/M,U=(X+oe)/M}else T=X/M,U=0;(R.isInFont||A.missingFile)&&(C.xcoords.push(C.x+T),x&&C.ycoords.push(-C.y+U),C.tspan.textContent+=$);let Q;x?Q=W*G-j*F:Q=W*G+j*F,X+=Q}C.tspan.setAttributeNS(null,"x",C.xcoords.map(g).join(" ")),x?C.tspan.setAttributeNS(null,"y",C.ycoords.map(g).join(" ")):C.tspan.setAttributeNS(null,"y",g(-C.y)),x?C.y-=X:C.x+=X*V,C.tspan.setAttributeNS(null,"font-family",C.fontFamily),C.tspan.setAttributeNS(null,"font-size",`${g(C.fontSize)}px`),C.fontStyle!==a.fontStyle&&C.tspan.setAttributeNS(null,"font-style",C.fontStyle),C.fontWeight!==a.fontWeight&&C.tspan.setAttributeNS(null,"font-weight",C.fontWeight);let k=C.textRenderingMode&n.TextRenderingMode.FILL_STROKE_MASK;if(k===n.TextRenderingMode.FILL||k===n.TextRenderingMode.FILL_STROKE?(C.fillColor!==a.fillColor&&C.tspan.setAttributeNS(null,"fill",C.fillColor),C.fillAlpha<1&&C.tspan.setAttributeNS(null,"fill-opacity",C.fillAlpha)):C.textRenderingMode===n.TextRenderingMode.ADD_TO_PATH?C.tspan.setAttributeNS(null,"fill","transparent"):C.tspan.setAttributeNS(null,"fill","none"),k===n.TextRenderingMode.STROKE||k===n.TextRenderingMode.FILL_STROKE){let R=1/(C.textMatrixScale||1);this._setStrokeAttributes(C.tspan,R)}let B=C.textMatrix;C.textRise!==0&&(B=B.slice(),B[5]+=C.textRise),C.txtElement.setAttributeNS(null,"transform",`${b(B)} scale(${g(V)}, -1)`),C.txtElement.setAttributeNS(l,"xml:space","preserve"),C.txtElement.append(C.tspan),C.txtgrp.append(C.txtElement),this._ensureTransformGroup().append(C.txtElement)}setLeadingMoveText(w,C){this.setLeading(-C),this.moveText(w,C)}addFontStyle(w){if(!w.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));let C=u(w.data,w.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${w.loadedName}"; src: url(${C}); }
`}setFont(w){let C=this.current,A=this.commonObjs.get(w[0]),D=w[1];C.font=A,this.embedFonts&&!A.missingFile&&!this.embeddedFonts[A.loadedName]&&(this.addFontStyle(A),this.embeddedFonts[A.loadedName]=A),C.fontMatrix=A.fontMatrix||n.FONT_IDENTITY_MATRIX;let M="normal";A.black?M="900":A.bold&&(M="bold");let I=A.italic?"italic":"normal";D<0?(D=-D,C.fontDirection=-1):C.fontDirection=1,C.fontSize=D,C.fontFamily=A.loadedName,C.fontWeight=M,C.fontStyle=I,C.tspan=this.svgFactory.createElement("svg:tspan"),C.tspan.setAttributeNS(null,"y",g(-C.y)),C.xcoords=[],C.ycoords=[]}endText(){let w=this.current;w.textRenderingMode&n.TextRenderingMode.ADD_TO_PATH_FLAG&&w.txtElement?.hasChildNodes()&&(w.element=w.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(w){w>0&&(this.current.lineWidth=w)}setLineCap(w){this.current.lineCap=d[w]}setLineJoin(w){this.current.lineJoin=h[w]}setMiterLimit(w){this.current.miterLimit=w}setStrokeAlpha(w){this.current.strokeAlpha=w}setStrokeRGBColor(w,C,A){this.current.strokeColor=n.Util.makeHexColor(w,C,A)}setFillAlpha(w){this.current.fillAlpha=w}setFillRGBColor(w,C,A){this.current.fillColor=n.Util.makeHexColor(w,C,A),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(w){this.current.strokeColor=this._makeColorN_Pattern(w)}setFillColorN(w){this.current.fillColor=this._makeColorN_Pattern(w)}shadingFill(w){let C=this.viewport.width,A=this.viewport.height,D=n.Util.inverseTransform(this.transformMatrix),M=n.Util.applyTransform([0,0],D),I=n.Util.applyTransform([0,A],D),O=n.Util.applyTransform([C,0],D),F=n.Util.applyTransform([C,A],D),V=Math.min(M[0],I[0],O[0],F[0]),x=Math.min(M[1],I[1],O[1],F[1]),N=Math.max(M[0],I[0],O[0],F[0]),z=Math.max(M[1],I[1],O[1],F[1]),G=this.svgFactory.createElement("svg:rect");G.setAttributeNS(null,"x",V),G.setAttributeNS(null,"y",x),G.setAttributeNS(null,"width",N-V),G.setAttributeNS(null,"height",z-x),G.setAttributeNS(null,"fill",this._makeShadingPattern(w)),this.current.fillAlpha<1&&G.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(G)}_makeColorN_Pattern(w){return w[0]==="TilingPattern"?this._makeTilingPattern(w):this._makeShadingPattern(w)}_makeTilingPattern(w){let C=w[1],A=w[2],D=w[3]||n.IDENTITY_MATRIX,[M,I,O,F]=w[4],V=w[5],x=w[6],N=w[7],z=`shading${y++}`,[G,X,k,B]=n.Util.normalizeRect([...n.Util.applyTransform([M,I],D),...n.Util.applyTransform([O,F],D)]),[R,j]=n.Util.singularValueDecompose2dScale(D),$=V*R,T=x*j,U=this.svgFactory.createElement("svg:pattern");U.setAttributeNS(null,"id",z),U.setAttributeNS(null,"patternUnits","userSpaceOnUse"),U.setAttributeNS(null,"width",$),U.setAttributeNS(null,"height",T),U.setAttributeNS(null,"x",`${G}`),U.setAttributeNS(null,"y",`${X}`);let W=this.svg,Q=this.transformMatrix,te=this.current.fillColor,J=this.current.strokeColor,oe=this.svgFactory.create(k-G,B-X);if(this.svg=oe,this.transformMatrix=D,N===2){let pe=n.Util.makeHexColor(...C);this.current.fillColor=pe,this.current.strokeColor=pe}return this.executeOpTree(this.convertOpList(A)),this.svg=W,this.transformMatrix=Q,this.current.fillColor=te,this.current.strokeColor=J,U.append(oe.childNodes[0]),this.defs.append(U),`url(#${z})`}_makeShadingPattern(w){switch(typeof w=="string"&&(w=this.objs.get(w)),w[0]){case"RadialAxial":let C=`shading${y++}`,A=w[3],D;switch(w[1]){case"axial":let M=w[4],I=w[5];D=this.svgFactory.createElement("svg:linearGradient"),D.setAttributeNS(null,"id",C),D.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),D.setAttributeNS(null,"x1",M[0]),D.setAttributeNS(null,"y1",M[1]),D.setAttributeNS(null,"x2",I[0]),D.setAttributeNS(null,"y2",I[1]);break;case"radial":let O=w[4],F=w[5],V=w[6],x=w[7];D=this.svgFactory.createElement("svg:radialGradient"),D.setAttributeNS(null,"id",C),D.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),D.setAttributeNS(null,"cx",F[0]),D.setAttributeNS(null,"cy",F[1]),D.setAttributeNS(null,"r",x),D.setAttributeNS(null,"fx",O[0]),D.setAttributeNS(null,"fy",O[1]),D.setAttributeNS(null,"fr",V);break;default:throw new Error(`Unknown RadialAxial type: ${w[1]}`)}for(let M of A){let I=this.svgFactory.createElement("svg:stop");I.setAttributeNS(null,"offset",M[0]),I.setAttributeNS(null,"stop-color",M[1]),D.append(I)}return this.defs.append(D),`url(#${C})`;case"Mesh":return(0,n.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${w[0]}`)}}setDash(w,C){this.current.dashArray=w,this.current.dashPhase=C}constructPath(w,C){let A=this.current,D=A.x,M=A.y,I=[],O=0;for(let F of w)switch(F|0){case n.OPS.rectangle:D=C[O++],M=C[O++];let V=C[O++],x=C[O++],N=D+V,z=M+x;I.push("M",g(D),g(M),"L",g(N),g(M),"L",g(N),g(z),"L",g(D),g(z),"Z");break;case n.OPS.moveTo:D=C[O++],M=C[O++],I.push("M",g(D),g(M));break;case n.OPS.lineTo:D=C[O++],M=C[O++],I.push("L",g(D),g(M));break;case n.OPS.curveTo:D=C[O+4],M=C[O+5],I.push("C",g(C[O]),g(C[O+1]),g(C[O+2]),g(C[O+3]),g(D),g(M)),O+=6;break;case n.OPS.curveTo2:I.push("C",g(D),g(M),g(C[O]),g(C[O+1]),g(C[O+2]),g(C[O+3])),D=C[O+2],M=C[O+3],O+=4;break;case n.OPS.curveTo3:D=C[O+2],M=C[O+3],I.push("C",g(C[O]),g(C[O+1]),g(D),g(M),g(D),g(M)),O+=4;break;case n.OPS.closePath:I.push("Z");break}I=I.join(" "),A.path&&w.length>0&&w[0]!==n.OPS.rectangle&&w[0]!==n.OPS.moveTo?I=A.path.getAttributeNS(null,"d")+I:(A.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(A.path)),A.path.setAttributeNS(null,"d",I),A.path.setAttributeNS(null,"fill","none"),A.element=A.path,A.setCurrentPoint(D,M)}endPath(){let w=this.current;if(w.path=null,!this.pendingClip)return;if(!w.element){this.pendingClip=null;return}let C=`clippath${v++}`,A=this.svgFactory.createElement("svg:clipPath");A.setAttributeNS(null,"id",C),A.setAttributeNS(null,"transform",b(this.transformMatrix));let D=w.element.cloneNode(!0);if(this.pendingClip==="evenodd"?D.setAttributeNS(null,"clip-rule","evenodd"):D.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,A.append(D),this.defs.append(A),w.activeClipUrl){w.clipGroup=null;for(let M of this.extraStack)M.clipGroup=null;A.setAttributeNS(null,"clip-path",w.activeClipUrl)}w.activeClipUrl=`url(#${C})`,this.tgrp=null}clip(w){this.pendingClip=w}closePath(){let w=this.current;if(w.path){let C=`${w.path.getAttributeNS(null,"d")}Z`;w.path.setAttributeNS(null,"d",C)}}setLeading(w){this.current.leading=-w}setTextRise(w){this.current.textRise=w}setTextRenderingMode(w){this.current.textRenderingMode=w}setHScale(w){this.current.textHScale=w/100}setRenderingIntent(w){}setFlatness(w){}setGState(w){for(let[C,A]of w)switch(C){case"LW":this.setLineWidth(A);break;case"LC":this.setLineCap(A);break;case"LJ":this.setLineJoin(A);break;case"ML":this.setMiterLimit(A);break;case"D":this.setDash(A[0],A[1]);break;case"RI":this.setRenderingIntent(A);break;case"FL":this.setFlatness(A);break;case"Font":this.setFont(A);break;case"CA":this.setStrokeAlpha(A);break;case"ca":this.setFillAlpha(A);break;default:(0,n.warn)(`Unimplemented graphic state operator ${C}`);break}}fill(){let w=this.current;w.element&&(w.element.setAttributeNS(null,"fill",w.fillColor),w.element.setAttributeNS(null,"fill-opacity",w.fillAlpha),this.endPath())}stroke(){let w=this.current;w.element&&(this._setStrokeAttributes(w.element),w.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(w,C=1){let A=this.current,D=A.dashArray;C!==1&&D.length>0&&(D=D.map(function(M){return C*M})),w.setAttributeNS(null,"stroke",A.strokeColor),w.setAttributeNS(null,"stroke-opacity",A.strokeAlpha),w.setAttributeNS(null,"stroke-miterlimit",g(A.miterLimit)),w.setAttributeNS(null,"stroke-linecap",A.lineCap),w.setAttributeNS(null,"stroke-linejoin",A.lineJoin),w.setAttributeNS(null,"stroke-width",g(C*A.lineWidth)+"px"),w.setAttributeNS(null,"stroke-dasharray",D.map(g).join(" ")),w.setAttributeNS(null,"stroke-dashoffset",g(C*A.dashPhase)+"px")}eoFill(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){let w=this.svgFactory.createElement("svg:rect");w.setAttributeNS(null,"x","0"),w.setAttributeNS(null,"y","0"),w.setAttributeNS(null,"width","1px"),w.setAttributeNS(null,"height","1px"),w.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(w)}paintImageXObject(w){let C=w.startsWith("g_")?this.commonObjs.get(w):this.objs.get(w);if(!C){(0,n.warn)(`Dependent image with object ID ${w} is not ready yet`);return}this.paintInlineImageXObject(C)}paintInlineImageXObject(w,C){let A=w.width,D=w.height,M=p(w,this.forceDataSchema,!!C),I=this.svgFactory.createElement("svg:rect");I.setAttributeNS(null,"x","0"),I.setAttributeNS(null,"y","0"),I.setAttributeNS(null,"width",g(A)),I.setAttributeNS(null,"height",g(D)),this.current.element=I,this.clip("nonzero");let O=this.svgFactory.createElement("svg:image");O.setAttributeNS(c,"xlink:href",M),O.setAttributeNS(null,"x","0"),O.setAttributeNS(null,"y",g(-D)),O.setAttributeNS(null,"width",g(A)+"px"),O.setAttributeNS(null,"height",g(D)+"px"),O.setAttributeNS(null,"transform",`scale(${g(1/A)} ${g(-1/D)})`),C?C.append(O):this._ensureTransformGroup().append(O)}paintImageMaskXObject(w){let C=this.current,A=w.width,D=w.height,M=C.fillColor;C.maskId=`mask${E++}`;let I=this.svgFactory.createElement("svg:mask");I.setAttributeNS(null,"id",C.maskId);let O=this.svgFactory.createElement("svg:rect");O.setAttributeNS(null,"x","0"),O.setAttributeNS(null,"y","0"),O.setAttributeNS(null,"width",g(A)),O.setAttributeNS(null,"height",g(D)),O.setAttributeNS(null,"fill",M),O.setAttributeNS(null,"mask",`url(#${C.maskId})`),this.defs.append(I),this._ensureTransformGroup().append(O),this.paintInlineImageXObject(w,I)}paintFormXObjectBegin(w,C){if(Array.isArray(w)&&w.length===6&&this.transform(w[0],w[1],w[2],w[3],w[4],w[5]),C){let A=C[2]-C[0],D=C[3]-C[1],M=this.svgFactory.createElement("svg:rect");M.setAttributeNS(null,"x",C[0]),M.setAttributeNS(null,"y",C[1]),M.setAttributeNS(null,"width",g(A)),M.setAttributeNS(null,"height",g(D)),this.current.element=M,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(w){let C=this.svgFactory.create(w.width,w.height),A=this.svgFactory.createElement("svg:defs");C.append(A),this.defs=A;let D=this.svgFactory.createElement("svg:g");return D.setAttributeNS(null,"transform",b(w.transform)),C.append(D),this.svg=D,C}_ensureClipGroup(){if(!this.current.clipGroup){let w=this.svgFactory.createElement("svg:g");w.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(w),this.current.clipGroup=w}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",b(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}}},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNodeStream=void 0;var i=t(1),n=t(33);let r=r_(),o=UO(),a=BO(),l=zO(),c=/^file:\/\/\/[a-zA-Z]:\//;function d(E){let y=l.parse(E);return y.protocol==="file:"||y.host?y:/^[a-z]:[/\\]/i.test(E)?l.parse(`file:///${E}`):(y.host||(y.protocol="file:"),y)}class h{constructor(y){this.source=y,this.url=d(y.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&y.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,i.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new b(this):new m(this),this._fullRequestReader}getRangeReader(y,w){if(w<=this._progressiveDataLength)return null;let C=this.isFsUrl?new v(this,y,w):new g(this,y,w);return this._rangeRequestReaders.push(C),C}cancelAllRequests(y){this._fullRequestReader&&this._fullRequestReader.cancel(y);for(let w of this._rangeRequestReaders.slice(0))w.cancel(y)}}e.PDFNodeStream=h;class u{constructor(y){this._url=y.url,this._done=!1,this._storedError=null,this.onProgress=null;let w=y.source;this._contentLength=w.length,this._loaded=0,this._filename=null,this._disableRange=w.disableRange||!1,this._rangeChunkSize=w.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!w.disableStream,this._isRangeSupported=!w.disableRange,this._readableStream=null,this._readCapability=(0,i.createPromiseCapability)(),this._headersCapability=(0,i.createPromiseCapability)()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}read(){return ie(this,null,function*(){if(yield this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let y=this._readableStream.read();return y===null?(this._readCapability=(0,i.createPromiseCapability)(),this.read()):(this._loaded+=y.length,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(y).buffer,done:!1})})}cancel(y){if(!this._readableStream){this._error(y);return}this._readableStream.destroy(y)}_error(y){this._storedError=y,this._readCapability.resolve()}_setReadableStream(y){this._readableStream=y,y.on("readable",()=>{this._readCapability.resolve()}),y.on("end",()=>{y.destroy(),this._done=!0,this._readCapability.resolve()}),y.on("error",w=>{this._error(w)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new i.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class p{constructor(y){this._url=y.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=(0,i.createPromiseCapability)();let w=y.source;this._isStreamingSupported=!w.disableStream}get isStreamingSupported(){return this._isStreamingSupported}read(){return ie(this,null,function*(){if(yield this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let y=this._readableStream.read();return y===null?(this._readCapability=(0,i.createPromiseCapability)(),this.read()):(this._loaded+=y.length,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(y).buffer,done:!1})})}cancel(y){if(!this._readableStream){this._error(y);return}this._readableStream.destroy(y)}_error(y){this._storedError=y,this._readCapability.resolve()}_setReadableStream(y){this._readableStream=y,y.on("readable",()=>{this._readCapability.resolve()}),y.on("end",()=>{y.destroy(),this._done=!0,this._readCapability.resolve()}),y.on("error",w=>{this._error(w)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function f(E,y){return{protocol:E.protocol,auth:E.auth,host:E.hostname,port:E.port,path:E.path,method:"GET",headers:y}}class m extends u{constructor(y){super(y);let w=C=>{if(C.statusCode===404){let I=new i.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=I,this._headersCapability.reject(I);return}this._headersCapability.resolve(),this._setReadableStream(C);let A=I=>this._readableStream.headers[I.toLowerCase()],{allowRangeRequests:D,suggestedLength:M}=(0,n.validateRangeRequestCapabilities)({getResponseHeader:A,isHttp:y.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=D,this._contentLength=M||this._contentLength,this._filename=(0,n.extractFilenameFromHeader)(A)};this._request=null,this._url.protocol==="http:"?this._request=o.request(f(this._url,y.httpHeaders),w):this._request=a.request(f(this._url,y.httpHeaders),w),this._request.on("error",C=>{this._storedError=C,this._headersCapability.reject(C)}),this._request.end()}}class g extends p{constructor(y,w,C){super(y),this._httpHeaders={};for(let D in y.httpHeaders){let M=y.httpHeaders[D];typeof M>"u"||(this._httpHeaders[D]=M)}this._httpHeaders.Range=`bytes=${w}-${C-1}`;let A=D=>{if(D.statusCode===404){let M=new i.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=M;return}this._setReadableStream(D)};this._request=null,this._url.protocol==="http:"?this._request=o.request(f(this._url,this._httpHeaders),A):this._request=a.request(f(this._url,this._httpHeaders),A),this._request.on("error",D=>{this._storedError=D}),this._request.end()}}class b extends u{constructor(y){super(y);let w=decodeURIComponent(this._url.path);c.test(this._url.href)&&(w=w.replace(/^\//,"")),r.lstat(w,(C,A)=>{if(C){C.code==="ENOENT"&&(C=new i.MissingPDFException(`Missing PDF "${w}".`)),this._storedError=C,this._headersCapability.reject(C);return}this._contentLength=A.size,this._setReadableStream(r.createReadStream(w)),this._headersCapability.resolve()})}}class v extends p{constructor(y,w,C){super(y);let A=decodeURIComponent(this._url.path);c.test(this._url.href)&&(A=A.replace(/^\//,"")),this._setReadableStream(r.createReadStream(A,{start:w,end:C-1}))}}},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createResponseStatusError=l,e.extractFilenameFromHeader=a,e.validateRangeRequestCapabilities=o,e.validateResponseStatus=c;var i=t(1),n=t(34),r=t(8);function o({getResponseHeader:d,isHttp:h,rangeChunkSize:u,disableRange:p}){let f={allowRangeRequests:!1,suggestedLength:void 0},m=parseInt(d("Content-Length"),10);return!Number.isInteger(m)||(f.suggestedLength=m,m<=2*u)||p||!h||d("Accept-Ranges")!=="bytes"||(d("Content-Encoding")||"identity")!=="identity"||(f.allowRangeRequests=!0),f}function a(d){let h=d("Content-Disposition");if(h){let u=(0,n.getFilenameFromContentDispositionHeader)(h);if(u.includes("%"))try{u=decodeURIComponent(u)}catch{}if((0,r.isPdfFile)(u))return u}return null}function l(d,h){return d===404||d===0&&h.startsWith("file:")?new i.MissingPDFException('Missing PDF "'+h+'".'):new i.UnexpectedResponseException(`Unexpected server response (${d}) while retrieving PDF "${h}".`,d)}function c(d){return d===200||d===206}},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getFilenameFromContentDispositionHeader=n;var i=t(1);function n(r){let o=!0,a=l("filename\\*","i").exec(r);if(a){a=a[1];let m=u(a);return m=unescape(m),m=p(m),m=f(m),d(m)}if(a=h(r),a){let m=f(a);return d(m)}if(a=l("filename","i").exec(r),a){a=a[1];let m=u(a);return m=f(m),d(m)}function l(m,g){return new RegExp("(?:^|;)\\s*"+m+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',g)}function c(m,g){if(m){if(!/^[\x00-\xFF]+$/.test(g))return g;try{let b=new TextDecoder(m,{fatal:!0}),v=(0,i.stringToBytes)(g);g=b.decode(v),o=!1}catch{}}return g}function d(m){return o&&/[\x80-\xff]/.test(m)&&(m=c("utf-8",m),o&&(m=c("iso-8859-1",m))),m}function h(m){let g=[],b,v=l("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(b=v.exec(m))!==null;){let[,y,w,C]=b;if(y=parseInt(y,10),y in g){if(y===0)break;continue}g[y]=[w,C]}let E=[];for(let y=0;y<g.length&&y in g;++y){let[w,C]=g[y];C=u(C),w&&(C=unescape(C),y===0&&(C=p(C))),E.push(C)}return E.join("")}function u(m){if(m.startsWith('"')){let g=m.slice(1).split('\\"');for(let b=0;b<g.length;++b){let v=g[b].indexOf('"');v!==-1&&(g[b]=g[b].slice(0,v),g.length=b+1),g[b]=g[b].replace(/\\(.)/g,"$1")}m=g.join('"')}return m}function p(m){let g=m.indexOf("'");if(g===-1)return m;let b=m.slice(0,g),E=m.slice(g+1).replace(/^[^']*'/,"");return c(b,E)}function f(m){return!m.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(m)?m:m.replace(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(g,b,v,E){if(v==="q"||v==="Q")return E=E.replace(/_/g," "),E=E.replace(/=([0-9a-fA-F]{2})/g,function(y,w){return String.fromCharCode(parseInt(w,16))}),c(b,E);try{E=atob(E)}catch{}return c(b,E)})}return""}},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFNetworkStream=void 0;var i=t(1),n=t(33);let r=200,o=206;function a(u){let p=u.response;return typeof p!="string"?p:(0,i.stringToBytes)(p).buffer}class l{constructor(p,f={}){this.url=p,this.isHttp=/^https?:/i.test(p),this.httpHeaders=this.isHttp&&f.httpHeaders||Object.create(null),this.withCredentials=f.withCredentials||!1,this.getXhr=f.getXhr||function(){return new XMLHttpRequest},this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(p,f,m){let g={begin:p,end:f};for(let b in m)g[b]=m[b];return this.request(g)}requestFull(p){return this.request(p)}request(p){let f=this.getXhr(),m=this.currXhrId++,g=this.pendingRequests[m]={xhr:f};f.open("GET",this.url),f.withCredentials=this.withCredentials;for(let b in this.httpHeaders){let v=this.httpHeaders[b];typeof v>"u"||f.setRequestHeader(b,v)}return this.isHttp&&"begin"in p&&"end"in p?(f.setRequestHeader("Range",`bytes=${p.begin}-${p.end-1}`),g.expectedStatus=o):g.expectedStatus=r,f.responseType="arraybuffer",p.onError&&(f.onerror=function(b){p.onError(f.status)}),f.onreadystatechange=this.onStateChange.bind(this,m),f.onprogress=this.onProgress.bind(this,m),g.onHeadersReceived=p.onHeadersReceived,g.onDone=p.onDone,g.onError=p.onError,g.onProgress=p.onProgress,f.send(null),m}onProgress(p,f){let m=this.pendingRequests[p];m&&m.onProgress?.(f)}onStateChange(p,f){let m=this.pendingRequests[p];if(!m)return;let g=m.xhr;if(g.readyState>=2&&m.onHeadersReceived&&(m.onHeadersReceived(),delete m.onHeadersReceived),g.readyState!==4||!(p in this.pendingRequests))return;if(delete this.pendingRequests[p],g.status===0&&this.isHttp){m.onError?.(g.status);return}let b=g.status||r;if(!(b===r&&m.expectedStatus===o)&&b!==m.expectedStatus){m.onError?.(g.status);return}let E=a(g);if(b===o){let y=g.getResponseHeader("Content-Range"),w=/bytes (\d+)-(\d+)\/(\d+)/.exec(y);m.onDone({begin:parseInt(w[1],10),chunk:E})}else E?m.onDone({begin:0,chunk:E}):m.onError?.(g.status)}getRequestXhr(p){return this.pendingRequests[p].xhr}isPendingRequest(p){return p in this.pendingRequests}abortRequest(p){let f=this.pendingRequests[p].xhr;delete this.pendingRequests[p],f.abort()}}class c{constructor(p){this._source=p,this._manager=new l(p.url,{httpHeaders:p.httpHeaders,withCredentials:p.withCredentials}),this._rangeChunkSize=p.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(p){let f=this._rangeRequestReaders.indexOf(p);f>=0&&this._rangeRequestReaders.splice(f,1)}getFullReader(){return(0,i.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new d(this._manager,this._source),this._fullRequestReader}getRangeReader(p,f){let m=new h(this._manager,p,f);return m.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(m),m}cancelAllRequests(p){this._fullRequestReader?.cancel(p);for(let f of this._rangeRequestReaders.slice(0))f.cancel(p)}}e.PDFNetworkStream=c;class d{constructor(p,f){this._manager=p;let m={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=f.url,this._fullRequestId=p.requestFull(m),this._headersReceivedCapability=(0,i.createPromiseCapability)(),this._disableRange=f.disableRange||!1,this._contentLength=f.length,this._rangeChunkSize=f.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let p=this._fullRequestId,f=this._manager.getRequestXhr(p),m=v=>f.getResponseHeader(v),{allowRangeRequests:g,suggestedLength:b}=(0,n.validateRangeRequestCapabilities)({getResponseHeader:m,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});g&&(this._isRangeSupported=!0),this._contentLength=b||this._contentLength,this._filename=(0,n.extractFilenameFromHeader)(m),this._isRangeSupported&&this._manager.abortRequest(p),this._headersReceivedCapability.resolve()}_onDone(p){if(p&&(this._requests.length>0?this._requests.shift().resolve({value:p.chunk,done:!1}):this._cachedChunks.push(p.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let f of this._requests)f.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(p){this._storedError=(0,n.createResponseStatusError)(p,this._url),this._headersReceivedCapability.reject(this._storedError);for(let f of this._requests)f.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(p){this.onProgress?.({loaded:p.loaded,total:p.lengthComputable?p.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}read(){return ie(this,null,function*(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let p=(0,i.createPromiseCapability)();return this._requests.push(p),p.promise})}cancel(p){this._done=!0,this._headersReceivedCapability.reject(p);for(let f of this._requests)f.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class h{constructor(p,f,m){this._manager=p;let g={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=p.url,this._requestId=p.requestRange(f,m,g),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(p){let f=p.chunk;this._requests.length>0?this._requests.shift().resolve({value:f,done:!1}):this._queuedChunk=f,this._done=!0;for(let m of this._requests)m.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(p){this._storedError=(0,n.createResponseStatusError)(p,this._url);for(let f of this._requests)f.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(p){this.isStreamingSupported||this.onProgress?.({loaded:p.loaded})}get isStreamingSupported(){return!1}read(){return ie(this,null,function*(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){let f=this._queuedChunk;return this._queuedChunk=null,{value:f,done:!1}}if(this._done)return{value:void 0,done:!0};let p=(0,i.createPromiseCapability)();return this._requests.push(p),p.promise})}cancel(p){this._done=!0;for(let f of this._requests)f.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(s,e,t)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PDFFetchStream=void 0;var i=t(1),n=t(33);function r(d,h,u){return{method:"GET",headers:d,signal:u.signal,mode:"cors",credentials:h?"include":"same-origin",redirect:"follow"}}function o(d){let h=new Headers;for(let u in d){let p=d[u];typeof p>"u"||h.append(u,p)}return h}class a{constructor(h){this.source=h,this.isHttp=/^https?:/i.test(h.url),this.httpHeaders=this.isHttp&&h.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,i.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new l(this),this._fullRequestReader}getRangeReader(h,u){if(u<=this._progressiveDataLength)return null;let p=new c(this,h,u);return this._rangeRequestReaders.push(p),p}cancelAllRequests(h){this._fullRequestReader&&this._fullRequestReader.cancel(h);for(let u of this._rangeRequestReaders.slice(0))u.cancel(h)}}e.PDFFetchStream=a;class l{constructor(h){this._stream=h,this._reader=null,this._loaded=0,this._filename=null;let u=h.source;this._withCredentials=u.withCredentials||!1,this._contentLength=u.length,this._headersCapability=(0,i.createPromiseCapability)(),this._disableRange=u.disableRange||!1,this._rangeChunkSize=u.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!u.disableStream,this._isRangeSupported=!u.disableRange,this._headers=o(this._stream.httpHeaders);let p=u.url;fetch(p,r(this._headers,this._withCredentials,this._abortController)).then(f=>{if(!(0,n.validateResponseStatus)(f.status))throw(0,n.createResponseStatusError)(f.status,p);this._reader=f.body.getReader(),this._headersCapability.resolve();let m=v=>f.headers.get(v),{allowRangeRequests:g,suggestedLength:b}=(0,n.validateRangeRequestCapabilities)({getResponseHeader:m,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=g,this._contentLength=b||this._contentLength,this._filename=(0,n.extractFilenameFromHeader)(m),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new i.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}read(){return ie(this,null,function*(){yield this._headersCapability.promise;let{value:h,done:u}=yield this._reader.read();return u?{value:h,done:u}:(this._loaded+=h.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(h).buffer,done:!1})})}cancel(h){this._reader&&this._reader.cancel(h),this._abortController.abort()}}class c{constructor(h,u,p){this._stream=h,this._reader=null,this._loaded=0;let f=h.source;this._withCredentials=f.withCredentials||!1,this._readCapability=(0,i.createPromiseCapability)(),this._isStreamingSupported=!f.disableStream,this._abortController=new AbortController,this._headers=o(this._stream.httpHeaders),this._headers.append("Range",`bytes=${u}-${p-1}`);let m=f.url;fetch(m,r(this._headers,this._withCredentials,this._abortController)).then(g=>{if(!(0,n.validateResponseStatus)(g.status))throw(0,n.createResponseStatusError)(g.status,m);this._readCapability.resolve(),this._reader=g.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}read(){return ie(this,null,function*(){yield this._readCapability.promise;let{value:h,done:u}=yield this._reader.read();return u?{value:h,done:u}:(this._loaded+=h.byteLength,this.onProgress&&this.onProgress({loaded:this._loaded}),{value:new Uint8Array(h).buffer,done:!1})})}cancel(h){this._reader&&this._reader.cancel(h),this._abortController.abort()}}}],__webpack_module_cache__={};function __w_pdfjs_require__(s){var e=__webpack_module_cache__[s];if(e!==void 0)return e.exports;var t=__webpack_module_cache__[s]={exports:{}};return __webpack_modules__[s](t,t.exports,__w_pdfjs_require__),t.exports}var __webpack_exports__={};return(()=>{var s=__webpack_exports__;Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"AnnotationEditorLayer",{enumerable:!0,get:function(){return n.AnnotationEditorLayer}}),Object.defineProperty(s,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return e.AnnotationEditorParamsType}}),Object.defineProperty(s,"AnnotationEditorType",{enumerable:!0,get:function(){return e.AnnotationEditorType}}),Object.defineProperty(s,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return r.AnnotationEditorUIManager}}),Object.defineProperty(s,"AnnotationLayer",{enumerable:!0,get:function(){return o.AnnotationLayer}}),Object.defineProperty(s,"AnnotationMode",{enumerable:!0,get:function(){return e.AnnotationMode}}),Object.defineProperty(s,"CMapCompressionType",{enumerable:!0,get:function(){return e.CMapCompressionType}}),Object.defineProperty(s,"GlobalWorkerOptions",{enumerable:!0,get:function(){return a.GlobalWorkerOptions}}),Object.defineProperty(s,"InvalidPDFException",{enumerable:!0,get:function(){return e.InvalidPDFException}}),Object.defineProperty(s,"LoopbackPort",{enumerable:!0,get:function(){return t.LoopbackPort}}),Object.defineProperty(s,"MissingPDFException",{enumerable:!0,get:function(){return e.MissingPDFException}}),Object.defineProperty(s,"OPS",{enumerable:!0,get:function(){return e.OPS}}),Object.defineProperty(s,"PDFDataRangeTransport",{enumerable:!0,get:function(){return t.PDFDataRangeTransport}}),Object.defineProperty(s,"PDFDateString",{enumerable:!0,get:function(){return i.PDFDateString}}),Object.defineProperty(s,"PDFWorker",{enumerable:!0,get:function(){return t.PDFWorker}}),Object.defineProperty(s,"PasswordResponses",{enumerable:!0,get:function(){return e.PasswordResponses}}),Object.defineProperty(s,"PermissionFlag",{enumerable:!0,get:function(){return e.PermissionFlag}}),Object.defineProperty(s,"PixelsPerInch",{enumerable:!0,get:function(){return i.PixelsPerInch}}),Object.defineProperty(s,"RenderingCancelledException",{enumerable:!0,get:function(){return i.RenderingCancelledException}}),Object.defineProperty(s,"SVGGraphics",{enumerable:!0,get:function(){return d.SVGGraphics}}),Object.defineProperty(s,"UNSUPPORTED_FEATURES",{enumerable:!0,get:function(){return e.UNSUPPORTED_FEATURES}}),Object.defineProperty(s,"UnexpectedResponseException",{enumerable:!0,get:function(){return e.UnexpectedResponseException}}),Object.defineProperty(s,"Util",{enumerable:!0,get:function(){return e.Util}}),Object.defineProperty(s,"VerbosityLevel",{enumerable:!0,get:function(){return e.VerbosityLevel}}),Object.defineProperty(s,"XfaLayer",{enumerable:!0,get:function(){return h.XfaLayer}}),Object.defineProperty(s,"build",{enumerable:!0,get:function(){return t.build}}),Object.defineProperty(s,"createPromiseCapability",{enumerable:!0,get:function(){return e.createPromiseCapability}}),Object.defineProperty(s,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return e.createValidAbsoluteUrl}}),Object.defineProperty(s,"getDocument",{enumerable:!0,get:function(){return t.getDocument}}),Object.defineProperty(s,"getFilenameFromUrl",{enumerable:!0,get:function(){return i.getFilenameFromUrl}}),Object.defineProperty(s,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return i.getPdfFilenameFromUrl}}),Object.defineProperty(s,"getXfaPageViewport",{enumerable:!0,get:function(){return i.getXfaPageViewport}}),Object.defineProperty(s,"isPdfFile",{enumerable:!0,get:function(){return i.isPdfFile}}),Object.defineProperty(s,"loadScript",{enumerable:!0,get:function(){return i.loadScript}}),Object.defineProperty(s,"renderTextLayer",{enumerable:!0,get:function(){return c.renderTextLayer}}),Object.defineProperty(s,"shadow",{enumerable:!0,get:function(){return e.shadow}}),Object.defineProperty(s,"version",{enumerable:!0,get:function(){return t.version}});var e=__w_pdfjs_require__(1),t=__w_pdfjs_require__(4),i=__w_pdfjs_require__(8),n=__w_pdfjs_require__(22),r=__w_pdfjs_require__(7),o=__w_pdfjs_require__(27),a=__w_pdfjs_require__(15),l=__w_pdfjs_require__(3),c=__w_pdfjs_require__(30),d=__w_pdfjs_require__(31),h=__w_pdfjs_require__(29);let u="2.16.105",p="172ccdbe5";if(l.isNodeJS){let{PDFNodeStream:f}=__w_pdfjs_require__(32);(0,t.setPDFNetworkStreamFactory)(m=>new f(m))}else{let{PDFNetworkStream:f}=__w_pdfjs_require__(35),{PDFFetchStream:m}=__w_pdfjs_require__(36);(0,t.setPDFNetworkStreamFactory)(g=>(0,i.isValidFetchUrl)(g.url)?new m(g):new f(g))}})(),__webpack_exports__})())});var VO=vr((Cm,a_)=>{"use strict";(function(e,t){typeof Cm=="object"&&typeof a_=="object"?a_.exports=t():typeof define=="function"&&define.amd?define("pdfjs-dist/web/pdf_viewer",[],t):typeof Cm=="object"?Cm["pdfjs-dist/web/pdf_viewer"]=t():e["pdfjs-dist/web/pdf_viewer"]=e.pdfjsViewer=t()})(globalThis,()=>(()=>{"use strict";var s=[,(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DefaultXfaLayerFactory=r.DefaultTextLayerFactory=r.DefaultStructTreeLayerFactory=r.DefaultAnnotationLayerFactory=r.DefaultAnnotationEditorLayerFactory=void 0;var a=o(2),l=o(5),c=o(4),d=o(6),h=o(8),u=o(9),p=o(10);class f{createAnnotationLayerBuilder({pageDiv:y,pdfPage:w,annotationStorage:C=null,imageResourcesPath:A="",renderForms:D=!0,l10n:M=c.NullL10n,enableScripting:I=!1,hasJSActionsPromise:O=null,mouseState:F=null,fieldObjectsPromise:V=null,annotationCanvasMap:x=null,accessibilityManager:N=null}){return new l.AnnotationLayerBuilder({pageDiv:y,pdfPage:w,imageResourcesPath:A,renderForms:D,linkService:new d.SimpleLinkService,l10n:M,annotationStorage:C,enableScripting:I,hasJSActionsPromise:O,fieldObjectsPromise:V,mouseState:F,annotationCanvasMap:x,accessibilityManager:N})}}r.DefaultAnnotationLayerFactory=f;class m{createAnnotationEditorLayerBuilder({uiManager:y=null,pageDiv:w,pdfPage:C,accessibilityManager:A=null,l10n:D,annotationStorage:M=null}){return new a.AnnotationEditorLayerBuilder({uiManager:y,pageDiv:w,pdfPage:C,accessibilityManager:A,l10n:D,annotationStorage:M})}}r.DefaultAnnotationEditorLayerFactory=m;class g{createStructTreeLayerBuilder({pdfPage:y}){return new h.StructTreeLayerBuilder({pdfPage:y})}}r.DefaultStructTreeLayerFactory=g;class b{createTextLayerBuilder({textLayerDiv:y,pageIndex:w,viewport:C,enhanceTextSelection:A=!1,eventBus:D,highlighter:M,accessibilityManager:I=null}){return new u.TextLayerBuilder({textLayerDiv:y,pageIndex:w,viewport:C,enhanceTextSelection:A,eventBus:D,highlighter:M,accessibilityManager:I})}}r.DefaultTextLayerFactory=b;class v{createXfaLayerBuilder({pageDiv:y,pdfPage:w,annotationStorage:C=null}){return new p.XfaLayerBuilder({pageDiv:y,pdfPage:w,annotationStorage:C,linkService:new d.SimpleLinkService})}}r.DefaultXfaLayerFactory=v},(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.AnnotationEditorLayerBuilder=void 0;var a=o(3),l=o(4);class c{#e;constructor(h){this.pageDiv=h.pageDiv,this.pdfPage=h.pdfPage,this.annotationStorage=h.annotationStorage||null,this.accessibilityManager=h.accessibilityManager,this.l10n=h.l10n||l.NullL10n,this.annotationEditorLayer=null,this.div=null,this._cancelled=!1,this.#e=h.uiManager}render(h,u="display"){return ie(this,null,function*(){if(u!=="display"||this._cancelled)return;let p=h.clone({dontFlip:!0});if(this.div){this.annotationEditorLayer.update({viewport:p}),this.show();return}this.div=document.createElement("div"),this.div.className="annotationEditorLayer",this.div.tabIndex=0,this.pageDiv.append(this.div),this.annotationEditorLayer=new a.AnnotationEditorLayer({uiManager:this.#e,div:this.div,annotationStorage:this.annotationStorage,accessibilityManager:this.accessibilityManager,pageIndex:this.pdfPage._pageIndex,l10n:this.l10n,viewport:p});let f={viewport:p,div:this.div,annotations:null,intent:u};this.annotationEditorLayer.render(f)})}cancel(){this._cancelled=!0,this.destroy()}hide(){this.div&&(this.div.hidden=!0)}show(){this.div&&(this.div.hidden=!1)}destroy(){this.div&&(this.pageDiv=null,this.annotationEditorLayer.destroy(),this.div.remove())}}r.AnnotationEditorLayerBuilder=c},n=>{let r;typeof window<"u"&&window["pdfjs-dist/build/pdf"]?r=window["pdfjs-dist/build/pdf"]:r=o_(),n.exports=r},(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.NullL10n=void 0,r.fixupLangCode=c,r.getL10nFallback=a;let o={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} \xD7 {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} \xD7 {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",print_progress_percent:"{{progress}}%","toggle_sidebar.title":"Toggle Sidebar","toggle_sidebar_notification2.title":"Toggle Sidebar (document contains outline/attachments/layers)",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",error_version_info:"PDF.js v{{version}} (build: {{build}})",error_message:"Message: {{message}}",error_stack:"Stack: {{stack}}",error_file:"File: {{file}}",error_line:"Line: {{line}}",rendering_error:"An error occurred while rendering the page.",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading:"Loading\u2026",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text_default_content:"Enter text\u2026",editor_free_text_aria_label:"FreeText Editor",editor_ink_aria_label:"Ink Editor",editor_ink_canvas_aria_label:"User-created image"};function a(p,f){switch(p){case"find_match_count":p=`find_match_count[${f.total===1?"one":"other"}]`;break;case"find_match_count_limit":p=`find_match_count_limit[${f.limit===1?"one":"other"}]`;break}return o[p]||""}let l={en:"en-US",es:"es-ES",fy:"fy-NL",ga:"ga-IE",gu:"gu-IN",hi:"hi-IN",hy:"hy-AM",nb:"nb-NO",ne:"ne-NP",nn:"nn-NO",pa:"pa-IN",pt:"pt-PT",sv:"sv-SE",zh:"zh-CN"};function c(p){return l[p?.toLowerCase()]||p}function d(p,f){return f?p.replace(/\{\{\s*(\w+)\s*\}\}/g,(m,g)=>g in f?f[g]:"{{"+g+"}}"):p}let h={getLanguage(){return ie(this,null,function*(){return"en-us"})},getDirection(){return ie(this,null,function*(){return"ltr"})},get(g){return ie(this,arguments,function*(p,f=null,m=a(p,f)){return d(m,f)})},translate(p){return ie(this,null,function*(){})}};r.NullL10n=h},(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.AnnotationLayerBuilder=void 0;var a=o(3),l=o(4);class c{constructor({pageDiv:h,pdfPage:u,linkService:p,downloadManager:f,annotationStorage:m=null,imageResourcesPath:g="",renderForms:b=!0,l10n:v=l.NullL10n,enableScripting:E=!1,hasJSActionsPromise:y=null,fieldObjectsPromise:w=null,mouseState:C=null,annotationCanvasMap:A=null,accessibilityManager:D=null}){this.pageDiv=h,this.pdfPage=u,this.linkService=p,this.downloadManager=f,this.imageResourcesPath=g,this.renderForms=b,this.l10n=v,this.annotationStorage=m,this.enableScripting=E,this._hasJSActionsPromise=y,this._fieldObjectsPromise=w,this._mouseState=C,this._annotationCanvasMap=A,this._accessibilityManager=D,this.div=null,this._cancelled=!1}render(h,u="display"){return ie(this,null,function*(){let[p,f=!1,m=null]=yield Promise.all([this.pdfPage.getAnnotations({intent:u}),this._hasJSActionsPromise,this._fieldObjectsPromise]);if(this._cancelled||p.length===0)return;let g={viewport:h.clone({dontFlip:!0}),div:this.div,annotations:p,page:this.pdfPage,imageResourcesPath:this.imageResourcesPath,renderForms:this.renderForms,linkService:this.linkService,downloadManager:this.downloadManager,annotationStorage:this.annotationStorage,enableScripting:this.enableScripting,hasJSActions:f,fieldObjects:m,mouseState:this._mouseState,annotationCanvasMap:this._annotationCanvasMap,accessibilityManager:this._accessibilityManager};this.div?a.AnnotationLayer.update(g):(this.div=document.createElement("div"),this.div.className="annotationLayer",this.pageDiv.append(this.div),g.div=this.div,a.AnnotationLayer.render(g),this.l10n.translate(this.div))})}cancel(){this._cancelled=!0}hide(){this.div&&(this.div.hidden=!0)}}r.AnnotationLayerBuilder=c},(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.SimpleLinkService=r.PDFLinkService=r.LinkTarget=void 0;var a=o(7);let l="noopener noreferrer nofollow",c={NONE:0,SELF:1,BLANK:2,PARENT:3,TOP:4};r.LinkTarget=c;function d(p,{url:f,target:m,rel:g,enabled:b=!0}={}){if(!f||typeof f!="string")throw new Error('A valid "url" parameter must provided.');let v=(0,a.removeNullCharacters)(f);b?p.href=p.title=v:(p.href="",p.title=`Disabled: ${v}`,p.onclick=()=>!1);let E="";switch(m){case c.NONE:break;case c.SELF:E="_self";break;case c.BLANK:E="_blank";break;case c.PARENT:E="_parent";break;case c.TOP:E="_top";break}p.target=E,p.rel=typeof g=="string"?g:l}class h{#e=new Map;constructor({eventBus:f,externalLinkTarget:m=null,externalLinkRel:g=null,ignoreDestinationZoom:b=!1}={}){this.eventBus=f,this.externalLinkTarget=m,this.externalLinkRel=g,this.externalLinkEnabled=!0,this._ignoreDestinationZoom=b,this.baseUrl=null,this.pdfDocument=null,this.pdfViewer=null,this.pdfHistory=null}setDocument(f,m=null){this.baseUrl=m,this.pdfDocument=f,this.#e.clear()}setViewer(f){this.pdfViewer=f}setHistory(f){this.pdfHistory=f}get pagesCount(){return this.pdfDocument?this.pdfDocument.numPages:0}get page(){return this.pdfViewer.currentPageNumber}set page(f){this.pdfViewer.currentPageNumber=f}get rotation(){return this.pdfViewer.pagesRotation}set rotation(f){this.pdfViewer.pagesRotation=f}#t(f,m=null,g){let b=g[0],v;if(typeof b=="object"&&b!==null){if(v=this._cachedPageNumber(b),!v){this.pdfDocument.getPageIndex(b).then(E=>{this.cachePageRef(E+1,b),this.#t(f,m,g)}).catch(()=>{console.error(`PDFLinkService.#goToDestinationHelper: "${b}" is not a valid page reference, for dest="${f}".`)});return}}else if(Number.isInteger(b))v=b+1;else{console.error(`PDFLinkService.#goToDestinationHelper: "${b}" is not a valid destination reference, for dest="${f}".`);return}if(!v||v<1||v>this.pagesCount){console.error(`PDFLinkService.#goToDestinationHelper: "${v}" is not a valid page number, for dest="${f}".`);return}this.pdfHistory&&(this.pdfHistory.pushCurrentPosition(),this.pdfHistory.push({namedDest:m,explicitDest:g,pageNumber:v})),this.pdfViewer.scrollPageIntoView({pageNumber:v,destArray:g,ignoreDestinationZoom:this._ignoreDestinationZoom})}goToDestination(f){return ie(this,null,function*(){if(!this.pdfDocument)return;let m,g;if(typeof f=="string"?(m=f,g=yield this.pdfDocument.getDestination(f)):(m=null,g=yield f),!Array.isArray(g)){console.error(`PDFLinkService.goToDestination: "${g}" is not a valid destination array, for dest="${f}".`);return}this.#t(f,m,g)})}goToPage(f){if(!this.pdfDocument)return;let m=typeof f=="string"&&this.pdfViewer.pageLabelToPageNumber(f)||f|0;if(!(Number.isInteger(m)&&m>0&&m<=this.pagesCount)){console.error(`PDFLinkService.goToPage: "${f}" is not a valid page.`);return}this.pdfHistory&&(this.pdfHistory.pushCurrentPosition(),this.pdfHistory.pushPage(m)),this.pdfViewer.scrollPageIntoView({pageNumber:m})}addLinkAttributes(f,m,g=!1){d(f,{url:m,target:g?c.BLANK:this.externalLinkTarget,rel:this.externalLinkRel,enabled:this.externalLinkEnabled})}getDestinationHash(f){if(typeof f=="string"){if(f.length>0)return this.getAnchorUrl("#"+escape(f))}else if(Array.isArray(f)){let m=JSON.stringify(f);if(m.length>0)return this.getAnchorUrl("#"+escape(m))}return this.getAnchorUrl("")}getAnchorUrl(f){return(this.baseUrl||"")+f}setHash(f){if(!this.pdfDocument)return;let m,g;if(f.includes("=")){let b=(0,a.parseQueryString)(f);if(b.has("search")&&this.eventBus.dispatch("findfromurlhash",{source:this,query:b.get("search").replace(/"/g,""),phraseSearch:b.get("phrase")==="true"}),b.has("page")&&(m=b.get("page")|0||1),b.has("zoom")){let v=b.get("zoom").split(","),E=v[0],y=parseFloat(E);E.includes("Fit")?E==="Fit"||E==="FitB"?g=[null,{name:E}]:E==="FitH"||E==="FitBH"||E==="FitV"||E==="FitBV"?g=[null,{name:E},v.length>1?v[1]|0:null]:E==="FitR"?v.length!==5?console.error('PDFLinkService.setHash: Not enough parameters for "FitR".'):g=[null,{name:E},v[1]|0,v[2]|0,v[3]|0,v[4]|0]:console.error(`PDFLinkService.setHash: "${E}" is not a valid zoom value.`):g=[null,{name:"XYZ"},v.length>1?v[1]|0:null,v.length>2?v[2]|0:null,y?y/100:E]}g?this.pdfViewer.scrollPageIntoView({pageNumber:m||this.page,destArray:g,allowNegativeOffset:!0}):m&&(this.page=m),b.has("pagemode")&&this.eventBus.dispatch("pagemode",{source:this,mode:b.get("pagemode")}),b.has("nameddest")&&this.goToDestination(b.get("nameddest"))}else{g=unescape(f);try{g=JSON.parse(g),Array.isArray(g)||(g=g.toString())}catch{}if(typeof g=="string"||h.#i(g)){this.goToDestination(g);return}console.error(`PDFLinkService.setHash: "${unescape(f)}" is not a valid destination.`)}}executeNamedAction(f){switch(f){case"GoBack":this.pdfHistory?.back();break;case"GoForward":this.pdfHistory?.forward();break;case"NextPage":this.pdfViewer.nextPage();break;case"PrevPage":this.pdfViewer.previousPage();break;case"LastPage":this.page=this.pagesCount;break;case"FirstPage":this.page=1;break;default:break}this.eventBus.dispatch("namedaction",{source:this,action:f})}cachePageRef(f,m){if(!m)return;let g=m.gen===0?`${m.num}R`:`${m.num}R${m.gen}`;this.#e.set(g,f)}_cachedPageNumber(f){if(!f)return null;let m=f.gen===0?`${f.num}R`:`${f.num}R${f.gen}`;return this.#e.get(m)||null}isPageVisible(f){return this.pdfViewer.isPageVisible(f)}isPageCached(f){return this.pdfViewer.isPageCached(f)}static#i(f){if(!Array.isArray(f))return!1;let m=f.length;if(m<2)return!1;let g=f[0];if(!(typeof g=="object"&&Number.isInteger(g.num)&&Number.isInteger(g.gen))&&!(Number.isInteger(g)&&g>=0))return!1;let b=f[1];if(!(typeof b=="object"&&typeof b.name=="string"))return!1;let v=!0;switch(b.name){case"XYZ":if(m!==5)return!1;break;case"Fit":case"FitB":return m===2;case"FitH":case"FitBH":case"FitV":case"FitBV":if(m!==3)return!1;break;case"FitR":if(m!==6)return!1;v=!1;break;default:return!1}for(let E=2;E<m;E++){let y=f[E];if(!(typeof y=="number"||v&&y===null))return!1}return!0}}r.PDFLinkService=h;class u{constructor(){this.externalLinkEnabled=!0}get pagesCount(){return 0}get page(){return 0}set page(f){}get rotation(){return 0}set rotation(f){}goToDestination(f){return ie(this,null,function*(){})}goToPage(f){}addLinkAttributes(f,m,g=!1){d(f,{url:m,enabled:this.externalLinkEnabled})}getDestinationHash(f){return"#"}getAnchorUrl(f){return"#"}setHash(f){}executeNamedAction(f){}cachePageRef(f,m){}isPageVisible(f){return!0}isPageCached(f){return!0}}r.SimpleLinkService=u},(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.animationStarted=r.VERTICAL_PADDING=r.UNKNOWN_SCALE=r.TextLayerMode=r.SpreadMode=r.SidebarView=r.ScrollMode=r.SCROLLBAR_PADDING=r.RenderingStates=r.RendererType=r.ProgressBar=r.PresentationModeState=r.OutputScale=r.MIN_SCALE=r.MAX_SCALE=r.MAX_AUTO_SCALE=r.DEFAULT_SCALE_VALUE=r.DEFAULT_SCALE_DELTA=r.DEFAULT_SCALE=r.AutoPrintRegExp=void 0,r.apiPageLayoutToViewerModes=de,r.apiPageModeToSidebarView=fe,r.approximateFraction=N,r.backtrackBeforeAllVisibleElements=X,r.binarySearchFirstItem=x,r.docStyle=void 0,r.getActiveOrFocusedElement=pe,r.getPageSizeInches=G,r.getVisibleElements=k,r.isPortraitOrientation=W,r.isValidRotation=$,r.isValidScrollMode=T,r.isValidSpreadMode=U,r.noContextMenuHandler=B,r.normalizeWheelEventDelta=j,r.normalizeWheelEventDirection=R,r.parseQueryString=I,r.removeNullCharacters=V,r.roundToDivide=z,r.scrollIntoView=D,r.watchScroll=M;let o="auto";r.DEFAULT_SCALE_VALUE=o;let a=1;r.DEFAULT_SCALE=a;let l=1.1;r.DEFAULT_SCALE_DELTA=l;let c=.1;r.MIN_SCALE=c;let d=10;r.MAX_SCALE=d;let h=0;r.UNKNOWN_SCALE=h;let u=1.25;r.MAX_AUTO_SCALE=u;let p=40;r.SCROLLBAR_PADDING=p;let f=5;r.VERTICAL_PADDING=f;let m={INITIAL:0,RUNNING:1,PAUSED:2,FINISHED:3};r.RenderingStates=m;let g={UNKNOWN:0,NORMAL:1,CHANGING:2,FULLSCREEN:3};r.PresentationModeState=g;let b={UNKNOWN:-1,NONE:0,THUMBS:1,OUTLINE:2,ATTACHMENTS:3,LAYERS:4};r.SidebarView=b;let v={CANVAS:"canvas",SVG:"svg"};r.RendererType=v;let E={DISABLE:0,ENABLE:1,ENABLE_ENHANCE:2};r.TextLayerMode=E;let y={UNKNOWN:-1,VERTICAL:0,HORIZONTAL:1,WRAPPED:2,PAGE:3};r.ScrollMode=y;let w={UNKNOWN:-1,NONE:0,ODD:1,EVEN:2};r.SpreadMode=w;let C=/\bprint\s*\(/;r.AutoPrintRegExp=C;class A{constructor(){let se=window.devicePixelRatio||1;this.sx=se,this.sy=se}get scaled(){return this.sx!==1||this.sy!==1}}r.OutputScale=A;function D(P,se,re=!1){let K=P.offsetParent;if(!K){console.error("offsetParent is not set -- cannot scroll");return}let ee=P.offsetTop+P.clientTop,le=P.offsetLeft+P.clientLeft;for(;K.clientHeight===K.scrollHeight&&K.clientWidth===K.scrollWidth||re&&(K.classList.contains("markedContent")||getComputedStyle(K).overflow==="hidden");)if(ee+=K.offsetTop,le+=K.offsetLeft,K=K.offsetParent,!K)return;se&&(se.top!==void 0&&(ee+=se.top),se.left!==void 0&&(le+=se.left,K.scrollLeft=le)),K.scrollTop=ee}function M(P,se){let re=function(le){ee||(ee=window.requestAnimationFrame(function(){ee=null;let ge=P.scrollLeft,_e=K.lastX;ge!==_e&&(K.right=ge>_e),K.lastX=ge;let Ue=P.scrollTop,ke=K.lastY;Ue!==ke&&(K.down=Ue>ke),K.lastY=Ue,se(K)}))},K={right:!0,down:!0,lastX:P.scrollLeft,lastY:P.scrollTop,_eventHandler:re},ee=null;return P.addEventListener("scroll",re,!0),K}function I(P){let se=new Map;for(let[re,K]of new URLSearchParams(P))se.set(re.toLowerCase(),K);return se}let O=/\x00/g,F=/[\x01-\x1F]/g;function V(P,se=!1){return typeof P!="string"?(console.error("The argument must be a string."),P):(se&&(P=P.replace(F," ")),P.replace(O,""))}function x(P,se,re=0){let K=re,ee=P.length-1;if(ee<0||!se(P[ee]))return P.length;if(se(P[K]))return K;for(;K<ee;){let le=K+ee>>1,xe=P[le];se(xe)?ee=le:K=le+1}return K}function N(P){if(Math.floor(P)===P)return[P,1];let se=1/P,re=8;if(se>re)return[1,re];if(Math.floor(se)===se)return[1,se];let K=P>1?se:P,ee=0,le=1,xe=1,ge=1;for(;;){let Ue=ee+xe,ke=le+ge;if(ke>re)break;K<=Ue/ke?(xe=Ue,ge=ke):(ee=Ue,le=ke)}let _e;return K-ee/le<xe/ge-K?_e=K===P?[ee,le]:[le,ee]:_e=K===P?[xe,ge]:[ge,xe],_e}function z(P,se){let re=P%se;return re===0?P:Math.round(P-re+se)}function G({view:P,userUnit:se,rotate:re}){let[K,ee,le,xe]=P,ge=re%180!==0,_e=(le-K)/72*se,Ue=(xe-ee)/72*se;return{width:ge?Ue:_e,height:ge?_e:Ue}}function X(P,se,re){if(P<2)return P;let K=se[P].div,ee=K.offsetTop+K.clientTop;ee>=re&&(K=se[P-1].div,ee=K.offsetTop+K.clientTop);for(let le=P-2;le>=0&&(K=se[le].div,!(K.offsetTop+K.clientTop+K.clientHeight<=ee));--le)P=le;return P}function k({scrollEl:P,views:se,sortByVisibility:re=!1,horizontal:K=!1,rtl:ee=!1}){let le=P.scrollTop,xe=le+P.clientHeight,ge=P.scrollLeft,_e=ge+P.clientWidth;function Ue(ci){let Ct=ci.div;return Ct.offsetTop+Ct.clientTop+Ct.clientHeight>le}function ke(ci){let Ct=ci.div,ti=Ct.offsetLeft+Ct.clientLeft,ot=ti+Ct.clientWidth;return ee?ti<_e:ot>ge}let je=[],Qe=new Set,Et=se.length,ht=x(se,K?ke:Ue);ht>0&&ht<Et&&!K&&(ht=X(ht,se,le));let ni=K?_e:-1;for(let ci=ht;ci<Et;ci++){let Ct=se[ci],ti=Ct.div,ot=ti.offsetLeft+ti.clientLeft,yi=ti.offsetTop+ti.clientTop,dn=ti.clientWidth,Fe=ti.clientHeight,he=ot+dn,we=yi+Fe;if(ni===-1)we>=xe&&(ni=we);else if((K?ot:yi)>ni)break;if(we<=le||yi>=xe||he<=ge||ot>=_e)continue;let it=Math.max(0,le-yi)+Math.max(0,we-xe),ut=Math.max(0,ge-ot)+Math.max(0,he-_e),Ut=(Fe-it)/Fe,jt=(dn-ut)/dn,Yn=Ut*jt*100|0;je.push({id:Ct.id,x:ot,y:yi,view:Ct,percent:Yn,widthPercent:jt*100|0}),Qe.add(Ct.id)}let Kt=je[0],It=je.at(-1);return re&&je.sort(function(ci,Ct){let ti=ci.percent-Ct.percent;return Math.abs(ti)>.001?-ti:ci.id-Ct.id}),{first:Kt,last:It,views:je,ids:Qe}}function B(P){P.preventDefault()}function R(P){let se=Math.hypot(P.deltaX,P.deltaY),re=Math.atan2(P.deltaY,P.deltaX);return-.25*Math.PI<re&&re<.75*Math.PI&&(se=-se),se}function j(P){let se=R(P),re=0,K=1,ee=30,le=30;return P.deltaMode===re?se/=ee*le:P.deltaMode===K&&(se/=le),se}function $(P){return Number.isInteger(P)&&P%90===0}function T(P){return Number.isInteger(P)&&Object.values(y).includes(P)&&P!==y.UNKNOWN}function U(P){return Number.isInteger(P)&&Object.values(w).includes(P)&&P!==w.UNKNOWN}function W(P){return P.width<=P.height}let Q=new Promise(function(P){window.requestAnimationFrame(P)});r.animationStarted=Q;let te=document.documentElement.style;r.docStyle=te;function J(P,se,re){return Math.min(Math.max(P,se),re)}class oe{#e=null;#t=0;#i=!0;constructor(se){if(arguments.length>1)throw new Error("ProgressBar no longer accepts any additional options, please use CSS rules to modify its appearance instead.");let re=document.getElementById(se);this.#e=re.classList}get percent(){return this.#t}set percent(se){if(this.#t=J(se,0,100),isNaN(se)){this.#e.add("indeterminate");return}this.#e.remove("indeterminate"),te.setProperty("--progressBar-percent",`${this.#t}%`)}setWidth(se){if(!se)return;let K=se.parentNode.offsetWidth-se.offsetWidth;K>0&&te.setProperty("--progressBar-end-offset",`${K}px`)}hide(){this.#i&&(this.#i=!1,this.#e.add("hidden"))}show(){this.#i||(this.#i=!0,this.#e.remove("hidden"))}}r.ProgressBar=oe;function pe(){let P=document,se=P.activeElement||P.querySelector(":focus");for(;se?.shadowRoot;)P=se.shadowRoot,se=P.activeElement||P.querySelector(":focus");return se}function de(P){let se=y.VERTICAL,re=w.NONE;switch(P){case"SinglePage":se=y.PAGE;break;case"OneColumn":break;case"TwoPageLeft":se=y.PAGE;case"TwoColumnLeft":re=w.ODD;break;case"TwoPageRight":se=y.PAGE;case"TwoColumnRight":re=w.EVEN;break}return{scrollMode:se,spreadMode:re}}function fe(P){switch(P){case"UseNone":return b.NONE;case"UseThumbs":return b.THUMBS;case"UseOutlines":return b.OUTLINE;case"UseAttachments":return b.ATTACHMENTS;case"UseOC":return b.LAYERS}return b.NONE}},(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.StructTreeLayerBuilder=void 0;let o={Document:null,DocumentFragment:null,Part:"group",Sect:"group",Div:"group",Aside:"note",NonStruct:"none",P:null,H:"heading",Title:null,FENote:"note",Sub:"group",Lbl:null,Span:null,Em:null,Strong:null,Link:"link",Annot:"note",Form:"form",Ruby:null,RB:null,RT:null,RP:null,Warichu:null,WT:null,WP:null,L:"list",LI:"listitem",LBody:null,Table:"table",TR:"row",TH:"columnheader",TD:"cell",THead:"columnheader",TBody:null,TFoot:null,Caption:null,Figure:"figure",Formula:null,Artifact:null},a=/^H(\d+)$/;class l{constructor({pdfPage:d}){this.pdfPage=d}render(d){return this._walk(d)}_setAttributes(d,h){d.alt!==void 0&&h.setAttribute("aria-label",d.alt),d.id!==void 0&&h.setAttribute("aria-owns",d.id),d.lang!==void 0&&h.setAttribute("lang",d.lang)}_walk(d){if(!d)return null;let h=document.createElement("span");if("role"in d){let{role:u}=d,p=u.match(a);p?(h.setAttribute("role","heading"),h.setAttribute("aria-level",p[1])):o[u]&&h.setAttribute("role",o[u])}if(this._setAttributes(d,h),d.children)if(d.children.length===1&&"id"in d.children[0])this._setAttributes(d.children[0],h);else for(let u of d.children)h.append(this._walk(u));return h}}r.StructTreeLayerBuilder=l},(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.TextLayerBuilder=void 0;var a=o(3);let l=300;class c{constructor({textLayerDiv:h,eventBus:u,pageIndex:p,viewport:f,highlighter:m=null,enhanceTextSelection:g=!1,accessibilityManager:b=null}){this.textLayerDiv=h,this.eventBus=u,this.textContent=null,this.textContentItemsStr=[],this.textContentStream=null,this.renderingDone=!1,this.pageNumber=p+1,this.viewport=f,this.textDivs=[],this.textLayerRenderTask=null,this.highlighter=m,this.enhanceTextSelection=g,this.accessibilityManager=b,this._bindMouse()}_finishRendering(){if(this.renderingDone=!0,!this.enhanceTextSelection){let h=document.createElement("div");h.className="endOfContent",this.textLayerDiv.append(h)}this.eventBus.dispatch("textlayerrendered",{source:this,pageNumber:this.pageNumber,numTextDivs:this.textDivs.length})}render(h=0){if(!(this.textContent||this.textContentStream)||this.renderingDone)return;this.cancel(),this.textDivs.length=0,this.highlighter?.setTextMapping(this.textDivs,this.textContentItemsStr),this.accessibilityManager?.setTextMapping(this.textDivs);let u=document.createDocumentFragment();this.textLayerRenderTask=(0,a.renderTextLayer)({textContent:this.textContent,textContentStream:this.textContentStream,container:u,viewport:this.viewport,textDivs:this.textDivs,textContentItemsStr:this.textContentItemsStr,timeout:h,enhanceTextSelection:this.enhanceTextSelection}),this.textLayerRenderTask.promise.then(()=>{this.textLayerDiv.append(u),this._finishRendering(),this.highlighter?.enable(),this.accessibilityManager?.enable()},function(p){})}cancel(){this.textLayerRenderTask&&(this.textLayerRenderTask.cancel(),this.textLayerRenderTask=null),this.highlighter?.disable(),this.accessibilityManager?.disable()}setTextContentStream(h){this.cancel(),this.textContentStream=h}setTextContent(h){this.cancel(),this.textContent=h}_bindMouse(){let h=this.textLayerDiv,u=null;h.addEventListener("mousedown",p=>{if(this.enhanceTextSelection&&this.textLayerRenderTask){this.textLayerRenderTask.expandTextDivs(!0),u&&(clearTimeout(u),u=null);return}let f=h.querySelector(".endOfContent");if(!f)return;let m=p.target!==h;if(m=m&&window.getComputedStyle(f).getPropertyValue("-moz-user-select")!=="none",m){let g=h.getBoundingClientRect(),b=Math.max(0,(p.pageY-g.top)/g.height);f.style.top=(b*100).toFixed(2)+"%"}f.classList.add("active")}),h.addEventListener("mouseup",()=>{if(this.enhanceTextSelection&&this.textLayerRenderTask){u=setTimeout(()=>{this.textLayerRenderTask&&this.textLayerRenderTask.expandTextDivs(!1),u=null},l);return}let p=h.querySelector(".endOfContent");p&&(p.style.top="",p.classList.remove("active"))})}}r.TextLayerBuilder=c},(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.XfaLayerBuilder=void 0;var a=o(3);class l{constructor({pageDiv:d,pdfPage:h,annotationStorage:u=null,linkService:p,xfaHtml:f=null}){this.pageDiv=d,this.pdfPage=h,this.annotationStorage=u,this.linkService=p,this.xfaHtml=f,this.div=null,this._cancelled=!1}render(d,h="display"){if(h==="print"){let u={viewport:d.clone({dontFlip:!0}),div:this.div,xfaHtml:this.xfaHtml,annotationStorage:this.annotationStorage,linkService:this.linkService,intent:h},p=document.createElement("div");this.pageDiv.append(p),u.div=p;let f=a.XfaLayer.render(u);return Promise.resolve(f)}return this.pdfPage.getXfa().then(u=>{if(this._cancelled||!u)return{textDivs:[]};let p={viewport:d.clone({dontFlip:!0}),div:this.div,xfaHtml:u,annotationStorage:this.annotationStorage,linkService:this.linkService,intent:h};return this.div?a.XfaLayer.update(p):(this.div=document.createElement("div"),this.pageDiv.append(this.div),p.div=this.div,a.XfaLayer.render(p))}).catch(u=>{console.error(u)})}cancel(){this._cancelled=!0}hide(){this.div&&(this.div.hidden=!0)}}r.XfaLayerBuilder=l},(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PDFViewer=r.PDFSinglePageViewer=void 0;var a=o(7),l=o(12);class c extends l.BaseViewer{}r.PDFViewer=c;class d extends l.BaseViewer{_resetView(){super._resetView(),this._scrollMode=a.ScrollMode.PAGE,this._spreadMode=a.SpreadMode.NONE}set scrollMode(u){}_updateScrollMode(){}set spreadMode(u){}_updateSpreadMode(){}}r.PDFSinglePageViewer=d},(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PagesCountLimit=r.PDFPageViewBuffer=r.BaseViewer=void 0;var a=o(3),l=o(7),c=o(2),d=o(5),h=o(4),u=o(13),p=o(16),f=o(6),m=o(8),g=o(17),b=o(9),v=o(10);let E=10,y="enablePermissions",w={FORCE_SCROLL_MODE_PAGE:15e3,FORCE_LAZY_PAGE_INIT:7500,PAUSE_EAGER_PAGE_INIT:250};r.PagesCountLimit=w;function C(M){return Object.values(a.AnnotationEditorType).includes(M)&&M!==a.AnnotationEditorType.DISABLE}class A{#e=new Set;#t=0;constructor(I){this.#t=I}push(I){let O=this.#e;O.has(I)&&O.delete(I),O.add(I),O.size>this.#t&&this.#i()}resize(I,O=null){this.#t=I;let F=this.#e;if(O){let V=F.size,x=1;for(let N of F)if(O.has(N.id)&&(F.delete(N),F.add(N)),++x>V)break}for(;F.size>this.#t;)this.#i()}has(I){return this.#e.has(I)}[Symbol.iterator](){return this.#e.keys()}#i(){let I=this.#e.keys().next().value;I?.destroy(),this.#e.delete(I)}}r.PDFPageViewBuffer=A;class D{#e=null;#t=a.AnnotationEditorType.DISABLE;#i=null;#n=a.AnnotationMode.ENABLE_FORMS;#r=!1;#c=0;#a=null;#s=null;constructor(I){if(this.constructor===D)throw new Error("Cannot initialize BaseViewer.");let O="2.16.105";if(a.version!==O)throw new Error(`The API version "${a.version}" does not match the Viewer version "${O}".`);if(this.container=I.container,this.viewer=I.viewer||I.container.firstElementChild,!(this.container?.tagName.toUpperCase()==="DIV"&&this.viewer?.tagName.toUpperCase()==="DIV"))throw new Error("Invalid `container` and/or `viewer` option.");if(this.container.offsetParent&&getComputedStyle(this.container).position!=="absolute")throw new Error("The `container` must be absolutely positioned.");this.eventBus=I.eventBus,this.linkService=I.linkService||new f.SimpleLinkService,this.downloadManager=I.downloadManager||null,this.findController=I.findController||null,this._scriptingManager=I.scriptingManager||null,this.removePageBorders=I.removePageBorders||!1,this.textLayerMode=I.textLayerMode??l.TextLayerMode.ENABLE,this.#n=I.annotationMode??a.AnnotationMode.ENABLE_FORMS,this.#t=I.annotationEditorMode??a.AnnotationEditorType.DISABLE,this.imageResourcesPath=I.imageResourcesPath||"",this.enablePrintAutoRotate=I.enablePrintAutoRotate||!1,this.renderer=I.renderer||l.RendererType.CANVAS,this.useOnlyCssZoom=I.useOnlyCssZoom||!1,this.maxCanvasPixels=I.maxCanvasPixels,this.l10n=I.l10n||h.NullL10n,this.#r=I.enablePermissions||!1,this.pageColors=I.pageColors||null,this.pageColors&&!(CSS.supports("color",this.pageColors.background)&&CSS.supports("color",this.pageColors.foreground))&&((this.pageColors.background||this.pageColors.foreground)&&console.warn("BaseViewer: Ignoring `pageColors`-option, since the browser doesn't support the values used."),this.pageColors=null),this.defaultRenderingQueue=!I.renderingQueue,this.defaultRenderingQueue?(this.renderingQueue=new p.PDFRenderingQueue,this.renderingQueue.setViewer(this)):this.renderingQueue=I.renderingQueue,this.scroll=(0,l.watchScroll)(this.container,this._scrollUpdate.bind(this)),this.presentationModeState=l.PresentationModeState.UNKNOWN,this._onBeforeDraw=this._onAfterDraw=null,this._resetView(),this.removePageBorders&&this.viewer.classList.add("removePageBorders"),this.updateContainerHeightCss()}get pagesCount(){return this._pages.length}getPageView(I){return this._pages[I]}get pageViewsReady(){return this._pagesCapability.settled?this._pages.every(function(I){return I?.pdfPage}):!1}get renderForms(){return this.#n===a.AnnotationMode.ENABLE_FORMS}get enableScripting(){return!!this._scriptingManager}get currentPageNumber(){return this._currentPageNumber}set currentPageNumber(I){if(!Number.isInteger(I))throw new Error("Invalid page number.");this.pdfDocument&&(this._setCurrentPageNumber(I,!0)||console.error(`currentPageNumber: "${I}" is not a valid page.`))}_setCurrentPageNumber(I,O=!1){if(this._currentPageNumber===I)return O&&this.#p(),!0;if(!(0<I&&I<=this.pagesCount))return!1;let F=this._currentPageNumber;return this._currentPageNumber=I,this.eventBus.dispatch("pagechanging",{source:this,pageNumber:I,pageLabel:this._pageLabels?.[I-1]??null,previous:F}),O&&this.#p(),!0}get currentPageLabel(){return this._pageLabels?.[this._currentPageNumber-1]??null}set currentPageLabel(I){if(!this.pdfDocument)return;let O=I|0;if(this._pageLabels){let F=this._pageLabels.indexOf(I);F>=0&&(O=F+1)}this._setCurrentPageNumber(O,!0)||console.error(`currentPageLabel: "${I}" is not a valid page.`)}get currentScale(){return this._currentScale!==l.UNKNOWN_SCALE?this._currentScale:l.DEFAULT_SCALE}set currentScale(I){if(isNaN(I))throw new Error("Invalid numeric scale.");this.pdfDocument&&this._setScale(I,!1)}get currentScaleValue(){return this._currentScaleValue}set currentScaleValue(I){this.pdfDocument&&this._setScale(I,!1)}get pagesRotation(){return this._pagesRotation}set pagesRotation(I){if(!(0,l.isValidRotation)(I))throw new Error("Invalid pages rotation angle.");if(!this.pdfDocument||(I%=360,I<0&&(I+=360),this._pagesRotation===I))return;this._pagesRotation=I;let O=this._currentPageNumber,F={rotation:I};for(let V of this._pages)V.update(F);this._currentScaleValue&&this._setScale(this._currentScaleValue,!0),this.eventBus.dispatch("rotationchanging",{source:this,pagesRotation:I,pageNumber:O}),this.defaultRenderingQueue&&this.update()}get firstPagePromise(){return this.pdfDocument?this._firstPageCapability.promise:null}get onePageRendered(){return this.pdfDocument?this._onePageRenderedCapability.promise:null}get pagesPromise(){return this.pdfDocument?this._pagesCapability.promise:null}#u(I){let O={annotationEditorMode:this.#t,annotationMode:this.#n,textLayerMode:this.textLayerMode};return I&&(I.includes(a.PermissionFlag.COPY)||this.viewer.classList.add(y),I.includes(a.PermissionFlag.MODIFY_CONTENTS)||(O.annotationEditorMode=a.AnnotationEditorType.DISABLE),!I.includes(a.PermissionFlag.MODIFY_ANNOTATIONS)&&!I.includes(a.PermissionFlag.FILL_INTERACTIVE_FORMS)&&this.#n===a.AnnotationMode.ENABLE_FORMS&&(O.annotationMode=a.AnnotationMode.ENABLE)),O}#h(){if(document.visibilityState==="hidden"||!this.container.offsetParent||this._getVisiblePages().views.length===0)return Promise.resolve();let I=new Promise(O=>{this.#s=()=>{document.visibilityState==="hidden"&&(O(),document.removeEventListener("visibilitychange",this.#s),this.#s=null)},document.addEventListener("visibilitychange",this.#s)});return Promise.race([this._onePageRenderedCapability.promise,I])}setDocument(I){if(this.pdfDocument&&(this.eventBus.dispatch("pagesdestroy",{source:this}),this._cancelRendering(),this._resetView(),this.findController&&this.findController.setDocument(null),this._scriptingManager&&this._scriptingManager.setDocument(null),this.#i&&(this.#i.destroy(),this.#i=null)),this.pdfDocument=I,!I)return;let O=I.isPureXfa,F=I.numPages,V=I.getPage(1),x=I.getOptionalContentConfig(),N=this.#r?I.getPermissions():Promise.resolve();if(F>w.FORCE_SCROLL_MODE_PAGE){console.warn("Forcing PAGE-scrolling for performance reasons, given the length of the document.");let z=this._scrollMode=l.ScrollMode.PAGE;this.eventBus.dispatch("scrollmodechanged",{source:this,mode:z})}this._pagesCapability.promise.then(()=>{this.eventBus.dispatch("pagesloaded",{source:this,pagesCount:F})},()=>{}),this._onBeforeDraw=z=>{let G=this._pages[z.pageNumber-1];G&&this.#e.push(G)},this.eventBus._on("pagerender",this._onBeforeDraw),this._onAfterDraw=z=>{z.cssTransform||this._onePageRenderedCapability.settled||(this._onePageRenderedCapability.resolve({timestamp:z.timestamp}),this.eventBus._off("pagerendered",this._onAfterDraw),this._onAfterDraw=null,this.#s&&(document.removeEventListener("visibilitychange",this.#s),this.#s=null))},this.eventBus._on("pagerendered",this._onAfterDraw),Promise.all([V,N]).then(([z,G])=>{if(I!==this.pdfDocument)return;this._firstPageCapability.resolve(z),this._optionalContentConfigPromise=x;let{annotationEditorMode:X,annotationMode:k,textLayerMode:B}=this.#u(G);if(X!==a.AnnotationEditorType.DISABLE){let J=X;O?console.warn("Warning: XFA-editing is not implemented."):C(J)?(this.#i=new a.AnnotationEditorUIManager(this.container,this.eventBus),J!==a.AnnotationEditorType.NONE&&this.#i.updateMode(J)):console.error(`Invalid AnnotationEditor mode: ${J}`)}let R=this._scrollMode===l.ScrollMode.PAGE?null:this.viewer,j=this.currentScale,$=z.getViewport({scale:j*a.PixelsPerInch.PDF_TO_CSS_UNITS}),T=B!==l.TextLayerMode.DISABLE&&!O?this:null,U=k!==a.AnnotationMode.DISABLE?this:null,W=O?this:null,Q=this.#i?this:null;for(let J=1;J<=F;++J){let oe=new u.PDFPageView({container:R,eventBus:this.eventBus,id:J,scale:j,defaultViewport:$.clone(),optionalContentConfigPromise:x,renderingQueue:this.renderingQueue,textLayerFactory:T,textLayerMode:B,annotationLayerFactory:U,annotationMode:k,xfaLayerFactory:W,annotationEditorLayerFactory:Q,textHighlighterFactory:this,structTreeLayerFactory:this,imageResourcesPath:this.imageResourcesPath,renderer:this.renderer,useOnlyCssZoom:this.useOnlyCssZoom,maxCanvasPixels:this.maxCanvasPixels,pageColors:this.pageColors,l10n:this.l10n});this._pages.push(oe)}let te=this._pages[0];te&&(te.setPdfPage(z),this.linkService.cachePageRef(1,z.ref)),this._scrollMode===l.ScrollMode.PAGE?this.#l():this._spreadMode!==l.SpreadMode.NONE&&this._updateSpreadMode(),this.#h().then(()=>ie(this,null,function*(){if(this.findController&&this.findController.setDocument(I),this._scriptingManager&&this._scriptingManager.setDocument(I),this.#i&&this.eventBus.dispatch("annotationeditormodechanged",{source:this,mode:this.#t}),I.loadingParams.disableAutoFetch||F>w.FORCE_LAZY_PAGE_INIT){this._pagesCapability.resolve();return}let J=F-1;if(J<=0){this._pagesCapability.resolve();return}for(let oe=2;oe<=F;++oe){let pe=I.getPage(oe).then(de=>{let fe=this._pages[oe-1];fe.pdfPage||fe.setPdfPage(de),this.linkService.cachePageRef(oe,de.ref),--J===0&&this._pagesCapability.resolve()},de=>{console.error(`Unable to get page ${oe} to initialize viewer`,de),--J===0&&this._pagesCapability.resolve()});oe%w.PAUSE_EAGER_PAGE_INIT===0&&(yield pe)}})),this.eventBus.dispatch("pagesinit",{source:this}),I.getMetadata().then(({info:J})=>{I===this.pdfDocument&&J.Language&&(this.viewer.lang=J.Language)}),this.defaultRenderingQueue&&this.update()}).catch(z=>{console.error("Unable to initialize viewer",z),this._pagesCapability.reject(z)})}setPageLabels(I){if(this.pdfDocument){I?Array.isArray(I)&&this.pdfDocument.numPages===I.length?this._pageLabels=I:(this._pageLabels=null,console.error("setPageLabels: Invalid page labels.")):this._pageLabels=null;for(let O=0,F=this._pages.length;O<F;O++)this._pages[O].setPageLabel(this._pageLabels?.[O]??null)}}_resetView(){this._pages=[],this._currentPageNumber=1,this._currentScale=l.UNKNOWN_SCALE,this._currentScaleValue=null,this._pageLabels=null,this.#e=new A(E),this._location=null,this._pagesRotation=0,this._optionalContentConfigPromise=null,this._firstPageCapability=(0,a.createPromiseCapability)(),this._onePageRenderedCapability=(0,a.createPromiseCapability)(),this._pagesCapability=(0,a.createPromiseCapability)(),this._scrollMode=l.ScrollMode.VERTICAL,this._previousScrollMode=l.ScrollMode.UNKNOWN,this._spreadMode=l.SpreadMode.NONE,this.#a={previousPageNumber:1,scrollDown:!0,pages:[]},this._onBeforeDraw&&(this.eventBus._off("pagerender",this._onBeforeDraw),this._onBeforeDraw=null),this._onAfterDraw&&(this.eventBus._off("pagerendered",this._onAfterDraw),this._onAfterDraw=null),this.#s&&(document.removeEventListener("visibilitychange",this.#s),this.#s=null),this.viewer.textContent="",this._updateScrollMode(),this.viewer.removeAttribute("lang"),this.viewer.classList.remove(y)}#l(){if(this._scrollMode!==l.ScrollMode.PAGE)throw new Error("#ensurePageViewVisible: Invalid scrollMode value.");let I=this._currentPageNumber,O=this.#a,F=this.viewer;if(F.textContent="",O.pages.length=0,this._spreadMode===l.SpreadMode.NONE&&!this.isInPresentationMode){let V=this._pages[I-1];F.append(V.div),O.pages.push(V)}else{let V=new Set,x=this._spreadMode-1;x===-1?V.add(I-1):I%2!==x?(V.add(I-1),V.add(I)):(V.add(I-2),V.add(I-1));let N=document.createElement("div");if(N.className="spread",this.isInPresentationMode){let z=document.createElement("div");z.className="dummyPage",N.append(z)}for(let z of V){let G=this._pages[z];G&&(N.append(G.div),O.pages.push(G))}F.append(N)}O.scrollDown=I>=O.previousPageNumber,O.previousPageNumber=I}_scrollUpdate(){this.pagesCount!==0&&this.update()}#o(I,O=null){let{div:F,id:V}=I;if(this._scrollMode===l.ScrollMode.PAGE&&(this._setCurrentPageNumber(V),this.#l(),this.update()),!O&&!this.isInPresentationMode){let x=F.offsetLeft+F.clientLeft,N=x+F.clientWidth,{scrollLeft:z,clientWidth:G}=this.container;(this._scrollMode===l.ScrollMode.HORIZONTAL||x<z||N>z+G)&&(O={left:0,top:0})}(0,l.scrollIntoView)(F,O)}#f(I){return I===this._currentScale||Math.abs(I-this._currentScale)<1e-15}_setScaleUpdatePages(I,O,F=!1,V=!1){if(this._currentScaleValue=O.toString(),this.#f(I)){V&&this.eventBus.dispatch("scalechanging",{source:this,scale:I,presetValue:O});return}l.docStyle.setProperty("--scale-factor",I*a.PixelsPerInch.PDF_TO_CSS_UNITS);let x={scale:I};for(let N of this._pages)N.update(x);if(this._currentScale=I,!F){let N=this._currentPageNumber,z;this._location&&!(this.isInPresentationMode||this.isChangingPresentationMode)&&(N=this._location.pageNumber,z=[null,{name:"XYZ"},this._location.left,this._location.top,null]),this.scrollPageIntoView({pageNumber:N,destArray:z,allowNegativeOffset:!0})}this.eventBus.dispatch("scalechanging",{source:this,scale:I,presetValue:V?O:void 0}),this.defaultRenderingQueue&&this.update(),this.updateContainerHeightCss()}get _pageWidthScaleFactor(){return this._spreadMode!==l.SpreadMode.NONE&&this._scrollMode!==l.ScrollMode.HORIZONTAL?2:1}_setScale(I,O=!1){let F=parseFloat(I);if(F>0)this._setScaleUpdatePages(F,I,O,!1);else{let V=this._pages[this._currentPageNumber-1];if(!V)return;let x=l.SCROLLBAR_PADDING,N=l.VERTICAL_PADDING;this.isInPresentationMode?x=N=4:this.removePageBorders?x=N=0:this._scrollMode===l.ScrollMode.HORIZONTAL&&([x,N]=[N,x]);let z=(this.container.clientWidth-x)/V.width*V.scale/this._pageWidthScaleFactor,G=(this.container.clientHeight-N)/V.height*V.scale;switch(I){case"page-actual":F=1;break;case"page-width":F=z;break;case"page-height":F=G;break;case"page-fit":F=Math.min(z,G);break;case"auto":let X=(0,l.isPortraitOrientation)(V)?z:Math.min(G,z);F=Math.min(l.MAX_AUTO_SCALE,X);break;default:console.error(`_setScale: "${I}" is an unknown zoom value.`);return}this._setScaleUpdatePages(F,I,O,!0)}}#p(){let I=this._pages[this._currentPageNumber-1];this.isInPresentationMode&&this._setScale(this._currentScaleValue,!0),this.#o(I)}pageLabelToPageNumber(I){if(!this._pageLabels)return null;let O=this._pageLabels.indexOf(I);return O<0?null:O+1}scrollPageIntoView({pageNumber:I,destArray:O=null,allowNegativeOffset:F=!1,ignoreDestinationZoom:V=!1}){if(!this.pdfDocument)return;let x=Number.isInteger(I)&&this._pages[I-1];if(!x){console.error(`scrollPageIntoView: "${I}" is not a valid pageNumber parameter.`);return}if(this.isInPresentationMode||!O){this._setCurrentPageNumber(I,!0);return}let N=0,z=0,G=0,X=0,k,B,R=x.rotation%180!==0,j=(R?x.height:x.width)/x.scale/a.PixelsPerInch.PDF_TO_CSS_UNITS,$=(R?x.width:x.height)/x.scale/a.PixelsPerInch.PDF_TO_CSS_UNITS,T=0;switch(O[1].name){case"XYZ":N=O[2],z=O[3],T=O[4],N=N!==null?N:0,z=z!==null?z:$;break;case"Fit":case"FitB":T="page-fit";break;case"FitH":case"FitBH":z=O[2],T="page-width",z===null&&this._location?(N=this._location.left,z=this._location.top):(typeof z!="number"||z<0)&&(z=$);break;case"FitV":case"FitBV":N=O[2],G=j,X=$,T="page-height";break;case"FitR":N=O[2],z=O[3],G=O[4]-N,X=O[5]-z;let te=this.removePageBorders?0:l.SCROLLBAR_PADDING,J=this.removePageBorders?0:l.VERTICAL_PADDING;k=(this.container.clientWidth-te)/G/a.PixelsPerInch.PDF_TO_CSS_UNITS,B=(this.container.clientHeight-J)/X/a.PixelsPerInch.PDF_TO_CSS_UNITS,T=Math.min(Math.abs(k),Math.abs(B));break;default:console.error(`scrollPageIntoView: "${O[1].name}" is not a valid destination type.`);return}if(V||(T&&T!==this._currentScale?this.currentScaleValue=T:this._currentScale===l.UNKNOWN_SCALE&&(this.currentScaleValue=l.DEFAULT_SCALE_VALUE)),T==="page-fit"&&!O[4]){this.#o(x);return}let U=[x.viewport.convertToViewportPoint(N,z),x.viewport.convertToViewportPoint(N+G,z+X)],W=Math.min(U[0][0],U[1][0]),Q=Math.min(U[0][1],U[1][1]);F||(W=Math.max(W,0),Q=Math.max(Q,0)),this.#o(x,{left:W,top:Q})}_updateLocation(I){let O=this._currentScale,F=this._currentScaleValue,V=parseFloat(F)===O?Math.round(O*1e4)/100:F,x=I.id,N=this._pages[x-1],z=this.container,G=N.getPagePoint(z.scrollLeft-I.x,z.scrollTop-I.y),X=Math.round(G[0]),k=Math.round(G[1]),B=`#page=${x}`;this.isInPresentationMode||(B+=`&zoom=${V},${X},${k}`),this._location={pageNumber:x,scale:V,top:k,left:X,rotation:this._pagesRotation,pdfOpenParams:B}}update(){let I=this._getVisiblePages(),O=I.views,F=O.length;if(F===0)return;let V=Math.max(E,2*F+1);this.#e.resize(V,I.ids),this.renderingQueue.renderHighestPriority(I);let x=this._spreadMode===l.SpreadMode.NONE&&(this._scrollMode===l.ScrollMode.PAGE||this._scrollMode===l.ScrollMode.VERTICAL),N=this._currentPageNumber,z=!1;for(let G of O){if(G.percent<100)break;if(G.id===N&&x){z=!0;break}}this._setCurrentPageNumber(z?N:O[0].id),this._updateLocation(I.first),this.eventBus.dispatch("updateviewarea",{source:this,location:this._location})}containsElement(I){return this.container.contains(I)}focus(){this.container.focus()}get _isContainerRtl(){return getComputedStyle(this.container).direction==="rtl"}get isInPresentationMode(){return this.presentationModeState===l.PresentationModeState.FULLSCREEN}get isChangingPresentationMode(){return this.presentationModeState===l.PresentationModeState.CHANGING}get isHorizontalScrollbarEnabled(){return this.isInPresentationMode?!1:this.container.scrollWidth>this.container.clientWidth}get isVerticalScrollbarEnabled(){return this.isInPresentationMode?!1:this.container.scrollHeight>this.container.clientHeight}_getVisiblePages(){let I=this._scrollMode===l.ScrollMode.PAGE?this.#a.pages:this._pages,O=this._scrollMode===l.ScrollMode.HORIZONTAL,F=O&&this._isContainerRtl;return(0,l.getVisibleElements)({scrollEl:this.container,views:I,sortByVisibility:!0,horizontal:O,rtl:F})}isPageVisible(I){return this.pdfDocument?Number.isInteger(I)&&I>0&&I<=this.pagesCount?this._getVisiblePages().ids.has(I):(console.error(`isPageVisible: "${I}" is not a valid page.`),!1):!1}isPageCached(I){if(!this.pdfDocument)return!1;if(!(Number.isInteger(I)&&I>0&&I<=this.pagesCount))return console.error(`isPageCached: "${I}" is not a valid page.`),!1;let O=this._pages[I-1];return this.#e.has(O)}cleanup(){for(let I of this._pages)I.renderingState!==l.RenderingStates.FINISHED&&I.reset()}_cancelRendering(){for(let I of this._pages)I.cancelRendering()}#v(I){return ie(this,null,function*(){if(I.pdfPage)return I.pdfPage;try{let O=yield this.pdfDocument.getPage(I.id);return I.pdfPage||I.setPdfPage(O),this.linkService._cachedPageNumber?.(O.ref)||this.linkService.cachePageRef(I.id,O.ref),O}catch(O){return console.error("Unable to get page for page view",O),null}})}#g(I){if(I.first?.id===1)return!0;if(I.last?.id===this.pagesCount)return!1;switch(this._scrollMode){case l.ScrollMode.PAGE:return this.#a.scrollDown;case l.ScrollMode.HORIZONTAL:return this.scroll.right}return this.scroll.down}#b(I){for(let O of I)this._pages[O-1]?.toggleLoadingIconSpinner(!0);for(let O of this.#e)I.has(O.id)||O.toggleLoadingIconSpinner(!1)}forceRendering(I){let O=I||this._getVisiblePages(),F=this.#g(O),V=this._spreadMode!==l.SpreadMode.NONE&&this._scrollMode!==l.ScrollMode.HORIZONTAL,x=this.renderingQueue.getHighestPriority(O,this._pages,F,V);return this.#b(O.ids),x?(this.#v(x).then(()=>{this.renderingQueue.renderView(x)}),!0):!1}createTextLayerBuilder({textLayerDiv:I,pageIndex:O,viewport:F,enhanceTextSelection:V=!1,eventBus:x,highlighter:N,accessibilityManager:z=null}){return new b.TextLayerBuilder({textLayerDiv:I,eventBus:x,pageIndex:O,viewport:F,enhanceTextSelection:this.isInPresentationMode?!1:V,highlighter:N,accessibilityManager:z})}createTextHighlighter({pageIndex:I,eventBus:O}){return new g.TextHighlighter({eventBus:O,pageIndex:I,findController:this.isInPresentationMode?null:this.findController})}createAnnotationLayerBuilder({pageDiv:I,pdfPage:O,annotationStorage:F=this.pdfDocument?.annotationStorage,imageResourcesPath:V="",renderForms:x=!0,l10n:N=h.NullL10n,enableScripting:z=this.enableScripting,hasJSActionsPromise:G=this.pdfDocument?.hasJSActions(),mouseState:X=this._scriptingManager?.mouseState,fieldObjectsPromise:k=this.pdfDocument?.getFieldObjects(),annotationCanvasMap:B=null,accessibilityManager:R=null}){return new d.AnnotationLayerBuilder({pageDiv:I,pdfPage:O,annotationStorage:F,imageResourcesPath:V,renderForms:x,linkService:this.linkService,downloadManager:this.downloadManager,l10n:N,enableScripting:z,hasJSActionsPromise:G,mouseState:X,fieldObjectsPromise:k,annotationCanvasMap:B,accessibilityManager:R})}createAnnotationEditorLayerBuilder({uiManager:I=this.#i,pageDiv:O,pdfPage:F,accessibilityManager:V=null,l10n:x,annotationStorage:N=this.pdfDocument?.annotationStorage}){return new c.AnnotationEditorLayerBuilder({uiManager:I,pageDiv:O,pdfPage:F,annotationStorage:N,accessibilityManager:V,l10n:x})}createXfaLayerBuilder({pageDiv:I,pdfPage:O,annotationStorage:F=this.pdfDocument?.annotationStorage}){return new v.XfaLayerBuilder({pageDiv:I,pdfPage:O,annotationStorage:F,linkService:this.linkService})}createStructTreeLayerBuilder({pdfPage:I}){return new m.StructTreeLayerBuilder({pdfPage:I})}get hasEqualPageSizes(){let I=this._pages[0];for(let O=1,F=this._pages.length;O<F;++O){let V=this._pages[O];if(V.width!==I.width||V.height!==I.height)return!1}return!0}getPagesOverview(){return this._pages.map(I=>{let O=I.pdfPage.getViewport({scale:1});return!this.enablePrintAutoRotate||(0,l.isPortraitOrientation)(O)?{width:O.width,height:O.height,rotation:O.rotation}:{width:O.height,height:O.width,rotation:(O.rotation-90)%360}})}get optionalContentConfigPromise(){return this.pdfDocument?this._optionalContentConfigPromise?this._optionalContentConfigPromise:(console.error("optionalContentConfigPromise: Not initialized yet."),this.pdfDocument.getOptionalContentConfig()):Promise.resolve(null)}set optionalContentConfigPromise(I){if(!(I instanceof Promise))throw new Error(`Invalid optionalContentConfigPromise: ${I}`);if(!this.pdfDocument||!this._optionalContentConfigPromise)return;this._optionalContentConfigPromise=I;let O={optionalContentConfigPromise:I};for(let F of this._pages)F.update(O);this.update(),this.eventBus.dispatch("optionalcontentconfigchanged",{source:this,promise:I})}get scrollMode(){return this._scrollMode}set scrollMode(I){if(this._scrollMode!==I){if(!(0,l.isValidScrollMode)(I))throw new Error(`Invalid scroll mode: ${I}`);this.pagesCount>w.FORCE_SCROLL_MODE_PAGE||(this._previousScrollMode=this._scrollMode,this._scrollMode=I,this.eventBus.dispatch("scrollmodechanged",{source:this,mode:I}),this._updateScrollMode(this._currentPageNumber))}}_updateScrollMode(I=null){let O=this._scrollMode,F=this.viewer;F.classList.toggle("scrollHorizontal",O===l.ScrollMode.HORIZONTAL),F.classList.toggle("scrollWrapped",O===l.ScrollMode.WRAPPED),!(!this.pdfDocument||!I)&&(O===l.ScrollMode.PAGE?this.#l():this._previousScrollMode===l.ScrollMode.PAGE&&this._updateSpreadMode(),this._currentScaleValue&&isNaN(this._currentScaleValue)&&this._setScale(this._currentScaleValue,!0),this._setCurrentPageNumber(I,!0),this.update())}get spreadMode(){return this._spreadMode}set spreadMode(I){if(this._spreadMode!==I){if(!(0,l.isValidSpreadMode)(I))throw new Error(`Invalid spread mode: ${I}`);this._spreadMode=I,this.eventBus.dispatch("spreadmodechanged",{source:this,mode:I}),this._updateSpreadMode(this._currentPageNumber)}}_updateSpreadMode(I=null){if(!this.pdfDocument)return;let O=this.viewer,F=this._pages;if(this._scrollMode===l.ScrollMode.PAGE)this.#l();else if(O.textContent="",this._spreadMode===l.SpreadMode.NONE)for(let V of this._pages)O.append(V.div);else{let V=this._spreadMode-1,x=null;for(let N=0,z=F.length;N<z;++N)x===null?(x=document.createElement("div"),x.className="spread",O.append(x)):N%2===V&&(x=x.cloneNode(!1),O.append(x)),x.append(F[N].div)}I&&(this._currentScaleValue&&isNaN(this._currentScaleValue)&&this._setScale(this._currentScaleValue,!0),this._setCurrentPageNumber(I,!0),this.update())}_getPageAdvance(I,O=!1){switch(this._scrollMode){case l.ScrollMode.WRAPPED:{let{views:F}=this._getVisiblePages(),V=new Map;for(let{id:x,y:N,percent:z,widthPercent:G}of F){if(z===0||G<100)continue;let X=V.get(N);X||V.set(N,X||=[]),X.push(x)}for(let x of V.values()){let N=x.indexOf(I);if(N===-1)continue;let z=x.length;if(z===1)break;if(O)for(let G=N-1,X=0;G>=X;G--){let k=x[G],B=x[G+1]-1;if(k<B)return I-B}else for(let G=N+1,X=z;G<X;G++){let k=x[G],B=x[G-1]+1;if(k>B)return B-I}if(O){let G=x[0];if(G<I)return I-G+1}else{let G=x[z-1];if(G>I)return G-I+1}break}break}case l.ScrollMode.HORIZONTAL:break;case l.ScrollMode.PAGE:case l.ScrollMode.VERTICAL:{if(this._spreadMode===l.SpreadMode.NONE)break;let F=this._spreadMode-1;if(O&&I%2!==F)break;if(!O&&I%2===F)break;let{views:V}=this._getVisiblePages(),x=O?I-1:I+1;for(let{id:N,percent:z,widthPercent:G}of V)if(N===x){if(z>0&&G===100)return 2;break}break}}return 1}nextPage(){let I=this._currentPageNumber,O=this.pagesCount;if(I>=O)return!1;let F=this._getPageAdvance(I,!1)||1;return this.currentPageNumber=Math.min(I+F,O),!0}previousPage(){let I=this._currentPageNumber;if(I<=1)return!1;let O=this._getPageAdvance(I,!0)||1;return this.currentPageNumber=Math.max(I-O,1),!0}increaseScale(I=1){let O=this._currentScale;do O=(O*l.DEFAULT_SCALE_DELTA).toFixed(2),O=Math.ceil(O*10)/10,O=Math.min(l.MAX_SCALE,O);while(--I>0&&O<l.MAX_SCALE);this.currentScaleValue=O}decreaseScale(I=1){let O=this._currentScale;do O=(O/l.DEFAULT_SCALE_DELTA).toFixed(2),O=Math.floor(O*10)/10,O=Math.max(l.MIN_SCALE,O);while(--I>0&&O>l.MIN_SCALE);this.currentScaleValue=O}updateContainerHeightCss(){let I=this.container.clientHeight;I!==this.#c&&(this.#c=I,l.docStyle.setProperty("--viewer-container-height",`${I}px`))}get annotationEditorMode(){return this.#i?this.#t:a.AnnotationEditorType.DISABLE}set annotationEditorMode(I){if(!this.#i)throw new Error("The AnnotationEditor is not enabled.");if(this.#t!==I){if(!C(I))throw new Error(`Invalid AnnotationEditor mode: ${I}`);this.pdfDocument&&(this.#t=I,this.eventBus.dispatch("annotationeditormodechanged",{source:this,mode:I}),this.#i.updateMode(I))}}set annotationEditorParams({type:I,value:O}){if(!this.#i)throw new Error("The AnnotationEditor is not enabled.");this.#i.updateParams(I,O)}refresh(){if(!this.pdfDocument)return;let I={};for(let O of this._pages)O.update(I);this.update()}}r.BaseViewer=D},(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PDFPageView=void 0;var a=o(3),l=o(7),c=o(14),d=o(4),h=o(15);let u=c.compatibilityParams.maxCanvasPixels||16777216;class p{#e=a.AnnotationMode.ENABLE_FORMS;#t={initialOptionalContent:!0,regularAnnotations:!0};constructor(m){let g=m.container,b=m.defaultViewport;this.id=m.id,this.renderingId="page"+this.id,this.pdfPage=null,this.pageLabel=null,this.rotation=0,this.scale=m.scale||l.DEFAULT_SCALE,this.viewport=b,this.pdfPageRotate=b.rotation,this._optionalContentConfigPromise=m.optionalContentConfigPromise||null,this.hasRestrictedScaling=!1,this.textLayerMode=m.textLayerMode??l.TextLayerMode.ENABLE,this.#e=m.annotationMode??a.AnnotationMode.ENABLE_FORMS,this.imageResourcesPath=m.imageResourcesPath||"",this.useOnlyCssZoom=m.useOnlyCssZoom||!1,this.maxCanvasPixels=m.maxCanvasPixels||u,this.pageColors=m.pageColors||null,this.eventBus=m.eventBus,this.renderingQueue=m.renderingQueue,this.textLayerFactory=m.textLayerFactory,this.annotationLayerFactory=m.annotationLayerFactory,this.annotationEditorLayerFactory=m.annotationEditorLayerFactory,this.xfaLayerFactory=m.xfaLayerFactory,this.textHighlighter=m.textHighlighterFactory?.createTextHighlighter({pageIndex:this.id-1,eventBus:this.eventBus}),this.structTreeLayerFactory=m.structTreeLayerFactory,this.renderer=m.renderer||l.RendererType.CANVAS,this.l10n=m.l10n||d.NullL10n,this.paintTask=null,this.paintedViewportMap=new WeakMap,this.renderingState=l.RenderingStates.INITIAL,this.resume=null,this._renderError=null,this._isStandalone=!this.renderingQueue?.hasViewer(),this._annotationCanvasMap=null,this.annotationLayer=null,this.annotationEditorLayer=null,this.textLayer=null,this.zoomLayer=null,this.xfaLayer=null,this.structTreeLayer=null;let v=document.createElement("div");if(v.className="page",v.style.width=Math.floor(this.viewport.width)+"px",v.style.height=Math.floor(this.viewport.height)+"px",v.setAttribute("data-page-number",this.id),v.setAttribute("role","region"),this.l10n.get("page_landmark",{page:this.id}).then(E=>{v.setAttribute("aria-label",E)}),this.div=v,g?.append(v),this._isStandalone){let{optionalContentConfigPromise:E}=m;E&&E.then(y=>{E===this._optionalContentConfigPromise&&(this.#t.initialOptionalContent=y.hasInitialVisibility)})}}setPdfPage(m){this.pdfPage=m,this.pdfPageRotate=m.rotate;let g=(this.rotation+this.pdfPageRotate)%360;this.viewport=m.getViewport({scale:this.scale*a.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:g}),this.reset()}destroy(){this.reset(),this.pdfPage&&this.pdfPage.cleanup()}_renderAnnotationLayer(){return ie(this,null,function*(){let m=null;try{yield this.annotationLayer.render(this.viewport,"display")}catch(g){console.error(`_renderAnnotationLayer: "${g}".`),m=g}finally{this.eventBus.dispatch("annotationlayerrendered",{source:this,pageNumber:this.id,error:m})}})}_renderAnnotationEditorLayer(){return ie(this,null,function*(){let m=null;try{yield this.annotationEditorLayer.render(this.viewport,"display")}catch(g){console.error(`_renderAnnotationEditorLayer: "${g}".`),m=g}finally{this.eventBus.dispatch("annotationeditorlayerrendered",{source:this,pageNumber:this.id,error:m})}})}_renderXfaLayer(){return ie(this,null,function*(){let m=null;try{let g=yield this.xfaLayer.render(this.viewport,"display");this.textHighlighter&&this._buildXfaTextContentItems(g.textDivs)}catch(g){console.error(`_renderXfaLayer: "${g}".`),m=g}finally{this.eventBus.dispatch("xfalayerrendered",{source:this,pageNumber:this.id,error:m})}})}_buildXfaTextContentItems(m){return ie(this,null,function*(){let g=yield this.pdfPage.getTextContent(),b=[];for(let v of g.items)b.push(v.str);this.textHighlighter.setTextMapping(m,b),this.textHighlighter.enable()})}_resetZoomLayer(m=!1){if(!this.zoomLayer)return;let g=this.zoomLayer.firstChild;this.paintedViewportMap.delete(g),g.width=0,g.height=0,m&&this.zoomLayer.remove(),this.zoomLayer=null}reset({keepZoomLayer:m=!1,keepAnnotationLayer:g=!1,keepAnnotationEditorLayer:b=!1,keepXfaLayer:v=!1}={}){this.cancelRendering({keepAnnotationLayer:g,keepAnnotationEditorLayer:b,keepXfaLayer:v}),this.renderingState=l.RenderingStates.INITIAL;let E=this.div;E.style.width=Math.floor(this.viewport.width)+"px",E.style.height=Math.floor(this.viewport.height)+"px";let y=E.childNodes,w=m&&this.zoomLayer||null,C=g&&this.annotationLayer?.div||null,A=b&&this.annotationEditorLayer?.div||null,D=v&&this.xfaLayer?.div||null;for(let M=y.length-1;M>=0;M--){let I=y[M];switch(I){case w:case C:case A:case D:continue}I.remove()}E.removeAttribute("data-loaded"),C&&this.annotationLayer.hide(),A?this.annotationEditorLayer.hide():this.annotationEditorLayer?.destroy(),D&&this.xfaLayer.hide(),w||(this.canvas&&(this.paintedViewportMap.delete(this.canvas),this.canvas.width=0,this.canvas.height=0,delete this.canvas),this._resetZoomLayer()),this.svg&&(this.paintedViewportMap.delete(this.svg),delete this.svg),this.loadingIconDiv=document.createElement("div"),this.loadingIconDiv.className="loadingIcon notVisible",this._isStandalone&&this.toggleLoadingIconSpinner(!0),this.loadingIconDiv.setAttribute("role","img"),this.l10n.get("loading").then(M=>{this.loadingIconDiv?.setAttribute("aria-label",M)}),E.append(this.loadingIconDiv)}update({scale:m=0,rotation:g=null,optionalContentConfigPromise:b=null}){this.scale=m||this.scale,typeof g=="number"&&(this.rotation=g),b instanceof Promise&&(this._optionalContentConfigPromise=b,b.then(y=>{b===this._optionalContentConfigPromise&&(this.#t.initialOptionalContent=y.hasInitialVisibility)}));let v=(this.rotation+this.pdfPageRotate)%360;if(this.viewport=this.viewport.clone({scale:this.scale*a.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:v}),this._isStandalone&&l.docStyle.setProperty("--scale-factor",this.viewport.scale),this.svg){this.cssTransform({target:this.svg,redrawAnnotationLayer:!0,redrawAnnotationEditorLayer:!0,redrawXfaLayer:!0}),this.eventBus.dispatch("pagerendered",{source:this,pageNumber:this.id,cssTransform:!0,timestamp:performance.now(),error:this._renderError});return}let E=!1;if(this.canvas&&this.maxCanvasPixels>0){let y=this.outputScale;(Math.floor(this.viewport.width)*y.sx|0)*(Math.floor(this.viewport.height)*y.sy|0)>this.maxCanvasPixels&&(E=!0)}if(this.canvas){if(this.useOnlyCssZoom||this.hasRestrictedScaling&&E){this.cssTransform({target:this.canvas,redrawAnnotationLayer:!0,redrawAnnotationEditorLayer:!0,redrawXfaLayer:!0}),this.eventBus.dispatch("pagerendered",{source:this,pageNumber:this.id,cssTransform:!0,timestamp:performance.now(),error:this._renderError});return}!this.zoomLayer&&!this.canvas.hidden&&(this.zoomLayer=this.canvas.parentNode,this.zoomLayer.style.position="absolute")}this.zoomLayer&&this.cssTransform({target:this.zoomLayer.firstChild}),this.reset({keepZoomLayer:!0,keepAnnotationLayer:!0,keepAnnotationEditorLayer:!0,keepXfaLayer:!0})}cancelRendering({keepAnnotationLayer:m=!1,keepAnnotationEditorLayer:g=!1,keepXfaLayer:b=!1}={}){this.paintTask&&(this.paintTask.cancel(),this.paintTask=null),this.resume=null,this.textLayer&&(this.textLayer.cancel(),this.textLayer=null),this.annotationLayer&&(!m||!this.annotationLayer.div)&&(this.annotationLayer.cancel(),this.annotationLayer=null,this._annotationCanvasMap=null),this.annotationEditorLayer&&(!g||!this.annotationEditorLayer.div)&&(this.annotationEditorLayer.cancel(),this.annotationEditorLayer=null),this.xfaLayer&&(!b||!this.xfaLayer.div)&&(this.xfaLayer.cancel(),this.xfaLayer=null,this.textHighlighter?.disable()),this._onTextLayerRendered&&(this.eventBus._off("textlayerrendered",this._onTextLayerRendered),this._onTextLayerRendered=null)}cssTransform({target:m,redrawAnnotationLayer:g=!1,redrawAnnotationEditorLayer:b=!1,redrawXfaLayer:v=!1}){let E=this.viewport.width,y=this.viewport.height,w=this.div;m.style.width=m.parentNode.style.width=w.style.width=Math.floor(E)+"px",m.style.height=m.parentNode.style.height=w.style.height=Math.floor(y)+"px";let C=this.viewport.rotation-this.paintedViewportMap.get(m).rotation,A=Math.abs(C),D=1,M=1;if((A===90||A===270)&&(D=y/E,M=E/y),m.style.transform=`rotate(${C}deg) scale(${D}, ${M})`,this.textLayer){let I=this.textLayer.viewport,O=this.viewport.rotation-I.rotation,F=Math.abs(O),V=E/I.width;(F===90||F===270)&&(V=E/I.height);let x=this.textLayer.textLayerDiv,N,z;switch(F){case 0:N=z=0;break;case 90:N=0,z="-"+x.style.height;break;case 180:N="-"+x.style.width,z="-"+x.style.height;break;case 270:N="-"+x.style.width,z=0;break;default:console.error("Bad rotation value.");break}x.style.transform=`rotate(${F}deg) scale(${V}) translate(${N}, ${z})`,x.style.transformOrigin="0% 0%"}g&&this.annotationLayer&&this._renderAnnotationLayer(),b&&this.annotationEditorLayer&&this._renderAnnotationEditorLayer(),v&&this.xfaLayer&&this._renderXfaLayer()}get width(){return this.viewport.width}get height(){return this.viewport.height}getPagePoint(m,g){return this.viewport.convertToPdfPoint(m,g)}toggleLoadingIconSpinner(m=!1){this.loadingIconDiv?.classList.toggle("notVisible",!m)}draw(){this.renderingState!==l.RenderingStates.INITIAL&&(console.error("Must be in new state before drawing"),this.reset());let{div:m,pdfPage:g}=this;if(!g)return this.renderingState=l.RenderingStates.FINISHED,this.loadingIconDiv&&(this.loadingIconDiv.remove(),delete this.loadingIconDiv),Promise.reject(new Error("pdfPage is not loaded"));this.renderingState=l.RenderingStates.RUNNING;let b=document.createElement("div");b.style.width=m.style.width,b.style.height=m.style.height,b.classList.add("canvasWrapper");let v=this.annotationLayer?.div||this.annotationEditorLayer?.div;v?v.before(b):m.append(b);let E=null;if(this.textLayerMode!==l.TextLayerMode.DISABLE&&this.textLayerFactory){this._accessibilityManager||=new h.TextAccessibilityManager;let D=document.createElement("div");D.className="textLayer",D.style.width=b.style.width,D.style.height=b.style.height,v?v.before(D):m.append(D),E=this.textLayerFactory.createTextLayerBuilder({textLayerDiv:D,pageIndex:this.id-1,viewport:this.viewport,enhanceTextSelection:this.textLayerMode===l.TextLayerMode.ENABLE_ENHANCE,eventBus:this.eventBus,highlighter:this.textHighlighter,accessibilityManager:this._accessibilityManager})}this.textLayer=E,this.#e!==a.AnnotationMode.DISABLE&&this.annotationLayerFactory&&(this._annotationCanvasMap||=new Map,this.annotationLayer||=this.annotationLayerFactory.createAnnotationLayerBuilder({pageDiv:m,pdfPage:g,imageResourcesPath:this.imageResourcesPath,renderForms:this.#e===a.AnnotationMode.ENABLE_FORMS,l10n:this.l10n,annotationCanvasMap:this._annotationCanvasMap,accessibilityManager:this._accessibilityManager})),this.xfaLayer?.div&&m.append(this.xfaLayer.div);let y=null;this.renderingQueue&&(y=D=>{if(!this.renderingQueue.isHighestPriority(this)){this.renderingState=l.RenderingStates.PAUSED,this.resume=()=>{this.renderingState=l.RenderingStates.RUNNING,D()};return}D()});let w=(D=null)=>ie(this,null,function*(){if(C===this.paintTask&&(this.paintTask=null),D instanceof a.RenderingCancelledException){this._renderError=null;return}if(this._renderError=D,this.renderingState=l.RenderingStates.FINISHED,this.loadingIconDiv&&(this.loadingIconDiv.remove(),delete this.loadingIconDiv),this._resetZoomLayer(!0),this.#t.regularAnnotations=!C.separateAnnots,this.eventBus.dispatch("pagerendered",{source:this,pageNumber:this.id,cssTransform:!1,timestamp:performance.now(),error:this._renderError}),D)throw D}),C=this.renderer===l.RendererType.SVG?this.paintOnSvg(b):this.paintOnCanvas(b);C.onRenderContinue=y,this.paintTask=C;let A=C.promise.then(()=>w(null).then(()=>{if(E){let D=g.streamTextContent({includeMarkedContent:!0});E.setTextContentStream(D),E.render()}this.annotationLayer&&this._renderAnnotationLayer().then(()=>{this.annotationEditorLayerFactory&&(this.annotationEditorLayer||=this.annotationEditorLayerFactory.createAnnotationEditorLayerBuilder({pageDiv:m,pdfPage:g,l10n:this.l10n,accessibilityManager:this._accessibilityManager}),this._renderAnnotationEditorLayer())})}),function(D){return w(D)});return this.xfaLayerFactory&&(this.xfaLayer||=this.xfaLayerFactory.createXfaLayerBuilder({pageDiv:m,pdfPage:g}),this._renderXfaLayer()),this.structTreeLayerFactory&&this.textLayer&&this.canvas&&(this._onTextLayerRendered=D=>{D.pageNumber===this.id&&(this.eventBus._off("textlayerrendered",this._onTextLayerRendered),this._onTextLayerRendered=null,this.canvas&&this.pdfPage.getStructTree().then(M=>{if(!M||!this.canvas)return;let I=this.structTreeLayer.render(M);I.classList.add("structTree"),this.canvas.append(I)}))},this.eventBus._on("textlayerrendered",this._onTextLayerRendered),this.structTreeLayer=this.structTreeLayerFactory.createStructTreeLayerBuilder({pdfPage:g})),m.setAttribute("data-loaded",!0),this.eventBus.dispatch("pagerender",{source:this,pageNumber:this.id}),A}paintOnCanvas(m){let g=(0,a.createPromiseCapability)(),b={promise:g.promise,onRenderContinue(V){V()},cancel(){F.cancel()},get separateAnnots(){return F.separateAnnots}},v=this.viewport,E=document.createElement("canvas");E.setAttribute("role","presentation"),E.hidden=!0;let y=!0,w=function(){y&&(E.hidden=!1,y=!1)};m.append(E),this.canvas=E;let C=E.getContext("2d",{alpha:!1}),A=this.outputScale=new l.OutputScale;if(this.useOnlyCssZoom){let V=v.clone({scale:a.PixelsPerInch.PDF_TO_CSS_UNITS});A.sx*=V.width/v.width,A.sy*=V.height/v.height}if(this.maxCanvasPixels>0){let V=v.width*v.height,x=Math.sqrt(this.maxCanvasPixels/V);A.sx>x||A.sy>x?(A.sx=x,A.sy=x,this.hasRestrictedScaling=!0):this.hasRestrictedScaling=!1}let D=(0,l.approximateFraction)(A.sx),M=(0,l.approximateFraction)(A.sy);E.width=(0,l.roundToDivide)(v.width*A.sx,D[0]),E.height=(0,l.roundToDivide)(v.height*A.sy,M[0]),E.style.width=(0,l.roundToDivide)(v.width,D[1])+"px",E.style.height=(0,l.roundToDivide)(v.height,M[1])+"px",this.paintedViewportMap.set(E,v);let I=A.scaled?[A.sx,0,0,A.sy,0,0]:null,O={canvasContext:C,transform:I,viewport:this.viewport,annotationMode:this.#e,optionalContentConfigPromise:this._optionalContentConfigPromise,annotationCanvasMap:this._annotationCanvasMap,pageColors:this.pageColors},F=this.pdfPage.render(O);return F.onContinue=function(V){w(),b.onRenderContinue?b.onRenderContinue(V):V()},F.promise.then(function(){w(),g.resolve()},function(V){w(),g.reject(V)}),b}paintOnSvg(m){let g=!1,b=()=>{if(g)throw new a.RenderingCancelledException(`Rendering cancelled, page ${this.id}`,"svg")},v=this.pdfPage,E=this.viewport.clone({scale:a.PixelsPerInch.PDF_TO_CSS_UNITS});return{promise:v.getOperatorList({annotationMode:this.#e}).then(w=>(b(),new a.SVGGraphics(v.commonObjs,v.objs).getSVG(w,E).then(A=>{b(),this.svg=A,this.paintedViewportMap.set(A,E),A.style.width=m.style.width,A.style.height=m.style.height,this.renderingState=l.RenderingStates.FINISHED,m.append(A)}))),onRenderContinue(w){w()},cancel(){g=!0},get separateAnnots(){return!1}}}setPageLabel(m){this.pageLabel=typeof m=="string"?m:null,this.pageLabel!==null?this.div.setAttribute("data-page-label",this.pageLabel):this.div.removeAttribute("data-page-label")}get thumbnailCanvas(){let{initialOptionalContent:m,regularAnnotations:g}=this.#t;return m&&g?this.canvas:null}}r.PDFPageView=p},(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.compatibilityParams=r.OptionKind=r.AppOptions=void 0;let o=Object.create(null);r.compatibilityParams=o;{let h=navigator.userAgent||"",u=navigator.platform||"",p=navigator.maxTouchPoints||1,f=/Android/.test(h),m=/\b(iPad|iPhone|iPod)(?=;)/.test(h)||u==="MacIntel"&&p>1;(function(){(m||f)&&(o.maxCanvasPixels=5242880)})()}let a={VIEWER:2,API:4,WORKER:8,PREFERENCE:128};r.OptionKind=a;let l={annotationEditorMode:{value:-1,kind:a.VIEWER+a.PREFERENCE},annotationMode:{value:2,kind:a.VIEWER+a.PREFERENCE},cursorToolOnLoad:{value:0,kind:a.VIEWER+a.PREFERENCE},defaultZoomValue:{value:"",kind:a.VIEWER+a.PREFERENCE},disableHistory:{value:!1,kind:a.VIEWER},disablePageLabels:{value:!1,kind:a.VIEWER+a.PREFERENCE},enablePermissions:{value:!1,kind:a.VIEWER+a.PREFERENCE},enablePrintAutoRotate:{value:!0,kind:a.VIEWER+a.PREFERENCE},enableScripting:{value:!0,kind:a.VIEWER+a.PREFERENCE},externalLinkRel:{value:"noopener noreferrer nofollow",kind:a.VIEWER},externalLinkTarget:{value:0,kind:a.VIEWER+a.PREFERENCE},historyUpdateUrl:{value:!1,kind:a.VIEWER+a.PREFERENCE},ignoreDestinationZoom:{value:!1,kind:a.VIEWER+a.PREFERENCE},imageResourcesPath:{value:"./images/",kind:a.VIEWER},maxCanvasPixels:{value:16777216,kind:a.VIEWER},forcePageColors:{value:!1,kind:a.VIEWER+a.PREFERENCE},pageColorsBackground:{value:"Canvas",kind:a.VIEWER+a.PREFERENCE},pageColorsForeground:{value:"CanvasText",kind:a.VIEWER+a.PREFERENCE},pdfBugEnabled:{value:!1,kind:a.VIEWER+a.PREFERENCE},printResolution:{value:150,kind:a.VIEWER},sidebarViewOnLoad:{value:-1,kind:a.VIEWER+a.PREFERENCE},scrollModeOnLoad:{value:-1,kind:a.VIEWER+a.PREFERENCE},spreadModeOnLoad:{value:-1,kind:a.VIEWER+a.PREFERENCE},textLayerMode:{value:1,kind:a.VIEWER+a.PREFERENCE},useOnlyCssZoom:{value:!1,kind:a.VIEWER+a.PREFERENCE},viewerCssTheme:{value:0,kind:a.VIEWER+a.PREFERENCE},viewOnLoad:{value:0,kind:a.VIEWER+a.PREFERENCE},cMapPacked:{value:!0,kind:a.API},cMapUrl:{value:"../web/cmaps/",kind:a.API},disableAutoFetch:{value:!1,kind:a.API+a.PREFERENCE},disableFontFace:{value:!1,kind:a.API+a.PREFERENCE},disableRange:{value:!1,kind:a.API+a.PREFERENCE},disableStream:{value:!1,kind:a.API+a.PREFERENCE},docBaseUrl:{value:"",kind:a.API},enableXfa:{value:!0,kind:a.API+a.PREFERENCE},fontExtraProperties:{value:!1,kind:a.API},isEvalSupported:{value:!0,kind:a.API},maxImageSize:{value:-1,kind:a.API},pdfBug:{value:!1,kind:a.API},standardFontDataUrl:{value:"../web/standard_fonts/",kind:a.API},verbosity:{value:1,kind:a.API},workerPort:{value:null,kind:a.WORKER},workerSrc:{value:"../build/pdf.worker.js",kind:a.WORKER}};l.defaultUrl={value:"compressed.tracemonkey-pldi-09.pdf",kind:a.VIEWER},l.disablePreferences={value:!1,kind:a.VIEWER},l.locale={value:navigator.language||"en-US",kind:a.VIEWER},l.renderer={value:"canvas",kind:a.VIEWER+a.PREFERENCE},l.sandboxBundleSrc={value:"../build/pdf.sandbox.js",kind:a.VIEWER};let c=Object.create(null);class d{constructor(){throw new Error("Cannot initialize AppOptions.")}static get(u){let p=c[u];if(p!==void 0)return p;let f=l[u];if(f!==void 0)return o[u]??f.value}static getAll(u=null){let p=Object.create(null);for(let f in l){let m=l[f];if(u){if(!(u&m.kind))continue;if(u===a.PREFERENCE){let b=m.value,v=typeof b;if(v==="boolean"||v==="string"||v==="number"&&Number.isInteger(b)){p[f]=b;continue}throw new Error(`Invalid type for preference: ${f}`)}}let g=c[f];p[f]=g!==void 0?g:o[f]??m.value}return p}static set(u,p){c[u]=p}static setAll(u){for(let p in u)c[p]=u[p]}static remove(u){delete c[u]}static _hasUserOptions(){return Object.keys(c).length>0}}r.AppOptions=d},(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.TextAccessibilityManager=void 0;var a=o(7);class l{#e=!1;#t=null;#i=new Map;#n=new Map;setTextMapping(d){this.#t=d}static#r(d,h){let u=d.getBoundingClientRect(),p=h.getBoundingClientRect();if(u.width===0&&u.height===0)return 1;if(p.width===0&&p.height===0)return-1;let f=u.y,m=u.y+u.height,g=u.y+u.height/2,b=p.y,v=p.y+p.height,E=p.y+p.height/2;if(g<=b&&E>=m)return-1;if(E<=f&&g>=v)return 1;let y=u.x+u.width/2,w=p.x+p.width/2;return y-w}enable(){if(this.#e)throw new Error("TextAccessibilityManager is already enabled.");if(!this.#t)throw new Error("Text divs and strings have not been set.");if(this.#e=!0,this.#t=this.#t.slice(),this.#t.sort(l.#r),this.#i.size>0){let d=this.#t;for(let[h,u]of this.#i){if(!document.getElementById(h)){this.#i.delete(h);continue}this.#c(h,d[u])}}for(let[d,h]of this.#n)this.addPointerInTextLayer(d,h);this.#n.clear()}disable(){this.#e&&(this.#n.clear(),this.#t=null,this.#e=!1)}removePointerInTextLayer(d){if(!this.#e){this.#n.delete(d);return}let h=this.#t;if(!h||h.length===0)return;let{id:u}=d,p=this.#i.get(u);if(p===void 0)return;let f=h[p];this.#i.delete(u);let m=f.getAttribute("aria-owns");m?.includes(u)&&(m=m.split(" ").filter(g=>g!==u).join(" "),m?f.setAttribute("aria-owns",m):(f.removeAttribute("aria-owns"),f.setAttribute("role","presentation")))}#c(d,h){let u=h.getAttribute("aria-owns");u?.includes(d)||h.setAttribute("aria-owns",u?`${u} ${d}`:d),h.removeAttribute("role")}addPointerInTextLayer(d,h){let{id:u}=d;if(!u)return;if(!this.#e){this.#n.set(d,h);return}h&&this.removePointerInTextLayer(d);let p=this.#t;if(!p||p.length===0)return;let f=(0,a.binarySearchFirstItem)(p,g=>l.#r(d,g)<0),m=Math.max(0,f-1);this.#c(u,p[m]),this.#i.set(u,m)}moveElementInDOM(d,h,u,p){if(this.addPointerInTextLayer(u,p),!d.hasChildNodes()){d.append(h);return}let f=Array.from(d.childNodes).filter(b=>b!==h);if(f.length===0)return;let m=u||h,g=(0,a.binarySearchFirstItem)(f,b=>l.#r(m,b)<0);g===0?f[0].before(h):f[g-1].after(h)}}r.TextAccessibilityManager=l},(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PDFRenderingQueue=void 0;var a=o(3),l=o(7);let c=3e4;class d{constructor(){this.pdfViewer=null,this.pdfThumbnailViewer=null,this.onIdle=null,this.highestPriorityPage=null,this.idleTimeout=null,this.printing=!1,this.isThumbnailViewEnabled=!1}setViewer(u){this.pdfViewer=u}setThumbnailViewer(u){this.pdfThumbnailViewer=u}isHighestPriority(u){return this.highestPriorityPage===u.renderingId}hasViewer(){return!!this.pdfViewer}renderHighestPriority(u){this.idleTimeout&&(clearTimeout(this.idleTimeout),this.idleTimeout=null),!this.pdfViewer.forceRendering(u)&&(this.isThumbnailViewEnabled&&this.pdfThumbnailViewer?.forceRendering()||this.printing||this.onIdle&&(this.idleTimeout=setTimeout(this.onIdle.bind(this),c)))}getHighestPriority(u,p,f,m=!1){let g=u.views,b=g.length;if(b===0)return null;for(let C=0;C<b;C++){let A=g[C].view;if(!this.isViewFinished(A))return A}let v=u.first.id,E=u.last.id;if(E-v+1>b){let C=u.ids;for(let A=1,D=E-v;A<D;A++){let M=f?v+A:E-A;if(C.has(M))continue;let I=p[M-1];if(!this.isViewFinished(I))return I}}let y=f?E:v-2,w=p[y];return w&&!this.isViewFinished(w)||m&&(y+=f?1:-1,w=p[y],w&&!this.isViewFinished(w))?w:null}isViewFinished(u){return u.renderingState===l.RenderingStates.FINISHED}renderView(u){switch(u.renderingState){case l.RenderingStates.FINISHED:return!1;case l.RenderingStates.PAUSED:this.highestPriorityPage=u.renderingId,u.resume();break;case l.RenderingStates.RUNNING:this.highestPriorityPage=u.renderingId;break;case l.RenderingStates.INITIAL:this.highestPriorityPage=u.renderingId,u.draw().finally(()=>{this.renderHighestPriority()}).catch(p=>{p instanceof a.RenderingCancelledException||console.error(`renderView: "${p}"`)});break}return!0}}r.PDFRenderingQueue=d},(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.TextHighlighter=void 0;class o{constructor({findController:l,eventBus:c,pageIndex:d}){this.findController=l,this.matches=[],this.eventBus=c,this.pageIdx=d,this._onUpdateTextLayerMatches=null,this.textDivs=null,this.textContentItemsStr=null,this.enabled=!1}setTextMapping(l,c){this.textDivs=l,this.textContentItemsStr=c}enable(){if(!this.textDivs||!this.textContentItemsStr)throw new Error("Text divs and strings have not been set.");if(this.enabled)throw new Error("TextHighlighter is already enabled.");this.enabled=!0,this._onUpdateTextLayerMatches||(this._onUpdateTextLayerMatches=l=>{(l.pageIndex===this.pageIdx||l.pageIndex===-1)&&this._updateMatches()},this.eventBus._on("updatetextlayermatches",this._onUpdateTextLayerMatches)),this._updateMatches()}disable(){this.enabled&&(this.enabled=!1,this._onUpdateTextLayerMatches&&(this.eventBus._off("updatetextlayermatches",this._onUpdateTextLayerMatches),this._onUpdateTextLayerMatches=null))}_convertMatches(l,c){if(!l)return[];let{textContentItemsStr:d}=this,h=0,u=0,p=d.length-1,f=[];for(let m=0,g=l.length;m<g;m++){let b=l[m];for(;h!==p&&b>=u+d[h].length;)u+=d[h].length,h++;h===d.length&&console.error("Could not find a matching mapping");let v={begin:{divIdx:h,offset:b-u}};for(b+=c[m];h!==p&&b>u+d[h].length;)u+=d[h].length,h++;v.end={divIdx:h,offset:b-u},f.push(v)}return f}_renderMatches(l){if(l.length===0)return;let{findController:c,pageIdx:d}=this,{textContentItemsStr:h,textDivs:u}=this,p=d===c.selected.pageIdx,f=c.selected.matchIdx,m=c.state.highlightAll,g=null,b={divIdx:-1,offset:void 0};function v(C,A){let D=C.divIdx;return u[D].textContent="",E(D,0,C.offset,A)}function E(C,A,D,M){let I=u[C];if(I.nodeType===Node.TEXT_NODE){let V=document.createElement("span");I.before(V),V.append(I),u[C]=V,I=V}let O=h[C].substring(A,D),F=document.createTextNode(O);if(M){let V=document.createElement("span");return V.className=`${M} appended`,V.append(F),I.append(V),M.includes("selected")?V.offsetLeft:0}return I.append(F),0}let y=f,w=y+1;if(m)y=0,w=l.length;else if(!p)return;for(let C=y;C<w;C++){let A=l[C],D=A.begin,M=A.end,I=p&&C===f,O=I?" selected":"",F=0;if(!g||D.divIdx!==g.divIdx?(g!==null&&E(g.divIdx,g.offset,b.offset),v(D)):E(g.divIdx,g.offset,D.offset),D.divIdx===M.divIdx)F=E(D.divIdx,D.offset,M.offset,"highlight"+O);else{F=E(D.divIdx,D.offset,b.offset,"highlight begin"+O);for(let V=D.divIdx+1,x=M.divIdx;V<x;V++)u[V].className="highlight middle"+O;v(M,"highlight end"+O)}g=M,I&&c.scrollMatchIntoView({element:u[D.divIdx],selectedLeft:F,pageIndex:d,matchIndex:f})}g&&E(g.divIdx,g.offset,b.offset)}_updateMatches(){if(!this.enabled)return;let{findController:l,matches:c,pageIdx:d}=this,{textContentItemsStr:h,textDivs:u}=this,p=-1;for(let g=0,b=c.length;g<b;g++){let v=c[g],E=Math.max(p,v.begin.divIdx);for(let y=E,w=v.end.divIdx;y<=w;y++){let C=u[y];C.textContent=h[y],C.className=""}p=v.end.divIdx+1}if(!l?.highlightMatches)return;let f=l.pageMatches[d]||null,m=l.pageMatchesLength[d]||null;this.matches=this._convertMatches(f,m),this._renderMatches(this.matches)}}r.TextHighlighter=o},(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DownloadManager=void 0;var a=o(3);function l(d,h){let u=document.createElement("a");if(!u.click)throw new Error('DownloadManager: "a.click()" is not supported.');u.href=d,u.target="_parent","download"in u&&(u.download=h),(document.body||document.documentElement).append(u),u.click(),u.remove()}class c{constructor(){this._openBlobUrls=new WeakMap}downloadUrl(h,u){if(!(0,a.createValidAbsoluteUrl)(h,"http://example.com")){console.error(`downloadUrl - not a valid URL: ${h}`);return}l(h+"#pdfjs.action=download",u)}downloadData(h,u,p){let f=URL.createObjectURL(new Blob([h],{type:p}));l(f,u)}openOrDownloadData(h,u,p){let f=(0,a.isPdfFile)(p),m=f?"application/pdf":"";if(f){let g=this._openBlobUrls.get(h);g||(g=URL.createObjectURL(new Blob([u],{type:m})),this._openBlobUrls.set(h,g));let b;b="?file="+encodeURIComponent(g+"#"+p);try{return window.open(b),!0}catch(v){console.error(`openOrDownloadData: ${v}`),URL.revokeObjectURL(g),this._openBlobUrls.delete(h)}}return this.downloadData(u,p,m),!1}download(h,u,p){let f=URL.createObjectURL(h);l(f,p)}}r.DownloadManager=c},(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.WaitOnType=r.EventBus=r.AutomationEventBus=void 0,r.waitOnEventOrTimeout=a;let o={EVENT:"event",TIMEOUT:"timeout"};r.WaitOnType=o;function a({target:d,name:h,delay:u=0}){return new Promise(function(p,f){if(typeof d!="object"||!(h&&typeof h=="string")||!(Number.isInteger(u)&&u>=0))throw new Error("waitOnEventOrTimeout - invalid parameters.");function m(E){d instanceof l?d._off(h,g):d.removeEventListener(h,g),v&&clearTimeout(v),p(E)}let g=m.bind(null,o.EVENT);d instanceof l?d._on(h,g):d.addEventListener(h,g);let b=m.bind(null,o.TIMEOUT),v=setTimeout(b,u)})}class l{constructor(){this._listeners=Object.create(null)}on(h,u,p=null){this._on(h,u,{external:!0,once:p?.once})}off(h,u,p=null){this._off(h,u,{external:!0,once:p?.once})}dispatch(h,u){let p=this._listeners[h];if(!p||p.length===0)return;let f;for(let{listener:m,external:g,once:b}of p.slice(0)){if(b&&this._off(h,m),g){(f||=[]).push(m);continue}m(u)}if(f){for(let m of f)m(u);f=null}}_on(h,u,p=null){(this._listeners[h]||=[]).push({listener:u,external:p?.external===!0,once:p?.once===!0})}_off(h,u,p=null){let f=this._listeners[h];if(f){for(let m=0,g=f.length;m<g;m++)if(f[m].listener===u){f.splice(m,1);return}}}}r.EventBus=l;class c extends l{dispatch(h,u){throw new Error("Not implemented: AutomationEventBus.dispatch")}}r.AutomationEventBus=c},(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.GenericL10n=void 0,o(21);var a=o(4);let l=document.webL10n;class c{constructor(h){this._lang=h,this._ready=new Promise((u,p)=>{l.setLanguage((0,a.fixupLangCode)(h),()=>{u(l)})})}getLanguage(){return ie(this,null,function*(){return(yield this._ready).getLanguage()})}getDirection(){return ie(this,null,function*(){return(yield this._ready).getDirection()})}get(f){return ie(this,arguments,function*(h,u=null,p=(0,a.getL10nFallback)(h,u)){return(yield this._ready).get(h,u,p)})}translate(h){return ie(this,null,function*(){return(yield this._ready).translate(h)})}}r.GenericL10n=c},()=>{document.webL10n=function(n,r,o){var a={},l="",c="textContent",d="",h={},u="loading",p=!0;function f(){return r.querySelectorAll('link[type="application/l10n"]')}function m(){var V=r.querySelector('script[type="application/l10n"]');return V?JSON.parse(V.innerHTML):null}function g(V){return V?V.querySelectorAll("*[data-l10n-id]"):[]}function b(V){if(!V)return{};var x=V.getAttribute("data-l10n-id"),N=V.getAttribute("data-l10n-args"),z={};if(N)try{z=JSON.parse(N)}catch{console.warn("could not parse arguments for #"+x)}return{id:x,args:z}}function v(V,x,N){x=x||function(X){},N=N||function(){};var z=new XMLHttpRequest;z.open("GET",V,p),z.overrideMimeType&&z.overrideMimeType("text/plain; charset=utf-8"),z.onreadystatechange=function(){z.readyState==4&&(z.status==200||z.status===0?x(z.responseText):N())},z.onerror=N,z.ontimeout=N;try{z.send(null)}catch{N()}}function E(V,x,N,z){var G=V.replace(/[^\/]*$/,"")||"./";function X(B){return B.lastIndexOf("\\")<0?B:B.replace(/\\\\/g,"\\").replace(/\\n/g,`
`).replace(/\\r/g,"\r").replace(/\\t/g,"	").replace(/\\b/g,"\b").replace(/\\f/g,"\f").replace(/\\{/g,"{").replace(/\\}/g,"}").replace(/\\"/g,'"').replace(/\\'/g,"'")}function k(B,R){var j={},$=/^\s*|\s*$/,T=/^\s*#|^\s*$/,U=/^\s*\[(.*)\]\s*$/,W=/^\s*@import\s+url\((.*)\)\s*$/i,Q=/^([^=\s]*)\s*=\s*(.+)$/;function te(oe,pe,de){var fe=oe.replace($,"").split(/[\r\n]+/),P="*",se=x.split("-",1)[0],re=!1,K="";function ee(){for(;;){if(!fe.length){de();return}var le=fe.shift();if(!T.test(le)){if(pe){if(K=U.exec(le),K){P=K[1].toLowerCase(),re=P!=="*"&&P!==x&&P!==se;continue}else if(re)continue;if(K=W.exec(le),K){J(G+K[1],ee);return}}var xe=le.match(Q);xe&&xe.length==3&&(j[xe[1]]=X(xe[2]))}}}ee()}function J(oe,pe){v(oe,function(de){te(de,!1,pe)},function(){console.warn(oe+" not found."),pe()})}te(B,!0,function(){R(j)})}v(V,function(B){l+=B,k(B,function(R){for(var j in R){var $,T,U=j.lastIndexOf(".");U>0?($=j.substring(0,U),T=j.substring(U+1)):($=j,T=c),a[$]||(a[$]={}),a[$][T]=R[j]}N&&N()})},z)}function y(V,x){V&&(V=V.toLowerCase()),x=x||function(){},w(),d=V;var N=f(),z=N.length;if(z===0){var G=m();if(G&&G.locales&&G.default_locale){if(console.log("using the embedded JSON directory, early way out"),a=G.locales[V],!a){var X=G.default_locale.toLowerCase();for(var k in G.locales)if(k=k.toLowerCase(),k===V){a=G.locales[V];break}else k===X&&(a=G.locales[X])}x()}else console.log("no resource to load, early way out");u="complete";return}var B=null,R=0;B=function(){R++,R>=z&&(x(),u="complete")};function j(U){var W=U.href;this.load=function(Q,te){E(W,Q,te,function(){console.warn(W+" not found."),console.warn('"'+Q+'" resource not found'),d="",te()})}}for(var $=0;$<z;$++){var T=new j(N[$]);T.load(V,B)}}function w(){a={},l="",d=""}function C(V){var x={af:3,ak:4,am:4,ar:1,asa:3,az:0,be:11,bem:3,bez:3,bg:3,bh:4,bm:0,bn:3,bo:0,br:20,brx:3,bs:11,ca:3,cgg:3,chr:3,cs:12,cy:17,da:3,de:3,dv:3,dz:0,ee:3,el:3,en:3,eo:3,es:3,et:3,eu:3,fa:0,ff:5,fi:3,fil:4,fo:3,fr:5,fur:3,fy:3,ga:8,gd:24,gl:3,gsw:3,gu:3,guw:4,gv:23,ha:3,haw:3,he:2,hi:4,hr:11,hu:0,id:0,ig:0,ii:0,is:3,it:3,iu:7,ja:0,jmc:3,jv:0,ka:0,kab:5,kaj:3,kcg:3,kde:0,kea:0,kk:3,kl:3,km:0,kn:0,ko:0,ksb:3,ksh:21,ku:3,kw:7,lag:18,lb:3,lg:3,ln:4,lo:0,lt:10,lv:6,mas:3,mg:4,mk:16,ml:3,mn:3,mo:9,mr:3,ms:0,mt:15,my:0,nah:3,naq:7,nb:3,nd:3,ne:3,nl:3,nn:3,no:3,nr:3,nso:4,ny:3,nyn:3,om:3,or:3,pa:3,pap:3,pl:13,ps:3,pt:3,rm:3,ro:9,rof:3,ru:11,rwk:3,sah:0,saq:3,se:7,seh:3,ses:0,sg:0,sh:11,shi:19,sk:12,sl:14,sma:7,smi:7,smj:7,smn:7,sms:7,sn:3,so:3,sq:3,sr:11,ss:3,ssy:3,st:3,sv:3,sw:3,syr:3,ta:3,te:3,teo:3,th:0,ti:4,tig:3,tk:3,tl:4,tn:3,to:0,tr:0,ts:3,tzm:22,uk:11,ur:3,ve:3,vi:0,vun:3,wa:4,wae:3,wo:0,xh:3,xog:3,yo:0,zh:0,zu:3};function N(k,B){return B.indexOf(k)!==-1}function z(k,B,R){return B<=k&&k<=R}var G={0:function(k){return"other"},1:function(k){return z(k%100,3,10)?"few":k===0?"zero":z(k%100,11,99)?"many":k==2?"two":k==1?"one":"other"},2:function(k){return k!==0&&k%10===0?"many":k==2?"two":k==1?"one":"other"},3:function(k){return k==1?"one":"other"},4:function(k){return z(k,0,1)?"one":"other"},5:function(k){return z(k,0,2)&&k!=2?"one":"other"},6:function(k){return k===0?"zero":k%10==1&&k%100!=11?"one":"other"},7:function(k){return k==2?"two":k==1?"one":"other"},8:function(k){return z(k,3,6)?"few":z(k,7,10)?"many":k==2?"two":k==1?"one":"other"},9:function(k){return k===0||k!=1&&z(k%100,1,19)?"few":k==1?"one":"other"},10:function(k){return z(k%10,2,9)&&!z(k%100,11,19)?"few":k%10==1&&!z(k%100,11,19)?"one":"other"},11:function(k){return z(k%10,2,4)&&!z(k%100,12,14)?"few":k%10===0||z(k%10,5,9)||z(k%100,11,14)?"many":k%10==1&&k%100!=11?"one":"other"},12:function(k){return z(k,2,4)?"few":k==1?"one":"other"},13:function(k){return z(k%10,2,4)&&!z(k%100,12,14)?"few":k!=1&&z(k%10,0,1)||z(k%10,5,9)||z(k%100,12,14)?"many":k==1?"one":"other"},14:function(k){return z(k%100,3,4)?"few":k%100==2?"two":k%100==1?"one":"other"},15:function(k){return k===0||z(k%100,2,10)?"few":z(k%100,11,19)?"many":k==1?"one":"other"},16:function(k){return k%10==1&&k!=11?"one":"other"},17:function(k){return k==3?"few":k===0?"zero":k==6?"many":k==2?"two":k==1?"one":"other"},18:function(k){return k===0?"zero":z(k,0,2)&&k!==0&&k!=2?"one":"other"},19:function(k){return z(k,2,10)?"few":z(k,0,1)?"one":"other"},20:function(k){return(z(k%10,3,4)||k%10==9)&&!(z(k%100,10,19)||z(k%100,70,79)||z(k%100,90,99))?"few":k%1e6===0&&k!==0?"many":k%10==2&&!N(k%100,[12,72,92])?"two":k%10==1&&!N(k%100,[11,71,91])?"one":"other"},21:function(k){return k===0?"zero":k==1?"one":"other"},22:function(k){return z(k,0,1)||z(k,11,99)?"one":"other"},23:function(k){return z(k%10,1,2)||k%20===0?"one":"other"},24:function(k){return z(k,3,10)||z(k,13,19)?"few":N(k,[2,12])?"two":N(k,[1,11])?"one":"other"}},X=x[V.replace(/-.*$/,"")];return X in G?G[X]:(console.warn("plural form unknown for ["+V+"]"),function(){return"other"})}h.plural=function(V,x,N,z){var G=parseFloat(x);if(isNaN(G)||z!=c)return V;h._pluralRules||(h._pluralRules=C(d));var X="["+h._pluralRules(G)+"]";return G===0&&N+"[zero]"in a?V=a[N+"[zero]"][z]:G==1&&N+"[one]"in a?V=a[N+"[one]"][z]:G==2&&N+"[two]"in a?V=a[N+"[two]"][z]:N+X in a?V=a[N+X][z]:N+"[other]"in a&&(V=a[N+"[other]"][z]),V};function A(V,x,N){var z=a[V];if(!z){if(console.warn("#"+V+" is undefined."),!N)return null;z=N}var G={};for(var X in z){var k=z[X];k=D(k,x,V,X),k=M(k,x,V),G[X]=k}return G}function D(V,x,N,z){var G=/\{\[\s*([a-zA-Z]+)\(([a-zA-Z]+)\)\s*\]\}/,X=G.exec(V);if(!X||!X.length)return V;var k=X[1],B=X[2],R;if(x&&B in x?R=x[B]:B in a&&(R=a[B]),k in h){var j=h[k];V=j(V,R,N,z)}return V}function M(V,x,N){var z=/\{\{\s*(.+?)\s*\}\}/g;return V.replace(z,function(G,X){return x&&X in x?x[X]:X in a?a[X]:(console.log("argument {{"+X+"}} for #"+N+" is undefined."),G)})}function I(V){var x=b(V);if(x.id){var N=A(x.id,x.args);if(!N){console.warn("#"+x.id+" is undefined.");return}if(N[c]){if(O(V)===0)V[c]=N[c];else{for(var z=V.childNodes,G=!1,X=0,k=z.length;X<k;X++)z[X].nodeType===3&&/\S/.test(z[X].nodeValue)&&(G?z[X].nodeValue="":(z[X].nodeValue=N[c],G=!0));if(!G){var B=r.createTextNode(N[c]);V.prepend(B)}}delete N[c]}for(var R in N)V[R]=N[R]}}function O(V){if(V.children)return V.children.length;if(typeof V.childElementCount<"u")return V.childElementCount;for(var x=0,N=0;N<V.childNodes.length;N++)x+=V.nodeType===1?1:0;return x}function F(V){V=V||r.documentElement;for(var x=g(V),N=x.length,z=0;z<N;z++)I(x[z]);I(V)}return{get:function(V,x,N){var z=V.lastIndexOf("."),G=c;z>0&&(G=V.substring(z+1),V=V.substring(0,z));var X;N&&(X={},X[G]=N);var k=A(V,x,X);return k&&G in k?k[G]:"{{"+V+"}}"},getData:function(){return a},getText:function(){return l},getLanguage:function(){return d},setLanguage:function(V,x){y(V,function(){x&&x()})},getDirection:function(){var V=["ar","he","fa","ps","ur"],x=d.split("-",1)[0];return V.indexOf(x)>=0?"rtl":"ltr"},translate:F,getReadyState:function(){return u},ready:function(V){if(V)u=="complete"||u=="interactive"?n.setTimeout(function(){V()}):r.addEventListener&&r.addEventListener("localized",function x(){r.removeEventListener("localized",x),V()});else return}}}(window,document)},(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PDFFindController=r.FindState=void 0;var a=o(7),l=o(3),c=o(23);let d={FOUND:0,NOT_FOUND:1,WRAPPED:2,PENDING:3};r.FindState=d;let h=250,u=-50,p=-400,f={"\u2010":"-","\u2018":"'","\u2019":"'","\u201A":"'","\u201B":"'","\u201C":'"',"\u201D":'"',"\u201E":'"',"\u201F":'"',"\xBC":"1/4","\xBD":"1/2","\xBE":"3/4"},m=new Set([12441,12442,2381,2509,2637,2765,2893,3021,3149,3277,3387,3388,3405,3530,3642,3770,3972,4153,4154,5908,5940,6098,6752,6980,7082,7083,7154,7155,11647,43014,43052,43204,43347,43456,43766,44013,3158,3953,3954,3962,3963,3964,3965,3968,3956]),g=[...m.values()].map(V=>String.fromCharCode(V)).join(""),b=new RegExp("\\p{M}+","gu"),v=new RegExp("([.*+?^${}()|[\\]\\\\])|(\\p{P})|(\\s+)|(\\p{M})|(\\p{L})","gu"),E=new RegExp("([^\\p{M}])\\p{M}*$","u"),y=new RegExp("^\\p{M}*([^\\p{M}])","u"),w=/[\uAC00-\uD7AF\uFA6C\uFACF-\uFAD1\uFAD5-\uFAD7]+/g,C=new Map,A="[\\u1100-\\u1112\\ud7a4-\\ud7af\\ud84a\\ud84c\\ud850\\ud854\\ud857\\ud85f]",D=null,M=null;function I(V){let x=[],N;for(;(N=w.exec(V))!==null;){let{index:W}=N;for(let Q of N[0]){let te=C.get(Q);te||(te=Q.normalize("NFD").length,C.set(Q,te)),x.push([te,W++])}}let z;if(x.length===0&&D)z=D;else if(x.length>0&&M)z=M;else{let Q=`([${Object.keys(f).join("")}])|(\\p{M}+(?:-\\n)?)|(\\S-\\n)|(\\n)`;x.length===0?z=D=new RegExp(Q+"|(\\u0000)","gum"):z=M=new RegExp(Q+`|(${A})`,"gum")}let G=[];for(;(N=b.exec(V))!==null;)G.push([N[0].length,N.index]);let X=V.normalize("NFD"),k=[[0,0]],B=0,R=0,j=0,$=0,T=0,U=!1;return X=X.replace(z,(W,Q,te,J,oe,pe,de)=>{if(de-=$,Q){let fe=f[W],P=fe.length;for(let se=1;se<P;se++)k.push([de-j+se,j-se]);return j-=P-1,fe}if(te){let fe=te.endsWith(`
`),P=fe?te.length-2:te.length;U=!0;let se=P;de+T===G[B]?.[1]&&(se-=G[B][0],++B);for(let re=1;re<=se;re++)k.push([de-1-j+re,j-re]);return j-=se,$+=se,fe?(de+=P-1,k.push([de-j+1,1+j]),j+=1,$+=1,T+=1,te.slice(0,P)):te}if(J)return k.push([de-j+1,1+j]),j+=1,$+=1,T+=1,J.charAt(0);if(oe)return k.push([de-j+1,j-1]),j-=1,$+=1,T+=1," ";if(de+T===x[R]?.[1]){let fe=x[R][0]-1;++R;for(let P=1;P<=fe;P++)k.push([de-(j-P),j-P]);j-=fe,$+=fe}return pe}),k.push([X.length,j]),[X,k,U]}function O(V,x,N){if(!V)return[x,N];let z=x,G=x+N,X=(0,a.binarySearchFirstItem)(V,B=>B[0]>=z);V[X][0]>z&&--X;let k=(0,a.binarySearchFirstItem)(V,B=>B[0]>=G,X);return V[k][0]>G&&--k,[z+V[X][1],N+V[k][1]-V[X][1]]}class F{constructor({linkService:x,eventBus:N}){this._linkService=x,this._eventBus=N,this.#t(),N._on("find",this.#e.bind(this)),N._on("findbarclose",this.#b.bind(this))}get highlightMatches(){return this._highlightMatches}get pageMatches(){return this._pageMatches}get pageMatchesLength(){return this._pageMatchesLength}get selected(){return this._selected}get state(){return this._state}setDocument(x){this._pdfDocument&&this.#t(),x&&(this._pdfDocument=x,this._firstPageCapability.resolve())}#e(x){if(!x)return;let N=this._pdfDocument,{type:z}=x;(this._state===null||this.#n(x))&&(this._dirtyMatch=!0),this._state=x,z!=="highlightallchange"&&this.#d(d.PENDING),this._firstPageCapability.promise.then(()=>{if(!this._pdfDocument||N&&this._pdfDocument!==N)return;this.#u();let G=!this._highlightMatches,X=!!this._findTimeout;this._findTimeout&&(clearTimeout(this._findTimeout),this._findTimeout=null),z?this._dirtyMatch?this.#o():z==="again"?(this.#o(),G&&this._state.highlightAll&&this.#l()):z==="highlightallchange"?(X?this.#o():this._highlightMatches=!0,this.#l()):this.#o():this._findTimeout=setTimeout(()=>{this.#o(),this._findTimeout=null},h)})}scrollMatchIntoView({element:x=null,selectedLeft:N=0,pageIndex:z=-1,matchIndex:G=-1}){if(!this._scrollMatches||!x)return;if(G===-1||G!==this._selected.matchIdx)return;if(z===-1||z!==this._selected.pageIdx)return;this._scrollMatches=!1;let X={top:u,left:N+p};(0,a.scrollIntoView)(x,X,!0)}#t(){this._highlightMatches=!1,this._scrollMatches=!1,this._pdfDocument=null,this._pageMatches=[],this._pageMatchesLength=[],this._state=null,this._selected={pageIdx:-1,matchIdx:-1},this._offset={pageIdx:null,matchIdx:null,wrapped:!1},this._extractTextPromises=[],this._pageContents=[],this._pageDiffs=[],this._hasDiacritics=[],this._matchesCountTotal=0,this._pagesToSearch=null,this._pendingFindMatches=new Set,this._resumePageIdx=null,this._dirtyMatch=!1,clearTimeout(this._findTimeout),this._findTimeout=null,this._firstPageCapability=(0,l.createPromiseCapability)()}get#i(){return this._state.query!==this._rawQuery&&(this._rawQuery=this._state.query,[this._normalizedQuery]=I(this._state.query)),this._normalizedQuery}#n(x){if(x.query!==this._state.query)return!0;switch(x.type){case"again":let N=this._selected.pageIdx+1,z=this._linkService;return N>=1&&N<=z.pagesCount&&N!==z.page&&!z.isPageVisible(N);case"highlightallchange":return!1}return!0}#r(x,N,z){let G=x.slice(0,N).match(E);if(G){let X=x.charCodeAt(N),k=G[1].charCodeAt(0);if((0,c.getCharacterType)(X)===(0,c.getCharacterType)(k))return!1}if(G=x.slice(N+z).match(y),G){let X=x.charCodeAt(N+z-1),k=G[1].charCodeAt(0);if((0,c.getCharacterType)(X)===(0,c.getCharacterType)(k))return!1}return!0}#c(x,N,z,G){let X=[],k=[],B=this._pageDiffs[z],R;for(;(R=x.exec(G))!==null;){if(N&&!this.#r(G,R.index,R[0].length))continue;let[j,$]=O(B,R.index,R[0].length);$&&(X.push(j),k.push($))}this._pageMatches[z]=X,this._pageMatchesLength[z]=k}#a(x,N){let{matchDiacritics:z}=this._state,G=!1;x=x.replace(v,(k,B,R,j,$,T)=>B?`[ ]*\\${B}[ ]*`:R?`[ ]*${R}[ ]*`:j?"[ ]+":z?$||T:$?m.has($.charCodeAt(0))?$:"":N?(G=!0,`${T}\\p{M}*`):T);let X="[ ]*";return x.endsWith(X)&&(x=x.slice(0,x.length-X.length)),z&&N&&(G=!0,x=`${x}(?=[${g}]|[^\\p{M}]|$)`),[G,x]}#s(x){let N=this.#i;if(N.length===0)return;let{caseSensitive:z,entireWord:G,phraseSearch:X}=this._state,k=this._pageContents[x],B=this._hasDiacritics[x],R=!1;if(X)[R,N]=this.#a(N,B);else{let T=N.match(/\S+/g);T&&(N=T.sort().reverse().map(U=>{let[W,Q]=this.#a(U,B);return R||=W,`(${Q})`}).join("|"))}let j=`g${R?"u":""}${z?"":"i"}`;N=new RegExp(N,j),this.#c(N,G,x,k),this._state.highlightAll&&this.#h(x),this._resumePageIdx===x&&(this._resumePageIdx=null,this.#p());let $=this._pageMatches[x].length;$>0&&(this._matchesCountTotal+=$,this.#_())}#u(){if(this._extractTextPromises.length>0)return;let x=Promise.resolve();for(let N=0,z=this._linkService.pagesCount;N<z;N++){let G=(0,l.createPromiseCapability)();this._extractTextPromises[N]=G.promise,x=x.then(()=>this._pdfDocument.getPage(N+1).then(X=>X.getTextContent()).then(X=>{let k=[];for(let B of X.items)k.push(B.str),B.hasEOL&&k.push(`
`);[this._pageContents[N],this._pageDiffs[N],this._hasDiacritics[N]]=I(k.join("")),G.resolve()},X=>{console.error(`Unable to get text content for page ${N+1}`,X),this._pageContents[N]="",this._pageDiffs[N]=null,this._hasDiacritics[N]=!1,G.resolve()}))}}#h(x){this._scrollMatches&&this._selected.pageIdx===x&&(this._linkService.page=x+1),this._eventBus.dispatch("updatetextlayermatches",{source:this,pageIndex:x})}#l(){this._eventBus.dispatch("updatetextlayermatches",{source:this,pageIndex:-1})}#o(){let x=this._state.findPrevious,N=this._linkService.page-1,z=this._linkService.pagesCount;if(this._highlightMatches=!0,this._dirtyMatch){this._dirtyMatch=!1,this._selected.pageIdx=this._selected.matchIdx=-1,this._offset.pageIdx=N,this._offset.matchIdx=null,this._offset.wrapped=!1,this._resumePageIdx=null,this._pageMatches.length=0,this._pageMatchesLength.length=0,this._matchesCountTotal=0,this.#l();for(let X=0;X<z;X++)this._pendingFindMatches.has(X)||(this._pendingFindMatches.add(X),this._extractTextPromises[X].then(()=>{this._pendingFindMatches.delete(X),this.#s(X)}))}if(this.#i===""){this.#d(d.FOUND);return}if(this._resumePageIdx)return;let G=this._offset;if(this._pagesToSearch=z,G.matchIdx!==null){let X=this._pageMatches[G.pageIdx].length;if(!x&&G.matchIdx+1<X||x&&G.matchIdx>0){G.matchIdx=x?G.matchIdx-1:G.matchIdx+1,this.#g(!0);return}this.#v(x)}this.#p()}#f(x){let N=this._offset,z=x.length,G=this._state.findPrevious;return z?(N.matchIdx=G?z-1:0,this.#g(!0),!0):(this.#v(G),N.wrapped&&(N.matchIdx=null,this._pagesToSearch<0)?(this.#g(!1),!0):!1)}#p(){this._resumePageIdx!==null&&console.error("There can only be one pending page.");let x=null;do{let N=this._offset.pageIdx;if(x=this._pageMatches[N],!x){this._resumePageIdx=N;break}}while(!this.#f(x))}#v(x){let N=this._offset,z=this._linkService.pagesCount;N.pageIdx=x?N.pageIdx-1:N.pageIdx+1,N.matchIdx=null,this._pagesToSearch--,(N.pageIdx>=z||N.pageIdx<0)&&(N.pageIdx=x?z-1:0,N.wrapped=!0)}#g(x=!1){let N=d.NOT_FOUND,z=this._offset.wrapped;if(this._offset.wrapped=!1,x){let G=this._selected.pageIdx;this._selected.pageIdx=this._offset.pageIdx,this._selected.matchIdx=this._offset.matchIdx,N=z?d.WRAPPED:d.FOUND,G!==-1&&G!==this._selected.pageIdx&&this.#h(G)}this.#d(N,this._state.findPrevious),this._selected.pageIdx!==-1&&(this._scrollMatches=!0,this.#h(this._selected.pageIdx))}#b(x){let N=this._pdfDocument;this._firstPageCapability.promise.then(()=>{!this._pdfDocument||N&&this._pdfDocument!==N||(this._findTimeout&&(clearTimeout(this._findTimeout),this._findTimeout=null),this._resumePageIdx&&(this._resumePageIdx=null,this._dirtyMatch=!0),this.#d(d.FOUND),this._highlightMatches=!1,this.#l())})}#E(){let{pageIdx:x,matchIdx:N}=this._selected,z=0,G=this._matchesCountTotal;if(N!==-1){for(let X=0;X<x;X++)z+=this._pageMatches[X]?.length||0;z+=N+1}return(z<1||z>G)&&(z=G=0),{current:z,total:G}}#_(){this._eventBus.dispatch("updatefindmatchescount",{source:this,matchesCount:this.#E()})}#d(x,N=!1){this._eventBus.dispatch("updatefindcontrolstate",{source:this,state:x,previous:N,matchesCount:this.#E(),rawQuery:this._state?.query??null})}}r.PDFFindController=F},(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.CharacterType=void 0,r.getCharacterType=b;let o={SPACE:0,ALPHA_LETTER:1,PUNCT:2,HAN_LETTER:3,KATAKANA_LETTER:4,HIRAGANA_LETTER:5,HALFWIDTH_KATAKANA_LETTER:6,THAI_LETTER:7};r.CharacterType=o;function a(v){return v<11904}function l(v){return(v&65408)===0}function c(v){return v>=97&&v<=122||v>=65&&v<=90}function d(v){return v>=48&&v<=57}function h(v){return v===32||v===9||v===13||v===10}function u(v){return v>=13312&&v<=40959||v>=63744&&v<=64255}function p(v){return v>=12448&&v<=12543}function f(v){return v>=12352&&v<=12447}function m(v){return v>=65376&&v<=65439}function g(v){return(v&65408)===3584}function b(v){return a(v)?l(v)?h(v)?o.SPACE:c(v)||d(v)||v===95?o.ALPHA_LETTER:o.PUNCT:g(v)?o.THAI_LETTER:v===160?o.SPACE:o.ALPHA_LETTER:u(v)?o.HAN_LETTER:p(v)?o.KATAKANA_LETTER:f(v)?o.HIRAGANA_LETTER:m(v)?o.HALFWIDTH_KATAKANA_LETTER:o.ALPHA_LETTER}},(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PDFHistory=void 0,r.isDestArraysEqual=m,r.isDestHashesEqual=f;var a=o(7),l=o(19);let c=1e3,d=50,h=1e3;function u(){return document.location.hash}class p{constructor({linkService:b,eventBus:v}){this.linkService=b,this.eventBus=v,this._initialized=!1,this._fingerprint="",this.reset(),this._boundEvents=null,this.eventBus._on("pagesinit",()=>{this._isPagesLoaded=!1,this.eventBus._on("pagesloaded",E=>{this._isPagesLoaded=!!E.pagesCount},{once:!0})})}initialize({fingerprint:b,resetHistory:v=!1,updateUrl:E=!1}){if(!b||typeof b!="string"){console.error('PDFHistory.initialize: The "fingerprint" must be a non-empty string.');return}this._initialized&&this.reset();let y=this._fingerprint!==""&&this._fingerprint!==b;this._fingerprint=b,this._updateUrl=E===!0,this._initialized=!0,this._bindEvents();let w=window.history.state;if(this._popStateInProgress=!1,this._blockHashChange=0,this._currentHash=u(),this._numPositionUpdates=0,this._uid=this._maxUid=0,this._destination=null,this._position=null,!this._isValidState(w,!0)||v){let{hash:A,page:D,rotation:M}=this._parseCurrentHash(!0);if(!A||y||v){this._pushOrReplaceState(null,!0);return}this._pushOrReplaceState({hash:A,page:D,rotation:M},!0);return}let C=w.destination;this._updateInternalState(C,w.uid,!0),C.rotation!==void 0&&(this._initialRotation=C.rotation),C.dest?(this._initialBookmark=JSON.stringify(C.dest),this._destination.page=null):C.hash?this._initialBookmark=C.hash:C.page&&(this._initialBookmark=`page=${C.page}`)}reset(){this._initialized&&(this._pageHide(),this._initialized=!1,this._unbindEvents()),this._updateViewareaTimeout&&(clearTimeout(this._updateViewareaTimeout),this._updateViewareaTimeout=null),this._initialBookmark=null,this._initialRotation=null}push({namedDest:b=null,explicitDest:v,pageNumber:E}){if(!this._initialized)return;if(b&&typeof b!="string"){console.error(`PDFHistory.push: "${b}" is not a valid namedDest parameter.`);return}else if(Array.isArray(v)){if(!this._isValidPage(E)&&(E!==null||this._destination)){console.error(`PDFHistory.push: "${E}" is not a valid pageNumber parameter.`);return}}else{console.error(`PDFHistory.push: "${v}" is not a valid explicitDest parameter.`);return}let y=b||JSON.stringify(v);if(!y)return;let w=!1;if(this._destination&&(f(this._destination.hash,y)||m(this._destination.dest,v))){if(this._destination.page)return;w=!0}this._popStateInProgress&&!w||(this._pushOrReplaceState({dest:v,hash:y,page:E,rotation:this.linkService.rotation},w),this._popStateInProgress||(this._popStateInProgress=!0,Promise.resolve().then(()=>{this._popStateInProgress=!1})))}pushPage(b){if(this._initialized){if(!this._isValidPage(b)){console.error(`PDFHistory.pushPage: "${b}" is not a valid page number.`);return}this._destination?.page!==b&&(this._popStateInProgress||(this._pushOrReplaceState({dest:null,hash:`page=${b}`,page:b,rotation:this.linkService.rotation}),this._popStateInProgress||(this._popStateInProgress=!0,Promise.resolve().then(()=>{this._popStateInProgress=!1}))))}}pushCurrentPosition(){!this._initialized||this._popStateInProgress||this._tryPushCurrentPosition()}back(){if(!this._initialized||this._popStateInProgress)return;let b=window.history.state;this._isValidState(b)&&b.uid>0&&window.history.back()}forward(){if(!this._initialized||this._popStateInProgress)return;let b=window.history.state;this._isValidState(b)&&b.uid<this._maxUid&&window.history.forward()}get popStateInProgress(){return this._initialized&&(this._popStateInProgress||this._blockHashChange>0)}get initialBookmark(){return this._initialized?this._initialBookmark:null}get initialRotation(){return this._initialized?this._initialRotation:null}_pushOrReplaceState(b,v=!1){let E=v||!this._destination,y={fingerprint:this._fingerprint,uid:E?this._uid:this._uid+1,destination:b};this._updateInternalState(b,y.uid);let w;if(this._updateUrl&&b?.hash){let C=document.location.href.split("#")[0];C.startsWith("file://")||(w=`${C}#${b.hash}`)}E?window.history.replaceState(y,"",w):window.history.pushState(y,"",w)}_tryPushCurrentPosition(b=!1){if(!this._position)return;let v=this._position;if(b&&(v=Object.assign(Object.create(null),this._position),v.temporary=!0),!this._destination){this._pushOrReplaceState(v);return}if(this._destination.temporary){this._pushOrReplaceState(v,!0);return}if(this._destination.hash===v.hash||!this._destination.page&&(d<=0||this._numPositionUpdates<=d))return;let E=!1;if(this._destination.page>=v.first&&this._destination.page<=v.page){if(this._destination.dest!==void 0||!this._destination.first)return;E=!0}this._pushOrReplaceState(v,E)}_isValidPage(b){return Number.isInteger(b)&&b>0&&b<=this.linkService.pagesCount}_isValidState(b,v=!1){if(!b)return!1;if(b.fingerprint!==this._fingerprint)if(v){if(typeof b.fingerprint!="string"||b.fingerprint.length!==this._fingerprint.length)return!1;let[E]=performance.getEntriesByType("navigation");if(E?.type!=="reload")return!1}else return!1;return!(!Number.isInteger(b.uid)||b.uid<0||b.destination===null||typeof b.destination!="object")}_updateInternalState(b,v,E=!1){this._updateViewareaTimeout&&(clearTimeout(this._updateViewareaTimeout),this._updateViewareaTimeout=null),E&&b?.temporary&&delete b.temporary,this._destination=b,this._uid=v,this._maxUid=Math.max(this._maxUid,v),this._numPositionUpdates=0}_parseCurrentHash(b=!1){let v=unescape(u()).substring(1),E=(0,a.parseQueryString)(v),y=E.get("nameddest")||"",w=E.get("page")|0;return(!this._isValidPage(w)||b&&y.length>0)&&(w=null),{hash:v,page:w,rotation:this.linkService.rotation}}_updateViewarea({location:b}){this._updateViewareaTimeout&&(clearTimeout(this._updateViewareaTimeout),this._updateViewareaTimeout=null),this._position={hash:b.pdfOpenParams.substring(1),page:this.linkService.page,first:b.pageNumber,rotation:b.rotation},!this._popStateInProgress&&(d>0&&this._isPagesLoaded&&this._destination&&!this._destination.page&&this._numPositionUpdates++,h>0&&(this._updateViewareaTimeout=setTimeout(()=>{this._popStateInProgress||this._tryPushCurrentPosition(!0),this._updateViewareaTimeout=null},h)))}_popState({state:b}){let v=u(),E=this._currentHash!==v;if(this._currentHash=v,!b){this._uid++;let{hash:w,page:C,rotation:A}=this._parseCurrentHash();this._pushOrReplaceState({hash:w,page:C,rotation:A},!0);return}if(!this._isValidState(b))return;this._popStateInProgress=!0,E&&(this._blockHashChange++,(0,l.waitOnEventOrTimeout)({target:window,name:"hashchange",delay:c}).then(()=>{this._blockHashChange--}));let y=b.destination;this._updateInternalState(y,b.uid,!0),(0,a.isValidRotation)(y.rotation)&&(this.linkService.rotation=y.rotation),y.dest?this.linkService.goToDestination(y.dest):y.hash?this.linkService.setHash(y.hash):y.page&&(this.linkService.page=y.page),Promise.resolve().then(()=>{this._popStateInProgress=!1})}_pageHide(){(!this._destination||this._destination.temporary)&&this._tryPushCurrentPosition()}_bindEvents(){this._boundEvents||(this._boundEvents={updateViewarea:this._updateViewarea.bind(this),popState:this._popState.bind(this),pageHide:this._pageHide.bind(this)},this.eventBus._on("updateviewarea",this._boundEvents.updateViewarea),window.addEventListener("popstate",this._boundEvents.popState),window.addEventListener("pagehide",this._boundEvents.pageHide))}_unbindEvents(){this._boundEvents&&(this.eventBus._off("updateviewarea",this._boundEvents.updateViewarea),window.removeEventListener("popstate",this._boundEvents.popState),window.removeEventListener("pagehide",this._boundEvents.pageHide),this._boundEvents=null)}}r.PDFHistory=p;function f(g,b){return typeof g!="string"||typeof b!="string"?!1:g===b||(0,a.parseQueryString)(g).get("nameddest")===b}function m(g,b){function v(E,y){if(typeof E!=typeof y||Array.isArray(E)||Array.isArray(y))return!1;if(E!==null&&typeof E=="object"&&y!==null){if(Object.keys(E).length!==Object.keys(y).length)return!1;for(let w in E)if(!v(E[w],y[w]))return!1;return!0}return E===y||Number.isNaN(E)&&Number.isNaN(y)}if(!(Array.isArray(g)&&Array.isArray(b))||g.length!==b.length)return!1;for(let E=0,y=g.length;E<y;E++)if(!v(g[E],b[E]))return!1;return!0}},(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PDFScriptingManager=void 0;var a=o(7),l=o(3);class c{constructor({eventBus:h,sandboxBundleSrc:u=null,scriptingFactory:p=null,docPropertiesLookup:f=null}){this._pdfDocument=null,this._pdfViewer=null,this._closeCapability=null,this._destroyCapability=null,this._scripting=null,this._mouseState=Object.create(null),this._ready=!1,this._eventBus=h,this._sandboxBundleSrc=u,this._scriptingFactory=p,this._docPropertiesLookup=f,this._scriptingFactory||window.addEventListener("updatefromsandbox",m=>{this._eventBus.dispatch("updatefromsandbox",{source:window,detail:m.detail})})}setViewer(h){this._pdfViewer=h}setDocument(h){return ie(this,null,function*(){if(this._pdfDocument&&(yield this._destroyScripting()),this._pdfDocument=h,!h)return;let[u,p,f]=yield Promise.all([h.getFieldObjects(),h.getCalculationOrderIds(),h.getJSActions()]);if(!u&&!f){yield this._destroyScripting();return}if(h===this._pdfDocument){try{this._scripting=this._createScripting()}catch(m){console.error(`PDFScriptingManager.setDocument: "${m?.message}".`),yield this._destroyScripting();return}this._internalEvents.set("updatefromsandbox",m=>{m?.source===window&&this._updateFromSandbox(m.detail)}),this._internalEvents.set("dispatcheventinsandbox",m=>{this._scripting?.dispatchEventInSandbox(m.detail)}),this._internalEvents.set("pagechanging",({pageNumber:m,previous:g})=>{m!==g&&(this._dispatchPageClose(g),this._dispatchPageOpen(m))}),this._internalEvents.set("pagerendered",({pageNumber:m})=>{this._pageOpenPending.has(m)&&m===this._pdfViewer.currentPageNumber&&this._dispatchPageOpen(m)}),this._internalEvents.set("pagesdestroy",m=>ie(this,null,function*(){yield this._dispatchPageClose(this._pdfViewer.currentPageNumber),yield this._scripting?.dispatchEventInSandbox({id:"doc",name:"WillClose"}),this._closeCapability?.resolve()})),this._domEvents.set("mousedown",m=>{this._mouseState.isDown=!0}),this._domEvents.set("mouseup",m=>{this._mouseState.isDown=!1});for(let[m,g]of this._internalEvents)this._eventBus._on(m,g);for(let[m,g]of this._domEvents)window.addEventListener(m,g,!0);try{let m=yield this._getDocProperties();if(h!==this._pdfDocument)return;yield this._scripting.createSandbox({objects:u,calculationOrder:p,appInfo:{platform:navigator.platform,language:navigator.language},docInfo:yt(Se({},m),{actions:f})}),this._eventBus.dispatch("sandboxcreated",{source:this})}catch(m){console.error(`PDFScriptingManager.setDocument: "${m?.message}".`),yield this._destroyScripting();return}yield this._scripting?.dispatchEventInSandbox({id:"doc",name:"Open"}),yield this._dispatchPageOpen(this._pdfViewer.currentPageNumber,!0),Promise.resolve().then(()=>{h===this._pdfDocument&&(this._ready=!0)})}})}dispatchWillSave(h){return ie(this,null,function*(){return this._scripting?.dispatchEventInSandbox({id:"doc",name:"WillSave"})})}dispatchDidSave(h){return ie(this,null,function*(){return this._scripting?.dispatchEventInSandbox({id:"doc",name:"DidSave"})})}dispatchWillPrint(h){return ie(this,null,function*(){return this._scripting?.dispatchEventInSandbox({id:"doc",name:"WillPrint"})})}dispatchDidPrint(h){return ie(this,null,function*(){return this._scripting?.dispatchEventInSandbox({id:"doc",name:"DidPrint"})})}get mouseState(){return this._mouseState}get destroyPromise(){return this._destroyCapability?.promise||null}get ready(){return this._ready}get _internalEvents(){return(0,l.shadow)(this,"_internalEvents",new Map)}get _domEvents(){return(0,l.shadow)(this,"_domEvents",new Map)}get _pageOpenPending(){return(0,l.shadow)(this,"_pageOpenPending",new Set)}get _visitedPages(){return(0,l.shadow)(this,"_visitedPages",new Map)}_updateFromSandbox(h){return ie(this,null,function*(){let u=this._pdfViewer.isInPresentationMode||this._pdfViewer.isChangingPresentationMode,{id:p,siblings:f,command:m,value:g}=h;if(!p){switch(m){case"clear":console.clear();break;case"error":console.error(g);break;case"layout":if(u)return;let v=(0,a.apiPageLayoutToViewerModes)(g);this._pdfViewer.spreadMode=v.spreadMode;break;case"page-num":this._pdfViewer.currentPageNumber=g+1;break;case"print":yield this._pdfViewer.pagesPromise,this._eventBus.dispatch("print",{source:this});break;case"println":console.log(g);break;case"zoom":if(u)return;this._pdfViewer.currentScaleValue=g;break;case"SaveAs":this._eventBus.dispatch("download",{source:this});break;case"FirstPage":this._pdfViewer.currentPageNumber=1;break;case"LastPage":this._pdfViewer.currentPageNumber=this._pdfViewer.pagesCount;break;case"NextPage":this._pdfViewer.nextPage();break;case"PrevPage":this._pdfViewer.previousPage();break;case"ZoomViewIn":if(u)return;this._pdfViewer.increaseScale();break;case"ZoomViewOut":if(u)return;this._pdfViewer.decreaseScale();break}return}if(u&&h.focus)return;delete h.id,delete h.siblings;let b=f?[p,...f]:[p];for(let v of b){let E=document.querySelector(`[data-element-id="${v}"]`);E?E.dispatchEvent(new CustomEvent("updatefromsandbox",{detail:h})):this._pdfDocument?.annotationStorage.setValue(v,h)}})}_dispatchPageOpen(h,u=!1){return ie(this,null,function*(){let p=this._pdfDocument,f=this._visitedPages;if(u&&(this._closeCapability=(0,l.createPromiseCapability)()),!this._closeCapability)return;let m=this._pdfViewer.getPageView(h-1);if(m?.renderingState!==a.RenderingStates.FINISHED){this._pageOpenPending.add(h);return}this._pageOpenPending.delete(h);let g=ie(this,null,function*(){let b=yield f.has(h)?null:m.pdfPage?.getJSActions();p===this._pdfDocument&&(yield this._scripting?.dispatchEventInSandbox({id:"page",name:"PageOpen",pageNumber:h,actions:b}))});f.set(h,g)})}_dispatchPageClose(h){return ie(this,null,function*(){let u=this._pdfDocument,p=this._visitedPages;if(!this._closeCapability||this._pageOpenPending.has(h))return;let f=p.get(h);f&&(p.set(h,null),yield f,u===this._pdfDocument&&(yield this._scripting?.dispatchEventInSandbox({id:"page",name:"PageClose",pageNumber:h})))})}_getDocProperties(){return ie(this,null,function*(){if(this._docPropertiesLookup)return this._docPropertiesLookup(this._pdfDocument);let{docPropertiesLookup:h}=o(26);return h(this._pdfDocument)})}_createScripting(){if(this._destroyCapability=(0,l.createPromiseCapability)(),this._scripting)throw new Error("_createScripting: Scripting already exists.");if(this._scriptingFactory)return this._scriptingFactory.createScripting({sandboxBundleSrc:this._sandboxBundleSrc});let{GenericScripting:h}=o(26);return new h(this._sandboxBundleSrc)}_destroyScripting(){return ie(this,null,function*(){if(!this._scripting){this._pdfDocument=null,this._destroyCapability?.resolve();return}this._closeCapability&&(yield Promise.race([this._closeCapability.promise,new Promise(h=>{setTimeout(h,1e3)})]).catch(h=>{}),this._closeCapability=null),this._pdfDocument=null;try{yield this._scripting.destroySandbox()}catch{}for(let[h,u]of this._internalEvents)this._eventBus._off(h,u);this._internalEvents.clear();for(let[h,u]of this._domEvents)window.removeEventListener(h,u,!0);this._domEvents.clear(),this._pageOpenPending.clear(),this._visitedPages.clear(),this._scripting=null,delete this._mouseState.isDown,this._ready=!1,this._destroyCapability?.resolve()})}}r.PDFScriptingManager=c},(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.GenericScripting=void 0,r.docPropertiesLookup=l;var a=o(3);function l(d){return ie(this,null,function*(){let h="",u=h.split("#")[0],{info:p,metadata:f,contentDispositionFilename:m,contentLength:g}=yield d.getMetadata();if(!g){let{length:b}=yield d.getDownloadInfo();g=b}return yt(Se({},p),{baseURL:u,filesize:g,filename:m||(0,a.getPdfFilenameFromUrl)(h),metadata:f?.getRaw(),authors:f?.get("dc:creator"),numPages:d.numPages,URL:h})})}class c{constructor(h){this._ready=(0,a.loadScript)(h,!0).then(()=>window.pdfjsSandbox.QuickJSSandbox())}createSandbox(h){return ie(this,null,function*(){(yield this._ready).create(h)})}dispatchEventInSandbox(h){return ie(this,null,function*(){let u=yield this._ready;setTimeout(()=>u.dispatchEvent(h),0)})}destroySandbox(){return ie(this,null,function*(){(yield this._ready).nukeSandbox()})}}r.GenericScripting=c}],e={};function t(n){var r=e[n];if(r!==void 0)return r.exports;var o=e[n]={exports:{}};return s[n](o,o.exports,t),o.exports}var i={};return(()=>{var n=i;Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"AnnotationLayerBuilder",{enumerable:!0,get:function(){return c.AnnotationLayerBuilder}}),Object.defineProperty(n,"DefaultAnnotationLayerFactory",{enumerable:!0,get:function(){return r.DefaultAnnotationLayerFactory}}),Object.defineProperty(n,"DefaultStructTreeLayerFactory",{enumerable:!0,get:function(){return r.DefaultStructTreeLayerFactory}}),Object.defineProperty(n,"DefaultTextLayerFactory",{enumerable:!0,get:function(){return r.DefaultTextLayerFactory}}),Object.defineProperty(n,"DefaultXfaLayerFactory",{enumerable:!0,get:function(){return r.DefaultXfaLayerFactory}}),Object.defineProperty(n,"DownloadManager",{enumerable:!0,get:function(){return d.DownloadManager}}),Object.defineProperty(n,"EventBus",{enumerable:!0,get:function(){return h.EventBus}}),Object.defineProperty(n,"GenericL10n",{enumerable:!0,get:function(){return u.GenericL10n}}),Object.defineProperty(n,"LinkTarget",{enumerable:!0,get:function(){return o.LinkTarget}}),Object.defineProperty(n,"NullL10n",{enumerable:!0,get:function(){return p.NullL10n}}),Object.defineProperty(n,"PDFFindController",{enumerable:!0,get:function(){return f.PDFFindController}}),Object.defineProperty(n,"PDFHistory",{enumerable:!0,get:function(){return m.PDFHistory}}),Object.defineProperty(n,"PDFLinkService",{enumerable:!0,get:function(){return o.PDFLinkService}}),Object.defineProperty(n,"PDFPageView",{enumerable:!0,get:function(){return g.PDFPageView}}),Object.defineProperty(n,"PDFScriptingManager",{enumerable:!0,get:function(){return b.PDFScriptingManager}}),Object.defineProperty(n,"PDFSinglePageViewer",{enumerable:!0,get:function(){return l.PDFSinglePageViewer}}),Object.defineProperty(n,"PDFViewer",{enumerable:!0,get:function(){return l.PDFViewer}}),Object.defineProperty(n,"ProgressBar",{enumerable:!0,get:function(){return a.ProgressBar}}),Object.defineProperty(n,"RenderingStates",{enumerable:!0,get:function(){return a.RenderingStates}}),Object.defineProperty(n,"ScrollMode",{enumerable:!0,get:function(){return a.ScrollMode}}),Object.defineProperty(n,"SimpleLinkService",{enumerable:!0,get:function(){return o.SimpleLinkService}}),Object.defineProperty(n,"SpreadMode",{enumerable:!0,get:function(){return a.SpreadMode}}),Object.defineProperty(n,"StructTreeLayerBuilder",{enumerable:!0,get:function(){return v.StructTreeLayerBuilder}}),Object.defineProperty(n,"TextLayerBuilder",{enumerable:!0,get:function(){return E.TextLayerBuilder}}),Object.defineProperty(n,"XfaLayerBuilder",{enumerable:!0,get:function(){return y.XfaLayerBuilder}}),Object.defineProperty(n,"parseQueryString",{enumerable:!0,get:function(){return a.parseQueryString}});var r=t(1),o=t(6),a=t(7),l=t(11),c=t(5),d=t(18),h=t(19),u=t(20),p=t(4),f=t(22),m=t(24),g=t(13),b=t(25),v=t(8),E=t(9),y=t(10);let w="2.16.105",C="172ccdbe5"})(),i})())});var gl=class{constructor(){this.multiple="shiftKey",this.enabled=!0,this.zoomToSelection=!1,this.config={selectName:"select",hoverName:"hover",selectEnabled:!0,hoverEnabled:!0,autoHighlightOnClick:!0,selectionColor:new zt("#0F5CE9"),hoverColor:new zt("#0F5CE9"),world:null},this.selectOutlinerMaterial=new Ii({color:209786,transparent:!0,opacity:.5})}};var ox=Cs(la());var kE=Cs(la());var gn=(()=>{let e=class e extends mn{constructor(i){super(i),this.enabled=!0,this._expressToUUID={},this._uuidToExpress={},this._modelUUIDToFragmentGroupUUID={},this.events=new kE.EventEmitter}get(){return e.uuid}dispose(){this._expressToUUID={},this._uuidToExpress={},this._modelUUIDToFragmentGroupUUID={},this.events.emit("loadedModels",[])}setModelIdMaps(i,n,r){this._modelUUIDToFragmentGroupUUID[i]=n,this.events.emit("loadedModels",Object.keys(this._modelUUIDToFragmentGroupUUID)),this._expressToUUID[i]=r,Object.keys(r).forEach(o=>{let a=r[parseInt(o)];this._uuidToExpress[a]={modelUUID:i,expressID:parseInt(o)}})}removeIdMap(i){let n=this.modelUUIDFromFragmentGroupID(i);delete this._modelUUIDToFragmentGroupUUID[n],this.events.emit("loadedModels",Object.keys(this._modelUUIDToFragmentGroupUUID)),Object.values(this._expressToUUID[n]).forEach(o=>{delete this._uuidToExpress[o]}),delete this._expressToUUID[n]}modelUUIDFromFragmentID(i){let o=this.components.get(Gi).list.get(i)?.group?.uuid;if(o!==void 0)return this.modelUUIDFromFragmentGroupID(o)}modelUUIDFromFragmentGroupID(i){let n=Object.values(this._modelUUIDToFragmentGroupUUID).indexOf(i);return Object.keys(this._modelUUIDToFragmentGroupUUID)[n]}fragmentGroupUUIDFromModelUUID(i){return this._modelUUIDToFragmentGroupUUID[i]}getFragmentsGroupFromElement(i){let n=this.getModelUUID(i);return this.getFragmentsGroupFromModelUUID(n)}getFragmentsGroupFromModelUUID(i){let n=this.fragmentGroupUUIDFromModelUUID(i);return this.components.get(Gi).groups.get(n)}getElementUUID(i,n){return this._expressToUUID[i][n]}getExpressId(i){return this._uuidToExpress[i]?.expressID}getModelUUID(i){return this._uuidToExpress[i]?.modelUUID}getFragmentIDMap(i){let n={},r=this.getModelExpressIDMap(i);return Object.keys(r).forEach(o=>{let a=r[o],c=this.getFragmentsGroupFromModelUUID(o)?.getFragmentMap(a)??{};n=Se(Se({},n),c)}),n}getModelFragmentIDMap(i){let n=Object.keys(this._expressToUUID[i]).map(o=>parseInt(o)),r=this.getFragmentsGroupFromModelUUID(i);return r===void 0?{}:r.getFragmentMap(n)}getInverseFragmentIDMap(i){let n=this.getModelExpressIDMap(i),r={};return Object.keys(this._modelUUIDToFragmentGroupUUID).forEach(o=>{let a=n[o];this.getFragmentsGroupFromModelUUID(o)?.items.forEach(c=>{let d=new Set(c.ids);a?.forEach(h=>{d.has(h)&&d.delete(h)}),r[c.id]=d})}),r}fragmentsFromElementUUID(i){let n=this._uuidToExpress[i],r=this.getFragmentsGroupFromModelUUID(n.modelUUID);return r===void 0?[]:r.items.filter(o=>o.ids.has(n.expressID))}getFragmentIDs(i){let n=new Set,r=this.getModelExpressIDMap(i);return Object.keys(r).forEach(o=>{let l=this.getFragmentsGroupFromModelUUID(o)?.getFragmentMap(r[o]);l!==void 0&&Object.keys(l).forEach(c=>n.add(c))}),n}getModelExpressIDMap(i){let n={};return i.forEach(r=>{let o=this.getExpressId(r),a=this.getModelUUID(r);n[a]===void 0&&(n[a]=[]),n[a].push(o)}),n}};e.uuid="13e2fcd6-5cfb-47d1-b3a8-f9bb5b65208b";let s=e;return s})();var iM=Object.defineProperty,nM=(s,e,t)=>e in s?iM(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Z=(s,e,t)=>(nM(s,typeof e!="symbol"?e+"":e,t),t),sM=Object.defineProperty,rM=(s,e,t)=>e in s?sM(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,q=(s,e,t)=>(rM(s,typeof e!="symbol"?e+"":e,t),t),N1=0,oM=1,aM=2,NE=2,kg=1.25,UE=1,Ep=6*4+4+4,Yp=65535,lM=Math.pow(2,-24),Ng=Symbol("SKIP_GENERATION");function cM(s){return s.index?s.index.count:s.attributes.position.count}function Vl(s){return cM(s)/3}function hM(s,e=ArrayBuffer){return s>65535?new Uint32Array(new e(4*s)):new Uint16Array(new e(2*s))}function dM(s,e){if(!s.index){let t=s.attributes.position.count,i=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n=hM(t,i);s.setIndex(new Ti(n,1));for(let r=0;r<t;r++)n[r]=r}}function U1(s){let e=Vl(s),t=s.drawRange,i=t.start/3,n=(t.start+t.count)/3,r=Math.max(0,i),o=Math.min(e,n)-r;return[{offset:Math.floor(r),count:Math.floor(o)}]}function B1(s){if(!s.groups||!s.groups.length)return U1(s);let e=[],t=new Set,i=s.drawRange,n=i.start/3,r=(i.start+i.count)/3;for(let a of s.groups){let l=a.start/3,c=(a.start+a.count)/3;t.add(Math.max(n,l)),t.add(Math.min(r,c))}let o=Array.from(t.values()).sort((a,l)=>a-l);for(let a=0;a<o.length-1;a++){let l=o[a],c=o[a+1];e.push({offset:Math.floor(l),count:Math.floor(c-l)})}return e}function uM(s){if(s.groups.length===0)return!1;let e=Vl(s),t=B1(s).sort((r,o)=>r.offset-o.offset),i=t[t.length-1];i.count=Math.min(e-i.offset,i.count);let n=0;return t.forEach(({count:r})=>n+=r),e!==n}function wi(s,e,t){return t.min.x=e[s],t.min.y=e[s+1],t.min.z=e[s+2],t.max.x=e[s+3],t.max.y=e[s+4],t.max.z=e[s+5],t}function pM(s){s[0]=s[1]=s[2]=1/0,s[3]=s[4]=s[5]=-1/0}function BE(s){let e=-1,t=-1/0;for(let i=0;i<3;i++){let n=s[i+3]-s[i];n>t&&(t=n,e=i)}return e}function zE(s,e){e.set(s)}function VE(s,e,t){let i,n;for(let r=0;r<3;r++){let o=r+3;i=s[r],n=e[r],t[r]=i<n?i:n,i=s[o],n=e[o],t[o]=i>n?i:n}}function qu(s,e,t){for(let i=0;i<3;i++){let n=e[s+2*i],r=e[s+2*i+1],o=n-r,a=n+r;o<t[i]&&(t[i]=o),a>t[i+3]&&(t[i+3]=a)}}function dh(s){let e=s[3]-s[0],t=s[4]-s[1],i=s[5]-s[2];return 2*(e*t+t*i+i*e)}function Ug(s,e,t,i,n=null){let r=1/0,o=1/0,a=1/0,l=-1/0,c=-1/0,d=-1/0,h=1/0,u=1/0,p=1/0,f=-1/0,m=-1/0,g=-1/0,b=n!==null;for(let v=e*6,E=(e+t)*6;v<E;v+=6){let y=s[v+0],w=s[v+1],C=y-w,A=y+w;C<r&&(r=C),A>l&&(l=A),b&&y<h&&(h=y),b&&y>f&&(f=y);let D=s[v+2],M=s[v+3],I=D-M,O=D+M;I<o&&(o=I),O>c&&(c=O),b&&D<u&&(u=D),b&&D>m&&(m=D);let F=s[v+4],V=s[v+5],x=F-V,N=F+V;x<a&&(a=x),N>d&&(d=N),b&&F<p&&(p=F),b&&F>g&&(g=F)}i[0]=r,i[1]=o,i[2]=a,i[3]=l,i[4]=c,i[5]=d,b&&(n[0]=h,n[1]=u,n[2]=p,n[3]=f,n[4]=m,n[5]=g)}function fM(s,e,t,i){let n=1/0,r=1/0,o=1/0,a=-1/0,l=-1/0,c=-1/0;for(let d=e*6,h=(e+t)*6;d<h;d+=6){let u=s[d+0];u<n&&(n=u),u>a&&(a=u);let p=s[d+2];p<r&&(r=p),p>l&&(l=p);let f=s[d+4];f<o&&(o=f),f>c&&(c=f)}i[0]=n,i[1]=r,i[2]=o,i[3]=a,i[4]=l,i[5]=c}function mM(s,e){pM(e);let t=s.attributes.position,i=s.index?s.index.array:null,n=Vl(s),r=new Float32Array(n*6),o=t.normalized,a=t.array,l=t.offset||0,c=3;t.isInterleavedBufferAttribute&&(c=t.data.stride);let d=["getX","getY","getZ"];for(let h=0;h<n;h++){let u=h*3,p=h*6,f=u+0,m=u+1,g=u+2;i&&(f=i[f],m=i[m],g=i[g]),o||(f=f*c+l,m=m*c+l,g=g*c+l);for(let b=0;b<3;b++){let v,E,y;o?(v=t[d[b]](f),E=t[d[b]](m),y=t[d[b]](g)):(v=a[f+b],E=a[m+b],y=a[g+b]);let w=v;E<w&&(w=E),y<w&&(w=y);let C=v;E>C&&(C=E),y>C&&(C=y);let A=(C-w)/2,D=b*2;r[p+D+0]=w+A,r[p+D+1]=A+(Math.abs(w)+A)*lM,w<e[b]&&(e[b]=w),C>e[b+3]&&(e[b+3]=C)}}return r}var Cr=32,gM=(s,e)=>s.candidate-e.candidate,ro=new Array(Cr).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Xu=new Float32Array(6);function bM(s,e,t,i,n,r){let o=-1,a=0;if(r===N1)o=BE(e),o!==-1&&(a=(e[o]+e[o+3])/2);else if(r===oM)o=BE(s),o!==-1&&(a=vM(t,i,n,o));else if(r===aM){let l=dh(s),c=kg*n,d=i*6,h=(i+n)*6;for(let u=0;u<3;u++){let p=e[u],f=(e[u+3]-p)/Cr;if(n<Cr/4){let m=[...ro];m.length=n;let g=0;for(let v=d;v<h;v+=6,g++){let E=m[g];E.candidate=t[v+2*u],E.count=0;let{bounds:y,leftCacheBounds:w,rightCacheBounds:C}=E;for(let A=0;A<3;A++)C[A]=1/0,C[A+3]=-1/0,w[A]=1/0,w[A+3]=-1/0,y[A]=1/0,y[A+3]=-1/0;qu(v,t,y)}m.sort(gM);let b=n;for(let v=0;v<b;v++){let E=m[v];for(;v+1<b&&m[v+1].candidate===E.candidate;)m.splice(v+1,1),b--}for(let v=d;v<h;v+=6){let E=t[v+2*u];for(let y=0;y<b;y++){let w=m[y];E>=w.candidate?qu(v,t,w.rightCacheBounds):(qu(v,t,w.leftCacheBounds),w.count++)}}for(let v=0;v<b;v++){let E=m[v],y=E.count,w=n-E.count,C=E.leftCacheBounds,A=E.rightCacheBounds,D=0;y!==0&&(D=dh(C)/l);let M=0;w!==0&&(M=dh(A)/l);let I=UE+kg*(D*y+M*w);I<c&&(o=u,c=I,a=E.candidate)}}else{for(let b=0;b<Cr;b++){let v=ro[b];v.count=0,v.candidate=p+f+b*f;let E=v.bounds;for(let y=0;y<3;y++)E[y]=1/0,E[y+3]=-1/0}for(let b=d;b<h;b+=6){let v=~~((t[b+2*u]-p)/f);v>=Cr&&(v=Cr-1);let E=ro[v];E.count++,qu(b,t,E.bounds)}let m=ro[Cr-1];zE(m.bounds,m.rightCacheBounds);for(let b=Cr-2;b>=0;b--){let v=ro[b],E=ro[b+1];VE(v.bounds,E.rightCacheBounds,v.rightCacheBounds)}let g=0;for(let b=0;b<Cr-1;b++){let v=ro[b],E=v.count,y=v.bounds,w=ro[b+1].rightCacheBounds;E!==0&&(g===0?zE(y,Xu):VE(y,Xu,Xu)),g+=E;let C=0,A=0;g!==0&&(C=dh(Xu)/l);let D=n-g;D!==0&&(A=dh(w)/l);let M=UE+kg*(C*g+A*D);M<c&&(o=u,c=M,a=v.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${r} used.`);return{axis:o,pos:a}}function vM(s,e,t,i){let n=0;for(let r=e,o=e+t;r<o;r++)n+=s[r*6+i*2];return n/t}var Ll=class{constructor(){}};function yM(s,e,t,i,n,r){let o=i,a=i+n-1,l=r.pos,c=r.axis*2;for(;;){for(;o<=a&&t[o*6+c]<l;)o++;for(;o<=a&&t[a*6+c]>=l;)a--;if(o<a){for(let d=0;d<3;d++){let h=e[o*3+d];e[o*3+d]=e[a*3+d],e[a*3+d]=h}for(let d=0;d<6;d++){let h=t[o*6+d];t[o*6+d]=t[a*6+d],t[a*6+d]=h}o++,a--}else return o}}function _M(s,e,t,i,n,r){let o=i,a=i+n-1,l=r.pos,c=r.axis*2;for(;;){for(;o<=a&&t[o*6+c]<l;)o++;for(;o<=a&&t[a*6+c]>=l;)a--;if(o<a){let d=s[o];s[o]=s[a],s[a]=d;for(let h=0;h<6;h++){let u=t[o*6+h];t[o*6+h]=t[a*6+h],t[a*6+h]=u}o++,a--}else return o}}function wM(s,e){let t=(s.index?s.index.count:s.attributes.position.count)/3,i=t>2**16,n=i?4:2,r=e?new SharedArrayBuffer(t*n):new ArrayBuffer(t*n),o=i?new Uint32Array(r):new Uint16Array(r);for(let a=0,l=o.length;a<l;a++)o[a]=a;return o}function EM(s,e){let t=s.geometry,i=t.index?t.index.array:null,n=e.maxDepth,r=e.verbose,o=e.maxLeafTris,a=e.strategy,l=e.onProgress,c=Vl(t),d=s._indirectBuffer,h=!1,u=new Float32Array(6),p=new Float32Array(6),f=mM(t,u),m=e.indirect?_M:yM,g=[],b=e.indirect?U1(t):B1(t);if(b.length===1){let y=b[0],w=new Ll;w.boundingData=u,fM(f,y.offset,y.count,p),E(w,y.offset,y.count,p),g.push(w)}else for(let y of b){let w=new Ll;w.boundingData=new Float32Array(6),Ug(f,y.offset,y.count,w.boundingData,p),E(w,y.offset,y.count,p),g.push(w)}return g;function v(y){l&&l(y/c)}function E(y,w,C,A=null,D=0){if(!h&&D>=n&&(h=!0,r&&(console.warn(`MeshBVH: Max depth of ${n} reached when generating BVH. Consider increasing maxDepth.`),console.warn(t))),C<=o||D>=n)return v(w+C),y.offset=w,y.count=C,y;let M=bM(y.boundingData,A,f,w,C,a);if(M.axis===-1)return v(w+C),y.offset=w,y.count=C,y;let I=m(d,i,f,w,C,M);if(I===w||I===w+C)v(w+C),y.offset=w,y.count=C;else{y.splitAxis=M.axis;let O=new Ll,F=w,V=I-w;y.left=O,O.boundingData=new Float32Array(6),Ug(f,F,V,O.boundingData,p),E(O,F,V,p,D+1);let x=new Ll,N=I,z=C-V;y.right=x,x.boundingData=new Float32Array(6),Ug(f,N,z,x.boundingData,p),E(x,N,z,p,D+1)}return y}}function CM(s,e){let t=s.geometry;e.indirect&&(s._indirectBuffer=wM(t,e.useSharedArrayBuffer),uM(t)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),s._indirectBuffer||dM(t,e);let i=EM(s,e),n,r,o,a=[],l=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let h=0;h<i.length;h++){let u=i[h],p=c(u),f=new l(Ep*p);n=new Float32Array(f),r=new Uint32Array(f),o=new Uint16Array(f),d(0,u),a.push(f)}s._roots=a;return;function c(h){return h.count?1:1+c(h.left)+c(h.right)}function d(h,u){let p=h/4,f=h/2,m=!!u.count,g=u.boundingData;for(let b=0;b<6;b++)n[p+b]=g[b];if(m){let b=u.offset,v=u.count;return r[p+6]=b,o[f+14]=v,o[f+15]=Yp,h+Ep}else{let b=u.left,v=u.right,E=u.splitAxis,y;if(y=d(h+Ep,b),y/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return r[p+6]=y/4,y=d(y,v),r[p+7]=E,y}}}var Rs=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let i=1/0,n=-1/0;for(let r=0,o=e.length;r<o;r++){let a=e[r][t];i=a<i?a:i,n=a>n?a:n}this.min=i,this.max=n}setFromPoints(e,t){let i=1/0,n=-1/0;for(let r=0,o=t.length;r<o;r++){let a=t[r],l=e.dot(a);i=l<i?l:i,n=l>n?l:n}this.min=i,this.max=n}isSeparated(e){return this.min>e.max||e.min>this.max}};Rs.prototype.setFromBox=function(){let s=new ce;return function(e,t){let i=t.min,n=t.max,r=1/0,o=-1/0;for(let a=0;a<=1;a++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){s.x=i.x*a+n.x*(1-a),s.y=i.y*l+n.y*(1-l),s.z=i.z*c+n.z*(1-c);let d=e.dot(s);r=Math.min(d,r),o=Math.max(d,o)}this.min=r,this.max=o}}();var xM=function(){let s=new ce,e=new ce,t=new ce;return function(i,n,r){let o=i.start,a=s,l=n.start,c=e;t.subVectors(o,l),s.subVectors(i.end,i.start),e.subVectors(n.end,n.start);let d=t.dot(c),h=c.dot(a),u=c.dot(c),p=t.dot(a),f=a.dot(a)*u-h*h,m,g;f!==0?m=(d*h-p*u)/f:m=0,g=(d+m*h)/u,r.x=m,r.y=g}}(),Tb=function(){let s=new Bt,e=new ce,t=new ce;return function(i,n,r,o){xM(i,n,s);let a=s.x,l=s.y;if(a>=0&&a<=1&&l>=0&&l<=1){i.at(a,r),n.at(l,o);return}else if(a>=0&&a<=1){l<0?n.at(0,o):n.at(1,o),i.closestPointToPoint(o,!0,r);return}else if(l>=0&&l<=1){a<0?i.at(0,r):i.at(1,r),n.closestPointToPoint(r,!0,o);return}else{let c;a<0?c=i.start:c=i.end;let d;l<0?d=n.start:d=n.end;let h=e,u=t;if(i.closestPointToPoint(d,!0,e),n.closestPointToPoint(c,!0,t),h.distanceToSquared(d)<=u.distanceToSquared(c)){r.copy(h),o.copy(d);return}else{r.copy(c),o.copy(u);return}}}}(),SM=function(){let s=new ce,e=new ce,t=new Ws,i=new en;return function(n,r){let{radius:o,center:a}=n,{a:l,b:c,c:d}=r;if(i.start=l,i.end=c,i.closestPointToPoint(a,!0,s).distanceTo(a)<=o||(i.start=l,i.end=d,i.closestPointToPoint(a,!0,s).distanceTo(a)<=o)||(i.start=c,i.end=d,i.closestPointToPoint(a,!0,s).distanceTo(a)<=o))return!0;let h=r.getPlane(t);if(Math.abs(h.distanceToPoint(a))<=o){let u=h.projectPoint(a,e);if(r.containsPoint(u))return!0}return!1}}(),AM=1e-15;function Bg(s){return Math.abs(s)<AM}var zn=class extends wr{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new ce),this.satBounds=new Array(4).fill().map(()=>new Rs),this.points=[this.a,this.b,this.c],this.sphere=new Qn,this.plane=new Ws,this.needsUpdate=!0}intersectsSphere(e){return SM(e,this)}update(){let e=this.a,t=this.b,i=this.c,n=this.points,r=this.satAxes,o=this.satBounds,a=r[0],l=o[0];this.getNormal(a),l.setFromPoints(a,n);let c=r[1],d=o[1];c.subVectors(e,t),d.setFromPoints(c,n);let h=r[2],u=o[2];h.subVectors(t,i),u.setFromPoints(h,n);let p=r[3],f=o[3];p.subVectors(i,e),f.setFromPoints(p,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}};zn.prototype.closestPointToSegment=function(){let s=new ce,e=new ce,t=new en;return function(i,n=null,r=null){let{start:o,end:a}=i,l=this.points,c,d=1/0;for(let h=0;h<3;h++){let u=(h+1)%3;t.start.copy(l[h]),t.end.copy(l[u]),Tb(t,i,s,e),c=s.distanceToSquared(e),c<d&&(d=c,n&&n.copy(s),r&&r.copy(e))}return this.closestPointToPoint(o,s),c=o.distanceToSquared(s),c<d&&(d=c,n&&n.copy(s),r&&r.copy(o)),this.closestPointToPoint(a,s),c=a.distanceToSquared(s),c<d&&(d=c,n&&n.copy(s),r&&r.copy(a)),Math.sqrt(d)}}();zn.prototype.intersectsTriangle=function(){let s=new zn,e=new Array(3),t=new Array(3),i=new Rs,n=new Rs,r=new ce,o=new ce,a=new ce,l=new ce,c=new ce,d=new en,h=new en,u=new en,p=new ce;function f(m,g,b){let v=m.points,E=0,y=-1;for(let w=0;w<3;w++){let{start:C,end:A}=d;C.copy(v[w]),A.copy(v[(w+1)%3]),d.delta(o);let D=Bg(g.distanceToPoint(C));if(Bg(g.normal.dot(o))&&D){b.copy(d),E=2;break}let M=g.intersectLine(d,p);if(!M&&D&&p.copy(C),(M||D)&&!Bg(p.distanceTo(A))){if(E<=1)(E===1?b.start:b.end).copy(p),D&&(y=E);else if(E>=2){(y===1?b.start:b.end).copy(p),E=2;break}if(E++,E===2&&y===-1)break}}return E}return function(m,g=null,b=!1){this.needsUpdate&&this.update(),m.isExtendedTriangle?m.needsUpdate&&m.update():(s.copy(m),s.update(),m=s);let v=this.plane,E=m.plane;if(Math.abs(v.normal.dot(E.normal))>1-1e-10){let y=this.satBounds,w=this.satAxes;t[0]=m.a,t[1]=m.b,t[2]=m.c;for(let D=0;D<4;D++){let M=y[D],I=w[D];if(i.setFromPoints(I,t),M.isSeparated(i))return!1}let C=m.satBounds,A=m.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let D=0;D<4;D++){let M=C[D],I=A[D];if(i.setFromPoints(I,e),M.isSeparated(i))return!1}for(let D=0;D<4;D++){let M=w[D];for(let I=0;I<4;I++){let O=A[I];if(r.crossVectors(M,O),i.setFromPoints(r,e),n.setFromPoints(r,t),i.isSeparated(n))return!1}}return g&&(b||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),g.start.set(0,0,0),g.end.set(0,0,0)),!0}else{let y=f(this,E,h);if(y===1&&m.containsPoint(h.end))return g&&(g.start.copy(h.end),g.end.copy(h.end)),!0;if(y!==2)return!1;let w=f(m,v,u);if(w===1&&this.containsPoint(u.end))return g&&(g.start.copy(u.end),g.end.copy(u.end)),!0;if(w!==2)return!1;if(h.delta(a),u.delta(l),a.dot(l)<0){let F=u.start;u.start=u.end,u.end=F}let C=h.start.dot(a),A=h.end.dot(a),D=u.start.dot(a),M=u.end.dot(a),I=A<D,O=C<M;return C!==M&&D!==A&&I===O?!1:(g&&(c.subVectors(h.start,u.start),c.dot(a)>0?g.start.copy(h.start):g.start.copy(u.start),c.subVectors(h.end,u.end),c.dot(a)<0?g.end.copy(h.end):g.end.copy(u.end)),!0)}}}();zn.prototype.distanceToPoint=function(){let s=new ce;return function(e){return this.closestPointToPoint(e,s),e.distanceTo(s)}}();zn.prototype.distanceToTriangle=function(){let s=new ce,e=new ce,t=["a","b","c"],i=new en,n=new en;return function(r,o=null,a=null){let l=o||a?i:null;if(this.intersectsTriangle(r,l))return(o||a)&&(o&&l.getCenter(o),a&&l.getCenter(a)),0;let c=1/0;for(let d=0;d<3;d++){let h,u=t[d],p=r[u];this.closestPointToPoint(p,s),h=p.distanceToSquared(s),h<c&&(c=h,o&&o.copy(s),a&&a.copy(p));let f=this[u];r.closestPointToPoint(f,s),h=f.distanceToSquared(s),h<c&&(c=h,o&&o.copy(f),a&&a.copy(s))}for(let d=0;d<3;d++){let h=t[d],u=t[(d+1)%3];i.set(this[h],this[u]);for(let p=0;p<3;p++){let f=t[p],m=t[(p+1)%3];n.set(r[f],r[m]),Tb(i,n,s,e);let g=s.distanceToSquared(e);g<c&&(c=g,o&&o.copy(s),a&&a.copy(e))}}return Math.sqrt(c)}}();var rn=class{constructor(e,t,i){this.isOrientedBox=!0,this.min=new ce,this.max=new ce,this.matrix=new lt,this.invMatrix=new lt,this.points=new Array(8).fill().map(()=>new ce),this.satAxes=new Array(3).fill().map(()=>new ce),this.satBounds=new Array(3).fill().map(()=>new Rs),this.alignedSatBounds=new Array(3).fill().map(()=>new Rs),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),i&&this.matrix.copy(i)}set(e,t,i){this.min.copy(e),this.max.copy(t),this.matrix.copy(i),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}};rn.prototype.update=function(){return function(){let s=this.matrix,e=this.min,t=this.max,i=this.points;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let d=0;d<=1;d++){let h=1*l|2*c|4*d,u=i[h];u.x=l?t.x:e.x,u.y=c?t.y:e.y,u.z=d?t.z:e.z,u.applyMatrix4(s)}let n=this.satBounds,r=this.satAxes,o=i[0];for(let l=0;l<3;l++){let c=r[l],d=n[l],h=1<<l,u=i[h];c.subVectors(o,u),d.setFromPoints(c,i)}let a=this.alignedSatBounds;a[0].setFromPointsField(i,"x"),a[1].setFromPointsField(i,"y"),a[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();rn.prototype.intersectsBox=function(){let s=new Rs;return function(e){this.needsUpdate&&this.update();let t=e.min,i=e.max,n=this.satBounds,r=this.satAxes,o=this.alignedSatBounds;if(s.min=t.x,s.max=i.x,o[0].isSeparated(s)||(s.min=t.y,s.max=i.y,o[1].isSeparated(s))||(s.min=t.z,s.max=i.z,o[2].isSeparated(s)))return!1;for(let a=0;a<3;a++){let l=r[a],c=n[a];if(s.setFromBox(l,e),c.isSeparated(s))return!1}return!0}}();rn.prototype.intersectsTriangle=function(){let s=new zn,e=new Array(3),t=new Rs,i=new Rs,n=new ce;return function(r){this.needsUpdate&&this.update(),r.isExtendedTriangle?r.needsUpdate&&r.update():(s.copy(r),s.update(),r=s);let o=this.satBounds,a=this.satAxes;e[0]=r.a,e[1]=r.b,e[2]=r.c;for(let h=0;h<3;h++){let u=o[h],p=a[h];if(t.setFromPoints(p,e),u.isSeparated(t))return!1}let l=r.satBounds,c=r.satAxes,d=this.points;for(let h=0;h<3;h++){let u=l[h],p=c[h];if(t.setFromPoints(p,d),u.isSeparated(t))return!1}for(let h=0;h<3;h++){let u=a[h];for(let p=0;p<4;p++){let f=c[p];if(n.crossVectors(u,f),t.setFromPoints(n,e),i.setFromPoints(n,d),t.isSeparated(i))return!1}}return!0}}();rn.prototype.closestPointToPoint=function(){return function(s,e){return this.needsUpdate&&this.update(),e.copy(s).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}();rn.prototype.distanceToPoint=function(){let s=new ce;return function(e){return this.closestPointToPoint(e,s),e.distanceTo(s)}}();rn.prototype.distanceToBox=function(){let s=["x","y","z"],e=new Array(12).fill().map(()=>new en),t=new Array(12).fill().map(()=>new en),i=new ce,n=new ce;return function(r,o=0,a=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(r))return(a||l)&&(r.getCenter(n),this.closestPointToPoint(n,i),r.closestPointToPoint(i,n),a&&a.copy(i),l&&l.copy(n)),0;let c=o*o,d=r.min,h=r.max,u=this.points,p=1/0;for(let m=0;m<8;m++){let g=u[m];n.copy(g).clamp(d,h);let b=g.distanceToSquared(n);if(b<p&&(p=b,a&&a.copy(g),l&&l.copy(n),b<c))return Math.sqrt(b)}let f=0;for(let m=0;m<3;m++)for(let g=0;g<=1;g++)for(let b=0;b<=1;b++){let v=(m+1)%3,E=(m+2)%3,y=g<<v|b<<E,w=1<<m|g<<v|b<<E,C=u[y],A=u[w];e[f].set(C,A);let D=s[m],M=s[v],I=s[E],O=t[f],F=O.start,V=O.end;F[D]=d[D],F[M]=g?d[M]:h[M],F[I]=b?d[I]:h[M],V[D]=h[D],V[M]=g?d[M]:h[M],V[I]=b?d[I]:h[M],f++}for(let m=0;m<=1;m++)for(let g=0;g<=1;g++)for(let b=0;b<=1;b++){n.x=m?h.x:d.x,n.y=g?h.y:d.y,n.z=b?h.z:d.z,this.closestPointToPoint(n,i);let v=n.distanceToSquared(i);if(v<p&&(p=v,a&&a.copy(i),l&&l.copy(n),v<c))return Math.sqrt(v)}for(let m=0;m<12;m++){let g=e[m];for(let b=0;b<12;b++){let v=t[b];Tb(g,v,i,n);let E=i.distanceToSquared(n);if(E<p&&(p=E,a&&a.copy(i),l&&l.copy(n),E<c))return Math.sqrt(E)}}return Math.sqrt(p)}}();var Mh=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}},s0=class extends Mh{constructor(){super(()=>new zn)}},ts=new s0;function Un(s,e){return e[s+15]===65535}function Bn(s,e){return e[s+6]}function is(s,e){return e[s+14]}function ns(s){return s+8}function ss(s,e){return e[s+6]}function z1(s,e){return e[s+7]}var r0=class{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;let e=[],t=null;this.setBuffer=i=>{t&&e.push(t),t=i,this.float32Array=new Float32Array(i),this.uint16Array=new Uint16Array(i),this.uint32Array=new Uint32Array(i)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}},ui=new r0,ho,Fl,bl=[],Ku=new Mh(()=>new Qt);function IM(s,e,t,i,n,r){ho=Ku.getPrimitive(),Fl=Ku.getPrimitive(),bl.push(ho,Fl),ui.setBuffer(s._roots[e]);let o=o0(0,s.geometry,t,i,n,r);ui.clearBuffer(),Ku.releasePrimitive(ho),Ku.releasePrimitive(Fl),bl.pop(),bl.pop();let a=bl.length;return a>0&&(Fl=bl[a-1],ho=bl[a-2]),o}function o0(s,e,t,i,n=null,r=0,o=0){let{float32Array:a,uint16Array:l,uint32Array:c}=ui,d=s*2;if(Un(d,l)){let h=Bn(s,c),u=is(d,l);return wi(s,a,ho),i(h,u,!1,o,r+s,ho)}else{let h=function(O){let{uint16Array:F,uint32Array:V}=ui,x=O*2;for(;!Un(x,F);)O=ns(O),x=O*2;return Bn(O,V)},u=function(O){let{uint16Array:F,uint32Array:V}=ui,x=O*2;for(;!Un(x,F);)O=ss(O,V),x=O*2;return Bn(O,V)+is(x,F)},p=ns(s),f=ss(s,c),m=p,g=f,b,v,E,y;if(n&&(E=ho,y=Fl,wi(m,a,E),wi(g,a,y),b=n(E),v=n(y),v<b)){m=f,g=p;let O=b;b=v,v=O,E=y}E||(E=ho,wi(m,a,E));let w=Un(m*2,l),C=t(E,w,b,o+1,r+m),A;if(C===NE){let O=h(m),F=u(m)-O;A=i(O,F,!0,o+1,r+m,E)}else A=C&&o0(m,e,t,i,n,r,o+1);if(A)return!0;y=Fl,wi(g,a,y);let D=Un(g*2,l),M=t(y,D,v,o+1,r+g),I;if(M===NE){let O=h(g),F=u(g)-O;I=i(O,F,!0,o+1,r+g,y)}else I=M&&o0(g,e,t,i,n,r,o+1);return!!I}}var uh=new ce,zg=new ce;function TM(s,e,t={},i=0,n=1/0){let r=i*i,o=n*n,a=1/0,l=null;if(s.shapecast({boundsTraverseOrder:d=>(uh.copy(e).clamp(d.min,d.max),uh.distanceToSquared(e)),intersectsBounds:(d,h,u)=>u<a&&u<o,intersectsTriangle:(d,h)=>{d.closestPointToPoint(e,uh);let u=e.distanceToSquared(uh);return u<a&&(zg.copy(uh),a=u,l=h),u<r}}),a===1/0)return null;let c=Math.sqrt(a);return t.point?t.point.copy(zg):t.point=zg.clone(),t.distance=c,t.faceIndex=l,t}var vl=new ce,yl=new ce,_l=new ce,$u=new Bt,Zu=new Bt,Qu=new Bt,jE=new ce,HE=new ce,GE=new ce,Ju=new ce;function PM(s,e,t,i,n,r){let o;return r===Dw?o=s.intersectTriangle(i,t,e,!0,n):o=s.intersectTriangle(e,t,i,r!==ea,n),o===null?null:{distance:s.origin.distanceTo(n),point:n.clone()}}function OM(s,e,t,i,n,r,o,a,l){vl.fromBufferAttribute(e,r),yl.fromBufferAttribute(e,o),_l.fromBufferAttribute(e,a);let c=PM(s,vl,yl,_l,Ju,l);if(c){i&&($u.fromBufferAttribute(i,r),Zu.fromBufferAttribute(i,o),Qu.fromBufferAttribute(i,a),c.uv=wr.getInterpolation(Ju,vl,yl,_l,$u,Zu,Qu,new Bt)),n&&($u.fromBufferAttribute(n,r),Zu.fromBufferAttribute(n,o),Qu.fromBufferAttribute(n,a),c.uv1=wr.getInterpolation(Ju,vl,yl,_l,$u,Zu,Qu,new Bt)),t&&(jE.fromBufferAttribute(t,r),HE.fromBufferAttribute(t,o),GE.fromBufferAttribute(t,a),c.normal=wr.getInterpolation(Ju,vl,yl,_l,jE,HE,GE,new ce),c.normal.dot(s.direction)>0&&c.normal.multiplyScalar(-1));let d={a:r,b:o,c:a,normal:new ce,materialIndex:0};wr.getNormal(vl,yl,_l,d.normal),c.face=d,c.faceIndex=r}return c}function qp(s,e,t,i,n){let r=i*3,o=r+0,a=r+1,l=r+2,c=s.index;s.index&&(o=c.getX(o),a=c.getX(a),l=c.getX(l));let{position:d,normal:h,uv:u,uv1:p}=s.attributes,f=OM(t,d,h,u,p,o,a,l,e);return f?(f.faceIndex=i,n&&n.push(f),f):null}function Ui(s,e,t,i){let n=s.a,r=s.b,o=s.c,a=e,l=e+1,c=e+2;t&&(a=t.getX(a),l=t.getX(l),c=t.getX(c)),n.x=i.getX(a),n.y=i.getY(a),n.z=i.getZ(a),r.x=i.getX(l),r.y=i.getY(l),r.z=i.getZ(l),o.x=i.getX(c),o.y=i.getY(c),o.z=i.getZ(c)}function MM(s,e,t,i,n,r){let{geometry:o,_indirectBuffer:a}=s;for(let l=i,c=i+n;l<c;l++)qp(o,e,t,l,r)}function RM(s,e,t,i,n){let{geometry:r,_indirectBuffer:o}=s,a=1/0,l=null;for(let c=i,d=i+n;c<d;c++){let h;h=qp(r,e,t,c),h&&h.distance<a&&(l=h,a=h.distance)}return l}function DM(s,e,t,i,n,r,o){let{geometry:a}=t,{index:l}=a,c=a.attributes.position;for(let d=s,h=e+s;d<h;d++){let u;if(u=d,Ui(o,u*3,l,c),o.needsUpdate=!0,i(o,u,n,r))return!0}return!1}function LM(s,e=null){e&&Array.isArray(e)&&(e=new Set(e));let t=s.geometry,i=t.index?t.index.array:null,n=t.attributes.position,r,o,a,l,c=0,d=s._roots;for(let u=0,p=d.length;u<p;u++)r=d[u],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),h(0,c),c+=r.byteLength;function h(u,p,f=!1){let m=u*2;if(a[m+15]===Yp){let g=o[u+6],b=a[m+14],v=1/0,E=1/0,y=1/0,w=-1/0,C=-1/0,A=-1/0;for(let D=3*g,M=3*(g+b);D<M;D++){let I=i[D],O=n.getX(I),F=n.getY(I),V=n.getZ(I);O<v&&(v=O),O>w&&(w=O),F<E&&(E=F),F>C&&(C=F),V<y&&(y=V),V>A&&(A=V)}return l[u+0]!==v||l[u+1]!==E||l[u+2]!==y||l[u+3]!==w||l[u+4]!==C||l[u+5]!==A?(l[u+0]=v,l[u+1]=E,l[u+2]=y,l[u+3]=w,l[u+4]=C,l[u+5]=A,!0):!1}else{let g=u+8,b=o[u+6],v=g+p,E=b+p,y=f,w=!1,C=!1;e?y||(w=e.has(v),C=e.has(E),y=!w&&!C):(w=!0,C=!0);let A=y||w,D=y||C,M=!1;A&&(M=h(g,p,y));let I=!1;D&&(I=h(b,p,y));let O=M||I;if(O)for(let F=0;F<3;F++){let V=g+F,x=b+F,N=l[V],z=l[V+3],G=l[x],X=l[x+3];l[u+F]=N<G?N:G,l[u+F+3]=z>X?z:X}return O}}}var WE=new Qt;function po(s,e,t,i){return wi(s,e,WE),t.intersectBox(WE,i)}function FM(s,e,t,i,n,r){let{geometry:o,_indirectBuffer:a}=s;for(let l=i,c=i+n;l<c;l++){let d=a?a[l]:l;qp(o,e,t,d,r)}}function kM(s,e,t,i,n){let{geometry:r,_indirectBuffer:o}=s,a=1/0,l=null;for(let c=i,d=i+n;c<d;c++){let h;h=qp(r,e,t,o?o[c]:c),h&&h.distance<a&&(l=h,a=h.distance)}return l}function NM(s,e,t,i,n,r,o){let{geometry:a}=t,{index:l}=a,c=a.attributes.position;for(let d=s,h=e+s;d<h;d++){let u;if(u=t.resolveTriangleIndex(d),Ui(o,u*3,l,c),o.needsUpdate=!0,i(o,u,n,r))return!0}return!1}var YE=new ce;function UM(s,e,t,i,n){ui.setBuffer(s._roots[e]),a0(0,s,t,i,n),ui.clearBuffer()}function a0(s,e,t,i,n){let{float32Array:r,uint16Array:o,uint32Array:a}=ui,l=s*2;if(Un(l,o)){let c=Bn(s,a),d=is(l,o);MM(e,t,i,c,d,n)}else{let c=ns(s);po(c,r,i,YE)&&a0(c,e,t,i,n);let d=ss(s,a);po(d,r,i,YE)&&a0(d,e,t,i,n)}}var qE=new ce,BM=["x","y","z"];function zM(s,e,t,i){ui.setBuffer(s._roots[e]);let n=l0(0,s,t,i);return ui.clearBuffer(),n}function l0(s,e,t,i){let{float32Array:n,uint16Array:r,uint32Array:o}=ui,a=s*2;if(Un(a,r)){let l=Bn(s,o),c=is(a,r);return RM(e,t,i,l,c)}else{let l=z1(s,o),c=BM[l],d=i.direction[c]>=0,h,u;d?(h=ns(s),u=ss(s,o)):(h=ss(s,o),u=ns(s));let p=po(h,n,i,qE)?l0(h,e,t,i):null;if(p){let m=p.point[c];if(d?m<=n[u+l]:m>=n[u+l+3])return p}let f=po(u,n,i,qE)?l0(u,e,t,i):null;return p&&f?p.distance<=f.distance?p:f:p||f||null}}var ep=new Qt,wl=new zn,El=new zn,ph=new lt,XE=new rn,tp=new rn;function VM(s,e,t,i){ui.setBuffer(s._roots[e]);let n=c0(0,s,t,i);return ui.clearBuffer(),n}function c0(s,e,t,i,n=null){let{float32Array:r,uint16Array:o,uint32Array:a}=ui,l=s*2;if(n===null&&(t.boundingBox||t.computeBoundingBox(),XE.set(t.boundingBox.min,t.boundingBox.max,i),n=XE),Un(l,o)){let c=e.geometry,d=c.index,h=c.attributes.position,u=t.index,p=t.attributes.position,f=Bn(s,a),m=is(l,o);if(ph.copy(i).invert(),t.boundsTree)return wi(s,r,tp),tp.matrix.copy(ph),tp.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:g=>tp.intersectsBox(g),intersectsTriangle:g=>{g.a.applyMatrix4(i),g.b.applyMatrix4(i),g.c.applyMatrix4(i),g.needsUpdate=!0;for(let b=f*3,v=(m+f)*3;b<v;b+=3)if(Ui(El,b,d,h),El.needsUpdate=!0,g.intersectsTriangle(El))return!0;return!1}});for(let g=f*3,b=(m+f)*3;g<b;g+=3){Ui(wl,g,d,h),wl.a.applyMatrix4(ph),wl.b.applyMatrix4(ph),wl.c.applyMatrix4(ph),wl.needsUpdate=!0;for(let v=0,E=u.count;v<E;v+=3)if(Ui(El,v,u,p),El.needsUpdate=!0,wl.intersectsTriangle(El))return!0}}else{let c=s+8,d=a[s+6];return wi(c,r,ep),!!(n.intersectsBox(ep)&&c0(c,e,t,i,n)||(wi(d,r,ep),n.intersectsBox(ep)&&c0(d,e,t,i,n)))}}var ip=new lt,Vg=new rn,fh=new rn,jM=new ce,HM=new ce,GM=new ce,WM=new ce;function YM(s,e,t,i={},n={},r=0,o=1/0){e.boundingBox||e.computeBoundingBox(),Vg.set(e.boundingBox.min,e.boundingBox.max,t),Vg.needsUpdate=!0;let a=s.geometry,l=a.attributes.position,c=a.index,d=e.attributes.position,h=e.index,u=ts.getPrimitive(),p=ts.getPrimitive(),f=jM,m=HM,g=null,b=null;n&&(g=GM,b=WM);let v=1/0,E=null,y=null;return ip.copy(t).invert(),fh.matrix.copy(ip),s.shapecast({boundsTraverseOrder:w=>Vg.distanceToBox(w),intersectsBounds:(w,C,A)=>A<v&&A<o?(C&&(fh.min.copy(w.min),fh.max.copy(w.max),fh.needsUpdate=!0),!0):!1,intersectsRange:(w,C)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:A=>fh.distanceToBox(A),intersectsBounds:(A,D,M)=>M<v&&M<o,intersectsRange:(A,D)=>{for(let M=A,I=A+D;M<I;M++){Ui(p,3*M,h,d),p.a.applyMatrix4(t),p.b.applyMatrix4(t),p.c.applyMatrix4(t),p.needsUpdate=!0;for(let O=w,F=w+C;O<F;O++){Ui(u,3*O,c,l),u.needsUpdate=!0;let V=u.distanceToTriangle(p,f,g);if(V<v&&(m.copy(f),b&&b.copy(g),v=V,E=O,y=M),V<r)return!0}}}});{let A=Vl(e);for(let D=0,M=A;D<M;D++){Ui(p,3*D,h,d),p.a.applyMatrix4(t),p.b.applyMatrix4(t),p.c.applyMatrix4(t),p.needsUpdate=!0;for(let I=w,O=w+C;I<O;I++){Ui(u,3*I,c,l),u.needsUpdate=!0;let F=u.distanceToTriangle(p,f,g);if(F<v&&(m.copy(f),b&&b.copy(g),v=F,E=I,y=D),F<r)return!0}}}}}),ts.releasePrimitive(u),ts.releasePrimitive(p),v===1/0?null:(i.point?i.point.copy(m):i.point=m.clone(),i.distance=v,i.faceIndex=E,n&&(n.point?n.point.copy(b):n.point=b.clone(),n.point.applyMatrix4(ip),m.applyMatrix4(ip),n.distance=m.sub(n.point).length(),n.faceIndex=y),i)}function qM(s,e=null){e&&Array.isArray(e)&&(e=new Set(e));let t=s.geometry,i=t.index?t.index.array:null,n=t.attributes.position,r,o,a,l,c=0,d=s._roots;for(let u=0,p=d.length;u<p;u++)r=d[u],o=new Uint32Array(r),a=new Uint16Array(r),l=new Float32Array(r),h(0,c),c+=r.byteLength;function h(u,p,f=!1){let m=u*2;if(a[m+15]===Yp){let g=o[u+6],b=a[m+14],v=1/0,E=1/0,y=1/0,w=-1/0,C=-1/0,A=-1/0;for(let D=g,M=g+b;D<M;D++){let I=3*s.resolveTriangleIndex(D);for(let O=0;O<3;O++){let F=I+O;F=i?i[F]:F;let V=n.getX(F),x=n.getY(F),N=n.getZ(F);V<v&&(v=V),V>w&&(w=V),x<E&&(E=x),x>C&&(C=x),N<y&&(y=N),N>A&&(A=N)}}return l[u+0]!==v||l[u+1]!==E||l[u+2]!==y||l[u+3]!==w||l[u+4]!==C||l[u+5]!==A?(l[u+0]=v,l[u+1]=E,l[u+2]=y,l[u+3]=w,l[u+4]=C,l[u+5]=A,!0):!1}else{let g=u+8,b=o[u+6],v=g+p,E=b+p,y=f,w=!1,C=!1;e?y||(w=e.has(v),C=e.has(E),y=!w&&!C):(w=!0,C=!0);let A=y||w,D=y||C,M=!1;A&&(M=h(g,p,y));let I=!1;D&&(I=h(b,p,y));let O=M||I;if(O)for(let F=0;F<3;F++){let V=g+F,x=b+F,N=l[V],z=l[V+3],G=l[x],X=l[x+3];l[u+F]=N<G?N:G,l[u+F+3]=z>X?z:X}return O}}}var KE=new ce;function XM(s,e,t,i,n){ui.setBuffer(s._roots[e]),h0(0,s,t,i,n),ui.clearBuffer()}function h0(s,e,t,i,n){let{float32Array:r,uint16Array:o,uint32Array:a}=ui,l=s*2;if(Un(l,o)){let c=Bn(s,a),d=is(l,o);FM(e,t,i,c,d,n)}else{let c=ns(s);po(c,r,i,KE)&&h0(c,e,t,i,n);let d=ss(s,a);po(d,r,i,KE)&&h0(d,e,t,i,n)}}var $E=new ce,KM=["x","y","z"];function $M(s,e,t,i){ui.setBuffer(s._roots[e]);let n=d0(0,s,t,i);return ui.clearBuffer(),n}function d0(s,e,t,i){let{float32Array:n,uint16Array:r,uint32Array:o}=ui,a=s*2;if(Un(a,r)){let l=Bn(s,o),c=is(a,r);return kM(e,t,i,l,c)}else{let l=z1(s,o),c=KM[l],d=i.direction[c]>=0,h,u;d?(h=ns(s),u=ss(s,o)):(h=ss(s,o),u=ns(s));let p=po(h,n,i,$E)?d0(h,e,t,i):null;if(p){let m=p.point[c];if(d?m<=n[u+l]:m>=n[u+l+3])return p}let f=po(u,n,i,$E)?d0(u,e,t,i):null;return p&&f?p.distance<=f.distance?p:f:p||f||null}}var np=new Qt,Cl=new zn,xl=new zn,mh=new lt,ZE=new rn,sp=new rn;function ZM(s,e,t,i){ui.setBuffer(s._roots[e]);let n=u0(0,s,t,i);return ui.clearBuffer(),n}function u0(s,e,t,i,n=null){let{float32Array:r,uint16Array:o,uint32Array:a}=ui,l=s*2;if(n===null&&(t.boundingBox||t.computeBoundingBox(),ZE.set(t.boundingBox.min,t.boundingBox.max,i),n=ZE),Un(l,o)){let c=e.geometry,d=c.index,h=c.attributes.position,u=t.index,p=t.attributes.position,f=Bn(s,a),m=is(l,o);if(mh.copy(i).invert(),t.boundsTree)return wi(s,r,sp),sp.matrix.copy(mh),sp.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:g=>sp.intersectsBox(g),intersectsTriangle:g=>{g.a.applyMatrix4(i),g.b.applyMatrix4(i),g.c.applyMatrix4(i),g.needsUpdate=!0;for(let b=f,v=m+f;b<v;b++)if(Ui(xl,3*e.resolveTriangleIndex(b),d,h),xl.needsUpdate=!0,g.intersectsTriangle(xl))return!0;return!1}});for(let g=f,b=m+f;g<b;g++){let v=e.resolveTriangleIndex(g);Ui(Cl,3*v,d,h),Cl.a.applyMatrix4(mh),Cl.b.applyMatrix4(mh),Cl.c.applyMatrix4(mh),Cl.needsUpdate=!0;for(let E=0,y=u.count;E<y;E+=3)if(Ui(xl,E,u,p),xl.needsUpdate=!0,Cl.intersectsTriangle(xl))return!0}}else{let c=s+8,d=a[s+6];return wi(c,r,np),!!(n.intersectsBox(np)&&u0(c,e,t,i,n)||(wi(d,r,np),n.intersectsBox(np)&&u0(d,e,t,i,n)))}}var rp=new lt,jg=new rn,gh=new rn,QM=new ce,JM=new ce,eR=new ce,tR=new ce;function iR(s,e,t,i={},n={},r=0,o=1/0){e.boundingBox||e.computeBoundingBox(),jg.set(e.boundingBox.min,e.boundingBox.max,t),jg.needsUpdate=!0;let a=s.geometry,l=a.attributes.position,c=a.index,d=e.attributes.position,h=e.index,u=ts.getPrimitive(),p=ts.getPrimitive(),f=QM,m=JM,g=null,b=null;n&&(g=eR,b=tR);let v=1/0,E=null,y=null;return rp.copy(t).invert(),gh.matrix.copy(rp),s.shapecast({boundsTraverseOrder:w=>jg.distanceToBox(w),intersectsBounds:(w,C,A)=>A<v&&A<o?(C&&(gh.min.copy(w.min),gh.max.copy(w.max),gh.needsUpdate=!0),!0):!1,intersectsRange:(w,C)=>{if(e.boundsTree){let A=e.boundsTree;return A.shapecast({boundsTraverseOrder:D=>gh.distanceToBox(D),intersectsBounds:(D,M,I)=>I<v&&I<o,intersectsRange:(D,M)=>{for(let I=D,O=D+M;I<O;I++){let F=A.resolveTriangleIndex(I);Ui(p,3*F,h,d),p.a.applyMatrix4(t),p.b.applyMatrix4(t),p.c.applyMatrix4(t),p.needsUpdate=!0;for(let V=w,x=w+C;V<x;V++){let N=s.resolveTriangleIndex(V);Ui(u,3*N,c,l),u.needsUpdate=!0;let z=u.distanceToTriangle(p,f,g);if(z<v&&(m.copy(f),b&&b.copy(g),v=z,E=V,y=I),z<r)return!0}}}})}else{let A=Vl(e);for(let D=0,M=A;D<M;D++){Ui(p,3*D,h,d),p.a.applyMatrix4(t),p.b.applyMatrix4(t),p.c.applyMatrix4(t),p.needsUpdate=!0;for(let I=w,O=w+C;I<O;I++){let F=s.resolveTriangleIndex(I);Ui(u,3*F,c,l),u.needsUpdate=!0;let V=u.distanceToTriangle(p,f,g);if(V<v&&(m.copy(f),b&&b.copy(g),v=V,E=I,y=D),V<r)return!0}}}}}),ts.releasePrimitive(u),ts.releasePrimitive(p),v===1/0?null:(i.point?i.point.copy(m):i.point=m.clone(),i.distance=v,i.faceIndex=E,n&&(n.point?n.point.copy(b):n.point=b.clone(),n.point.applyMatrix4(rp),m.applyMatrix4(rp),n.distance=m.sub(n.point).length(),n.faceIndex=y),i)}function nR(){return typeof SharedArrayBuffer<"u"}var Th=new ui.constructor,Tp=new ui.constructor,co=new Mh(()=>new Qt),Sl=new Qt,Al=new Qt,Hg=new Qt,Gg=new Qt,Wg=!1;function sR(s,e,t,i){if(Wg)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");Wg=!0;let n=s._roots,r=e._roots,o,a=0,l=0,c=new lt().copy(t).invert();for(let d=0,h=n.length;d<h;d++){Th.setBuffer(n[d]),l=0;let u=co.getPrimitive();wi(0,Th.float32Array,u),u.applyMatrix4(c);for(let p=0,f=r.length;p<f&&(Tp.setBuffer(r[d]),o=Ts(0,0,t,c,i,a,l,0,0,u),Tp.clearBuffer(),l+=r[p].length,!o);p++);if(co.releasePrimitive(u),Th.clearBuffer(),a+=n[d].length,o)break}return Wg=!1,o}function Ts(s,e,t,i,n,r=0,o=0,a=0,l=0,c=null,d=!1){let h,u;d?(h=Tp,u=Th):(h=Th,u=Tp);let p=h.float32Array,f=h.uint32Array,m=h.uint16Array,g=u.float32Array,b=u.uint32Array,v=u.uint16Array,E=s*2,y=e*2,w=Un(E,m),C=Un(y,v),A=!1;if(C&&w)d?A=n(Bn(e,b),is(e*2,v),Bn(s,f),is(s*2,m),l,o+e,a,r+s):A=n(Bn(s,f),is(s*2,m),Bn(e,b),is(e*2,v),a,r+s,l,o+e);else if(C){let D=co.getPrimitive();wi(e,g,D),D.applyMatrix4(t);let M=ns(s),I=ss(s,f);wi(M,p,Sl),wi(I,p,Al);let O=D.intersectsBox(Sl),F=D.intersectsBox(Al);A=O&&Ts(e,M,i,t,n,o,r,l,a+1,D,!d)||F&&Ts(e,I,i,t,n,o,r,l,a+1,D,!d),co.releasePrimitive(D)}else{let D=ns(e),M=ss(e,b);wi(D,g,Hg),wi(M,g,Gg);let I=c.intersectsBox(Hg),O=c.intersectsBox(Gg);if(I&&O)A=Ts(s,D,t,i,n,r,o,a,l+1,c,d)||Ts(s,M,t,i,n,r,o,a,l+1,c,d);else if(I)if(w)A=Ts(s,D,t,i,n,r,o,a,l+1,c,d);else{let F=co.getPrimitive();F.copy(Hg).applyMatrix4(t);let V=ns(s),x=ss(s,f);wi(V,p,Sl),wi(x,p,Al);let N=F.intersectsBox(Sl),z=F.intersectsBox(Al);A=N&&Ts(D,V,i,t,n,o,r,l,a+1,F,!d)||z&&Ts(D,x,i,t,n,o,r,l,a+1,F,!d),co.releasePrimitive(F)}else if(O)if(w)A=Ts(s,M,t,i,n,r,o,a,l+1,c,d);else{let F=co.getPrimitive();F.copy(Gg).applyMatrix4(t);let V=ns(s),x=ss(s,f);wi(V,p,Sl),wi(x,p,Al);let N=F.intersectsBox(Sl),z=F.intersectsBox(Al);A=N&&Ts(M,V,i,t,n,o,r,l,a+1,F,!d)||z&&Ts(M,x,i,t,n,o,r,l,a+1,F,!d),co.releasePrimitive(F)}}return A}var op=new rn,QE=new Qt,p0=class s{static serialize(e,t={}){t=Se({cloneBuffers:!0},t);let i=e.geometry,n=e._roots,r=e._indirectBuffer,o=i.getIndex(),a;return t.cloneBuffers?a={roots:n.map(l=>l.slice()),index:o.array.slice(),indirectBuffer:r?r.slice():null}:a={roots:n,index:o.array,indirectBuffer:r},a}static deserialize(e,t,i={}){i=Se({setIndex:!0,indirect:!!e.indirectBuffer},i);let{index:n,roots:r,indirectBuffer:o}=e,a=new s(t,yt(Se({},i),{[Ng]:!0}));if(a._roots=r,a._indirectBuffer=o||null,i.setIndex){let l=t.getIndex();if(l===null){let c=new Ti(e.index,1,!1);t.setIndex(c)}else l.array!==n&&(l.array.set(n),l.needsUpdate=!0)}return a}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:N1,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,[Ng]:!1},t),t.useSharedArrayBuffer&&!nR())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[Ng]||(CM(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Qt)));let{_indirectBuffer:i}=this;this.resolveTriangleIndex=t.indirect?n=>i[n]:n=>n}refit(e=null){return(this.indirect?qM:LM)(this,e)}traverse(e,t=0){let i=this._roots[t],n=new Uint32Array(i),r=new Uint16Array(i);o(0);function o(a,l=0){let c=a*2,d=r[c+15]===Yp;if(d){let h=n[a+6],u=r[c+14];e(l,d,new Float32Array(i,a*4,6),h,u)}else{let h=a+Ep/4,u=n[a+6],p=n[a+7];e(l,d,new Float32Array(i,a*4,6),p)||(o(h,l+1),o(u,l+1))}}}raycast(e,t=fg){let i=this._roots,n=this.geometry,r=[],o=t.isMaterial,a=Array.isArray(t),l=n.groups,c=o?t.side:t,d=this.indirect?XM:UM;for(let h=0,u=i.length;h<u;h++){let p=a?t[l[h].materialIndex].side:c,f=r.length;if(d(this,h,p,e,r),a){let m=l[h].materialIndex;for(let g=f,b=r.length;g<b;g++)r[g].face.materialIndex=m}}return r}raycastFirst(e,t=fg){let i=this._roots,n=this.geometry,r=t.isMaterial,o=Array.isArray(t),a=null,l=n.groups,c=r?t.side:t,d=this.indirect?$M:zM;for(let h=0,u=i.length;h<u;h++){let p=o?t[l[h].materialIndex].side:c,f=d(this,h,p,e);f!=null&&(a==null||f.distance<a.distance)&&(a=f,o&&(f.face.materialIndex=l[h].materialIndex))}return a}intersectsGeometry(e,t){let i=!1,n=this._roots,r=this.indirect?ZM:VM;for(let o=0,a=n.length;o<a&&(i=r(this,o,e,t),!i);o++);return i}shapecast(e){let t=ts.getPrimitive(),i=this.indirect?NM:DM,{boundsTraverseOrder:n,intersectsBounds:r,intersectsRange:o,intersectsTriangle:a}=e;if(o&&a){let h=o;o=(u,p,f,m,g)=>h(u,p,f,m,g)?!0:i(u,p,this,a,f,m,t)}else o||(a?o=(h,u,p,f)=>i(h,u,this,a,p,f,t):o=(h,u,p)=>p);let l=!1,c=0,d=this._roots;for(let h=0,u=d.length;h<u;h++){let p=d[h];if(l=IM(this,h,r,o,n,c),l)break;c+=p.byteLength}return ts.releasePrimitive(t),l}bvhcast(e,t,i){let{intersectsRanges:n,intersectsTriangles:r}=i,o=ts.getPrimitive(),a=this.geometry.index,l=this.geometry.attributes.position,c=this.indirect?f=>{let m=this.resolveTriangleIndex(f);Ui(o,m*3,a,l)}:f=>{Ui(o,f*3,a,l)},d=ts.getPrimitive(),h=e.geometry.index,u=e.geometry.attributes.position,p=e.indirect?f=>{let m=e.resolveTriangleIndex(f);Ui(d,m*3,h,u)}:f=>{Ui(d,f*3,h,u)};if(r){let f=(m,g,b,v,E,y,w,C)=>{for(let A=b,D=b+v;A<D;A++){p(A),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let M=m,I=m+g;M<I;M++)if(c(M),o.needsUpdate=!0,r(o,d,M,A,E,y,w,C))return!0}return!1};if(n){let m=n;n=function(g,b,v,E,y,w,C,A){return m(g,b,v,E,y,w,C,A)?!0:f(g,b,v,E,y,w,C,A)}}else n=f}return sR(this,e,t,n)}intersectsBox(e,t){return op.set(e.min,e.max,t),op.needsUpdate=!0,this.shapecast({intersectsBounds:i=>op.intersectsBox(i),intersectsTriangle:i=>op.intersectsTriangle(i)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,i={},n={},r=0,o=1/0){return(this.indirect?iR:YM)(this,e,t,i,n,r,o)}closestPointToPoint(e,t={},i=0,n=1/0){return TM(this,e,t,i,n)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{wi(0,new Float32Array(t),QE),e.union(QE)}),e}};function JE(s,e,t){return s===null||(s.point.applyMatrix4(e.matrixWorld),s.distance=s.point.distanceTo(t.ray.origin),s.object=e,s.distance<t.near||s.distance>t.far)?null:s}var Yg=new Hw,e1=new lt,rR=$e.prototype.raycast;function oR(s,e){if(this.geometry.boundsTree){if(this.material===void 0)return;e1.copy(this.matrixWorld).invert(),Yg.copy(s.ray).applyMatrix4(e1);let t=this.geometry.boundsTree;if(s.firstHitOnly===!0){let i=JE(t.raycastFirst(Yg,this.material),this,s);i&&e.push(i)}else{let i=t.raycast(Yg,this.material);for(let n=0,r=i.length;n<r;n++){let o=JE(i[n],this,s);o&&e.push(o)}}}else rR.call(this,s,e)}function aR(s){return this.boundsTree=new p0(this,s),this.boundsTree}function lR(){this.boundsTree=null}var Oe=class{constructor(){q(this,"trigger",e=>{let t=this.handlers.slice(0);for(let i of t)i(e)}),q(this,"handlers",[])}add(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}reset(){this.handlers.length=0}},ga=class{constructor(){q(this,"trigger",e=>ie(this,null,function*(){let t=this.handlers.slice(0);for(let i of t)yield i(e)})),q(this,"handlers",[])}add(e){this.handlers.push(e)}remove(e){this.handlers=this.handlers.filter(t=>t!==e)}reset(){this.handlers.length=0}},Rh=class{constructor(e){q(this,"isDisposeable",()=>"dispose"in this&&"onDisposed"in this),q(this,"isResizeable",()=>"resize"in this&&"getSize"in this),q(this,"isUpdateable",()=>"onAfterUpdate"in this&&"onBeforeUpdate"in this&&"update"in this),q(this,"isHideable",()=>"visible"in this),q(this,"isConfigurable",()=>"setup"in this&&"config"in this&&"onSetup"in this),this.components=e}},At=class extends Rh{},Pp=class extends Rh{constructor(e){super(e),q(this,"worlds",new Map),q(this,"onWorldChanged",new Oe),q(this,"currentWorld",null),this.onWorldChanged.add(({world:t,action:i})=>{i==="removed"&&this.worlds.delete(t.uuid)})}},f0=class extends Pp{constructor(){super(...arguments),q(this,"hasCameraControls",()=>"controls"in this)}},m0=class extends Pp{constructor(){super(...arguments),q(this,"onAfterUpdate",new Oe),q(this,"onBeforeUpdate",new Oe),q(this,"onDisposed",new Oe),q(this,"onResize",new Oe),q(this,"onClippingPlanesUpdated",new Oe),q(this,"clippingPlanes",[])}updateClippingPlanes(){this.onClippingPlanesUpdated.trigger()}setPlane(e,t,i){t.isLocal=i;let n=this.clippingPlanes.indexOf(t);e&&n===-1?this.clippingPlanes.push(t):!e&&n>-1&&this.clippingPlanes.splice(n,1),this.three.clippingPlanes=this.clippingPlanes.filter(r=>!r.isLocal)}},V1=class g0 extends At{constructor(e){super(e),q(this,"_disposedComponents",new Set),q(this,"enabled",!0),e.add(g0.uuid,this)}get(){return this._disposedComponents}destroy(e,t=!0,i=!0){e.removeFromParent();let n=e;n.dispose&&n.dispose(),this.disposeGeometryAndMaterials(e,t),i&&n.children&&n.children.length&&this.disposeChildren(n),e.children.length=0}disposeGeometry(e){e.boundsTree&&e.disposeBoundsTree&&e.disposeBoundsTree(),e.dispose()}disposeGeometryAndMaterials(e,t){let i=e;i.geometry&&this.disposeGeometry(i.geometry),t&&i.material&&g0.disposeMaterial(i),i.material=[],i.geometry=null}disposeChildren(e){for(let t of e.children)this.destroy(t)}static disposeMaterial(e){if(e.material)if(Array.isArray(e.material))for(let t of e.material)t.dispose();else e.material.dispose()}};q(V1,"uuid","76e9cd8e-ad8f-4753-9ef6-cbc60f7247fe");var nr=V1,ba=class extends Set{constructor(e){super(e),q(this,"onItemAdded",new Oe),q(this,"onItemDeleted",new Oe),q(this,"onCleared",new Oe),q(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}add(...e){for(let t of e)this.has(t)||!this.guard(t)||(super.add(t),this.onItemAdded||(this.onItemAdded=new Oe),this.onItemAdded.trigger(t));return this}delete(e){let t=super.delete(e);return t&&this.onItemDeleted.trigger(),t}dispose(){this.clear(),this.onItemAdded.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}},fo=class extends Map{constructor(e){super(e),q(this,"onItemSet",new Oe),q(this,"onItemUpdated",new Oe),q(this,"onItemDeleted",new Oe),q(this,"onCleared",new Oe),q(this,"guard",()=>!0)}clear(){super.clear(),this.onCleared.trigger()}set(e,t){let i=this.has(e);if(!this.guard(e,t))return this;let n=super.set(e,t);return i?(this.onItemUpdated||(this.onItemUpdated=new Oe),this.onItemUpdated.trigger({key:e,value:t})):(this.onItemSet||(this.onItemSet=new Oe),this.onItemSet.trigger({key:e,value:t})),n}delete(e){let t=super.delete(e);return t&&this.onItemDeleted.trigger(e),t}dispose(){this.clear(),this.onItemSet.reset(),this.onItemDeleted.reset(),this.onCleared.reset()}},Cp=0,cR=1,hR=new ce,t1=new en,qg=new Ws,i1=new ce,ap=new wr,b0=class{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new Op,this.unassigned=new Op,this.vertices=[]}setFromPoints(e){if(e.length>=4){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.vertices.push(new v0(e[t]));this.compute()}return this}setFromObject(e){let t=[];return e.updateMatrixWorld(!0),e.traverse(function(i){let n=i.geometry;if(n!==void 0){let r=n.attributes.position;if(r!==void 0)for(let o=0,a=r.count;o<a;o++){let l=new ce;l.fromBufferAttribute(r,o).applyMatrix4(i.matrixWorld),t.push(l)}}}),this.setFromPoints(t)}containsPoint(e){let t=this.faces;for(let i=0,n=t.length;i<n;i++)if(t[i].distanceToPoint(e)>this.tolerance)return!1;return!0}intersectRay(e,t){let i=this.faces,n=-1/0,r=1/0;for(let o=0,a=i.length;o<a;o++){let l=i[o],c=l.distanceToPoint(e.origin),d=l.normal.dot(e.direction);if(c>0&&d>=0)return null;let h=d!==0?-c/d:0;if(!(h<=0)&&(d>0?r=Math.min(h,r):n=Math.max(h,n),n>r))return null}return n!==-1/0?e.at(n,t):e.at(r,t),t}intersectsRay(e){return this.intersectRay(e,hR)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(e,t){return e.face=t,t.outside===null?this.assigned.append(e):this.assigned.insertBefore(t.outside,e),t.outside=e,this}removeVertexFromFace(e,t){return e===t.outside&&(e.next!==null&&e.next.face===t?t.outside=e.next:t.outside=null),this.assigned.remove(e),this}removeAllVerticesFromFace(e){if(e.outside!==null){let t=e.outside,i=e.outside;for(;i.next!==null&&i.next.face===e;)i=i.next;return this.assigned.removeSubList(t,i),t.prev=i.next=null,e.outside=null,t}}deleteFaceVertices(e,t){let i=this.removeAllVerticesFromFace(e);if(i!==void 0)if(t===void 0)this.unassigned.appendChain(i);else{let n=i;do{let r=n.next;t.distanceToPoint(n.point)>this.tolerance?this.addVertexToFace(n,t):this.unassigned.append(n),n=r}while(n!==null)}return this}resolveUnassignedPoints(e){if(this.unassigned.isEmpty()===!1){let t=this.unassigned.first();do{let i=t.next,n=this.tolerance,r=null;for(let o=0;o<e.length;o++){let a=e[o];if(a.mark===Cp){let l=a.distanceToPoint(t.point);if(l>n&&(n=l,r=a),n>1e3*this.tolerance)break}}r!==null&&this.addVertexToFace(t,r),t=i}while(t!==null)}return this}computeExtremes(){let e=new ce,t=new ce,i=[],n=[];for(let r=0;r<3;r++)i[r]=n[r]=this.vertices[0];e.copy(this.vertices[0].point),t.copy(this.vertices[0].point);for(let r=0,o=this.vertices.length;r<o;r++){let a=this.vertices[r],l=a.point;for(let c=0;c<3;c++)l.getComponent(c)<e.getComponent(c)&&(e.setComponent(c,l.getComponent(c)),i[c]=a);for(let c=0;c<3;c++)l.getComponent(c)>t.getComponent(c)&&(t.setComponent(c,l.getComponent(c)),n[c]=a)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e.x),Math.abs(t.x))+Math.max(Math.abs(e.y),Math.abs(t.y))+Math.max(Math.abs(e.z),Math.abs(t.z))),{min:i,max:n}}computeInitialHull(){let e=this.vertices,t=this.computeExtremes(),i=t.min,n=t.max,r=0,o=0;for(let u=0;u<3;u++){let p=n[u].point.getComponent(u)-i[u].point.getComponent(u);p>r&&(r=p,o=u)}let a=i[o],l=n[o],c,d;r=0,t1.set(a.point,l.point);for(let u=0,p=this.vertices.length;u<p;u++){let f=e[u];if(f!==a&&f!==l){t1.closestPointToPoint(f.point,!0,i1);let m=i1.distanceToSquared(f.point);m>r&&(r=m,c=f)}}r=-1,qg.setFromCoplanarPoints(a.point,l.point,c.point);for(let u=0,p=this.vertices.length;u<p;u++){let f=e[u];if(f!==a&&f!==l&&f!==c){let m=Math.abs(qg.distanceToPoint(f.point));m>r&&(r=m,d=f)}}let h=[];if(qg.distanceToPoint(d.point)<0){h.push(Os.create(a,l,c),Os.create(d,l,a),Os.create(d,c,l),Os.create(d,a,c));for(let u=0;u<3;u++){let p=(u+1)%3;h[u+1].getEdge(2).setTwin(h[0].getEdge(p)),h[u+1].getEdge(1).setTwin(h[p+1].getEdge(0))}}else{h.push(Os.create(a,c,l),Os.create(d,a,l),Os.create(d,l,c),Os.create(d,c,a));for(let u=0;u<3;u++){let p=(u+1)%3;h[u+1].getEdge(2).setTwin(h[0].getEdge((3-u)%3)),h[u+1].getEdge(0).setTwin(h[p+1].getEdge(1))}}for(let u=0;u<4;u++)this.faces.push(h[u]);for(let u=0,p=e.length;u<p;u++){let f=e[u];if(f!==a&&f!==l&&f!==c&&f!==d){r=this.tolerance;let m=null;for(let g=0;g<4;g++){let b=this.faces[g].distanceToPoint(f.point);b>r&&(r=b,m=this.faces[g])}m!==null&&this.addVertexToFace(f,m)}}return this}reindexFaces(){let e=[];for(let t=0;t<this.faces.length;t++){let i=this.faces[t];i.mark===Cp&&e.push(i)}return this.faces=e,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let e,t=0,i=this.assigned.first().face,n=i.outside;do{let r=i.distanceToPoint(n.point);r>t&&(t=r,e=n),n=n.next}while(n!==null&&n.face===i);return e}}computeHorizon(e,t,i,n){this.deleteFaceVertices(i),i.mark=cR;let r;t===null?r=t=i.getEdge(0):r=t.next;do{let o=r.twin,a=o.face;a.mark===Cp&&(a.distanceToPoint(e)>this.tolerance?this.computeHorizon(e,o,a,n):n.push(r)),r=r.next}while(r!==t);return this}addAdjoiningFace(e,t){let i=Os.create(e,t.tail(),t.head());return this.faces.push(i),i.getEdge(-1).setTwin(t.twin),i.getEdge(0)}addNewFaces(e,t){this.newFaces=[];let i=null,n=null;for(let r=0;r<t.length;r++){let o=t[r],a=this.addAdjoiningFace(e,o);i===null?i=a:a.next.setTwin(n),this.newFaces.push(a.face),n=a}return i.next.setTwin(n),this}addVertexToHull(e){let t=[];return this.unassigned.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let e;for(this.computeInitialHull();(e=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(e);return this.reindexFaces(),this.cleanup(),this}},Os=class s{constructor(){this.normal=new ce,this.midpoint=new ce,this.area=0,this.constant=0,this.outside=null,this.mark=Cp,this.edge=null}static create(e,t,i){let n=new s,r=new Ph(e,n),o=new Ph(t,n),a=new Ph(i,n);return r.next=a.prev=o,o.next=r.prev=a,a.next=o.prev=r,n.edge=r,n.compute()}getEdge(e){let t=this.edge;for(;e>0;)t=t.next,e--;for(;e<0;)t=t.prev,e++;return t}compute(){let e=this.edge.tail(),t=this.edge.head(),i=this.edge.next.head();return ap.set(e.point,t.point,i.point),ap.getNormal(this.normal),ap.getMidpoint(this.midpoint),this.area=ap.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(e){return this.normal.dot(e)-this.constant}},Ph=class{constructor(e,t){this.vertex=e,this.prev=null,this.next=null,this.twin=null,this.face=t}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){let e=this.head(),t=this.tail();return t!==null?t.point.distanceTo(e.point):-1}lengthSquared(){let e=this.head(),t=this.tail();return t!==null?t.point.distanceToSquared(e.point):-1}setTwin(e){return this.twin=e,e.twin=this,this}},v0=class{constructor(e){this.point=e,this.prev=null,this.next=null,this.face=null}},Op=class{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(e,t){return t.prev=e.prev,t.next=e,t.prev===null?this.head=t:t.prev.next=t,e.prev=t,this}insertAfter(e,t){return t.prev=e,t.next=e.next,t.next===null?this.tail=t:t.next.prev=t,e.next=t,this}append(e){return this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail,e.next=null,this.tail=e,this}appendChain(e){for(this.head===null?this.head=e:this.tail.next=e,e.prev=this.tail;e.next!==null;)e=e.next;return this.tail=e,this}remove(e){return e.prev===null?this.head=e.next:e.prev.next=e.next,e.next===null?this.tail=e.prev:e.next.prev=e.prev,this}removeSubList(e,t){return e.prev===null?this.head=t.next:e.prev.next=t.next,t.next===null?this.tail=e.prev:t.next.prev=e.prev,this}isEmpty(){return this.head===null}},y0=[2,2,1],_0=[1,0,0];function tr(s,e){return s*3+e}function dR(s){let e=s.elements,t=0;for(let i=0;i<9;i++)t+=e[i]*e[i];return Math.sqrt(t)}function uR(s){let e=s.elements,t=0;for(let i=0;i<3;i++){let n=e[tr(y0[i],_0[i])];t+=2*n*n}return Math.sqrt(t)}function pR(s,e){let t=0,i=1,n=s.elements;for(let c=0;c<3;c++){let d=Math.abs(n[tr(y0[c],_0[c])]);d>t&&(t=d,i=c)}let r=1,o=0,a=_0[i],l=y0[i];if(Math.abs(n[tr(l,a)])>Number.EPSILON){let c=n[tr(l,l)],d=n[tr(a,a)],h=n[tr(l,a)],u=(c-d)/2/h,p;u<0?p=-1/(-u+Math.sqrt(1+u*u)):p=1/(u+Math.sqrt(1+u*u)),r=1/Math.sqrt(1+p*p),o=p*r}return e.identity(),e.elements[tr(a,a)]=r,e.elements[tr(l,l)]=r,e.elements[tr(l,a)]=o,e.elements[tr(a,l)]=-o,e}function fR(s,e){let t=0,i=0,n=10;e.unitary.identity(),e.diagonal.copy(s);let r=e.unitary,o=e.diagonal,a=new Jr,l=new Jr,c=Number.EPSILON*dR(o);for(;i<n&&uR(o)>c;)pR(o,a),l.copy(a).transpose(),o.multiply(a),o.premultiply(l),r.multiply(a),++t>2&&(i++,t=0);return e}function mR(s){let e=[];for(let te=0;te<s.length-2;te+=3){let J=s[te],oe=s[te+1],pe=s[te+2];e.push(new ce(J,oe,pe))}let t=new b0;t.setFromPoints(e);let i={unitary:new Jr,diagonal:new Jr},n=t.faces,r=[],o=[];for(let te=0,J=n.length;te<J;te++){let oe=n[te],pe=oe.edge;r.length=0;do r.push(pe),pe=pe.next;while(pe!==oe.edge);let de=r.length-2;for(let fe=1,P=de;fe<=P;fe++){let se=r[0].vertex,re=r[fe+0].vertex,K=r[fe+1].vertex;o.push(se.point.x,se.point.y,se.point.z),o.push(re.point.x,re.point.y,re.point.z),o.push(K.point.x,K.point.y,K.point.z)}}let a=new ce,l=new ce,c=new ce,d=new ce,h=new ce,u=new ce,p=new ce,f=new ce,m=0,g=0,b=0,v=0,E=0,y=0,w=0;for(let te=0,J=o.length;te<J;te+=9){a.fromArray(o,te),l.fromArray(o,te+3),c.fromArray(o,te+6),p.set(0,0,0),p.add(a).add(l).add(c).divideScalar(3),d.subVectors(l,a),h.subVectors(c,a);let oe=u.crossVectors(d,h).length()/2;f.add(u.copy(p).multiplyScalar(oe)),m+=oe,g+=(9*p.x*p.x+a.x*a.x+l.x*l.x+c.x*c.x)*(oe/12),b+=(9*p.x*p.y+a.x*a.y+l.x*l.y+c.x*c.y)*(oe/12),v+=(9*p.x*p.z+a.x*a.z+l.x*l.z+c.x*c.z)*(oe/12),E+=(9*p.y*p.y+a.y*a.y+l.y*l.y+c.y*c.y)*(oe/12),y+=(9*p.y*p.z+a.y*a.z+l.y*l.z+c.y*c.z)*(oe/12),w+=(9*p.z*p.z+a.z*a.z+l.z*l.z+c.z*c.z)*(oe/12)}f.divideScalar(m),g/=m,b/=m,v/=m,E/=m,y/=m,w/=m,g-=f.x*f.x,b-=f.x*f.y,v-=f.x*f.z,E-=f.y*f.y,y-=f.y*f.z,w-=f.z*f.z;let C=new Jr;C.elements[0]=g,C.elements[1]=b,C.elements[2]=v,C.elements[3]=b,C.elements[4]=E,C.elements[5]=y,C.elements[6]=v,C.elements[7]=y,C.elements[8]=w,fR(C,i);let A=i.unitary,D=new ce,M=new ce,I=new ce;A.extractBasis(D,M,I);let O=-1/0,F=-1/0,V=-1/0,x=1/0,N=1/0,z=1/0;for(let te=0,J=e.length;te<J;te++){let oe=e[te];O=Math.max(D.dot(oe),O),F=Math.max(M.dot(oe),F),V=Math.max(I.dot(oe),V),x=Math.min(D.dot(oe),x),N=Math.min(M.dot(oe),N),z=Math.min(I.dot(oe),z)}D.multiplyScalar(.5*(x+O)),M.multiplyScalar(.5*(N+F)),I.multiplyScalar(.5*(z+V));let G=new ce,X=new ce,k=new Jr;G.add(D).add(M).add(I),X.x=O-x,X.y=F-N,X.z=V-z,X.multiplyScalar(.5),k.copy(A);let{x:B,y:R,z:j}=X,$=new lt;$.makeScale(B*2,R*2,j*2);let T=new lt;T.makeTranslation(-B,-R,-j);let U=new lt;U.makeTranslation(G.x,G.y,G.z);let W=new lt;W.setFromMatrix3(k);let Q=new lt;return Q.multiply(U),Q.multiply(W),Q.multiply(T),Q.multiply($),{center:G,halfSizes:X,rotation:k,transformation:Q}}function gR(s,e,t){let i=[s[0]-e[0],s[1]-e[1],s[2]-e[2]];return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]>0}var Mp=class{static isTransparent(e){return e.transparent&&e.opacity<1}},w0=class Wi{static create(){let e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return`${Wi._lut[e&255]+Wi._lut[e>>8&255]+Wi._lut[e>>16&255]+Wi._lut[e>>24&255]}-${Wi._lut[t&255]}${Wi._lut[t>>8&255]}-${Wi._lut[t>>16&15|64]}${Wi._lut[t>>24&255]}-${Wi._lut[i&63|128]}${Wi._lut[i>>8&255]}-${Wi._lut[i>>16&255]}${Wi._lut[i>>24&255]}${Wi._lut[n&255]}${Wi._lut[n>>8&255]}${Wi._lut[n>>16&255]}${Wi._lut[n>>24&255]}`.toLowerCase()}static validate(e){if(!Wi._pattern.test(e))throw new Error(`${e} is not a valid UUID v4.

- If you're the tool creator, you can take one from https://www.uuidgenerator.net/.

- If you're using a platform tool, verify the uuid isn't misspelled or contact the tool creator.`)}};q(w0,"_pattern",/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$/),q(w0,"_lut",["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"]);var jl=w0,E0=class extends At{constructor(e,t){super(e),q(this,"onDisposed",new Oe),q(this,"onVertexFound",new Oe),q(this,"onVertexLost",new Oe),q(this,"onEnabled",new Oe),q(this,"components"),q(this,"workingPlane",null),q(this,"_pickedPoint",null),q(this,"_config"),q(this,"_enabled",!1),this.components=e,this.config=Se({snapDistance:.25,showOnlyVertex:!1},t),this.enabled=!1}set enabled(e){this._enabled=e,e||(this._pickedPoint=null),this.onEnabled.trigger(e)}get enabled(){return this._enabled}set config(e){this._config=Se(Se({},this._config),e)}get config(){return this._config}dispose(){this.onVertexFound.reset(),this.onVertexLost.reset(),this.components=null,this.onDisposed.trigger(),this.onDisposed.reset()}get(e){if(!this.enabled)return this._pickedPoint;let t=this.components.get(rs).get(e).castRay();if(!t)return this._pickedPoint!==null&&(this.onVertexLost.trigger(),this._pickedPoint=null),this._pickedPoint;let i=this.getClosestVertex(t);return i?!this.workingPlane||Math.abs(this.workingPlane.distanceToPoint(i))<.001?((this._pickedPoint===null||!this._pickedPoint.equals(i))&&(this._pickedPoint=i.clone(),this.onVertexFound.trigger(this._pickedPoint)),this._pickedPoint):(this._pickedPoint=null,this._pickedPoint):(this._pickedPoint!==null&&(this.onVertexLost.trigger(),this._pickedPoint=null),this._pickedPoint)}getClosestVertex(e){let t=new ce,i=!1,n=Number.MAX_SAFE_INTEGER,r=this.getVertices(e);if(r===null)return null;for(let o of r){if(!o)continue;let a=e.point.distanceTo(o);a>n||a>this._config.snapDistance||(i=!0,t=o,n=e.point.distanceTo(o))}return i?t:this.config.showOnlyVertex?null:e.point}getVertices(e){let t=e.object;if(!e.face||!t)return null;let i=t.geometry,n=new lt,{instanceId:r}=e,o=r!==void 0,a=t instanceof Jn;return a&&o&&t.getMatrixAt(r,n),[this.getVertex(e.face.a,i),this.getVertex(e.face.b,i),this.getVertex(e.face.c,i)].map(l=>(l&&(a&&o&&l.applyMatrix4(n),l.applyMatrix4(t.matrixWorld)),l))}getVertex(e,t){if(e===void 0)return null;let i=t.attributes.position;return new ce(i.getX(e),i.getY(e),i.getZ(e))}},j1=class H1{constructor(){q(this,"onDisposed",new Oe),q(this,"list",new Map),q(this,"enabled",!1),q(this,"_clock"),q(this,"update",()=>{if(!this.enabled)return;let e=this._clock.getDelta();for(let[t,i]of this.list)i.enabled&&i.isUpdateable()&&i.update(e);requestAnimationFrame(this.update)}),this._clock=new Lu,H1.setupBVH()}add(e,t){if(this.list.has(e))throw new Error("You're trying to add a component that already exists in the components instance. Use Components.get() instead.");jl.validate(e),this.list.set(e,t)}get(e){let t=e.uuid;if(!this.list.has(t)){let i=new e(this);return this.list.has(t)||this.add(t,i),i}return this.list.get(t)}init(){this.enabled=!0,this._clock.start(),this.update()}dispose(){this.enabled=!1;for(let[e,t]of this.list)t.enabled=!1,t.isDisposeable()&&t.dispose();this._clock.stop(),this.onDisposed.trigger(),this.onDisposed.reset()}static setupBVH(){kt.prototype.computeBoundsTree=aR,kt.prototype.disposeBoundsTree=lR,$e.prototype.raycast=oR}};q(j1,"release","2.2.0-alpha.0");var bR=j1,C0=class extends Rh{constructor(){super(...arguments),q(this,"meshes",new Set),q(this,"onAfterUpdate",new Oe),q(this,"onBeforeUpdate",new Oe),q(this,"onDisposed",new Oe),q(this,"isDisposing",!1),q(this,"enabled",!0),q(this,"uuid",jl.create()),q(this,"name"),q(this,"_scene"),q(this,"_camera"),q(this,"_renderer",null)}get scene(){if(!this._scene)throw new Error("No scene initialized!");return this._scene}set scene(e){this._scene=e,e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"})}get camera(){if(!this._camera)throw new Error("No camera initialized!");return this._camera}set camera(e){this._camera=e,e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"})}get renderer(){return this._renderer}set renderer(e){this._renderer=e,e&&(e.worlds.set(this.uuid,this),e.currentWorld=this,e.onWorldChanged.trigger({world:this,action:"added"}))}update(e){this.enabled&&(!this._scene||!this._camera||(this.scene.currentWorld=this,this.camera.currentWorld=this,this.renderer&&(this.renderer.currentWorld=this),this.onBeforeUpdate.trigger(),this.scene.isUpdateable()&&this.scene.update(e),this.camera.isUpdateable()&&this.camera.update(e),this.renderer&&this.renderer.update(e),this.onAfterUpdate.trigger()))}dispose(e=!0){if(this.enabled=!1,this.isDisposing=!0,this.scene.onWorldChanged.trigger({world:this,action:"removed"}),this.camera.onWorldChanged.trigger({world:this,action:"removed"}),this.renderer&&this.renderer.onWorldChanged.trigger({world:this,action:"removed"}),e){let t=this.components.get(nr);this.scene.dispose(),this.camera.isDisposeable()&&this.camera.dispose(),this.renderer&&this.renderer.dispose();for(let i of this.meshes)t.destroy(i);this.meshes.clear()}this._scene=null,this._camera=null,this._renderer=null,this.onDisposed.trigger()}},x0=class extends m0{constructor(e,t,i){super(e),q(this,"enabled",!0),q(this,"container"),q(this,"three"),q(this,"_canvas"),q(this,"_parameters"),q(this,"_resizeObserver",null),q(this,"onContainerUpdated",new Oe),q(this,"_resizing",!1),q(this,"resize",o=>{if(this._resizing)return;this._resizing=!0,this.onContainerUpdated.trigger();let a=o?o.x:this.container.clientWidth,l=o?o.y:this.container.clientHeight;this.three.setSize(a,l),this.onResize.trigger(new Bt(a,l)),this._resizing=!1}),q(this,"resizeEvent",()=>{this.resize()}),q(this,"onContextLost",o=>{o.preventDefault(),this.enabled=!1}),q(this,"onContextBack",()=>{this.three.setRenderTarget(null),this.three.dispose(),this.three=new sh(Se({canvas:this._canvas,antialias:!0,alpha:!0},this._parameters)),this.enabled=!0}),this.container=t,this._parameters=i,this.three=new sh(Se({antialias:!0,alpha:!0},i)),this.three.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.setupRenderer(),this.setupEvents(!0),this.resize(),this._canvas=this.three.domElement;let n=this.three.getContext(),{canvas:r}=n;r.addEventListener("webglcontextlost",this.onContextLost,!1),r.addEventListener("webglcontextrestored",this.onContextBack,!1)}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger(this);let e=this.currentWorld.scene.three,t=this.currentWorld.camera.three;this.three.render(e,t),this.onAfterUpdate.trigger(this)}dispose(){this.enabled=!1,this.setupEvents(!1),this.three.domElement.remove(),this.three.forceContextLoss(),this.three.dispose(),this.onResize.reset(),this.onAfterUpdate.reset(),this.onBeforeUpdate.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}getSize(){return new Bt(this.three.domElement.clientWidth,this.three.domElement.clientHeight)}setupEvents(e){let t=this.three.domElement.parentElement;if(!t)throw new Error("This renderer needs to have an HTML container!");this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=null),window.removeEventListener("resize",this.resizeEvent),e&&(this._resizeObserver=new ResizeObserver(this.resizeEvent),this._resizeObserver.observe(t),window.addEventListener("resize",this.resizeEvent))}setupRenderer(){this.three.localClippingEnabled=!0,this.container&&this.container.appendChild(this.three.domElement),this.onContainerUpdated.trigger()}};var wt={LEFT:1,RIGHT:2,MIDDLE:4},Ne=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),Il={NONE:0,IN:1,OUT:-1};function ca(s){return s.isPerspectiveCamera}function ao(s){return s.isOrthographicCamera}var Tl=Math.PI*2,n1=Math.PI/2,G1=1e-5,bh=Math.PI/180;function Ps(s,e,t){return Math.max(e,Math.min(t,s))}function hi(s,e=G1){return Math.abs(s)<e}function Jt(s,e,t=G1){return hi(s-e,t)}function s1(s,e){return Math.round(s/e)*e}function vh(s){return isFinite(s)?s:s<0?-Number.MAX_VALUE:Number.MAX_VALUE}function yh(s){return Math.abs(s)<Number.MAX_VALUE?s:s*(1/0)}function lp(s,e,t,i,n=1/0,r){i=Math.max(1e-4,i);let o=2/i,a=o*r,l=1/(1+a+.48*a*a+.235*a*a*a),c=s-e,d=e,h=n*i;c=Ps(c,-h,h),e=s-c;let u=(t.value+o*c)*r;t.value=(t.value-o*u)*l;let p=e+(c+u)*l;return d-s>0==p>d&&(p=d,t.value=(p-d)/r),p}function r1(s,e,t,i,n=1/0,r,o){i=Math.max(1e-4,i);let a=2/i,l=a*r,c=1/(1+l+.48*l*l+.235*l*l*l),d=e.x,h=e.y,u=e.z,p=s.x-d,f=s.y-h,m=s.z-u,g=d,b=h,v=u,E=n*i,y=E*E,w=p*p+f*f+m*m;if(w>y){let N=Math.sqrt(w);p=p/N*E,f=f/N*E,m=m/N*E}d=s.x-p,h=s.y-f,u=s.z-m;let C=(t.x+a*p)*r,A=(t.y+a*f)*r,D=(t.z+a*m)*r;t.x=(t.x-a*C)*c,t.y=(t.y-a*A)*c,t.z=(t.z-a*D)*c,o.x=d+(p+C)*c,o.y=h+(f+A)*c,o.z=u+(m+D)*c;let M=g-s.x,I=b-s.y,O=v-s.z,F=o.x-g,V=o.y-b,x=o.z-v;return M*F+I*V+O*x>0&&(o.x=g,o.y=b,o.z=v,t.x=(o.x-g)/r,t.y=(o.y-b)/r,t.z=(o.z-v)/r),o}function Xg(s,e){e.set(0,0),s.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=s.length,e.y/=s.length}function Kg(s,e){return ao(s)?(console.warn(`${e} is not supported in OrthographicCamera`),!0):!1}var S0=class{constructor(){this._listeners={}}addEventListener(e,t){let i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){let i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){let i=this._listeners[e];if(i!==void 0){let n=i.indexOf(t);n!==-1&&i.splice(n,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){let t=this._listeners[e.type];if(t!==void 0){e.target=this;let i=t.slice(0);for(let n=0,r=i.length;n<r;n++)i[n].call(this,e)}}},vR="2.7.3",cp=1/8,W1=typeof window<"u",yR=W1&&/Mac/.test(navigator.platform),_R=!(W1&&"PointerEvent"in window),gt,o1,hp,$g,Rn,Tt,Yt,Pl,_h,$s,Zs,ha,a1,l1,es,wh,Ol,c1,Zg,h1,Qg,Jg,dp,xn=class s extends S0{static install(e){gt=e.THREE,o1=Object.freeze(new gt.Vector3(0,0,0)),hp=Object.freeze(new gt.Vector3(0,1,0)),$g=Object.freeze(new gt.Vector3(0,0,1)),Rn=new gt.Vector2,Tt=new gt.Vector3,Yt=new gt.Vector3,Pl=new gt.Vector3,_h=new gt.Vector3,$s=new gt.Vector3,Zs=new gt.Vector3,ha=new gt.Vector3,a1=new gt.Vector3,l1=new gt.Vector3,es=new gt.Spherical,wh=new gt.Spherical,Ol=new gt.Box3,c1=new gt.Box3,Zg=new gt.Sphere,h1=new gt.Quaternion,Qg=new gt.Quaternion,Jg=new gt.Matrix4,dp=new gt.Raycaster}static get ACTION(){return Ne}constructor(e,t){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=Ne.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=Il.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new gt.Vector3,this._focalOffsetVelocity=new gt.Vector3,this._zoomVelocity={value:0},this._truckInternal=(y,w,C)=>{let A,D;if(ca(this._camera)){let M=Tt.copy(this._camera.position).sub(this._target),I=this._camera.getEffectiveFOV()*bh,O=M.length()*Math.tan(I*.5);A=this.truckSpeed*y*O/this._elementRect.height,D=this.truckSpeed*w*O/this._elementRect.height}else if(ao(this._camera)){let M=this._camera;A=y*(M.right-M.left)/M.zoom/this._elementRect.width,D=w*(M.top-M.bottom)/M.zoom/this._elementRect.height}else return;this.verticalDragToForward?(C?this.setFocalOffset(this._focalOffsetEnd.x+A,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(A,0,!0),this.forward(-D,!0)):C?this.setFocalOffset(this._focalOffsetEnd.x+A,this._focalOffsetEnd.y+D,this._focalOffsetEnd.z,!0):this.truck(A,D,!0)},this._rotateInternal=(y,w)=>{let C=Tl*this.azimuthRotateSpeed*y/this._elementRect.height,A=Tl*this.polarRotateSpeed*w/this._elementRect.height;this.rotate(C,A,!0)},this._dollyInternal=(y,w,C)=>{let A=Math.pow(.95,-y*this.dollySpeed),D=this._sphericalEnd.radius,M=this._sphericalEnd.radius*A,I=Ps(M,this.minDistance,this.maxDistance),O=I-M;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(M,!0):this.infinityDolly&&!this.dollyToCursor?(this.dollyInFixed(O,!0),this._dollyToNoClamp(I,!0)):this._dollyToNoClamp(I,!0),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?M:I)-D,this._dollyControlCoord.set(w,C)),this._lastDollyDirection=Math.sign(-y)},this._zoomInternal=(y,w,C)=>{let A=Math.pow(.95,y*this.dollySpeed),D=this._zoom,M=this._zoom*A;this.zoomTo(M,!0),this.dollyToCursor&&(this._changedZoom+=M-D,this._dollyControlCoord.set(w,C))},typeof gt>"u"&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new gt.Quaternion().setFromUnitVectors(this._camera.up,hp),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=Ne.NONE,this._target=new gt.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new gt.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new gt.Spherical().setFromVector3(Tt.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new gt.Vector3,new gt.Vector3,new gt.Vector3,new gt.Vector3],this._updateNearPlaneCorners(),this._boundary=new gt.Box3(new gt.Vector3(-1/0,-1/0,-1/0),new gt.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new gt.Vector2,this.mouseButtons={left:Ne.ROTATE,middle:Ne.DOLLY,right:Ne.TRUCK,wheel:ca(this._camera)?Ne.DOLLY:ao(this._camera)?Ne.ZOOM:Ne.NONE},this.touches={one:Ne.TOUCH_ROTATE,two:ca(this._camera)?Ne.TOUCH_DOLLY_TRUCK:ao(this._camera)?Ne.TOUCH_ZOOM_TRUCK:Ne.NONE,three:Ne.TOUCH_TRUCK};let i=new gt.Vector2,n=new gt.Vector2,r=new gt.Vector2,o=y=>{if(!this._enabled||!this._domElement)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){let A=this._domElement.getBoundingClientRect(),D=y.clientX/A.width,M=y.clientY/A.height;if(D<this._interactiveArea.left||D>this._interactiveArea.right||M<this._interactiveArea.top||M>this._interactiveArea.bottom)return}let w=y.pointerType!=="mouse"?null:(y.buttons&wt.LEFT)===wt.LEFT?wt.LEFT:(y.buttons&wt.MIDDLE)===wt.MIDDLE?wt.MIDDLE:(y.buttons&wt.RIGHT)===wt.RIGHT?wt.RIGHT:null;if(w!==null){let A=this._findPointerByMouseButton(w);A&&this._disposePointer(A)}if((y.buttons&wt.LEFT)===wt.LEFT&&this._lockedPointer)return;let C={pointerId:y.pointerId,clientX:y.clientX,clientY:y.clientY,deltaX:0,deltaY:0,mouseButton:w};this._activePointers.push(C),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",d),this._domElement.ownerDocument.addEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",d),this._isDragging=!0,m(y)},a=y=>{if(!this._enabled||!this._domElement||this._lockedPointer)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){let A=this._domElement.getBoundingClientRect(),D=y.clientX/A.width,M=y.clientY/A.height;if(D<this._interactiveArea.left||D>this._interactiveArea.right||M<this._interactiveArea.top||M>this._interactiveArea.bottom)return}let w=(y.buttons&wt.LEFT)===wt.LEFT?wt.LEFT:(y.buttons&wt.MIDDLE)===wt.MIDDLE?wt.MIDDLE:(y.buttons&wt.RIGHT)===wt.RIGHT?wt.RIGHT:null;if(w!==null){let A=this._findPointerByMouseButton(w);A&&this._disposePointer(A)}let C={pointerId:1,clientX:y.clientX,clientY:y.clientY,deltaX:0,deltaY:0,mouseButton:(y.buttons&wt.LEFT)===wt.LEFT?wt.LEFT:(y.buttons&wt.MIDDLE)===wt.LEFT?wt.MIDDLE:(y.buttons&wt.RIGHT)===wt.LEFT?wt.RIGHT:null};this._activePointers.push(C),this._domElement.ownerDocument.removeEventListener("mousemove",c),this._domElement.ownerDocument.removeEventListener("mouseup",h),this._domElement.ownerDocument.addEventListener("mousemove",c),this._domElement.ownerDocument.addEventListener("mouseup",h),this._isDragging=!0,m(y)},l=y=>{y.cancelable&&y.preventDefault();let w=y.pointerId,C=this._lockedPointer||this._findPointerById(w);if(C){if(C.clientX=y.clientX,C.clientY=y.clientY,C.deltaX=y.movementX,C.deltaY=y.movementY,this._state=0,y.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(y.buttons&wt.LEFT)===wt.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(y.buttons&wt.MIDDLE)===wt.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(y.buttons&wt.RIGHT)===wt.RIGHT&&(this._state=this._state|this.mouseButtons.right);g()}},c=y=>{let w=this._lockedPointer||this._findPointerById(1);w&&(w.clientX=y.clientX,w.clientY=y.clientY,w.deltaX=y.movementX,w.deltaY=y.movementY,this._state=0,(this._lockedPointer||(y.buttons&wt.LEFT)===wt.LEFT)&&(this._state=this._state|this.mouseButtons.left),(y.buttons&wt.MIDDLE)===wt.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(y.buttons&wt.RIGHT)===wt.RIGHT&&(this._state=this._state|this.mouseButtons.right),g())},d=y=>{let w=this._findPointerById(y.pointerId);if(!(w&&w===this._lockedPointer)){if(w&&this._disposePointer(w),y.pointerType==="touch")switch(this._activePointers.length){case 0:this._state=Ne.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else this._state=Ne.NONE;b()}},h=()=>{let y=this._findPointerById(1);y&&y===this._lockedPointer||(y&&this._disposePointer(y),this._state=Ne.NONE,b())},u=-1,p=y=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===Ne.NONE)return;if(this._interactiveArea.left!==0||this._interactiveArea.top!==0||this._interactiveArea.width!==1||this._interactiveArea.height!==1){let M=this._domElement.getBoundingClientRect(),I=y.clientX/M.width,O=y.clientY/M.height;if(I<this._interactiveArea.left||I>this._interactiveArea.right||O<this._interactiveArea.top||O>this._interactiveArea.bottom)return}if(y.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===Ne.ROTATE||this.mouseButtons.wheel===Ne.TRUCK){let M=performance.now();u-M<1e3&&this._getClientRect(this._elementRect),u=M}let w=yR?-1:-3,C=y.deltaMode===1?y.deltaY/w:y.deltaY/(w*10),A=this.dollyToCursor?(y.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,D=this.dollyToCursor?(y.clientY-this._elementRect.y)/this._elementRect.height*-2+1:0;switch(this.mouseButtons.wheel){case Ne.ROTATE:{this._rotateInternal(y.deltaX,y.deltaY),this._isUserControllingRotate=!0;break}case Ne.TRUCK:{this._truckInternal(y.deltaX,y.deltaY,!1),this._isUserControllingTruck=!0;break}case Ne.OFFSET:{this._truckInternal(y.deltaX,y.deltaY,!0),this._isUserControllingOffset=!0;break}case Ne.DOLLY:{this._dollyInternal(-C,A,D),this._isUserControllingDolly=!0;break}case Ne.ZOOM:{this._zoomInternal(-C,A,D),this._isUserControllingZoom=!0;break}}this.dispatchEvent({type:"control"})},f=y=>{if(!(!this._domElement||!this._enabled)){if(this.mouseButtons.right===s.ACTION.NONE){let w=y instanceof PointerEvent?y.pointerId:0,C=this._findPointerById(w);C&&this._disposePointer(C),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",d),this._domElement.ownerDocument.removeEventListener("mousemove",c),this._domElement.ownerDocument.removeEventListener("mouseup",h);return}y.preventDefault()}},m=y=>{if(this._enabled){if(Xg(this._activePointers,Rn),this._getClientRect(this._elementRect),i.copy(Rn),n.copy(Rn),this._activePointers.length>=2){let w=Rn.x-this._activePointers[1].clientX,C=Rn.y-this._activePointers[1].clientY,A=Math.sqrt(w*w+C*C);r.set(0,A);let D=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,M=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;n.set(D,M)}if(this._state=0,!y)this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);else if("pointerType"in y&&y.pointerType==="touch")switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three;break}else!this._lockedPointer&&(y.buttons&wt.LEFT)===wt.LEFT&&(this._state=this._state|this.mouseButtons.left),(y.buttons&wt.MIDDLE)===wt.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(y.buttons&wt.RIGHT)===wt.RIGHT&&(this._state=this._state|this.mouseButtons.right);((this._state&Ne.ROTATE)===Ne.ROTATE||(this._state&Ne.TOUCH_ROTATE)===Ne.TOUCH_ROTATE||(this._state&Ne.TOUCH_DOLLY_ROTATE)===Ne.TOUCH_DOLLY_ROTATE||(this._state&Ne.TOUCH_ZOOM_ROTATE)===Ne.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&Ne.TRUCK)===Ne.TRUCK||(this._state&Ne.TOUCH_TRUCK)===Ne.TOUCH_TRUCK||(this._state&Ne.TOUCH_DOLLY_TRUCK)===Ne.TOUCH_DOLLY_TRUCK||(this._state&Ne.TOUCH_ZOOM_TRUCK)===Ne.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&Ne.DOLLY)===Ne.DOLLY||(this._state&Ne.TOUCH_DOLLY)===Ne.TOUCH_DOLLY||(this._state&Ne.TOUCH_DOLLY_TRUCK)===Ne.TOUCH_DOLLY_TRUCK||(this._state&Ne.TOUCH_DOLLY_OFFSET)===Ne.TOUCH_DOLLY_OFFSET||(this._state&Ne.TOUCH_DOLLY_ROTATE)===Ne.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&Ne.ZOOM)===Ne.ZOOM||(this._state&Ne.TOUCH_ZOOM)===Ne.TOUCH_ZOOM||(this._state&Ne.TOUCH_ZOOM_TRUCK)===Ne.TOUCH_ZOOM_TRUCK||(this._state&Ne.TOUCH_ZOOM_OFFSET)===Ne.TOUCH_ZOOM_OFFSET||(this._state&Ne.TOUCH_ZOOM_ROTATE)===Ne.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&Ne.OFFSET)===Ne.OFFSET||(this._state&Ne.TOUCH_OFFSET)===Ne.TOUCH_OFFSET||(this._state&Ne.TOUCH_DOLLY_OFFSET)===Ne.TOUCH_DOLLY_OFFSET||(this._state&Ne.TOUCH_ZOOM_OFFSET)===Ne.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},g=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,Xg(this._activePointers,Rn);let y=this._domElement&&document.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,w=y?-y.deltaX:n.x-Rn.x,C=y?-y.deltaY:n.y-Rn.y;if(n.copy(Rn),((this._state&Ne.ROTATE)===Ne.ROTATE||(this._state&Ne.TOUCH_ROTATE)===Ne.TOUCH_ROTATE||(this._state&Ne.TOUCH_DOLLY_ROTATE)===Ne.TOUCH_DOLLY_ROTATE||(this._state&Ne.TOUCH_ZOOM_ROTATE)===Ne.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(w,C),this._isUserControllingRotate=!0),(this._state&Ne.DOLLY)===Ne.DOLLY||(this._state&Ne.ZOOM)===Ne.ZOOM){let A=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,D=this.dollyToCursor?(i.y-this._elementRect.y)/this._elementRect.height*-2+1:0,M=this.dollyDragInverted?-1:1;(this._state&Ne.DOLLY)===Ne.DOLLY?(this._dollyInternal(M*C*cp,A,D),this._isUserControllingDolly=!0):(this._zoomInternal(M*C*cp,A,D),this._isUserControllingZoom=!0)}if((this._state&Ne.TOUCH_DOLLY)===Ne.TOUCH_DOLLY||(this._state&Ne.TOUCH_ZOOM)===Ne.TOUCH_ZOOM||(this._state&Ne.TOUCH_DOLLY_TRUCK)===Ne.TOUCH_DOLLY_TRUCK||(this._state&Ne.TOUCH_ZOOM_TRUCK)===Ne.TOUCH_ZOOM_TRUCK||(this._state&Ne.TOUCH_DOLLY_OFFSET)===Ne.TOUCH_DOLLY_OFFSET||(this._state&Ne.TOUCH_ZOOM_OFFSET)===Ne.TOUCH_ZOOM_OFFSET||(this._state&Ne.TOUCH_DOLLY_ROTATE)===Ne.TOUCH_DOLLY_ROTATE||(this._state&Ne.TOUCH_ZOOM_ROTATE)===Ne.TOUCH_ZOOM_ROTATE){let A=Rn.x-this._activePointers[1].clientX,D=Rn.y-this._activePointers[1].clientY,M=Math.sqrt(A*A+D*D),I=r.y-M;r.set(0,M);let O=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,F=this.dollyToCursor?(n.y-this._elementRect.y)/this._elementRect.height*-2+1:0;(this._state&Ne.TOUCH_DOLLY)===Ne.TOUCH_DOLLY||(this._state&Ne.TOUCH_DOLLY_ROTATE)===Ne.TOUCH_DOLLY_ROTATE||(this._state&Ne.TOUCH_DOLLY_TRUCK)===Ne.TOUCH_DOLLY_TRUCK||(this._state&Ne.TOUCH_DOLLY_OFFSET)===Ne.TOUCH_DOLLY_OFFSET?(this._dollyInternal(I*cp,O,F),this._isUserControllingDolly=!0):(this._zoomInternal(I*cp,O,F),this._isUserControllingZoom=!0)}((this._state&Ne.TRUCK)===Ne.TRUCK||(this._state&Ne.TOUCH_TRUCK)===Ne.TOUCH_TRUCK||(this._state&Ne.TOUCH_DOLLY_TRUCK)===Ne.TOUCH_DOLLY_TRUCK||(this._state&Ne.TOUCH_ZOOM_TRUCK)===Ne.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(w,C,!1),this._isUserControllingTruck=!0),((this._state&Ne.OFFSET)===Ne.OFFSET||(this._state&Ne.TOUCH_OFFSET)===Ne.TOUCH_OFFSET||(this._state&Ne.TOUCH_DOLLY_OFFSET)===Ne.TOUCH_DOLLY_OFFSET||(this._state&Ne.TOUCH_ZOOM_OFFSET)===Ne.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(w,C,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},b=()=>{Xg(this._activePointers,Rn),n.copy(Rn),this._dragNeedsUpdate=!1,(this._activePointers.length===0||this._activePointers.length===1&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),this._activePointers.length===0&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",c),this._domElement.ownerDocument.removeEventListener("pointerup",d),this._domElement.ownerDocument.removeEventListener("mouseup",h),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{!this._enabled||!this._domElement||(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",d),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",v),this._domElement.ownerDocument.addEventListener("pointerlockerror",E),this._domElement.ownerDocument.addEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",d),m())},this.unlockPointer=()=>{this._lockedPointer!==null&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),document.exitPointerLock(),this.cancel(),this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointerlockchange",v),this._domElement.ownerDocument.removeEventListener("pointerlockerror",E))};let v=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},E=()=>{this.unlockPointer()};this._addAllEventListeners=y=>{this._domElement=y,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",o),_R&&this._domElement.addEventListener("mousedown",a),this._domElement.addEventListener("pointercancel",d),this._domElement.addEventListener("wheel",p,{passive:!1}),this._domElement.addEventListener("contextmenu",f)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",o),this._domElement.removeEventListener("mousedown",a),this._domElement.removeEventListener("pointercancel",d),this._domElement.removeEventListener("wheel",p,{passive:!1}),this._domElement.removeEventListener("contextmenu",f),this._domElement.ownerDocument.removeEventListener("pointermove",l,{passive:!1}),this._domElement.ownerDocument.removeEventListener("mousemove",c),this._domElement.ownerDocument.removeEventListener("pointerup",d),this._domElement.ownerDocument.removeEventListener("mouseup",h),this._domElement.ownerDocument.removeEventListener("pointerlockchange",v),this._domElement.ownerDocument.removeEventListener("pointerlockerror",E))},this.cancel=()=>{this._state!==Ne.NONE&&(this._state=Ne.NONE,this._activePointers.length=0,b())},t&&this.connect(t),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){this._spherical.radius===e&&this._sphericalEnd.radius===e||(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){this._spherical.theta===e&&this._sphericalEnd.theta===e||(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){this._spherical.phi===e&&this._sphericalEnd.phi===e||(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=Ps(e.width,0,1),this._interactiveArea.height=Ps(e.height,0,1),this._interactiveArea.x=Ps(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=Ps(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,i=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,i)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,i=!1){this._isUserControllingRotate=!1;let n=Ps(e,this.minAzimuthAngle,this.maxAzimuthAngle),r=Ps(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=n,this._sphericalEnd.phi=r,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);let o=!i||Jt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Jt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(o)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=Il.NONE,this._changedDolly=0,this._dollyToNoClamp(Ps(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){let i=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){let r=this._collisionTest(),o=Jt(r,this._spherical.radius);if(!(i>e)&&o)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,r)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);let n=!t||Jt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(n)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(_h).multiplyScalar(e)),t||this._target.copy(this._targetEnd);let i=!t||Jt(this._target.x,this._targetEnd.x,this.restThreshold)&&Jt(this._target.y,this._targetEnd.y,this.restThreshold)&&Jt(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=Ps(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);let i=!t||Jt(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(i)}pan(e,t,i=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,i)}truck(e,t,i=!1){this._camera.updateMatrix(),$s.setFromMatrixColumn(this._camera.matrix,0),Zs.setFromMatrixColumn(this._camera.matrix,1),$s.multiplyScalar(e),Zs.multiplyScalar(-t);let n=Tt.copy($s).add(Zs),r=Yt.copy(this._targetEnd).add(n);return this.moveTo(r.x,r.y,r.z,i)}forward(e,t=!1){Tt.setFromMatrixColumn(this._camera.matrix,0),Tt.crossVectors(this._camera.up,Tt),Tt.multiplyScalar(e);let i=Yt.copy(this._targetEnd).add(Tt);return this.moveTo(i.x,i.y,i.z,t)}elevate(e,t=!1){return Tt.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+Tt.x,this._targetEnd.y+Tt.y,this._targetEnd.z+Tt.z,t)}moveTo(e,t,i,n=!1){this._isUserControllingTruck=!1;let r=Tt.set(e,t,i).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,r,this.boundaryFriction),this._needsUpdate=!0,n||this._target.copy(this._targetEnd);let o=!n||Jt(this._target.x,this._targetEnd.x,this.restThreshold)&&Jt(this._target.y,this._targetEnd.y,this.restThreshold)&&Jt(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(o)}lookInDirectionOf(e,t,i,n=!1){let r=Tt.set(e,t,i).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius);return this.setPosition(r.x,r.y,r.z,n)}fitToBox(e,t,{cover:i=!1,paddingLeft:n=0,paddingRight:r=0,paddingBottom:o=0,paddingTop:a=0}={}){let l=[],c=e.isBox3?Ol.copy(e):Ol.setFromObject(e);c.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());let d=s1(this._sphericalEnd.theta,n1),h=s1(this._sphericalEnd.phi,n1);l.push(this.rotateTo(d,h,t));let u=Tt.setFromSpherical(this._sphericalEnd).normalize(),p=h1.setFromUnitVectors(u,$g),f=Jt(Math.abs(u.y),1);f&&p.multiply(Qg.setFromAxisAngle(hp,d)),p.multiply(this._yAxisUpSpaceInverse);let m=c1.makeEmpty();Yt.copy(c.min).applyQuaternion(p),m.expandByPoint(Yt),Yt.copy(c.min).setX(c.max.x).applyQuaternion(p),m.expandByPoint(Yt),Yt.copy(c.min).setY(c.max.y).applyQuaternion(p),m.expandByPoint(Yt),Yt.copy(c.max).setZ(c.min.z).applyQuaternion(p),m.expandByPoint(Yt),Yt.copy(c.min).setZ(c.max.z).applyQuaternion(p),m.expandByPoint(Yt),Yt.copy(c.max).setY(c.min.y).applyQuaternion(p),m.expandByPoint(Yt),Yt.copy(c.max).setX(c.min.x).applyQuaternion(p),m.expandByPoint(Yt),Yt.copy(c.max).applyQuaternion(p),m.expandByPoint(Yt),m.min.x-=n,m.min.y-=o,m.max.x+=r,m.max.y+=a,p.setFromUnitVectors($g,u),f&&p.premultiply(Qg.invert()),p.premultiply(this._yAxisUpSpace);let g=m.getSize(Tt),b=m.getCenter(Yt).applyQuaternion(p);if(ca(this._camera)){let v=this.getDistanceToFitBox(g.x,g.y,g.z,i);l.push(this.moveTo(b.x,b.y,b.z,t)),l.push(this.dollyTo(v,t)),l.push(this.setFocalOffset(0,0,0,t))}else if(ao(this._camera)){let v=this._camera,E=v.right-v.left,y=v.top-v.bottom,w=i?Math.max(E/g.x,y/g.y):Math.min(E/g.x,y/g.y);l.push(this.moveTo(b.x,b.y,b.z,t)),l.push(this.zoomTo(w,t)),l.push(this.setFocalOffset(0,0,0,t))}return Promise.all(l)}fitToSphere(e,t){let i=[],n=e instanceof gt.Sphere?Zg.copy(e):s.createBoundingSphere(e,Zg);if(i.push(this.moveTo(n.center.x,n.center.y,n.center.z,t)),ca(this._camera)){let r=this.getDistanceToFitSphere(n.radius);i.push(this.dollyTo(r,t))}else if(ao(this._camera)){let r=this._camera.right-this._camera.left,o=this._camera.top-this._camera.bottom,a=2*n.radius,l=Math.min(r/a,o/a);i.push(this.zoomTo(l,t))}return i.push(this.setFocalOffset(0,0,0,t)),Promise.all(i)}setLookAt(e,t,i,n,r,o,a=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Il.NONE,this._changedDolly=0;let l=Yt.set(n,r,o),c=Tt.set(e,t,i);this._targetEnd.copy(l),this._sphericalEnd.setFromVector3(c.sub(l).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,a||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let d=!a||Jt(this._target.x,this._targetEnd.x,this.restThreshold)&&Jt(this._target.y,this._targetEnd.y,this.restThreshold)&&Jt(this._target.z,this._targetEnd.z,this.restThreshold)&&Jt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Jt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Jt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(d)}lerpLookAt(e,t,i,n,r,o,a,l,c,d,h,u,p,f=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=Il.NONE,this._changedDolly=0;let m=Tt.set(n,r,o),g=Yt.set(e,t,i);es.setFromVector3(g.sub(m).applyQuaternion(this._yAxisUpSpace));let b=Pl.set(d,h,u),v=Yt.set(a,l,c);wh.setFromVector3(v.sub(b).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(m.lerp(b,p));let E=wh.theta-es.theta,y=wh.phi-es.phi,w=wh.radius-es.radius;this._sphericalEnd.set(es.radius+w*p,es.phi+y*p,es.theta+E*p),this.normalizeRotations(),this._needsUpdate=!0,f||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let C=!f||Jt(this._target.x,this._targetEnd.x,this.restThreshold)&&Jt(this._target.y,this._targetEnd.y,this.restThreshold)&&Jt(this._target.z,this._targetEnd.z,this.restThreshold)&&Jt(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&Jt(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&Jt(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(C)}setPosition(e,t,i,n=!1){return this.setLookAt(e,t,i,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,n)}setTarget(e,t,i,n=!1){let r=this.getPosition(Tt),o=this.setLookAt(r.x,r.y,r.z,e,t,i,n);return this._sphericalEnd.phi=Ps(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),o}setFocalOffset(e,t,i,n=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,i),this._needsUpdate=!0,n||this._focalOffset.copy(this._focalOffsetEnd);let r=!n||Jt(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&Jt(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&Jt(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}setOrbitPoint(e,t,i){this._camera.updateMatrixWorld(),$s.setFromMatrixColumn(this._camera.matrixWorldInverse,0),Zs.setFromMatrixColumn(this._camera.matrixWorldInverse,1),ha.setFromMatrixColumn(this._camera.matrixWorldInverse,2);let n=Tt.set(e,t,i),r=n.distanceTo(this._camera.position),o=n.sub(this._camera.position);$s.multiplyScalar(o.x),Zs.multiplyScalar(o.y),ha.multiplyScalar(o.z),Tt.copy($s).add(Zs).add(ha),Tt.z=Tt.z+r,this.dollyTo(r,!1),this.setFocalOffset(-Tt.x,Tt.y,-Tt.z,!1),this.moveTo(e,t,i,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,t,i,n){if(e===null){this._viewport=null;return}this._viewport=this._viewport||new gt.Vector4,typeof e=="number"?this._viewport.set(e,t,i,n):this._viewport.copy(e)}getDistanceToFitBox(e,t,i,n=!1){if(Kg(this._camera,"getDistanceToFitBox"))return this._spherical.radius;let r=e/t,o=this._camera.getEffectiveFOV()*bh,a=this._camera.aspect;return((n?r>a:r<a)?t:e/a)*.5/Math.tan(o*.5)+i*.5}getDistanceToFitSphere(e){if(Kg(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;let t=this._camera.getEffectiveFOV()*bh,i=Math.atan(Math.tan(t*.5)*this._camera.aspect)*2,n=1<this._camera.aspect?t:i;return e/Math.sin(n*.5)}getTarget(e,t=!0){return(e&&e.isVector3?e:new gt.Vector3).copy(t?this._targetEnd:this._target)}getPosition(e,t=!0){return(e&&e.isVector3?e:new gt.Vector3).setFromSpherical(t?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(t?this._targetEnd:this._target)}getSpherical(e,t=!0){return(e&&e instanceof gt.Spherical?e:new gt.Spherical).copy(t?this._sphericalEnd:this._spherical)}getFocalOffset(e,t=!0){return(e&&e.isVector3?e:new gt.Vector3).copy(t?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%Tl,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=Tl),this._spherical.theta+=Tl*Math.round((this._sphericalEnd.theta-this._spherical.theta)/Tl)}reset(e=!1){if(!Jt(this._camera.up.x,this._cameraUp0.x)||!Jt(this._camera.up.y,this._cameraUp0.y)||!Jt(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);let i=this.getPosition(Tt);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}let t=[this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)];return Promise.all(t)}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,hp),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){let e=Tt.subVectors(this._target,this._camera.position).normalize(),t=Yt.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();let i=this.getPosition(Tt);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}update(e){let t=this._sphericalEnd.theta-this._spherical.theta,i=this._sphericalEnd.phi-this._spherical.phi,n=this._sphericalEnd.radius-this._spherical.radius,r=a1.subVectors(this._targetEnd,this._target),o=l1.subVectors(this._focalOffsetEnd,this._focalOffset),a=this._zoomEnd-this._zoom;if(hi(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{let d=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=lp(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,d,1/0,e),this._needsUpdate=!0}if(hi(i))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{let d=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=lp(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,d,1/0,e),this._needsUpdate=!0}if(hi(n))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{let d=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=lp(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,d,this.maxSpeed,e),this._needsUpdate=!0}if(hi(r.x)&&hi(r.y)&&hi(r.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{let d=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;r1(this._target,this._targetEnd,this._targetVelocity,d,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(hi(o.x)&&hi(o.y)&&hi(o.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{let d=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;r1(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,d,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(hi(a))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{let d=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=lp(this._zoom,this._zoomEnd,this._zoomVelocity,d,1/0,e)}if(this.dollyToCursor){if(ca(this._camera)&&this._changedDolly!==0){let d=this._spherical.radius-this._lastDistance,h=this._camera,u=this._getCameraDirection(_h),p=Tt.copy(u).cross(h.up).normalize();p.lengthSq()===0&&(p.x=1);let f=Yt.crossVectors(p,u),m=this._sphericalEnd.radius*Math.tan(h.getEffectiveFOV()*bh*.5),g=(this._sphericalEnd.radius-d-this._sphericalEnd.radius)/this._sphericalEnd.radius,b=Pl.copy(this._targetEnd).add(p.multiplyScalar(this._dollyControlCoord.x*m*h.aspect)).add(f.multiplyScalar(this._dollyControlCoord.y*m)),v=Tt.copy(this._targetEnd).lerp(b,g),E=this._lastDollyDirection===Il.IN&&this._spherical.radius<=this.minDistance,y=this._lastDollyDirection===Il.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(E||y)){this._sphericalEnd.radius-=d,this._spherical.radius-=d;let C=Yt.copy(u).multiplyScalar(-d);v.add(C)}this._boundary.clampPoint(v,v);let w=Yt.subVectors(v,this._targetEnd);this._targetEnd.copy(v),this._target.add(w),this._changedDolly-=d,hi(this._changedDolly)&&(this._changedDolly=0)}else if(ao(this._camera)&&this._changedZoom!==0){let d=this._zoom-this._lastZoom,h=this._camera,u=Tt.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(h.near+h.far)/(h.near-h.far)).unproject(h),p=Yt.set(0,0,-1).applyQuaternion(h.quaternion),f=Pl.copy(u).add(p.multiplyScalar(-u.dot(h.up))),m=-(this._zoom-d-this._zoom)/this._zoom,g=this._getCameraDirection(_h),b=this._targetEnd.dot(g),v=Tt.copy(this._targetEnd).lerp(f,m),E=v.dot(g),y=g.multiplyScalar(E-b);v.sub(y),this._boundary.clampPoint(v,v);let w=Yt.subVectors(v,this._targetEnd);this._targetEnd.copy(v),this._target.add(w),this._changedZoom-=d,hi(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;let l=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,l),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),(!hi(this._focalOffset.x)||!hi(this._focalOffset.y)||!hi(this._focalOffset.z))&&(this._camera.updateMatrixWorld(),$s.setFromMatrixColumn(this._camera.matrix,0),Zs.setFromMatrixColumn(this._camera.matrix,1),ha.setFromMatrixColumn(this._camera.matrix,2),$s.multiplyScalar(this._focalOffset.x),Zs.multiplyScalar(-this._focalOffset.y),ha.multiplyScalar(this._focalOffset.z),Tt.copy($s).add(Zs).add(ha),this._camera.position.add(Tt)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),Tt.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);let c=this._needsUpdate;return c&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):c?(this.dispatchEvent({type:"update"}),hi(t,this.restThreshold)&&hi(i,this.restThreshold)&&hi(n,this.restThreshold)&&hi(r.x,this.restThreshold)&&hi(r.y,this.restThreshold)&&hi(r.z,this.restThreshold)&&hi(o.x,this.restThreshold)&&hi(o.y,this.restThreshold)&&hi(o.z,this.restThreshold)&&hi(a,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!c&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=c,this._needsUpdate=!1,c}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:vh(this.maxDistance),minZoom:this.minZoom,maxZoom:vh(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:vh(this.maxPolarAngle),minAzimuthAngle:vh(this.minAzimuthAngle),maxAzimuthAngle:vh(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:Tt.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){let i=JSON.parse(e);this.enabled=i.enabled,this.minDistance=i.minDistance,this.maxDistance=yh(i.maxDistance),this.minZoom=i.minZoom,this.maxZoom=yh(i.maxZoom),this.minPolarAngle=i.minPolarAngle,this.maxPolarAngle=yh(i.maxPolarAngle),this.minAzimuthAngle=yh(i.minAzimuthAngle),this.maxAzimuthAngle=yh(i.maxAzimuthAngle),this.smoothTime=i.smoothTime,this.draggingSmoothTime=i.draggingSmoothTime,this.dollySpeed=i.dollySpeed,this.truckSpeed=i.truckSpeed,this.dollyToCursor=i.dollyToCursor,this.verticalDragToForward=i.verticalDragToForward,this._target0.fromArray(i.target0),this._position0.fromArray(i.position0),this._zoom0=i.zoom0,this._focalOffset0.fromArray(i.focalOffset0),this.moveTo(i.target[0],i.target[1],i.target[2],t),es.setFromVector3(Tt.fromArray(i.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(es.theta,es.phi,t),this.dollyTo(es.radius,t),this.zoomTo(i.zoom,t),this.setFocalOffset(i.focalOffset[0],i.focalOffset[1],i.focalOffset[2],t),this._needsUpdate=!0}connect(e){if(this._domElement){console.warn("camera-controls is already connected.");return}e.setAttribute("data-camera-controls-version",vR),this._addAllEventListeners(e),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,i){let n=t.lengthSq();if(n===0)return e;let r=Yt.copy(t).add(e),o=this._boundary.clampPoint(r,Pl).sub(r),a=o.lengthSq();if(a===0)return e.add(t);if(a===n)return e;if(i===0)return e.add(t).add(o);{let l=1+i*a/t.dot(o);return e.add(Yt.copy(t).multiplyScalar(l)).add(o.multiplyScalar(1-i))}}_updateNearPlaneCorners(){if(ca(this._camera)){let e=this._camera,t=e.near,i=e.getEffectiveFOV()*bh,n=Math.tan(i*.5)*t,r=n*e.aspect;this._nearPlaneCorners[0].set(-r,-n,0),this._nearPlaneCorners[1].set(r,-n,0),this._nearPlaneCorners[2].set(r,n,0),this._nearPlaneCorners[3].set(-r,n,0)}else if(ao(this._camera)){let e=this._camera,t=1/e.zoom,i=e.left*t,n=e.right*t,r=e.top*t,o=e.bottom*t;this._nearPlaneCorners[0].set(i,r,0),this._nearPlaneCorners[1].set(n,r,0),this._nearPlaneCorners[2].set(n,o,0),this._nearPlaneCorners[3].set(i,o,0)}}_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||Kg(this._camera,"_collisionTest"))return e;let t=this._getTargetDirection(_h);Jg.lookAt(o1,t,this._camera.up);for(let i=0;i<4;i++){let n=Yt.copy(this._nearPlaneCorners[i]);n.applyMatrix4(Jg);let r=Pl.addVectors(this._target,n);dp.set(r,t),dp.far=this._spherical.radius+1;let o=dp.intersectObjects(this.colliderMeshes);o.length!==0&&o[0].distance<e&&(e=o[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;let t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{let i=()=>{this.removeEventListener("rest",i),t()};this.addEventListener("rest",i)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,t=new gt.Sphere){let i=t,n=i.center;Ol.makeEmpty(),e.traverseVisible(o=>{o.isMesh&&Ol.expandByObject(o)}),Ol.getCenter(n);let r=0;return e.traverseVisible(o=>{if(!o.isMesh)return;let a=o,l=a.geometry.clone();l.applyMatrix4(a.matrixWorld);let c=l.attributes.position;for(let d=0,h=c.count;d<h;d++)Tt.fromBufferAttribute(c,d),r=Math.max(r,n.distanceToSquared(Tt))}),i.radius=Math.sqrt(r),i}},Dh=class s extends f0{constructor(e){super(e),q(this,"onBeforeUpdate",new Oe),q(this,"onAfterUpdate",new Oe),q(this,"onAspectUpdated",new Oe),q(this,"onDisposed",new Oe),q(this,"three"),q(this,"_allControls",new Map),q(this,"updateAspect",()=>{var t;if(!(!this.currentWorld||!this.currentWorld.renderer)){if(this.three instanceof Ys){this.onAspectUpdated.trigger();return}if((t=this.currentWorld.renderer)!=null&&t.isResizeable()){let i=this.currentWorld.renderer.getSize();this.three.aspect=i.width/i.height,this.three.updateProjectionMatrix(),this.onAspectUpdated.trigger()}}}),this.three=this.setupCamera(),this.setupEvents(!0),this.onWorldChanged.add(({action:t,world:i})=>{if(t==="added"){let n=this.newCameraControls();this._allControls.set(i.uuid,n)}if(t==="removed"){let n=this._allControls.get(i.uuid);n&&(n.dispose(),this._allControls.delete(i.uuid))}})}get controls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");let e=this._allControls.get(this.currentWorld.uuid);if(!e)throw new Error("Controls not found!");return e}get enabled(){return this.currentWorld===null?!1:this.controls.enabled}set enabled(e){this.currentWorld!==null&&(this.controls.enabled=e)}dispose(){this.setupEvents(!1),this.onAspectUpdated.reset(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.three.removeFromParent(),this.onDisposed.trigger(),this.onDisposed.reset();for(let[e,t]of this._allControls)t.dispose()}update(e){this.enabled&&(this.onBeforeUpdate.trigger(this),this.controls.update(e),this.onAfterUpdate.trigger(this))}setupCamera(){let e=window.innerWidth/window.innerHeight,t=new eo(60,e,1,1e3);return t.position.set(50,50,50),t.lookAt(new ce(0,0,0)),t}newCameraControls(){if(!this.currentWorld)throw new Error("This camera needs a world to work!");if(!this.currentWorld.renderer)throw new Error("This camera needs a renderer to work!");xn.install({THREE:s.getSubsetOfThree()});let{domElement:e}=this.currentWorld.renderer.three,t=new xn(this.three,e);return t.smoothTime=.2,t.dollyToCursor=!0,t.infinityDolly=!0,t.minDistance=6,t}setupEvents(e){e?window.addEventListener("resize",this.updateAspect):window.removeEventListener("resize",this.updateAspect)}static getSubsetOfThree(){return{MOUSE:Rw,Vector2:Bt,Vector3:ce,Vector4:Hs,Quaternion:On,Matrix4:lt,Spherical:Jw,Box3:Qt,Sphere:Qn,Raycaster:no,MathUtils:_r}}},Y1=class q1 extends At{constructor(e){super(e),q(this,"onAfterUpdate",new Oe),q(this,"onBeforeUpdate",new Oe),q(this,"onDisposed",new Oe),q(this,"onWorldCreated",new Oe),q(this,"onWorldDeleted",new Oe),q(this,"list",new Map),q(this,"enabled",!0),e.add(q1.uuid,this)}create(){let e=new C0(this.components),t=e.uuid;if(this.list.has(t))throw new Error("There is already a world with this name!");return this.list.set(t,e),this.onWorldCreated.trigger(e),e}delete(e){if(!this.list.has(e.uuid))throw new Error("The provided world is not found in the list!");let t=e.uuid;this.list.delete(e.uuid),e.dispose(),this.onWorldDeleted.trigger(t)}dispose(){this.enabled=!1;for(let[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}update(e){if(this.enabled)for(let[t,i]of this.list)i.update(e)}};q(Y1,"uuid","fdb61dc4-2ec1-4966-b83d-54ea795fad4a");var wR=Y1;function ER(s,e,t,i){return new Promise((n,r)=>{function o(){let a=s.clientWaitSync(e,t,0);if(a===s.WAIT_FAILED){r();return}if(a===s.TIMEOUT_EXPIRED){setTimeout(o,i);return}n()}o()})}function CR(s,e,t,i,n,r,o){return ie(this,null,function*(){let a=s.fenceSync(s.SYNC_GPU_COMMANDS_COMPLETE,0);s.flush(),yield ER(s,a,0,10),s.deleteSync(a),s.bindBuffer(e,t),s.getBufferSubData(e,i,n,r,o),s.bindBuffer(e,null)})}function xR(s,e,t,i,n,r,o,a){return ie(this,null,function*(){let l=s.createBuffer();return s.bindBuffer(s.PIXEL_PACK_BUFFER,l),s.bufferData(s.PIXEL_PACK_BUFFER,a.byteLength,s.STREAM_READ),s.readPixels(e,t,i,n,r,o,0),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),yield CR(s,s.PIXEL_PACK_BUFFER,l,0,a),s.deleteBuffer(l),a})}var Rp=class{constructor(e,t,i){if(q(this,"onDisposed",new Oe),q(this,"onViewUpdated",new ga),q(this,"enabled",!0),q(this,"needsUpdate",!1),q(this,"renderDebugFrame",!1),q(this,"components"),q(this,"world"),q(this,"renderer"),q(this,"autoUpdate",!0),q(this,"updateInterval",1e3),q(this,"worker"),q(this,"scene",new to),q(this,"_width",512),q(this,"_height",512),q(this,"_availableColor",1),q(this,"renderTarget"),q(this,"bufferSize"),q(this,"_buffer"),q(this,"_isWorkerBusy",!1),q(this,"updateVisibility",o=>ie(this,null,function*(){if(!this.enabled||!this.needsUpdate&&!o||this._isWorkerBusy)return;this._isWorkerBusy=!0;let a=this.world.camera.three;a.updateMatrix(),this.renderer.setSize(this._width,this._height),this.renderer.setRenderTarget(this.renderTarget),this.renderer.render(this.scene,a);let l=this.renderer.getContext();yield xR(l,0,0,this._width,this._height,l.RGBA,l.UNSIGNED_BYTE,this._buffer),this.renderer.setRenderTarget(null),this.renderDebugFrame&&this.renderer.render(this.scene,a),this.worker.postMessage({buffer:this._buffer}),this.needsUpdate=!1})),!t.renderer)throw new Error("The given world must have a renderer!");this.components=e,this.applySettings(i),this.world=t,this.renderer=new sh,this.renderTarget=new Ss(this._width,this._height),this.bufferSize=this._width*this._height*4,this._buffer=new Uint8Array(this.bufferSize),this.renderer.clippingPlanes=t.renderer.clippingPlanes;let n=`
      addEventListener("message", (event) => {
        const { buffer } = event.data;
        const colors = new Map();
        for (let i = 0; i < buffer.length; i += 4) {
          const r = buffer[i];
          const g = buffer[i + 1];
          const b = buffer[i + 2];
          const code = "" + r + "-" + g + "-" + b;
          if(colors.has(code)) {
            colors.set(code, colors.get(code) + 1);
          } else {
            colors.set(code, 1);
          }
        }
        postMessage({ colors });
      });
    `,r=new Blob([n],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(r))}dispose(){this.enabled=!1;for(let e of this.scene.children)e.removeFromParent();this.onViewUpdated.reset(),this.worker.terminate(),this.renderer.forceContextLoss(),this.renderer.dispose(),this.renderTarget.dispose(),this._buffer=null,this.onDisposed.reset()}getAvailableColor(){let e=BigInt(this._availableColor.toString()),t=[];do t.unshift(Number(e%256n)),e/=256n;while(e);for(;t.length!==3;)t.unshift(0);let[i,n,r]=t,o=`${i}-${n}-${r}`;return{r:i,g:n,b:r,code:o}}increaseColor(){if(this._availableColor===256*256*256){console.warn("Color can't be increased over 256 x 256 x 256!");return}this._availableColor++}decreaseColor(){if(this._availableColor===1){console.warn("Color can't be decreased under 0!");return}this._availableColor--}applySettings(e){e&&(e.updateInterval!==void 0&&(this.updateInterval=e.updateInterval),e.height!==void 0&&(this._height=e.height),e.width!==void 0&&(this._width=e.width),e.autoUpdate!==void 0&&(this.autoUpdate=e.autoUpdate))}},A0=class extends Rp{constructor(e,t,i){super(e,t,i),q(this,"onViewUpdated",new Oe),q(this,"threshold",100),q(this,"colorMeshes",new Map),q(this,"isProcessing",!1),q(this,"_colorCodeMeshMap",new Map),q(this,"_meshIDColorCodeMap",new Map),q(this,"_currentVisibleMeshes",new Set),q(this,"_recentlyHiddenMeshes",new Set),q(this,"_intervalID",null),q(this,"_transparentMat",new Ii({transparent:!0,opacity:0})),q(this,"handleWorkerMessage",n=>ie(this,null,function*(){if(this.isProcessing)return;let r=n.data.colors;this._recentlyHiddenMeshes=new Set(this._currentVisibleMeshes),this._currentVisibleMeshes.clear();for(let[o,a]of r){if(a<this.threshold)continue;let l=this._colorCodeMeshMap.get(o);l&&(this._currentVisibleMeshes.add(l),this._recentlyHiddenMeshes.delete(l))}this.onViewUpdated.trigger({seen:this._currentVisibleMeshes,unseen:this._recentlyHiddenMeshes}),this._isWorkerBusy=!1})),this.worker.addEventListener("message",this.handleWorkerMessage),this.autoUpdate&&window.setInterval(()=>ie(this,null,function*(){this.isProcessing||(yield this.updateVisibility())}),this.updateInterval),this.onViewUpdated.add(({seen:n,unseen:r})=>{for(let o of n)o.visible=!0;for(let o of r)o.visible=!1})}dispose(){super.dispose(),this._intervalID!==null&&(window.clearInterval(this._intervalID),this._intervalID=null),this._currentVisibleMeshes.clear(),this._recentlyHiddenMeshes.clear(),this._meshIDColorCodeMap.clear(),this._transparentMat.dispose(),this._colorCodeMeshMap.clear();let e=this.components.get(nr);for(let t in this.colorMeshes){let i=this.colorMeshes.get(t);i&&e.destroy(i,!0)}this.colorMeshes.clear()}add(e){if(!this.enabled)return;if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;let t=e instanceof Jn,{geometry:i,material:n}=e,{colorMaterial:r,code:o}=this.getAvailableMaterial(),a;if(Array.isArray(n)){let d=!0,h=[];for(let u of n)Mp.isTransparent(u)?h.push(this._transparentMat):(d=!1,h.push(r));if(d){r.dispose(),this.isProcessing=!1;return}a=h}else if(Mp.isTransparent(n)){r.dispose(),this.isProcessing=!1;return}else a=r;this._colorCodeMeshMap.set(o,e),this._meshIDColorCodeMap.set(e.uuid,o);let l=t?e.count:1,c=new Jn(i,a,l);t?c.instanceMatrix=e.instanceMatrix:c.setMatrixAt(0,new lt),e.visible=!1,e.updateWorldMatrix(!0,!1),c.applyMatrix4(e.matrixWorld),c.updateMatrix(),this.scene.add(c),this.colorMeshes.set(e.uuid,c),this.increaseColor(),this.isProcessing=!1}remove(e){if(this.isProcessing){console.log("Culler processing not finished yet.");return}this.isProcessing=!0;let t=this.components.get(nr);this._currentVisibleMeshes.delete(e),this._recentlyHiddenMeshes.delete(e);let i=this.colorMeshes.get(e.uuid),n=this._meshIDColorCodeMap.get(e.uuid);if(!i||!n){this.isProcessing=!1;return}this._colorCodeMeshMap.delete(n),this._meshIDColorCodeMap.delete(e.uuid),this.colorMeshes.delete(e.uuid),i.geometry=void 0,i.material=[],t.destroy(i,!0),this._recentlyHiddenMeshes.delete(e),this._currentVisibleMeshes.delete(e),this.isProcessing=!1}updateInstanced(e){for(let t of e){let i=this.colorMeshes.get(t.uuid);i&&(i.count=t.count)}}getAvailableMaterial(){let{r:e,g:t,b:i,code:n}=this.getAvailableColor(),r=js.enabled;js.enabled=!1;let o=new zt(`rgb(${e}, ${t}, ${i})`);if(!this.world.renderer)throw new Error("Renderer not found in the world!");let a=this.world.renderer.clippingPlanes,l=new Ii({color:o,clippingPlanes:a,side:ea});return js.enabled=r,{colorMaterial:l,code:n}}},X1=class I0 extends At{constructor(e){super(e),q(this,"onDisposed",new Oe),q(this,"_enabled",!0),q(this,"list",new Map),e.add(I0.uuid,this)}get enabled(){return this._enabled}set enabled(e){this._enabled=e;for(let[t,i]of this.list)i.enabled=e}create(e,t){if(this.list.has(e.uuid))return this.list.get(e.uuid);let i=new A0(this.components,e,t);return this.list.set(e.uuid,i),i}delete(e){let t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){this.enabled=!1,this.onDisposed.trigger(I0.uuid),this.onDisposed.reset();for(let[e,t]of this.list)t.dispose();this.list.clear()}updateInstanced(e){for(let[,t]of this.list)t.updateInstanced(e)}};q(X1,"uuid","69f2a50d-c266-44fc-b1bd-fa4d34be89e6");var SR=X1,T0=class{constructor(e){q(this,"_event"),q(this,"_position",new Bt),q(this,"onDisposed",new Oe),q(this,"updateMouseInfo",t=>{this._event=t}),this.dom=e,this.setupEvents(!0)}get position(){if(this._event){let e=this.dom.getBoundingClientRect();this._position.x=this.getPositionX(e,this._event),this._position.y=this.getPositionY(e,this._event)}return this._position}dispose(){this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset()}getPositionY(e,t){return-((t.clientY-e.top)/(e.bottom-e.top))*2+1}getPositionX(e,t){return(t.clientX-e.left)/(e.right-e.left)*2-1}setupEvents(e){e?this.dom.addEventListener("pointermove",this.updateMouseInfo):this.dom.removeEventListener("pointermove",this.updateMouseInfo)}},P0=class{constructor(e,t){q(this,"enabled",!0),q(this,"components"),q(this,"onDisposed",new Oe),q(this,"mouse"),q(this,"three",new no),q(this,"world");let i=t.renderer;if(!i)throw new Error("A renderer is needed for the raycaster to work!");this.world=t,this.mouse=new T0(i.three.domElement),this.components=e}dispose(){this.mouse.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}castRay(e=Array.from(this.world.meshes)){if(!this.world)throw new Error("A world is needed to cast rays!");let t=this.world.camera.three;return this.three.setFromCamera(this.mouse.position,t),this.intersect(e)}castRayFromVector(e,t,i=Array.from(this.world.meshes)){return this.three.set(e,t),this.intersect(i)}intersect(e=Array.from(this.world.meshes)){let t=this.three.intersectObjects(e),i=this.filterClippingPlanes(t);return i.length>0?i[0]:null}filterClippingPlanes(e){if(!this.world.renderer)throw new Error("Renderer not found!");let t=this.world.renderer.three;if(!t.clippingPlanes)return e;let i=t.clippingPlanes;return e.length<=0||!i||i?.length<=0?e:e.filter(n=>i.every(r=>r.distanceToPoint(n.point)>0))}},K1=class $1 extends At{constructor(e){super(e),q(this,"enabled",!0),q(this,"list",new Map),q(this,"onDisposed",new Oe),e.add($1.uuid,this)}get(e){if(this.list.has(e.uuid))return this.list.get(e.uuid);let t=new P0(this.components,e);return this.list.set(e.uuid,t),e.onDisposed.add(()=>{this.delete(e)}),t}delete(e){let t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){for(let[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}};q(K1,"uuid","d5d8bdf0-db25-4952-b951-b643af207ace");var rs=K1,O0=class{constructor(e,t,i){q(this,"onDisposed",new Oe),q(this,"world"),q(this,"components"),q(this,"three"),q(this,"_fade",3),q(this,"updateZoom",()=>{this.world.camera instanceof Dh&&(this.material.uniforms.uZoom.value=this.world.camera.three.zoom)}),this.world=t;let{color:n,size1:r,size2:o,distance:a}=i;this.components=e;let l=new hl(2,2,1,1),c=new Ni({side:ea,uniforms:{uSize1:{value:r},uSize2:{value:o},uColor:{value:n},uDistance:{value:a},uFade:{value:this._fade},uZoom:{value:1}},transparent:!0,vertexShader:`
            
            varying vec3 worldPosition;
            
            uniform float uDistance;
            
            void main() {
            
                    vec3 pos = position.xzy * uDistance;
                    pos.xz += cameraPosition.xz;
                    
                    worldPosition = pos;
                    
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
            
            }
            `,fragmentShader:`
            
            varying vec3 worldPosition;
            
            uniform float uZoom;
            uniform float uFade;
            uniform float uSize1;
            uniform float uSize2;
            uniform vec3 uColor;
            uniform float uDistance;
                
                
                
                float getGrid(float size) {
                
                    vec2 r = worldPosition.xz / size;
                    
                    
                    vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
                    float line = min(grid.x, grid.y);
                    
                
                    return 1.0 - min(line, 1.0);
                }
                
            void main() {
            
                    
                    float d = 1.0 - min(distance(cameraPosition.xz, worldPosition.xz) / uDistance, 1.0);
                    
                    float g1 = getGrid(uSize1);
                    float g2 = getGrid(uSize2);
                    
                    // Ortho camera fades the grid away when zooming out
                    float minZoom = step(0.2, uZoom);
                    float zoomFactor = pow(min(uZoom, 1.), 2.) * minZoom;
                    
                    gl_FragColor = vec4(uColor.rgb, mix(g2, g1, g1) * pow(d, uFade));
                    gl_FragColor.a = mix(0.5 * gl_FragColor.a, gl_FragColor.a, g2) * zoomFactor;
                    
                    if ( gl_FragColor.a <= 0.0 ) discard;
                    
            
            }
            
            `,extensions:{derivatives:!0}});this.three=new $e(l,c),this.three.frustumCulled=!1,t.scene.three.add(this.three),this.setupEvents(!0)}get visible(){return this.three.visible}set visible(e){e?this.world.scene.three.add(this.three):this.three.removeFromParent()}get material(){return this.three.material}get fade(){return this._fade===3}set fade(e){this._fade=e?3:0,this.material.uniforms.uFade.value=this._fade}dispose(){this.setupEvents(!1),this.components.get(nr).destroy(this.three),this.onDisposed.trigger(),this.onDisposed.reset(),this.world=null,this.components=null}setupEvents(e){if(this.world.isDisposing||!(this.world.camera instanceof Dh))return;let t=this.world.camera.controls;e?t.addEventListener("update",this.updateZoom):t.removeEventListener("update",this.updateZoom)}},AR=class Z1 extends At{constructor(e){super(e),q(this,"list",new Map),q(this,"config",{color:new zt(12303291),size1:1,size2:10,distance:500}),q(this,"onDisposed",new Oe),q(this,"enabled",!0),e.add(Z1.uuid,this)}create(e){if(this.list.has(e.uuid))throw new Error("This world already has a grid!");let t=new O0(this.components,e,this.config);return this.list.set(e.uuid,t),e.onDisposed.add(()=>{this.delete(e)}),t}delete(e){let t=this.list.get(e.uuid);t&&t.dispose(),this.list.delete(e.uuid)}dispose(){for(let[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}};q(AR,"uuid","d1e814d5-b81c-4452-87a2-f039375e0489");var da=new no,bn=new ce,oo=new ce,bi=new On,d1={X:new ce(1,0,0),Y:new ce(0,1,0),Z:new ce(0,0,1)},e0={type:"change"},u1={type:"mouseDown"},p1={type:"mouseUp",mode:null},f1={type:"objectChange"},M0=class extends Gs{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";let i=new R0;this._gizmo=i,this.add(i);let n=new D0;this._plane=n,this.add(n);let r=this;function o(v,E){let y=E;Object.defineProperty(r,v,{get:function(){return y!==void 0?y:E},set:function(w){y!==w&&(y=w,n[v]=w,i[v]=w,r.dispatchEvent({type:v+"-changed",value:w}),r.dispatchEvent(e0))}}),r[v]=E,n[v]=E,i[v]=E}o("camera",e),o("object",void 0),o("enabled",!0),o("axis",null),o("mode","translate"),o("translationSnap",null),o("rotationSnap",null),o("scaleSnap",null),o("space","world"),o("size",1),o("dragging",!1),o("showX",!0),o("showY",!0),o("showZ",!0);let a=new ce,l=new ce,c=new On,d=new On,h=new ce,u=new On,p=new ce,f=new ce,m=new ce,g=0,b=new ce;o("worldPosition",a),o("worldPositionStart",l),o("worldQuaternion",c),o("worldQuaternionStart",d),o("cameraPosition",h),o("cameraQuaternion",u),o("pointStart",p),o("pointEnd",f),o("rotationAxis",m),o("rotationAngle",g),o("eye",b),this._offset=new ce,this._startNorm=new ce,this._endNorm=new ce,this._cameraScale=new ce,this._parentPosition=new ce,this._parentQuaternion=new On,this._parentQuaternionInv=new On,this._parentScale=new ce,this._worldScaleStart=new ce,this._worldQuaternionInv=new On,this._worldScale=new ce,this._positionStart=new ce,this._quaternionStart=new On,this._scaleStart=new ce,this._getPointer=IR.bind(this),this._onPointerDown=PR.bind(this),this._onPointerHover=TR.bind(this),this._onPointerMove=OR.bind(this),this._onPointerUp=MR.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;da.setFromCamera(e,this.camera);let t=t0(this._gizmo.picker[this.mode],da);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e.button!==0)&&this.axis!==null){da.setFromCamera(e,this.camera);let t=t0(this._plane,da,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,u1.mode=this.mode,this.dispatchEvent(u1)}}pointerMove(e){let t=this.axis,i=this.mode,n=this.object,r=this.space;if(i==="scale"?r="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(r="world"),n===void 0||t===null||this.dragging===!1||e.button!==-1)return;da.setFromCamera(e,this.camera);let o=t0(this._plane,da,!0);if(o){if(this.pointEnd.copy(o.point).sub(this.worldPositionStart),i==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),r==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),r==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(r==="local"&&(n.position.applyQuaternion(bi.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),r==="world"&&(n.parent&&n.position.add(bn.setFromMatrixPosition(n.parent.matrixWorld)),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(bn.setFromMatrixPosition(n.parent.matrixWorld))));else if(i==="scale"){if(t.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),oo.set(a,a,a)}else bn.copy(this.pointStart),oo.copy(this.pointEnd),bn.applyQuaternion(this._worldQuaternionInv),oo.applyQuaternion(this._worldQuaternionInv),oo.divide(bn),t.search("X")===-1&&(oo.x=1),t.search("Y")===-1&&(oo.y=1),t.search("Z")===-1&&(oo.z=1);n.scale.copy(this._scaleStart).multiply(oo),this.scaleSnap&&(t.search("X")!==-1&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(i==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);let a=20/this.worldPosition.distanceTo(bn.setFromMatrixPosition(this.camera.matrixWorld)),l=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(bn.copy(this.rotationAxis).cross(this.eye))*a):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(d1[t]),bn.copy(d1[t]),r==="local"&&bn.applyQuaternion(this.worldQuaternion),bn.cross(this.eye),bn.length()===0?l=!0:this.rotationAngle=this._offset.dot(bn.normalize())*a),(t==="E"||l)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),r==="local"&&t!=="E"&&t!=="XYZE"?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(bi.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(bi.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(e0),this.dispatchEvent(f1)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(p1.mode=this.mode,this.dispatchEvent(p1)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(e0),this.dispatchEvent(f1),this.pointStart.copy(this.pointEnd))}getRaycaster(){return da}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}};function IR(s){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:s.button};{let e=this.domElement.getBoundingClientRect();return{x:(s.clientX-e.left)/e.width*2-1,y:-(s.clientY-e.top)/e.height*2+1,button:s.button}}}function TR(s){if(this.enabled)switch(s.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(s));break}}function PR(s){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(s.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(s)),this.pointerDown(this._getPointer(s)))}function OR(s){this.enabled&&this.pointerMove(this._getPointer(s))}function MR(s){this.enabled&&(this.domElement.releasePointerCapture(s.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(s)))}function t0(s,e,t){let i=e.intersectObject(s,!0);for(let n=0;n<i.length;n++)if(i[n].object.visible||t)return i[n];return!1}var up=new Pu,li=new ce(0,1,0),m1=new ce(0,0,0),g1=new lt,pp=new On,xp=new On,Qs=new ce,b1=new lt,Ah=new ce(1,0,0),pa=new ce(0,1,0),Ih=new ce(0,0,1),fp=new ce,Eh=new ce,Ch=new ce,R0=class extends Gs{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";let e=new Ii({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new Mn({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=e.clone();i.opacity=.15;let n=t.clone();n.opacity=.5;let r=e.clone();r.color.setHex(16711680);let o=e.clone();o.color.setHex(65280);let a=e.clone();a.color.setHex(255);let l=e.clone();l.color.setHex(16711680),l.opacity=.5;let c=e.clone();c.color.setHex(65280),c.opacity=.5;let d=e.clone();d.color.setHex(255),d.opacity=.5;let h=e.clone();h.opacity=.25;let u=e.clone();u.color.setHex(16776960),u.opacity=.25,e.clone().color.setHex(16776960);let p=e.clone();p.color.setHex(7895160);let f=new Ji(0,.04,.1,12);f.translate(0,.05,0);let m=new ki(.08,.08,.08);m.translate(0,.04,0);let g=new kt;g.setAttribute("position",new Er([0,0,0,1,0,0],3));let b=new Ji(.0075,.0075,.5,3);b.translate(0,.25,0);function v(x,N){let z=new dl(x,.0075,3,64,N*Math.PI*2);return z.rotateY(Math.PI/2),z.rotateX(Math.PI/2),z}function E(){let x=new kt;return x.setAttribute("position",new Er([0,0,0,1,1,1],3)),x}let y={X:[[new $e(f,r),[.5,0,0],[0,0,-Math.PI/2]],[new $e(f,r),[-.5,0,0],[0,0,Math.PI/2]],[new $e(b,r),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new $e(f,o),[0,.5,0]],[new $e(f,o),[0,-.5,0],[Math.PI,0,0]],[new $e(b,o)]],Z:[[new $e(f,a),[0,0,.5],[Math.PI/2,0,0]],[new $e(f,a),[0,0,-.5],[-Math.PI/2,0,0]],[new $e(b,a),null,[Math.PI/2,0,0]]],XYZ:[[new $e(new rh(.1,0),h.clone()),[0,0,0]]],XY:[[new $e(new ki(.15,.15,.01),d.clone()),[.15,.15,0]]],YZ:[[new $e(new ki(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new $e(new ki(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},w={X:[[new $e(new Ji(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new $e(new Ji(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new $e(new Ji(.2,0,.6,4),i),[0,.3,0]],[new $e(new Ji(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new $e(new Ji(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new $e(new Ji(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new $e(new rh(.2,0),i)]],XY:[[new $e(new ki(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new $e(new ki(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new $e(new ki(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]]},C={START:[[new $e(new rh(.01,2),n),null,null,null,"helper"]],END:[[new $e(new rh(.01,2),n),null,null,null,"helper"]],DELTA:[[new _i(E(),n),null,null,null,"helper"]],X:[[new _i(g,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new _i(g,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new _i(g,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},A={XYZE:[[new $e(v(.5,1),p),null,[0,Math.PI/2,0]]],X:[[new $e(v(.5,.5),r)]],Y:[[new $e(v(.5,.5),o),null,[0,0,-Math.PI/2]]],Z:[[new $e(v(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new $e(v(.75,1),u),null,[0,Math.PI/2,0]]]},D={AXIS:[[new _i(g,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},M={XYZE:[[new $e(new Mu(.25,10,8),i)]],X:[[new $e(new dl(.5,.1,4,24),i),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new $e(new dl(.5,.1,4,24),i),[0,0,0],[Math.PI/2,0,0]]],Z:[[new $e(new dl(.5,.1,4,24),i),[0,0,0],[0,0,-Math.PI/2]]],E:[[new $e(new dl(.75,.1,2,24),i)]]},I={X:[[new $e(m,r),[.5,0,0],[0,0,-Math.PI/2]],[new $e(b,r),[0,0,0],[0,0,-Math.PI/2]],[new $e(m,r),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new $e(m,o),[0,.5,0]],[new $e(b,o)],[new $e(m,o),[0,-.5,0],[0,0,Math.PI]]],Z:[[new $e(m,a),[0,0,.5],[Math.PI/2,0,0]],[new $e(b,a),[0,0,0],[Math.PI/2,0,0]],[new $e(m,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new $e(new ki(.15,.15,.01),d),[.15,.15,0]]],YZ:[[new $e(new ki(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new $e(new ki(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new $e(new ki(.1,.1,.1),h.clone())]]},O={X:[[new $e(new Ji(.2,0,.6,4),i),[.3,0,0],[0,0,-Math.PI/2]],[new $e(new Ji(.2,0,.6,4),i),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new $e(new Ji(.2,0,.6,4),i),[0,.3,0]],[new $e(new Ji(.2,0,.6,4),i),[0,-.3,0],[0,0,Math.PI]]],Z:[[new $e(new Ji(.2,0,.6,4),i),[0,0,.3],[Math.PI/2,0,0]],[new $e(new Ji(.2,0,.6,4),i),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new $e(new ki(.2,.2,.01),i),[.15,.15,0]]],YZ:[[new $e(new ki(.2,.2,.01),i),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new $e(new ki(.2,.2,.01),i),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new $e(new ki(.2,.2,.2),i),[0,0,0]]]},F={X:[[new _i(g,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new _i(g,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new _i(g,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function V(x){let N=new Gs;for(let z in x)for(let G=x[z].length;G--;){let X=x[z][G][0].clone(),k=x[z][G][1],B=x[z][G][2],R=x[z][G][3],j=x[z][G][4];X.name=z,X.tag=j,k&&X.position.set(k[0],k[1],k[2]),B&&X.rotation.set(B[0],B[1],B[2]),R&&X.scale.set(R[0],R[1],R[2]),X.updateMatrix();let $=X.geometry.clone();$.applyMatrix4(X.matrix),X.geometry=$,X.renderOrder=1/0,X.position.set(0,0,0),X.rotation.set(0,0,0),X.scale.set(1,1,1),N.add(X)}return N}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=V(y)),this.add(this.gizmo.rotate=V(A)),this.add(this.gizmo.scale=V(I)),this.add(this.picker.translate=V(w)),this.add(this.picker.rotate=V(M)),this.add(this.picker.scale=V(O)),this.add(this.helper.translate=V(C)),this.add(this.helper.rotate=V(D)),this.add(this.helper.scale=V(F)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){let t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:xp;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let n=0;n<i.length;n++){let r=i[n];r.visible=!0,r.rotation.set(0,0,0),r.position.copy(this.worldPosition);let o;if(this.camera.isOrthographicCamera?o=(this.camera.top-this.camera.bottom)/this.camera.zoom:o=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),r.scale.set(1,1,1).multiplyScalar(o*this.size/4),r.tag==="helper"){r.visible=!1,r.name==="AXIS"?(r.visible=!!this.axis,this.axis==="X"&&(bi.setFromEuler(up.set(0,0,0)),r.quaternion.copy(t).multiply(bi),Math.abs(li.copy(Ah).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Y"&&(bi.setFromEuler(up.set(0,0,Math.PI/2)),r.quaternion.copy(t).multiply(bi),Math.abs(li.copy(pa).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Z"&&(bi.setFromEuler(up.set(0,Math.PI/2,0)),r.quaternion.copy(t).multiply(bi),Math.abs(li.copy(Ih).applyQuaternion(t).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="XYZE"&&(bi.setFromEuler(up.set(0,Math.PI/2,0)),li.copy(this.rotationAxis),r.quaternion.setFromRotationMatrix(g1.lookAt(m1,li,pa)),r.quaternion.multiply(bi),r.visible=this.dragging),this.axis==="E"&&(r.visible=!1)):r.name==="START"?(r.position.copy(this.worldPositionStart),r.visible=this.dragging):r.name==="END"?(r.position.copy(this.worldPosition),r.visible=this.dragging):r.name==="DELTA"?(r.position.copy(this.worldPositionStart),r.quaternion.copy(this.worldQuaternionStart),bn.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),bn.applyQuaternion(this.worldQuaternionStart.clone().invert()),r.scale.copy(bn),r.visible=this.dragging):(r.quaternion.copy(t),this.dragging?r.position.copy(this.worldPositionStart):r.position.copy(this.worldPosition),this.axis&&(r.visible=this.axis.search(r.name)!==-1));continue}r.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(r.name==="X"&&Math.abs(li.copy(Ah).applyQuaternion(t).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="Y"&&Math.abs(li.copy(pa).applyQuaternion(t).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="Z"&&Math.abs(li.copy(Ih).applyQuaternion(t).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XY"&&Math.abs(li.copy(Ih).applyQuaternion(t).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="YZ"&&Math.abs(li.copy(Ah).applyQuaternion(t).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XZ"&&Math.abs(li.copy(pa).applyQuaternion(t).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1)):this.mode==="rotate"&&(pp.copy(t),li.copy(this.eye).applyQuaternion(bi.copy(t).invert()),r.name.search("E")!==-1&&r.quaternion.setFromRotationMatrix(g1.lookAt(this.eye,m1,pa)),r.name==="X"&&(bi.setFromAxisAngle(Ah,Math.atan2(-li.y,li.z)),bi.multiplyQuaternions(pp,bi),r.quaternion.copy(bi)),r.name==="Y"&&(bi.setFromAxisAngle(pa,Math.atan2(li.x,li.z)),bi.multiplyQuaternions(pp,bi),r.quaternion.copy(bi)),r.name==="Z"&&(bi.setFromAxisAngle(Ih,Math.atan2(li.y,li.x)),bi.multiplyQuaternions(pp,bi),r.quaternion.copy(bi))),r.visible=r.visible&&(r.name.indexOf("X")===-1||this.showX),r.visible=r.visible&&(r.name.indexOf("Y")===-1||this.showY),r.visible=r.visible&&(r.name.indexOf("Z")===-1||this.showZ),r.visible=r.visible&&(r.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),r.material._color=r.material._color||r.material.color.clone(),r.material._opacity=r.material._opacity||r.material.opacity,r.material.color.copy(r.material._color),r.material.opacity=r.material._opacity,this.enabled&&this.axis&&(r.name===this.axis||this.axis.split("").some(function(a){return r.name===a}))&&(r.material.color.setHex(16776960),r.material.opacity=1)}super.updateMatrixWorld(e)}},D0=class extends $e{constructor(){super(new hl(1e5,1e5,2,2),new Ii({visible:!1,wireframe:!0,side:ea,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),fp.copy(Ah).applyQuaternion(t==="local"?this.worldQuaternion:xp),Eh.copy(pa).applyQuaternion(t==="local"?this.worldQuaternion:xp),Ch.copy(Ih).applyQuaternion(t==="local"?this.worldQuaternion:xp),li.copy(Eh),this.mode){case"translate":case"scale":switch(this.axis){case"X":li.copy(this.eye).cross(fp),Qs.copy(fp).cross(li);break;case"Y":li.copy(this.eye).cross(Eh),Qs.copy(Eh).cross(li);break;case"Z":li.copy(this.eye).cross(Ch),Qs.copy(Ch).cross(li);break;case"XY":Qs.copy(Ch);break;case"YZ":Qs.copy(fp);break;case"XZ":li.copy(Ch),Qs.copy(Eh);break;case"XYZ":case"E":Qs.set(0,0,0);break}break;case"rotate":default:Qs.set(0,0,0)}Qs.length()===0?this.quaternion.copy(this.cameraQuaternion):(b1.lookAt(bn.set(0,0,0),Qs,li),this.quaternion.setFromRotationMatrix(b1)),super.updateMatrixWorld(e)}},Dp=class s{constructor(e,t,i,n,r,o=5,a=!0){if(q(this,"onDraggingStarted",new Oe),q(this,"onDraggingEnded",new Oe),q(this,"onDisposed",new Oe),q(this,"normal"),q(this,"origin"),q(this,"three",new Ws),q(this,"components"),q(this,"world"),q(this,"type","default"),q(this,"_helper"),q(this,"_visible",!0),q(this,"_enabled",!0),q(this,"_controlsActive",!1),q(this,"_arrowBoundBox",new $e),q(this,"_planeMesh"),q(this,"_controls"),q(this,"_hiddenMaterial",new Ii({visible:!1})),q(this,"update",()=>{this._enabled&&this.three.setFromNormalAndCoplanarPoint(this.normal,this._helper.position)}),q(this,"changeDrag",l=>{this._visible=!l.value,this.preventCameraMovement(),this.notifyDraggingChanged(l)}),this.components=e,this.world=t,!t.renderer)throw new Error("The given world must have a renderer!");this.normal=n,this.origin=i,t.renderer.setPlane(!0,this.three),this._planeMesh=s.newPlaneMesh(o,r),this._helper=this.newHelper(),this._controls=this.newTransformControls(),this.three.setFromNormalAndCoplanarPoint(n,i),a&&this.toggleControls(!0)}get enabled(){return this._enabled}set enabled(e){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");this._enabled=e,this.world.renderer.setPlane(e,this.three)}get visible(){return this._visible}set visible(e){this._visible=e,this._controls.visible=e,this._helper.visible=e,this.toggleControls(e)}get meshes(){return[this._planeMesh,this._arrowBoundBox]}get planeMaterial(){return this._planeMesh.material}set planeMaterial(e){this._planeMesh.material=e}get size(){return this._planeMesh.scale.x}set size(e){this._planeMesh.scale.set(e,e,e)}get helper(){return this._helper}setFromNormalAndCoplanarPoint(e,t){this.reset(),this.normal.equals(e)||(this.normal.copy(e),this._helper.lookAt(e)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix(),this.update()}dispose(){this._enabled=!1,this.onDraggingStarted.reset(),this.onDraggingEnded.reset(),this._helper.removeFromParent(),this.world.renderer&&this.world.renderer.setPlane(!1,this.three),this._arrowBoundBox.removeFromParent(),this._arrowBoundBox.geometry.dispose(),this._planeMesh.geometry.dispose(),this._controls.removeFromParent(),this._controls.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}reset(){let e=new ce(1,0,0),t=new ce;this.normal.equals(e)||(this.normal.copy(e),this._helper.lookAt(e)),this.origin.copy(t),this._helper.position.copy(t),this._helper.updateMatrix()}toggleControls(e){if(e){if(this._controlsActive)return;this._controls.addEventListener("change",this.update),this._controls.addEventListener("dragging-changed",this.changeDrag)}else this._controls.removeEventListener("change",this.update),this._controls.removeEventListener("dragging-changed",this.changeDrag);this._controlsActive=e}newTransformControls(){if(!this.world.renderer)throw new Error("No renderer found for clipping plane!");let e=this.world.camera.three,t=this.world.renderer.three.domElement,i=new M0(e,t);return this.initializeControls(i),this.world.scene.three.add(i),i}initializeControls(e){e.attach(this._helper),e.showX=!1,e.showY=!1,e.setSpace("local"),this.createArrowBoundingBox(),e.children[0].children[0].add(this._arrowBoundBox)}createArrowBoundingBox(){this._arrowBoundBox.geometry=new Ji(.18,.18,1.2),this._arrowBoundBox.material=this._hiddenMaterial,this._arrowBoundBox.rotateX(Math.PI/2),this._arrowBoundBox.updateMatrix(),this._arrowBoundBox.geometry.applyMatrix4(this._arrowBoundBox.matrix)}notifyDraggingChanged(e){e.value?this.onDraggingStarted.trigger():this.onDraggingEnded.trigger()}preventCameraMovement(){this.world.camera.enabled=this._visible}newHelper(){let e=new Gs;return e.lookAt(this.normal),e.position.copy(this.origin),this._planeMesh.position.z+=.01,e.add(this._planeMesh),this.world.scene.three.add(e),e}static newPlaneMesh(e,t){let i=new hl(1),n=new $e(i,t);return n.scale.set(e,e,e),n}},Q1=class L0 extends At{constructor(e){super(e),q(this,"onBeforeDrag",new Oe),q(this,"onAfterDrag",new Oe),q(this,"onBeforeCreate",new Oe),q(this,"onBeforeCancel",new Oe),q(this,"onAfterCancel",new Oe),q(this,"onBeforeDelete",new Oe),q(this,"onAfterCreate",new Oe),q(this,"onAfterDelete",new Oe),q(this,"onDisposed",new Oe),q(this,"orthogonalY",!1),q(this,"toleranceOrthogonalY",.7),q(this,"Type",Dp),q(this,"list",[]),q(this,"_material",new Ii({color:12255487,side:ea,transparent:!0,opacity:.2})),q(this,"_size",5),q(this,"_enabled",!1),q(this,"_visible",!0),q(this,"_onStartDragging",()=>{this.onBeforeDrag.trigger()}),q(this,"_onEndDragging",()=>{this.onAfterDrag.trigger()}),this.components.add(L0.uuid,this)}get enabled(){return this._enabled}set enabled(e){this._enabled=e;for(let t of this.list)t.enabled=e;this.updateMaterialsAndPlanes()}get visible(){return this._visible}set visible(e){this._visible=e;for(let t of this.list)t.visible=e}get material(){return this._material}set material(e){this._material=e;for(let t of this.list)t.planeMaterial=e}get size(){return this._size}set size(e){this._size=e;for(let t of this.list)t.size=e}dispose(){this._enabled=!1;for(let e of this.list)e.dispose();this.list.length=0,this._material.dispose(),this.onBeforeCreate.reset(),this.onBeforeCancel.reset(),this.onBeforeDelete.reset(),this.onBeforeDrag.reset(),this.onAfterCreate.reset(),this.onAfterCancel.reset(),this.onAfterDelete.reset(),this.onAfterDrag.reset(),this.onDisposed.trigger(L0.uuid),this.onDisposed.reset()}create(e){let t=this.components.get(rs).get(e).castRay();return t?this.createPlaneFromIntersection(e,t):null}createFromNormalAndCoplanarPoint(e,t,i){let n=this.newPlane(e,i,t);return this.updateMaterialsAndPlanes(),n}delete(e,t){t||(t=this.pickPlane(e)),t&&this.deletePlane(t)}deleteAll(e){let t=[...this.list];for(let i of t)if(!e||e.has(i.type)){this.delete(i.world,i);let n=this.list.indexOf(i);n!==-1&&this.list.splice(n,1)}}deletePlane(e){let t=this.list.indexOf(e);if(t!==-1){if(this.list.splice(t,1),!e.world.renderer)throw new Error("Renderer not found for this plane's world!");e.world.renderer.setPlane(!1,e.three),e.dispose(),this.updateMaterialsAndPlanes(),this.onAfterDelete.trigger(e)}}pickPlane(e){let t=this.components.get(rs).get(e),i=this.getAllPlaneMeshes(),n=t.castRay(i);if(n){let r=n.object;return this.list.find(o=>o.meshes.includes(r))}}getAllPlaneMeshes(){let e=[];for(let t of this.list)e.push(...t.meshes);return e}createPlaneFromIntersection(e,t){var i;if(!e.renderer)throw new Error("The given world must have a renderer!");let n=t.point.distanceTo(new ce(0,0,0)),r=(i=t.face)==null?void 0:i.normal;if(!n||!r)return null;let o=this.getWorldNormal(t,r),a=this.newPlane(e,t.point,o.negate());return a.visible=this._visible,a.size=this._size,e.renderer.setPlane(!0,a.three),this.updateMaterialsAndPlanes(),a}getWorldNormal(e,t){let i=e.object,n=e.object.matrixWorld.clone();if(i instanceof Jn&&e.instanceId!==void 0){let a=new lt;i.getMatrixAt(e.instanceId,a),n=a.multiply(n)}let r=new Jr().getNormalMatrix(n),o=t.clone().applyMatrix3(r).normalize();return this.normalizePlaneDirectionY(o),o}normalizePlaneDirectionY(e){this.orthogonalY&&(e.y>this.toleranceOrthogonalY&&(e.x=0,e.y=1,e.z=0),e.y<-this.toleranceOrthogonalY&&(e.x=0,e.y=-1,e.z=0))}newPlane(e,t,i){let n=new this.Type(this.components,e,t,i,this._material);return n.onDraggingStarted.add(this._onStartDragging),n.onDraggingEnded.add(this._onEndDragging),this.list.push(n),this.onAfterCreate.trigger(n),n}updateMaterialsAndPlanes(){let e=this.components.get(wR);for(let[t,i]of e.list){if(!i.renderer)continue;i.renderer.updateClippingPlanes();let{clippingPlanes:n}=i.renderer;for(let r of i.meshes)if(r.material)if(Array.isArray(r.material))for(let o of r.material)o.clippingPlanes=n;else r.material.clippingPlanes=n}}};q(Q1,"uuid","66290bc5-18c4-4cd1-9379-2e17a0617611");var Bl=Q1,F0=class{constructor(e){q(this,"enabled",!1),q(this,"id","FirstPerson"),this.camera=e}set(e){if(this.enabled=e,e){if(this.camera.projection.current!=="Perspective"){this.camera.set("Orbit");return}this.setupFirstPersonCamera()}}setupFirstPersonCamera(){let e=this.camera.controls,t=new ce;e.distance--,e.getPosition(t),e.minDistance=1,e.maxDistance=1,e.distance=1,e.moveTo(t.x,t.y,t.z),e.truckSpeed=50,e.mouseButtons.wheel=xn.ACTION.DOLLY,e.touches.two=xn.ACTION.TOUCH_ZOOM_TRUCK}},k0=class{constructor(e){q(this,"enabled",!0),q(this,"id","Orbit"),this.camera=e,this.activateOrbitControls()}set(e){this.enabled=e,e&&this.activateOrbitControls()}activateOrbitControls(){let e=this.camera.controls;e.minDistance=1,e.maxDistance=300;let t=new ce;e.getPosition(t);let i=t.length();e.distance=i,e.truckSpeed=2;let{rotation:n}=this.camera.three,r=new ce(0,0,-1).applyEuler(n),o=t.addScaledVector(r,i);e.moveTo(o.x,o.y,o.z)}},N0=class{constructor(e){q(this,"enabled",!1),q(this,"id","Plan"),q(this,"mouseAction1"),q(this,"mouseAction2"),q(this,"mouseInitialized",!1),q(this,"defaultAzimuthSpeed"),q(this,"defaultPolarSpeed"),this.camera=e,this.defaultAzimuthSpeed=e.controls.azimuthRotateSpeed,this.defaultPolarSpeed=e.controls.polarRotateSpeed}set(e){this.enabled=e;let t=this.camera.controls;t.azimuthRotateSpeed=e?0:this.defaultAzimuthSpeed,t.polarRotateSpeed=e?0:this.defaultPolarSpeed,this.mouseInitialized||(this.mouseAction1=t.touches.one,this.mouseAction2=t.touches.two,this.mouseInitialized=!0),e?(t.mouseButtons.left=xn.ACTION.TRUCK,t.touches.one=xn.ACTION.TOUCH_TRUCK,t.touches.two=xn.ACTION.TOUCH_ZOOM):(t.mouseButtons.left=xn.ACTION.ROTATE,t.touches.one=this.mouseAction1,t.touches.two=this.mouseAction2)}},U0=class{constructor(e){q(this,"onChanged",new Oe),q(this,"current","Perspective"),q(this,"camera"),q(this,"matchOrthoDistanceEnabled",!1),q(this,"_component"),q(this,"_previousDistance",-1),this._component=e,this.camera=e.three}set(e){return ie(this,null,function*(){this.current!==e&&(e==="Orthographic"?this.setOrthoCamera():yield this.setPerspectiveCamera(),this.onChanged.trigger(this.camera))})}toggle(){return ie(this,null,function*(){let e=this.current==="Perspective"?"Orthographic":"Perspective";yield this.set(e)})}setOrthoCamera(){if(this._component.mode===null||this._component.mode.id==="FirstPerson")return;this._previousDistance=this._component.controls.distance,this._component.controls.distance=200;let e=this.getPerspectiveDims();if(!e)return;let{width:t,height:i}=e;this.setupOrthoCamera(i,t),this.camera=this._component.threeOrtho,this.current="Orthographic"}getPerspectiveDims(){let e=this._component.currentWorld;if(!e||!e.renderer)return null;let t=new ce;this._component.threePersp.getWorldDirection(t);let i=new ce;this._component.controls.getTarget(i);let n=i.clone().sub(this._component.threePersp.position).dot(t),r=e.renderer.getSize(),o=r.x/r.y,a=this._component.threePersp,l=n*2*Math.atan(a.fov*(Math.PI/180)/2);return{width:l*o,height:l}}setupOrthoCamera(e,t){this._component.controls.mouseButtons.wheel=xn.ACTION.ZOOM,this._component.controls.mouseButtons.middle=xn.ACTION.ZOOM;let i=this._component.threePersp,n=this._component.threeOrtho;n.zoom=1,n.left=t/-2,n.right=t/2,n.top=e/2,n.bottom=e/-2,n.updateProjectionMatrix(),n.position.copy(i.position),n.quaternion.copy(i.quaternion),this._component.controls.camera=n}getDistance(){let e=this._component.threePersp,t=this._component.threeOrtho;return(t.top-t.bottom)/t.zoom/(2*Math.atan(e.fov*(Math.PI/180)/2))}setPerspectiveCamera(){return ie(this,null,function*(){this._component.controls.mouseButtons.wheel=xn.ACTION.DOLLY,this._component.controls.mouseButtons.middle=xn.ACTION.DOLLY;let e=this._component.threePersp,t=this._component.threeOrtho;e.position.copy(t.position),e.quaternion.copy(t.quaternion),this._component.controls.mouseButtons.wheel=xn.ACTION.DOLLY,this.matchOrthoDistanceEnabled?this._component.controls.distance=this.getDistance():this._component.controls.distance=this._previousDistance,yield this._component.controls.zoomTo(1),e.updateProjectionMatrix(),this._component.controls.camera=e,this.camera=e,this.current="Perspective"})}},B0=class extends Dh{constructor(e){super(e),q(this,"projection"),q(this,"threeOrtho"),q(this,"threePersp"),q(this,"_userInputButtons",{}),q(this,"_frustumSize",50),q(this,"_navigationModes",new Map),q(this,"_mode",null),q(this,"previousSize",null),this.threePersp=this.three,this.threeOrtho=this.newOrthoCamera(),this.projection=new U0(this),this.onAspectUpdated.add(()=>{this.setOrthoPerspCameraAspect()}),this.projection.onChanged.add(t=>{this.three=t,this.updateAspect()}),this.onWorldChanged.add(({action:t})=>{t==="added"&&(this._navigationModes.clear(),this._navigationModes.set("Orbit",new k0(this)),this._navigationModes.set("FirstPerson",new F0(this)),this._navigationModes.set("Plan",new N0(this)),this._mode=this._navigationModes.get("Orbit"),this.mode.set(!0,{preventTargetAdjustment:!0}),this.currentWorld&&this.currentWorld.renderer&&(this.previousSize=this.currentWorld.renderer.getSize().clone()))})}get mode(){if(!this._mode)throw new Error("Mode not found, camera not initialized");return this._mode}dispose(){super.dispose(),this.threeOrtho.removeFromParent()}set(e){if(this.mode!==null&&this.mode.id!==e){if(this.mode.set(!1),!this._navigationModes.has(e))throw new Error("The specified mode does not exist!");this._mode=this._navigationModes.get(e),this.mode.set(!0)}}fit(e,t=1.5){return ie(this,null,function*(){if(!this.enabled)return;let i=Number.MAX_VALUE,n=Number.MIN_VALUE,r=new ce(i,i,i),o=new ce(n,n,n);for(let u of e){let p=new Qt().setFromObject(u);p.min.x<r.x&&(r.x=p.min.x),p.min.y<r.y&&(r.y=p.min.y),p.min.z<r.z&&(r.z=p.min.z),p.max.x>o.x&&(o.x=p.max.x),p.max.y>o.y&&(o.y=p.max.y),p.max.z>o.z&&(o.z=p.max.z)}let a=new Qt(r,o),l=new ce;a.getSize(l);let c=new ce;a.getCenter(c);let d=Math.max(l.x,l.y,l.z)*t,h=new Qn(c,d);yield this.controls.fitToSphere(h,!0)})}setUserInput(e){e?this.enableUserInput():this.disableUserInput()}disableUserInput(){this._userInputButtons.left=this.controls.mouseButtons.left,this._userInputButtons.right=this.controls.mouseButtons.right,this._userInputButtons.middle=this.controls.mouseButtons.middle,this._userInputButtons.wheel=this.controls.mouseButtons.wheel,this.controls.mouseButtons.left=0,this.controls.mouseButtons.right=0,this.controls.mouseButtons.middle=0,this.controls.mouseButtons.wheel=0}enableUserInput(){Object.keys(this._userInputButtons).length!==0&&(this.controls.mouseButtons.left=this._userInputButtons.left,this.controls.mouseButtons.right=this._userInputButtons.right,this.controls.mouseButtons.middle=this._userInputButtons.middle,this.controls.mouseButtons.wheel=this._userInputButtons.wheel)}newOrthoCamera(){let e=window.innerWidth/window.innerHeight;return new Ys(this._frustumSize*e/-2,this._frustumSize*e/2,this._frustumSize/2,this._frustumSize/-2,.1,1e3)}setOrthoPerspCameraAspect(){if(!this.currentWorld||!this.currentWorld.renderer||!this.previousSize)return;let e=this.currentWorld.renderer.getSize(),t=this.threeOrtho.top,i=this.threeOrtho.right,n=e.y/this.previousSize.y,r=e.x/this.previousSize.x,o=t*n,a=i*r;this.threeOrtho.left=-a,this.threeOrtho.right=a,this.threeOrtho.top=o,this.threeOrtho.bottom=-o,this.threeOrtho.updateProjectionMatrix(),this.previousSize.copy(e)}},RR=new Map([[Uu,{forRelated:"Decomposes",forRelating:"IsDecomposedBy"}],[Sg,{forRelated:"HasAssociations",forRelating:"AssociatedTo"}],[Ag,{forRelated:"HasAssociations",forRelating:"ClassificationForObjects"}],[Tg,{forRelated:"HasAssignments",forRelating:"IsGroupedBy"}],[zu,{forRelated:"IsDefinedBy",forRelating:"DefinesOcurrence"}],[Cg,{forRelated:"IsTypedBy",forRelating:"Types"}],[yg,{forRelated:"IsDefinedBy",forRelating:"Defines"}],[Vu,{forRelated:"ContainedInStructure",forRelating:"ContainsElements"}],[Eg,{forRelated:"AssignedToFlowElement",forRelating:"HasControlElements"}],[xg,{forRelated:"ConnectedFrom",forRelating:"ConnectedTo"}],[Ig,{forRelated:"HasAssignments",forRelating:"ReferencedBy"}],[_g,{forRelated:"HasContext",forRelating:"Declares"}],[Pg,{forRelated:"HasAssignments",forRelating:"Controls"}],[wg,{forRelated:"Nests",forRelating:"IsNestedBy"}]]),J1=class z0 extends At{constructor(e){super(e),q(this,"onDisposed",new Oe),q(this,"onRelationsIndexed",new Oe),q(this,"relationMaps",{}),q(this,"enabled",!0),q(this,"_relToAttributesMap",RR),q(this,"_inverseAttributes",["IsDecomposedBy","Decomposes","AssociatedTo","HasAssociations","ClassificationForObjects","IsGroupedBy","HasAssignments","IsDefinedBy","DefinesOcurrence","IsTypedBy","Types","Defines","ContainedInStructure","ContainsElements","HasControlElements","AssignedToFlowElement","ConnectedTo","ConnectedFrom","ReferencedBy","Declares","HasContext","Controls","IsNestedBy","Nests"]),q(this,"_ifcRels",[Uu,Sg,Ag,Tg,zu,Cg,yg,Vu,Eg,xg,Ig,_g,Pg,wg]),q(this,"onFragmentsDisposed",t=>{delete this.relationMaps[t.groupID]}),this.components.add(z0.uuid,this),e.get(Rt).onFragmentsDisposed.add(this.onFragmentsDisposed)}indexRelations(e,t,i,n){let r=Object.keys(t).find(h=>h.startsWith("Relating")),o=Object.keys(t).find(h=>h.startsWith("Related"));if(!(r&&o))return;let a=t[r].value,l=t[o].map(h=>h.value),c=e.get(a)??new Map,d=this.getAttributeIndex(n);d!==null&&(c.set(d,l),e.set(a,c));for(let h of l){let u=e.get(h)??new Map,p=this.getAttributeIndex(i);if(!p)continue;let f=u.get(p)??[];f.push(a),u.set(p,f),e.set(h,u)}}getAttributeIndex(e){let t=this._inverseAttributes.indexOf(e);return t===-1?null:t}setRelationMap(e,t){this.relationMaps[e.uuid]=t,this.onRelationsIndexed.trigger({modelID:e.uuid,relationsMap:t})}process(e){return ie(this,null,function*(){if(!e.hasProperties)throw new Error("FragmentsGroup properties not found");let t=this.relationMaps[e.uuid];if(t)return t;t=new Map;for(let i of this._ifcRels){let n=yield e.getAllPropertiesOfType(i);if(!n)continue;let r=this._relToAttributesMap.get(i);if(!r)continue;let{forRelated:o,forRelating:a}=r;for(let l in n){let c=n[l];this.indexRelations(t,c,o,a)}}return this.setRelationMap(e,t),t})}processFromWebIfc(e,t){return ie(this,null,function*(){let i=new Map;for(let n of this._ifcRels){let r=this._relToAttributesMap.get(n);if(!r)continue;let{forRelated:o,forRelating:a}=r,l=e.GetLineIDsWithType(t,n);for(let c=0;c<l.size();c++){let d=yield e.properties.getItemProperties(t,l.get(c));this.indexRelations(i,d,o,a)}}return this.onRelationsIndexed.trigger({modelID:t.toString(),relationsMap:i}),i})}getEntityRelations(e,t,i){let n=this.relationMaps[e.uuid];if(!n)throw new Error(`IfcRelationsIndexer: model ${e.uuid} has no relations indexed.`);let r=n.get(t),o=this.getAttributeIndex(i);return r===void 0||o===null?null:r.get(o)||null}serializeRelations(e){let t={};for(let[i,n]of e.entries()){t[i]||(t[i]={});for(let[r,o]of n.entries())t[i][r]=o}return JSON.stringify(t)}serializeModelRelations(e){let t=this.relationMaps[e.uuid];return t?this.serializeRelations(t):null}serializeAllRelations(){let e={};for(let t in this.relationMaps){let i=this.relationMaps[t],n={};for(let[r,o]of i.entries()){n[r]||(n[r]={});for(let[a,l]of o.entries())n[r][a]=l}e[t]=n}return JSON.stringify(e)}getRelationsMapFromJSON(e){let t=JSON.parse(e),i=new Map;for(let n in t){let r=t[n],o=new Map;for(let a in r)o.set(Number(a),r[a]);i.set(Number(n),o)}return i}dispose(){this.relationMaps={},this.components.get(Rt).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(z0.uuid),this.onDisposed.reset()}getEntitiesWithRelation(e,t,i){let n=this.relationMaps[e.uuid];if(!n)throw new Error("IfcRelationsIndexer: the model relations are not indexed!");let r=new Set;for(let[o,a]of n){let l=this.getAttributeIndex(t);if(l===null)throw new Error("IfcRelationsIndexer: invalid inverse attribute name");let c=a.get(l);c&&c.includes(i)&&r.add(o)}return r}addEntityRelations(e,t,i,...n){let r=this.getEntityRelations(e,t,i);if(r)r.push(...n);else{let o=this.getAttributeIndex(i);if(!o)throw new Error(`IfcRelationsIndexer: ${i} is not a valid relation name.`);let a=this.relationMaps[e.uuid].get(t);a?.set(o,n)}}getEntityChildren(e,t,i=new Set){if(i.add(t),this.relationMaps[e.uuid]===void 0)throw new Error("The provided model has no indices. You have to generate them first.");let n=this.getEntityRelations(e,t,"IsDecomposedBy");if(n)for(let o of n)this.getEntityChildren(e,o,i);let r=this.getEntityRelations(e,t,"ContainsElements");if(r)for(let o of r)this.getEntityChildren(e,o,i);return i}};q(J1,"uuid","23a889ab-83b3-44a4-8bee-ead83438370b");var jh=J1,eC=class tC extends At{constructor(e){super(e),q(this,"onDisposed",new Oe),q(this,"onFragmentsLoaded",new Oe),q(this,"onFragmentsDisposed",new Oe),q(this,"list",new fo),q(this,"groups",new fo),q(this,"baseCoordinationModel",""),q(this,"baseCoordinationMatrix",new lt),q(this,"enabled",!0),q(this,"_loader",new ku),this.components.add(tC.uuid,this)}get meshes(){let e=[];for(let[t,i]of this.list)e.push(i.mesh);return e}dispose(){for(let[e,t]of this.groups)t.dispose(!0);this.baseCoordinationModel="",this.groups.clear(),this.list.clear(),this.onFragmentsLoaded.reset(),this.onFragmentsDisposed.reset(),this.onDisposed.trigger(),this.onDisposed.reset()}disposeGroup(e){let{uuid:t}=e,i=[];for(let n of e.items)i.push(n.id),this.list.delete(n.id);e.dispose(!0),this.groups.delete(e.uuid),this.groups.size===0&&(this.baseCoordinationModel="",this.baseCoordinationMatrix=new lt),this.onFragmentsDisposed.trigger({groupID:t,fragmentIDs:i})}load(e,t){let i=Se({coordinate:!0},t),{coordinate:n,name:r,properties:o,relationsMap:a}=i,l=this._loader.import(e);t&&(l.isStreamed=t.isStreamed||!1),r&&(l.name=r);for(let c of l.items)c.group=l,this.list.set(c.id,c);return n&&this.coordinate([l]),this.groups.set(l.uuid,l),o&&l.setLocalProperties(o),a&&this.components.get(jh).setRelationMap(l,a),this.onFragmentsLoaded.trigger(l),l}export(e){return this._loader.export(e)}getModelIdMap(e){let t={};for(let i in e){let n=this.list.get(i);if(!(n&&n.group))continue;let r=n.group;r.uuid in t||(t[r.uuid]=new Set);let o=e[i];for(let a of o)t[r.uuid].add(a)}return t}modelIdToFragmentIdMap(e){let t={};for(let i in e){let n=this.groups.get(i);if(!n)continue;let r=e[i],o=n.getFragmentMap(r);t=Se(Se({},t),o)}return t}guidToFragmentIdMap(e){let t={};for(let[i,n]of this.groups){i in t||(t[i]=new Set);for(let r of e){let o=n.globalToExpressIDs.get(r);o&&t[i].add(o)}}return this.modelIdToFragmentIdMap(t)}coordinate(e=Array.from(this.groups.values())){if(this.baseCoordinationModel.length===0){let t=e.pop();if(!t)return;this.baseCoordinationModel=t.uuid,this.baseCoordinationMatrix=t.coordinationMatrix.clone()}if(e.length)for(let t of e)t.coordinationMatrix.equals(this.baseCoordinationMatrix)||(t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1),t.updateMatrix(),this.applyBaseCoordinateSystem(t,t.coordinationMatrix))}applyBaseCoordinateSystem(e,t){t&&e.applyMatrix4(t.clone().invert()),e.applyMatrix4(this.baseCoordinationMatrix)}clone(e,t){let i=e.cloneGroup(t);this.groups.set(i.uuid,i);for(let n of i.items)this.list.set(n.id,n);return i}};q(eC,"uuid","fef46874-46a3-461b-8c44-2922ab77c806");var Rt=eC,mp=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function DR(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function gp(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var iC={exports:{}};(function(s,e){(function(t){s.exports=t()})(function(){return function t(i,n,r){function o(c,d){if(!n[c]){if(!i[c]){var h=typeof gp=="function"&&gp;if(!d&&h)return h(c,!0);if(a)return a(c,!0);var u=new Error("Cannot find module '"+c+"'");throw u.code="MODULE_NOT_FOUND",u}var p=n[c]={exports:{}};i[c][0].call(p.exports,function(f){var m=i[c][1][f];return o(m||f)},p,p.exports,t,i,n,r)}return n[c].exports}for(var a=typeof gp=="function"&&gp,l=0;l<r.length;l++)o(r[l]);return o}({1:[function(t,i,n){var r=t("./utils"),o=t("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(l){for(var c,d,h,u,p,f,m,g=[],b=0,v=l.length,E=v,y=r.getTypeOf(l)!=="string";b<l.length;)E=v-b,h=y?(c=l[b++],d=b<v?l[b++]:0,b<v?l[b++]:0):(c=l.charCodeAt(b++),d=b<v?l.charCodeAt(b++):0,b<v?l.charCodeAt(b++):0),u=c>>2,p=(3&c)<<4|d>>4,f=1<E?(15&d)<<2|h>>6:64,m=2<E?63&h:64,g.push(a.charAt(u)+a.charAt(p)+a.charAt(f)+a.charAt(m));return g.join("")},n.decode=function(l){var c,d,h,u,p,f,m=0,g=0,b="data:";if(l.substr(0,b.length)===b)throw new Error("Invalid base64 input, it looks like a data url.");var v,E=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===a.charAt(64)&&E--,l.charAt(l.length-2)===a.charAt(64)&&E--,E%1!=0)throw new Error("Invalid base64 input, bad content length.");for(v=o.uint8array?new Uint8Array(0|E):new Array(0|E);m<l.length;)c=a.indexOf(l.charAt(m++))<<2|(u=a.indexOf(l.charAt(m++)))>>4,d=(15&u)<<4|(p=a.indexOf(l.charAt(m++)))>>2,h=(3&p)<<6|(f=a.indexOf(l.charAt(m++))),v[g++]=c,p!==64&&(v[g++]=d),f!==64&&(v[g++]=h);return v}},{"./support":30,"./utils":32}],2:[function(t,i,n){var r=t("./external"),o=t("./stream/DataWorker"),a=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function c(d,h,u,p,f){this.compressedSize=d,this.uncompressedSize=h,this.crc32=u,this.compression=p,this.compressedContent=f}c.prototype={getContentWorker:function(){var d=new o(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),h=this;return d.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),d},getCompressedWorker:function(){return new o(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(d,h,u){return d.pipe(new a).pipe(new l("uncompressedSize")).pipe(h.compressWorker(u)).pipe(new l("compressedSize")).withStreamInfo("compression",h)},i.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,i,n){var r=t("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},n.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,i,n){var r=t("./utils"),o=function(){for(var a,l=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;l[c]=a}return l}();i.exports=function(a,l){return a!==void 0&&a.length?r.getTypeOf(a)!=="string"?function(c,d,h,u){var p=o,f=u+h;c^=-1;for(var m=u;m<f;m++)c=c>>>8^p[255&(c^d[m])];return-1^c}(0|l,a,a.length,0):function(c,d,h,u){var p=o,f=u+h;c^=-1;for(var m=u;m<f;m++)c=c>>>8^p[255&(c^d.charCodeAt(m))];return-1^c}(0|l,a,a.length,0):0}},{"./utils":32}],5:[function(t,i,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(t,i,n){var r=null;r=typeof Promise<"u"?Promise:t("lie"),i.exports={Promise:r}},{lie:37}],7:[function(t,i,n){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=t("pako"),a=t("./utils"),l=t("./stream/GenericWorker"),c=r?"uint8array":"array";function d(h,u){l.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=u,this.meta={}}n.magic="\b\0",a.inherits(d,l),d.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(c,h.data),!1)},d.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},d.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},d.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(u){h.push({data:u,meta:h.meta})}},n.compressWorker=function(h){return new d("Deflate",h)},n.uncompressWorker=function(){return new d("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,i,n){function r(p,f){var m,g="";for(m=0;m<f;m++)g+=String.fromCharCode(255&p),p>>>=8;return g}function o(p,f,m,g,b,v){var E,y,w=p.file,C=p.compression,A=v!==c.utf8encode,D=a.transformTo("string",v(w.name)),M=a.transformTo("string",c.utf8encode(w.name)),I=w.comment,O=a.transformTo("string",v(I)),F=a.transformTo("string",c.utf8encode(I)),V=M.length!==w.name.length,x=F.length!==I.length,N="",z="",G="",X=w.dir,k=w.date,B={crc32:0,compressedSize:0,uncompressedSize:0};f&&!m||(B.crc32=p.crc32,B.compressedSize=p.compressedSize,B.uncompressedSize=p.uncompressedSize);var R=0;f&&(R|=8),A||!V&&!x||(R|=2048);var j=0,$=0;X&&(j|=16),b==="UNIX"?($=798,j|=function(U,W){var Q=U;return U||(Q=W?16893:33204),(65535&Q)<<16}(w.unixPermissions,X)):($=20,j|=function(U){return 63&(U||0)}(w.dosPermissions)),E=k.getUTCHours(),E<<=6,E|=k.getUTCMinutes(),E<<=5,E|=k.getUTCSeconds()/2,y=k.getUTCFullYear()-1980,y<<=4,y|=k.getUTCMonth()+1,y<<=5,y|=k.getUTCDate(),V&&(z=r(1,1)+r(d(D),4)+M,N+="up"+r(z.length,2)+z),x&&(G=r(1,1)+r(d(O),4)+F,N+="uc"+r(G.length,2)+G);var T="";return T+=`
\0`,T+=r(R,2),T+=C.magic,T+=r(E,2),T+=r(y,2),T+=r(B.crc32,4),T+=r(B.compressedSize,4),T+=r(B.uncompressedSize,4),T+=r(D.length,2),T+=r(N.length,2),{fileRecord:h.LOCAL_FILE_HEADER+T+D+N,dirRecord:h.CENTRAL_FILE_HEADER+r($,2)+T+r(O.length,2)+"\0\0\0\0"+r(j,4)+r(g,4)+D+N+O}}var a=t("../utils"),l=t("../stream/GenericWorker"),c=t("../utf8"),d=t("../crc32"),h=t("../signature");function u(p,f,m,g){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=f,this.zipPlatform=m,this.encodeFileName=g,this.streamFiles=p,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(u,l),u.prototype.push=function(p){var f=p.meta.percent||0,m=this.entriesCount,g=this._sources.length;this.accumulate?this.contentBuffer.push(p):(this.bytesWritten+=p.data.length,l.prototype.push.call(this,{data:p.data,meta:{currentFile:this.currentFile,percent:m?(f+100*(m-g-1))/m:100}}))},u.prototype.openedSource=function(p){this.currentSourceOffset=this.bytesWritten,this.currentFile=p.file.name;var f=this.streamFiles&&!p.file.dir;if(f){var m=o(p,f,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},u.prototype.closedSource=function(p){this.accumulate=!1;var f=this.streamFiles&&!p.file.dir,m=o(p,f,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),f)this.push({data:function(g){return h.DATA_DESCRIPTOR+r(g.crc32,4)+r(g.compressedSize,4)+r(g.uncompressedSize,4)}(p),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},u.prototype.flush=function(){for(var p=this.bytesWritten,f=0;f<this.dirRecords.length;f++)this.push({data:this.dirRecords[f],meta:{percent:100}});var m=this.bytesWritten-p,g=function(b,v,E,y,w){var C=a.transformTo("string",w(y));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(b,2)+r(b,2)+r(v,4)+r(E,4)+r(C.length,2)+C}(this.dirRecords.length,m,p,this.zipComment,this.encodeFileName);this.push({data:g,meta:{percent:100}})},u.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},u.prototype.registerPrevious=function(p){this._sources.push(p);var f=this;return p.on("data",function(m){f.processChunk(m)}),p.on("end",function(){f.closedSource(f.previous.streamInfo),f._sources.length?f.prepareNextSource():f.end()}),p.on("error",function(m){f.error(m)}),this},u.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},u.prototype.error=function(p){var f=this._sources;if(!l.prototype.error.call(this,p))return!1;for(var m=0;m<f.length;m++)try{f[m].error(p)}catch{}return!0},u.prototype.lock=function(){l.prototype.lock.call(this);for(var p=this._sources,f=0;f<p.length;f++)p[f].lock()},i.exports=u},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,i,n){var r=t("../compressions"),o=t("./ZipFileWorker");n.generateWorker=function(a,l,c){var d=new o(l.streamFiles,c,l.platform,l.encodeFileName),h=0;try{a.forEach(function(u,p){h++;var f=function(v,E){var y=v||E,w=r[y];if(!w)throw new Error(y+" is not a valid compression method !");return w}(p.options.compression,l.compression),m=p.options.compressionOptions||l.compressionOptions||{},g=p.dir,b=p.date;p._compressWorker(f,m).withStreamInfo("file",{name:u,dir:g,date:b,comment:p.comment||"",unixPermissions:p.unixPermissions,dosPermissions:p.dosPermissions}).pipe(d)}),d.entriesCount=h}catch(u){d.error(u)}return d}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,i,n){function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new r;for(var a in this)typeof this[a]!="function"&&(o[a]=this[a]);return o}}(r.prototype=t("./object")).loadAsync=t("./load"),r.support=t("./support"),r.defaults=t("./defaults"),r.version="3.10.1",r.loadAsync=function(o,a){return new r().loadAsync(o,a)},r.external=t("./external"),i.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,i,n){var r=t("./utils"),o=t("./external"),a=t("./utf8"),l=t("./zipEntries"),c=t("./stream/Crc32Probe"),d=t("./nodejsUtils");function h(u){return new o.Promise(function(p,f){var m=u.decompressed.getContentWorker().pipe(new c);m.on("error",function(g){f(g)}).on("end",function(){m.streamInfo.crc32!==u.decompressed.crc32?f(new Error("Corrupted zip : CRC32 mismatch")):p()}).resume()})}i.exports=function(u,p){var f=this;return p=r.extend(p||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),d.isNode&&d.isStream(u)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",u,!0,p.optimizedBinaryString,p.base64).then(function(m){var g=new l(p);return g.load(m),g}).then(function(m){var g=[o.Promise.resolve(m)],b=m.files;if(p.checkCRC32)for(var v=0;v<b.length;v++)g.push(h(b[v]));return o.Promise.all(g)}).then(function(m){for(var g=m.shift(),b=g.files,v=0;v<b.length;v++){var E=b[v],y=E.fileNameStr,w=r.resolve(E.fileNameStr);f.file(w,E.decompressed,{binary:!0,optimizedBinaryString:!0,date:E.date,dir:E.dir,comment:E.fileCommentStr.length?E.fileCommentStr:null,unixPermissions:E.unixPermissions,dosPermissions:E.dosPermissions,createFolders:p.createFolders}),E.dir||(f.file(w).unsafeOriginalName=y)}return g.zipComment.length&&(f.comment=g.zipComment),f})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,i,n){var r=t("../utils"),o=t("../stream/GenericWorker");function a(l,c){o.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}r.inherits(a,o),a.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(d){c.push({data:d,meta:{percent:0}})}).on("error",function(d){c.isPaused?this.generatedError=d:c.error(d)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},a.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,i,n){var r=t("readable-stream").Readable;function o(a,l,c){r.call(this,l),this._helper=a;var d=this;a.on("data",function(h,u){d.push(h)||d._helper.pause(),c&&c(u)}).on("error",function(h){d.emit("error",h)}).on("end",function(){d.push(null)})}t("../utils").inherits(o,r),o.prototype._read=function(){this._helper.resume()},i.exports=o},{"../utils":32,"readable-stream":16}],14:[function(t,i,n){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(r,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,o);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,o)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var o=new Buffer(r);return o.fill(0),o},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(t,i,n){function r(w,C,A){var D,M=a.getTypeOf(C),I=a.extend(A||{},d);I.date=I.date||new Date,I.compression!==null&&(I.compression=I.compression.toUpperCase()),typeof I.unixPermissions=="string"&&(I.unixPermissions=parseInt(I.unixPermissions,8)),I.unixPermissions&&16384&I.unixPermissions&&(I.dir=!0),I.dosPermissions&&16&I.dosPermissions&&(I.dir=!0),I.dir&&(w=b(w)),I.createFolders&&(D=g(w))&&v.call(this,D,!0);var O=M==="string"&&I.binary===!1&&I.base64===!1;A&&A.binary!==void 0||(I.binary=!O),(C instanceof h&&C.uncompressedSize===0||I.dir||!C||C.length===0)&&(I.base64=!1,I.binary=!0,C="",I.compression="STORE",M="string");var F=null;F=C instanceof h||C instanceof l?C:f.isNode&&f.isStream(C)?new m(w,C):a.prepareContent(w,C,I.binary,I.optimizedBinaryString,I.base64);var V=new u(w,F,I);this.files[w]=V}var o=t("./utf8"),a=t("./utils"),l=t("./stream/GenericWorker"),c=t("./stream/StreamHelper"),d=t("./defaults"),h=t("./compressedObject"),u=t("./zipObject"),p=t("./generate"),f=t("./nodejsUtils"),m=t("./nodejs/NodejsStreamInputAdapter"),g=function(w){w.slice(-1)==="/"&&(w=w.substring(0,w.length-1));var C=w.lastIndexOf("/");return 0<C?w.substring(0,C):""},b=function(w){return w.slice(-1)!=="/"&&(w+="/"),w},v=function(w,C){return C=C!==void 0?C:d.createFolders,w=b(w),this.files[w]||r.call(this,w,null,{dir:!0,createFolders:C}),this.files[w]};function E(w){return Object.prototype.toString.call(w)==="[object RegExp]"}var y={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(w){var C,A,D;for(C in this.files)D=this.files[C],(A=C.slice(this.root.length,C.length))&&C.slice(0,this.root.length)===this.root&&w(A,D)},filter:function(w){var C=[];return this.forEach(function(A,D){w(A,D)&&C.push(D)}),C},file:function(w,C,A){if(arguments.length!==1)return w=this.root+w,r.call(this,w,C,A),this;if(E(w)){var D=w;return this.filter(function(I,O){return!O.dir&&D.test(I)})}var M=this.files[this.root+w];return M&&!M.dir?M:null},folder:function(w){if(!w)return this;if(E(w))return this.filter(function(M,I){return I.dir&&w.test(M)});var C=this.root+w,A=v.call(this,C),D=this.clone();return D.root=A.name,D},remove:function(w){w=this.root+w;var C=this.files[w];if(C||(w.slice(-1)!=="/"&&(w+="/"),C=this.files[w]),C&&!C.dir)delete this.files[w];else for(var A=this.filter(function(M,I){return I.name.slice(0,w.length)===w}),D=0;D<A.length;D++)delete this.files[A[D].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(w){var C,A={};try{if((A=a.extend(w||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=A.type.toLowerCase(),A.compression=A.compression.toUpperCase(),A.type==="binarystring"&&(A.type="string"),!A.type)throw new Error("No output type specified.");a.checkSupport(A.type),A.platform!=="darwin"&&A.platform!=="freebsd"&&A.platform!=="linux"&&A.platform!=="sunos"||(A.platform="UNIX"),A.platform==="win32"&&(A.platform="DOS");var D=A.comment||this.comment||"";C=p.generateWorker(this,A,D)}catch(M){(C=new l("error")).error(M)}return new c(C,A.type||"string",A.mimeType)},generateAsync:function(w,C){return this.generateInternalStream(w).accumulate(C)},generateNodeStream:function(w,C){return(w=w||{}).type||(w.type="nodebuffer"),this.generateInternalStream(w).toNodejsStream(C)}};i.exports=y},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,i,n){i.exports=t("stream")},{stream:void 0}],17:[function(t,i,n){var r=t("./DataReader");function o(a){r.call(this,a);for(var l=0;l<this.data.length;l++)a[l]=255&a[l]}t("../utils").inherits(o,r),o.prototype.byteAt=function(a){return this.data[this.zero+a]},o.prototype.lastIndexOfSignature=function(a){for(var l=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),h=a.charCodeAt(3),u=this.length-4;0<=u;--u)if(this.data[u]===l&&this.data[u+1]===c&&this.data[u+2]===d&&this.data[u+3]===h)return u-this.zero;return-1},o.prototype.readAndCheckSignature=function(a){var l=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),h=a.charCodeAt(3),u=this.readData(4);return l===u[0]&&c===u[1]&&d===u[2]&&h===u[3]},o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./DataReader":18}],18:[function(t,i,n){var r=t("../utils");function o(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var l,c=0;for(this.checkOffset(a),l=this.index+a-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=a,c},readString:function(a){return r.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},i.exports=o},{"../utils":32}],19:[function(t,i,n){var r=t("./Uint8ArrayReader");function o(a){r.call(this,a)}t("../utils").inherits(o,r),o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,i,n){var r=t("./DataReader");function o(a){r.call(this,a)}t("../utils").inherits(o,r),o.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},o.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},o.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},o.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./DataReader":18}],21:[function(t,i,n){var r=t("./ArrayReader");function o(a){r.call(this,a)}t("../utils").inherits(o,r),o.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},i.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(t,i,n){var r=t("../utils"),o=t("../support"),a=t("./ArrayReader"),l=t("./StringReader"),c=t("./NodeBufferReader"),d=t("./Uint8ArrayReader");i.exports=function(h){var u=r.getTypeOf(h);return r.checkSupport(u),u!=="string"||o.uint8array?u==="nodebuffer"?new c(h):o.uint8array?new d(r.transformTo("uint8array",h)):new a(r.transformTo("array",h)):new l(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,i,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,i,n){var r=t("./GenericWorker"),o=t("../utils");function a(l){r.call(this,"ConvertWorker to "+l),this.destType=l}o.inherits(a,r),a.prototype.processChunk=function(l){this.push({data:o.transformTo(this.destType,l.data),meta:l.meta})},i.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(t,i,n){var r=t("./GenericWorker"),o=t("../crc32");function a(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(a,r),a.prototype.processChunk=function(l){this.streamInfo.crc32=o(l.data,this.streamInfo.crc32||0),this.push(l)},i.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,i,n){var r=t("../utils"),o=t("./GenericWorker");function a(l){o.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}r.inherits(a,o),a.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}o.prototype.processChunk.call(this,l)},i.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(t,i,n){var r=t("../utils"),o=t("./GenericWorker");function a(l){o.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(d){c.dataIsReady=!0,c.data=d,c.max=d&&d.length||0,c.type=r.getTypeOf(d),c.isPaused||c._tickAndRepeat()},function(d){c.error(d)})}r.inherits(a,o),a.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(t,i,n){function r(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,a){return this._listeners[o].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,a){if(this._listeners[o])for(var l=0;l<this._listeners[o].length;l++)this._listeners[o][l].call(this,a)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var a=this;return o.on("data",function(l){a.processChunk(l)}),o.on("end",function(){a.end()}),o.on("error",function(l){a.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,a){return this.extraStreamInfo[o]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},i.exports=r},{}],29:[function(t,i,n){var r=t("../utils"),o=t("./ConvertWorker"),a=t("./GenericWorker"),l=t("../base64"),c=t("../support"),d=t("../external"),h=null;if(c.nodestream)try{h=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function u(f,m){return new d.Promise(function(g,b){var v=[],E=f._internalType,y=f._outputType,w=f._mimeType;f.on("data",function(C,A){v.push(C),m&&m(A)}).on("error",function(C){v=[],b(C)}).on("end",function(){try{var C=function(A,D,M){switch(A){case"blob":return r.newBlob(r.transformTo("arraybuffer",D),M);case"base64":return l.encode(D);default:return r.transformTo(A,D)}}(y,function(A,D){var M,I=0,O=null,F=0;for(M=0;M<D.length;M++)F+=D[M].length;switch(A){case"string":return D.join("");case"array":return Array.prototype.concat.apply([],D);case"uint8array":for(O=new Uint8Array(F),M=0;M<D.length;M++)O.set(D[M],I),I+=D[M].length;return O;case"nodebuffer":return Buffer.concat(D);default:throw new Error("concat : unsupported type '"+A+"'")}}(E,v),w);g(C)}catch(A){b(A)}v=[]}).resume()})}function p(f,m,g){var b=m;switch(m){case"blob":case"arraybuffer":b="uint8array";break;case"base64":b="string"}try{this._internalType=b,this._outputType=m,this._mimeType=g,r.checkSupport(b),this._worker=f.pipe(new o(b)),f.lock()}catch(v){this._worker=new a("error"),this._worker.error(v)}}p.prototype={accumulate:function(f){return u(this,f)},on:function(f,m){var g=this;return f==="data"?this._worker.on(f,function(b){m.call(g,b.data,b.meta)}):this._worker.on(f,function(){r.delay(m,arguments,g)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(f){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},f)}},i.exports=p},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,i,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",n.nodebuffer=typeof Buffer<"u",n.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")n.blob=!1;else{var r=new ArrayBuffer(0);try{n.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(r),n.blob=o.getBlob("application/zip").size===0}catch{n.blob=!1}}}try{n.nodestream=!!t("readable-stream").Readable}catch{n.nodestream=!1}},{"readable-stream":16}],31:[function(t,i,n){for(var r=t("./utils"),o=t("./support"),a=t("./nodejsUtils"),l=t("./stream/GenericWorker"),c=new Array(256),d=0;d<256;d++)c[d]=252<=d?6:248<=d?5:240<=d?4:224<=d?3:192<=d?2:1;c[254]=c[254]=1;function h(){l.call(this,"utf-8 decode"),this.leftOver=null}function u(){l.call(this,"utf-8 encode")}n.utf8encode=function(p){return o.nodebuffer?a.newBufferFrom(p,"utf-8"):function(f){var m,g,b,v,E,y=f.length,w=0;for(v=0;v<y;v++)(64512&(g=f.charCodeAt(v)))==55296&&v+1<y&&(64512&(b=f.charCodeAt(v+1)))==56320&&(g=65536+(g-55296<<10)+(b-56320),v++),w+=g<128?1:g<2048?2:g<65536?3:4;for(m=o.uint8array?new Uint8Array(w):new Array(w),v=E=0;E<w;v++)(64512&(g=f.charCodeAt(v)))==55296&&v+1<y&&(64512&(b=f.charCodeAt(v+1)))==56320&&(g=65536+(g-55296<<10)+(b-56320),v++),g<128?m[E++]=g:(g<2048?m[E++]=192|g>>>6:(g<65536?m[E++]=224|g>>>12:(m[E++]=240|g>>>18,m[E++]=128|g>>>12&63),m[E++]=128|g>>>6&63),m[E++]=128|63&g);return m}(p)},n.utf8decode=function(p){return o.nodebuffer?r.transformTo("nodebuffer",p).toString("utf-8"):function(f){var m,g,b,v,E=f.length,y=new Array(2*E);for(m=g=0;m<E;)if((b=f[m++])<128)y[g++]=b;else if(4<(v=c[b]))y[g++]=65533,m+=v-1;else{for(b&=v===2?31:v===3?15:7;1<v&&m<E;)b=b<<6|63&f[m++],v--;1<v?y[g++]=65533:b<65536?y[g++]=b:(b-=65536,y[g++]=55296|b>>10&1023,y[g++]=56320|1023&b)}return y.length!==g&&(y.subarray?y=y.subarray(0,g):y.length=g),r.applyFromCharCode(y)}(p=r.transformTo(o.uint8array?"uint8array":"array",p))},r.inherits(h,l),h.prototype.processChunk=function(p){var f=r.transformTo(o.uint8array?"uint8array":"array",p.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var m=f;(f=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),f.set(m,this.leftOver.length)}else f=this.leftOver.concat(f);this.leftOver=null}var g=function(v,E){var y;for((E=E||v.length)>v.length&&(E=v.length),y=E-1;0<=y&&(192&v[y])==128;)y--;return y<0||y===0?E:y+c[v[y]]>E?y:E}(f),b=f;g!==f.length&&(o.uint8array?(b=f.subarray(0,g),this.leftOver=f.subarray(g,f.length)):(b=f.slice(0,g),this.leftOver=f.slice(g,f.length))),this.push({data:n.utf8decode(b),meta:p.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=h,r.inherits(u,l),u.prototype.processChunk=function(p){this.push({data:n.utf8encode(p.data),meta:p.meta})},n.Utf8EncodeWorker=u},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,i,n){var r=t("./support"),o=t("./base64"),a=t("./nodejsUtils"),l=t("./external");function c(m){return m}function d(m,g){for(var b=0;b<m.length;++b)g[b]=255&m.charCodeAt(b);return g}t("setimmediate"),n.newBlob=function(m,g){n.checkSupport("blob");try{return new Blob([m],{type:g})}catch{try{var b=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return b.append(m),b.getBlob(g)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(m,g,b){var v=[],E=0,y=m.length;if(y<=b)return String.fromCharCode.apply(null,m);for(;E<y;)g==="array"||g==="nodebuffer"?v.push(String.fromCharCode.apply(null,m.slice(E,Math.min(E+b,y)))):v.push(String.fromCharCode.apply(null,m.subarray(E,Math.min(E+b,y)))),E+=b;return v.join("")},stringifyByChar:function(m){for(var g="",b=0;b<m.length;b++)g+=String.fromCharCode(m[b]);return g},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}}()}};function u(m){var g=65536,b=n.getTypeOf(m),v=!0;if(b==="uint8array"?v=h.applyCanBeUsed.uint8array:b==="nodebuffer"&&(v=h.applyCanBeUsed.nodebuffer),v)for(;1<g;)try{return h.stringifyByChunk(m,b,g)}catch{g=Math.floor(g/2)}return h.stringifyByChar(m)}function p(m,g){for(var b=0;b<m.length;b++)g[b]=m[b];return g}n.applyFromCharCode=u;var f={};f.string={string:c,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return f.string.uint8array(m).buffer},uint8array:function(m){return d(m,new Uint8Array(m.length))},nodebuffer:function(m){return d(m,a.allocBuffer(m.length))}},f.array={string:u,array:c,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},f.arraybuffer={string:function(m){return u(new Uint8Array(m))},array:function(m){return p(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:c,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},f.uint8array={string:u,array:function(m){return p(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:c,nodebuffer:function(m){return a.newBufferFrom(m)}},f.nodebuffer={string:u,array:function(m){return p(m,new Array(m.length))},arraybuffer:function(m){return f.nodebuffer.uint8array(m).buffer},uint8array:function(m){return p(m,new Uint8Array(m.length))},nodebuffer:c},n.transformTo=function(m,g){if(g=g||"",!m)return g;n.checkSupport(m);var b=n.getTypeOf(g);return f[b][m](g)},n.resolve=function(m){for(var g=m.split("/"),b=[],v=0;v<g.length;v++){var E=g[v];E==="."||E===""&&v!==0&&v!==g.length-1||(E===".."?b.pop():b.push(E))}return b.join("/")},n.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":r.nodebuffer&&a.isBuffer(m)?"nodebuffer":r.uint8array&&m instanceof Uint8Array?"uint8array":r.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(m){if(!r[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(m){var g,b,v="";for(b=0;b<(m||"").length;b++)v+="\\x"+((g=m.charCodeAt(b))<16?"0":"")+g.toString(16).toUpperCase();return v},n.delay=function(m,g,b){setImmediate(function(){m.apply(b||null,g||[])})},n.inherits=function(m,g){function b(){}b.prototype=g.prototype,m.prototype=new b},n.extend=function(){var m,g,b={};for(m=0;m<arguments.length;m++)for(g in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],g)&&b[g]===void 0&&(b[g]=arguments[m][g]);return b},n.prepareContent=function(m,g,b,v,E){return l.Promise.resolve(g).then(function(y){return r.blob&&(y instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(y))!==-1)&&typeof FileReader<"u"?new l.Promise(function(w,C){var A=new FileReader;A.onload=function(D){w(D.target.result)},A.onerror=function(D){C(D.target.error)},A.readAsArrayBuffer(y)}):y}).then(function(y){var w=n.getTypeOf(y);return w?(w==="arraybuffer"?y=n.transformTo("uint8array",y):w==="string"&&(E?y=o.decode(y):b&&v!==!0&&(y=function(C){return d(C,r.uint8array?new Uint8Array(C.length):new Array(C.length))}(y))),y):l.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,i,n){var r=t("./reader/readerFor"),o=t("./utils"),a=t("./signature"),l=t("./zipEntry"),c=t("./support");function d(h){this.files=[],this.loadOptions=h}d.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var u=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(u)+", expected "+o.pretty(h)+")")}},isSignature:function(h,u){var p=this.reader.index;this.reader.setIndex(h);var f=this.reader.readString(4)===u;return this.reader.setIndex(p),f},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),u=c.uint8array?"uint8array":"array",p=o.transformTo(u,h);this.zipComment=this.loadOptions.decodeFileName(p)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,u,p,f=this.zip64EndOfCentralSize-44;0<f;)h=this.reader.readInt(2),u=this.reader.readInt(4),p=this.reader.readData(u),this.zip64ExtensibleData[h]={id:h,length:u,value:p}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,u;for(h=0;h<this.files.length;h++)u=this.files[h],this.reader.setIndex(u.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),u.readLocalPart(this.reader),u.handleUTF8(),u.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var u=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var p=this.centralDirOffset+this.centralDirSize;this.zip64&&(p+=20,p+=12+this.zip64EndOfCentralSize);var f=u-p;if(0<f)this.isSignature(u,a.CENTRAL_FILE_HEADER)||(this.reader.zero=f);else if(f<0)throw new Error("Corrupted zip: missing "+Math.abs(f)+" bytes.")},prepareReader:function(h){this.reader=r(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=d},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,i,n){var r=t("./reader/readerFor"),o=t("./utils"),a=t("./compressedObject"),l=t("./crc32"),c=t("./utf8"),d=t("./compressions"),h=t("./support");function u(p,f){this.options=p,this.loadOptions=f}u.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(p){var f,m;if(p.skip(22),this.fileNameLength=p.readInt(2),m=p.readInt(2),this.fileName=p.readData(this.fileNameLength),p.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((f=function(g){for(var b in d)if(Object.prototype.hasOwnProperty.call(d,b)&&d[b].magic===g)return d[b];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,f,p.readData(this.compressedSize))},readCentralPart:function(p){this.versionMadeBy=p.readInt(2),p.skip(2),this.bitFlag=p.readInt(2),this.compressionMethod=p.readString(2),this.date=p.readDate(),this.crc32=p.readInt(4),this.compressedSize=p.readInt(4),this.uncompressedSize=p.readInt(4);var f=p.readInt(2);if(this.extraFieldsLength=p.readInt(2),this.fileCommentLength=p.readInt(2),this.diskNumberStart=p.readInt(2),this.internalFileAttributes=p.readInt(2),this.externalFileAttributes=p.readInt(4),this.localHeaderOffset=p.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");p.skip(f),this.readExtraFields(p),this.parseZIP64ExtraField(p),this.fileComment=p.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var p=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),p==0&&(this.dosPermissions=63&this.externalFileAttributes),p==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var p=r(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=p.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=p.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=p.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=p.readInt(4))}},readExtraFields:function(p){var f,m,g,b=p.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});p.index+4<b;)f=p.readInt(2),m=p.readInt(2),g=p.readData(m),this.extraFields[f]={id:f,length:m,value:g};p.setIndex(b)},handleUTF8:function(){var p=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var f=this.findExtraFieldUnicodePath();if(f!==null)this.fileNameStr=f;else{var m=o.transformTo(p,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var g=this.findExtraFieldUnicodeComment();if(g!==null)this.fileCommentStr=g;else{var b=o.transformTo(p,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(b)}}},findExtraFieldUnicodePath:function(){var p=this.extraFields[28789];if(p){var f=r(p.value);return f.readInt(1)!==1||l(this.fileName)!==f.readInt(4)?null:c.utf8decode(f.readData(p.length-5))}return null},findExtraFieldUnicodeComment:function(){var p=this.extraFields[25461];if(p){var f=r(p.value);return f.readInt(1)!==1||l(this.fileComment)!==f.readInt(4)?null:c.utf8decode(f.readData(p.length-5))}return null}},i.exports=u},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,i,n){function r(f,m,g){this.name=f,this.dir=g.dir,this.date=g.date,this.comment=g.comment,this.unixPermissions=g.unixPermissions,this.dosPermissions=g.dosPermissions,this._data=m,this._dataBinary=g.binary,this.options={compression:g.compression,compressionOptions:g.compressionOptions}}var o=t("./stream/StreamHelper"),a=t("./stream/DataWorker"),l=t("./utf8"),c=t("./compressedObject"),d=t("./stream/GenericWorker");r.prototype={internalStream:function(f){var m=null,g="string";try{if(!f)throw new Error("No output type specified.");var b=(g=f.toLowerCase())==="string"||g==="text";g!=="binarystring"&&g!=="text"||(g="string"),m=this._decompressWorker();var v=!this._dataBinary;v&&!b&&(m=m.pipe(new l.Utf8EncodeWorker)),!v&&b&&(m=m.pipe(new l.Utf8DecodeWorker))}catch(E){(m=new d("error")).error(E)}return new o(m,g,"")},async:function(f,m){return this.internalStream(f).accumulate(m)},nodeStream:function(f,m){return this.internalStream(f||"nodebuffer").toNodejsStream(m)},_compressWorker:function(f,m){if(this._data instanceof c&&this._data.compression.magic===f.magic)return this._data.getCompressedWorker();var g=this._decompressWorker();return this._dataBinary||(g=g.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(g,f,m)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof d?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],u=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},p=0;p<h.length;p++)r.prototype[h[p]]=u;i.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,i,n){(function(r){var o,a,l=r.MutationObserver||r.WebKitMutationObserver;if(l){var c=0,d=new l(f),h=r.document.createTextNode("");d.observe(h,{characterData:!0}),o=function(){h.data=c=++c%2}}else if(r.setImmediate||r.MessageChannel===void 0)o="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var m=r.document.createElement("script");m.onreadystatechange=function(){f(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},r.document.documentElement.appendChild(m)}:function(){setTimeout(f,0)};else{var u=new r.MessageChannel;u.port1.onmessage=f,o=function(){u.port2.postMessage(0)}}var p=[];function f(){var m,g;a=!0;for(var b=p.length;b;){for(g=p,p=[],m=-1;++m<b;)g[m]();b=p.length}a=!1}i.exports=function(m){p.push(m)!==1||a||o()}}).call(this,typeof mp<"u"?mp:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,i,n){var r=t("immediate");function o(){}var a={},l=["REJECTED"],c=["FULFILLED"],d=["PENDING"];function h(b){if(typeof b!="function")throw new TypeError("resolver must be a function");this.state=d,this.queue=[],this.outcome=void 0,b!==o&&m(this,b)}function u(b,v,E){this.promise=b,typeof v=="function"&&(this.onFulfilled=v,this.callFulfilled=this.otherCallFulfilled),typeof E=="function"&&(this.onRejected=E,this.callRejected=this.otherCallRejected)}function p(b,v,E){r(function(){var y;try{y=v(E)}catch(w){return a.reject(b,w)}y===b?a.reject(b,new TypeError("Cannot resolve promise with itself")):a.resolve(b,y)})}function f(b){var v=b&&b.then;if(b&&(typeof b=="object"||typeof b=="function")&&typeof v=="function")return function(){v.apply(b,arguments)}}function m(b,v){var E=!1;function y(A){E||(E=!0,a.reject(b,A))}function w(A){E||(E=!0,a.resolve(b,A))}var C=g(function(){v(w,y)});C.status==="error"&&y(C.value)}function g(b,v){var E={};try{E.value=b(v),E.status="success"}catch(y){E.status="error",E.value=y}return E}(i.exports=h).prototype.finally=function(b){if(typeof b!="function")return this;var v=this.constructor;return this.then(function(E){return v.resolve(b()).then(function(){return E})},function(E){return v.resolve(b()).then(function(){throw E})})},h.prototype.catch=function(b){return this.then(null,b)},h.prototype.then=function(b,v){if(typeof b!="function"&&this.state===c||typeof v!="function"&&this.state===l)return this;var E=new this.constructor(o);return this.state!==d?p(E,this.state===c?b:v,this.outcome):this.queue.push(new u(E,b,v)),E},u.prototype.callFulfilled=function(b){a.resolve(this.promise,b)},u.prototype.otherCallFulfilled=function(b){p(this.promise,this.onFulfilled,b)},u.prototype.callRejected=function(b){a.reject(this.promise,b)},u.prototype.otherCallRejected=function(b){p(this.promise,this.onRejected,b)},a.resolve=function(b,v){var E=g(f,v);if(E.status==="error")return a.reject(b,E.value);var y=E.value;if(y)m(b,y);else{b.state=c,b.outcome=v;for(var w=-1,C=b.queue.length;++w<C;)b.queue[w].callFulfilled(v)}return b},a.reject=function(b,v){b.state=l,b.outcome=v;for(var E=-1,y=b.queue.length;++E<y;)b.queue[E].callRejected(v);return b},h.resolve=function(b){return b instanceof this?b:a.resolve(new this(o),b)},h.reject=function(b){var v=new this(o);return a.reject(v,b)},h.all=function(b){var v=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=b.length,y=!1;if(!E)return this.resolve([]);for(var w=new Array(E),C=0,A=-1,D=new this(o);++A<E;)M(b[A],A);return D;function M(I,O){v.resolve(I).then(function(F){w[O]=F,++C!==E||y||(y=!0,a.resolve(D,w))},function(F){y||(y=!0,a.reject(D,F))})}},h.race=function(b){var v=this;if(Object.prototype.toString.call(b)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=b.length,y=!1;if(!E)return this.resolve([]);for(var w=-1,C=new this(o);++w<E;)A=b[w],v.resolve(A).then(function(D){y||(y=!0,a.resolve(C,D))},function(D){y||(y=!0,a.reject(C,D))});var A;return C}},{immediate:36}],38:[function(t,i,n){var r={};(0,t("./lib/utils/common").assign)(r,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),i.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,i,n){var r=t("./zlib/deflate"),o=t("./utils/common"),a=t("./utils/strings"),l=t("./zlib/messages"),c=t("./zlib/zstream"),d=Object.prototype.toString,h=0,u=-1,p=0,f=8;function m(b){if(!(this instanceof m))return new m(b);this.options=o.assign({level:u,method:f,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},b||{});var v=this.options;v.raw&&0<v.windowBits?v.windowBits=-v.windowBits:v.gzip&&0<v.windowBits&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var E=r.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(E!==h)throw new Error(l[E]);if(v.header&&r.deflateSetHeader(this.strm,v.header),v.dictionary){var y;if(y=typeof v.dictionary=="string"?a.string2buf(v.dictionary):d.call(v.dictionary)==="[object ArrayBuffer]"?new Uint8Array(v.dictionary):v.dictionary,(E=r.deflateSetDictionary(this.strm,y))!==h)throw new Error(l[E]);this._dict_set=!0}}function g(b,v){var E=new m(v);if(E.push(b,!0),E.err)throw E.msg||l[E.err];return E.result}m.prototype.push=function(b,v){var E,y,w=this.strm,C=this.options.chunkSize;if(this.ended)return!1;y=v===~~v?v:v===!0?4:0,typeof b=="string"?w.input=a.string2buf(b):d.call(b)==="[object ArrayBuffer]"?w.input=new Uint8Array(b):w.input=b,w.next_in=0,w.avail_in=w.input.length;do{if(w.avail_out===0&&(w.output=new o.Buf8(C),w.next_out=0,w.avail_out=C),(E=r.deflate(w,y))!==1&&E!==h)return this.onEnd(E),!(this.ended=!0);w.avail_out!==0&&(w.avail_in!==0||y!==4&&y!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(o.shrinkBuf(w.output,w.next_out))):this.onData(o.shrinkBuf(w.output,w.next_out)))}while((0<w.avail_in||w.avail_out===0)&&E!==1);return y===4?(E=r.deflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===h):y!==2||(this.onEnd(h),!(w.avail_out=0))},m.prototype.onData=function(b){this.chunks.push(b)},m.prototype.onEnd=function(b){b===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg},n.Deflate=m,n.deflate=g,n.deflateRaw=function(b,v){return(v=v||{}).raw=!0,g(b,v)},n.gzip=function(b,v){return(v=v||{}).gzip=!0,g(b,v)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,i,n){var r=t("./zlib/inflate"),o=t("./utils/common"),a=t("./utils/strings"),l=t("./zlib/constants"),c=t("./zlib/messages"),d=t("./zlib/zstream"),h=t("./zlib/gzheader"),u=Object.prototype.toString;function p(m){if(!(this instanceof p))return new p(m);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},m||{});var g=this.options;g.raw&&0<=g.windowBits&&g.windowBits<16&&(g.windowBits=-g.windowBits,g.windowBits===0&&(g.windowBits=-15)),!(0<=g.windowBits&&g.windowBits<16)||m&&m.windowBits||(g.windowBits+=32),15<g.windowBits&&g.windowBits<48&&!(15&g.windowBits)&&(g.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var b=r.inflateInit2(this.strm,g.windowBits);if(b!==l.Z_OK)throw new Error(c[b]);this.header=new h,r.inflateGetHeader(this.strm,this.header)}function f(m,g){var b=new p(g);if(b.push(m,!0),b.err)throw b.msg||c[b.err];return b.result}p.prototype.push=function(m,g){var b,v,E,y,w,C,A=this.strm,D=this.options.chunkSize,M=this.options.dictionary,I=!1;if(this.ended)return!1;v=g===~~g?g:g===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof m=="string"?A.input=a.binstring2buf(m):u.call(m)==="[object ArrayBuffer]"?A.input=new Uint8Array(m):A.input=m,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new o.Buf8(D),A.next_out=0,A.avail_out=D),(b=r.inflate(A,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&M&&(C=typeof M=="string"?a.string2buf(M):u.call(M)==="[object ArrayBuffer]"?new Uint8Array(M):M,b=r.inflateSetDictionary(this.strm,C)),b===l.Z_BUF_ERROR&&I===!0&&(b=l.Z_OK,I=!1),b!==l.Z_STREAM_END&&b!==l.Z_OK)return this.onEnd(b),!(this.ended=!0);A.next_out&&(A.avail_out!==0&&b!==l.Z_STREAM_END&&(A.avail_in!==0||v!==l.Z_FINISH&&v!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(E=a.utf8border(A.output,A.next_out),y=A.next_out-E,w=a.buf2string(A.output,E),A.next_out=y,A.avail_out=D-y,y&&o.arraySet(A.output,A.output,E,y,0),this.onData(w)):this.onData(o.shrinkBuf(A.output,A.next_out)))),A.avail_in===0&&A.avail_out===0&&(I=!0)}while((0<A.avail_in||A.avail_out===0)&&b!==l.Z_STREAM_END);return b===l.Z_STREAM_END&&(v=l.Z_FINISH),v===l.Z_FINISH?(b=r.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===l.Z_OK):v!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(A.avail_out=0))},p.prototype.onData=function(m){this.chunks.push(m)},p.prototype.onEnd=function(m){m===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},n.Inflate=p,n.inflate=f,n.inflateRaw=function(m,g){return(g=g||{}).raw=!0,f(m,g)},n.ungzip=f},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,i,n){var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";n.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var d=c.shift();if(d){if(typeof d!="object")throw new TypeError(d+"must be non-object");for(var h in d)d.hasOwnProperty(h)&&(l[h]=d[h])}}return l},n.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var o={arraySet:function(l,c,d,h,u){if(c.subarray&&l.subarray)l.set(c.subarray(d,d+h),u);else for(var p=0;p<h;p++)l[u+p]=c[d+p]},flattenChunks:function(l){var c,d,h,u,p,f;for(c=h=0,d=l.length;c<d;c++)h+=l[c].length;for(f=new Uint8Array(h),c=u=0,d=l.length;c<d;c++)p=l[c],f.set(p,u),u+=p.length;return f}},a={arraySet:function(l,c,d,h,u){for(var p=0;p<h;p++)l[u+p]=c[d+p]},flattenChunks:function(l){return[].concat.apply([],l)}};n.setTyped=function(l){l?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,o)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,a))},n.setTyped(r)},{}],42:[function(t,i,n){var r=t("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var l=new r.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function d(h,u){if(u<65537&&(h.subarray&&a||!h.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(h,u));for(var p="",f=0;f<u;f++)p+=String.fromCharCode(h[f]);return p}l[254]=l[254]=1,n.string2buf=function(h){var u,p,f,m,g,b=h.length,v=0;for(m=0;m<b;m++)(64512&(p=h.charCodeAt(m)))==55296&&m+1<b&&(64512&(f=h.charCodeAt(m+1)))==56320&&(p=65536+(p-55296<<10)+(f-56320),m++),v+=p<128?1:p<2048?2:p<65536?3:4;for(u=new r.Buf8(v),m=g=0;g<v;m++)(64512&(p=h.charCodeAt(m)))==55296&&m+1<b&&(64512&(f=h.charCodeAt(m+1)))==56320&&(p=65536+(p-55296<<10)+(f-56320),m++),p<128?u[g++]=p:(p<2048?u[g++]=192|p>>>6:(p<65536?u[g++]=224|p>>>12:(u[g++]=240|p>>>18,u[g++]=128|p>>>12&63),u[g++]=128|p>>>6&63),u[g++]=128|63&p);return u},n.buf2binstring=function(h){return d(h,h.length)},n.binstring2buf=function(h){for(var u=new r.Buf8(h.length),p=0,f=u.length;p<f;p++)u[p]=h.charCodeAt(p);return u},n.buf2string=function(h,u){var p,f,m,g,b=u||h.length,v=new Array(2*b);for(p=f=0;p<b;)if((m=h[p++])<128)v[f++]=m;else if(4<(g=l[m]))v[f++]=65533,p+=g-1;else{for(m&=g===2?31:g===3?15:7;1<g&&p<b;)m=m<<6|63&h[p++],g--;1<g?v[f++]=65533:m<65536?v[f++]=m:(m-=65536,v[f++]=55296|m>>10&1023,v[f++]=56320|1023&m)}return d(v,f)},n.utf8border=function(h,u){var p;for((u=u||h.length)>h.length&&(u=h.length),p=u-1;0<=p&&(192&h[p])==128;)p--;return p<0||p===0?u:p+l[h[p]]>u?p:u}},{"./common":41}],43:[function(t,i,n){i.exports=function(r,o,a,l){for(var c=65535&r|0,d=r>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;d=d+(c=c+o[l++]|0)|0,--h;);c%=65521,d%=65521}return c|d<<16|0}},{}],44:[function(t,i,n){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,i,n){var r=function(){for(var o,a=[],l=0;l<256;l++){o=l;for(var c=0;c<8;c++)o=1&o?3988292384^o>>>1:o>>>1;a[l]=o}return a}();i.exports=function(o,a,l,c){var d=r,h=c+l;o^=-1;for(var u=c;u<h;u++)o=o>>>8^d[255&(o^a[u])];return-1^o}},{}],46:[function(t,i,n){var r,o=t("../utils/common"),a=t("./trees"),l=t("./adler32"),c=t("./crc32"),d=t("./messages"),h=0,u=4,p=0,f=-2,m=-1,g=4,b=2,v=8,E=9,y=286,w=30,C=19,A=2*y+1,D=15,M=3,I=258,O=I+M+1,F=42,V=113,x=1,N=2,z=3,G=4;function X(P,se){return P.msg=d[se],se}function k(P){return(P<<1)-(4<P?9:0)}function B(P){for(var se=P.length;0<=--se;)P[se]=0}function R(P){var se=P.state,re=se.pending;re>P.avail_out&&(re=P.avail_out),re!==0&&(o.arraySet(P.output,se.pending_buf,se.pending_out,re,P.next_out),P.next_out+=re,se.pending_out+=re,P.total_out+=re,P.avail_out-=re,se.pending-=re,se.pending===0&&(se.pending_out=0))}function j(P,se){a._tr_flush_block(P,0<=P.block_start?P.block_start:-1,P.strstart-P.block_start,se),P.block_start=P.strstart,R(P.strm)}function $(P,se){P.pending_buf[P.pending++]=se}function T(P,se){P.pending_buf[P.pending++]=se>>>8&255,P.pending_buf[P.pending++]=255&se}function U(P,se){var re,K,ee=P.max_chain_length,le=P.strstart,xe=P.prev_length,ge=P.nice_match,_e=P.strstart>P.w_size-O?P.strstart-(P.w_size-O):0,Ue=P.window,ke=P.w_mask,je=P.prev,Qe=P.strstart+I,Et=Ue[le+xe-1],ht=Ue[le+xe];P.prev_length>=P.good_match&&(ee>>=2),ge>P.lookahead&&(ge=P.lookahead);do if(Ue[(re=se)+xe]===ht&&Ue[re+xe-1]===Et&&Ue[re]===Ue[le]&&Ue[++re]===Ue[le+1]){le+=2,re++;do;while(Ue[++le]===Ue[++re]&&Ue[++le]===Ue[++re]&&Ue[++le]===Ue[++re]&&Ue[++le]===Ue[++re]&&Ue[++le]===Ue[++re]&&Ue[++le]===Ue[++re]&&Ue[++le]===Ue[++re]&&Ue[++le]===Ue[++re]&&le<Qe);if(K=I-(Qe-le),le=Qe-I,xe<K){if(P.match_start=se,ge<=(xe=K))break;Et=Ue[le+xe-1],ht=Ue[le+xe]}}while((se=je[se&ke])>_e&&--ee!=0);return xe<=P.lookahead?xe:P.lookahead}function W(P){var se,re,K,ee,le,xe,ge,_e,Ue,ke,je=P.w_size;do{if(ee=P.window_size-P.lookahead-P.strstart,P.strstart>=je+(je-O)){for(o.arraySet(P.window,P.window,je,je,0),P.match_start-=je,P.strstart-=je,P.block_start-=je,se=re=P.hash_size;K=P.head[--se],P.head[se]=je<=K?K-je:0,--re;);for(se=re=je;K=P.prev[--se],P.prev[se]=je<=K?K-je:0,--re;);ee+=je}if(P.strm.avail_in===0)break;if(xe=P.strm,ge=P.window,_e=P.strstart+P.lookahead,Ue=ee,ke=void 0,ke=xe.avail_in,Ue<ke&&(ke=Ue),re=ke===0?0:(xe.avail_in-=ke,o.arraySet(ge,xe.input,xe.next_in,ke,_e),xe.state.wrap===1?xe.adler=l(xe.adler,ge,ke,_e):xe.state.wrap===2&&(xe.adler=c(xe.adler,ge,ke,_e)),xe.next_in+=ke,xe.total_in+=ke,ke),P.lookahead+=re,P.lookahead+P.insert>=M)for(le=P.strstart-P.insert,P.ins_h=P.window[le],P.ins_h=(P.ins_h<<P.hash_shift^P.window[le+1])&P.hash_mask;P.insert&&(P.ins_h=(P.ins_h<<P.hash_shift^P.window[le+M-1])&P.hash_mask,P.prev[le&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=le,le++,P.insert--,!(P.lookahead+P.insert<M)););}while(P.lookahead<O&&P.strm.avail_in!==0)}function Q(P,se){for(var re,K;;){if(P.lookahead<O){if(W(P),P.lookahead<O&&se===h)return x;if(P.lookahead===0)break}if(re=0,P.lookahead>=M&&(P.ins_h=(P.ins_h<<P.hash_shift^P.window[P.strstart+M-1])&P.hash_mask,re=P.prev[P.strstart&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=P.strstart),re!==0&&P.strstart-re<=P.w_size-O&&(P.match_length=U(P,re)),P.match_length>=M)if(K=a._tr_tally(P,P.strstart-P.match_start,P.match_length-M),P.lookahead-=P.match_length,P.match_length<=P.max_lazy_match&&P.lookahead>=M){for(P.match_length--;P.strstart++,P.ins_h=(P.ins_h<<P.hash_shift^P.window[P.strstart+M-1])&P.hash_mask,re=P.prev[P.strstart&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=P.strstart,--P.match_length!=0;);P.strstart++}else P.strstart+=P.match_length,P.match_length=0,P.ins_h=P.window[P.strstart],P.ins_h=(P.ins_h<<P.hash_shift^P.window[P.strstart+1])&P.hash_mask;else K=a._tr_tally(P,0,P.window[P.strstart]),P.lookahead--,P.strstart++;if(K&&(j(P,!1),P.strm.avail_out===0))return x}return P.insert=P.strstart<M-1?P.strstart:M-1,se===u?(j(P,!0),P.strm.avail_out===0?z:G):P.last_lit&&(j(P,!1),P.strm.avail_out===0)?x:N}function te(P,se){for(var re,K,ee;;){if(P.lookahead<O){if(W(P),P.lookahead<O&&se===h)return x;if(P.lookahead===0)break}if(re=0,P.lookahead>=M&&(P.ins_h=(P.ins_h<<P.hash_shift^P.window[P.strstart+M-1])&P.hash_mask,re=P.prev[P.strstart&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=P.strstart),P.prev_length=P.match_length,P.prev_match=P.match_start,P.match_length=M-1,re!==0&&P.prev_length<P.max_lazy_match&&P.strstart-re<=P.w_size-O&&(P.match_length=U(P,re),P.match_length<=5&&(P.strategy===1||P.match_length===M&&4096<P.strstart-P.match_start)&&(P.match_length=M-1)),P.prev_length>=M&&P.match_length<=P.prev_length){for(ee=P.strstart+P.lookahead-M,K=a._tr_tally(P,P.strstart-1-P.prev_match,P.prev_length-M),P.lookahead-=P.prev_length-1,P.prev_length-=2;++P.strstart<=ee&&(P.ins_h=(P.ins_h<<P.hash_shift^P.window[P.strstart+M-1])&P.hash_mask,re=P.prev[P.strstart&P.w_mask]=P.head[P.ins_h],P.head[P.ins_h]=P.strstart),--P.prev_length!=0;);if(P.match_available=0,P.match_length=M-1,P.strstart++,K&&(j(P,!1),P.strm.avail_out===0))return x}else if(P.match_available){if((K=a._tr_tally(P,0,P.window[P.strstart-1]))&&j(P,!1),P.strstart++,P.lookahead--,P.strm.avail_out===0)return x}else P.match_available=1,P.strstart++,P.lookahead--}return P.match_available&&(K=a._tr_tally(P,0,P.window[P.strstart-1]),P.match_available=0),P.insert=P.strstart<M-1?P.strstart:M-1,se===u?(j(P,!0),P.strm.avail_out===0?z:G):P.last_lit&&(j(P,!1),P.strm.avail_out===0)?x:N}function J(P,se,re,K,ee){this.good_length=P,this.max_lazy=se,this.nice_length=re,this.max_chain=K,this.func=ee}function oe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*A),this.dyn_dtree=new o.Buf16(2*(2*w+1)),this.bl_tree=new o.Buf16(2*(2*C+1)),B(this.dyn_ltree),B(this.dyn_dtree),B(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(D+1),this.heap=new o.Buf16(2*y+1),B(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*y+1),B(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function pe(P){var se;return P&&P.state?(P.total_in=P.total_out=0,P.data_type=b,(se=P.state).pending=0,se.pending_out=0,se.wrap<0&&(se.wrap=-se.wrap),se.status=se.wrap?F:V,P.adler=se.wrap===2?0:1,se.last_flush=h,a._tr_init(se),p):X(P,f)}function de(P){var se=pe(P);return se===p&&function(re){re.window_size=2*re.w_size,B(re.head),re.max_lazy_match=r[re.level].max_lazy,re.good_match=r[re.level].good_length,re.nice_match=r[re.level].nice_length,re.max_chain_length=r[re.level].max_chain,re.strstart=0,re.block_start=0,re.lookahead=0,re.insert=0,re.match_length=re.prev_length=M-1,re.match_available=0,re.ins_h=0}(P.state),se}function fe(P,se,re,K,ee,le){if(!P)return f;var xe=1;if(se===m&&(se=6),K<0?(xe=0,K=-K):15<K&&(xe=2,K-=16),ee<1||E<ee||re!==v||K<8||15<K||se<0||9<se||le<0||g<le)return X(P,f);K===8&&(K=9);var ge=new oe;return(P.state=ge).strm=P,ge.wrap=xe,ge.gzhead=null,ge.w_bits=K,ge.w_size=1<<ge.w_bits,ge.w_mask=ge.w_size-1,ge.hash_bits=ee+7,ge.hash_size=1<<ge.hash_bits,ge.hash_mask=ge.hash_size-1,ge.hash_shift=~~((ge.hash_bits+M-1)/M),ge.window=new o.Buf8(2*ge.w_size),ge.head=new o.Buf16(ge.hash_size),ge.prev=new o.Buf16(ge.w_size),ge.lit_bufsize=1<<ee+6,ge.pending_buf_size=4*ge.lit_bufsize,ge.pending_buf=new o.Buf8(ge.pending_buf_size),ge.d_buf=1*ge.lit_bufsize,ge.l_buf=3*ge.lit_bufsize,ge.level=se,ge.strategy=le,ge.method=re,de(P)}r=[new J(0,0,0,0,function(P,se){var re=65535;for(re>P.pending_buf_size-5&&(re=P.pending_buf_size-5);;){if(P.lookahead<=1){if(W(P),P.lookahead===0&&se===h)return x;if(P.lookahead===0)break}P.strstart+=P.lookahead,P.lookahead=0;var K=P.block_start+re;if((P.strstart===0||P.strstart>=K)&&(P.lookahead=P.strstart-K,P.strstart=K,j(P,!1),P.strm.avail_out===0)||P.strstart-P.block_start>=P.w_size-O&&(j(P,!1),P.strm.avail_out===0))return x}return P.insert=0,se===u?(j(P,!0),P.strm.avail_out===0?z:G):(P.strstart>P.block_start&&(j(P,!1),P.strm.avail_out),x)}),new J(4,4,8,4,Q),new J(4,5,16,8,Q),new J(4,6,32,32,Q),new J(4,4,16,16,te),new J(8,16,32,32,te),new J(8,16,128,128,te),new J(8,32,128,256,te),new J(32,128,258,1024,te),new J(32,258,258,4096,te)],n.deflateInit=function(P,se){return fe(P,se,v,15,8,0)},n.deflateInit2=fe,n.deflateReset=de,n.deflateResetKeep=pe,n.deflateSetHeader=function(P,se){return P&&P.state?P.state.wrap!==2?f:(P.state.gzhead=se,p):f},n.deflate=function(P,se){var re,K,ee,le;if(!P||!P.state||5<se||se<0)return P?X(P,f):f;if(K=P.state,!P.output||!P.input&&P.avail_in!==0||K.status===666&&se!==u)return X(P,P.avail_out===0?-5:f);if(K.strm=P,re=K.last_flush,K.last_flush=se,K.status===F)if(K.wrap===2)P.adler=0,$(K,31),$(K,139),$(K,8),K.gzhead?($(K,(K.gzhead.text?1:0)+(K.gzhead.hcrc?2:0)+(K.gzhead.extra?4:0)+(K.gzhead.name?8:0)+(K.gzhead.comment?16:0)),$(K,255&K.gzhead.time),$(K,K.gzhead.time>>8&255),$(K,K.gzhead.time>>16&255),$(K,K.gzhead.time>>24&255),$(K,K.level===9?2:2<=K.strategy||K.level<2?4:0),$(K,255&K.gzhead.os),K.gzhead.extra&&K.gzhead.extra.length&&($(K,255&K.gzhead.extra.length),$(K,K.gzhead.extra.length>>8&255)),K.gzhead.hcrc&&(P.adler=c(P.adler,K.pending_buf,K.pending,0)),K.gzindex=0,K.status=69):($(K,0),$(K,0),$(K,0),$(K,0),$(K,0),$(K,K.level===9?2:2<=K.strategy||K.level<2?4:0),$(K,3),K.status=V);else{var xe=v+(K.w_bits-8<<4)<<8;xe|=(2<=K.strategy||K.level<2?0:K.level<6?1:K.level===6?2:3)<<6,K.strstart!==0&&(xe|=32),xe+=31-xe%31,K.status=V,T(K,xe),K.strstart!==0&&(T(K,P.adler>>>16),T(K,65535&P.adler)),P.adler=1}if(K.status===69)if(K.gzhead.extra){for(ee=K.pending;K.gzindex<(65535&K.gzhead.extra.length)&&(K.pending!==K.pending_buf_size||(K.gzhead.hcrc&&K.pending>ee&&(P.adler=c(P.adler,K.pending_buf,K.pending-ee,ee)),R(P),ee=K.pending,K.pending!==K.pending_buf_size));)$(K,255&K.gzhead.extra[K.gzindex]),K.gzindex++;K.gzhead.hcrc&&K.pending>ee&&(P.adler=c(P.adler,K.pending_buf,K.pending-ee,ee)),K.gzindex===K.gzhead.extra.length&&(K.gzindex=0,K.status=73)}else K.status=73;if(K.status===73)if(K.gzhead.name){ee=K.pending;do{if(K.pending===K.pending_buf_size&&(K.gzhead.hcrc&&K.pending>ee&&(P.adler=c(P.adler,K.pending_buf,K.pending-ee,ee)),R(P),ee=K.pending,K.pending===K.pending_buf_size)){le=1;break}le=K.gzindex<K.gzhead.name.length?255&K.gzhead.name.charCodeAt(K.gzindex++):0,$(K,le)}while(le!==0);K.gzhead.hcrc&&K.pending>ee&&(P.adler=c(P.adler,K.pending_buf,K.pending-ee,ee)),le===0&&(K.gzindex=0,K.status=91)}else K.status=91;if(K.status===91)if(K.gzhead.comment){ee=K.pending;do{if(K.pending===K.pending_buf_size&&(K.gzhead.hcrc&&K.pending>ee&&(P.adler=c(P.adler,K.pending_buf,K.pending-ee,ee)),R(P),ee=K.pending,K.pending===K.pending_buf_size)){le=1;break}le=K.gzindex<K.gzhead.comment.length?255&K.gzhead.comment.charCodeAt(K.gzindex++):0,$(K,le)}while(le!==0);K.gzhead.hcrc&&K.pending>ee&&(P.adler=c(P.adler,K.pending_buf,K.pending-ee,ee)),le===0&&(K.status=103)}else K.status=103;if(K.status===103&&(K.gzhead.hcrc?(K.pending+2>K.pending_buf_size&&R(P),K.pending+2<=K.pending_buf_size&&($(K,255&P.adler),$(K,P.adler>>8&255),P.adler=0,K.status=V)):K.status=V),K.pending!==0){if(R(P),P.avail_out===0)return K.last_flush=-1,p}else if(P.avail_in===0&&k(se)<=k(re)&&se!==u)return X(P,-5);if(K.status===666&&P.avail_in!==0)return X(P,-5);if(P.avail_in!==0||K.lookahead!==0||se!==h&&K.status!==666){var ge=K.strategy===2?function(_e,Ue){for(var ke;;){if(_e.lookahead===0&&(W(_e),_e.lookahead===0)){if(Ue===h)return x;break}if(_e.match_length=0,ke=a._tr_tally(_e,0,_e.window[_e.strstart]),_e.lookahead--,_e.strstart++,ke&&(j(_e,!1),_e.strm.avail_out===0))return x}return _e.insert=0,Ue===u?(j(_e,!0),_e.strm.avail_out===0?z:G):_e.last_lit&&(j(_e,!1),_e.strm.avail_out===0)?x:N}(K,se):K.strategy===3?function(_e,Ue){for(var ke,je,Qe,Et,ht=_e.window;;){if(_e.lookahead<=I){if(W(_e),_e.lookahead<=I&&Ue===h)return x;if(_e.lookahead===0)break}if(_e.match_length=0,_e.lookahead>=M&&0<_e.strstart&&(je=ht[Qe=_e.strstart-1])===ht[++Qe]&&je===ht[++Qe]&&je===ht[++Qe]){Et=_e.strstart+I;do;while(je===ht[++Qe]&&je===ht[++Qe]&&je===ht[++Qe]&&je===ht[++Qe]&&je===ht[++Qe]&&je===ht[++Qe]&&je===ht[++Qe]&&je===ht[++Qe]&&Qe<Et);_e.match_length=I-(Et-Qe),_e.match_length>_e.lookahead&&(_e.match_length=_e.lookahead)}if(_e.match_length>=M?(ke=a._tr_tally(_e,1,_e.match_length-M),_e.lookahead-=_e.match_length,_e.strstart+=_e.match_length,_e.match_length=0):(ke=a._tr_tally(_e,0,_e.window[_e.strstart]),_e.lookahead--,_e.strstart++),ke&&(j(_e,!1),_e.strm.avail_out===0))return x}return _e.insert=0,Ue===u?(j(_e,!0),_e.strm.avail_out===0?z:G):_e.last_lit&&(j(_e,!1),_e.strm.avail_out===0)?x:N}(K,se):r[K.level].func(K,se);if(ge!==z&&ge!==G||(K.status=666),ge===x||ge===z)return P.avail_out===0&&(K.last_flush=-1),p;if(ge===N&&(se===1?a._tr_align(K):se!==5&&(a._tr_stored_block(K,0,0,!1),se===3&&(B(K.head),K.lookahead===0&&(K.strstart=0,K.block_start=0,K.insert=0))),R(P),P.avail_out===0))return K.last_flush=-1,p}return se!==u?p:K.wrap<=0?1:(K.wrap===2?($(K,255&P.adler),$(K,P.adler>>8&255),$(K,P.adler>>16&255),$(K,P.adler>>24&255),$(K,255&P.total_in),$(K,P.total_in>>8&255),$(K,P.total_in>>16&255),$(K,P.total_in>>24&255)):(T(K,P.adler>>>16),T(K,65535&P.adler)),R(P),0<K.wrap&&(K.wrap=-K.wrap),K.pending!==0?p:1)},n.deflateEnd=function(P){var se;return P&&P.state?(se=P.state.status)!==F&&se!==69&&se!==73&&se!==91&&se!==103&&se!==V&&se!==666?X(P,f):(P.state=null,se===V?X(P,-3):p):f},n.deflateSetDictionary=function(P,se){var re,K,ee,le,xe,ge,_e,Ue,ke=se.length;if(!P||!P.state||(le=(re=P.state).wrap)===2||le===1&&re.status!==F||re.lookahead)return f;for(le===1&&(P.adler=l(P.adler,se,ke,0)),re.wrap=0,ke>=re.w_size&&(le===0&&(B(re.head),re.strstart=0,re.block_start=0,re.insert=0),Ue=new o.Buf8(re.w_size),o.arraySet(Ue,se,ke-re.w_size,re.w_size,0),se=Ue,ke=re.w_size),xe=P.avail_in,ge=P.next_in,_e=P.input,P.avail_in=ke,P.next_in=0,P.input=se,W(re);re.lookahead>=M;){for(K=re.strstart,ee=re.lookahead-(M-1);re.ins_h=(re.ins_h<<re.hash_shift^re.window[K+M-1])&re.hash_mask,re.prev[K&re.w_mask]=re.head[re.ins_h],re.head[re.ins_h]=K,K++,--ee;);re.strstart=K,re.lookahead=M-1,W(re)}return re.strstart+=re.lookahead,re.block_start=re.strstart,re.insert=re.lookahead,re.lookahead=0,re.match_length=re.prev_length=M-1,re.match_available=0,P.next_in=ge,P.input=_e,P.avail_in=xe,re.wrap=le,p},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,i,n){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,i,n){i.exports=function(r,o){var a,l,c,d,h,u,p,f,m,g,b,v,E,y,w,C,A,D,M,I,O,F,V,x,N;a=r.state,l=r.next_in,x=r.input,c=l+(r.avail_in-5),d=r.next_out,N=r.output,h=d-(o-r.avail_out),u=d+(r.avail_out-257),p=a.dmax,f=a.wsize,m=a.whave,g=a.wnext,b=a.window,v=a.hold,E=a.bits,y=a.lencode,w=a.distcode,C=(1<<a.lenbits)-1,A=(1<<a.distbits)-1;e:do{E<15&&(v+=x[l++]<<E,E+=8,v+=x[l++]<<E,E+=8),D=y[v&C];t:for(;;){if(v>>>=M=D>>>24,E-=M,(M=D>>>16&255)===0)N[d++]=65535&D;else{if(!(16&M)){if(!(64&M)){D=y[(65535&D)+(v&(1<<M)-1)];continue t}if(32&M){a.mode=12;break e}r.msg="invalid literal/length code",a.mode=30;break e}I=65535&D,(M&=15)&&(E<M&&(v+=x[l++]<<E,E+=8),I+=v&(1<<M)-1,v>>>=M,E-=M),E<15&&(v+=x[l++]<<E,E+=8,v+=x[l++]<<E,E+=8),D=w[v&A];i:for(;;){if(v>>>=M=D>>>24,E-=M,!(16&(M=D>>>16&255))){if(!(64&M)){D=w[(65535&D)+(v&(1<<M)-1)];continue i}r.msg="invalid distance code",a.mode=30;break e}if(O=65535&D,E<(M&=15)&&(v+=x[l++]<<E,(E+=8)<M&&(v+=x[l++]<<E,E+=8)),p<(O+=v&(1<<M)-1)){r.msg="invalid distance too far back",a.mode=30;break e}if(v>>>=M,E-=M,(M=d-h)<O){if(m<(M=O-M)&&a.sane){r.msg="invalid distance too far back",a.mode=30;break e}if(V=b,(F=0)===g){if(F+=f-M,M<I){for(I-=M;N[d++]=b[F++],--M;);F=d-O,V=N}}else if(g<M){if(F+=f+g-M,(M-=g)<I){for(I-=M;N[d++]=b[F++],--M;);if(F=0,g<I){for(I-=M=g;N[d++]=b[F++],--M;);F=d-O,V=N}}}else if(F+=g-M,M<I){for(I-=M;N[d++]=b[F++],--M;);F=d-O,V=N}for(;2<I;)N[d++]=V[F++],N[d++]=V[F++],N[d++]=V[F++],I-=3;I&&(N[d++]=V[F++],1<I&&(N[d++]=V[F++]))}else{for(F=d-O;N[d++]=N[F++],N[d++]=N[F++],N[d++]=N[F++],2<(I-=3););I&&(N[d++]=N[F++],1<I&&(N[d++]=N[F++]))}break}}break}}while(l<c&&d<u);l-=I=E>>3,v&=(1<<(E-=I<<3))-1,r.next_in=l,r.next_out=d,r.avail_in=l<c?c-l+5:5-(l-c),r.avail_out=d<u?u-d+257:257-(d-u),a.hold=v,a.bits=E}},{}],49:[function(t,i,n){var r=t("../utils/common"),o=t("./adler32"),a=t("./crc32"),l=t("./inffast"),c=t("./inftrees"),d=1,h=2,u=0,p=-2,f=1,m=852,g=592;function b(F){return(F>>>24&255)+(F>>>8&65280)+((65280&F)<<8)+((255&F)<<24)}function v(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function E(F){var V;return F&&F.state?(V=F.state,F.total_in=F.total_out=V.total=0,F.msg="",V.wrap&&(F.adler=1&V.wrap),V.mode=f,V.last=0,V.havedict=0,V.dmax=32768,V.head=null,V.hold=0,V.bits=0,V.lencode=V.lendyn=new r.Buf32(m),V.distcode=V.distdyn=new r.Buf32(g),V.sane=1,V.back=-1,u):p}function y(F){var V;return F&&F.state?((V=F.state).wsize=0,V.whave=0,V.wnext=0,E(F)):p}function w(F,V){var x,N;return F&&F.state?(N=F.state,V<0?(x=0,V=-V):(x=1+(V>>4),V<48&&(V&=15)),V&&(V<8||15<V)?p:(N.window!==null&&N.wbits!==V&&(N.window=null),N.wrap=x,N.wbits=V,y(F))):p}function C(F,V){var x,N;return F?(N=new v,(F.state=N).window=null,(x=w(F,V))!==u&&(F.state=null),x):p}var A,D,M=!0;function I(F){if(M){var V;for(A=new r.Buf32(512),D=new r.Buf32(32),V=0;V<144;)F.lens[V++]=8;for(;V<256;)F.lens[V++]=9;for(;V<280;)F.lens[V++]=7;for(;V<288;)F.lens[V++]=8;for(c(d,F.lens,0,288,A,0,F.work,{bits:9}),V=0;V<32;)F.lens[V++]=5;c(h,F.lens,0,32,D,0,F.work,{bits:5}),M=!1}F.lencode=A,F.lenbits=9,F.distcode=D,F.distbits=5}function O(F,V,x,N){var z,G=F.state;return G.window===null&&(G.wsize=1<<G.wbits,G.wnext=0,G.whave=0,G.window=new r.Buf8(G.wsize)),N>=G.wsize?(r.arraySet(G.window,V,x-G.wsize,G.wsize,0),G.wnext=0,G.whave=G.wsize):(N<(z=G.wsize-G.wnext)&&(z=N),r.arraySet(G.window,V,x-N,z,G.wnext),(N-=z)?(r.arraySet(G.window,V,x-N,N,0),G.wnext=N,G.whave=G.wsize):(G.wnext+=z,G.wnext===G.wsize&&(G.wnext=0),G.whave<G.wsize&&(G.whave+=z))),0}n.inflateReset=y,n.inflateReset2=w,n.inflateResetKeep=E,n.inflateInit=function(F){return C(F,15)},n.inflateInit2=C,n.inflate=function(F,V){var x,N,z,G,X,k,B,R,j,$,T,U,W,Q,te,J,oe,pe,de,fe,P,se,re,K,ee=0,le=new r.Buf8(4),xe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!F||!F.state||!F.output||!F.input&&F.avail_in!==0)return p;(x=F.state).mode===12&&(x.mode=13),X=F.next_out,z=F.output,B=F.avail_out,G=F.next_in,N=F.input,k=F.avail_in,R=x.hold,j=x.bits,$=k,T=B,se=u;e:for(;;)switch(x.mode){case f:if(x.wrap===0){x.mode=13;break}for(;j<16;){if(k===0)break e;k--,R+=N[G++]<<j,j+=8}if(2&x.wrap&&R===35615){le[x.check=0]=255&R,le[1]=R>>>8&255,x.check=a(x.check,le,2,0),j=R=0,x.mode=2;break}if(x.flags=0,x.head&&(x.head.done=!1),!(1&x.wrap)||(((255&R)<<8)+(R>>8))%31){F.msg="incorrect header check",x.mode=30;break}if((15&R)!=8){F.msg="unknown compression method",x.mode=30;break}if(j-=4,P=8+(15&(R>>>=4)),x.wbits===0)x.wbits=P;else if(P>x.wbits){F.msg="invalid window size",x.mode=30;break}x.dmax=1<<P,F.adler=x.check=1,x.mode=512&R?10:12,j=R=0;break;case 2:for(;j<16;){if(k===0)break e;k--,R+=N[G++]<<j,j+=8}if(x.flags=R,(255&x.flags)!=8){F.msg="unknown compression method",x.mode=30;break}if(57344&x.flags){F.msg="unknown header flags set",x.mode=30;break}x.head&&(x.head.text=R>>8&1),512&x.flags&&(le[0]=255&R,le[1]=R>>>8&255,x.check=a(x.check,le,2,0)),j=R=0,x.mode=3;case 3:for(;j<32;){if(k===0)break e;k--,R+=N[G++]<<j,j+=8}x.head&&(x.head.time=R),512&x.flags&&(le[0]=255&R,le[1]=R>>>8&255,le[2]=R>>>16&255,le[3]=R>>>24&255,x.check=a(x.check,le,4,0)),j=R=0,x.mode=4;case 4:for(;j<16;){if(k===0)break e;k--,R+=N[G++]<<j,j+=8}x.head&&(x.head.xflags=255&R,x.head.os=R>>8),512&x.flags&&(le[0]=255&R,le[1]=R>>>8&255,x.check=a(x.check,le,2,0)),j=R=0,x.mode=5;case 5:if(1024&x.flags){for(;j<16;){if(k===0)break e;k--,R+=N[G++]<<j,j+=8}x.length=R,x.head&&(x.head.extra_len=R),512&x.flags&&(le[0]=255&R,le[1]=R>>>8&255,x.check=a(x.check,le,2,0)),j=R=0}else x.head&&(x.head.extra=null);x.mode=6;case 6:if(1024&x.flags&&(k<(U=x.length)&&(U=k),U&&(x.head&&(P=x.head.extra_len-x.length,x.head.extra||(x.head.extra=new Array(x.head.extra_len)),r.arraySet(x.head.extra,N,G,U,P)),512&x.flags&&(x.check=a(x.check,N,U,G)),k-=U,G+=U,x.length-=U),x.length))break e;x.length=0,x.mode=7;case 7:if(2048&x.flags){if(k===0)break e;for(U=0;P=N[G+U++],x.head&&P&&x.length<65536&&(x.head.name+=String.fromCharCode(P)),P&&U<k;);if(512&x.flags&&(x.check=a(x.check,N,U,G)),k-=U,G+=U,P)break e}else x.head&&(x.head.name=null);x.length=0,x.mode=8;case 8:if(4096&x.flags){if(k===0)break e;for(U=0;P=N[G+U++],x.head&&P&&x.length<65536&&(x.head.comment+=String.fromCharCode(P)),P&&U<k;);if(512&x.flags&&(x.check=a(x.check,N,U,G)),k-=U,G+=U,P)break e}else x.head&&(x.head.comment=null);x.mode=9;case 9:if(512&x.flags){for(;j<16;){if(k===0)break e;k--,R+=N[G++]<<j,j+=8}if(R!==(65535&x.check)){F.msg="header crc mismatch",x.mode=30;break}j=R=0}x.head&&(x.head.hcrc=x.flags>>9&1,x.head.done=!0),F.adler=x.check=0,x.mode=12;break;case 10:for(;j<32;){if(k===0)break e;k--,R+=N[G++]<<j,j+=8}F.adler=x.check=b(R),j=R=0,x.mode=11;case 11:if(x.havedict===0)return F.next_out=X,F.avail_out=B,F.next_in=G,F.avail_in=k,x.hold=R,x.bits=j,2;F.adler=x.check=1,x.mode=12;case 12:if(V===5||V===6)break e;case 13:if(x.last){R>>>=7&j,j-=7&j,x.mode=27;break}for(;j<3;){if(k===0)break e;k--,R+=N[G++]<<j,j+=8}switch(x.last=1&R,j-=1,3&(R>>>=1)){case 0:x.mode=14;break;case 1:if(I(x),x.mode=20,V!==6)break;R>>>=2,j-=2;break e;case 2:x.mode=17;break;case 3:F.msg="invalid block type",x.mode=30}R>>>=2,j-=2;break;case 14:for(R>>>=7&j,j-=7&j;j<32;){if(k===0)break e;k--,R+=N[G++]<<j,j+=8}if((65535&R)!=(R>>>16^65535)){F.msg="invalid stored block lengths",x.mode=30;break}if(x.length=65535&R,j=R=0,x.mode=15,V===6)break e;case 15:x.mode=16;case 16:if(U=x.length){if(k<U&&(U=k),B<U&&(U=B),U===0)break e;r.arraySet(z,N,G,U,X),k-=U,G+=U,B-=U,X+=U,x.length-=U;break}x.mode=12;break;case 17:for(;j<14;){if(k===0)break e;k--,R+=N[G++]<<j,j+=8}if(x.nlen=257+(31&R),R>>>=5,j-=5,x.ndist=1+(31&R),R>>>=5,j-=5,x.ncode=4+(15&R),R>>>=4,j-=4,286<x.nlen||30<x.ndist){F.msg="too many length or distance symbols",x.mode=30;break}x.have=0,x.mode=18;case 18:for(;x.have<x.ncode;){for(;j<3;){if(k===0)break e;k--,R+=N[G++]<<j,j+=8}x.lens[xe[x.have++]]=7&R,R>>>=3,j-=3}for(;x.have<19;)x.lens[xe[x.have++]]=0;if(x.lencode=x.lendyn,x.lenbits=7,re={bits:x.lenbits},se=c(0,x.lens,0,19,x.lencode,0,x.work,re),x.lenbits=re.bits,se){F.msg="invalid code lengths set",x.mode=30;break}x.have=0,x.mode=19;case 19:for(;x.have<x.nlen+x.ndist;){for(;J=(ee=x.lencode[R&(1<<x.lenbits)-1])>>>16&255,oe=65535&ee,!((te=ee>>>24)<=j);){if(k===0)break e;k--,R+=N[G++]<<j,j+=8}if(oe<16)R>>>=te,j-=te,x.lens[x.have++]=oe;else{if(oe===16){for(K=te+2;j<K;){if(k===0)break e;k--,R+=N[G++]<<j,j+=8}if(R>>>=te,j-=te,x.have===0){F.msg="invalid bit length repeat",x.mode=30;break}P=x.lens[x.have-1],U=3+(3&R),R>>>=2,j-=2}else if(oe===17){for(K=te+3;j<K;){if(k===0)break e;k--,R+=N[G++]<<j,j+=8}j-=te,P=0,U=3+(7&(R>>>=te)),R>>>=3,j-=3}else{for(K=te+7;j<K;){if(k===0)break e;k--,R+=N[G++]<<j,j+=8}j-=te,P=0,U=11+(127&(R>>>=te)),R>>>=7,j-=7}if(x.have+U>x.nlen+x.ndist){F.msg="invalid bit length repeat",x.mode=30;break}for(;U--;)x.lens[x.have++]=P}}if(x.mode===30)break;if(x.lens[256]===0){F.msg="invalid code -- missing end-of-block",x.mode=30;break}if(x.lenbits=9,re={bits:x.lenbits},se=c(d,x.lens,0,x.nlen,x.lencode,0,x.work,re),x.lenbits=re.bits,se){F.msg="invalid literal/lengths set",x.mode=30;break}if(x.distbits=6,x.distcode=x.distdyn,re={bits:x.distbits},se=c(h,x.lens,x.nlen,x.ndist,x.distcode,0,x.work,re),x.distbits=re.bits,se){F.msg="invalid distances set",x.mode=30;break}if(x.mode=20,V===6)break e;case 20:x.mode=21;case 21:if(6<=k&&258<=B){F.next_out=X,F.avail_out=B,F.next_in=G,F.avail_in=k,x.hold=R,x.bits=j,l(F,T),X=F.next_out,z=F.output,B=F.avail_out,G=F.next_in,N=F.input,k=F.avail_in,R=x.hold,j=x.bits,x.mode===12&&(x.back=-1);break}for(x.back=0;J=(ee=x.lencode[R&(1<<x.lenbits)-1])>>>16&255,oe=65535&ee,!((te=ee>>>24)<=j);){if(k===0)break e;k--,R+=N[G++]<<j,j+=8}if(J&&!(240&J)){for(pe=te,de=J,fe=oe;J=(ee=x.lencode[fe+((R&(1<<pe+de)-1)>>pe)])>>>16&255,oe=65535&ee,!(pe+(te=ee>>>24)<=j);){if(k===0)break e;k--,R+=N[G++]<<j,j+=8}R>>>=pe,j-=pe,x.back+=pe}if(R>>>=te,j-=te,x.back+=te,x.length=oe,J===0){x.mode=26;break}if(32&J){x.back=-1,x.mode=12;break}if(64&J){F.msg="invalid literal/length code",x.mode=30;break}x.extra=15&J,x.mode=22;case 22:if(x.extra){for(K=x.extra;j<K;){if(k===0)break e;k--,R+=N[G++]<<j,j+=8}x.length+=R&(1<<x.extra)-1,R>>>=x.extra,j-=x.extra,x.back+=x.extra}x.was=x.length,x.mode=23;case 23:for(;J=(ee=x.distcode[R&(1<<x.distbits)-1])>>>16&255,oe=65535&ee,!((te=ee>>>24)<=j);){if(k===0)break e;k--,R+=N[G++]<<j,j+=8}if(!(240&J)){for(pe=te,de=J,fe=oe;J=(ee=x.distcode[fe+((R&(1<<pe+de)-1)>>pe)])>>>16&255,oe=65535&ee,!(pe+(te=ee>>>24)<=j);){if(k===0)break e;k--,R+=N[G++]<<j,j+=8}R>>>=pe,j-=pe,x.back+=pe}if(R>>>=te,j-=te,x.back+=te,64&J){F.msg="invalid distance code",x.mode=30;break}x.offset=oe,x.extra=15&J,x.mode=24;case 24:if(x.extra){for(K=x.extra;j<K;){if(k===0)break e;k--,R+=N[G++]<<j,j+=8}x.offset+=R&(1<<x.extra)-1,R>>>=x.extra,j-=x.extra,x.back+=x.extra}if(x.offset>x.dmax){F.msg="invalid distance too far back",x.mode=30;break}x.mode=25;case 25:if(B===0)break e;if(U=T-B,x.offset>U){if((U=x.offset-U)>x.whave&&x.sane){F.msg="invalid distance too far back",x.mode=30;break}W=U>x.wnext?(U-=x.wnext,x.wsize-U):x.wnext-U,U>x.length&&(U=x.length),Q=x.window}else Q=z,W=X-x.offset,U=x.length;for(B<U&&(U=B),B-=U,x.length-=U;z[X++]=Q[W++],--U;);x.length===0&&(x.mode=21);break;case 26:if(B===0)break e;z[X++]=x.length,B--,x.mode=21;break;case 27:if(x.wrap){for(;j<32;){if(k===0)break e;k--,R|=N[G++]<<j,j+=8}if(T-=B,F.total_out+=T,x.total+=T,T&&(F.adler=x.check=x.flags?a(x.check,z,T,X-T):o(x.check,z,T,X-T)),T=B,(x.flags?R:b(R))!==x.check){F.msg="incorrect data check",x.mode=30;break}j=R=0}x.mode=28;case 28:if(x.wrap&&x.flags){for(;j<32;){if(k===0)break e;k--,R+=N[G++]<<j,j+=8}if(R!==(4294967295&x.total)){F.msg="incorrect length check",x.mode=30;break}j=R=0}x.mode=29;case 29:se=1;break e;case 30:se=-3;break e;case 31:return-4;case 32:default:return p}return F.next_out=X,F.avail_out=B,F.next_in=G,F.avail_in=k,x.hold=R,x.bits=j,(x.wsize||T!==F.avail_out&&x.mode<30&&(x.mode<27||V!==4))&&O(F,F.output,F.next_out,T-F.avail_out)?(x.mode=31,-4):($-=F.avail_in,T-=F.avail_out,F.total_in+=$,F.total_out+=T,x.total+=T,x.wrap&&T&&(F.adler=x.check=x.flags?a(x.check,z,T,F.next_out-T):o(x.check,z,T,F.next_out-T)),F.data_type=x.bits+(x.last?64:0)+(x.mode===12?128:0)+(x.mode===20||x.mode===15?256:0),($==0&&T===0||V===4)&&se===u&&(se=-5),se)},n.inflateEnd=function(F){if(!F||!F.state)return p;var V=F.state;return V.window&&(V.window=null),F.state=null,u},n.inflateGetHeader=function(F,V){var x;return F&&F.state&&2&(x=F.state).wrap?((x.head=V).done=!1,u):p},n.inflateSetDictionary=function(F,V){var x,N=V.length;return F&&F.state?(x=F.state).wrap!==0&&x.mode!==11?p:x.mode===11&&o(1,V,N,0)!==x.check?-3:O(F,V,N,N)?(x.mode=31,-4):(x.havedict=1,u):p},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,i,n){var r=t("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function(d,h,u,p,f,m,g,b){var v,E,y,w,C,A,D,M,I,O=b.bits,F=0,V=0,x=0,N=0,z=0,G=0,X=0,k=0,B=0,R=0,j=null,$=0,T=new r.Buf16(16),U=new r.Buf16(16),W=null,Q=0;for(F=0;F<=15;F++)T[F]=0;for(V=0;V<p;V++)T[h[u+V]]++;for(z=O,N=15;1<=N&&T[N]===0;N--);if(N<z&&(z=N),N===0)return f[m++]=20971520,f[m++]=20971520,b.bits=1,0;for(x=1;x<N&&T[x]===0;x++);for(z<x&&(z=x),F=k=1;F<=15;F++)if(k<<=1,(k-=T[F])<0)return-1;if(0<k&&(d===0||N!==1))return-1;for(U[1]=0,F=1;F<15;F++)U[F+1]=U[F]+T[F];for(V=0;V<p;V++)h[u+V]!==0&&(g[U[h[u+V]]++]=V);if(A=d===0?(j=W=g,19):d===1?(j=o,$-=257,W=a,Q-=257,256):(j=l,W=c,-1),F=x,C=m,X=V=R=0,y=-1,w=(B=1<<(G=z))-1,d===1&&852<B||d===2&&592<B)return 1;for(;;){for(D=F-X,I=g[V]<A?(M=0,g[V]):g[V]>A?(M=W[Q+g[V]],j[$+g[V]]):(M=96,0),v=1<<F-X,x=E=1<<G;f[C+(R>>X)+(E-=v)]=D<<24|M<<16|I|0,E!==0;);for(v=1<<F-1;R&v;)v>>=1;if(v!==0?(R&=v-1,R+=v):R=0,V++,--T[F]==0){if(F===N)break;F=h[u+g[V]]}if(z<F&&(R&w)!==y){for(X===0&&(X=z),C+=x,k=1<<(G=F-X);G+X<N&&!((k-=T[G+X])<=0);)G++,k<<=1;if(B+=1<<G,d===1&&852<B||d===2&&592<B)return 1;f[y=R&w]=z<<24|G<<16|C-m|0}}return R!==0&&(f[C+R]=F-X<<24|64<<16|0),b.bits=z,0}},{"../utils/common":41}],51:[function(t,i,n){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,i,n){var r=t("../utils/common"),o=0,a=1;function l(ee){for(var le=ee.length;0<=--le;)ee[le]=0}var c=0,d=29,h=256,u=h+1+d,p=30,f=19,m=2*u+1,g=15,b=16,v=7,E=256,y=16,w=17,C=18,A=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],D=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],I=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],O=new Array(2*(u+2));l(O);var F=new Array(2*p);l(F);var V=new Array(512);l(V);var x=new Array(256);l(x);var N=new Array(d);l(N);var z,G,X,k=new Array(p);function B(ee,le,xe,ge,_e){this.static_tree=ee,this.extra_bits=le,this.extra_base=xe,this.elems=ge,this.max_length=_e,this.has_stree=ee&&ee.length}function R(ee,le){this.dyn_tree=ee,this.max_code=0,this.stat_desc=le}function j(ee){return ee<256?V[ee]:V[256+(ee>>>7)]}function $(ee,le){ee.pending_buf[ee.pending++]=255&le,ee.pending_buf[ee.pending++]=le>>>8&255}function T(ee,le,xe){ee.bi_valid>b-xe?(ee.bi_buf|=le<<ee.bi_valid&65535,$(ee,ee.bi_buf),ee.bi_buf=le>>b-ee.bi_valid,ee.bi_valid+=xe-b):(ee.bi_buf|=le<<ee.bi_valid&65535,ee.bi_valid+=xe)}function U(ee,le,xe){T(ee,xe[2*le],xe[2*le+1])}function W(ee,le){for(var xe=0;xe|=1&ee,ee>>>=1,xe<<=1,0<--le;);return xe>>>1}function Q(ee,le,xe){var ge,_e,Ue=new Array(g+1),ke=0;for(ge=1;ge<=g;ge++)Ue[ge]=ke=ke+xe[ge-1]<<1;for(_e=0;_e<=le;_e++){var je=ee[2*_e+1];je!==0&&(ee[2*_e]=W(Ue[je]++,je))}}function te(ee){var le;for(le=0;le<u;le++)ee.dyn_ltree[2*le]=0;for(le=0;le<p;le++)ee.dyn_dtree[2*le]=0;for(le=0;le<f;le++)ee.bl_tree[2*le]=0;ee.dyn_ltree[2*E]=1,ee.opt_len=ee.static_len=0,ee.last_lit=ee.matches=0}function J(ee){8<ee.bi_valid?$(ee,ee.bi_buf):0<ee.bi_valid&&(ee.pending_buf[ee.pending++]=ee.bi_buf),ee.bi_buf=0,ee.bi_valid=0}function oe(ee,le,xe,ge){var _e=2*le,Ue=2*xe;return ee[_e]<ee[Ue]||ee[_e]===ee[Ue]&&ge[le]<=ge[xe]}function pe(ee,le,xe){for(var ge=ee.heap[xe],_e=xe<<1;_e<=ee.heap_len&&(_e<ee.heap_len&&oe(le,ee.heap[_e+1],ee.heap[_e],ee.depth)&&_e++,!oe(le,ge,ee.heap[_e],ee.depth));)ee.heap[xe]=ee.heap[_e],xe=_e,_e<<=1;ee.heap[xe]=ge}function de(ee,le,xe){var ge,_e,Ue,ke,je=0;if(ee.last_lit!==0)for(;ge=ee.pending_buf[ee.d_buf+2*je]<<8|ee.pending_buf[ee.d_buf+2*je+1],_e=ee.pending_buf[ee.l_buf+je],je++,ge===0?U(ee,_e,le):(U(ee,(Ue=x[_e])+h+1,le),(ke=A[Ue])!==0&&T(ee,_e-=N[Ue],ke),U(ee,Ue=j(--ge),xe),(ke=D[Ue])!==0&&T(ee,ge-=k[Ue],ke)),je<ee.last_lit;);U(ee,E,le)}function fe(ee,le){var xe,ge,_e,Ue=le.dyn_tree,ke=le.stat_desc.static_tree,je=le.stat_desc.has_stree,Qe=le.stat_desc.elems,Et=-1;for(ee.heap_len=0,ee.heap_max=m,xe=0;xe<Qe;xe++)Ue[2*xe]!==0?(ee.heap[++ee.heap_len]=Et=xe,ee.depth[xe]=0):Ue[2*xe+1]=0;for(;ee.heap_len<2;)Ue[2*(_e=ee.heap[++ee.heap_len]=Et<2?++Et:0)]=1,ee.depth[_e]=0,ee.opt_len--,je&&(ee.static_len-=ke[2*_e+1]);for(le.max_code=Et,xe=ee.heap_len>>1;1<=xe;xe--)pe(ee,Ue,xe);for(_e=Qe;xe=ee.heap[1],ee.heap[1]=ee.heap[ee.heap_len--],pe(ee,Ue,1),ge=ee.heap[1],ee.heap[--ee.heap_max]=xe,ee.heap[--ee.heap_max]=ge,Ue[2*_e]=Ue[2*xe]+Ue[2*ge],ee.depth[_e]=(ee.depth[xe]>=ee.depth[ge]?ee.depth[xe]:ee.depth[ge])+1,Ue[2*xe+1]=Ue[2*ge+1]=_e,ee.heap[1]=_e++,pe(ee,Ue,1),2<=ee.heap_len;);ee.heap[--ee.heap_max]=ee.heap[1],function(ht,ni){var Kt,It,ci,Ct,ti,ot,yi=ni.dyn_tree,dn=ni.max_code,Fe=ni.stat_desc.static_tree,he=ni.stat_desc.has_stree,we=ni.stat_desc.extra_bits,it=ni.stat_desc.extra_base,ut=ni.stat_desc.max_length,Ut=0;for(Ct=0;Ct<=g;Ct++)ht.bl_count[Ct]=0;for(yi[2*ht.heap[ht.heap_max]+1]=0,Kt=ht.heap_max+1;Kt<m;Kt++)ut<(Ct=yi[2*yi[2*(It=ht.heap[Kt])+1]+1]+1)&&(Ct=ut,Ut++),yi[2*It+1]=Ct,dn<It||(ht.bl_count[Ct]++,ti=0,it<=It&&(ti=we[It-it]),ot=yi[2*It],ht.opt_len+=ot*(Ct+ti),he&&(ht.static_len+=ot*(Fe[2*It+1]+ti)));if(Ut!==0){do{for(Ct=ut-1;ht.bl_count[Ct]===0;)Ct--;ht.bl_count[Ct]--,ht.bl_count[Ct+1]+=2,ht.bl_count[ut]--,Ut-=2}while(0<Ut);for(Ct=ut;Ct!==0;Ct--)for(It=ht.bl_count[Ct];It!==0;)dn<(ci=ht.heap[--Kt])||(yi[2*ci+1]!==Ct&&(ht.opt_len+=(Ct-yi[2*ci+1])*yi[2*ci],yi[2*ci+1]=Ct),It--)}}(ee,le),Q(Ue,Et,ee.bl_count)}function P(ee,le,xe){var ge,_e,Ue=-1,ke=le[1],je=0,Qe=7,Et=4;for(ke===0&&(Qe=138,Et=3),le[2*(xe+1)+1]=65535,ge=0;ge<=xe;ge++)_e=ke,ke=le[2*(ge+1)+1],++je<Qe&&_e===ke||(je<Et?ee.bl_tree[2*_e]+=je:_e!==0?(_e!==Ue&&ee.bl_tree[2*_e]++,ee.bl_tree[2*y]++):je<=10?ee.bl_tree[2*w]++:ee.bl_tree[2*C]++,Ue=_e,Et=(je=0)===ke?(Qe=138,3):_e===ke?(Qe=6,3):(Qe=7,4))}function se(ee,le,xe){var ge,_e,Ue=-1,ke=le[1],je=0,Qe=7,Et=4;for(ke===0&&(Qe=138,Et=3),ge=0;ge<=xe;ge++)if(_e=ke,ke=le[2*(ge+1)+1],!(++je<Qe&&_e===ke)){if(je<Et)for(;U(ee,_e,ee.bl_tree),--je!=0;);else _e!==0?(_e!==Ue&&(U(ee,_e,ee.bl_tree),je--),U(ee,y,ee.bl_tree),T(ee,je-3,2)):je<=10?(U(ee,w,ee.bl_tree),T(ee,je-3,3)):(U(ee,C,ee.bl_tree),T(ee,je-11,7));Ue=_e,Et=(je=0)===ke?(Qe=138,3):_e===ke?(Qe=6,3):(Qe=7,4)}}l(k);var re=!1;function K(ee,le,xe,ge){T(ee,(c<<1)+(ge?1:0),3),function(_e,Ue,ke,je){J(_e),$(_e,ke),$(_e,~ke),r.arraySet(_e.pending_buf,_e.window,Ue,ke,_e.pending),_e.pending+=ke}(ee,le,xe)}n._tr_init=function(ee){re||(function(){var le,xe,ge,_e,Ue,ke=new Array(g+1);for(_e=ge=0;_e<d-1;_e++)for(N[_e]=ge,le=0;le<1<<A[_e];le++)x[ge++]=_e;for(x[ge-1]=_e,_e=Ue=0;_e<16;_e++)for(k[_e]=Ue,le=0;le<1<<D[_e];le++)V[Ue++]=_e;for(Ue>>=7;_e<p;_e++)for(k[_e]=Ue<<7,le=0;le<1<<D[_e]-7;le++)V[256+Ue++]=_e;for(xe=0;xe<=g;xe++)ke[xe]=0;for(le=0;le<=143;)O[2*le+1]=8,le++,ke[8]++;for(;le<=255;)O[2*le+1]=9,le++,ke[9]++;for(;le<=279;)O[2*le+1]=7,le++,ke[7]++;for(;le<=287;)O[2*le+1]=8,le++,ke[8]++;for(Q(O,u+1,ke),le=0;le<p;le++)F[2*le+1]=5,F[2*le]=W(le,5);z=new B(O,A,h+1,u,g),G=new B(F,D,0,p,g),X=new B(new Array(0),M,0,f,v)}(),re=!0),ee.l_desc=new R(ee.dyn_ltree,z),ee.d_desc=new R(ee.dyn_dtree,G),ee.bl_desc=new R(ee.bl_tree,X),ee.bi_buf=0,ee.bi_valid=0,te(ee)},n._tr_stored_block=K,n._tr_flush_block=function(ee,le,xe,ge){var _e,Ue,ke=0;0<ee.level?(ee.strm.data_type===2&&(ee.strm.data_type=function(je){var Qe,Et=4093624447;for(Qe=0;Qe<=31;Qe++,Et>>>=1)if(1&Et&&je.dyn_ltree[2*Qe]!==0)return o;if(je.dyn_ltree[18]!==0||je.dyn_ltree[20]!==0||je.dyn_ltree[26]!==0)return a;for(Qe=32;Qe<h;Qe++)if(je.dyn_ltree[2*Qe]!==0)return a;return o}(ee)),fe(ee,ee.l_desc),fe(ee,ee.d_desc),ke=function(je){var Qe;for(P(je,je.dyn_ltree,je.l_desc.max_code),P(je,je.dyn_dtree,je.d_desc.max_code),fe(je,je.bl_desc),Qe=f-1;3<=Qe&&je.bl_tree[2*I[Qe]+1]===0;Qe--);return je.opt_len+=3*(Qe+1)+5+5+4,Qe}(ee),_e=ee.opt_len+3+7>>>3,(Ue=ee.static_len+3+7>>>3)<=_e&&(_e=Ue)):_e=Ue=xe+5,xe+4<=_e&&le!==-1?K(ee,le,xe,ge):ee.strategy===4||Ue===_e?(T(ee,2+(ge?1:0),3),de(ee,O,F)):(T(ee,4+(ge?1:0),3),function(je,Qe,Et,ht){var ni;for(T(je,Qe-257,5),T(je,Et-1,5),T(je,ht-4,4),ni=0;ni<ht;ni++)T(je,je.bl_tree[2*I[ni]+1],3);se(je,je.dyn_ltree,Qe-1),se(je,je.dyn_dtree,Et-1)}(ee,ee.l_desc.max_code+1,ee.d_desc.max_code+1,ke+1),de(ee,ee.dyn_ltree,ee.dyn_dtree)),te(ee),ge&&J(ee)},n._tr_tally=function(ee,le,xe){return ee.pending_buf[ee.d_buf+2*ee.last_lit]=le>>>8&255,ee.pending_buf[ee.d_buf+2*ee.last_lit+1]=255&le,ee.pending_buf[ee.l_buf+ee.last_lit]=255&xe,ee.last_lit++,le===0?ee.dyn_ltree[2*xe]++:(ee.matches++,le--,ee.dyn_ltree[2*(x[xe]+h+1)]++,ee.dyn_dtree[2*j(le)]++),ee.last_lit===ee.lit_bufsize-1},n._tr_align=function(ee){T(ee,2,3),U(ee,E,O),function(le){le.bi_valid===16?($(le,le.bi_buf),le.bi_buf=0,le.bi_valid=0):8<=le.bi_valid&&(le.pending_buf[le.pending++]=255&le.bi_buf,le.bi_buf>>=8,le.bi_valid-=8)}(ee)}},{"../utils/common":41}],53:[function(t,i,n){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,i,n){(function(r){(function(o,a){if(!o.setImmediate){var l,c,d,h,u=1,p={},f=!1,m=o.document,g=Object.getPrototypeOf&&Object.getPrototypeOf(o);g=g&&g.setTimeout?g:o,l={}.toString.call(o.process)==="[object process]"?function(y){process.nextTick(function(){v(y)})}:function(){if(o.postMessage&&!o.importScripts){var y=!0,w=o.onmessage;return o.onmessage=function(){y=!1},o.postMessage("","*"),o.onmessage=w,y}}()?(h="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",E,!1):o.attachEvent("onmessage",E),function(y){o.postMessage(h+y,"*")}):o.MessageChannel?((d=new MessageChannel).port1.onmessage=function(y){v(y.data)},function(y){d.port2.postMessage(y)}):m&&"onreadystatechange"in m.createElement("script")?(c=m.documentElement,function(y){var w=m.createElement("script");w.onreadystatechange=function(){v(y),w.onreadystatechange=null,c.removeChild(w),w=null},c.appendChild(w)}):function(y){setTimeout(v,0,y)},g.setImmediate=function(y){typeof y!="function"&&(y=new Function(""+y));for(var w=new Array(arguments.length-1),C=0;C<w.length;C++)w[C]=arguments[C+1];var A={callback:y,args:w};return p[u]=A,l(u),u++},g.clearImmediate=b}function b(y){delete p[y]}function v(y){if(f)setTimeout(v,0,y);else{var w=p[y];if(w){f=!0;try{(function(C){var A=C.callback,D=C.args;switch(D.length){case 0:A();break;case 1:A(D[0]);break;case 2:A(D[0],D[1]);break;case 3:A(D[0],D[1],D[2]);break;default:A.apply(a,D)}})(w)}finally{b(y),f=!1}}}}function E(y){y.source===o&&typeof y.data=="string"&&y.data.indexOf(h)===0&&v(+y.data.slice(h.length))}})(typeof self>"u"?r===void 0?this:r:self)}).call(this,typeof mp<"u"?mp:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(iC);var LR=iC.exports,v1=DR(LR),Pb={},Xp={};(function(s){let e=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",t=e+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",i="["+e+"]["+t+"]*",n=new RegExp("^"+i+"$"),r=function(a,l){let c=[],d=l.exec(a);for(;d;){let h=[];h.startIndex=l.lastIndex-d[0].length;let u=d.length;for(let p=0;p<u;p++)h.push(d[p]);c.push(h),d=l.exec(a)}return c},o=function(a){let l=n.exec(a);return!(l===null||typeof l>"u")};s.isExist=function(a){return typeof a<"u"},s.isEmptyObject=function(a){return Object.keys(a).length===0},s.merge=function(a,l,c){if(l){let d=Object.keys(l),h=d.length;for(let u=0;u<h;u++)c==="strict"?a[d[u]]=[l[d[u]]]:a[d[u]]=l[d[u]]}},s.getValue=function(a){return s.isExist(a)?a:""},s.isName=o,s.getAllMatches=r,s.nameRegexp=i})(Xp);var Ob=Xp,FR={allowBooleanAttributes:!1,unpairedTags:[]};Pb.validate=function(s,e){e=Object.assign({},FR,e);let t=[],i=!1,n=!1;s[0]==="\uFEFF"&&(s=s.substr(1));for(let r=0;r<s.length;r++)if(s[r]==="<"&&s[r+1]==="?"){if(r+=2,r=_1(s,r),r.err)return r}else if(s[r]==="<"){let o=r;if(r++,s[r]==="!"){r=w1(s,r);continue}else{let a=!1;s[r]==="/"&&(a=!0,r++);let l="";for(;r<s.length&&s[r]!==">"&&s[r]!==" "&&s[r]!=="	"&&s[r]!==`
`&&s[r]!=="\r";r++)l+=s[r];if(l=l.trim(),l[l.length-1]==="/"&&(l=l.substring(0,l.length-1),r--),!HR(l)){let h;return l.trim().length===0?h="Invalid space after '<'.":h="Tag '"+l+"' is an invalid name.",Ri("InvalidTag",h,En(s,r))}let c=UR(s,r);if(c===!1)return Ri("InvalidAttr","Attributes for '"+l+"' have open quote.",En(s,r));let d=c.value;if(r=c.index,d[d.length-1]==="/"){let h=r-d.length;d=d.substring(0,d.length-1);let u=E1(d,e);if(u===!0)i=!0;else return Ri(u.err.code,u.err.msg,En(s,h+u.err.line))}else if(a)if(c.tagClosed){if(d.trim().length>0)return Ri("InvalidTag","Closing tag '"+l+"' can't have attributes or invalid starting.",En(s,o));if(t.length===0)return Ri("InvalidTag","Closing tag '"+l+"' has not been opened.",En(s,o));{let h=t.pop();if(l!==h.tagName){let u=En(s,h.tagStartPos);return Ri("InvalidTag","Expected closing tag '"+h.tagName+"' (opened in line "+u.line+", col "+u.col+") instead of closing tag '"+l+"'.",En(s,o))}t.length==0&&(n=!0)}}else return Ri("InvalidTag","Closing tag '"+l+"' doesn't have proper closing.",En(s,r));else{let h=E1(d,e);if(h!==!0)return Ri(h.err.code,h.err.msg,En(s,r-d.length+h.err.line));if(n===!0)return Ri("InvalidXml","Multiple possible root nodes found.",En(s,r));e.unpairedTags.indexOf(l)!==-1||t.push({tagName:l,tagStartPos:o}),i=!0}for(r++;r<s.length;r++)if(s[r]==="<")if(s[r+1]==="!"){r++,r=w1(s,r);continue}else if(s[r+1]==="?"){if(r=_1(s,++r),r.err)return r}else break;else if(s[r]==="&"){let h=VR(s,r);if(h==-1)return Ri("InvalidChar","char '&' is not expected.",En(s,r));r=h}else if(n===!0&&!y1(s[r]))return Ri("InvalidXml","Extra text at the end",En(s,r));s[r]==="<"&&r--}}else{if(y1(s[r]))continue;return Ri("InvalidChar","char '"+s[r]+"' is not expected.",En(s,r))}if(i){if(t.length==1)return Ri("InvalidTag","Unclosed tag '"+t[0].tagName+"'.",En(s,t[0].tagStartPos));if(t.length>0)return Ri("InvalidXml","Invalid '"+JSON.stringify(t.map(r=>r.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return Ri("InvalidXml","Start tag expected.",1);return!0};function y1(s){return s===" "||s==="	"||s===`
`||s==="\r"}function _1(s,e){let t=e;for(;e<s.length;e++)if(s[e]=="?"||s[e]==" "){let i=s.substr(t,e-t);if(e>5&&i==="xml")return Ri("InvalidXml","XML declaration allowed only at the start of the document.",En(s,e));if(s[e]=="?"&&s[e+1]==">"){e++;break}else continue}return e}function w1(s,e){if(s.length>e+5&&s[e+1]==="-"&&s[e+2]==="-"){for(e+=3;e<s.length;e++)if(s[e]==="-"&&s[e+1]==="-"&&s[e+2]===">"){e+=2;break}}else if(s.length>e+8&&s[e+1]==="D"&&s[e+2]==="O"&&s[e+3]==="C"&&s[e+4]==="T"&&s[e+5]==="Y"&&s[e+6]==="P"&&s[e+7]==="E"){let t=1;for(e+=8;e<s.length;e++)if(s[e]==="<")t++;else if(s[e]===">"&&(t--,t===0))break}else if(s.length>e+9&&s[e+1]==="["&&s[e+2]==="C"&&s[e+3]==="D"&&s[e+4]==="A"&&s[e+5]==="T"&&s[e+6]==="A"&&s[e+7]==="["){for(e+=8;e<s.length;e++)if(s[e]==="]"&&s[e+1]==="]"&&s[e+2]===">"){e+=2;break}}return e}var kR='"',NR="'";function UR(s,e){let t="",i="",n=!1;for(;e<s.length;e++){if(s[e]===kR||s[e]===NR)i===""?i=s[e]:i!==s[e]||(i="");else if(s[e]===">"&&i===""){n=!0;break}t+=s[e]}return i!==""?!1:{value:t,index:e,tagClosed:n}}var BR=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function E1(s,e){let t=Ob.getAllMatches(s,BR),i={};for(let n=0;n<t.length;n++){if(t[n][1].length===0)return Ri("InvalidAttr","Attribute '"+t[n][2]+"' has no space in starting.",xh(t[n]));if(t[n][3]!==void 0&&t[n][4]===void 0)return Ri("InvalidAttr","Attribute '"+t[n][2]+"' is without value.",xh(t[n]));if(t[n][3]===void 0&&!e.allowBooleanAttributes)return Ri("InvalidAttr","boolean attribute '"+t[n][2]+"' is not allowed.",xh(t[n]));let r=t[n][2];if(!jR(r))return Ri("InvalidAttr","Attribute '"+r+"' is an invalid name.",xh(t[n]));if(!i.hasOwnProperty(r))i[r]=1;else return Ri("InvalidAttr","Attribute '"+r+"' is repeated.",xh(t[n]))}return!0}function zR(s,e){let t=/\d/;for(s[e]==="x"&&(e++,t=/[\da-fA-F]/);e<s.length;e++){if(s[e]===";")return e;if(!s[e].match(t))break}return-1}function VR(s,e){if(e++,s[e]===";")return-1;if(s[e]==="#")return e++,zR(s,e);let t=0;for(;e<s.length;e++,t++)if(!(s[e].match(/\w/)&&t<20)){if(s[e]===";")break;return-1}return e}function Ri(s,e,t){return{err:{code:s,msg:e,line:t.line||t,col:t.col}}}function jR(s){return Ob.isName(s)}function HR(s){return Ob.isName(s)}function En(s,e){let t=s.substring(0,e).split(/\r?\n/);return{line:t.length,col:t[t.length-1].length+1}}function xh(s){return s.startIndex+s[1].length}var Mb={},nC={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(s,e){return e},attributeValueProcessor:function(s,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(s,e,t){return s}},GR=function(s){return Object.assign({},nC,s)};Mb.buildOptions=GR;Mb.defaultOptions=nC;var V0=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:t})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}},WR=V0,YR=Xp;function qR(s,e){let t={};if(s[e+3]==="O"&&s[e+4]==="C"&&s[e+5]==="T"&&s[e+6]==="Y"&&s[e+7]==="P"&&s[e+8]==="E"){e=e+9;let i=1,n=!1,r=!1,o="";for(;e<s.length;e++)if(s[e]==="<"&&!r){if(n&&$R(s,e))e+=7,[entityName,val,e]=XR(s,e+1),val.indexOf("&")===-1&&(t[eD(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(n&&ZR(s,e))e+=8;else if(n&&QR(s,e))e+=8;else if(n&&JR(s,e))e+=9;else if(KR)r=!0;else throw new Error("Invalid DOCTYPE");i++,o=""}else if(s[e]===">"){if(r?s[e-1]==="-"&&s[e-2]==="-"&&(r=!1,i--):i--,i===0)break}else s[e]==="["?n=!0:o+=s[e];if(i!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:t,i:e}}function XR(s,e){let t="";for(;e<s.length&&s[e]!=="'"&&s[e]!=='"';e++)t+=s[e];if(t=t.trim(),t.indexOf(" ")!==-1)throw new Error("External entites are not supported");let i=s[e++],n="";for(;e<s.length&&s[e]!==i;e++)n+=s[e];return[t,n,e]}function KR(s,e){return s[e+1]==="!"&&s[e+2]==="-"&&s[e+3]==="-"}function $R(s,e){return s[e+1]==="!"&&s[e+2]==="E"&&s[e+3]==="N"&&s[e+4]==="T"&&s[e+5]==="I"&&s[e+6]==="T"&&s[e+7]==="Y"}function ZR(s,e){return s[e+1]==="!"&&s[e+2]==="E"&&s[e+3]==="L"&&s[e+4]==="E"&&s[e+5]==="M"&&s[e+6]==="E"&&s[e+7]==="N"&&s[e+8]==="T"}function QR(s,e){return s[e+1]==="!"&&s[e+2]==="A"&&s[e+3]==="T"&&s[e+4]==="T"&&s[e+5]==="L"&&s[e+6]==="I"&&s[e+7]==="S"&&s[e+8]==="T"}function JR(s,e){return s[e+1]==="!"&&s[e+2]==="N"&&s[e+3]==="O"&&s[e+4]==="T"&&s[e+5]==="A"&&s[e+6]==="T"&&s[e+7]==="I"&&s[e+8]==="O"&&s[e+9]==="N"}function eD(s){if(YR.isName(s))return s;throw new Error(`Invalid entity name ${s}`)}var tD=qR,iD=/^[-+]?0x[a-fA-F0-9]+$/,nD=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt);!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);var sD={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function rD(s,e={}){if(e=Object.assign({},sD,e),!s||typeof s!="string")return s;let t=s.trim();if(e.skipLike!==void 0&&e.skipLike.test(t))return s;if(e.hex&&iD.test(t))return Number.parseInt(t,16);{let i=nD.exec(t);if(i){let n=i[1],r=i[2],o=oD(i[3]),a=i[4]||i[6];if(!e.leadingZeros&&r.length>0&&n&&t[2]!=="."||!e.leadingZeros&&r.length>0&&!n&&t[1]!==".")return s;{let l=Number(t),c=""+l;return c.search(/[eE]/)!==-1||a?e.eNotation?l:s:t.indexOf(".")!==-1?c==="0"&&o===""||c===o||n&&c==="-"+o?l:s:r?o===c||n+o===c?l:s:t===c||t===n+c?l:s}}else return s}}function oD(s){return s&&s.indexOf(".")!==-1&&(s=s.replace(/0+$/,""),s==="."?s="0":s[0]==="."?s="0"+s:s[s.length-1]==="."&&(s=s.substr(0,s.length-1))),s}var aD=rD,sC=Xp,Sh=WR,lD=tD,cD=aD,hD=class{constructor(s){this.options=s,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"\xA2"},pound:{regex:/&(pound|#163);/g,val:"\xA3"},yen:{regex:/&(yen|#165);/g,val:"\xA5"},euro:{regex:/&(euro|#8364);/g,val:"\u20AC"},copyright:{regex:/&(copy|#169);/g,val:"\xA9"},reg:{regex:/&(reg|#174);/g,val:"\xAE"},inr:{regex:/&(inr|#8377);/g,val:"\u20B9"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(e,t)=>String.fromCharCode(Number.parseInt(t,16))}},this.addExternalEntities=dD,this.parseXml=gD,this.parseTextData=uD,this.resolveNameSpace=pD,this.buildAttributesMap=mD,this.isItStopNode=_D,this.replaceEntitiesValue=vD,this.readStopNodeData=ED,this.saveTextToParentTag=yD,this.addChild=bD}};function dD(s){let e=Object.keys(s);for(let t=0;t<e.length;t++){let i=e[t];this.lastEntities[i]={regex:new RegExp("&"+i+";","g"),val:s[i]}}}function uD(s,e,t,i,n,r,o){if(s!==void 0&&(this.options.trimValues&&!i&&(s=s.trim()),s.length>0)){o||(s=this.replaceEntitiesValue(s));let a=this.options.tagValueProcessor(e,s,t,n,r);return a==null?s:typeof a!=typeof s||a!==s?a:this.options.trimValues?H0(s,this.options.parseTagValue,this.options.numberParseOptions):s.trim()===s?H0(s,this.options.parseTagValue,this.options.numberParseOptions):s}}function pD(s){if(this.options.removeNSPrefix){let e=s.split(":"),t=s.charAt(0)==="/"?"/":"";if(e[0]==="xmlns")return"";e.length===2&&(s=t+e[1])}return s}var fD=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function mD(s,e,t){if(!this.options.ignoreAttributes&&typeof s=="string"){let i=sC.getAllMatches(s,fD),n=i.length,r={};for(let o=0;o<n;o++){let a=this.resolveNameSpace(i[o][1]),l=i[o][4],c=this.options.attributeNamePrefix+a;if(a.length)if(this.options.transformAttributeName&&(c=this.options.transformAttributeName(c)),c==="__proto__"&&(c="#__proto__"),l!==void 0){this.options.trimValues&&(l=l.trim()),l=this.replaceEntitiesValue(l);let d=this.options.attributeValueProcessor(a,l,e);d==null?r[c]=l:typeof d!=typeof l||d!==l?r[c]=d:r[c]=H0(l,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(r[c]=!0)}if(!Object.keys(r).length)return;if(this.options.attributesGroupName){let o={};return o[this.options.attributesGroupName]=r,o}return r}}var gD=function(s){s=s.replace(/\r\n?/g,`
`);let e=new Sh("!xml"),t=e,i="",n="";for(let r=0;r<s.length;r++)if(s[r]==="<")if(s[r+1]==="/"){let o=ma(s,">",r,"Closing Tag is not closed."),a=s.substring(r+2,o).trim();if(this.options.removeNSPrefix){let d=a.indexOf(":");d!==-1&&(a=a.substr(d+1))}this.options.transformTagName&&(a=this.options.transformTagName(a)),t&&(i=this.saveTextToParentTag(i,t,n));let l=n.substring(n.lastIndexOf(".")+1);if(a&&this.options.unpairedTags.indexOf(a)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${a}>`);let c=0;l&&this.options.unpairedTags.indexOf(l)!==-1?(c=n.lastIndexOf(".",n.lastIndexOf(".")-1),this.tagsNodeStack.pop()):c=n.lastIndexOf("."),n=n.substring(0,c),t=this.tagsNodeStack.pop(),i="",r=o}else if(s[r+1]==="?"){let o=j0(s,r,!1,"?>");if(!o)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,t,n),!(this.options.ignoreDeclaration&&o.tagName==="?xml"||this.options.ignorePiTags)){let a=new Sh(o.tagName);a.add(this.options.textNodeName,""),o.tagName!==o.tagExp&&o.attrExpPresent&&(a[":@"]=this.buildAttributesMap(o.tagExp,n,o.tagName)),this.addChild(t,a,n)}r=o.closeIndex+1}else if(s.substr(r+1,3)==="!--"){let o=ma(s,"-->",r+4,"Comment is not closed.");if(this.options.commentPropName){let a=s.substring(r+4,o-2);i=this.saveTextToParentTag(i,t,n),t.add(this.options.commentPropName,[{[this.options.textNodeName]:a}])}r=o}else if(s.substr(r+1,2)==="!D"){let o=lD(s,r);this.docTypeEntities=o.entities,r=o.i}else if(s.substr(r+1,2)==="!["){let o=ma(s,"]]>",r,"CDATA is not closed.")-2,a=s.substring(r+9,o);i=this.saveTextToParentTag(i,t,n);let l=this.parseTextData(a,t.tagname,n,!0,!1,!0,!0);l==null&&(l=""),this.options.cdataPropName?t.add(this.options.cdataPropName,[{[this.options.textNodeName]:a}]):t.add(this.options.textNodeName,l),r=o+2}else{let o=j0(s,r,this.options.removeNSPrefix),a=o.tagName,l=o.rawTagName,c=o.tagExp,d=o.attrExpPresent,h=o.closeIndex;this.options.transformTagName&&(a=this.options.transformTagName(a)),t&&i&&t.tagname!=="!xml"&&(i=this.saveTextToParentTag(i,t,n,!1));let u=t;if(u&&this.options.unpairedTags.indexOf(u.tagname)!==-1&&(t=this.tagsNodeStack.pop(),n=n.substring(0,n.lastIndexOf("."))),a!==e.tagname&&(n+=n?"."+a:a),this.isItStopNode(this.options.stopNodes,n,a)){let p="";if(c.length>0&&c.lastIndexOf("/")===c.length-1)a[a.length-1]==="/"?(a=a.substr(0,a.length-1),n=n.substr(0,n.length-1),c=a):c=c.substr(0,c.length-1),r=o.closeIndex;else if(this.options.unpairedTags.indexOf(a)!==-1)r=o.closeIndex;else{let m=this.readStopNodeData(s,l,h+1);if(!m)throw new Error(`Unexpected end of ${l}`);r=m.i,p=m.tagContent}let f=new Sh(a);a!==c&&d&&(f[":@"]=this.buildAttributesMap(c,n,a)),p&&(p=this.parseTextData(p,a,n,!0,d,!0,!0)),n=n.substr(0,n.lastIndexOf(".")),f.add(this.options.textNodeName,p),this.addChild(t,f,n)}else{if(c.length>0&&c.lastIndexOf("/")===c.length-1){a[a.length-1]==="/"?(a=a.substr(0,a.length-1),n=n.substr(0,n.length-1),c=a):c=c.substr(0,c.length-1),this.options.transformTagName&&(a=this.options.transformTagName(a));let p=new Sh(a);a!==c&&d&&(p[":@"]=this.buildAttributesMap(c,n,a)),this.addChild(t,p,n),n=n.substr(0,n.lastIndexOf("."))}else{let p=new Sh(a);this.tagsNodeStack.push(t),a!==c&&d&&(p[":@"]=this.buildAttributesMap(c,n,a)),this.addChild(t,p,n),t=p}i="",r=h}}else i+=s[r];return e.child};function bD(s,e,t){let i=this.options.updateTag(e.tagname,t,e[":@"]);i===!1||(typeof i=="string"&&(e.tagname=i),s.addChild(e))}var vD=function(s){if(this.options.processEntities){for(let e in this.docTypeEntities){let t=this.docTypeEntities[e];s=s.replace(t.regx,t.val)}for(let e in this.lastEntities){let t=this.lastEntities[e];s=s.replace(t.regex,t.val)}if(this.options.htmlEntities)for(let e in this.htmlEntities){let t=this.htmlEntities[e];s=s.replace(t.regex,t.val)}s=s.replace(this.ampEntity.regex,this.ampEntity.val)}return s};function yD(s,e,t,i){return s&&(i===void 0&&(i=Object.keys(e.child).length===0),s=this.parseTextData(s,e.tagname,t,!1,e[":@"]?Object.keys(e[":@"]).length!==0:!1,i),s!==void 0&&s!==""&&e.add(this.options.textNodeName,s),s=""),s}function _D(s,e,t){let i="*."+t;for(let n in s){let r=s[n];if(i===r||e===r)return!0}return!1}function wD(s,e,t=">"){let i,n="";for(let r=e;r<s.length;r++){let o=s[r];if(i)o===i&&(i="");else if(o==='"'||o==="'")i=o;else if(o===t[0])if(t[1]){if(s[r+1]===t[1])return{data:n,index:r}}else return{data:n,index:r};else o==="	"&&(o=" ");n+=o}}function ma(s,e,t,i){let n=s.indexOf(e,t);if(n===-1)throw new Error(i);return n+e.length-1}function j0(s,e,t,i=">"){let n=wD(s,e+1,i);if(!n)return;let r=n.data,o=n.index,a=r.search(/\s/),l=r,c=!0;a!==-1&&(l=r.substring(0,a),r=r.substring(a+1).trimStart());let d=l;if(t){let h=l.indexOf(":");h!==-1&&(l=l.substr(h+1),c=l!==n.data.substr(h+1))}return{tagName:l,tagExp:r,closeIndex:o,attrExpPresent:c,rawTagName:d}}function ED(s,e,t){let i=t,n=1;for(;t<s.length;t++)if(s[t]==="<")if(s[t+1]==="/"){let r=ma(s,">",t,`${e} is not closed`);if(s.substring(t+2,r).trim()===e&&(n--,n===0))return{tagContent:s.substring(i,t),i:r};t=r}else if(s[t+1]==="?")t=ma(s,"?>",t+1,"StopNode is not closed.");else if(s.substr(t+1,3)==="!--")t=ma(s,"-->",t+3,"StopNode is not closed.");else if(s.substr(t+1,2)==="![")t=ma(s,"]]>",t,"StopNode is not closed.")-2;else{let r=j0(s,t,">");r&&((r&&r.tagName)===e&&r.tagExp[r.tagExp.length-1]!=="/"&&n++,t=r.closeIndex)}}function H0(s,e,t){if(e&&typeof s=="string"){let i=s.trim();return i==="true"?!0:i==="false"?!1:cD(s,t)}else return sC.isExist(s)?s:""}var CD=hD,rC={};function xD(s,e){return oC(s,e)}function oC(s,e,t){let i,n={};for(let r=0;r<s.length;r++){let o=s[r],a=SD(o),l="";if(t===void 0?l=a:l=t+"."+a,a===e.textNodeName)i===void 0?i=o[a]:i+=""+o[a];else{if(a===void 0)continue;if(o[a]){let c=oC(o[a],e,l),d=ID(c,e);o[":@"]?AD(c,o[":@"],l,e):Object.keys(c).length===1&&c[e.textNodeName]!==void 0&&!e.alwaysCreateTextNode?c=c[e.textNodeName]:Object.keys(c).length===0&&(e.alwaysCreateTextNode?c[e.textNodeName]="":c=""),n[a]!==void 0&&n.hasOwnProperty(a)?(Array.isArray(n[a])||(n[a]=[n[a]]),n[a].push(c)):e.isArray(a,l,d)?n[a]=[c]:n[a]=c}}}return typeof i=="string"?i.length>0&&(n[e.textNodeName]=i):i!==void 0&&(n[e.textNodeName]=i),n}function SD(s){let e=Object.keys(s);for(let t=0;t<e.length;t++){let i=e[t];if(i!==":@")return i}}function AD(s,e,t,i){if(e){let n=Object.keys(e),r=n.length;for(let o=0;o<r;o++){let a=n[o];i.isArray(a,t+"."+a,!0,!0)?s[a]=[e[a]]:s[a]=e[a]}}}function ID(s,e){let{textNodeName:t}=e,i=Object.keys(s).length;return!!(i===0||i===1&&(s[t]||typeof s[t]=="boolean"||s[t]===0))}rC.prettify=xD;var{buildOptions:TD}=Mb,PD=CD,{prettify:OD}=rC,MD=Pb,RD=class{constructor(s){this.externalEntities={},this.options=TD(s)}parse(s,e){if(typeof s!="string")if(s.toString)s=s.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(e){e===!0&&(e={});let n=MD.validate(s,e);if(n!==!0)throw Error(`${n.err.msg}:${n.err.line}:${n.err.col}`)}let t=new PD(this.options);t.addExternalEntities(this.externalEntities);let i=t.parseXml(s);return this.options.preserveOrder||i===void 0?i:OD(i,this.options)}addEntity(s,e){if(e.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(s.indexOf("&")!==-1||s.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(e==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[s]=e}},DD=RD,LD=`
`;function FD(s,e){let t="";return e.format&&e.indentBy.length>0&&(t=LD),aC(s,e,"",t)}function aC(s,e,t,i){let n="",r=!1;for(let o=0;o<s.length;o++){let a=s[o],l=kD(a);if(l===void 0)continue;let c="";if(t.length===0?c=l:c=`${t}.${l}`,l===e.textNodeName){let f=a[l];ND(c,e)||(f=e.tagValueProcessor(l,f),f=lC(f,e)),r&&(n+=i),n+=f,r=!1;continue}else if(l===e.cdataPropName){r&&(n+=i),n+=`<![CDATA[${a[l][0][e.textNodeName]}]]>`,r=!1;continue}else if(l===e.commentPropName){n+=i+`<!--${a[l][0][e.textNodeName]}-->`,r=!0;continue}else if(l[0]==="?"){let f=C1(a[":@"],e),m=l==="?xml"?"":i,g=a[l][0][e.textNodeName];g=g.length!==0?" "+g:"",n+=m+`<${l}${g}${f}?>`,r=!0;continue}let d=i;d!==""&&(d+=e.indentBy);let h=C1(a[":@"],e),u=i+`<${l}${h}`,p=aC(a[l],e,c,d);e.unpairedTags.indexOf(l)!==-1?e.suppressUnpairedNode?n+=u+">":n+=u+"/>":(!p||p.length===0)&&e.suppressEmptyNode?n+=u+"/>":p&&p.endsWith(">")?n+=u+`>${p}${i}</${l}>`:(n+=u+">",p&&i!==""&&(p.includes("/>")||p.includes("</"))?n+=i+e.indentBy+p+i:n+=p,n+=`</${l}>`),r=!0}return n}function kD(s){let e=Object.keys(s);for(let t=0;t<e.length;t++){let i=e[t];if(s.hasOwnProperty(i)&&i!==":@")return i}}function C1(s,e){let t="";if(s&&!e.ignoreAttributes)for(let i in s){if(!s.hasOwnProperty(i))continue;let n=e.attributeValueProcessor(i,s[i]);n=lC(n,e),n===!0&&e.suppressBooleanAttributes?t+=` ${i.substr(e.attributeNamePrefix.length)}`:t+=` ${i.substr(e.attributeNamePrefix.length)}="${n}"`}return t}function ND(s,e){s=s.substr(0,s.length-e.textNodeName.length-1);let t=s.substr(s.lastIndexOf(".")+1);for(let i in e.stopNodes)if(e.stopNodes[i]===s||e.stopNodes[i]==="*."+t)return!0;return!1}function lC(s,e){if(s&&s.length>0&&e.processEntities)for(let t=0;t<e.entities.length;t++){let i=e.entities[t];s=s.replace(i.regex,i.val)}return s}var UD=FD,BD=UD,zD={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(s,e){return e},attributeValueProcessor:function(s,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function vo(s){this.options=Object.assign({},zD,s),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=HD),this.processTextOrObjNode=VD,this.options.format?(this.indentate=jD,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}vo.prototype.build=function(s){return this.options.preserveOrder?BD(s,this.options):(Array.isArray(s)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(s={[this.options.arrayNodeName]:s}),this.j2x(s,0).val)};vo.prototype.j2x=function(s,e){let t="",i="";for(let n in s)if(Object.prototype.hasOwnProperty.call(s,n))if(typeof s[n]>"u")this.isAttribute(n)&&(i+="");else if(s[n]===null)this.isAttribute(n)?i+="":n[0]==="?"?i+=this.indentate(e)+"<"+n+"?"+this.tagEndChar:i+=this.indentate(e)+"<"+n+"/"+this.tagEndChar;else if(s[n]instanceof Date)i+=this.buildTextValNode(s[n],n,"",e);else if(typeof s[n]!="object"){let r=this.isAttribute(n);if(r)t+=this.buildAttrPairStr(r,""+s[n]);else if(n===this.options.textNodeName){let o=this.options.tagValueProcessor(n,""+s[n]);i+=this.replaceEntitiesValue(o)}else i+=this.buildTextValNode(s[n],n,"",e)}else if(Array.isArray(s[n])){let r=s[n].length,o="",a="";for(let l=0;l<r;l++){let c=s[n][l];if(!(typeof c>"u"))if(c===null)n[0]==="?"?i+=this.indentate(e)+"<"+n+"?"+this.tagEndChar:i+=this.indentate(e)+"<"+n+"/"+this.tagEndChar;else if(typeof c=="object")if(this.options.oneListGroup){let d=this.j2x(c,e+1);o+=d.val,this.options.attributesGroupName&&c.hasOwnProperty(this.options.attributesGroupName)&&(a+=d.attrStr)}else o+=this.processTextOrObjNode(c,n,e);else if(this.options.oneListGroup){let d=this.options.tagValueProcessor(n,c);d=this.replaceEntitiesValue(d),o+=d}else o+=this.buildTextValNode(c,n,"",e)}this.options.oneListGroup&&(o=this.buildObjectNode(o,n,a,e)),i+=o}else if(this.options.attributesGroupName&&n===this.options.attributesGroupName){let r=Object.keys(s[n]),o=r.length;for(let a=0;a<o;a++)t+=this.buildAttrPairStr(r[a],""+s[n][r[a]])}else i+=this.processTextOrObjNode(s[n],n,e);return{attrStr:t,val:i}};vo.prototype.buildAttrPairStr=function(s,e){return e=this.options.attributeValueProcessor(s,""+e),e=this.replaceEntitiesValue(e),this.options.suppressBooleanAttributes&&e==="true"?" "+s:" "+s+'="'+e+'"'};function VD(s,e,t){let i=this.j2x(s,t+1);return s[this.options.textNodeName]!==void 0&&Object.keys(s).length===1?this.buildTextValNode(s[this.options.textNodeName],e,i.attrStr,t):this.buildObjectNode(i.val,e,i.attrStr,t)}vo.prototype.buildObjectNode=function(s,e,t,i){if(s==="")return e[0]==="?"?this.indentate(i)+"<"+e+t+"?"+this.tagEndChar:this.indentate(i)+"<"+e+t+this.closeTag(e)+this.tagEndChar;{let n="</"+e+this.tagEndChar,r="";return e[0]==="?"&&(r="?",n=""),(t||t==="")&&s.indexOf("<")===-1?this.indentate(i)+"<"+e+t+r+">"+s+n:this.options.commentPropName!==!1&&e===this.options.commentPropName&&r.length===0?this.indentate(i)+`<!--${s}-->`+this.newLine:this.indentate(i)+"<"+e+t+r+this.tagEndChar+s+this.indentate(i)+n}};vo.prototype.closeTag=function(s){let e="";return this.options.unpairedTags.indexOf(s)!==-1?this.options.suppressUnpairedNode||(e="/"):this.options.suppressEmptyNode?e="/":e=`></${s}`,e};vo.prototype.buildTextValNode=function(s,e,t,i){if(this.options.cdataPropName!==!1&&e===this.options.cdataPropName)return this.indentate(i)+`<![CDATA[${s}]]>`+this.newLine;if(this.options.commentPropName!==!1&&e===this.options.commentPropName)return this.indentate(i)+`<!--${s}-->`+this.newLine;if(e[0]==="?")return this.indentate(i)+"<"+e+t+"?"+this.tagEndChar;{let n=this.options.tagValueProcessor(e,s);return n=this.replaceEntitiesValue(n),n===""?this.indentate(i)+"<"+e+t+this.closeTag(e)+this.tagEndChar:this.indentate(i)+"<"+e+t+">"+n+"</"+e+this.tagEndChar}};vo.prototype.replaceEntitiesValue=function(s){if(s&&s.length>0&&this.options.processEntities)for(let e=0;e<this.options.entities.length;e++){let t=this.options.entities[e];s=s.replace(t.regex,t.val)}return s};function jD(s){return this.options.indentBy.repeat(s)}function HD(s){return s.startsWith(this.options.attributeNamePrefix)&&s!==this.options.textNodeName?s.substr(this.attrPrefixLen):!1}var GD=vo,WD=Pb,YD=DD,qD=GD,XD={XMLParser:YD,XMLValidator:WD,XMLBuilder:qD},Lh=class{constructor(e,t){q(this,"date",new Date),q(this,"author"),q(this,"guid",jl.create()),q(this,"viewpoint"),q(this,"modifiedAuthor"),q(this,"modifiedDate"),q(this,"topic"),q(this,"_components"),q(this,"_comment",""),this._components=e,this._comment=t;let i=this._components.get(Cn);this.author=i.config.author}set comment(e){var t;let i=this._components.get(Cn);this._comment=e,this.modifiedDate=new Date,this.modifiedAuthor=i.config.author,(t=this.topic)==null||t.comments.set(this.guid,this)}get comment(){return this._comment}serialize(){let e=null;this.viewpoint&&(e=`<Viewpoint Guid="${this.viewpoint.guid}"/>`);let t=null;this.modifiedDate&&(t=`<ModifiedDate>${this.modifiedDate.toISOString()}</ModifiedDate>`);let i=null;return this.modifiedAuthor&&(i=`<ModifiedAuthor>${this.modifiedAuthor}</ModifiedAuthor>`),`
      <Comment Guid="${this.guid}">
        <Date>${this.date.toISOString()}</Date>
        <Author>${this.author}</Author>
        <Comment>${this.comment}</Comment>
        ${e??""}
        ${i??""}
        ${t??""}
      </Comment>
    `}},cC=class lo{constructor(e){q(this,"guid",jl.create()),q(this,"title",lo.default.title),q(this,"creationDate",new Date),q(this,"creationAuthor",""),q(this,"viewpoints",new ba),q(this,"relatedTopics",new ba),q(this,"comments",new fo),q(this,"customData",{}),q(this,"description"),q(this,"serverAssignedId"),q(this,"dueDate"),q(this,"modifiedAuthor"),q(this,"modifiedDate"),q(this,"index"),q(this,"_type",lo.default.type),q(this,"_status",lo.default.status),q(this,"_priority",lo.default.priority),q(this,"_stage",lo.default.priority),q(this,"_assignedTo",lo.default.assignedTo),q(this,"_labels",lo.default.labels),q(this,"_components"),this._components=e;let t=e.get(Cn);this.creationAuthor=t.config.author,this.relatedTopics.guard=i=>i!==this.guid}set type(e){let t=this._components.get(Cn),{strict:i,types:n}=t.config;(!i||n.has(e))&&(this._type=e)}get type(){return this._type}set status(e){let t=this._components.get(Cn),{strict:i,statuses:n}=t.config;(!i||n.has(e))&&(this._status=e)}get status(){return this._status}set priority(e){let t=this._components.get(Cn);if(e){let{strict:i,priorities:n}=t.config;if(!(!i||n.has(e)))return;this._priority=e}else this._priority=e}get priority(){return this._priority}set stage(e){let t=this._components.get(Cn);if(e){let{strict:i,stages:n}=t.config;if(!(!i||n.has(e)))return;this._stage=e}else this._stage=e}get stage(){return this._stage}set assignedTo(e){let t=this._components.get(Cn);if(e){let{strict:i,users:n}=t.config;if(!(!i||n.has(e)))return;this._assignedTo=e}else this._assignedTo=e}get assignedTo(){return this._assignedTo}set labels(e){let t=this._components.get(Cn),{strict:i,labels:n}=t.config;if(i){let r=new Set;for(let o of e)(!i||n.has(o))&&r.add(o);this._labels=r}else this._labels=e}get labels(){return this._labels}get _managerVersion(){return this._components.get(Cn).config.version}set(e){let t=e,i=this;for(let n in e){if(n==="guid")continue;let r=t[n];n in this&&(i[n]=r)}return this._components.get(Cn).list.set(this.guid,this),this}createComment(e,t){let i=new Lh(this._components,e);return i.viewpoint=t,i.topic=this,this.comments.set(i.guid,i),i}createLabelTags(e=this._managerVersion){let t="Labels";e==="2.1"&&(t="Labels"),e==="3"&&(t="Label");let i=[...this.labels].map(n=>`<${t}>${n}</${t}>`).join(`
`);for(let n in this.customData){let r=this.customData[n];typeof r=="string"&&(i+=`
<${t}>${r}</${t}>`)}return e==="2.1"?i:e==="3"?i.length!==0?`<Labels>
${i}
</Labels>`:"<Labels/>":i}createCommentTags(e=this._managerVersion){let t=[...this.comments.values()].map(i=>i.serialize()).join(`
`);return e==="2.1"?t:e==="3"?t.length!==0?`<Comments>
${t}
</Comments>`:"<Comments/>":t}createViewpointTags(e=this._managerVersion){let t="Viewpoints";e==="2.1"&&(t="Viewpoints"),e==="3"&&(t="ViewPoint");let i=this._components.get(Sr),n=[...this.viewpoints].map(r=>i.list.get(r)).filter(r=>r).map(r=>`<${t} Guid="${r.guid}">
          <Viewpoint>${r.guid}.bcfv</Viewpoint>
          <Snapshot>${r.guid}.jpeg</Snapshot>
        </${t}>
      `).join(`
`);return e==="2.1"?n:e==="3"?n.length!==0?`<Viewpoints>
${n}
</Viewpoints>`:"<Viewpoints />":n}createRelatedTopicTags(e=this._managerVersion){let t=[...this.relatedTopics].map(i=>`<RelatedTopic Guid="${i}"></RelatedTopic>
      `).join(`
`);return e==="2.1"?t:e==="3"?t.length!==0?`<RelatedTopics>
${t}
</RelatedTopics>`:"<RelatedTopics />":t}serialize(){let e=this._managerVersion,t=null;this.serverAssignedId&&(t=`ServerAssignedId="${this.serverAssignedId}"`);let i=null;this.priority&&(i=`<Priority>${this.priority}</Priority>`);let n=null;this.index&&e==="2.1"&&(n=`<Index>${this.index}</Index>`);let r=null;this.modifiedDate&&(r=`<ModifiedDate>${this.modifiedDate.toISOString()}</ModifiedDate>`);let o=null;this.modifiedAuthor&&(o=`<ModifiedAuthor>${this.modifiedAuthor}</ModifiedAuthor>`);let a=null;this.dueDate&&(a=`<DueDate>${this.dueDate.toISOString()}</DueDate>`);let l=null;this.assignedTo&&(l=`<AssignedTo>${this.assignedTo}</AssignedTo>`);let c=null;this.description&&(c=`<Description>${this.description}</Description>`);let d=null;this.stage&&(d=`<Stage>${this.stage}</Stage>`);let h=this.createCommentTags(e),u=this.createViewpointTags(e),p=this.createLabelTags(e),f=this.createRelatedTopicTags(e);return`
      <?xml version="1.0" encoding="UTF-8"?>
      <Markup>
        <Topic Guid="${this.guid}" TopicType="${this.type}" TopicStatus="${this.status}" ${t??""}>
          <Title>${this.title}</Title>
          <CreationDate>${this.creationDate.toISOString()}</CreationDate>
          <CreationAuthor>${this.creationAuthor}</CreationAuthor>
          ${i??""}
          ${n??""}
          ${r??""}
          ${o??""}
          ${a??""}
          ${l??""}
          ${c??""}
          ${d??""}
          ${p}
          ${f}
          ${e==="3"?h:""}
          ${e==="3"?u:""}
        </Topic>
        ${e==="2.1"?h:""}
        ${e==="2.1"?u:""}
      </Markup>
    `}};q(cC,"default",{title:"BCF Topic",type:"Issue",status:"Active",labels:new Set});var x1=cC,KD=(s,e)=>{if(e.trim()==="")return;let t=Cn.xmlParser.parse(e).Extensions;if(!t)return;let{Priorities:i,TopicStatuses:n,TopicTypes:r,Users:o}=t;if(i&&i.Priority){let a=Array.isArray(i.Priority)?i.Priority:[i.Priority];for(let l of a)s.config.priorities.add(l)}if(n&&n.TopicStatus){let a=Array.isArray(n.TopicStatus)?n.TopicStatus:[n.TopicStatus];for(let l of a)s.config.statuses.add(l)}if(r&&r.TopicType){let a=Array.isArray(r.TopicType)?r.TopicType:[r.TopicType];for(let l of a)s.config.types.add(l)}if(o&&o.User){let a=Array.isArray(o.User)?o.User:[o.User];for(let l of a)s.config.users.add(l)}},G0=class Sp extends At{constructor(){super(...arguments),q(this,"enabled",!1),q(this,"config",{author:"jhon.doe@example.com",version:"2.1",types:new Set(["Clash","Failure","Fault","Inquiry","Issue","Remark","Request"]),statuses:new Set(["Active","In Progress","Done","In Review","Closed"]),priorities:new Set(["On hold","Minor","Normal","Major","Critical"]),labels:new Set,stages:new Set,users:new Set,includeSelectionTag:!1,updateExtensionsOnImport:!0,strict:!1,includeAllExtensionsOnExport:!0,fallbackVersionOnImport:"2.1",ignoreIncompleteTopicsOnImport:!1}),q(this,"list",new fo),q(this,"onSetup",new Oe),q(this,"isSetup",!1),q(this,"onBCFImported",new Oe),q(this,"onDisposed",new Oe)}setup(e){this.isSetup||(this.config=Se(Se({},this.config),e),this.isSetup=!0,this.enabled=!0,this.onSetup.trigger())}create(e){let t=new x1(this.components);return e&&(t.guid=e.guid??t.guid,t.set(e)),this.list.set(t.guid,t),t}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get usedTypes(){let e=[...this.list].map(([t,i])=>i.type);return new Set(e)}get usedStatuses(){let e=[...this.list].map(([t,i])=>i.status);return new Set(e)}get usedPriorities(){let e=[...this.list].map(([t,i])=>i.priority).filter(t=>t);return new Set(e)}get usedStages(){let e=[...this.list].map(([t,i])=>i.stage).filter(t=>t);return new Set(e)}get usedUsers(){let e=[];for(let[t,i]of this.list){e.push(i.creationAuthor),i.assignedTo&&e.push(i.assignedTo),i.modifiedAuthor&&e.push(i.modifiedAuthor);for(let[n,r]of i.comments)e.push(r.author),r.modifiedAuthor&&e.push(r.modifiedAuthor)}return new Set(e)}get usedLabels(){let e=[];for(let[t,i]of this.list)e.push(...i.labels);return new Set(e)}updateExtensions(){for(let[e,t]of this.list){for(let i of t.labels)this.config.labels.add(i);this.config.types.add(t.type),t.priority&&this.config.priorities.add(t.priority),t.stage&&this.config.stages.add(t.stage),this.config.statuses.add(t.status),this.config.users.add(t.creationAuthor),t.assignedTo&&this.config.users.add(t.assignedTo),t.modifiedAuthor&&this.config.users.add(t.modifiedAuthor);for(let[i,n]of t.comments)this.config.users.add(n.author),n.modifiedAuthor&&this.config.users.add(n.modifiedAuthor)}}updateViewpointReferences(){let e=this.components.get(Sr);for(let[t,i]of this.list)for(let n of i.viewpoints)e.list.has(n)||i.viewpoints.delete(n)}export(){return ie(this,arguments,function*(e=this.list.values()){let t=new v1;t.file("bcf.version",`<?xml version="1.0" encoding="UTF-8"?>
    <Version VersionId="${this.config.version}" xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/buildingSMART/BCF-XML/release_3_0/Schemas/version.xsd"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    </Version>`),t.file("bcf.extensions",this.serializeExtensions());let i=yield(yield fetch("https://thatopen.github.io/engine_components/resources/favicon.ico")).blob(),n=this.components.get(Sr);for(let r of e){let o=t.folder(r.guid);o.file("markup.bcf",r.serialize());for(let a of r.viewpoints){let l=n.list.get(a);l&&(o.file(`${a}.jpeg`,i,{binary:!0}),o.file(`${a}.bcfv`,yield l.serialize()))}}return yield t.generateAsync({type:"blob"})})}serializeExtensions(){let e=[...this.config.types].map(a=>`<TopicType>${a}</TopicType>`).join(`
`),t=[...this.config.statuses].map(a=>`<TopicStatus>${a}</TopicStatus>`).join(`
`),i=[...this.config.priorities].map(a=>`<Priority>${a}</Priority>`).join(`
`),n=[...this.config.labels].map(a=>`<TopicLabel>${a}</TopicLabel>`).join(`
`),r=[...this.config.stages].map(a=>`<Stage>${a}</Stage>`).join(`
`),o=[...this.config.users].map(a=>`<User>${a}</User>`).join(`
`);return`
      <?xml version="1.0" encoding="UTF-8"?>
      <Extensions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="your-schema-location.xsd">
        ${e.length!==0?`<TopicTypes>
${e}
</TopicTypes>`:""}
        ${t.length!==0?`<TopicStatuses>
${t}
</TopicStatuses>`:""}
        ${i.length!==0?`<Priorities>
${i}
</Priorities>`:""}
        ${n.length!==0?`<TopicLabels>
${n}
</TopicLabels>`:""}
        ${r.length!==0?`<Stages>
${r}
</Stages>`:""}
        ${o.length!==0?`<Users>
${o}
</Users>`:""}
      </Extensions>
    `}processMarkupComment(e){let{Guid:t,Date:i,Author:n,Comment:r,Viewpoint:o}=e;if(!(t&&i&&n&&(Lh||o)))return null;let a=this.components.get(Sr),l=new Lh(this.components,r??"");return l.guid=t,l.date=new Date(i),l.author=n,l.viewpoint=o!=null&&o.Guid?a.list.get(o.Guid):void 0,l.modifiedAuthor=e.ModifiedAuthor,l.modifiedDate=e.ModifiedDate?new Date(e.ModifiedDate):void 0,l}getMarkupComments(e,t){var i;let n;if(t==="2.1"&&(n=e.Comment),t==="3"&&(n=(i=e.Topic.Comments)==null?void 0:i.Comment),!n)return[];n=Array.isArray(n)?n:[n];let r=n.map(o=>this.processMarkupComment(o)).filter(o=>o);return Array.isArray(r)?r:[r]}getMarkupLabels(e,t){var i;let n;return t==="2.1"&&(n=e.Topic.Labels),t==="3"&&(n=(i=e.Topic.Labels)==null?void 0:i.Label),n?Array.isArray(n)?n:[n]:[]}getMarkupViewpoints(e,t){var i;let n;return t==="2.1"&&(n=e.Viewpoints),t==="3"&&(n=(i=e.Topic.Viewpoints)==null?void 0:i.ViewPoint),n?(n=Array.isArray(n)?n:[n],n):[]}getMarkupRelatedTopics(e,t){var i;let n;return t==="2.1"&&(n=e.Topic.RelatedTopic),t==="3"&&(n=(i=e.Topic.RelatedTopics)==null?void 0:i.RelatedTopic),n?(Array.isArray(n)?n:[n]).map(r=>r.Guid):[]}load(e,t){return ie(this,null,function*(){var i;let{fallbackVersionOnImport:n,ignoreIncompleteTopicsOnImport:r,updateExtensionsOnImport:o}=this.config,a=new v1;yield a.loadAsync(e);let l=Object.values(a.files),c=n,d=l.find(v=>v.name.endsWith(".version"));if(d){let v=yield d.async("string"),E=Sp.xmlParser.parse(v).Version.VersionId;c=String(E)}if(!(c&&(c==="2.1"||c==="3")))throw new Error(`BCFTopics: ${c} is not supported.`);let h=l.find(v=>v.name.endsWith(".extensions"));if(o&&h){let v=yield h.async("string");KD(this,v)}let u=[],p=this.components.get(Sr),f=l.filter(v=>v.name.endsWith(".bcfv"));for(let v of f){let E=yield v.async("string"),y=Sp.xmlParser.parse(E).VisualizationInfo;if(!y){console.warn("Missing VisualizationInfo in Viewpoint");continue}let w={},{Guid:C,ClippingPlanes:A,Components:D,OrthogonalCamera:M,PerspectiveCamera:I}=y;if(C&&(w.guid=C),D){let{Selection:F,Visibility:V}=D;if(F&&F.Component){let N=Array.isArray(F.Component)?F.Component:[F.Component];w.selectionComponents=N.map(z=>z.IfcGuid).filter(z=>z)}if(V&&"DefaultVisibility"in V&&(w.defaultVisibility=V.DefaultVisibility),V&&V.Exceptions&&"Component"in V.Exceptions){let{Component:N}=V.Exceptions,z=Array.isArray(N)?N:[N];w.exceptionComponents=z.map(G=>G.IfcGuid).filter(G=>G)}let x;c==="2.1"&&(x=D.ViewSetupHints),c==="3"&&(x=(i=D.Visibility)==null?void 0:i.ViewSetupHints),x&&("OpeningsVisible"in x&&(w.openingsVisible=x.OpeningsVisible),"SpacesVisible"in x&&(w.spacesVisible=x.SpacesVisible),"SpaceBoundariesVisible"in x&&(w.spaceBoundariesVisible=x.SpaceBoundariesVisible))}if(M||I){let F=y.PerspectiveCamera??y.OrthogonalCamera,{CameraViewPoint:V,CameraDirection:x}=F,N=new ce(Number(V.X),Number(V.Z),Number(-V.Y)),z=new ce(Number(x.X),Number(x.Z),Number(-x.Y)),G={position:{x:N.x,y:N.y,z:N.z},direction:{x:z.x,y:z.y,z:z.z},aspectRatio:"AspectRatio"in F?F.AspectRatio:1};"ViewToWorldScale"in F&&(w.camera=yt(Se({},G),{viewToWorldScale:F.ViewToWorldScale})),"FieldOfView"in F&&(w.camera=yt(Se({},G),{fov:F.FieldOfView}))}let O=new Bp(this.components,t,{data:w,setCamera:!1});if(D){let{Coloring:F}=D;if(F&&F.Color){let V=Array.isArray(F.Color)?F.Color:[F.Color];for(let x of V){let{Color:N,Component:z}=x,G=(Array.isArray(z)?z:[z]).map(X=>X.IfcGuid);O.componentColors.set(N,G)}}}if(u.push(O),A){let F=this.components.get(Bl),V=Array.isArray(A.ClippingPlane)?A.ClippingPlane:[A.ClippingPlane];for(let x of V){let{Location:N,Direction:z}=x;if(!(N&&z))continue;let G=new ce(N.X,N.Z,-N.Y),X=new ce(z.X,-z.Z,z.Y),k=F.createFromNormalAndCoplanarPoint(t,X,G);k.visible=!1,k.enabled=!1,O.clippingPlanes.add(k)}}}let m={},g=[],b=l.filter(v=>v.name.endsWith(".bcf"));for(let v of b){let E=yield v.async("string"),y=Sp.xmlParser.parse(E).Markup,w=y.Topic,{Guid:C,Type:A,Status:D,Title:M,CreationDate:I,CreationAuthor:O}=w;if(r&&!(C&&A&&D&&M&&I&&O))continue;let F=new x1(this.components);F.guid=C??F.guid;let V=this.getMarkupRelatedTopics(y,c);m[F.guid]=new Set(V),F.type=A??F.type,F.status=D??F.status,F.title=M??F.title,F.creationDate=I?new Date(I):F.creationDate,F.creationAuthor=O??F.creationAuthor,F.serverAssignedId=w.ServerAssignedId,F.priority=w.Priority,F.index=w.Index,F.modifiedDate=w.ModifiedDate?new Date(w.ModifiedDate):void 0,F.modifiedAuthor=w.ModifiedAuthor,F.dueDate=w.DueDate?new Date(w.DueDate):void 0,F.assignedTo=w.AssignedTo,F.description=w.Description,F.stage=w.Stage;let x=this.getMarkupLabels(y,c);for(let G of x)F.labels.add(G);let N=this.getMarkupComments(y,c);for(let G of N)F.comments.set(G.guid,G);let z=this.getMarkupViewpoints(y,c);for(let G of z){if(!(G&&G.Guid))continue;let X=p.list.get(G.Guid);X&&F.viewpoints.add(X.guid)}this.list.set(F.guid,F),g.push(F)}for(let v in m){let E=this.list.get(v);if(!E)continue;let y=m[v];for(let w of y)E.relatedTopics.add(w)}return this.onBCFImported.trigger(g),{viewpoints:u,topics:g}})}};q(G0,"uuid","de977976-e4f6-4e4f-a01a-204727839802"),q(G0,"xmlParser",new XD.XMLParser({allowBooleanAttributes:!0,attributeNamePrefix:"",ignoreAttributes:!1,ignoreDeclaration:!0,ignorePiTags:!0,numberParseOptions:{leadingZeros:!0,hex:!0},parseAttributeValue:!0,preserveOrder:!1,processEntities:!1,removeNSPrefix:!0,trimValues:!0}));var Cn=G0,hC=class xr extends At{constructor(e){super(e),q(this,"enabled",!0),q(this,"onDisposed",new Oe),q(this,"_absoluteMin"),q(this,"_absoluteMax"),q(this,"_meshes",[]),this.components.add(xr.uuid,this),this._absoluteMin=xr.newBound(!0),this._absoluteMax=xr.newBound(!1)}static getDimensions(e){let{min:t,max:i}=e,n=Math.abs(i.x-t.x),r=Math.abs(i.y-t.y),o=Math.abs(i.z-t.z),a=new ce;return a.subVectors(i,t).divideScalar(2).add(t),{width:n,height:r,depth:o,center:a}}static newBound(e){let t=e?1:-1;return new ce(t*Number.MAX_VALUE,t*Number.MAX_VALUE,t*Number.MAX_VALUE)}static getBounds(e,t,i){let n=i||this.newBound(!1),r=t||this.newBound(!0);for(let o of e)o.x<r.x&&(r.x=o.x),o.y<r.y&&(r.y=o.y),o.z<r.z&&(r.z=o.z),o.x>n.x&&(n.x=o.x),o.y>n.y&&(n.y=o.y),o.z>n.z&&(n.z=o.z);return new Qt(t,i)}dispose(){let e=this.components.get(nr);for(let t of this._meshes)e.destroy(t);this._meshes=[],this.onDisposed.trigger(xr.uuid),this.onDisposed.reset()}get(){let e=this._absoluteMin.clone(),t=this._absoluteMax.clone();return new Qt(e,t)}getSphere(){let e=this._absoluteMin.clone(),t=this._absoluteMax.clone(),i=Math.abs((t.x-e.x)/2),n=Math.abs((t.y-e.y)/2),r=Math.abs((t.z-e.z)/2),o=new ce(e.x+i,e.y+n,e.z+r),a=o.distanceTo(e);return new Qn(o,a)}getMesh(){let e=new Qt(this._absoluteMin,this._absoluteMax),t=xr.getDimensions(e),{width:i,height:n,depth:r,center:o}=t,a=new ki(i,n,r),l=new $e(a);return this._meshes.push(l),l.position.copy(o),l}reset(){this._absoluteMin=xr.newBound(!0),this._absoluteMax=xr.newBound(!1)}add(e){for(let t of e.items)this.addMesh(t.mesh)}addMesh(e,t){if(!e.geometry.index)return;let i=xr.getFragmentBounds(e);e.updateMatrixWorld();let n=e.matrixWorld,r=new lt,o=e instanceof Jn,a=new Set;if(e instanceof Fu){t||(t=e.fragment.ids);for(let l of t){let c=e.fragment.getInstancesIDs(l);if(c)for(let d of c)a.add(d)}}else a.add(0);for(let l of a){let c=i.min.clone(),d=i.max.clone();o&&(e.getMatrixAt(l,r),c.applyMatrix4(r),d.applyMatrix4(r)),c.applyMatrix4(n),d.applyMatrix4(n),c.x<this._absoluteMin.x&&(this._absoluteMin.x=c.x),c.y<this._absoluteMin.y&&(this._absoluteMin.y=c.y),c.z<this._absoluteMin.z&&(this._absoluteMin.z=c.z),c.x>this._absoluteMax.x&&(this._absoluteMax.x=c.x),c.y>this._absoluteMax.y&&(this._absoluteMax.y=c.y),c.z>this._absoluteMax.z&&(this._absoluteMax.z=c.z),d.x>this._absoluteMax.x&&(this._absoluteMax.x=d.x),d.y>this._absoluteMax.y&&(this._absoluteMax.y=d.y),d.z>this._absoluteMax.z&&(this._absoluteMax.z=d.z),d.x<this._absoluteMin.x&&(this._absoluteMin.x=d.x),d.y<this._absoluteMin.y&&(this._absoluteMin.y=d.y),d.z<this._absoluteMin.z&&(this._absoluteMin.z=d.z)}}addFragmentIdMap(e){let t=this.components.get(Rt);for(let i in e){let n=t.list.get(i);if(!n)continue;let r=e[i];this.addMesh(n.mesh,r)}}static getFragmentBounds(e){let t=e.geometry.attributes.position,i=Number.MAX_VALUE,n=-i,r=new ce(i,i,i),o=new ce(n,n,n);if(!e.geometry.index)throw new Error("Geometry must be indexed!");let a=Array.from(e.geometry.index.array);for(let l=0;l<a.length;l++){if(l%3===0&&a[l]===0&&a[l+1]===0&&a[l+2]===0){l+=2;continue}let c=a[l],d=t.getX(c),h=t.getY(c),u=t.getZ(c);d<r.x&&(r.x=d),h<r.y&&(r.y=h),u<r.z&&(r.z=u),d>o.x&&(o.x=d),h>o.y&&(o.y=h),u>o.z&&(o.z=u)}return new Qt(r,o)}};q(hC,"uuid","d1444724-dba6-4cdd-a0c7-68ee1450d166");var Lp=hC,dC=new Set([1123145078,574549367,1675464909,2059837836,3798115385,32440307,3125803723,3207858831,2740243338,2624227202,4240577450,3615266464,3724593414,220341763,477187591,1878645084,1300840506,3303107099,1607154358,1878645084,846575682,1351298697,2417041796,3049322572,3331915920,1416205885,776857604,3285139300,3958052878,2827736869,2732653382,673634403,3448662350,4142052618,2924175390,803316827,2556980723,1809719519,2205249479,807026263,3737207727,1660063152,2347385850,2705031697,3732776249,2485617015,2611217952,1704287377,2937912522,2770003689,1281925730,1484403080,3448662350,4142052618,3800577675,4006246654,3590301190,1383045692,2775532180,2047409740,370225590,3593883385,2665983363,4124623270,812098782,3649129432,987898635,1105321065,3510044353,1635779807,2603310189,3406155212,1310608509,4261334040,2736907675,3649129432,1136057603,1260505505,4182860854,2713105998,2898889636,59481748,3749851601,3486308946,3150382593,1062206242,3264961684,15328376,1485152156,370225590,1981873012,2859738748,45288368,2614616156,2732653382,775493141,2147822146,2601014836,2629017746,1186437898,2367409068,1213902940,3632507154,3900360178,476780140,1472233963,2804161546,3008276851,738692330,374418227,315944413,3905492369,3570813810,2571569899,178912537,2294589976,1437953363,2133299955,572779678,3092502836,388784114,2624227202,1425443689,3057273783,2347385850,1682466193,2519244187,2839578677,3958567839,2513912981,2830218821,427810014]),uC=class pC extends At{constructor(e){super(e),q(this,"enabled",!0),e.add(pC.uuid,this)}export(e,t,i=!1,n=!0){return ie(this,null,function*(){let r={},o=new Set(e.GetIfcEntityList(t)),a=new Set([pl,Nu,Bu,ah,As]);for(let l of a)o.add(l);for(let l of o){if(dC.has(l))continue;let c=a.has(l)&&n,d=e.GetLineIDsWithType(t,l);for(let h of d){let u=e.GetLine(0,h,c,i);r[u.expressID]=u}}return r})}};q(uC,"uuid","b32c4332-cd67-436e-ba7f-196646c7a635");var $D=uC,fC={950732822:"IFCURIREFERENCE",4075327185:"IFCTIME",1209108979:"IFCTEMPERATURERATEOFCHANGEMEASURE",3457685358:"IFCSOUNDPRESSURELEVELMEASURE",4157543285:"IFCSOUNDPOWERLEVELMEASURE",2798247006:"IFCPROPERTYSETDEFINITIONSET",1790229001:"IFCPOSITIVEINTEGER",525895558:"IFCNONNEGATIVELENGTHMEASURE",1774176899:"IFCLINEINDEX",1275358634:"IFCLANGUAGEID",2541165894:"IFCDURATION",3701338814:"IFCDAYINWEEKNUMBER",2195413836:"IFCDATETIME",937566702:"IFCDATE",1683019596:"IFCCARDINALPOINTREFERENCE",2314439260:"IFCBINARY",1500781891:"IFCAREADENSITYMEASURE",3683503648:"IFCARCINDEX",4065007721:"IFCYEARNUMBER",1718600412:"IFCWARPINGMOMENTMEASURE",51269191:"IFCWARPINGCONSTANTMEASURE",2593997549:"IFCVOLUMETRICFLOWRATEMEASURE",3458127941:"IFCVOLUMEMEASURE",3345633955:"IFCVAPORPERMEABILITYMEASURE",1278329552:"IFCTORQUEMEASURE",2591213694:"IFCTIMESTAMP",2726807636:"IFCTIMEMEASURE",743184107:"IFCTHERMODYNAMICTEMPERATUREMEASURE",2016195849:"IFCTHERMALTRANSMITTANCEMEASURE",857959152:"IFCTHERMALRESISTANCEMEASURE",2281867870:"IFCTHERMALEXPANSIONCOEFFICIENTMEASURE",2645777649:"IFCTHERMALCONDUCTIVITYMEASURE",232962298:"IFCTHERMALADMITTANCEMEASURE",296282323:"IFCTEXTTRANSFORMATION",603696268:"IFCTEXTFONTNAME",3490877962:"IFCTEXTDECORATION",1460886941:"IFCTEXTALIGNMENT",2801250643:"IFCTEXT",58845555:"IFCTEMPERATUREGRADIENTMEASURE",361837227:"IFCSPECULARROUGHNESS",2757832317:"IFCSPECULAREXPONENT",3477203348:"IFCSPECIFICHEATCAPACITYMEASURE",993287707:"IFCSOUNDPRESSUREMEASURE",846465480:"IFCSOUNDPOWERMEASURE",3471399674:"IFCSOLIDANGLEMEASURE",408310005:"IFCSHEARMODULUSMEASURE",2190458107:"IFCSECTIONALAREAINTEGRALMEASURE",3467162246:"IFCSECTIONMODULUSMEASURE",2766185779:"IFCSECONDINMINUTE",3211557302:"IFCROTATIONALSTIFFNESSMEASURE",1755127002:"IFCROTATIONALMASSMEASURE",2133746277:"IFCROTATIONALFREQUENCYMEASURE",200335297:"IFCREAL",96294661:"IFCRATIOMEASURE",3972513137:"IFCRADIOACTIVITYMEASURE",3665567075:"IFCPRESSUREMEASURE",2169031380:"IFCPRESENTABLETEXT",1364037233:"IFCPOWERMEASURE",1245737093:"IFCPOSITIVERATIOMEASURE",3054510233:"IFCPOSITIVEPLANEANGLEMEASURE",2815919920:"IFCPOSITIVELENGTHMEASURE",4042175685:"IFCPLANEANGLEMEASURE",2642773653:"IFCPLANARFORCEMEASURE",2260317790:"IFCPARAMETERVALUE",929793134:"IFCPHMEASURE",2395907400:"IFCNUMERICMEASURE",2095195183:"IFCNORMALISEDRATIOMEASURE",765770214:"IFCMONTHINYEARNUMBER",2615040989:"IFCMONETARYMEASURE",3114022597:"IFCMOMENTOFINERTIAMEASURE",1648970520:"IFCMOLECULARWEIGHTMEASURE",3177669450:"IFCMOISTUREDIFFUSIVITYMEASURE",1753493141:"IFCMODULUSOFSUBGRADEREACTIONMEASURE",1052454078:"IFCMODULUSOFROTATIONALSUBGRADEREACTIONMEASURE",2173214787:"IFCMODULUSOFLINEARSUBGRADEREACTIONMEASURE",3341486342:"IFCMODULUSOFELASTICITYMEASURE",102610177:"IFCMINUTEINHOUR",3531705166:"IFCMASSPERLENGTHMEASURE",3124614049:"IFCMASSMEASURE",4017473158:"IFCMASSFLOWRATEMEASURE",1477762836:"IFCMASSDENSITYMEASURE",2486716878:"IFCMAGNETICFLUXMEASURE",286949696:"IFCMAGNETICFLUXDENSITYMEASURE",151039812:"IFCLUMINOUSINTENSITYMEASURE",2755797622:"IFCLUMINOUSINTENSITYDISTRIBUTIONMEASURE",2095003142:"IFCLUMINOUSFLUXMEASURE",503418787:"IFCLOGICAL",3086160713:"IFCLINEARVELOCITYMEASURE",1307019551:"IFCLINEARSTIFFNESSMEASURE",2128979029:"IFCLINEARMOMENTMEASURE",191860431:"IFCLINEARFORCEMEASURE",1243674935:"IFCLENGTHMEASURE",3258342251:"IFCLABEL",2054016361:"IFCKINEMATICVISCOSITYMEASURE",3192672207:"IFCISOTHERMALMOISTURECAPACITYMEASURE",3686016028:"IFCIONCONCENTRATIONMEASURE",3809634241:"IFCINTEGERCOUNTRATEMEASURE",1939436016:"IFCINTEGER",2679005408:"IFCINDUCTANCEMEASURE",3358199106:"IFCILLUMINANCEMEASURE",983778844:"IFCIDENTIFIER",2589826445:"IFCHOURINDAY",1158859006:"IFCHEATINGVALUEMEASURE",3113092358:"IFCHEATFLUXDENSITYMEASURE",3064340077:"IFCGLOBALLYUNIQUEID",3044325142:"IFCFREQUENCYMEASURE",1361398929:"IFCFORCEMEASURE",2590844177:"IFCFONTWEIGHT",2715512545:"IFCFONTVARIANT",1102727119:"IFCFONTSTYLE",2078135608:"IFCENERGYMEASURE",2506197118:"IFCELECTRICVOLTAGEMEASURE",2951915441:"IFCELECTRICRESISTANCEMEASURE",3790457270:"IFCELECTRICCURRENTMEASURE",2093906313:"IFCELECTRICCONDUCTANCEMEASURE",3818826038:"IFCELECTRICCHARGEMEASURE",1827137117:"IFCELECTRICCAPACITANCEMEASURE",69416015:"IFCDYNAMICVISCOSITYMEASURE",524656162:"IFCDOSEEQUIVALENTMEASURE",4134073009:"IFCDIMENSIONCOUNT",1514641115:"IFCDESCRIPTIVEMEASURE",300323983:"IFCDAYLIGHTSAVINGHOUR",86635668:"IFCDAYINMONTHNUMBER",94842927:"IFCCURVATUREMEASURE",1778710042:"IFCCOUNTMEASURE",3238673880:"IFCCONTEXTDEPENDENTMEASURE",3812528620:"IFCCOMPOUNDPLANEANGLEMEASURE",2991860651:"IFCCOMPLEXNUMBER",1867003952:"IFCBOXALIGNMENT",2735952531:"IFCBOOLEAN",2650437152:"IFCAREAMEASURE",632304761:"IFCANGULARVELOCITYMEASURE",360377573:"IFCAMOUNTOFSUBSTANCEMEASURE",4182062534:"IFCACCELERATIONMEASURE",3699917729:"IFCABSORBEDDOSEMEASURE",1971632696:"IFCGEOSLICE",2680139844:"IFCGEOMODEL",24726584:"IFCELECTRICFLOWTREATMENTDEVICE",3693000487:"IFCDISTRIBUTIONBOARD",3460952963:"IFCCONVEYORSEGMENT",3999819293:"IFCCAISSONFOUNDATION",3314249567:"IFCBOREHOLE",4196446775:"IFCBEARING",325726236:"IFCALIGNMENT",3425753595:"IFCTRACKELEMENT",991950508:"IFCSIGNAL",3798194928:"IFCREINFORCEDSOIL",3290496277:"IFCRAIL",1383356374:"IFCPAVEMENT",2182337498:"IFCNAVIGATIONELEMENT",234836483:"IFCMOORINGDEVICE",2078563270:"IFCMOBILETELECOMMUNICATIONSAPPLIANCE",1638804497:"IFCLIQUIDTERMINAL",1154579445:"IFCLINEARPOSITIONINGELEMENT",2696325953:"IFCKERB",2713699986:"IFCGEOTECHNICALASSEMBLY",2142170206:"IFCELECTRICFLOWTREATMENTDEVICETYPE",3376911765:"IFCEARTHWORKSFILL",1077100507:"IFCEARTHWORKSELEMENT",3071239417:"IFCEARTHWORKSCUT",479945903:"IFCDISTRIBUTIONBOARDTYPE",3426335179:"IFCDEEPFOUNDATION",1502416096:"IFCCOURSE",2940368186:"IFCCONVEYORSEGMENTTYPE",3203706013:"IFCCAISSONFOUNDATIONTYPE",3862327254:"IFCBUILTSYSTEM",1876633798:"IFCBUILTELEMENT",963979645:"IFCBRIDGEPART",644574406:"IFCBRIDGE",3649138523:"IFCBEARINGTYPE",1662888072:"IFCALIGNMENTVERTICAL",317615605:"IFCALIGNMENTSEGMENT",1545765605:"IFCALIGNMENTHORIZONTAL",4266260250:"IFCALIGNMENTCANT",3956297820:"IFCVIBRATIONDAMPERTYPE",1530820697:"IFCVIBRATIONDAMPER",840318589:"IFCVEHICLE",1953115116:"IFCTRANSPORTATIONDEVICE",618700268:"IFCTRACKELEMENTTYPE",2281632017:"IFCTENDONCONDUITTYPE",3663046924:"IFCTENDONCONDUIT",42703149:"IFCSINESPIRAL",1894708472:"IFCSIGNALTYPE",3599934289:"IFCSIGNTYPE",33720170:"IFCSIGN",1027922057:"IFCSEVENTHORDERPOLYNOMIALSPIRAL",544395925:"IFCSEGMENTEDREFERENCECURVE",3649235739:"IFCSECONDORDERPOLYNOMIALSPIRAL",550521510:"IFCROADPART",146592293:"IFCROAD",3818125796:"IFCRELADHERESTOELEMENT",4021432810:"IFCREFERENT",1891881377:"IFCRAILWAYPART",3992365140:"IFCRAILWAY",1763565496:"IFCRAILTYPE",1946335990:"IFCPOSITIONINGELEMENT",514975943:"IFCPAVEMENTTYPE",506776471:"IFCNAVIGATIONELEMENTTYPE",710110818:"IFCMOORINGDEVICETYPE",1950438474:"IFCMOBILETELECOMMUNICATIONSAPPLIANCETYPE",976884017:"IFCMARINEPART",525669439:"IFCMARINEFACILITY",1770583370:"IFCLIQUIDTERMINALTYPE",2176059722:"IFCLINEARELEMENT",679976338:"IFCKERBTYPE",3948183225:"IFCIMPACTPROTECTIONDEVICETYPE",2568555532:"IFCIMPACTPROTECTIONDEVICE",2898700619:"IFCGRADIENTCURVE",1594536857:"IFCGEOTECHNICALSTRATUM",4230923436:"IFCGEOTECHNICALELEMENT",4228831410:"IFCFACILITYPARTCOMMON",1310830890:"IFCFACILITYPART",24185140:"IFCFACILITY",4234616927:"IFCDIRECTRIXDERIVEDREFERENCESWEPTAREASOLID",1306400036:"IFCDEEPFOUNDATIONTYPE",4189326743:"IFCCOURSETYPE",2000195564:"IFCCOSINESPIRAL",3497074424:"IFCCLOTHOID",1626504194:"IFCBUILTELEMENTTYPE",3651464721:"IFCVEHICLETYPE",1229763772:"IFCTRIANGULATEDIRREGULARNETWORK",3665877780:"IFCTRANSPORTATIONDEVICETYPE",782932809:"IFCTHIRDORDERPOLYNOMIALSPIRAL",2735484536:"IFCSPIRAL",1356537516:"IFCSECTIONEDSURFACE",1290935644:"IFCSECTIONEDSOLIDHORIZONTAL",1862484736:"IFCSECTIONEDSOLID",1441486842:"IFCRELPOSITIONS",1033248425:"IFCRELASSOCIATESPROFILEDEF",3381221214:"IFCPOLYNOMIALCURVE",2485787929:"IFCOFFSETCURVEBYDISTANCES",590820931:"IFCOFFSETCURVE",3465909080:"IFCINDEXEDPOLYGONALTEXTUREMAP",593015953:"IFCDIRECTRIXCURVESWEPTAREASOLID",4212018352:"IFCCURVESEGMENT",3425423356:"IFCAXIS2PLACEMENTLINEAR",823603102:"IFCSEGMENT",2165702409:"IFCPOINTBYDISTANCEEXPRESSION",182550632:"IFCOPENCROSSPROFILEDEF",388784114:"IFCLINEARPLACEMENT",536804194:"IFCALIGNMENTHORIZONTALSEGMENT",3752311538:"IFCALIGNMENTCANTSEGMENT",1010789467:"IFCTEXTURECOORDINATEINDICESWITHVOIDS",222769930:"IFCTEXTURECOORDINATEINDICES",2691318326:"IFCQUANTITYNUMBER",3633395639:"IFCALIGNMENTVERTICALSEGMENT",2879124712:"IFCALIGNMENTPARAMETERSEGMENT",25142252:"IFCCONTROLLER",3087945054:"IFCALARM",4288193352:"IFCACTUATOR",630975310:"IFCUNITARYCONTROLELEMENT",4086658281:"IFCSENSOR",2295281155:"IFCPROTECTIVEDEVICETRIPPINGUNIT",182646315:"IFCFLOWINSTRUMENT",1426591983:"IFCFIRESUPPRESSIONTERMINAL",819412036:"IFCFILTER",3415622556:"IFCFAN",1003880860:"IFCELECTRICTIMECONTROL",402227799:"IFCELECTRICMOTOR",264262732:"IFCELECTRICGENERATOR",3310460725:"IFCELECTRICFLOWSTORAGEDEVICE",862014818:"IFCELECTRICDISTRIBUTIONBOARD",1904799276:"IFCELECTRICAPPLIANCE",1360408905:"IFCDUCTSILENCER",3518393246:"IFCDUCTSEGMENT",342316401:"IFCDUCTFITTING",562808652:"IFCDISTRIBUTIONCIRCUIT",4074379575:"IFCDAMPER",3640358203:"IFCCOOLINGTOWER",4136498852:"IFCCOOLEDBEAM",2272882330:"IFCCONDENSER",3571504051:"IFCCOMPRESSOR",3221913625:"IFCCOMMUNICATIONSAPPLIANCE",639361253:"IFCCOIL",3902619387:"IFCCHILLER",4217484030:"IFCCABLESEGMENT",1051757585:"IFCCABLEFITTING",3758799889:"IFCCABLECARRIERSEGMENT",635142910:"IFCCABLECARRIERFITTING",2938176219:"IFCBURNER",32344328:"IFCBOILER",2906023776:"IFCBEAMSTANDARDCASE",277319702:"IFCAUDIOVISUALAPPLIANCE",2056796094:"IFCAIRTOAIRHEATRECOVERY",177149247:"IFCAIRTERMINALBOX",1634111441:"IFCAIRTERMINAL",486154966:"IFCWINDOWSTANDARDCASE",4237592921:"IFCWASTETERMINAL",4156078855:"IFCWALLELEMENTEDCASE",4207607924:"IFCVALVE",4292641817:"IFCUNITARYEQUIPMENT",3179687236:"IFCUNITARYCONTROLELEMENTTYPE",3026737570:"IFCTUBEBUNDLE",3825984169:"IFCTRANSFORMER",812556717:"IFCTANK",1162798199:"IFCSWITCHINGDEVICE",385403989:"IFCSTRUCTURALLOADCASE",1404847402:"IFCSTACKTERMINAL",1999602285:"IFCSPACEHEATER",3420628829:"IFCSOLARDEVICE",3027962421:"IFCSLABSTANDARDCASE",3127900445:"IFCSLABELEMENTEDCASE",1329646415:"IFCSHADINGDEVICE",3053780830:"IFCSANITARYTERMINAL",2572171363:"IFCREINFORCINGBARTYPE",1232101972:"IFCRATIONALBSPLINECURVEWITHKNOTS",90941305:"IFCPUMP",655969474:"IFCPROTECTIVEDEVICETRIPPINGUNITTYPE",738039164:"IFCPROTECTIVEDEVICE",1156407060:"IFCPLATESTANDARDCASE",3612865200:"IFCPIPESEGMENT",310824031:"IFCPIPEFITTING",3694346114:"IFCOUTLET",144952367:"IFCOUTERBOUNDARYCURVE",2474470126:"IFCMOTORCONNECTION",1911478936:"IFCMEMBERSTANDARDCASE",1437502449:"IFCMEDICALDEVICE",629592764:"IFCLIGHTFIXTURE",76236018:"IFCLAMP",2176052936:"IFCJUNCTIONBOX",4175244083:"IFCINTERCEPTOR",2068733104:"IFCHUMIDIFIER",3319311131:"IFCHEATEXCHANGER",2188021234:"IFCFLOWMETER",1209101575:"IFCEXTERNALSPATIALELEMENT",484807127:"IFCEVAPORATOR",3747195512:"IFCEVAPORATIVECOOLER",2814081492:"IFCENGINE",2417008758:"IFCELECTRICDISTRIBUTIONBOARDTYPE",3242481149:"IFCDOORSTANDARDCASE",3205830791:"IFCDISTRIBUTIONSYSTEM",400855858:"IFCCOMMUNICATIONSAPPLIANCETYPE",905975707:"IFCCOLUMNSTANDARDCASE",1677625105:"IFCCIVILELEMENT",3296154744:"IFCCHIMNEY",2674252688:"IFCCABLEFITTINGTYPE",2188180465:"IFCBURNERTYPE",1177604601:"IFCBUILDINGSYSTEM",39481116:"IFCBUILDINGELEMENTPARTTYPE",1136057603:"IFCBOUNDARYCURVE",2461110595:"IFCBSPLINECURVEWITHKNOTS",1532957894:"IFCAUDIOVISUALAPPLIANCETYPE",4088093105:"IFCWORKCALENDAR",4009809668:"IFCWINDOWTYPE",926996030:"IFCVOIDINGFEATURE",2391383451:"IFCVIBRATIONISOLATOR",2415094496:"IFCTENDONTYPE",3081323446:"IFCTENDONANCHORTYPE",413509423:"IFCSYSTEMFURNITUREELEMENT",3101698114:"IFCSURFACEFEATURE",3657597509:"IFCSTRUCTURALSURFACEACTION",2757150158:"IFCSTRUCTURALCURVEREACTION",1004757350:"IFCSTRUCTURALCURVEACTION",338393293:"IFCSTAIRTYPE",1072016465:"IFCSOLARDEVICETYPE",4074543187:"IFCSHADINGDEVICETYPE",2157484638:"IFCSEAMCURVE",2781568857:"IFCROOFTYPE",2310774935:"IFCREINFORCINGMESHTYPE",964333572:"IFCREINFORCINGELEMENTTYPE",683857671:"IFCRATIONALBSPLINESURFACEWITHKNOTS",1469900589:"IFCRAMPTYPE",2839578677:"IFCPOLYGONALFACESET",1158309216:"IFCPILETYPE",3079942009:"IFCOPENINGSTANDARDCASE",1114901282:"IFCMEDICALDEVICETYPE",3113134337:"IFCINTERSECTIONCURVE",3946677679:"IFCINTERCEPTORTYPE",2571569899:"IFCINDEXEDPOLYCURVE",3493046030:"IFCGEOGRAPHICELEMENT",1509553395:"IFCFURNITURE",1893162501:"IFCFOOTINGTYPE",2853485674:"IFCEXTERNALSPATIALSTRUCTUREELEMENT",4148101412:"IFCEVENT",132023988:"IFCENGINETYPE",2397081782:"IFCELEMENTASSEMBLYTYPE",2323601079:"IFCDOORTYPE",1213902940:"IFCCYLINDRICALSURFACE",1525564444:"IFCCONSTRUCTIONPRODUCTRESOURCETYPE",4105962743:"IFCCONSTRUCTIONMATERIALRESOURCETYPE",2185764099:"IFCCONSTRUCTIONEQUIPMENTRESOURCETYPE",15328376:"IFCCOMPOSITECURVEONSURFACE",3875453745:"IFCCOMPLEXPROPERTYTEMPLATE",3893394355:"IFCCIVILELEMENTTYPE",2197970202:"IFCCHIMNEYTYPE",167062518:"IFCBSPLINESURFACEWITHKNOTS",2887950389:"IFCBSPLINESURFACE",2603310189:"IFCADVANCEDBREPWITHVOIDS",1635779807:"IFCADVANCEDBREP",2916149573:"IFCTRIANGULATEDFACESET",1935646853:"IFCTOROIDALSURFACE",2387106220:"IFCTESSELLATEDFACESET",3206491090:"IFCTASKTYPE",699246055:"IFCSURFACECURVE",4095615324:"IFCSUBCONTRACTRESOURCETYPE",603775116:"IFCSTRUCTURALSURFACEREACTION",4015995234:"IFCSPHERICALSURFACE",2481509218:"IFCSPATIALZONETYPE",463610769:"IFCSPATIALZONE",710998568:"IFCSPATIALELEMENTTYPE",1412071761:"IFCSPATIALELEMENT",3663146110:"IFCSIMPLEPROPERTYTEMPLATE",3243963512:"IFCREVOLVEDAREASOLIDTAPERED",816062949:"IFCREPARAMETRISEDCOMPOSITECURVESEGMENT",1521410863:"IFCRELSPACEBOUNDARY2NDLEVEL",3523091289:"IFCRELSPACEBOUNDARY1STLEVEL",427948657:"IFCRELINTERFERESELEMENTS",307848117:"IFCRELDEFINESBYTEMPLATE",1462361463:"IFCRELDEFINESBYOBJECT",2565941209:"IFCRELDECLARES",1027710054:"IFCRELASSIGNSTOGROUPBYFACTOR",3521284610:"IFCPROPERTYTEMPLATE",492091185:"IFCPROPERTYSETTEMPLATE",653396225:"IFCPROJECTLIBRARY",569719735:"IFCPROCEDURETYPE",3967405729:"IFCPREDEFINEDPROPERTYSET",1682466193:"IFCPCURVE",428585644:"IFCLABORRESOURCETYPE",2294589976:"IFCINDEXEDPOLYGONALFACEWITHVOIDS",178912537:"IFCINDEXEDPOLYGONALFACE",4095422895:"IFCGEOGRAPHICELEMENTTYPE",2652556860:"IFCFIXEDREFERENCESWEPTAREASOLID",2804161546:"IFCEXTRUDEDAREASOLIDTAPERED",4024345920:"IFCEVENTTYPE",2629017746:"IFCCURVEBOUNDEDSURFACE",1815067380:"IFCCREWRESOURCETYPE",3419103109:"IFCCONTEXT",2574617495:"IFCCONSTRUCTIONRESOURCETYPE",2059837836:"IFCCARTESIANPOINTLIST3D",1675464909:"IFCCARTESIANPOINTLIST2D",574549367:"IFCCARTESIANPOINTLIST",3406155212:"IFCADVANCEDFACE",3698973494:"IFCTYPERESOURCE",3736923433:"IFCTYPEPROCESS",901063453:"IFCTESSELLATEDITEM",1096409881:"IFCSWEPTDISKSOLIDPOLYGONAL",1042787934:"IFCRESOURCETIME",1608871552:"IFCRESOURCECONSTRAINTRELATIONSHIP",2943643501:"IFCRESOURCEAPPROVALRELATIONSHIP",2090586900:"IFCQUANTITYSET",1482703590:"IFCPROPERTYTEMPLATEDEFINITION",3778827333:"IFCPREDEFINEDPROPERTIES",2998442950:"IFCMIRROREDPROFILEDEF",853536259:"IFCMATERIALRELATIONSHIP",3404854881:"IFCMATERIALPROFILESETUSAGETAPERING",3079605661:"IFCMATERIALPROFILESETUSAGE",2852063980:"IFCMATERIALCONSTITUENTSET",3708119e3:"IFCMATERIALCONSTITUENT",1585845231:"IFCLAGTIME",2133299955:"IFCINDEXEDTRIANGLETEXTUREMAP",1437953363:"IFCINDEXEDTEXTUREMAP",3570813810:"IFCINDEXEDCOLOURMAP",1437805879:"IFCEXTERNALREFERENCERELATIONSHIP",297599258:"IFCEXTENDEDPROPERTIES",211053100:"IFCEVENTTIME",2713554722:"IFCCONVERSIONBASEDUNITWITHOFFSET",3285139300:"IFCCOLOURRGBLIST",1236880293:"IFCWORKTIME",1199560280:"IFCTIMEPERIOD",3611470254:"IFCTEXTUREVERTEXLIST",2771591690:"IFCTASKTIMERECURRING",1549132990:"IFCTASKTIME",2043862942:"IFCTABLECOLUMN",2934153892:"IFCSURFACEREINFORCEMENTAREA",609421318:"IFCSTRUCTURALLOADORRESULT",3478079324:"IFCSTRUCTURALLOADCONFIGURATION",1054537805:"IFCSCHEDULINGTIME",2439245199:"IFCRESOURCELEVELRELATIONSHIP",2433181523:"IFCREFERENCE",3915482550:"IFCRECURRENCEPATTERN",986844984:"IFCPROPERTYABSTRACTION",3843373140:"IFCPROJECTEDCRS",677532197:"IFCPRESENTATIONITEM",1507914824:"IFCMATERIALUSAGEDEFINITION",552965576:"IFCMATERIALPROFILEWITHOFFSETS",164193824:"IFCMATERIALPROFILESET",2235152071:"IFCMATERIALPROFILE",1847252529:"IFCMATERIALLAYERWITHOFFSETS",760658860:"IFCMATERIALDEFINITION",3057273783:"IFCMAPCONVERSION",4294318154:"IFCEXTERNALINFORMATION",1466758467:"IFCCOORDINATEREFERENCESYSTEM",1785450214:"IFCCOORDINATEOPERATION",775493141:"IFCCONNECTIONVOLUMEGEOMETRY",979691226:"IFCREINFORCINGBAR",3700593921:"IFCELECTRICDISTRIBUTIONPOINT",1062813311:"IFCDISTRIBUTIONCONTROLELEMENT",1052013943:"IFCDISTRIBUTIONCHAMBERELEMENT",578613899:"IFCCONTROLLERTYPE",2454782716:"IFCCHAMFEREDGEFEATURE",753842376:"IFCBEAM",3001207471:"IFCALARMTYPE",2874132201:"IFCACTUATORTYPE",3304561284:"IFCWINDOW",3512223829:"IFCWALLSTANDARDCASE",2391406946:"IFCWALL",3313531582:"IFCVIBRATIONISOLATORTYPE",2347447852:"IFCTENDONANCHOR",3824725483:"IFCTENDON",2515109513:"IFCSTRUCTURALANALYSISMODEL",4252922144:"IFCSTAIRFLIGHT",331165859:"IFCSTAIR",1529196076:"IFCSLAB",1783015770:"IFCSENSORTYPE",1376911519:"IFCROUNDEDEDGEFEATURE",2016517767:"IFCROOF",2320036040:"IFCREINFORCINGMESH",3027567501:"IFCREINFORCINGELEMENT",3055160366:"IFCRATIONALBEZIERCURVE",3283111854:"IFCRAMPFLIGHT",3024970846:"IFCRAMP",2262370178:"IFCRAILING",3171933400:"IFCPLATE",1687234759:"IFCPILE",1073191201:"IFCMEMBER",900683007:"IFCFOOTING",3508470533:"IFCFLOWTREATMENTDEVICE",2223149337:"IFCFLOWTERMINAL",707683696:"IFCFLOWSTORAGEDEVICE",987401354:"IFCFLOWSEGMENT",3132237377:"IFCFLOWMOVINGDEVICE",4037862832:"IFCFLOWINSTRUMENTTYPE",4278956645:"IFCFLOWFITTING",2058353004:"IFCFLOWCONTROLLER",4222183408:"IFCFIRESUPPRESSIONTERMINALTYPE",1810631287:"IFCFILTERTYPE",346874300:"IFCFANTYPE",1658829314:"IFCENERGYCONVERSIONDEVICE",857184966:"IFCELECTRICALELEMENT",1634875225:"IFCELECTRICALCIRCUIT",712377611:"IFCELECTRICTIMECONTROLTYPE",1217240411:"IFCELECTRICMOTORTYPE",1365060375:"IFCELECTRICHEATERTYPE",1534661035:"IFCELECTRICGENERATORTYPE",3277789161:"IFCELECTRICFLOWSTORAGEDEVICETYPE",663422040:"IFCELECTRICAPPLIANCETYPE",855621170:"IFCEDGEFEATURE",2030761528:"IFCDUCTSILENCERTYPE",3760055223:"IFCDUCTSEGMENTTYPE",869906466:"IFCDUCTFITTINGTYPE",395920057:"IFCDOOR",3041715199:"IFCDISTRIBUTIONPORT",3040386961:"IFCDISTRIBUTIONFLOWELEMENT",1945004755:"IFCDISTRIBUTIONELEMENT",2063403501:"IFCDISTRIBUTIONCONTROLELEMENTTYPE",1599208980:"IFCDISTRIBUTIONCHAMBERELEMENTTYPE",2635815018:"IFCDISCRETEACCESSORYTYPE",1335981549:"IFCDISCRETEACCESSORY",4147604152:"IFCDIAMETERDIMENSION",3961806047:"IFCDAMPERTYPE",3495092785:"IFCCURTAINWALL",1973544240:"IFCCOVERING",2954562838:"IFCCOOLINGTOWERTYPE",335055490:"IFCCOOLEDBEAMTYPE",488727124:"IFCCONSTRUCTIONPRODUCTRESOURCE",1060000209:"IFCCONSTRUCTIONMATERIALRESOURCE",3898045240:"IFCCONSTRUCTIONEQUIPMENTRESOURCE",1163958913:"IFCCONDITIONCRITERION",2188551683:"IFCCONDITION",2816379211:"IFCCONDENSERTYPE",3850581409:"IFCCOMPRESSORTYPE",843113511:"IFCCOLUMN",2301859152:"IFCCOILTYPE",2611217952:"IFCCIRCLE",2951183804:"IFCCHILLERTYPE",1285652485:"IFCCABLESEGMENTTYPE",3293546465:"IFCCABLECARRIERSEGMENTTYPE",395041908:"IFCCABLECARRIERFITTINGTYPE",1909888760:"IFCBUILDINGELEMENTPROXYTYPE",1095909175:"IFCBUILDINGELEMENTPROXY",2979338954:"IFCBUILDINGELEMENTPART",52481810:"IFCBUILDINGELEMENTCOMPONENT",3299480353:"IFCBUILDINGELEMENT",231477066:"IFCBOILERTYPE",1916977116:"IFCBEZIERCURVE",819618141:"IFCBEAMTYPE",1967976161:"IFCBSPLINECURVE",3460190687:"IFCASSET",2470393545:"IFCANGULARDIMENSION",1871374353:"IFCAIRTOAIRHEATRECOVERYTYPE",3352864051:"IFCAIRTERMINALTYPE",1411407467:"IFCAIRTERMINALBOXTYPE",3821786052:"IFCACTIONREQUEST",1213861670:"IFC2DCOMPOSITECURVE",1033361043:"IFCZONE",3342526732:"IFCWORKSCHEDULE",4218914973:"IFCWORKPLAN",1028945134:"IFCWORKCONTROL",1133259667:"IFCWASTETERMINALTYPE",1898987631:"IFCWALLTYPE",2769231204:"IFCVIRTUALELEMENT",728799441:"IFCVALVETYPE",1911125066:"IFCUNITARYEQUIPMENTTYPE",1600972822:"IFCTUBEBUNDLETYPE",3593883385:"IFCTRIMMEDCURVE",1620046519:"IFCTRANSPORTELEMENT",1692211062:"IFCTRANSFORMERTYPE",1637806684:"IFCTIMESERIESSCHEDULE",5716631:"IFCTANKTYPE",2254336722:"IFCSYSTEM",2315554128:"IFCSWITCHINGDEVICETYPE",148013059:"IFCSUBCONTRACTRESOURCE",1975003073:"IFCSTRUCTURALSURFACECONNECTION",2986769608:"IFCSTRUCTURALRESULTGROUP",1235345126:"IFCSTRUCTURALPOINTREACTION",734778138:"IFCSTRUCTURALPOINTCONNECTION",2082059205:"IFCSTRUCTURALPOINTACTION",3987759626:"IFCSTRUCTURALPLANARACTIONVARYING",1621171031:"IFCSTRUCTURALPLANARACTION",1252848954:"IFCSTRUCTURALLOADGROUP",1721250024:"IFCSTRUCTURALLINEARACTIONVARYING",1807405624:"IFCSTRUCTURALLINEARACTION",2445595289:"IFCSTRUCTURALCURVEMEMBERVARYING",214636428:"IFCSTRUCTURALCURVEMEMBER",4243806635:"IFCSTRUCTURALCURVECONNECTION",1179482911:"IFCSTRUCTURALCONNECTION",682877961:"IFCSTRUCTURALACTION",1039846685:"IFCSTAIRFLIGHTTYPE",3112655638:"IFCSTACKTERMINALTYPE",3812236995:"IFCSPACETYPE",652456506:"IFCSPACEPROGRAM",1305183839:"IFCSPACEHEATERTYPE",3856911033:"IFCSPACE",2533589738:"IFCSLABTYPE",4097777520:"IFCSITE",4105383287:"IFCSERVICELIFE",3517283431:"IFCSCHEDULETIMECONTROL",1768891740:"IFCSANITARYTERMINALTYPE",2863920197:"IFCRELASSIGNSTASKS",160246688:"IFCRELAGGREGATES",2324767716:"IFCRAMPFLIGHTTYPE",2893384427:"IFCRAILINGTYPE",3248260540:"IFCRADIUSDIMENSION",2250791053:"IFCPUMPTYPE",1842657554:"IFCPROTECTIVEDEVICETYPE",3651124850:"IFCPROJECTIONELEMENT",3642467123:"IFCPROJECTORDERRECORD",2904328755:"IFCPROJECTORDER",2744685151:"IFCPROCEDURE",3740093272:"IFCPORT",3724593414:"IFCPOLYLINE",4017108033:"IFCPLATETYPE",4231323485:"IFCPIPESEGMENTTYPE",804291784:"IFCPIPEFITTINGTYPE",3327091369:"IFCPERMIT",2382730787:"IFCPERFORMANCEHISTORY",2837617999:"IFCOUTLETTYPE",3425660407:"IFCORDERACTION",3588315303:"IFCOPENINGELEMENT",4143007308:"IFCOCCUPANT",1916936684:"IFCMOVE",977012517:"IFCMOTORCONNECTIONTYPE",3181161470:"IFCMEMBERTYPE",2108223431:"IFCMECHANICALFASTENERTYPE",377706215:"IFCMECHANICALFASTENER",2506943328:"IFCLINEARDIMENSION",1161773419:"IFCLIGHTFIXTURETYPE",1051575348:"IFCLAMPTYPE",3827777499:"IFCLABORRESOURCE",4288270099:"IFCJUNCTIONBOXTYPE",2391368822:"IFCINVENTORY",1806887404:"IFCHUMIDIFIERTYPE",1251058090:"IFCHEATEXCHANGERTYPE",2706460486:"IFCGROUP",3009204131:"IFCGRID",200128114:"IFCGASTERMINALTYPE",814719939:"IFCFURNITURESTANDARD",263784265:"IFCFURNISHINGELEMENT",3009222698:"IFCFLOWTREATMENTDEVICETYPE",2297155007:"IFCFLOWTERMINALTYPE",1339347760:"IFCFLOWSTORAGEDEVICETYPE",1834744321:"IFCFLOWSEGMENTTYPE",1482959167:"IFCFLOWMOVINGDEVICETYPE",3815607619:"IFCFLOWMETERTYPE",3198132628:"IFCFLOWFITTINGTYPE",3907093117:"IFCFLOWCONTROLLERTYPE",1287392070:"IFCFEATUREELEMENTSUBTRACTION",2143335405:"IFCFEATUREELEMENTADDITION",2827207264:"IFCFEATUREELEMENT",2489546625:"IFCFASTENERTYPE",647756555:"IFCFASTENER",3737207727:"IFCFACETEDBREPWITHVOIDS",807026263:"IFCFACETEDBREP",3390157468:"IFCEVAPORATORTYPE",3174744832:"IFCEVAPORATIVECOOLERTYPE",3272907226:"IFCEQUIPMENTSTANDARD",1962604670:"IFCEQUIPMENTELEMENT",2107101300:"IFCENERGYCONVERSIONDEVICETYPE",1704287377:"IFCELLIPSE",2590856083:"IFCELEMENTCOMPONENTTYPE",1623761950:"IFCELEMENTCOMPONENT",4123344466:"IFCELEMENTASSEMBLY",1758889154:"IFCELEMENT",360485395:"IFCELECTRICALBASEPROPERTIES",3849074793:"IFCDISTRIBUTIONFLOWELEMENTTYPE",3256556792:"IFCDISTRIBUTIONELEMENTTYPE",681481545:"IFCDIMENSIONCURVEDIRECTEDCALLOUT",1457835157:"IFCCURTAINWALLTYPE",3295246426:"IFCCREWRESOURCE",1916426348:"IFCCOVERINGTYPE",1419761937:"IFCCOSTSCHEDULE",3895139033:"IFCCOSTITEM",3293443760:"IFCCONTROL",2559216714:"IFCCONSTRUCTIONRESOURCE",2510884976:"IFCCONIC",3732776249:"IFCCOMPOSITECURVE",300633059:"IFCCOLUMNTYPE",2937912522:"IFCCIRCLEHOLLOWPROFILEDEF",3124254112:"IFCBUILDINGSTOREY",1950629157:"IFCBUILDINGELEMENTTYPE",4031249490:"IFCBUILDING",1260505505:"IFCBOUNDEDCURVE",3649129432:"IFCBOOLEANCLIPPINGRESULT",1334484129:"IFCBLOCK",3207858831:"IFCASYMMETRICISHAPEPROFILEDEF",1674181508:"IFCANNOTATION",2296667514:"IFCACTOR",2097647324:"IFCTRANSPORTELEMENTTYPE",3473067441:"IFCTASK",1580310250:"IFCSYSTEMFURNITUREELEMENTTYPE",4124788165:"IFCSURFACEOFREVOLUTION",2809605785:"IFCSURFACEOFLINEAREXTRUSION",2028607225:"IFCSURFACECURVESWEPTAREASOLID",4070609034:"IFCSTRUCTUREDDIMENSIONCALLOUT",2218152070:"IFCSTRUCTURALSURFACEMEMBERVARYING",3979015343:"IFCSTRUCTURALSURFACEMEMBER",3689010777:"IFCSTRUCTURALREACTION",530289379:"IFCSTRUCTURALMEMBER",3136571912:"IFCSTRUCTURALITEM",3544373492:"IFCSTRUCTURALACTIVITY",451544542:"IFCSPHERE",3893378262:"IFCSPATIALSTRUCTUREELEMENTTYPE",2706606064:"IFCSPATIALSTRUCTUREELEMENT",3626867408:"IFCRIGHTCIRCULARCYLINDER",4158566097:"IFCRIGHTCIRCULARCONE",1856042241:"IFCREVOLVEDAREASOLID",2914609552:"IFCRESOURCE",1401173127:"IFCRELVOIDSELEMENT",3451746338:"IFCRELSPACEBOUNDARY",366585022:"IFCRELSERVICESBUILDINGS",4122056220:"IFCRELSEQUENCE",1058617721:"IFCRELSCHEDULESCOSTITEMS",1245217292:"IFCRELREFERENCEDINSPATIALSTRUCTURE",750771296:"IFCRELPROJECTSELEMENT",202636808:"IFCRELOVERRIDESPROPERTIES",2051452291:"IFCRELOCCUPIESSPACES",3268803585:"IFCRELNESTS",4189434867:"IFCRELINTERACTIONREQUIREMENTS",279856033:"IFCRELFLOWCONTROLELEMENTS",3940055652:"IFCRELFILLSELEMENT",781010003:"IFCRELDEFINESBYTYPE",4186316022:"IFCRELDEFINESBYPROPERTIES",693640335:"IFCRELDEFINES",2551354335:"IFCRELDECOMPOSES",2802773753:"IFCRELCOVERSSPACES",886880790:"IFCRELCOVERSBLDGELEMENTS",3242617779:"IFCRELCONTAINEDINSPATIALSTRUCTURE",3678494232:"IFCRELCONNECTSWITHREALIZINGELEMENTS",504942748:"IFCRELCONNECTSWITHECCENTRICITY",1638771189:"IFCRELCONNECTSSTRUCTURALMEMBER",3912681535:"IFCRELCONNECTSSTRUCTURALELEMENT",2127690289:"IFCRELCONNECTSSTRUCTURALACTIVITY",3190031847:"IFCRELCONNECTSPORTS",4201705270:"IFCRELCONNECTSPORTTOELEMENT",3945020480:"IFCRELCONNECTSPATHELEMENTS",1204542856:"IFCRELCONNECTSELEMENTS",826625072:"IFCRELCONNECTS",2851387026:"IFCRELASSOCIATESPROFILEPROPERTIES",2655215786:"IFCRELASSOCIATESMATERIAL",3840914261:"IFCRELASSOCIATESLIBRARY",982818633:"IFCRELASSOCIATESDOCUMENT",2728634034:"IFCRELASSOCIATESCONSTRAINT",919958153:"IFCRELASSOCIATESCLASSIFICATION",4095574036:"IFCRELASSOCIATESAPPROVAL",1327628568:"IFCRELASSOCIATESAPPLIEDVALUE",1865459582:"IFCRELASSOCIATES",205026976:"IFCRELASSIGNSTORESOURCE",3372526763:"IFCRELASSIGNSTOPROJECTORDER",2857406711:"IFCRELASSIGNSTOPRODUCT",4278684876:"IFCRELASSIGNSTOPROCESS",1307041759:"IFCRELASSIGNSTOGROUP",2495723537:"IFCRELASSIGNSTOCONTROL",1683148259:"IFCRELASSIGNSTOACTOR",3939117080:"IFCRELASSIGNS",3454111270:"IFCRECTANGULARTRIMMEDSURFACE",2798486643:"IFCRECTANGULARPYRAMID",2770003689:"IFCRECTANGLEHOLLOWPROFILEDEF",3219374653:"IFCPROXY",1451395588:"IFCPROPERTYSET",4194566429:"IFCPROJECTIONCURVE",103090709:"IFCPROJECT",4208778838:"IFCPRODUCT",2945172077:"IFCPROCESS",220341763:"IFCPLANE",603570806:"IFCPLANARBOX",3566463478:"IFCPERMEABLECOVERINGPROPERTIES",3505215534:"IFCOFFSETCURVE3D",3388369263:"IFCOFFSETCURVE2D",3888040117:"IFCOBJECT",1425443689:"IFCMANIFOLDSOLIDBREP",1281925730:"IFCLINE",572779678:"IFCLSHAPEPROFILEDEF",1484403080:"IFCISHAPEPROFILEDEF",987898635:"IFCGEOMETRICCURVESET",1268542332:"IFCFURNITURETYPE",4238390223:"IFCFURNISHINGELEMENTTYPE",3455213021:"IFCFLUIDFLOWPROPERTIES",315944413:"IFCFILLAREASTYLETILES",4203026998:"IFCFILLAREASTYLETILESYMBOLWITHSTYLE",374418227:"IFCFILLAREASTYLEHATCHING",2047409740:"IFCFACEBASEDSURFACEMODEL",477187591:"IFCEXTRUDEDAREASOLID",80994333:"IFCENERGYPROPERTIES",2835456948:"IFCELLIPSEPROFILEDEF",2777663545:"IFCELEMENTARYSURFACE",339256511:"IFCELEMENTTYPE",1883228015:"IFCELEMENTQUANTITY",1472233963:"IFCEDGELOOP",4006246654:"IFCDRAUGHTINGPREDEFINEDCURVEFONT",445594917:"IFCDRAUGHTINGPREDEFINEDCOLOUR",3073041342:"IFCDRAUGHTINGCALLOUT",526551008:"IFCDOORSTYLE",1714330368:"IFCDOORPANELPROPERTIES",2963535650:"IFCDOORLININGPROPERTIES",32440307:"IFCDIRECTION",4054601972:"IFCDIMENSIONCURVETERMINATOR",606661476:"IFCDIMENSIONCURVE",693772133:"IFCDEFINEDSYMBOL",2827736869:"IFCCURVEBOUNDEDPLANE",2601014836:"IFCCURVE",2147822146:"IFCCSGSOLID",2506170314:"IFCCSGPRIMITIVE3D",194851669:"IFCCRANERAILFSHAPEPROFILEDEF",4133800736:"IFCCRANERAILASHAPEPROFILEDEF",2485617015:"IFCCOMPOSITECURVESEGMENT",2205249479:"IFCCLOSEDSHELL",1383045692:"IFCCIRCLEPROFILEDEF",1416205885:"IFCCARTESIANTRANSFORMATIONOPERATOR3DNONUNIFORM",3331915920:"IFCCARTESIANTRANSFORMATIONOPERATOR3D",3486308946:"IFCCARTESIANTRANSFORMATIONOPERATOR2DNONUNIFORM",3749851601:"IFCCARTESIANTRANSFORMATIONOPERATOR2D",59481748:"IFCCARTESIANTRANSFORMATIONOPERATOR",1123145078:"IFCCARTESIANPOINT",2898889636:"IFCCSHAPEPROFILEDEF",2713105998:"IFCBOXEDHALFSPACE",2581212453:"IFCBOUNDINGBOX",4182860854:"IFCBOUNDEDSURFACE",2736907675:"IFCBOOLEANRESULT",2740243338:"IFCAXIS2PLACEMENT3D",3125803723:"IFCAXIS2PLACEMENT2D",4261334040:"IFCAXIS1PLACEMENT",1302238472:"IFCANNOTATIONSURFACE",2265737646:"IFCANNOTATIONFILLAREAOCCURRENCE",669184980:"IFCANNOTATIONFILLAREA",3288037868:"IFCANNOTATIONCURVEOCCURRENCE",2543172580:"IFCZSHAPEPROFILEDEF",1299126871:"IFCWINDOWSTYLE",512836454:"IFCWINDOWPANELPROPERTIES",336235671:"IFCWINDOWLININGPROPERTIES",2759199220:"IFCVERTEXLOOP",1417489154:"IFCVECTOR",427810014:"IFCUSHAPEPROFILEDEF",2347495698:"IFCTYPEPRODUCT",1628702193:"IFCTYPEOBJECT",1345879162:"IFCTWODIRECTIONREPEATFACTOR",2715220739:"IFCTRAPEZIUMPROFILEDEF",3124975700:"IFCTEXTLITERALWITHEXTENT",4282788508:"IFCTEXTLITERAL",3028897424:"IFCTERMINATORSYMBOL",3071757647:"IFCTSHAPEPROFILEDEF",230924584:"IFCSWEPTSURFACE",1260650574:"IFCSWEPTDISKSOLID",2247615214:"IFCSWEPTAREASOLID",1878645084:"IFCSURFACESTYLERENDERING",2513912981:"IFCSURFACE",2233826070:"IFCSUBEDGE",3653947884:"IFCSTRUCTURALSTEELPROFILEPROPERTIES",3843319758:"IFCSTRUCTURALPROFILEPROPERTIES",1190533807:"IFCSTRUCTURALLOADSINGLEFORCEWARPING",1597423693:"IFCSTRUCTURALLOADSINGLEFORCE",1973038258:"IFCSTRUCTURALLOADSINGLEDISPLACEMENTDISTORTION",2473145415:"IFCSTRUCTURALLOADSINGLEDISPLACEMENT",2668620305:"IFCSTRUCTURALLOADPLANARFORCE",1595516126:"IFCSTRUCTURALLOADLINEARFORCE",390701378:"IFCSPACETHERMALLOADPROPERTIES",1202362311:"IFCSOUNDVALUE",2485662743:"IFCSOUNDPROPERTIES",723233188:"IFCSOLIDMODEL",2609359061:"IFCSLIPPAGECONNECTIONCONDITION",4124623270:"IFCSHELLBASEDSURFACEMODEL",2411513650:"IFCSERVICELIFEFACTOR",1509187699:"IFCSECTIONEDSPINE",2778083089:"IFCROUNDEDRECTANGLEPROFILEDEF",478536968:"IFCRELATIONSHIP",3765753017:"IFCREINFORCEMENTDEFINITIONPROPERTIES",3413951693:"IFCREGULARTIMESERIES",3615266464:"IFCRECTANGLEPROFILEDEF",110355661:"IFCPROPERTYTABLEVALUE",3650150729:"IFCPROPERTYSINGLEVALUE",3357820518:"IFCPROPERTYSETDEFINITION",941946838:"IFCPROPERTYREFERENCEVALUE",2752243245:"IFCPROPERTYLISTVALUE",4166981789:"IFCPROPERTYENUMERATEDVALUE",1680319473:"IFCPROPERTYDEFINITION",871118103:"IFCPROPERTYBOUNDEDVALUE",673634403:"IFCPRODUCTDEFINITIONSHAPE",179317114:"IFCPREDEFINEDPOINTMARKERSYMBOL",433424934:"IFCPREDEFINEDDIMENSIONSYMBOL",2559016684:"IFCPREDEFINEDCURVEFONT",759155922:"IFCPREDEFINEDCOLOUR",2775532180:"IFCPOLYGONALBOUNDEDHALFSPACE",2924175390:"IFCPOLYLOOP",1423911732:"IFCPOINTONSURFACE",4022376103:"IFCPOINTONCURVE",2067069095:"IFCPOINT",1663979128:"IFCPLANAREXTENT",2004835150:"IFCPLACEMENT",597895409:"IFCPIXELTEXTURE",3021840470:"IFCPHYSICALCOMPLEXQUANTITY",2519244187:"IFCPATH",2529465313:"IFCPARAMETERIZEDPROFILEDEF",1029017970:"IFCORIENTEDEDGE",2665983363:"IFCOPENSHELL",2833995503:"IFCONEDIRECTIONREPEATFACTOR",219451334:"IFCOBJECTDEFINITION",1430189142:"IFCMECHANICALCONCRETEMATERIALPROPERTIES",2022407955:"IFCMATERIALDEFINITIONREPRESENTATION",2347385850:"IFCMAPPEDITEM",1008929658:"IFCLOOP",2624227202:"IFCLOCALPLACEMENT",3422422726:"IFCLIGHTSOURCESPOT",1520743889:"IFCLIGHTSOURCEPOSITIONAL",4266656042:"IFCLIGHTSOURCEGONIOMETRIC",2604431987:"IFCLIGHTSOURCEDIRECTIONAL",125510826:"IFCLIGHTSOURCEAMBIENT",1402838566:"IFCLIGHTSOURCE",3741457305:"IFCIRREGULARTIMESERIES",3905492369:"IFCIMAGETEXTURE",2445078500:"IFCHYGROSCOPICMATERIALPROPERTIES",812098782:"IFCHALFSPACESOLID",178086475:"IFCGRIDPLACEMENT",3590301190:"IFCGEOMETRICSET",4142052618:"IFCGEOMETRICREPRESENTATIONSUBCONTEXT",2453401579:"IFCGEOMETRICREPRESENTATIONITEM",3448662350:"IFCGEOMETRICREPRESENTATIONCONTEXT",1446786286:"IFCGENERALPROFILEPROPERTIES",803998398:"IFCGENERALMATERIALPROPERTIES",3857492461:"IFCFUELPROPERTIES",738692330:"IFCFILLAREASTYLE",4219587988:"IFCFAILURECONNECTIONCONDITION",3008276851:"IFCFACESURFACE",803316827:"IFCFACEOUTERBOUND",1809719519:"IFCFACEBOUND",2556980723:"IFCFACE",1860660968:"IFCEXTENDEDMATERIALPROPERTIES",476780140:"IFCEDGECURVE",3900360178:"IFCEDGE",4170525392:"IFCDRAUGHTINGPREDEFINEDTEXTFONT",3732053477:"IFCDOCUMENTREFERENCE",1694125774:"IFCDIMENSIONPAIR",2273265877:"IFCDIMENSIONCALLOUTRELATIONSHIP",3632507154:"IFCDERIVEDPROFILEDEF",3800577675:"IFCCURVESTYLE",2889183280:"IFCCONVERSIONBASEDUNIT",3050246964:"IFCCONTEXTDEPENDENTUNIT",45288368:"IFCCONNECTIONPOINTECCENTRICITY",1981873012:"IFCCONNECTIONCURVEGEOMETRY",370225590:"IFCCONNECTEDFACESET",1485152156:"IFCCOMPOSITEPROFILEDEF",2542286263:"IFCCOMPLEXPROPERTY",776857604:"IFCCOLOURRGB",647927063:"IFCCLASSIFICATIONREFERENCE",3150382593:"IFCCENTERLINEPROFILEDEF",616511568:"IFCBLOBTEXTURE",2705031697:"IFCARBITRARYPROFILEDEFWITHVOIDS",1310608509:"IFCARBITRARYOPENPROFILEDEF",3798115385:"IFCARBITRARYCLOSEDPROFILEDEF",2297822566:"IFCANNOTATIONTEXTOCCURRENCE",3612888222:"IFCANNOTATIONSYMBOLOCCURRENCE",962685235:"IFCANNOTATIONSURFACEOCCURRENCE",2442683028:"IFCANNOTATIONOCCURRENCE",1065908215:"IFCWATERPROPERTIES",891718957:"IFCVIRTUALGRIDINTERSECTION",1907098498:"IFCVERTEXPOINT",3304826586:"IFCVERTEXBASEDTEXTUREMAP",2799835756:"IFCVERTEX",180925521:"IFCUNITASSIGNMENT",1735638870:"IFCTOPOLOGYREPRESENTATION",1377556343:"IFCTOPOLOGICALREPRESENTATIONITEM",581633288:"IFCTIMESERIESVALUE",1718945513:"IFCTIMESERIESREFERENCERELATIONSHIP",3101149627:"IFCTIMESERIES",3317419933:"IFCTHERMALMATERIALPROPERTIES",1210645708:"IFCTEXTUREVERTEX",2552916305:"IFCTEXTUREMAP",1742049831:"IFCTEXTURECOORDINATEGENERATOR",280115917:"IFCTEXTURECOORDINATE",1484833681:"IFCTEXTSTYLEWITHBOXCHARACTERISTICS",1640371178:"IFCTEXTSTYLETEXTMODEL",2636378356:"IFCTEXTSTYLEFORDEFINEDFONT",1983826977:"IFCTEXTSTYLEFONTMODEL",1447204868:"IFCTEXTSTYLE",912023232:"IFCTELECOMADDRESS",531007025:"IFCTABLEROW",985171141:"IFCTABLE",1290481447:"IFCSYMBOLSTYLE",626085974:"IFCSURFACETEXTURE",1351298697:"IFCSURFACESTYLEWITHTEXTURES",846575682:"IFCSURFACESTYLESHADING",1607154358:"IFCSURFACESTYLEREFRACTION",3303107099:"IFCSURFACESTYLELIGHTING",1300840506:"IFCSURFACESTYLE",3049322572:"IFCSTYLEDREPRESENTATION",3958052878:"IFCSTYLEDITEM",2830218821:"IFCSTYLEMODEL",3408363356:"IFCSTRUCTURALLOADTEMPERATURE",2525727697:"IFCSTRUCTURALLOADSTATIC",2162789131:"IFCSTRUCTURALLOAD",2273995522:"IFCSTRUCTURALCONNECTIONCONDITION",3692461612:"IFCSIMPLEPROPERTY",4240577450:"IFCSHAPEREPRESENTATION",3982875396:"IFCSHAPEMODEL",867548509:"IFCSHAPEASPECT",4165799628:"IFCSECTIONREINFORCEMENTPROPERTIES",2042790032:"IFCSECTIONPROPERTIES",448429030:"IFCSIUNIT",2341007311:"IFCROOT",3679540991:"IFCRIBPLATEPROFILEPROPERTIES",1660063152:"IFCREPRESENTATIONMAP",3008791417:"IFCREPRESENTATIONITEM",3377609919:"IFCREPRESENTATIONCONTEXT",1076942058:"IFCREPRESENTATION",1222501353:"IFCRELAXATION",1580146022:"IFCREINFORCEMENTBARPROPERTIES",2692823254:"IFCREFERENCESVALUEDOCUMENT",825690147:"IFCQUANTITYWEIGHT",2405470396:"IFCQUANTITYVOLUME",3252649465:"IFCQUANTITYTIME",931644368:"IFCQUANTITYLENGTH",2093928680:"IFCQUANTITYCOUNT",2044713172:"IFCQUANTITYAREA",3710013099:"IFCPROPERTYENUMERATION",148025276:"IFCPROPERTYDEPENDENCYRELATIONSHIP",3896028662:"IFCPROPERTYCONSTRAINTRELATIONSHIP",2598011224:"IFCPROPERTY",2802850158:"IFCPROFILEPROPERTIES",3958567839:"IFCPROFILEDEF",2267347899:"IFCPRODUCTSOFCOMBUSTIONPROPERTIES",2095639259:"IFCPRODUCTREPRESENTATION",2417041796:"IFCPRESENTATIONSTYLEASSIGNMENT",3119450353:"IFCPRESENTATIONSTYLE",1304840413:"IFCPRESENTATIONLAYERWITHSTYLE",2022622350:"IFCPRESENTATIONLAYERASSIGNMENT",1775413392:"IFCPREDEFINEDTEXTFONT",3213052703:"IFCPREDEFINEDTERMINATORSYMBOL",990879717:"IFCPREDEFINEDSYMBOL",3727388367:"IFCPREDEFINEDITEM",3355820592:"IFCPOSTALADDRESS",2226359599:"IFCPHYSICALSIMPLEQUANTITY",2483315170:"IFCPHYSICALQUANTITY",101040310:"IFCPERSONANDORGANIZATION",2077209135:"IFCPERSON",1207048766:"IFCOWNERHISTORY",1411181986:"IFCORGANIZATIONRELATIONSHIP",4251960020:"IFCORGANIZATION",1227763645:"IFCOPTICALMATERIALPROPERTIES",2251480897:"IFCOBJECTIVE",3701648758:"IFCOBJECTPLACEMENT",1918398963:"IFCNAMEDUNIT",2706619895:"IFCMONETARYUNIT",3368373690:"IFCMETRIC",677618848:"IFCMECHANICALSTEELMATERIALPROPERTIES",4256014907:"IFCMECHANICALMATERIALPROPERTIES",2597039031:"IFCMEASUREWITHUNIT",3265635763:"IFCMATERIALPROPERTIES",2199411900:"IFCMATERIALLIST",1303795690:"IFCMATERIALLAYERSETUSAGE",3303938423:"IFCMATERIALLAYERSET",248100487:"IFCMATERIALLAYER",1847130766:"IFCMATERIALCLASSIFICATIONRELATIONSHIP",1838606355:"IFCMATERIAL",30780891:"IFCLOCALTIME",1566485204:"IFCLIGHTINTENSITYDISTRIBUTION",4162380809:"IFCLIGHTDISTRIBUTIONDATA",3452421091:"IFCLIBRARYREFERENCE",2655187982:"IFCLIBRARYINFORMATION",3020489413:"IFCIRREGULARTIMESERIESVALUE",852622518:"IFCGRIDAXIS",3548104201:"IFCEXTERNALLYDEFINEDTEXTFONT",3207319532:"IFCEXTERNALLYDEFINEDSYMBOL",1040185647:"IFCEXTERNALLYDEFINEDSURFACESTYLE",2242383968:"IFCEXTERNALLYDEFINEDHATCHSTYLE",3200245327:"IFCEXTERNALREFERENCE",1648886627:"IFCENVIRONMENTALIMPACTVALUE",3796139169:"IFCDRAUGHTINGCALLOUTRELATIONSHIP",770865208:"IFCDOCUMENTINFORMATIONRELATIONSHIP",1154170062:"IFCDOCUMENTINFORMATION",1376555844:"IFCDOCUMENTELECTRONICFORMAT",2949456006:"IFCDIMENSIONALEXPONENTS",1045800335:"IFCDERIVEDUNITELEMENT",1765591967:"IFCDERIVEDUNIT",1072939445:"IFCDATEANDTIME",3510044353:"IFCCURVESTYLEFONTPATTERN",2367409068:"IFCCURVESTYLEFONTANDSCALING",1105321065:"IFCCURVESTYLEFONT",539742890:"IFCCURRENCYRELATIONSHIP",602808272:"IFCCOSTVALUE",1065062679:"IFCCOORDINATEDUNIVERSALTIMEOFFSET",347226245:"IFCCONSTRAINTRELATIONSHIP",613356794:"IFCCONSTRAINTCLASSIFICATIONRELATIONSHIP",1658513725:"IFCCONSTRAINTAGGREGATIONRELATIONSHIP",1959218052:"IFCCONSTRAINT",2732653382:"IFCCONNECTIONSURFACEGEOMETRY",4257277454:"IFCCONNECTIONPORTGEOMETRY",2614616156:"IFCCONNECTIONPOINTGEOMETRY",2859738748:"IFCCONNECTIONGEOMETRY",3264961684:"IFCCOLOURSPECIFICATION",3639012971:"IFCCLASSIFICATIONNOTATIONFACET",938368621:"IFCCLASSIFICATIONNOTATION",1098599126:"IFCCLASSIFICATIONITEMRELATIONSHIP",1767535486:"IFCCLASSIFICATIONITEM",747523909:"IFCCLASSIFICATION",622194075:"IFCCALENDARDATE",2069777674:"IFCBOUNDARYNODECONDITIONWARPING",1387855156:"IFCBOUNDARYNODECONDITION",3367102660:"IFCBOUNDARYFACECONDITION",1560379544:"IFCBOUNDARYEDGECONDITION",4037036970:"IFCBOUNDARYCONDITION",3869604511:"IFCAPPROVALRELATIONSHIP",390851274:"IFCAPPROVALPROPERTYRELATIONSHIP",2080292479:"IFCAPPROVALACTORRELATIONSHIP",130549933:"IFCAPPROVAL",1110488051:"IFCAPPLIEDVALUERELATIONSHIP",411424972:"IFCAPPLIEDVALUE",639542469:"IFCAPPLICATION",618182010:"IFCADDRESS",3630933823:"IFCACTORROLE",599546466:"FILE_DESCRIPTION",1390159747:"FILE_NAME",1109904537:"FILE_SCHEMA"},uo=class s{static getUnits(e){return ie(this,null,function*(){var t,i,n;let{IFCUNITASSIGNMENT:r}=Is,o=yield e.getAllPropertiesOfType(r);if(!o)return 1;let a=Object.keys(o),l=o[parseInt(a[0],10)];for(let c of l.Units){if(c.value===void 0||c.value===null)continue;let d=yield e.getProperties(c.value);if(!d||!d.UnitType||!d.UnitType.value||d.UnitType.value!=="LENGTHUNIT")continue;let h=1,u=1;return d.Name.value==="METRE"&&(u=1),d.Name.value==="FOOT"&&(u=.3048),((t=d.Prefix)==null?void 0:t.value)==="MILLI"?h=.001:((i=d.Prefix)==null?void 0:i.value)==="CENTI"?h=.01:((n=d.Prefix)==null?void 0:n.value)==="DECI"&&(h=.1),u*h}return 1})}static findItemByGuid(e,t){return ie(this,null,function*(){var i;let n=e.getAllPropertiesIDs();for(let r of n){let o=yield e.getProperties(r);if(o&&((i=o.GlobalId)==null?void 0:i.value)===t)return o}return null})}static getRelationMap(e,t,i){return ie(this,null,function*(){var n;let r=i??(()=>ie(this,null,function*(){})),o={},a=e.getAllPropertiesIDs();for(let l of a){let c=yield e.getProperties(l);if(!c)continue;let d=c.type===t,h=Object.keys(c).find(g=>g.startsWith("Relating")),u=Object.keys(c).find(g=>g.startsWith("Related"));if(!(d&&h&&u))continue;let p=yield e.getProperties((n=c[h])==null?void 0:n.value),f=c[u];if(!p||!f||!(f&&Array.isArray(f)))continue;let m=f.map(g=>g.value);yield r(p.expressID,m),o[p.expressID]=m}return o})}static getQsetQuantities(e,t,i){return ie(this,null,function*(){let n=i??(()=>{}),r=yield e.getProperties(t);return!r||r.type!==lh?null:(r.Quantities??[{}]).map(o=>(o.value&&n(o.value),o.value)).filter(o=>o!==null)})}static getPsetProps(e,t,i){return ie(this,null,function*(){let n=i??(()=>{}),r=yield e.getProperties(t);return!r||r.type!==ra?null:(r.HasProperties??[{}]).map(o=>(o.value&&n(o.value),o.value)).filter(o=>o!==null)})}static getPsetRel(e,t){return ie(this,null,function*(){var i;if(!(yield e.getProperties(t)))return null;let n=yield e.getAllPropertiesOfType(zu);if(!n)return null;let r=Object.values(n),o=null;for(let a of r)((i=a.RelatingPropertyDefinition)==null?void 0:i.value)===t&&(o=a.expressID);return o})}static getQsetRel(e,t){return ie(this,null,function*(){return s.getPsetRel(e,t)})}static getEntityName(e,t){return ie(this,null,function*(){var i;let n=yield e.getProperties(t);if(!n)return{key:null,name:null};let r=Object.keys(n).find(a=>a.endsWith("Name"))??null,o=r?(i=n[r])==null?void 0:i.value:null;return{key:r,name:o}})}static getQuantityValue(e,t){return ie(this,null,function*(){let i=yield e.getProperties(t);if(!i)return{key:null,value:null};let n=Object.keys(i).find(o=>o.endsWith("Value"))??null,r;return n===null||i[n]===void 0||i[n]===null?r=null:r=i[n].value,{key:n,value:r}})}static isRel(e){return fC[e].startsWith("IFCREL")}static attributeExists(e,t,i){return ie(this,null,function*(){let n=yield e.getProperties(t);return n?Object.keys(n).includes(i):!1})}static groupEntitiesByType(e,t){return ie(this,null,function*(){var i;let n=new Map;for(let r of t){let o=yield e.getProperties(r);if(!o)continue;let a=o.type;n.get(a)||n.set(a,new Set),(i=n.get(a))==null||i.add(r)}return n})}},W0=class{constructor(){q(this,"factor",1),q(this,"complement",1)}apply(e){let t=this.getScaleMatrix().multiply(e);e.copy(t)}setUp(e){var t,i,n;this.factor=1;let r=this.getLengthUnits(e);if(!r)return;let o=r==null,a=r.Name===void 0||r.Name===null;o||a||(r.Name.value==="FOOT"&&(this.factor=.3048),((t=r.Prefix)==null?void 0:t.value)==="MILLI"?this.complement=.001:((i=r.Prefix)==null?void 0:i.value)==="CENTI"?this.complement=.01:((n=r.Prefix)==null?void 0:n.value)==="DECI"&&(this.complement=.01))}getLengthUnits(e){try{let t=e.GetLineIDsWithType(0,hE).get(0),i=e.GetLine(0,t);for(let n of i.Units){if(!n||n.value===null||n.value===void 0)continue;let r=e.GetLine(0,n.value);if(r.UnitType&&r.UnitType.value==="LENGTHUNIT")return r}return null}catch{return console.log("Could not get units"),null}}getScaleMatrix(){let e=this.factor;return new lt().fromArray([e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1])}},Fp=class{constructor(){q(this,"itemsByFloor",{}),q(this,"_units",new W0)}setUp(e){this._units.setUp(e),this.cleanUp();try{let t=e.GetLineIDsWithType(0,Vu),i=new Set,n=e.GetLineIDsWithType(0,As);for(let c=0;c<n.size();c++)i.add(n.get(c));let r=e.GetLineIDsWithType(0,Uu),o=r.size();for(let c=0;c<o;c++){let d=r.get(c),h=e.GetLine(0,d);if(!h||!h.RelatingObject||!h.RelatedObjects)continue;let u=h.RelatingObject.value,p=h.RelatedObjects;for(let f of p){let m=f.value;i.has(m)&&(this.itemsByFloor[m]=u)}}let a={},l=t.size();for(let c=0;c<l;c++){let d=t.get(c),h=e.GetLine(0,d);if(!h||!h.RelatingStructure||!h.RelatedElements)continue;let u=h.RelatingStructure.value,p=h.RelatedElements;if(i.has(u))for(let f of p){a[u]||(a[u]=[]);let m=f.value;a[u].push(m)}else for(let f of p){let m=f.value;this.itemsByFloor[m]=u}}for(let c in a){let d=this.itemsByFloor[c];if(d!==void 0){let h=a[c];for(let u of h)this.itemsByFloor[u]=d}}for(let c=0;c<o;c++){let d=r.get(c),h=e.GetLine(0,d);if(!h||!h.RelatingObject||!h.RelatedObjects)continue;let u=h.RelatingObject.value,p=h.RelatedObjects;for(let f of p){let m=f.value,g=this.itemsByFloor[u];g!==void 0&&(this.itemsByFloor[m]=g)}}}catch{console.log("Could not get floors.")}}cleanUp(){this.itemsByFloor={}}},Fh=class{constructor(){q(this,"includeProperties",!0),q(this,"optionalCategories",[As]),q(this,"coordinate",!0),q(this,"wasm",{path:"",absolute:!1,logLevel:gE.LOG_LEVEL_OFF}),q(this,"excludedCategories",new Set),q(this,"includedCategories",new Set),q(this,"saveLocations",!1),q(this,"webIfc",{COORDINATE_TO_ORIGIN:!0}),q(this,"autoSetWasm",!0),q(this,"customLocateFileHandler",null)}},kp=class{constructor(){q(this,"defLineMat",new Mn({color:16777215}))}read(e){let t=e.GetAllAlignments(0),i=e.GetAllCrossSections2D(0),n=e.GetAllCrossSections3D(0),r={IfcAlignment:t,IfcCrossSection2D:i,IfcCrossSection3D:n};return this.get(r)}get(e){if(e.IfcAlignment){let t=new Map;for(let i of e.IfcAlignment){let n=new iE;n.absolute=this.getCurves(i.curve3D,n),n.horizontal=this.getCurves(i.horizontal,n),n.vertical=this.getCurves(i.vertical,n),t.set(t.size,n)}return{alignments:t,coordinationMatrix:new lt}}}getCurves(e,t){let i=[],n=0;for(let r of e){let o={};if(r.data)for(let u of r.data){let[p,f]=u.split(": "),m=parseFloat(f);o[p]=m||f}let{points:a}=r,l=new Float32Array(a.length*3);for(let u=0;u<a.length;u++){let{x:p,y:f,z:m}=a[u];l[u*3]=p,l[u*3+1]=f,l[u*3+2]=m||0}let c=new Ti(l,3),d=new Kw;d.setAttribute("position",c);let h=new nE(n,o,t,d,this.defLineMat);i.push(h.curve),n++}return i}},Np=class{getNameInfo(e){var t;let i={},{arguments:n}=e.GetHeaderLine(0,mE)||{};if(!n)return i;let[r,o,a,l,c,d,h]=n;if(r!=null&&r.value&&(i.name=r.value),o!=null&&o.value&&(i.creationDate=new Date(o.value)),a){i.author={};let[u,p]=a;u!=null&&u.value&&(i.author.name=u.value),p!=null&&p.value&&(i.author.email=p.value)}return(t=l[0])!=null&&t.value&&(i.organization=l[0].value),c!=null&&c.value&&(i.preprocessorVersion=c?.value),d!=null&&d.value&&(i.originatingSystem=d?.value),h!=null&&h.value&&(i.authorization=h?.value),i}getDescriptionInfo(e){var t;let i={},{arguments:n}=e.GetHeaderLine(0,fE)||{};if(!n)return i;let[r,o]=n;if((t=r[0])!=null&&t.value){let a=r[0].value.match(/\[([^\]]+)\]/);a&&a[1]&&(i.viewDefinition=a[1])}return o!=null&&o.value&&(i.implementationLevel=o.value),i}},Up=class{static get(e,t){let i=[pl,Nu,Bu,ah,As,rE,aE,oE,sE],n=e.data;for(let r of i){let o=t.GetLineIDsWithType(0,r),a=o.size();for(let l=0;l<a;l++){let c=o.get(l);n.has(c)||n.set(c,[[],[0,r]])}}}},mC=class Y0 extends At{constructor(e){super(e),q(this,"onDisposed",new Oe),q(this,"onIfcStartedLoading",new Oe),q(this,"onSetup",new Oe),q(this,"settings",new Fh),q(this,"webIfc",new oa),q(this,"enabled",!0),q(this,"_material",new io),q(this,"_spatialTree",new Fp),q(this,"_metaData",new Np),q(this,"_fragmentInstances",new Map),q(this,"_civil",new kp),q(this,"_visitedFragments",new Map),q(this,"_materialT",new io({transparent:!0,opacity:.5})),this.components.add(Y0.uuid,this),this.settings.excludedCategories.add(oh)}dispose(){this.webIfc=null,this.onDisposed.trigger(Y0.uuid),this.onDisposed.reset()}setup(e){return ie(this,null,function*(){this.settings=Se(Se({},this.settings),e),this.settings.autoSetWasm&&(yield this.autoSetWasm()),this.onSetup.trigger()})}load(e,t=!0){return ie(this,null,function*(){let i=performance.now();this.onIfcStartedLoading.trigger(),yield this.readIfcFile(e);let n=yield this.getAllGeometries(),r=yield this.components.get($D).export(this.webIfc,0);n.setLocalProperties(r);let o=this.components.get(Rt);o.groups.set(n.uuid,n);for(let a of n.items)o.list.set(a.id,a),a.mesh.uuid=a.id,a.group=n;o.onFragmentsLoaded.trigger(n),t&&o.coordinate([n]);for(let[a]of n.data){let l=r[a];if(!l||!l.GlobalId)continue;let c=l.GlobalId.value||l.GlobalId;n.globalToExpressIDs.set(c,a)}return Up.get(n,this.webIfc),this.cleanUp(),console.log(`Streaming the IFC took ${performance.now()-i} ms!`),n})}readIfcFile(e){return ie(this,null,function*(){let{path:t,absolute:i,logLevel:n}=this.settings.wasm;return this.webIfc.SetWasmPath(t,i),yield this.webIfc.Init(this.settings.customLocateFileHandler||void 0),n&&this.webIfc.SetLogLevel(n),this.webIfc.OpenModel(e,this.settings.webIfc)})}cleanUp(){try{this.webIfc.Dispose()}catch{console.log("Web-ifc wasn't disposed.")}this.webIfc=null,this.webIfc=new oa,this._visitedFragments.clear(),this._fragmentInstances.clear()}getAllGeometries(){return ie(this,null,function*(){this._spatialTree.setUp(this.webIfc);let e=this.webIfc.GetIfcEntityList(0),t=new bg;t.ifcMetadata=yt(Se(Se({name:"",description:""},this._metaData.getNameInfo(this.webIfc)),this._metaData.getDescriptionInfo(this.webIfc)),{schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)});let i=[];for(let r of e){if(!this.webIfc.IsIfcElement(r)&&r!==As)continue;let o=this.settings.includedCategories;if(o.size>0&&!o.has(r)||this.settings.excludedCategories.has(r))continue;let a=this.webIfc.GetLineIDsWithType(0,r),l=a.size();for(let c=0;c<l;c++){let d=a.get(c);i.push(d);let h=this._spatialTree.itemsByFloor[d]||0;t.data.set(d,[[],[h,r]])}}this._spatialTree.cleanUp(),this.webIfc.StreamMeshes(0,i,r=>{this.getMesh(r,t)});for(let r of this._visitedFragments){let{index:o,fragment:a}=r[1];t.keyFragments.set(o,a.id)}for(let r of t.items){let o=this._fragmentInstances.get(r.id);if(!o)throw new Error("Fragment not found!");let a=[];for(let[l,c]of o)a.push(c);r.add(a)}let n=this.webIfc.GetCoordinationMatrix(0);return t.coordinationMatrix.fromArray(n),t.civilData=this._civil.read(this.webIfc),t})}getMesh(e,t){let i=e.geometries.size(),n=e.expressID;for(let r=0;r<i;r++){let o=e.geometries.get(r),{x:a,y:l,z:c,w:d}=o.color,h=d!==1,{geometryExpressID:u}=o,p=`${u}-${h}`;if(!this._visitedFragments.has(p)){let y=this.getGeometry(this.webIfc,u),w=h?this._materialT:this._material,C=new sa(y,w,1);t.add(C.mesh),t.items.push(C);let A=this._visitedFragments.size;this._visitedFragments.set(p,{index:A,fragment:C})}let f=new zt().setRGB(a,l,c,"srgb"),m=new lt;m.fromArray(o.flatTransformation);let g=this._visitedFragments.get(p);if(g===void 0)throw new Error("Error getting geometry data for streaming!");let b=t.data.get(n);if(!b)throw new Error("Data not found!");b[0].push(g.index);let{fragment:v}=g;this._fragmentInstances.has(v.id)||this._fragmentInstances.set(v.id,new Map);let E=this._fragmentInstances.get(v.id);if(!E)throw new Error("Instances not found!");if(E.has(n)){let y=E.get(n);if(!y)throw new Error("Instance not found!");y.transforms.push(m),y.colors&&y.colors.push(f)}else E.set(n,{id:n,transforms:[m],colors:[f]})}}getGeometry(e,t){let i=e.GetGeometry(0,t),n=e.GetIndexArray(i.GetIndexData(),i.GetIndexDataSize()),r=e.GetVertexArray(i.GetVertexData(),i.GetVertexDataSize()),o=new Float32Array(r.length/2),a=new Float32Array(r.length/2);for(let h=0;h<r.length;h+=6)o[h/2]=r[h],o[h/2+1]=r[h+1],o[h/2+2]=r[h+2],a[h/2]=r[h+3],a[h/2+1]=r[h+4],a[h/2+2]=r[h+5];let l=new kt,c=new Ti(o,3),d=new Ti(a,3);return l.setAttribute("position",c),l.setAttribute("normal",d),l.setIndex(Array.from(n)),i.delete(),l}autoSetWasm(){return ie(this,null,function*(){let e=yield fetch(`https://unpkg.com/@thatopen/components@${bR.release}/package.json`);if(!e.ok){console.warn("Couldn't get openbim-components package.json. Set wasm settings manually.");return}let t=yield e.json();if(!("web-ifc"in t.peerDependencies))console.warn("Couldn't get web-ifc from peer dependencies in openbim-components. Set wasm settings manually.");else{let i=t.peerDependencies["web-ifc"];this.settings.wasm.path=`https://unpkg.com/web-ifc@${i}/`,this.settings.wasm.absolute=!0}})}};q(mC,"uuid","a659add7-1418-4771-a0d6-7d4d438e4624");var ZD=mC,QD=class Rl extends At{constructor(e){super(e),q(this,"onDisposed",new Oe),q(this,"onRequestFile",new Oe),q(this,"ifcToExport",null),q(this,"onElementToPset",new Oe),q(this,"onPropToPset",new Oe),q(this,"onPsetRemoved",new Oe),q(this,"onDataChanged",new Oe),q(this,"wasm",{path:"/",absolute:!1}),q(this,"enabled",!0),q(this,"attributeListeners",{}),q(this,"selectedModel"),q(this,"changeMap",{}),this.components.add(Rl.uuid,this)}dispose(){this.selectedModel=void 0,this.attributeListeners={},this.changeMap={},this.onElementToPset.reset(),this.onPropToPset.reset(),this.onPsetRemoved.reset(),this.onDataChanged.reset(),this.onDisposed.trigger(Rl.uuid),this.onDisposed.reset()}static getIFCSchema(e){let t=e.ifcMetadata.schema;if(!t)throw new Error("IFC Schema not found");return t.startsWith("IFC2X3")?"IFC2X3":t.startsWith("IFC4")&&t.replace("IFC4","")===""?"IFC4":t.startsWith("IFC4X3")?"IFC4X3":t}setData(e,...t){return ie(this,null,function*(){for(let i of t){let{expressID:n}=i;(!n||n===-1)&&(i.expressID=this.getNewExpressID(e)),yield e.setProperties(i.expressID,i),this.registerChange(e,n)}})}newPset(e,t,i){return ie(this,null,function*(){let n=Rl.getIFCSchema(e),{ownerHistoryHandle:r}=yield this.getOwnerHistory(e),o=this.newGUID(e),a=new Is[n].IfcLabel(t),l=i?new Is[n].IfcText(i):null,c=new Is[n].IfcPropertySet(o,r,a,l,[]);c.expressID=this.getNewExpressID(e);let d=this.newGUID(e),h=new Is[n].IfcRelDefinesByProperties(d,r,null,null,[],new fl(c.expressID));return h.expressID=this.getNewExpressID(e),yield this.setData(e,c,h),{pset:c,rel:h}})}removePset(e,...t){return ie(this,null,function*(){for(let i of t){let n=yield e.getProperties(i);if(n?.type!==ra)continue;let r=yield uo.getPsetRel(e,i);if(r&&(yield e.setProperties(r,null),this.registerChange(e,r)),n){for(let o of n.HasProperties)yield e.setProperties(o.value,null);yield e.setProperties(i,null),this.onPsetRemoved.trigger({model:e,psetID:i}),this.registerChange(e,i)}}})}newSingleStringProperty(e,t,i,n){return this.newSingleProperty(e,t,i,n)}newSingleNumericProperty(e,t,i,n){return this.newSingleProperty(e,t,i,n)}newSingleBooleanProperty(e,t,i,n){return this.newSingleProperty(e,t,i,n)}removePsetProp(e,t,i){return ie(this,null,function*(){let n=yield e.getProperties(t),r=yield e.getProperties(i);!n||!r||n.type===ra&&r&&(n.HasProperties=n.HasProperties.filter(o=>o.value!==i),yield e.setProperties(i,null),this.registerChange(e,t,i))})}addElementToPset(e,t,...i){return ie(this,null,function*(){let n=yield uo.getPsetRel(e,t);if(!n)return;let r=yield e.getProperties(n);if(!r)return;for(let a of i){let l=new fl(a);r.RelatedObjects.push(l),this.onElementToPset.trigger({model:e,psetID:t,elementID:a})}this.registerChange(e,t);let o=this.components.get(jh);for(let a of i)try{o.addEntityRelations(e,a,"IsDefinedBy",t)}catch{}})}addPropToPset(e,t,...i){return ie(this,null,function*(){let n=yield e.getProperties(t);if(n){for(let r of i){if(n.HasProperties.includes(r))continue;let o=new fl(r);n.HasProperties.push(o),this.onPropToPset.trigger({model:e,psetID:t,propID:r})}this.registerChange(e,t)}})}saveToIfc(e,t){return ie(this,null,function*(){let i=this.components.get(ZD),n=i.webIfc,r=yield i.readIfcFile(t),o=this.changeMap[e.uuid]??[];for(let l of o){let c=yield e.getProperties(l);if(c)try{n.WriteLine(r,c)}catch{}else try{n.DeleteLine(r,l)}catch{}}let a=n.SaveModel(r);return i.webIfc.CloseModel(r),i.cleanUp(),a})}getEntityRef(e,t){return ie(this,null,function*(){let i=yield e.getAllPropertiesOfType(t);if(!i)return null;let n=[];for(let r in i){let o=new fl(Number(r));n.push(o)}return n})}setAttributeListener(e,t,i){return ie(this,null,function*(){this.attributeListeners[e.uuid]||(this.attributeListeners[e.uuid]={});let n=this.attributeListeners[e.uuid][t]?this.attributeListeners[e.uuid][t][i]:null;if(n)return n;let r=yield e.getProperties(t);if(!r)throw new Error(`Entity with expressID ${t} doesn't exists.`);let o=r[i];if(Array.isArray(o)||!o)throw new Error(`Attribute ${i} is array or null, and it can't have a listener.`);let a=o.value;if(a===void 0||a==null)throw new Error(`Attribute ${i} has a badly defined handle.`);let l=new Oe;return Object.defineProperty(r[i],"value",{get(){return this._value},set(d){return ie(this,null,function*(){this._value=d,l.trigger(d)})}}),r[i].value=a,this.attributeListeners[e.uuid][t]||(this.attributeListeners[e.uuid][t]={}),this.attributeListeners[e.uuid][t][i]=l,l})}getNewExpressID(e){return e.ifcMetadata.maxExpressID++,e.ifcMetadata.maxExpressID}newGUID(e){let t=Rl.getIFCSchema(e);return new Is[t].IfcGloballyUniqueId(jl.create())}getOwnerHistory(e){return ie(this,null,function*(){let t=yield e.getAllPropertiesOfType(dE);if(!t)throw new Error("No OwnerHistory was found.");let i=Object.keys(t).map(o=>parseInt(o,10)),n=t[i[0]],r=new fl(n.expressID);return{ownerHistory:n,ownerHistoryHandle:r}})}registerChange(e,...t){this.changeMap[e.uuid]||(this.changeMap[e.uuid]=new Set);for(let i of t)this.changeMap[e.uuid].add(i),this.onDataChanged.trigger({model:e,expressID:i})}newSingleProperty(e,t,i,n){return ie(this,null,function*(){let r=Rl.getIFCSchema(e),o=new Is[r].IfcIdentifier(i),a=new Is[r][t](n),l=new Is[r].IfcPropertySingleValue(o,null,a,null);return l.expressID=this.getNewExpressID(e),yield this.setData(e,l),l})}};q(QD,"uuid","58c2d9f0-183c-48d6-a402-dfcf5b9a34df");var gC=class bC extends At{constructor(e){super(e),q(this,"enabled",!0),q(this,"list",{}),q(this,"onDisposed",new Oe),q(this,"onFragmentsDisposed",t=>{let{groupID:i,fragmentIDs:n}=t;for(let r in this.list){let o=this.list[r],a=Object.keys(o);if(a.includes(i))delete o[i],Object.values(o).length===0&&delete this.list[r];else for(let l of a){let c=o[l];for(let d of n)delete c.map[d];Object.values(c).length===0&&delete o[l]}}}),e.add(bC.uuid,this),e.get(Rt).onFragmentsDisposed.add(this.onFragmentsDisposed)}dispose(){this.list={},this.components.get(Rt).onFragmentsDisposed.remove(this.onFragmentsDisposed),this.onDisposed.trigger(),this.onDisposed.reset()}remove(e){for(let t in this.list){let i=this.list[t];for(let n in i){let r=i[n];delete r.map[e]}}}find(e){let t=this.components.get(Rt);if(!e){let o={};for(let[a,l]of t.list)o[a]=new Set(l.ids);return o}let i=Object.keys(e).length,n={};for(let o in e){let a=e[o];if(!this.list[o]){console.warn(`Classification ${o} does not exist.`);continue}for(let l of a){let c=this.list[o][l];if(c)for(let d in c.map){n[d]||(n[d]=new Map);for(let h of c.map[d]){let u=n[d].get(h);u===void 0?n[d].set(h,1):n[d].set(h,u+1)}}}}let r={};for(let o in n){let a=n[o];for(let[l,c]of a){if(c===void 0)throw new Error("Malformed fragments map!");c===i&&(r[o]||(r[o]=new Set),r[o].add(l))}}return r}byModel(e,t){this.list.models||(this.list.models={});let i=this.list.models;i[e]||(i[e]={map:{},id:null,name:e});let n=i[e];for(let[r,o]of t.data){let a=o[0];for(let l of a){let c=t.keyFragments.get(l);c&&(n.map[c]||(n.map[c]=new Set),n.map[c].add(r))}}}byPredefinedType(e){return ie(this,null,function*(){var t;this.list.predefinedTypes||(this.list.predefinedTypes={});let i=this.list.predefinedTypes,n=e.getAllPropertiesIDs();for(let r of n){let o=yield e.getProperties(r);if(!o)continue;let a=String((t=o.PredefinedType)==null?void 0:t.value).toUpperCase();i[a]||(i[a]={map:{},id:null,name:a});let l=i[a];for(let[c,d]of e.data){let h=d[0];for(let u of h){let p=e.keyFragments.get(u);if(!p)throw new Error("Fragment ID not found!");l.map[p]||(l.map[p]=new Set),l.map[p].add(o.expressID)}}}})}byEntity(e){this.list.entities||(this.list.entities={});for(let[t,i]of e.data){let n=i[1][1],r=fC[n];this.saveItem(e,"entities",r,t)}}byIfcRel(e,t,i){return ie(this,null,function*(){uo.isRel(t)&&(yield uo.getRelationMap(e,t,(n,r)=>ie(this,null,function*(){let{name:o}=yield uo.getEntityName(e,n);for(let a of r)this.saveItem(e,i,o??"NO REL NAME",a)})))})}bySpatialStructure(i){return ie(this,arguments,function*(e,t={}){var n,r;let o=this.components.get(jh),a=o.relationMaps[e.uuid];if(!a)throw new Error(`Classifier: model relations of ${e.name||e.uuid} have to exists to group by spatial structure.`);let l="spatialStructures",c=t.useProperties===void 0||t.useProperties;for(let[d]of a){if(t.isolate){let f=e.data.get(d);if(!f)continue;let m=f[1][1];if(m===void 0||!t.isolate.has(m))continue}let h=o.getEntityRelations(e,d,"Decomposes");if(h)for(let f of h){let m=f.toString();if(c){let g=yield e.getProperties(f);if(!g)continue;m=(n=g.Name)==null?void 0:n.value}this.saveItem(e,l,m,d,f)}let u=o.getEntityRelations(e,d,"ContainsElements");if(!u)continue;let p=d.toString();if(c){let f=yield e.getProperties(d);if(!f)continue;p=(r=f.Name)==null?void 0:r.value}for(let f of u){this.saveItem(e,l,p,f,d);let m=o.getEntityRelations(e,Number(f),"IsDecomposedBy");if(m)for(let g of m)this.saveItem(e,l,p,g,d)}}})}setColor(e,t,i=!1){let n=this.components.get(Rt);for(let r in e){let o=n.list.get(r);if(!o)continue;let a=e[r];o.setColor(t,a,i)}}resetColor(e){let t=this.components.get(Rt);for(let i in e){let n=t.list.get(i);if(!n)continue;let r=e[i];n.resetColor(r)}}saveItem(e,t,i,n,r=null){this.list[t]||(this.list[t]={});let o=e.data.get(n);if(o)for(let a of o[0]){let l=e.keyFragments.get(a);if(l){let c=this.list[t];c[i]||(c[i]={map:{},id:r,name:i}),c[i].map[l]||(c[i].map[l]=new Set),c[i].map[l].add(n)}}}};q(gC,"uuid","e25a7f3c-46c4-4a14-9d3d-5115f24ebeb7");var q0=gC,JD=class vC extends At{constructor(e){super(e),q(this,"onDisposed",new Oe),q(this,"enabled",!0),q(this,"height",10),q(this,"groupName","spatialStructures"),q(this,"list",new Set),e.add(vC.uuid,this)}dispose(){this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}set(e){if(!this.enabled)return;let t=this.components.get(q0),i=this.components.get(Rt),n=e?1:-1,r=0,o=t.list[this.groupName],a=new lt;for(let l in o){a.elements[13]=r*n*this.height;for(let c in o[l].map){let d=i.list.get(c),h=l+c,u=this.list.has(h);if(!d||e&&u||!e&&!u)continue;e?this.list.add(h):this.list.delete(h);let p=o[l].map[c];d.applyTransform(p,a),d.mesh.computeBoundingSphere(),d.mesh.computeBoundingBox()}r++}}};q(JD,"uuid","d260618b-ce88-4c7d-826c-6debb91de3e2");var yC=class _C extends At{constructor(e){super(e),q(this,"enabled",!0),this.components.add(_C.uuid,this)}set(e,t){let i=this.components.get(Rt);if(!t){for(let[n,r]of i.list)r&&(r.setVisibility(e),this.updateCulledVisibility(r));return}for(let n in t){let r=t[n],o=i.list.get(n);o&&(o.setVisibility(e,r),this.updateCulledVisibility(o))}}isolate(e){this.set(!1),this.set(!0,e)}updateCulledVisibility(e){let t=this.components.get(SR);for(let[i,n]of t.list){let r=n.colorMeshes.get(e.id);r&&(r.count=e.mesh.count)}}};q(yC,"uuid","dd9ccf2d-8a21-4821-b7f6-2949add16a29");var eL=yC,X0=class extends Fh{constructor(){super(...arguments),q(this,"minGeometrySize",10),q(this,"minAssetsSize",1e3)}},tL=class wC extends At{constructor(e){super(e),q(this,"onGeometryStreamed",new Oe),q(this,"onAssetStreamed",new Oe),q(this,"onProgress",new Oe),q(this,"onIfcLoaded",new Oe),q(this,"onDisposed",new Oe),q(this,"settings",new X0),q(this,"enabled",!0),q(this,"webIfc",new oa),q(this,"_spatialTree",new Fp),q(this,"_metaData",new Np),q(this,"_visitedGeometries",new Map),q(this,"_streamSerializer",new vg),q(this,"_geometries",new Map),q(this,"_geometryCount",0),q(this,"_civil",new kp),q(this,"_groupSerializer",new ku),q(this,"_assets",[]),q(this,"_meshesWithHoles",new Set),this.components.add(wC.uuid,this),this.settings.excludedCategories.add(oh)}dispose(){this.onIfcLoaded.reset(),this.onGeometryStreamed.reset(),this.onAssetStreamed.reset(),this.webIfc=null,this.onDisposed.trigger(),this.onDisposed.reset()}streamFromBuffer(e){return ie(this,null,function*(){yield this.readIfcFile(e),yield this.streamAllGeometries(),this.cleanUp()})}streamFromCallBack(e){return ie(this,null,function*(){yield this.streamIfcFile(e),yield this.streamAllGeometries(),this.cleanUp()})}readIfcFile(e){return ie(this,null,function*(){let{path:t,absolute:i,logLevel:n}=this.settings.wasm;this.webIfc.SetWasmPath(t,i),yield this.webIfc.Init(),n&&this.webIfc.SetLogLevel(n),this.webIfc.OpenModel(e,this.settings.webIfc)})}streamIfcFile(e){return ie(this,null,function*(){let{path:t,absolute:i,logLevel:n}=this.settings.wasm;this.webIfc.SetWasmPath(t,i),yield this.webIfc.Init(),n&&this.webIfc.SetLogLevel(n),this.webIfc.OpenModelFromCallback(e,this.settings.webIfc)})}streamAllGeometries(){return ie(this,null,function*(){let{minGeometrySize:e,minAssetsSize:t}=this.settings;this._spatialTree.setUp(this.webIfc);let i=this.webIfc.GetIfcEntityList(0),n=[[]],r=new bg;r.ifcMetadata=yt(Se(Se({name:"",description:""},this._metaData.getNameInfo(this.webIfc)),this._metaData.getDescriptionInfo(this.webIfc)),{schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)});let o=0,a=0;for(let f of i){if(!this.webIfc.IsIfcElement(f)&&f!==As||this.settings.excludedCategories.has(f))continue;let m=this.webIfc.GetLineIDsWithType(0,f),g=m.size();for(let b=0;b<g;b++){o>e&&(o=0,a++,n.push([]));let v=m.get(b);n[a].push(v);let E=this.webIfc.GetLine(0,v);if(E.GlobalId){let w=E?.GlobalId.value||E?.GlobalId;r.globalToExpressIDs.set(w,v)}let y=this._spatialTree.itemsByFloor[v]||0;r.data.set(v,[[],[y,f]]),o++}}this._spatialTree.cleanUp();let l=.01,c=0;for(let f of n){c++,this.webIfc.StreamMeshes(0,f,g=>{this.getMesh(this.webIfc,g,r)}),this._geometryCount>e&&(yield this.streamGeometries()),this._assets.length>t&&(yield this.streamAssets());let m=c/n.length;m>l&&(l+=.01,l=Math.max(l,m),this.onProgress.trigger(Math.round(l*100)/100))}this._geometryCount&&(yield this.streamGeometries()),this._assets.length&&(yield this.streamAssets());let{opaque:d,transparent:h}=r.geometryIDs;for(let[f,{index:m,uuid:g}]of this._visitedGeometries)r.keyFragments.set(m,g),(f>1?d:h).set(f,m);Up.get(r,this.webIfc);let u=this.webIfc.GetCoordinationMatrix(0);r.coordinationMatrix.fromArray(u),r.civilData=this._civil.read(this.webIfc);let p=this._groupSerializer.export(r);this.onIfcLoaded.trigger(p),r.dispose(!0)})}cleanUp(){try{this.webIfc.Dispose()}catch{}this.webIfc=null,this.webIfc=new oa,this._visitedGeometries.clear(),this._geometries.clear(),this._assets=[],this._meshesWithHoles.clear()}getMesh(e,t,i){let n=t.geometries.size(),r=t.expressID,o={id:r,geometries:[]};for(let a=0;a<n;a++){let l=t.geometries.get(a),c=l.geometryExpressID,d=l.color.w===1?1:-1,h=c*d;if(!this._visitedGeometries.has(h)){this._visitedGeometries.has(c)||this.getGeometry(e,c);let y=this._visitedGeometries.size,w=_r.generateUUID();this._visitedGeometries.set(h,{uuid:w,index:y})}let u=this._visitedGeometries.get(h);if(u===void 0)throw new Error("Error getting geometry data for streaming!");let p=i.data.get(r);if(!p)throw new Error("Data not found!");p[0].push(u.index);let{x:f,y:m,z:g,w:b}=l.color,v=[f,m,g,b],E=l.flatTransformation;o.geometries.push({color:v,geometryID:c,transformation:E})}this._assets.push(o)}getGeometry(e,t){let i=e.GetGeometry(0,t),n=e.GetIndexArray(i.GetIndexData(),i.GetIndexDataSize()),r=e.GetVertexArray(i.GetVertexData(),i.GetVertexDataSize()),o=new Float32Array(r.length/2),a=new Float32Array(r.length/2);for(let u=0;u<r.length;u+=6)o[u/2]=r[u],o[u/2+1]=r[u+1],o[u/2+2]=r[u+2],a[u/2]=r[u+3],a[u/2+1]=r[u+4],a[u/2+2]=r[u+5];let l=mR(o),c=new Float32Array(l.transformation.elements),d=[l.center.x,l.center.y,l.center.z],h=!1;for(let u=0;u<o.length-2;u+=3){let p=o[u],f=o[u+1],m=o[u+2],g=a[u],b=a[u+1],v=a[u+2];if(gR(d,[p,f,m],[g,b,v])){h=!0;break}}this._geometries.set(t,{position:o,normal:a,index:n,boundingBox:c,hasHoles:h}),i.delete(),this._geometryCount++}streamAssets(){return ie(this,null,function*(){yield this.onAssetStreamed.trigger(this._assets),this._assets=null,this._assets=[]})}streamGeometries(){return ie(this,null,function*(){let e=this._streamSerializer.export(this._geometries),t={};for(let[i,{boundingBox:n,hasHoles:r}]of this._geometries)t[i]={boundingBox:n,hasHoles:r};this.onGeometryStreamed.trigger({data:t,buffer:e}),t=null,e=null,this._geometries.clear(),this._geometryCount=0})}};q(tL,"uuid","d9999a00-e1f5-4d3f-8cfe-c56e08609764");var K0=class extends Fh{constructor(){super(...arguments),q(this,"propertiesSize",100)}},$0=class extends At{constructor(){super(...arguments),q(this,"onPropertiesStreamed",new ga),q(this,"onProgress",new ga),q(this,"onIndicesStreamed",new ga),q(this,"onDisposed",new Oe),q(this,"enabled",!0),q(this,"settings",new K0),q(this,"webIfc",new oa)}dispose(){return ie(this,null,function*(){this.onIndicesStreamed.reset(),this.onPropertiesStreamed.reset(),this.webIfc=null,this.onDisposed.reset()})}streamFromBuffer(e){return ie(this,null,function*(){yield this.readIfcFile(e),yield this.streamAllProperties(),this.cleanUp()})}streamFromCallBack(e){return ie(this,null,function*(){yield this.streamIfcFile(e),yield this.streamAllProperties(),this.cleanUp()})}readIfcFile(e){return ie(this,null,function*(){let{path:t,absolute:i,logLevel:n}=this.settings.wasm;this.webIfc.SetWasmPath(t,i),yield this.webIfc.Init(),n&&this.webIfc.SetLogLevel(n),this.webIfc.OpenModel(e,this.settings.webIfc)})}streamIfcFile(e){return ie(this,null,function*(){let{path:t,absolute:i,logLevel:n}=this.settings.wasm;this.webIfc.SetWasmPath(t,i),yield this.webIfc.Init(),n&&this.webIfc.SetLogLevel(n),this.webIfc.OpenModelFromCallback(e,this.settings.webIfc)})}streamAllProperties(){return ie(this,null,function*(){let{propertiesSize:e}=this.settings,t=new Set(this.webIfc.GetIfcEntityList(0)),i=new Set([pl,Nu,Bu,ah,As]);for(let a of i)t.add(a);let n=.01,r=0;for(let a of t){if(r++,dC.has(a))continue;let l=i.has(a),c=this.webIfc.GetLineIDsWithType(0,a),d=c.size(),h=0;for(let u=0;u<d-e;u+=e){let p={};for(let f=0;f<e;f++){h++;let m=c.get(u+f);try{let g=this.webIfc.GetLine(0,m,l);p[g.expressID]=g}catch{console.log(`Could not get property: ${m}`)}}yield this.onPropertiesStreamed.trigger({type:a,data:p})}if(h!==d){let u={};for(let p=h;p<d;p++){let f=c.get(p);try{let m=this.webIfc.GetLine(0,f,l);u[m.expressID]=m}catch{console.log(`Could not get property: ${f}`)}}yield this.onPropertiesStreamed.trigger({type:a,data:u})}r/t.size>n&&(n=Math.round(n*100)/100,yield this.onProgress.trigger(n),n+=.01)}yield this.onProgress.trigger(1);let o=yield this.components.get(jh).processFromWebIfc(this.webIfc,0);yield this.onIndicesStreamed.trigger(o)})}cleanUp(){this.webIfc.Dispose(),this.webIfc=null,this.webIfc=new oa}};q($0,"uuid","88d2c89c-ce32-47d7-8cb6-d51e4b311a0b");var Bp=class{constructor(e,t,i){q(this,"title"),q(this,"guid",jl.create()),q(this,"clippingPlanes",new ba),q(this,"camera",{aspectRatio:0,fov:0,direction:{x:0,y:0,z:80},position:{x:0,y:0,z:0}}),q(this,"exceptionComponents",new ba),q(this,"selectionComponents",new ba),q(this,"componentColors",new fo),q(this,"spacesVisible",!1),q(this,"spaceBoundariesVisible",!1),q(this,"openingsVisible",!1),q(this,"defaultVisibility",!0),q(this,"_components"),q(this,"world");let n=Se({setCamera:!0},i),{data:r,setCamera:o}=n;this._components=e,this.world=t,r&&(this.guid=r.guid??this.guid,this.set(r)),o&&this.updateCamera()}get _selectionModelIdMap(){let e=this._components.get(Rt),t={};for(let[i,n]of e.groups){i in t||(t[i]=new Set);for(let r of this.selectionComponents){let o=n.globalToExpressIDs.get(r);o&&t[i].add(o)}}return t}get _exceptionModelIdMap(){let e=this._components.get(Rt),t={};for(let[i,n]of e.groups){i in t||(t[i]=new Set);for(let r of this.exceptionComponents){let o=n.globalToExpressIDs.get(r);o&&t[i].add(o)}}return t}get selection(){return this._components.get(Rt).modelIdToFragmentIdMap(this._selectionModelIdMap)}get exception(){return this._components.get(Rt).modelIdToFragmentIdMap(this._exceptionModelIdMap)}get projection(){return"fov"in this.camera?"Perspective":"Orthographic"}get position(){let e=this._components.get(Rt),{position:t}=this.camera,{x:i,y:n,z:r}=t,o=new ce(i,n,r);return e.applyBaseCoordinateSystem(o,new lt),o}get direction(){let{direction:e}=this.camera,{x:t,y:i,z:n}=e;return new ce(t,i,n)}get _managerVersion(){return this._components.get(Cn).config.version}get topics(){return[...this._components.get(Cn).list.values()].filter(e=>e.viewpoints.has(this.guid))}addComponentsFromMap(e){return ie(this,null,function*(){var t;let i=this._components.get(Rt);for(let n in e){let r=i.list.get(n);if(!(r&&r.group))continue;let o=r.group,a=e[n];for(let l of a){let c=yield o.getProperties(l);if(!c)continue;let d=(t=c.GlobalId)==null?void 0:t.value;d&&this.selectionComponents.add(d)}}this._components.get(Sr).list.set(this.guid,this)})}set(e){let t=e,i=this;for(let n in e){if(n==="guid")continue;let r=t[n];n in this&&(i[n]=r)}return this._components.get(Sr).list.set(this.guid,this),this}go(e=!0){return ie(this,null,function*(){let{camera:t}=this.world;if(!t.hasCameraControls())throw new Error("Viewpoint: the world's camera need controls to set the viewpoint.");t instanceof B0&&t.projection.set(this.projection);let i=this.position,n=this.direction,r={x:i.x+n.x*80,y:i.y+n.y*80,z:i.z+n.z*80},o=this.selection;if(Object.keys(o).length===0){let l=this._components.get(rs).get(this.world).castRayFromVector(i,this.direction);l&&(r=l.point)}else{let l=this._components.get(Lp);l.reset(),l.addFragmentIdMap(o),r=l.getSphere().center,l.reset()}let a=this._components.get(eL);a.set(this.defaultVisibility),a.set(!this.defaultVisibility,this.exception),a.set(!0,o),yield t.controls.setLookAt(i.x,i.y,i.z,r.x,r.y,r.z,e)})}updateCamera(){let{camera:e,renderer:t}=this.world;if(!t)throw new Error("Viewpoint: the world needs to have a renderer!");if(!e.hasCameraControls())throw new Error("Viewpoint: world's camera need camera controls!");let i=new ce;e.controls.getPosition(i);let n=e.three,r=new ce(0,0,-1).applyEuler(n.rotation),{width:o,height:a}=t.getSize(),l=o/a;Number.isNaN(l)&&(l=1);let c=this._components.get(Rt);i.applyMatrix4(c.baseCoordinationMatrix.clone().invert());let d={aspectRatio:l,position:{x:i.x,y:i.y,z:i.z},direction:{x:r.x,y:r.y,z:r.z}};n instanceof eo?this.camera=yt(Se({},d),{fov:n.fov}):n instanceof Ys&&(this.camera=yt(Se({},d),{viewToWorldScale:n.top-n.bottom})),this._components.get(Sr).list.set(this.guid,this)}colorize(){let e=this._components.get(Sr),t=this._components.get(Rt),i=this._components.get(q0);for(let[n,r]of this.componentColors){let o=t.guidToFragmentIdMap(r),a=new zt(`#${n}`);i.setColor(o,a,e.config.overwriteColors)}}resetColors(){let e=this._components.get(Rt),t=this._components.get(q0);for(let[i,n]of this.componentColors){let r=e.guidToFragmentIdMap(n);t.resetColor(r)}}createComponentTags(e){return ie(this,null,function*(){var t,i;let n=this._components.get(Rt),r=this._components.get(Cn),o="";if(r.config.includeSelectionTag){let a=e==="selection"?this._selectionModelIdMap:this._exceptionModelIdMap;for(let l in a){let c=n.groups.get(l);if(!c)continue;let d=a[l];for(let h of d){let u=yield c.getProperties(h);if(!u)continue;let p=(t=u.GlobalId)==null?void 0:t.value;if(!p)continue;let f=(i=u.Tag)==null?void 0:i.value,m=null;f&&(m=`AuthoringToolId="${f}"`),o+=`
<Component IfcGuid="${p}" ${m??""} />`}}}else o=[...this.selectionComponents].map(a=>`<Component IfcGuid="${a}" />`).join(`
`);return o})}serialize(){return ie(this,arguments,function*(e=this._managerVersion){let t=this._components.get(Rt),i=this.position;i.applyMatrix4(t.baseCoordinationMatrix.clone().invert());let n=this.direction;n.normalize();let r=new lt().makeRotationX(Math.PI/2),o=n.clone().applyMatrix4(r);o.normalize();let a=`<CameraViewPoint>
      <X>${i.x}</X>
      <Y>${-i.z}</Y>
      <Z>${i.y}</Z>
    </CameraViewPoint>`,l=`<CameraDirection>
      <X>${n.x}</X>
      <Y>${-n.z}</Y>
      <Z>${n.y}</Z>
    </CameraDirection>`,c=`<CameraUpVector>
      <X>${o.x}</X>
      <Y>${-o.z}</Y>
      <Z>${o.y}</Z>
    </CameraUpVector>`,d=`<AspectRatio>${this.camera.aspectRatio}</AspectRatio>`,h="";"viewToWorld"in this.camera?h=`<OrthogonalCamera>
        ${a}
        ${l}
        ${c}
        ${d}
        <ViewToWorldScale>${this.camera.viewToWorld}</ViewToWorldScale>
      </OrthogonalCamera>`:"fov"in this.camera&&(h=`<PerspectiveCamera>
        ${a}
        ${l}
        ${c}
        ${d}
        <FieldOfView>${this.camera.fov}</FieldOfView>
      </PerspectiveCamera>`);let u=`<ViewSetupHints SpacesVisible="${this.spacesVisible??!1}" SpaceBoundariesVisible="${this.spaceBoundariesVisible??!1}" OpeningsVisible="${this.openingsVisible??!1}" />`,p=(yield this.createComponentTags("selection")).trim(),f=(yield this.createComponentTags("exception")).trim();return`<?xml version="1.0" encoding="UTF-8"?>
    <VisualizationInfo Guid="${this.guid}">
      <Components>
        ${e==="2.1"?u:""}
        ${p.length!==0?`<Selection>${p}</Selection>`:""}
        <Visibility DefaultVisibility="${this.defaultVisibility}">
          ${e==="3"?u:""}
          ${f.length!==0?`<Exceptions>${f}</Exceptions>`:""}
        </Visibility>
      </Components>
      ${h}
    </VisualizationInfo>`})}},EC=class CC extends At{constructor(e){super(e),q(this,"enabled",!0),q(this,"list",new fo),q(this,"isSetup",!1),q(this,"onSetup",new Oe),q(this,"config",{overwriteColors:!1}),q(this,"onDisposed",new Oe),e.add(CC.uuid,this)}create(e,t){let i=new Bp(this.components,e,{data:t});return t||this.list.set(i.guid,i),i}setup(){}dispose(){this.list.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}};q(EC,"uuid","ee867824-a796-408d-8aa0-4e5962a83c66");var Sr=EC,Z0=class{constructor(e){if(q(this,"onDisposed",new Oe),q(this,"onAfterUpdate",new Oe),q(this,"onBeforeUpdate",new Oe),q(this,"onResize",new Oe),q(this,"frontOffset",0),q(this,"overrideMaterial",new gg),q(this,"backgroundColor",new zt(395274)),q(this,"renderer"),q(this,"enabled",!0),q(this,"world"),q(this,"_lockRotation",!0),q(this,"_camera"),q(this,"_plane"),q(this,"_size",new Bt(320,160)),q(this,"_tempVector1",new ce),q(this,"_tempVector2",new ce),q(this,"_tempTarget",new ce),q(this,"down",new ce(0,-1,0)),q(this,"updatePlanes",()=>{if(!this.world.renderer)throw new Error("The given world must have a renderer!");let n=[],r=this.world.renderer.three;for(let o of r.clippingPlanes)n.push(o);n.push(this._plane),this.renderer.clippingPlanes=n}),this.world=e,!this.world.renderer)throw new Error("The given world must have a renderer!");this.renderer=new sh,this.renderer.setSize(this._size.x,this._size.y);let t=1,i=this._size.x/this._size.y;this._camera=new Ys(t*i/-2,t*i/2,t/2,t/-2),this.world.renderer.onClippingPlanesUpdated.add(this.updatePlanes),this._camera.position.set(0,200,0),this._camera.zoom=.1,this._camera.rotation.x=-Math.PI/2,this._plane=new Ws(this.down,200),this.updatePlanes()}get lockRotation(){return this._lockRotation}set lockRotation(e){this._lockRotation=e,e&&(this._camera.rotation.z=0)}get zoom(){return this._camera.zoom}set zoom(e){this._camera.zoom=e,this._camera.updateProjectionMatrix()}dispose(){this.enabled=!1,this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.onResize.reset(),this.overrideMaterial.dispose(),this.renderer.forceContextLoss(),this.renderer.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get(){return this._camera}update(){if(!this.enabled)return;this.onBeforeUpdate.trigger();let e=this.world.scene.three,t=this.world.camera;if(!t.hasCameraControls())throw new Error("The given world must use camera controls!");if(!(e instanceof to))throw new Error("The given world must have a THREE.Scene as a root!");let i=t.controls;if(i.getPosition(this._tempVector1),this._camera.position.x=this._tempVector1.x,this._camera.position.z=this._tempVector1.z,this.frontOffset!==0&&(i.getTarget(this._tempVector2),this._tempVector2.sub(this._tempVector1),this._tempVector2.normalize().multiplyScalar(this.frontOffset),this._camera.position.x+=this._tempVector2.x,this._camera.position.z+=this._tempVector2.z),!this._lockRotation){i.getTarget(this._tempTarget);let r=Math.atan2(this._tempTarget.x-this._tempVector1.x,this._tempTarget.z-this._tempVector1.z);this._camera.rotation.z=r+Math.PI}this._plane.set(this.down,this._tempVector1.y);let n=e.background;e.background=this.backgroundColor,this.renderer.render(e,this._camera),e.background=n,this.onAfterUpdate.trigger()}getSize(){return this._size}resize(e=this._size){this._size.copy(e),this.renderer.setSize(e.x,e.y);let t=e.x/e.y,i=1;this._camera.left=i*t/-2,this._camera.right=i*t/2,this._camera.top=i/2,this._camera.bottom=-i/2,this._camera.updateProjectionMatrix(),this.onResize.trigger(e)}},iL=class xC extends At{constructor(e){super(e),q(this,"onAfterUpdate",new Oe),q(this,"onBeforeUpdate",new Oe),q(this,"onDisposed",new Oe),q(this,"enabled",!0),q(this,"list",new Map),this.components.add(xC.uuid,this)}create(e){if(this.list.has(e.uuid))throw new Error("This world already has a minimap!");let t=new Z0(e);return this.list.set(e.uuid,t),t}delete(e){let t=this.list.get(e);t&&t.dispose(),this.list.delete(e)}dispose(){for(let[e,t]of this.list)t.dispose();this.list.clear(),this.onDisposed.trigger()}update(){for(let[e,t]of this.list)t.update()}};q(iL,"uuid","39ad6aad-84c8-4adf-a1e0-7f25313a9e7f");var SC=class AC extends At{constructor(e){super(e),q(this,"enabled",!0),e.add(AC.uuid,this)}static distanceFromPointToLine(e,t,i,n=!1){let r=new en,o=new ce;return r.set(t,i),r.closestPointToPoint(e,n,o),o.distanceTo(e)}getFace(e,t,i){if(!e.geometry.index)throw new Error("Geometry must be indexed!");let n=new Map,r=e.geometry.index.array,{plane:o}=this.getFaceData(t,i,e),a=[];for(let h=0;h<r.length/3;h++){let{plane:u,edges:p}=this.getFaceData(h,i,e);if(u.equals(o)){a.push({index:h,edges:p});for(let{id:f,points:m,distance:g}of p)n.set(f,{points:m,distance:g})}}let l=0,c=new Map,d=new Map;for(let{index:h,edges:u}of a){let p=new Map;for(let{id:y}of u)if(c.has(y)){let w=c.get(y);p.set(y,w)}let f=u.map(y=>y.id);if(!p.size){let y=l++;for(let{id:w}of u)c.set(w,y);d.set(y,{edges:new Set(f),indices:new Set([h])});continue}let m=null,g=new Set,b=new Set(f);for(let[y,w]of p){m===null?m=w:w!==m&&g.add(w),c.delete(y);let{edges:C}=d.get(w);C.delete(y),b.delete(y)}if(m===null)throw new Error("Error computing face!");let v=d.get(m),{indices:E}=v;E.add(h);for(let y of b){c.set(y,m);let{edges:w}=v;w.add(y)}for(let y of g){let w=d.get(y),{edges:C,indices:A}=w,D=d.get(m),{edges:M,indices:I}=D;for(let O of C)M.add(O),c.set(O,m);for(let O of A)I.add(O);d.delete(y)}}for(let[h,{indices:u,edges:p}]of d)if(u.has(t)){let f=[];for(let m of p){let g=n.get(m);f.push(g)}return{edges:f,indices:u}}return null}getVerticesAndNormal(e,t,i){if(!e.geometry.index)throw new Error("Geometry must be indexed!");let n=e.geometry.index.array,r=e.geometry.attributes.position.array,o=e.geometry.attributes.normal.array,a=n[t*3]*3,l=n[t*3+1]*3,c=n[t*3+2]*3,d=new ce(r[a],r[a+1],r[a+2]),h=new ce(r[l],r[l+1],r[l+2]),u=new ce(r[c],r[c+1],r[c+2]),p=new ce(o[a],o[a+1],o[a+2]),f=new ce(o[l],o[l+1],o[l+2]),m=new ce(o[c],o[c+1],o[c+2]),g=(p.x+f.x+m.x)/3,b=(p.y+f.y+m.y)/3,v=(p.z+f.z+m.z)/3,E=new ce(g,b,v);if(i!==void 0&&e instanceof Jn){let y=new lt;e.getMatrixAt(i,y);let w=new lt;w.extractRotation(y),E.applyMatrix4(w),d.applyMatrix4(y),h.applyMatrix4(y),u.applyMatrix4(y)}return{p1:d,p2:h,p3:u,faceNormal:E}}round(e){e.x=Math.trunc(e.x*1e3)/1e3,e.y=Math.trunc(e.y*1e3)/1e3,e.z=Math.trunc(e.z*1e3)/1e3}getVolumeFromFragments(e){let t=this.components.get(Rt),i=new lt,n=[];for(let o in e){let a=t.list.get(o);if(!a)continue;let l=e[o],c=0;for(let u of l){let p=a.getInstancesIDs(u);p&&(c+=p.size)}let d=new Jn(a.mesh.geometry,void 0,c),h=0;for(let u of l){let p=a.getInstancesIDs(u);if(p)for(let f of p)a.mesh.getMatrixAt(f,i),d.setMatrixAt(h++,i)}n.push(d)}let r=this.getVolumeFromMeshes(n);for(let o of n)o.geometry=null,o.material=[],o.dispose();return r}getVolumeFromMeshes(e){let t=0;for(let i of e)t+=this.getVolumeOfMesh(i);return t}getFaceData(e,t,i){let n=this.getVerticesAndNormal(i,e,t),{p1:r,p2:o,p3:a,faceNormal:l}=n;this.round(r),this.round(o),this.round(a),this.round(l);let c=[{id:`${r.x}|${r.y}|${r.z}`,value:r},{id:`${o.x}|${o.y}|${o.z}`,value:o},{id:`${a.x}|${a.y}|${a.z}`,value:a}];c.sort((v,E)=>v.id<E.id?-1:v.id>E.id?1:0);let[{id:d,value:h},{id:u,value:p},{id:f,value:m}]=c,g=[{id:`${d}|${u}`,distance:h.distanceTo(p),points:[h,p]},{id:`${u}|${f}`,distance:p.distanceTo(m),points:[p,m]},{id:`${d}|${f}`,distance:h.distanceTo(m),points:[h,m]}],b=new Ws;return b.setFromNormalAndCoplanarPoint(l,r),b.constant=Math.round(b.constant*10)/10,{plane:b,edges:g}}getVolumeOfMesh(e){let t=0,i=new ce,n=new ce,r=new ce,{index:o}=e.geometry,a=e.geometry.attributes.position.array;if(!o)return console.warn("Geometry must be indexed to compute its volume!"),0;let l=[];if(e instanceof Jn)for(let d=0;d<e.count;d++){let h=new lt;e.getMatrixAt(d,h),l.push(h)}else l.push(new lt().identity());let{matrixWorld:c}=e;for(let d=0;d<o.array.length-2;d+=3)for(let h of l){let u=h.multiply(c),p=o.array[d]*3,f=o.array[d+1]*3,m=o.array[d+2]*3;i.set(a[p],a[p+1],a[p+2]).applyMatrix4(u),n.set(a[f],a[f+1],a[f+2]).applyMatrix4(u),r.set(a[m],a[m+1],a[m+2]).applyMatrix4(u),t+=this.getSignedVolumeOfTriangle(i,n,r)}return Math.abs(t)}getSignedVolumeOfTriangle(e,t,i){let n=i.x*t.y*e.z,r=t.x*i.y*e.z,o=i.x*e.y*t.z,a=e.x*i.y*t.z,l=t.x*e.y*i.z,c=e.x*t.y*i.z;return 1/6*(-n+r+o-a-l+c)}};q(SC,"uuid","267ca032-672f-4cb0-afa9-d24e904f39d6");var va=SC,S1=new Qt,bp=new ce,zp=class extends Du{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";let e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],i=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(i),this.setAttribute("position",new Er(e,3)),this.setAttribute("uv",new Er(t,2))}applyMatrix4(e){let t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),i.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));let i=new na(t,6,1);return this.setAttribute("instanceStart",new Xs(i,3,0)),this.setAttribute("instanceEnd",new Xs(i,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));let i=new na(t,6,1);return this.setAttribute("instanceColorStart",new Xs(i,3,0)),this.setAttribute("instanceColorEnd",new Xs(i,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new Ru(e.geometry)),this}fromLineSegments(e){let t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Qt);let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),S1.setFromBufferAttribute(t),this.boundingBox.union(S1))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Qn),this.boundingBox===null&&this.computeBoundingBox();let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){let i=this.boundingSphere.center;this.boundingBox.getCenter(i);let n=0;for(let r=0,o=e.count;r<o;r++)bp.fromBufferAttribute(e,r),n=Math.max(n,i.distanceToSquared(bp)),bp.fromBufferAttribute(t,r),n=Math.max(n,i.distanceToSquared(bp));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}};ta.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Bt(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};ia.line={uniforms:cl.merge([ta.common,ta.fog,ta.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};var _a=class extends Ni{constructor(e){super({type:"LineMaterial",uniforms:cl.clone(ia.line.uniforms),vertexShader:ia.line.vertexShader,fragmentShader:ia.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1))}},A1=new ce,I1=new ce,tn=new Hs,nn=new Hs,Js=new Hs,i0=new ce,n0=new lt,sn=new en,T1=new ce,vp=new Qt,yp=new Qn,er=new Hs,ir,ya;function P1(s,e,t){return er.set(0,0,-e,1).applyMatrix4(s.projectionMatrix),er.multiplyScalar(1/er.w),er.x=ya/t.width,er.y=ya/t.height,er.applyMatrix4(s.projectionMatrixInverse),er.multiplyScalar(1/er.w),Math.abs(Math.max(er.x,er.y))}function nL(s,e){let t=s.matrixWorld,i=s.geometry,n=i.attributes.instanceStart,r=i.attributes.instanceEnd,o=Math.min(i.instanceCount,n.count);for(let a=0,l=o;a<l;a++){sn.start.fromBufferAttribute(n,a),sn.end.fromBufferAttribute(r,a),sn.applyMatrix4(t);let c=new ce,d=new ce;ir.distanceSqToSegment(sn.start,sn.end,d,c),d.distanceTo(c)<ya*.5&&e.push({point:d,pointOnLine:c,distance:ir.origin.distanceTo(d),object:s,face:null,faceIndex:a,uv:null,uv1:null})}}function sL(s,e,t){let i=e.projectionMatrix,n=s.material.resolution,r=s.matrixWorld,o=s.geometry,a=o.attributes.instanceStart,l=o.attributes.instanceEnd,c=Math.min(o.instanceCount,a.count),d=-e.near;ir.at(1,Js),Js.w=1,Js.applyMatrix4(e.matrixWorldInverse),Js.applyMatrix4(i),Js.multiplyScalar(1/Js.w),Js.x*=n.x/2,Js.y*=n.y/2,Js.z=0,i0.copy(Js),n0.multiplyMatrices(e.matrixWorldInverse,r);for(let h=0,u=c;h<u;h++){if(tn.fromBufferAttribute(a,h),nn.fromBufferAttribute(l,h),tn.w=1,nn.w=1,tn.applyMatrix4(n0),nn.applyMatrix4(n0),tn.z>d&&nn.z>d)continue;if(tn.z>d){let b=tn.z-nn.z,v=(tn.z-d)/b;tn.lerp(nn,v)}else if(nn.z>d){let b=nn.z-tn.z,v=(nn.z-d)/b;nn.lerp(tn,v)}tn.applyMatrix4(i),nn.applyMatrix4(i),tn.multiplyScalar(1/tn.w),nn.multiplyScalar(1/nn.w),tn.x*=n.x/2,tn.y*=n.y/2,nn.x*=n.x/2,nn.y*=n.y/2,sn.start.copy(tn),sn.start.z=0,sn.end.copy(nn),sn.end.z=0;let p=sn.closestPointToPointParameter(i0,!0);sn.at(p,T1);let f=_r.lerp(tn.z,nn.z,p),m=f>=-1&&f<=1,g=i0.distanceTo(T1)<ya*.5;if(m&&g){sn.start.fromBufferAttribute(a,h),sn.end.fromBufferAttribute(l,h),sn.start.applyMatrix4(r),sn.end.applyMatrix4(r);let b=new ce,v=new ce;ir.distanceSqToSegment(sn.start,sn.end,v,b),t.push({point:v,pointOnLine:b,distance:ir.origin.distanceTo(v),object:s,face:null,faceIndex:h,uv:null,uv1:null})}}}var Q0=class extends $e{constructor(e=new zp,t=new _a({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){let e=this.geometry,t=e.attributes.instanceStart,i=e.attributes.instanceEnd,n=new Float32Array(2*t.count);for(let o=0,a=0,l=t.count;o<l;o++,a+=2)A1.fromBufferAttribute(t,o),I1.fromBufferAttribute(i,o),n[a]=a===0?0:n[a-1],n[a+1]=n[a]+A1.distanceTo(I1);let r=new na(n,2,1);return e.setAttribute("instanceDistanceStart",new Xs(r,1,0)),e.setAttribute("instanceDistanceEnd",new Xs(r,1,1)),this}raycast(e,t){let i=this.material.worldUnits,n=e.camera;n===null&&!i&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');let r=e.params.Line2!==void 0&&e.params.Line2.threshold||0;ir=e.ray;let o=this.matrixWorld,a=this.geometry,l=this.material;ya=l.linewidth+r,a.boundingSphere===null&&a.computeBoundingSphere(),yp.copy(a.boundingSphere).applyMatrix4(o);let c;if(i)c=ya*.5;else{let h=Math.max(n.near,yp.distanceToPoint(ir.origin));c=P1(n,h,l.resolution)}if(yp.radius+=c,ir.intersectsSphere(yp)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),vp.copy(a.boundingBox).applyMatrix4(o);let d;if(i)d=ya*.5;else{let h=Math.max(n.near,vp.distanceToPoint(ir.origin));d=P1(n,h,l.resolution)}vp.expandByScalar(d),ir.intersectsBox(vp)!==!1&&(i?nL(this,t):sL(this,n,t))}},zl=class extends zp{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){let t=e.length-3,i=new Float32Array(2*t);for(let n=0;n<t;n+=3)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];return super.setPositions(i),this}setColors(e){let t=e.length-3,i=new Float32Array(2*t);for(let n=0;n<t;n+=3)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];return super.setColors(i),this}fromLine(e){let t=e.geometry;return this.setPositions(t.attributes.position.array),this}},Vp=class extends Q0{constructor(e=new zl,t=new _a({color:Math.random()*16777215})){super(e,t),this.isLine2=!0,this.type="Line2"}},IC=class TC{constructor(e,t){Z(this,"scene"),Z(this,"onSelect",new Oe),Z(this,"type"),Z(this,"selectCurve"),Z(this,"selectPoints"),Z(this,"hoverCurve"),Z(this,"hoverPoints"),Z(this,"caster",new no),this.scene=e,this.type=t,this.hoverCurve=this.newCurve(.003,4473924,!1),this.hoverPoints=this.newPoints(5,4473924),this.selectCurve=this.newCurve(.005,16777215,!0),this.selectPoints=this.newPoints(7,16777215)}dispose(){this.selectCurve&&this.scene.remove(this.selectCurve),this.selectCurve.material.dispose(),this.selectCurve.geometry.dispose(),this.selectCurve=null,this.hoverCurve.material.dispose(),this.hoverCurve.geometry.dispose(),this.hoverCurve=null,this.hoverPoints.material.dispose(),this.hoverPoints.geometry.dispose(),this.selectPoints.material.dispose(),this.selectPoints.geometry.dispose(),this.scene=null}castRay(e,t,i,n){let r=new Bt,o=i.getBoundingClientRect();r.x=(e.clientX-o.left)/o.width*2-1,r.y=-((e.clientY-o.top)/o.height)*2+1,this.caster.setFromCamera(r,t);let a=this.caster.intersectObjects(n);return a.length?a[0]:null}select(e){this.highlight(e,this.selectCurve,this.selectPoints,!0),this.onSelect.trigger(e)}unSelect(){this.selectCurve.removeFromParent(),this.selectPoints.removeFromParent()}hover(e){this.highlight(e,this.hoverCurve,this.hoverPoints,!1)}unHover(){this.hoverCurve.removeFromParent(),this.hoverPoints.removeFromParent()}setResolution({x:e,y:t}){this.selectCurve.material.resolution.set(e/t,1),this.hoverCurve.material.resolution.set(e/t,1)}highlight(e,t,i,n){let{alignment:r}=e.curve;this.scene.add(t),this.scene.add(i);let o=[],a=[],l=[];for(let u of r[this.type]){let p=u.mesh.geometry.attributes.position;for(let b of p.array)o.push(b);if(n){let b;if(this.type==="absolute"){let{horizontal:E}=u.alignment;b=E[u.index].data.TYPE}else b=u.data.TYPE;let v=TC.settings.colors[b]||[1,1,1];for(let E=0;E<p.count;E++)a.push(...v)}let[f,m,g]=p.array;l.push(new ce(f,m,g))}let c=o[o.length-3],d=o[o.length-2],h=o[o.length-1];l.push(new ce(c,d,h)),o.length/3>t.geometry.attributes.position.count&&(t.geometry.dispose(),t.geometry=new zl),t.geometry.setPositions(o),n&&t.geometry.setColors(a),i.geometry.setFromPoints(l)}newCurve(e,t,i){let n=new zl,r=new _a({color:t,linewidth:e,vertexColors:i,worldUnits:!1,depthTest:!1}),o=new Vp(n,r);return this.scene.add(o),o}newPoints(e,t){let i=new kt,n=new Ti(new Float32Array,3);i.setAttribute("position",n);let r=new qw({size:e,color:t,sizeAttenuation:!1,depthTest:!1}),o=new Xw(i,r);return o.frustumCulled=!1,this.scene.add(o),o}};Z(IC,"settings",{colors:{LINE:[213/255,0/255,255/255],CIRCULARARC:[0/255,46,255/255],CLOTHOID:[0/255,255/255,0/255],PARABOLICARC:[0/255,255/255,72/255],CONSTANTGRADIENT:[213/255,0/255,255/255]}});var PC=IC,J0=class extends Gs{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Bt(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}},Ml=new ce,O1=new lt,M1=new lt,R1=new ce,D1=new ce,eb=class{constructor(e={}){let t=this,i,n,r,o,a={objects:new WeakMap},l=e.element!==void 0?e.element:document.createElement("div");l.style.overflow="hidden",this.domElement=l,this.getSize=function(){return{width:i,height:n}},this.render=function(p,f){p.matrixWorldAutoUpdate===!0&&p.updateMatrixWorld(),f.parent===null&&f.matrixWorldAutoUpdate===!0&&f.updateMatrixWorld(),O1.copy(f.matrixWorldInverse),M1.multiplyMatrices(f.projectionMatrix,O1),c(p,p,f),u(p)},this.setSize=function(p,f){i=p,n=f,r=i/2,o=n/2,l.style.width=p+"px",l.style.height=f+"px"};function c(p,f,m){if(p.isCSS2DObject){Ml.setFromMatrixPosition(p.matrixWorld),Ml.applyMatrix4(M1);let g=p.visible===!0&&Ml.z>=-1&&Ml.z<=1&&p.layers.test(m.layers)===!0;if(p.element.style.display=g===!0?"":"none",g===!0){p.onBeforeRender(t,f,m);let v=p.element;v.style.transform="translate("+-100*p.center.x+"%,"+-100*p.center.y+"%)translate("+(Ml.x*r+r)+"px,"+(-Ml.y*o+o)+"px)",v.parentNode!==l&&l.appendChild(v),p.onAfterRender(t,f,m)}let b={distanceToCameraSquared:d(m,p)};a.objects.set(p,b)}for(let g=0,b=p.children.length;g<b;g++)c(p.children[g],f,m)}function d(p,f){return R1.setFromMatrixPosition(p.matrixWorld),D1.setFromMatrixPosition(f.matrixWorld),R1.distanceToSquared(D1)}function h(p){let f=[];return p.traverse(function(m){m.isCSS2DObject&&f.push(m)}),f}function u(p){let f=h(p).sort(function(g,b){if(g.renderOrder!==b.renderOrder)return b.renderOrder-g.renderOrder;let v=a.objects.get(g).distanceToCameraSquared,E=a.objects.get(b).distanceToCameraSquared;return v-E}),m=f.length;for(let g=0,b=f.length;g<b;g++)f[g].element.style.zIndex=m-g}}},vn=class{constructor(e,t,i){Z(this,"three"),Z(this,"world"),Z(this,"onDisposed",new Oe),this.world=e;let n;t?n=t:(n=document.createElement("div"),n.style.width="15px",n.style.height="15px",n.style.border="5px solid red"),this.three=new J0(n),(i||e.scene.three).add(this.three),this.visible=!0}set visible(e){this.three.visible=e}get visible(){return this.three.visible}toggleVisibility(){this.visible=!this.visible}dispose(){this.three.removeFromParent(),this.three.element.remove(),this.onDisposed.trigger(),this.onDisposed.reset()}},kh=class extends x0{constructor(e,t,i){super(e,t,i),Z(this,"three2D",new eb),this.onAfterUpdate.add(()=>{if(this.onBeforeUpdate.trigger(this),!this.enabled||!this.currentWorld)return;let n=this.currentWorld.scene.three,r=this.currentWorld.camera.three;n instanceof to&&this.three2D.render(n,r)}),this.onDisposed.add(()=>{this.three2D.domElement.remove()}),this.onResize.add(({x:n,y:r})=>{this.three2D.setSize(n,r)}),this.setupHtmlRenderer(),this.resize()}setupHtmlRenderer(){this.three2D.domElement.style.position="absolute",this.three2D.domElement.style.top="0px",this.three2D.domElement.style.pointerEvents="none",this.container&&this.container.appendChild(this.three2D.domElement)}},OC=class MC extends At{constructor(e){super(e),Z(this,"onDisposed",new Oe),Z(this,"enabled",!0),Z(this,"threshold",50),Z(this,"autoCluster",!0),Z(this,"list",new Map),Z(this,"clusterLabels",new Set),Z(this,"currentKeys",new Set),Z(this,"_color","white"),Z(this,"_markerKey",0),Z(this,"_clusterKey",0),Z(this,"_worldEvents",new Map),Z(this,"_setupWorlds",new Set),e.add(MC.uuid,this)}get color(){return this._color}set color(e){this._color=e;for(let[t,i]of this.list)for(let[n,r]of i)r.label.three.element.style.color=e}create(e,t,i,n=!1){this.setupEvents(e,!0);let r=this._markerKey.toString(),o=this.getWorldMarkerList(e);if(o.has(r))return;let a=document.createElement("span");a.innerHTML=t,a.style.color=this._color;let l=new vn(e,a);return l.three.position.copy(i),o.set(r,{key:r,label:l,merged:!1,static:n}),this._markerKey++,r}delete(e){for(let[t,i]of this.list){let n=i.get(e);n&&n.label.dispose(),i.delete(e)}}getWorldMarkerList(e){return this.list.has(e.uuid)||this.list.set(e.uuid,new Map),this.list.get(e.uuid)}dispose(e){for(let[t,i]of this.list){let n=[...i.keys()];for(let r of n){let o=i.get(r);e&&o.type!==e||(o.label.dispose(),i.delete(r))}}if(!e){this.list.clear(),this._markerKey=0;for(let t of this.clusterLabels)t.label.dispose();this.clusterLabels.clear(),this._clusterKey=0,this.currentKeys.clear()}this.onDisposed.trigger()}setupEvents(e,t){if(t&&this._setupWorlds.has(e.uuid)||!e.camera.hasCameraControls())return;let i=this.getWorldEvent(e);e.camera.controls.removeEventListener("sleep",i),e.camera.controls.removeEventListener("rest",i),t&&(e.camera.controls.addEventListener("sleep",i),e.camera.controls.addEventListener("rest",i))}cluster(e){if(!this.autoCluster)return;this.resetMarkers();let t=this.list.get(e.uuid);if(t){for(let[i,n]of t)if(!n.merged&&!n.static){this.currentKeys.clear();for(let[r,o]of t)o.static||n.key!==o.key&&!o.merged&&this.distance(n.label,o.label)<this.threshold&&(this.currentKeys.add(o.key),o.merged=!0);if(this.currentKeys.size>0){this.currentKeys.add(n.key),n.merged=!0;let r=Array.from(this.currentKeys),o=this.getAveragePositionFromLabels(r),a=new vn(n.label.world,this.createClusterElement(this._clusterKey.toString())),{element:l}=a.three;l.textContent=r.length.toString(),a.three.position.copy(o),this.clusterLabels.add({key:this._clusterKey.toString(),markerKeys:r,label:a}),this._clusterKey++}}this.removeMergeMarkers(e)}}getWorldEvent(e){if(!this._worldEvents.has(e.uuid)){let t=()=>{this.cluster(e)};this._worldEvents.set(e.uuid,t)}return this._worldEvents.get(e.uuid)}resetMarkers(){for(let[e,t]of this.list)for(let[i,n]of t)n.merged=!1;for(let e of this.clusterLabels)e.label.dispose();this.clusterLabels.clear(),this._clusterKey=0}removeMergeMarkers(e){let t=this.list.get(e.uuid);if(t){for(let[i,n]of t)n.merged?n.label.dispose():n.label.world.scene.three.add(n.label.three);for(let i of this.clusterLabels)if(i.markerKeys.length===1){for(let[n,r]of this.list){let o=r.get(i.markerKeys[0]);o&&(o.label.world.scene.three.add(o.label.three),o.merged=!1)}i.label.dispose(),this.clusterLabels.delete(i)}}}getAveragePositionFromLabels(e){let t=e.map(i=>{for(let[n,r]of this.list){let o=r.get(i);if(o)return o.label.three.position}return new ce});return t.reduce((i,n)=>i.add(n),new ce).divideScalar(t.length)}createClusterElement(e){let t=document.createElement("div");return t.textContent=e,t.style.color="#000000",t.style.background="#FFFFFF",t.style.fontSize="1.2rem",t.style.fontWeight="500",t.style.pointerEvents="auto",t.style.borderRadius="50%",t.style.padding="5px 11px",t.style.textAlign="center",t.style.cursor="pointer",t.addEventListener("pointerdown",()=>{this.navigateToCluster(e)}),t.addEventListener("pointerover",()=>{t.style.background="#BCF124"}),t.addEventListener("pointerout",()=>{t.style.background="#FFFFFF"}),t}getScreenPosition(e){let t=new ce;if(!e.world.renderer)throw new Error("Renderer not found!");let i=e.three.position.clone();i.project(e.world.camera.three);let n=e.world.renderer.getSize();return t.x=i.x*n.x/2+n.x/2,t.y=-(i.y*n.y/2)+n.y/2,t}distance(e,t){let i=this.getScreenPosition(e),n=this.getScreenPosition(t),r=i.x-n.x,o=i.y-n.y,a=Math.sqrt(r*r+o*o)*.5;return a===0?this.threshold+1:a}navigateToCluster(e){let t=[],i=Array.from(this.clusterLabels).find(c=>c.key===e);if(!i)return;let n=i.label.world.camera;if(!n.hasCameraControls()){console.warn("Zoom to clusters only supported with Camera Controls!");return}for(let c of i.markerKeys)for(let[d,h]of this.list){let u=h.get(c);if(u){let{x:p,y:f,z:m}=u.label.three.position;t.push(p,f,m)}}i.label.dispose(),this.clusterLabels.delete(i);let r=new kt,o=new Float32Array(t),a=new Ti(o,3);r.setAttribute("position",a);let l=new $e(r);l.geometry.computeBoundingSphere(),l.geometry.boundingSphere&&n.controls.fitToSphere(l,!0),r.dispose(),l.clear(),t.length=0}};Z(OC,"uuid","4079eb91-79b0-4ede-bcf2-15b837129236");var ua=OC,L1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function RC(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Rb={exports:{}};Rb.exports=Kp;Rb.exports.default=Kp;function Kp(s,e,t){t=t||2;var i=e&&e.length,n=i?e[0]*t:s.length,r=DC(s,0,n,t,!0),o=[];if(!r||r.next===r.prev)return o;var a,l,c,d,h,u,p;if(i&&(r=cL(s,e,r,t)),s.length>80*t){a=c=s[0],l=d=s[1];for(var f=t;f<n;f+=t)h=s[f],u=s[f+1],h<a&&(a=h),u<l&&(l=u),h>c&&(c=h),u>d&&(d=u);p=Math.max(c-a,d-l),p=p!==0?32767/p:0}return Nh(r,o,t,a,l,p,0),o}function DC(s,e,t,i,n){var r,o;if(n===nb(s,e,t,i)>0)for(r=e;r<t;r+=i)o=F1(r,s[r],s[r+1],o);else for(r=t-i;r>=e;r-=i)o=F1(r,s[r],s[r+1],o);return o&&$p(o,o.next)&&(Bh(o),o=o.next),o}function wa(s,e){if(!s)return s;e||(e=s);var t=s,i;do if(i=!1,!t.steiner&&($p(t,t.next)||Ei(t.prev,t,t.next)===0)){if(Bh(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function Nh(s,e,t,i,n,r,o){if(s){!o&&r&&fL(s,i,n,r);for(var a=s,l,c;s.prev!==s.next;){if(l=s.prev,c=s.next,r?oL(s,i,n,r):rL(s)){e.push(l.i/t|0),e.push(s.i/t|0),e.push(c.i/t|0),Bh(s),s=c.next,a=c.next;continue}if(s=c,s===a){o?o===1?(s=aL(wa(s),e,t),Nh(s,e,t,i,n,r,2)):o===2&&lL(s,e,t,i,n,r):Nh(wa(s),e,t,i,n,r,1);break}}}}function rL(s){var e=s.prev,t=s,i=s.next;if(Ei(e,t,i)>=0)return!1;for(var n=e.x,r=t.x,o=i.x,a=e.y,l=t.y,c=i.y,d=n<r?n<o?n:o:r<o?r:o,h=a<l?a<c?a:c:l<c?l:c,u=n>r?n>o?n:o:r>o?r:o,p=a>l?a>c?a:c:l>c?l:c,f=i.next;f!==e;){if(f.x>=d&&f.x<=u&&f.y>=h&&f.y<=p&&kl(n,a,r,l,o,c,f.x,f.y)&&Ei(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function oL(s,e,t,i){var n=s.prev,r=s,o=s.next;if(Ei(n,r,o)>=0)return!1;for(var a=n.x,l=r.x,c=o.x,d=n.y,h=r.y,u=o.y,p=a<l?a<c?a:c:l<c?l:c,f=d<h?d<u?d:u:h<u?h:u,m=a>l?a>c?a:c:l>c?l:c,g=d>h?d>u?d:u:h>u?h:u,b=tb(p,f,e,t,i),v=tb(m,g,e,t,i),E=s.prevZ,y=s.nextZ;E&&E.z>=b&&y&&y.z<=v;){if(E.x>=p&&E.x<=m&&E.y>=f&&E.y<=g&&E!==n&&E!==o&&kl(a,d,l,h,c,u,E.x,E.y)&&Ei(E.prev,E,E.next)>=0||(E=E.prevZ,y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==n&&y!==o&&kl(a,d,l,h,c,u,y.x,y.y)&&Ei(y.prev,y,y.next)>=0))return!1;y=y.nextZ}for(;E&&E.z>=b;){if(E.x>=p&&E.x<=m&&E.y>=f&&E.y<=g&&E!==n&&E!==o&&kl(a,d,l,h,c,u,E.x,E.y)&&Ei(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;y&&y.z<=v;){if(y.x>=p&&y.x<=m&&y.y>=f&&y.y<=g&&y!==n&&y!==o&&kl(a,d,l,h,c,u,y.x,y.y)&&Ei(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function aL(s,e,t){var i=s;do{var n=i.prev,r=i.next.next;!$p(n,r)&&LC(n,i,i.next,r)&&Uh(n,r)&&Uh(r,n)&&(e.push(n.i/t|0),e.push(i.i/t|0),e.push(r.i/t|0),Bh(i),Bh(i.next),i=s=r),i=i.next}while(i!==s);return wa(i)}function lL(s,e,t,i,n,r){var o=s;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&bL(o,a)){var l=FC(o,a);o=wa(o,o.next),l=wa(l,l.next),Nh(o,e,t,i,n,r,0),Nh(l,e,t,i,n,r,0);return}a=a.next}o=o.next}while(o!==s)}function cL(s,e,t,i){var n=[],r,o,a,l,c;for(r=0,o=e.length;r<o;r++)a=e[r]*i,l=r<o-1?e[r+1]*i:s.length,c=DC(s,a,l,i,!1),c===c.next&&(c.steiner=!0),n.push(gL(c));for(n.sort(hL),r=0;r<n.length;r++)t=dL(n[r],t);return t}function hL(s,e){return s.x-e.x}function dL(s,e){var t=uL(s,e);if(!t)return e;var i=FC(t,s);return wa(i,i.next),wa(t,t.next)}function uL(s,e){var t=e,i=s.x,n=s.y,r=-1/0,o;do{if(n<=t.y&&n>=t.next.y&&t.next.y!==t.y){var a=t.x+(n-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(a<=i&&a>r&&(r=a,o=t.x<t.next.x?t:t.next,a===i))return o}t=t.next}while(t!==e);if(!o)return null;var l=o,c=o.x,d=o.y,h=1/0,u;t=o;do i>=t.x&&t.x>=c&&i!==t.x&&kl(n<d?i:r,n,c,d,n<d?r:i,n,t.x,t.y)&&(u=Math.abs(n-t.y)/(i-t.x),Uh(t,s)&&(u<h||u===h&&(t.x>o.x||t.x===o.x&&pL(o,t)))&&(o=t,h=u)),t=t.next;while(t!==l);return o}function pL(s,e){return Ei(s.prev,s,e.prev)<0&&Ei(e.next,s,s.next)<0}function fL(s,e,t,i){var n=s;do n.z===0&&(n.z=tb(n.x,n.y,e,t,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==s);n.prevZ.nextZ=null,n.prevZ=null,mL(n)}function mL(s){var e,t,i,n,r,o,a,l,c=1;do{for(t=s,s=null,r=null,o=0;t;){for(o++,i=t,a=0,e=0;e<c&&(a++,i=i.nextZ,!!i);e++);for(l=c;a>0||l>0&&i;)a!==0&&(l===0||!i||t.z<=i.z)?(n=t,t=t.nextZ,a--):(n=i,i=i.nextZ,l--),r?r.nextZ=n:s=n,n.prevZ=r,r=n;t=i}r.nextZ=null,c*=2}while(o>1);return s}function tb(s,e,t,i,n){return s=(s-t)*n|0,e=(e-i)*n|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,s|e<<1}function gL(s){var e=s,t=s;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==s);return t}function kl(s,e,t,i,n,r,o,a){return(n-o)*(e-a)>=(s-o)*(r-a)&&(s-o)*(i-a)>=(t-o)*(e-a)&&(t-o)*(r-a)>=(n-o)*(i-a)}function bL(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!vL(s,e)&&(Uh(s,e)&&Uh(e,s)&&yL(s,e)&&(Ei(s.prev,s,e.prev)||Ei(s,e.prev,e))||$p(s,e)&&Ei(s.prev,s,s.next)>0&&Ei(e.prev,e,e.next)>0)}function Ei(s,e,t){return(e.y-s.y)*(t.x-e.x)-(e.x-s.x)*(t.y-e.y)}function $p(s,e){return s.x===e.x&&s.y===e.y}function LC(s,e,t,i){var n=wp(Ei(s,e,t)),r=wp(Ei(s,e,i)),o=wp(Ei(t,i,s)),a=wp(Ei(t,i,e));return!!(n!==r&&o!==a||n===0&&_p(s,t,e)||r===0&&_p(s,i,e)||o===0&&_p(t,s,i)||a===0&&_p(t,e,i))}function _p(s,e,t){return e.x<=Math.max(s.x,t.x)&&e.x>=Math.min(s.x,t.x)&&e.y<=Math.max(s.y,t.y)&&e.y>=Math.min(s.y,t.y)}function wp(s){return s>0?1:s<0?-1:0}function vL(s,e){var t=s;do{if(t.i!==s.i&&t.next.i!==s.i&&t.i!==e.i&&t.next.i!==e.i&&LC(t,t.next,s,e))return!0;t=t.next}while(t!==s);return!1}function Uh(s,e){return Ei(s.prev,s,s.next)<0?Ei(s,e,s.next)>=0&&Ei(s,s.prev,e)>=0:Ei(s,e,s.prev)<0||Ei(s,s.next,e)<0}function yL(s,e){var t=s,i=!1,n=(s.x+e.x)/2,r=(s.y+e.y)/2;do t.y>r!=t.next.y>r&&t.next.y!==t.y&&n<(t.next.x-t.x)*(r-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==s);return i}function FC(s,e){var t=new ib(s.i,s.x,s.y),i=new ib(e.i,e.x,e.y),n=s.next,r=e.prev;return s.next=e,e.prev=s,t.next=n,n.prev=t,i.next=t,t.prev=i,r.next=i,i.prev=r,i}function F1(s,e,t,i){var n=new ib(s,e,t);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Bh(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function ib(s,e,t){this.i=s,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Kp.deviation=function(s,e,t,i){var n=e&&e.length,r=n?e[0]*t:s.length,o=Math.abs(nb(s,0,r,t));if(n)for(var a=0,l=e.length;a<l;a++){var c=e[a]*t,d=a<l-1?e[a+1]*t:s.length;o-=Math.abs(nb(s,c,d,t))}var h=0;for(a=0;a<i.length;a+=3){var u=i[a]*t,p=i[a+1]*t,f=i[a+2]*t;h+=Math.abs((s[u]-s[f])*(s[p+1]-s[u+1])-(s[u]-s[p])*(s[f+1]-s[u+1]))}return o===0&&h===0?0:Math.abs((h-o)/o)};function nb(s,e,t,i){for(var n=0,r=e,o=t-i;r<t;r+=i)n+=(s[o]-s[r])*(s[r+1]+s[o+1]),o=r;return n}Kp.flatten=function(s){for(var e=s[0][0].length,t={vertices:[],holes:[],dimensions:e},i=0,n=0;n<s.length;n++){for(var r=0;r<s[n].length;r++)for(var o=0;o<e;o++)t.vertices.push(s[n][r][o]);n>0&&(i+=s[n-1].length,t.holes.push(i))}return t};var _L=Rb.exports,wL=RC(_L),EL={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`},mo=class{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}},CL=new Ys(-1,1,1,-1,0,1),sb=class extends kt{constructor(){super(),this.setAttribute("position",new Er([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Er([0,2,0,0,2,0],2))}},xL=new sb,jp=class{constructor(e){this._mesh=new $e(xL,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,CL)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}},Hp=class extends mo{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof Ni?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=cl.clone(e.uniforms),this.material=new Ni({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new jp(this.material)}render(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}},Gp=class extends mo{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,i){let n=e.getContext(),r=e.state;r.buffers.color.setMask(!1),r.buffers.depth.setMask(!1),r.buffers.color.setLocked(!0),r.buffers.depth.setLocked(!0);let o,a;this.inverse?(o=0,a=1):(o=1,a=0),r.buffers.stencil.setTest(!0),r.buffers.stencil.setOp(n.REPLACE,n.REPLACE,n.REPLACE),r.buffers.stencil.setFunc(n.ALWAYS,o,4294967295),r.buffers.stencil.setClear(a),r.buffers.stencil.setLocked(!0),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),r.buffers.color.setLocked(!1),r.buffers.depth.setLocked(!1),r.buffers.color.setMask(!0),r.buffers.depth.setMask(!0),r.buffers.stencil.setLocked(!1),r.buffers.stencil.setFunc(n.EQUAL,1,4294967295),r.buffers.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),r.buffers.stencil.setLocked(!0)}},rb=class extends mo{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}},ob=class{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){let i=e.getSize(new Bt);this._width=i.width,this._height=i.height,t=new Ss(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:nh}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Hp(EL),this.copyPass.material.blending=Lw,this.clock=new Lu}swapBuffers(){let e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){let t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());let t=this.renderer.getRenderTarget(),i=!1;for(let n=0,r=this.passes.length;n<r;n++){let o=this.passes[n];if(o.enabled!==!1){if(o.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),o.render(this.renderer,this.writeBuffer,this.readBuffer,e,i),o.needsSwap){if(i){let a=this.renderer.getContext(),l=this.renderer.state.buffers.stencil;l.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),l.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}Gp!==void 0&&(o instanceof Gp?i=!0:o instanceof rb&&(i=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){let t=this.renderer.getSize(new Bt);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;let i=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(i,n),this.renderTarget2.setSize(i,n);for(let r=0;r<this.passes.length;r++)this.passes[r].setSize(i,n)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}},ab=class extends mo{constructor(e,t,i=null,n=null,r=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=n,this.clearAlpha=r,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new zt}render(e,t,i){let n=e.autoClear;e.autoClear=!1;let r,o;this.overrideMaterial!==null&&(o=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor)),this.clearAlpha!==null&&(r=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:i),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(r),this.overrideMaterial!==null&&(this.scene.overrideMaterial=o),e.autoClear=n}},Hh=new kt;Hh.setAttribute("position",new Ti(new Float32Array([-1,-1,3,-1,-1,3]),2));Hh.setAttribute("uv",new Ti(new Float32Array([0,0,2,0,0,2]),2));Hh.boundingSphere=new Qn;Hh.computeBoundingSphere=function(){};var SL=new Ys,Nl=class{constructor(e){this._mesh=new $e(Hh,e),this._mesh.frustumCulled=!1}render(e){e.render(this._mesh,SL)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}dispose(){this._mesh.material.dispose(),this._mesh.geometry.dispose()}},AL={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},sceneNormal:{value:null},projMat:{value:new lt},viewMat:{value:new lt},projViewMat:{value:new lt},projectionMatrixInv:{value:new lt},viewMatrixInv:{value:new lt},cameraPos:{value:new ce},resolution:{value:new Bt},time:{value:0},samples:{value:[]},samplesR:{value:[]},bluenoise:{value:null},distanceFalloff:{value:1},radius:{value:5},near:{value:.1},far:{value:1e3},logDepth:{value:!1},ortho:{value:!1},screenSpaceRadius:{value:!1}},vertexShader:`
varying vec2 vUv;
void main() {
  vUv = uv;
  gl_Position = vec4(position, 1);
}`,fragmentShader:`
    #define SAMPLES 16
    #define FSAMPLES 16.0
uniform sampler2D sceneDiffuse;
uniform sampler2D sceneNormal;
uniform highp sampler2D sceneDepth;
uniform mat4 projectionMatrixInv;
uniform mat4 viewMatrixInv;
uniform mat4 projMat;
uniform mat4 viewMat;
uniform mat4 projViewMat;
uniform vec3 cameraPos;
uniform vec2 resolution;
uniform float time;
uniform vec3[SAMPLES] samples;
uniform float[SAMPLES] samplesR;
uniform float radius;
uniform float distanceFalloff;
uniform float near;
uniform float far;
uniform bool logDepth;
uniform bool ortho;
uniform bool screenSpaceRadius;
uniform sampler2D bluenoise;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }

    vec3 getWorldPosLog(vec3 posS) {
      vec2 uv = posS.xy;
      float z = posS.z;
      float nearZ =near;
      float farZ = far;
      float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
      vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
      return wpos.xyz / wpos.w;
    }
    vec3 getWorldPos(float depth, vec2 coord) {
      #ifdef LOGDEPTH
        return getWorldPosLog(vec3(coord, depth));
      #endif
      float z = depth * 2.0 - 1.0;
      vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
      vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
      // Perspective division
     vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
     worldSpacePosition.xyz /= worldSpacePosition.w;
      return worldSpacePosition.xyz;
  }

  vec3 computeNormal(vec3 worldPos, vec2 vUv) {
    ivec2 p = ivec2(vUv * resolution);
    float c0 = texelFetch(sceneDepth, p, 0).x;
    float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
    float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
    float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
    float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
    float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
    float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
    float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
    float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;

    float dl = abs((2.0 * l1 - l2) - c0);
    float dr = abs((2.0 * r1 - r2) - c0);
    float db = abs((2.0 * b1 - b2) - c0);
    float dt = abs((2.0 * t1 - t2) - c0);

    vec3 ce = getWorldPos(c0, vUv).xyz;

    vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                          : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
    vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                          : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;

    return normalize(cross(dpdx, dpdy));
}

void main() {
      vec4 diffuse = texture2D(sceneDiffuse, vUv);
      float depth = texture2D(sceneDepth, vUv).x;
      if (depth == 1.0) {
        gl_FragColor = vec4(vec3(1.0), 1.0);
        return;
      }
      vec3 worldPos = getWorldPos(depth, vUv);
    //  vec3 normal = texture2D(sceneNormal, vUv).rgb;//computeNormal(worldPos, vUv);
      #ifdef HALFRES
        vec3 normal = texture2D(sceneNormal, vUv).rgb;
      #else
        vec3 normal = computeNormal(worldPos, vUv);
      #endif
      vec4 noise = texture2D(bluenoise, gl_FragCoord.xy / 128.0);
      vec3 randomVec = normalize(noise.rgb * 2.0 - 1.0);
      vec3 tangent = normalize(randomVec - normal * dot(randomVec, normal));
      vec3 bitangent = cross(normal, tangent);
      mat3 tbn = mat3(tangent, bitangent, normal);
      float occluded = 0.0;
      float totalWeight = 0.0;
     /* float radiusScreen = distance(
        worldPos,
        getWorldPos(depth, vUv + 
          vec2(48.0, 0.0) / resolution)
      );/*vUv.x < 0.5 ? radius : min(distance(
        worldPos,
        getWorldPos(depth, vUv + 
          vec2(100.0, 0.0) / resolution)
      ), radius);
      float distanceFalloffScreen = radiusScreen * 0.2;*/
      float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
      float bias = (0.1 / near) * fwidth(distance(worldPos, cameraPos)) / radiusToUse;
      for(float i = 0.0; i < FSAMPLES; i++) {
        vec3 sampleDirection = 
        tbn * 
        samples[int(i)];
        ;
        float moveAmt = samplesR[int(mod(i + noise.a * FSAMPLES, FSAMPLES))];
        vec3 samplePos = worldPos + radiusToUse * moveAmt * sampleDirection;
        vec4 offset = projViewMat * vec4(samplePos, 1.0);
        offset.xyz /= offset.w;
        offset.xyz = offset.xyz * 0.5 + 0.5;
        float sampleDepth = textureLod(sceneDepth, offset.xy, 0.0).x;
        /*float distSample = logDepth ? linearize_depth_log(sampleDepth, near, far) 
         (ortho ?  linearize_depth_ortho(sampleDepth, near, far) : linearize_depth(sampleDepth, near, far));*/
        #ifdef LOGDEPTH
        float distSample = linearize_depth_log(sampleDepth, near, far);
        #else
        float distSample = ortho ? linearize_depth_ortho(sampleDepth, near, far) : linearize_depth(sampleDepth, near, far);
        #endif
        float distWorld = ortho ? linearize_depth_ortho(offset.z, near, far) : linearize_depth(offset.z, near, far);
        float rangeCheck = smoothstep(0.0, 1.0, distanceFalloffToUse / (abs(distSample - distWorld)));
        vec2 diff = gl_FragCoord.xy - ( offset.xy * resolution);
        float weight = dot(sampleDirection, normal);
          occluded += rangeCheck * weight * 
            (distSample + bias
               < distWorld ? 1.0 : 0.0) * (
          (dot(
            diff,
            diff
             
            ) < 1.0 || (sampleDepth == depth) || (
              offset.x < 0.0 || offset.x > 1.0 || offset.y < 0.0 || offset.y > 1.0
            ) ? 0.0 : 1.0)
          );
          totalWeight += weight;
      }
      float occ = clamp(1.0 - occluded / totalWeight, 0.0, 1.0);
      gl_FragColor = vec4(0.5 + 0.5 * normal, occ);
}`},IL={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new lt},viewMat:{value:new lt},projectionMatrixInv:{value:new lt},viewMatrixInv:{value:new lt},cameraPos:{value:new ce},resolution:{value:new Bt},color:{value:new ce(0,0,0)},blueNoise:{value:null},downsampledDepth:{value:null},time:{value:0},intensity:{value:10},renderMode:{value:0},gammaCorrection:{value:!1},logDepth:{value:!1},ortho:{value:!1},near:{value:.1},far:{value:1e3},screenSpaceRadius:{value:!1},radius:{value:0},distanceFalloff:{value:1}},vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform sampler2D sceneDepth;
    uniform sampler2D downsampledDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform vec2 resolution;
    uniform vec3 color;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform float intensity;
    uniform float renderMode;
    uniform float near;
    uniform float far;
    uniform bool gammaCorrection;
    uniform bool logDepth;
    uniform bool ortho;
    uniform bool screenSpaceRadius;
    uniform float radius;
    uniform float distanceFalloff;
    varying vec2 vUv;
    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }
    highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
      return nearZ + (farZ - nearZ) * d;
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
      float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
      float a = farZ / (farZ - nearZ);
      float b = farZ * nearZ / (nearZ - farZ);
      float linDepth = a + b / depth;
      return ortho ? linearize_depth_ortho(
        linDepth,
        nearZ,
        farZ
      ) :linearize_depth(linDepth, nearZ, farZ);
    }
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
       // if (logDepth) {
        #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
        #endif
      //  }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }

    #include <common>
    #include <dithering_pars_fragment>
    void main() {
        //vec4 texel = texture2D(tDiffuse, vUv);//vec3(0.0);
        vec4 sceneTexel = texture2D(sceneDiffuse, vUv);

        #ifdef HALFRES 
        float depth = texture2D(
            sceneDepth,
            vUv
        ).x;
        vec4 texel;
        if (depth == 1.0) {
            texel = vec4(0.0, 0.0, 0.0, 1.0);
        } else {
        vec3 worldPos = getWorldPos(depth, vUv);
        vec3 normal = computeNormal(getWorldPos(depth, vUv), vUv);
       // vec4 texel = texture2D(tDiffuse, vUv);
       // Find closest depth;
       float totalWeight = 0.0;
       float radiusToUse = screenSpaceRadius ? distance(
        worldPos,
        getWorldPos(depth, vUv +
          vec2(radius, 0.0) / resolution)
      ) : radius;
      float distanceFalloffToUse =screenSpaceRadius ?
          radiusToUse * distanceFalloff
      : distanceFalloff;
        for(float x = -1.0; x <= 1.0; x++) {
            for(float y = -1.0; y <= 1.0; y++) {
                vec2 offset = vec2(x, y);
                ivec2 p = ivec2(
                    (vUv * resolution * 0.5) + offset
                );
                vec2 pUv = vec2(p) / (resolution * 0.5);
                float sampleDepth = texelFetch(downsampledDepth,p, 0).x;
                vec4 sampleInfo = texelFetch(tDiffuse, p, 0);
                vec3 normalSample = sampleInfo.xyz * 2.0 - 1.0;
                vec3 worldPosSample = getWorldPos(sampleDepth, pUv);
                float tangentPlaneDist = abs(dot(worldPos - worldPosSample, normal));
                float rangeCheck = exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0);
                float weight = rangeCheck;
                totalWeight += weight;
                texel += sampleInfo * weight;
            }
        }
        if (totalWeight == 0.0) {
            texel = texture2D(tDiffuse, vUv);
        } else {
            texel /= totalWeight;
        }
    }
        #else
        vec4 texel = texture2D(tDiffuse, vUv);
        #endif

     
        float finalAo = pow(texel.a, intensity);
        if (renderMode == 0.0) {
            gl_FragColor = vec4( mix(sceneTexel.rgb, color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 1.0) {
            gl_FragColor = vec4( mix(vec3(1.0), color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
        } else if (renderMode == 2.0) {
            gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
        } else if (renderMode == 3.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(sceneTexel.rgb, color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
            }
        } else if (renderMode == 4.0) {
            if (vUv.x < 0.5) {
                gl_FragColor = vec4( sceneTexel.rgb, sceneTexel.a);
            } else if (abs(vUv.x - 0.5) < 1.0 / resolution.x) {
                gl_FragColor = vec4(1.0);
            } else {
                gl_FragColor = vec4( mix(vec3(1.0), color * sceneTexel.rgb, 1.0 - finalAo), sceneTexel.a);
            }
        }
        #include <dithering_fragment>
        if (gammaCorrection) {
            gl_FragColor = LinearTosRGB(gl_FragColor);
        }
    }
    `},TL={uniforms:{sceneDiffuse:{value:null},sceneDepth:{value:null},tDiffuse:{value:null},projMat:{value:new lt},viewMat:{value:new lt},projectionMatrixInv:{value:new lt},viewMatrixInv:{value:new lt},cameraPos:{value:new ce},resolution:{value:new Bt},time:{value:0},r:{value:5},blueNoise:{value:null},radius:{value:12},worldRadius:{value:5},index:{value:0},poissonDisk:{value:[]},distanceFalloff:{value:1},near:{value:.1},far:{value:1e3},logDepth:{value:!1},screenSpaceRadius:{value:!1}},vertexShader:`
		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = vec4(position, 1.0);
		}`,fragmentShader:`
		uniform sampler2D sceneDiffuse;
    uniform highp sampler2D sceneDepth;
    uniform sampler2D tDiffuse;
    uniform sampler2D blueNoise;
    uniform mat4 projectionMatrixInv;
    uniform mat4 viewMatrixInv;
    uniform vec2 resolution;
    uniform float r;
    uniform float radius;
     uniform float worldRadius;
    uniform float index;
     uniform float near;
     uniform float far;
     uniform float distanceFalloff;
     uniform bool logDepth;
     uniform bool screenSpaceRadius;
    varying vec2 vUv;

    highp float linearize_depth(highp float d, highp float zNear,highp float zFar)
    {
        highp float z_n = 2.0 * d - 1.0;
        return 2.0 * zNear * zFar / (zFar + zNear - z_n * (zFar - zNear));
    }
    highp float linearize_depth_log(highp float d, highp float nearZ,highp float farZ) {
     float depth = pow(2.0, d * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     return linearize_depth(linDepth, nearZ, farZ);
   }
   highp float linearize_depth_ortho(highp float d, highp float nearZ, highp float farZ) {
     return nearZ + (farZ - nearZ) * d;
   }
   vec3 getWorldPosLog(vec3 posS) {
     vec2 uv = posS.xy;
     float z = posS.z;
     float nearZ =near;
     float farZ = far;
     float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
     float a = farZ / (farZ - nearZ);
     float b = farZ * nearZ / (nearZ - farZ);
     float linDepth = a + b / depth;
     vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
     vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
     return wpos.xyz / wpos.w;
   }
    vec3 getWorldPos(float depth, vec2 coord) {
     #ifdef LOGDEPTH
          return getWorldPosLog(vec3(coord, depth));
     #endif
        
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
    #include <common>
    #define NUM_SAMPLES 16
    uniform vec2 poissonDisk[NUM_SAMPLES];
    void main() {
        const float pi = 3.14159;
        vec2 texelSize = vec2(1.0 / resolution.x, 1.0 / resolution.y);
        vec2 uv = vUv;
        vec4 data = texture2D(tDiffuse, vUv);
        float occlusion = data.a;
        float baseOcc = data.a;
        vec3 normal = data.rgb * 2.0 - 1.0;
        float count = 1.0;
        float d = texture2D(sceneDepth, vUv).x;
        vec3 worldPos = getWorldPos(d, vUv);
        float size = radius;
        float angle;
        if (index == 0.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).x * PI2;
        } else if (index == 1.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).y * PI2;
        } else if (index == 2.0) {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).z * PI2;
        } else {
             angle = texture2D(blueNoise, gl_FragCoord.xy / 128.0).w * PI2;
        }

        mat2 rotationMatrix = mat2(cos(angle), -sin(angle), sin(angle), cos(angle));
        float radiusToUse = screenSpaceRadius ? distance(
          worldPos,
          getWorldPos(d, vUv +
            vec2(worldRadius, 0.0) / resolution)
        ) : worldRadius;
        float distanceFalloffToUse =screenSpaceRadius ?
            radiusToUse * distanceFalloff
        : distanceFalloff;


        for(int i = 0; i < NUM_SAMPLES; i++) {
            vec2 offset = (rotationMatrix * poissonDisk[i]) * texelSize * size;
            vec4 dataSample = texture2D(tDiffuse, uv + offset);
            float occSample = dataSample.a;
            vec3 normalSample = dataSample.rgb * 2.0 - 1.0;
            float dSample = texture2D(sceneDepth, uv + offset).x;
            vec3 worldPosSample = getWorldPos(dSample, uv + offset);
            float tangentPlaneDist = abs(dot(worldPos - worldPosSample, normal));
            float rangeCheck = exp(-1.0 * tangentPlaneDist * (1.0 / distanceFalloffToUse)) * max(dot(normal, normalSample), 0.0) * (1.0 - abs(occSample - baseOcc));
            occlusion += occSample * rangeCheck;
            count += rangeCheck;
        }
        occlusion /= count;
        gl_FragColor = vec4(0.5 + 0.5 * normal, occlusion);
    }
    `},PL={uniforms:{sceneDepth:{value:null},resolution:{value:new Bt},near:{value:.1},far:{value:1e3},viewMatrixInv:{value:new lt},projectionMatrixInv:{value:new lt},logDepth:{value:!1}},vertexShader:`
    varying vec2 vUv;
    void main() {
        vUv = uv;
        gl_Position = vec4(position, 1);
    }`,fragmentShader:`
    uniform sampler2D sceneDepth;
    uniform vec2 resolution;
    uniform float near;
    uniform float far;
    uniform bool logDepth;
    uniform mat4 viewMatrixInv;
    uniform mat4 projectionMatrixInv;
    varying vec2 vUv;
    layout(location = 1) out vec4 gNormal;
    vec3 getWorldPosLog(vec3 posS) {
        vec2 uv = posS.xy;
        float z = posS.z;
        float nearZ =near;
        float farZ = far;
        float depth = pow(2.0, z * log2(farZ + 1.0)) - 1.0;
        float a = farZ / (farZ - nearZ);
        float b = farZ * nearZ / (nearZ - farZ);
        float linDepth = a + b / depth;
        vec4 clipVec = vec4(uv, linDepth, 1.0) * 2.0 - 1.0;
        vec4 wpos = viewMatrixInv * projectionMatrixInv * clipVec;
        return wpos.xyz / wpos.w;
      }
      vec3 getWorldPos(float depth, vec2 coord) {
        if (logDepth) {
          return getWorldPosLog(vec3(coord, depth));
        }
        float z = depth * 2.0 - 1.0;
        vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
        vec4 viewSpacePosition = projectionMatrixInv * clipSpacePosition;
        // Perspective division
       vec4 worldSpacePosition = viewMatrixInv * viewSpacePosition;
       worldSpacePosition.xyz /= worldSpacePosition.w;
        return worldSpacePosition.xyz;
    }
  
    vec3 computeNormal(vec3 worldPos, vec2 vUv) {
      ivec2 p = ivec2(vUv * resolution);
      float c0 = texelFetch(sceneDepth, p, 0).x;
      float l2 = texelFetch(sceneDepth, p - ivec2(2, 0), 0).x;
      float l1 = texelFetch(sceneDepth, p - ivec2(1, 0), 0).x;
      float r1 = texelFetch(sceneDepth, p + ivec2(1, 0), 0).x;
      float r2 = texelFetch(sceneDepth, p + ivec2(2, 0), 0).x;
      float b2 = texelFetch(sceneDepth, p - ivec2(0, 2), 0).x;
      float b1 = texelFetch(sceneDepth, p - ivec2(0, 1), 0).x;
      float t1 = texelFetch(sceneDepth, p + ivec2(0, 1), 0).x;
      float t2 = texelFetch(sceneDepth, p + ivec2(0, 2), 0).x;
  
      float dl = abs((2.0 * l1 - l2) - c0);
      float dr = abs((2.0 * r1 - r2) - c0);
      float db = abs((2.0 * b1 - b2) - c0);
      float dt = abs((2.0 * t1 - t2) - c0);
  
      vec3 ce = getWorldPos(c0, vUv).xyz;
  
      vec3 dpdx = (dl < dr) ? ce - getWorldPos(l1, (vUv - vec2(1.0 / resolution.x, 0.0))).xyz
                            : -ce + getWorldPos(r1, (vUv + vec2(1.0 / resolution.x, 0.0))).xyz;
      vec3 dpdy = (db < dt) ? ce - getWorldPos(b1, (vUv - vec2(0.0, 1.0 / resolution.y))).xyz
                            : -ce + getWorldPos(t1, (vUv + vec2(0.0, 1.0 / resolution.y))).xyz;
  
      return normalize(cross(dpdx, dpdy));
  }
    void main() {
        vec2 uv = vUv - vec2(0.5) / resolution;
        vec2 pixelSize = vec2(1.0) / resolution;
        vec2[] uvSamples = vec2[4](
            uv,
            uv + vec2(pixelSize.x, 0.0),
            uv + vec2(0.0, pixelSize.y),
            uv + pixelSize
        );
        float depth00 = texture2D(sceneDepth, uvSamples[0]).r;
        float depth10 = texture2D(sceneDepth, uvSamples[1]).r;
        float depth01 = texture2D(sceneDepth, uvSamples[2]).r;
        float depth11 = texture2D(sceneDepth, uvSamples[3]).r;
        float minDepth = min(min(depth00, depth10), min(depth01, depth11));
        float maxDepth = max(max(depth00, depth10), max(depth01, depth11));
        float targetDepth = minDepth;
        // Checkerboard pattern to avoid artifacts
        if (mod(gl_FragCoord.x + gl_FragCoord.y, 2.0) > 0.5) { 
            targetDepth = maxDepth;
        }
        int chosenIndex = 0;
        float[] samples = float[4](depth00, depth10, depth01, depth11);
        for(int i = 0; i < 4; ++i) {
            if (samples[i] == targetDepth) {
                chosenIndex = i;
                break;
            }
        }
        gl_FragColor = vec4(samples[chosenIndex], 0.0, 0.0, 1.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[chosenIndex], uvSamples[chosenIndex]), uvSamples[chosenIndex]
        ), 0.0);
       /* float[] samples = float[4](depth00, depth10, depth01, depth11);
        float c = 0.25 * (depth00 + depth10 + depth01 + depth11);
        float[] distances = float[4](depth00, depth10, depth01, depth11);
        float maxDistance = max(max(distances[0], distances[1]), max(distances[2], distances[3]));

        int remaining[3];
        int rejected[3];
        int i, j, k;

        for(i = 0, j = 0, k = 0; i < 4; ++i) {
            if (distances[i] < maxDistance) {
                remaining[j++] = i;
            } else {
                rejected[k++] = i;
            }
        }
        for(;j < 3;++j) {
            remaining[j] = rejected[--k];
        }
        vec3 s = vec3(
            samples[remaining[0]],
            samples[remaining[1]],
            samples[remaining[2]]
        );
        c = (s.x + s.y + s.z) / 3.0;

        distances[0] = abs(c - s.x);
        distances[1] = abs(c - s.y);
        distances[2] = abs(c - s.z);

        float minDistance = min(min(distances[0], distances[1]), distances[2]);

        for(i = 0; i < 3; ++i) {
            if (distances[i] == minDistance) {
                break;
            }
        }*/
      /*  gl_FragColor = vec4(samples[remaining[i]], 0.0, 0.0, 0.0);
        gNormal = vec4(computeNormal(
            getWorldPos(samples[remaining[i]], uvSamples[remaining[i]]), uvSamples[remaining[i]]
        ), 0.0);*/
    }`},kC="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";Uint8Array.from(atob(kC),s=>s.charCodeAt(0));var OL=Uint8Array.from(atob(kC),s=>s.charCodeAt(0));function NC(s,e,t){if(e.getQueryParameter(s,e.QUERY_RESULT_AVAILABLE)){let i=e.getQueryParameter(s,e.QUERY_RESULT)/1e6;t.lastTime=i}else setTimeout(()=>{NC(s,e,t)},1)}var lb=class extends mo{constructor(e,t,i=512,n=512){super(),this.width=i,this.height=n,this.clear=!0,this.camera=t,this.scene=e,this.configuration=new Proxy({aoSamples:16,aoRadius:5,denoiseSamples:8,denoiseRadius:12,distanceFalloff:1,intensity:5,denoiseIterations:2,renderMode:0,color:new zt(0,0,0),gammaCorrection:!0,logarithmicDepthBuffer:!1,screenSpaceRadius:!1,halfRes:!1,depthAwareUpsampling:!0},{set:(r,o,a)=>{let l=r[o];return r[o]=a,o==="aoSamples"&&l!==a&&this.configureAOPass(this.configuration.logarithmicDepthBuffer),o==="denoiseSamples"&&l!==a&&this.configureDenoisePass(this.configuration.logarithmicDepthBuffer),o==="halfRes"&&l!==a&&(this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureHalfResTargets(),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.setSize(this.width,this.height)),o==="depthAwareUpsampling"&&l!==a&&this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),!0}}),this.samples=[],this.samplesR=[],this.samplesDenoise=[],this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer),this.configureSampleDependentPasses(),this.configureHalfResTargets(),this.beautyRenderTarget=new Ss(this.width,this.height,{minFilter:ll,magFilter:xs}),this.beautyRenderTarget.depthTexture=new Ww(this.width,this.height,kw),this.beautyRenderTarget.depthTexture.format=Uw,this.writeTargetInternal=new Ss(this.width,this.height,{minFilter:ll,magFilter:ll,depthBuffer:!1}),this.readTargetInternal=new Ss(this.width,this.height,{minFilter:ll,magFilter:ll,depthBuffer:!1}),this.bluenoise=new Yw(OL,128,128),this.bluenoise.colorSpace=zw,this.bluenoise.wrapS=mg,this.bluenoise.wrapT=mg,this.bluenoise.minFilter=xs,this.bluenoise.magFilter=xs,this.bluenoise.needsUpdate=!0,this.lastTime=0,this._r=new Bt,this._c=new zt}configureHalfResTargets(){this.configuration.halfRes?(this.depthDownsampleTarget=new jw(this.width/2,this.height/2,2),this.depthDownsampleTarget.texture[0].format=Bw,this.depthDownsampleTarget.texture[0].type=Nw,this.depthDownsampleTarget.texture[0].minFilter=xs,this.depthDownsampleTarget.texture[0].magFilter=xs,this.depthDownsampleTarget.texture[0].depthBuffer=!1,this.depthDownsampleTarget.texture[1].format=Tu,this.depthDownsampleTarget.texture[1].type=nh,this.depthDownsampleTarget.texture[1].minFilter=xs,this.depthDownsampleTarget.texture[1].magFilter=xs,this.depthDownsampleTarget.texture[1].depthBuffer=!1,this.depthDownsampleQuad=new Nl(new Ni(PL))):(this.depthDownsampleTarget&&(this.depthDownsampleTarget.dispose(),this.depthDownsampleTarget=null),this.depthDownsampleQuad&&(this.depthDownsampleQuad.dispose(),this.depthDownsampleQuad=null))}configureSampleDependentPasses(){this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer)}configureAOPass(e=!1){this.samples=this.generateHemisphereSamples(this.configuration.aoSamples),this.samplesR=this.generateHemisphereSamplesR(this.configuration.aoSamples);let t=Se({},AL);t.fragmentShader=t.fragmentShader.replace("16",this.configuration.aoSamples).replace("16.0",this.configuration.aoSamples+".0"),e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.configuration.halfRes&&(t.fragmentShader=`#define HALFRES
`+t.fragmentShader),this.effectShaderQuad?(this.effectShaderQuad.material.dispose(),this.effectShaderQuad.material=new Ni(t)):this.effectShaderQuad=new Nl(new Ni(t))}configureDenoisePass(e=!1){this.samplesDenoise=this.generateDenoiseSamples(this.configuration.denoiseSamples,11);let t=Se({},TL);t.fragmentShader=t.fragmentShader.replace("16",this.configuration.denoiseSamples),e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.poissonBlurQuad?(this.poissonBlurQuad.material.dispose(),this.poissonBlurQuad.material=new Ni(t)):this.poissonBlurQuad=new Nl(new Ni(t))}configureEffectCompositer(e=!1){let t=Se({},IL);e&&(t.fragmentShader=`#define LOGDEPTH
`+t.fragmentShader),this.configuration.halfRes&&this.configuration.depthAwareUpsampling&&(t.fragmentShader=`#define HALFRES
`+t.fragmentShader),this.effectCompositerQuad?(this.effectCompositerQuad.material.dispose(),this.effectCompositerQuad.material=new Ni(t)):this.effectCompositerQuad=new Nl(new Ni(t))}generateHemisphereSamples(e){let t=[];for(let i=0;i<e;i++){let n=2.399963*i,r=Math.sqrt(i+.5)/Math.sqrt(e),o=r*Math.cos(n),a=r*Math.sin(n),l=Math.sqrt(1-(o*o+a*a));t.push(new ce(o,a,l))}return t}generateHemisphereSamplesR(e){let t=[];for(let i=0;i<e;i++)t.push((i+1)/e);return t}generateDenoiseSamples(e,t){let i=2*Math.PI*t/e,n=1/e,r=n,o=[],a=n,l=0;for(let c=0;c<e;c++)o.push(new Bt(Math.cos(l),Math.sin(l)).multiplyScalar(Math.pow(a,.75))),a+=r,l+=i;return o}setSize(e,t){this.width=e,this.height=t;let i=this.configuration.halfRes?.5:1;this.beautyRenderTarget.setSize(e,t),this.writeTargetInternal.setSize(e*i,t*i),this.readTargetInternal.setSize(e*i,t*i),this.configuration.halfRes&&this.depthDownsampleTarget.setSize(e*i,t*i)}render(e,t,i,n,r){e.capabilities.logarithmicDepthBuffer!==this.configuration.logarithmicDepthBuffer&&(this.configuration.logarithmicDepthBuffer=e.capabilities.logarithmicDepthBuffer,this.configureAOPass(this.configuration.logarithmicDepthBuffer),this.configureDenoisePass(this.configuration.logarithmicDepthBuffer),this.configureEffectCompositer(this.configuration.logarithmicDepthBuffer));let o,a,l;this.debugMode&&(o=e.getContext(),a=o.getExtension("EXT_disjoint_timer_query_webgl2"),a===null&&(console.error("EXT_disjoint_timer_query_webgl2 not available, disabling debug mode."),this.debugMode=!1)),e.setRenderTarget(this.beautyRenderTarget),e.render(this.scene,this.camera),this.debugMode&&(l=o.createQuery(),o.beginQuery(a.TIME_ELAPSED_EXT,l));let c=e.xr.enabled;e.xr.enabled=!1,this.camera.updateMatrixWorld(),this._r.set(this.width,this.height);let d=this.configuration.aoRadius;this.configuration.halfRes&&this.configuration.screenSpaceRadius&&(d*=.5),this.configuration.halfRes&&(e.setRenderTarget(this.depthDownsampleTarget),this.depthDownsampleQuad.material.uniforms.sceneDepth.value=this.beautyRenderTarget.depthTexture,this.depthDownsampleQuad.material.uniforms.resolution.value=this._r,this.depthDownsampleQuad.material.uniforms.near.value=this.camera.near,this.depthDownsampleQuad.material.uniforms.far.value=this.camera.far,this.depthDownsampleQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.depthDownsampleQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.depthDownsampleQuad.material.uniforms.logDepth.value=this.configuration.logarithmicDepthBuffer,this.depthDownsampleQuad.render(e)),this.effectShaderQuad.material.uniforms.sceneDiffuse.value=this.beautyRenderTarget.texture,this.effectShaderQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.beautyRenderTarget.depthTexture,this.effectShaderQuad.material.uniforms.sceneNormal.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[1]:null,this.effectShaderQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.effectShaderQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.effectShaderQuad.material.uniforms.projViewMat.value=this.camera.projectionMatrix.clone().multiply(this.camera.matrixWorldInverse.clone()),this.effectShaderQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectShaderQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectShaderQuad.material.uniforms.cameraPos.value=this.camera.position,this.effectShaderQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.effectShaderQuad.material.uniforms.time.value=performance.now()/1e3,this.effectShaderQuad.material.uniforms.samples.value=this.samples,this.effectShaderQuad.material.uniforms.samplesR.value=this.samplesR,this.effectShaderQuad.material.uniforms.bluenoise.value=this.bluenoise,this.effectShaderQuad.material.uniforms.radius.value=d,this.effectShaderQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectShaderQuad.material.uniforms.near.value=this.camera.near,this.effectShaderQuad.material.uniforms.far.value=this.camera.far,this.effectShaderQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectShaderQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectShaderQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,e.setRenderTarget(this.writeTargetInternal),this.effectShaderQuad.render(e);for(let h=0;h<this.configuration.denoiseIterations;h++)[this.writeTargetInternal,this.readTargetInternal]=[this.readTargetInternal,this.writeTargetInternal],this.poissonBlurQuad.material.uniforms.tDiffuse.value=this.readTargetInternal.texture,this.poissonBlurQuad.material.uniforms.sceneDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.beautyRenderTarget.depthTexture,this.poissonBlurQuad.material.uniforms.projMat.value=this.camera.projectionMatrix,this.poissonBlurQuad.material.uniforms.viewMat.value=this.camera.matrixWorldInverse,this.poissonBlurQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.poissonBlurQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.poissonBlurQuad.material.uniforms.cameraPos.value=this.camera.position,this.poissonBlurQuad.material.uniforms.resolution.value=this.configuration.halfRes?this._r.clone().multiplyScalar(.5).floor():this._r,this.poissonBlurQuad.material.uniforms.time.value=performance.now()/1e3,this.poissonBlurQuad.material.uniforms.blueNoise.value=this.bluenoise,this.poissonBlurQuad.material.uniforms.radius.value=this.configuration.denoiseRadius*(this.configuration.halfRes?.5:1),this.poissonBlurQuad.material.uniforms.worldRadius.value=d,this.poissonBlurQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.poissonBlurQuad.material.uniforms.index.value=h,this.poissonBlurQuad.material.uniforms.poissonDisk.value=this.samplesDenoise,this.poissonBlurQuad.material.uniforms.near.value=this.camera.near,this.poissonBlurQuad.material.uniforms.far.value=this.camera.far,this.poissonBlurQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.poissonBlurQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,e.setRenderTarget(this.writeTargetInternal),this.poissonBlurQuad.render(e);this.effectCompositerQuad.material.uniforms.sceneDiffuse.value=this.beautyRenderTarget.texture,this.effectCompositerQuad.material.uniforms.sceneDepth.value=this.beautyRenderTarget.depthTexture,this.effectCompositerQuad.material.uniforms.near.value=this.camera.near,this.effectCompositerQuad.material.uniforms.far.value=this.camera.far,this.effectCompositerQuad.material.uniforms.projectionMatrixInv.value=this.camera.projectionMatrixInverse,this.effectCompositerQuad.material.uniforms.viewMatrixInv.value=this.camera.matrixWorld,this.effectCompositerQuad.material.uniforms.logDepth.value=e.capabilities.logarithmicDepthBuffer,this.effectCompositerQuad.material.uniforms.ortho.value=this.camera.isOrthographicCamera,this.effectCompositerQuad.material.uniforms.downsampledDepth.value=this.configuration.halfRes?this.depthDownsampleTarget.texture[0]:this.beautyRenderTarget.depthTexture,this.effectCompositerQuad.material.uniforms.resolution.value=this._r,this.effectCompositerQuad.material.uniforms.blueNoise.value=this.bluenoise,this.effectCompositerQuad.material.uniforms.intensity.value=this.configuration.intensity,this.effectCompositerQuad.material.uniforms.renderMode.value=this.configuration.renderMode,this.effectCompositerQuad.material.uniforms.screenSpaceRadius.value=this.configuration.screenSpaceRadius,this.effectCompositerQuad.material.uniforms.radius.value=d,this.effectCompositerQuad.material.uniforms.distanceFalloff.value=this.configuration.distanceFalloff,this.effectCompositerQuad.material.uniforms.gammaCorrection.value=this.configuration.gammaCorrection,this.effectCompositerQuad.material.uniforms.tDiffuse.value=this.writeTargetInternal.texture,this.effectCompositerQuad.material.uniforms.color.value=this._c.copy(this.configuration.color).convertSRGBToLinear(),e.setRenderTarget(this.renderToScreen?null:t),this.effectCompositerQuad.render(e),this.debugMode&&(o.endQuery(a.TIME_ELAPSED_EXT),NC(l,o,this)),e.xr.enabled=c}enableDebugMode(){this.debugMode=!0}disableDebugMode(){this.debugMode=!1}setDisplayMode(e){this.configuration.renderMode=["Combined","AO","No AO","Split","Split AO"].indexOf(e)}setQualityMode(e){e==="Performance"?(this.configuration.aoSamples=8,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Low"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=4,this.configuration.denoiseRadius=12):e==="Medium"?(this.configuration.aoSamples=16,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=12):e==="High"?(this.configuration.aoSamples=64,this.configuration.denoiseSamples=8,this.configuration.denoiseRadius=6):e==="Ultra"&&(this.configuration.aoSamples=64,this.configuration.denoiseSamples=16,this.configuration.denoiseRadius=6)}},ML={name:"GammaCorrectionShader",uniforms:{tDiffuse:{value:null}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 tex = texture2D( tDiffuse, vUv );

			gl_FragColor = sRGBTransferOETF( tex );

		}`};function RL(){return new Ni({side:2,clipping:!0,uniforms:{},vertexShader:`
    varying vec4 vColor;
    
    #include <clipping_planes_pars_vertex>
  
    void main() {
       #include <begin_vertex>
    
       vec4 absPosition = vec4(position, 1.0);
       vec3 trueNormal = normal;
       
       #ifdef USE_INSTANCING
          absPosition = instanceMatrix * absPosition;
          trueNormal = (instanceMatrix * vec4(normal, 0.)).xyz;
       #endif
       
       absPosition = modelMatrix * absPosition;
       trueNormal = (normalize(modelMatrix * vec4(trueNormal, 0.))).xyz;
       
       vec3 planePosition = absPosition.xyz / 40.;
       float d = abs(dot(trueNormal, planePosition));
       vColor = vec4(abs(trueNormal), d);
       gl_Position = projectionMatrix * viewMatrix * absPosition;
       
       #include <project_vertex>
       #include <clipping_planes_vertex>
    }
    `,fragmentShader:`
    varying vec4 vColor;
    
    #include <clipping_planes_pars_fragment>
  
    void main() {
      #include <clipping_planes_fragment>
      gl_FragColor = vColor;
    }
    `})}function DL(){return new Ni({side:2,clipping:!0,uniforms:{},vertexShader:`
    varying vec3 vCameraPosition;
    varying vec3 vPosition;
    varying vec3 vNormal;
    
    #include <clipping_planes_pars_vertex>
  
    void main() {
       #include <begin_vertex>
       
       vec4 absPosition = vec4(position, 1.0);
       vNormal = normal;
       
       #ifdef USE_INSTANCING
          absPosition = instanceMatrix * absPosition;
          vNormal = (instanceMatrix * vec4(normal, 0.)).xyz;
       #endif
       
       absPosition = modelMatrix * absPosition;
       vNormal = (normalize(modelMatrix * vec4(vNormal, 0.))).xyz;
       
       gl_Position = projectionMatrix * viewMatrix * absPosition;
       
       vCameraPosition = cameraPosition;
       vPosition = absPosition.xyz;
       
       #include <project_vertex>
       #include <clipping_planes_vertex>
    }
    `,fragmentShader:`
    varying vec3 vCameraPosition;
    varying vec3 vPosition;
    varying vec3 vNormal;
    
    #include <clipping_planes_pars_fragment>
  
    void main() {
      #include <clipping_planes_fragment>
      vec3 cameraPixelVec = normalize(vCameraPosition - vPosition);
      float difference = abs(dot(vNormal, cameraPixelVec));
      
      // This achieves a double gloss effect: when the surface is perpendicular and when it's parallel
      difference = abs((difference * 2.) - 1.);
      
      gl_FragColor = vec4(difference, difference, difference, 1.);
    }
    `})}var cb=class extends mo{constructor(e,t,i,n,r){if(super(),Z(this,"components"),Z(this,"resolution"),Z(this,"renderScene"),Z(this,"renderCamera"),Z(this,"fsQuad"),Z(this,"normalOverrideMaterial"),Z(this,"glossOverrideMaterial"),Z(this,"planeBuffer"),Z(this,"glossBuffer"),Z(this,"outlineBuffer"),Z(this,"excludedMeshes",[]),Z(this,"outlinedMeshes",{}),Z(this,"outlineScene",new to),Z(this,"_outlineEnabled",!1),Z(this,"_lineColor",10066329),Z(this,"_opacity",.4),Z(this,"_tolerance",3),Z(this,"_glossEnabled",!0),Z(this,"_glossExponent",1.9),Z(this,"_minGloss",-.1),Z(this,"_maxGloss",.1),!i.renderer)throw new Error("The given world must have a renderer!");this.components=t,this.renderScene=n,this.renderCamera=r,this.resolution=new Bt(e.x,e.y),this.fsQuad=new jp,this.fsQuad.material=this.createOutlinePostProcessMaterial(),this.planeBuffer=this.newRenderTarget(),this.glossBuffer=this.newRenderTarget(),this.outlineBuffer=this.newRenderTarget();let o=RL();o.clippingPlanes=i.renderer.clippingPlanes,this.normalOverrideMaterial=o;let a=DL();a.clippingPlanes=i.renderer.clippingPlanes,this.glossOverrideMaterial=a}get lineColor(){return this._lineColor}set lineColor(e){this._lineColor=e,this.fsQuad.material.uniforms.lineColor.value.set(e)}get tolerance(){return this._tolerance}set tolerance(e){this._tolerance=e;let t=this.fsQuad.material;t.uniforms.tolerance.value=e}get opacity(){return this._opacity}set opacity(e){this._opacity=e;let t=this.fsQuad.material;t.uniforms.opacity.value=e}get glossEnabled(){return this._glossEnabled}set glossEnabled(e){if(e===this._glossEnabled)return;this._glossEnabled=e;let t=this.fsQuad.material;t.uniforms.glossEnabled.value=e?1:0}get glossExponent(){return this._glossExponent}set glossExponent(e){this._glossExponent=e;let t=this.fsQuad.material;t.uniforms.glossExponent.value=e}get minGloss(){return this._minGloss}set minGloss(e){this._minGloss=e;let t=this.fsQuad.material;t.uniforms.minGloss.value=e}get maxGloss(){return new Ii().color.convertLinearToSRGB(),this._maxGloss}set maxGloss(e){this._maxGloss=e;let t=this.fsQuad.material;t.uniforms.maxGloss.value=e}get outlineEnabled(){return this._outlineEnabled}set outlineEnabled(e){if(e===this._outlineEnabled)return;this._outlineEnabled=e;let t=this.fsQuad.material;t.uniforms.outlineEnabled.value=e?1:0}dispose(){return ie(this,null,function*(){this.planeBuffer.dispose(),this.glossBuffer.dispose(),this.outlineBuffer.dispose(),this.normalOverrideMaterial.dispose(),this.glossOverrideMaterial.dispose(),this.fsQuad.material.dispose(),this.fsQuad.dispose(),this.excludedMeshes=[],this.outlineScene.children=[];let e=this.components.get(nr);for(let t in this.outlinedMeshes){let i=this.outlinedMeshes[t];for(let n of i.meshes){e.destroy(n,!0,!0);let r=n;r.fragment&&r.fragment.dispose(!0)}i.material.dispose()}})}setSize(e,t){this.planeBuffer.setSize(e,t),this.glossBuffer.setSize(e,t),this.outlineBuffer.setSize(e,t),this.resolution.set(e,t);let i=this.fsQuad.material;i.uniforms.screenSize.value.set(this.resolution.x,this.resolution.y,1/this.resolution.x,1/this.resolution.y),i.uniformsNeedUpdate=!0}render(e,t,i){let n=t.depthBuffer;t.depthBuffer=!1;let r=this.renderScene.overrideMaterial,o=this.renderScene.background;this.renderScene.background=null;for(let l of this.excludedMeshes)l.visible=!1;e.setRenderTarget(this.planeBuffer),this.renderScene.overrideMaterial=this.normalOverrideMaterial,e.render(this.renderScene,this.renderCamera),this._glossEnabled&&(e.setRenderTarget(this.glossBuffer),this.renderScene.overrideMaterial=this.glossOverrideMaterial,e.render(this.renderScene,this.renderCamera)),this.renderScene.overrideMaterial=r,e.setRenderTarget(this.outlineBuffer),this._outlineEnabled?e.render(this.outlineScene,this.renderCamera):e.clear();for(let l of this.excludedMeshes)l.visible=!0;this.renderScene.background=o;let a=this.fsQuad.material;a.uniforms.planeBuffer.value=this.planeBuffer.texture,a.uniforms.glossBuffer.value=this.glossBuffer.texture,a.uniforms.outlineBuffer.value=this.outlineBuffer.texture,a.uniforms.sceneColorBuffer.value=i.texture,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.fsQuad.render(e)),t.depthBuffer=n}get vertexShader(){return`
	  varying vec2 vUv;
	  void main() {
	  	vUv = uv;
	  	gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
	  }
	`}get fragmentShader(){return`
	  uniform sampler2D sceneColorBuffer;
	  uniform sampler2D planeBuffer;
	  uniform sampler2D glossBuffer;
	  uniform sampler2D outlineBuffer;
	  uniform vec4 screenSize;
	  uniform vec3 lineColor;
	  
	  uniform float outlineEnabled;
	  
      uniform int width;
	  uniform float opacity;
      uniform float tolerance;
      uniform float glossExponent;
      uniform float minGloss;
      uniform float maxGloss;
      uniform float glossEnabled;

	  varying vec2 vUv;

	  vec4 getValue(sampler2D buffer, int x, int y) {
	  	return texture2D(buffer, vUv + screenSize.zw * vec2(x, y));
	  }

      float normalDiff(vec3 normal1, vec3 normal2) {
        return ((dot(normal1, normal2) - 1.) * -1.) / 2.;
      }

      // Returns 0 if it's background, 1 if it's not
      float getIsBackground(vec3 normal) {
        float background = 1.0;
        background *= step(normal.x, 0.);
        background *= step(normal.y, 0.);
        background *= step(normal.z, 0.);
        background = (background - 1.) * -1.;
        return background;
      }

	  void main() {
	  
	    vec4 sceneColor = getValue(sceneColorBuffer, 0, 0);
	    vec3 normSceneColor = normalize(sceneColor.rgb);
  
        vec4 plane = getValue(planeBuffer, 0, 0);
	    vec3 normal = plane.xyz;
        float distance = plane.w;
  
        vec3 normalTop = getValue(planeBuffer, 0, width).rgb;
        vec3 normalBottom = getValue(planeBuffer, 0, -width).rgb;
        vec3 normalRight = getValue(planeBuffer, width, 0).rgb;
        vec3 normalLeft = getValue(planeBuffer, -width, 0).rgb;
        vec3 normalTopRight = getValue(planeBuffer, width, width).rgb;
        vec3 normalTopLeft = getValue(planeBuffer, -width, width).rgb;
        vec3 normalBottomRight = getValue(planeBuffer, width, -width).rgb;
        vec3 normalBottomLeft = getValue(planeBuffer, -width, -width).rgb;
  
        float distanceTop = getValue(planeBuffer, 0, width).a;
        float distanceBottom = getValue(planeBuffer, 0, -width).a;
        float distanceRight = getValue(planeBuffer, width, 0).a;
        float distanceLeft = getValue(planeBuffer, -width, 0).a;
        float distanceTopRight = getValue(planeBuffer, width, width).a;
        float distanceTopLeft = getValue(planeBuffer, -width, width).a;
        float distanceBottomRight = getValue(planeBuffer, width, -width).a;
        float distanceBottomLeft = getValue(planeBuffer, -width, -width).a;
        
        vec3 sceneColorTop = normalize(getValue(sceneColorBuffer, 1, 0).rgb);
        vec3 sceneColorBottom = normalize(getValue(sceneColorBuffer, -1, 0).rgb);
        vec3 sceneColorLeft = normalize(getValue(sceneColorBuffer, 0, -1).rgb);
        vec3 sceneColorRight = normalize(getValue(sceneColorBuffer, 0, 1).rgb);
        vec3 sceneColorTopRight = normalize(getValue(sceneColorBuffer, 1, 1).rgb);
        vec3 sceneColorBottomRight = normalize(getValue(sceneColorBuffer, -1, 1).rgb);
        vec3 sceneColorTopLeft = normalize(getValue(sceneColorBuffer, 1, 1).rgb);
        vec3 sceneColorBottomLeft = normalize(getValue(sceneColorBuffer, -1, 1).rgb);

        // Checks if the planes of this texel and the neighbour texels are different

        float planeDiff = 0.0;

        planeDiff += step(0.001, normalDiff(normal, normalTop));
        planeDiff += step(0.001, normalDiff(normal, normalBottom));
        planeDiff += step(0.001, normalDiff(normal, normalLeft));
        planeDiff += step(0.001, normalDiff(normal, normalRight));
        planeDiff += step(0.001, normalDiff(normal, normalTopRight));
        planeDiff += step(0.001, normalDiff(normal, normalTopLeft));
        planeDiff += step(0.001, normalDiff(normal, normalBottomRight));
        planeDiff += step(0.001, normalDiff(normal, normalBottomLeft));
        
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorTop));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorBottom));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorLeft));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorRight));
       	planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorTopRight));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorTopLeft));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorBottomRight));
        planeDiff += step(0.001, normalDiff(normSceneColor, sceneColorBottomLeft));

        planeDiff += step(0.001, abs(distance - distanceTop));
        planeDiff += step(0.001, abs(distance - distanceBottom));
        planeDiff += step(0.001, abs(distance - distanceLeft));
        planeDiff += step(0.001, abs(distance - distanceRight));
        planeDiff += step(0.001, abs(distance - distanceTopRight));
        planeDiff += step(0.001, abs(distance - distanceTopLeft));
        planeDiff += step(0.001, abs(distance - distanceBottomRight));
        planeDiff += step(0.001, abs(distance - distanceBottomLeft));

        // Add extra background outline

        int width2 = width + 1;
        vec3 normalTop2 = getValue(planeBuffer, 0, width2).rgb;
        vec3 normalBottom2 = getValue(planeBuffer, 0, -width2).rgb;
        vec3 normalRight2 = getValue(planeBuffer, width2, 0).rgb;
        vec3 normalLeft2 = getValue(planeBuffer, -width2, 0).rgb;
        vec3 normalTopRight2 = getValue(planeBuffer, width2, width2).rgb;
        vec3 normalTopLeft2 = getValue(planeBuffer, -width2, width2).rgb;
        vec3 normalBottomRight2 = getValue(planeBuffer, width2, -width2).rgb;
        vec3 normalBottomLeft2 = getValue(planeBuffer, -width2, -width2).rgb;

        planeDiff += -(getIsBackground(normalTop2) - 1.);
        planeDiff += -(getIsBackground(normalBottom2) - 1.);
        planeDiff += -(getIsBackground(normalRight2) - 1.);
        planeDiff += -(getIsBackground(normalLeft2) - 1.);
        planeDiff += -(getIsBackground(normalTopRight2) - 1.);
        planeDiff += -(getIsBackground(normalBottomRight2) - 1.);
        planeDiff += -(getIsBackground(normalBottomRight2) - 1.);
        planeDiff += -(getIsBackground(normalBottomLeft2) - 1.);

        // Tolerance sets the minimum amount of differences to consider
        // this texel an edge

        float line = step(tolerance, planeDiff);

        // Exclude background and apply opacity

        float background = getIsBackground(normal);
        line *= background;
        line *= opacity;
        
        // Add gloss
        
        vec3 gloss = getValue(glossBuffer, 0, 0).xyz;
        float diffGloss = abs(maxGloss - minGloss);
        vec3 glossExpVector = vec3(glossExponent,glossExponent,glossExponent);
        gloss = min(pow(gloss, glossExpVector), vec3(1.,1.,1.));
        gloss *= diffGloss;
        gloss += minGloss;
        vec4 glossedColor = sceneColor + vec4(gloss, 1.) * glossEnabled;
        
        vec4 corrected = mix(sceneColor, glossedColor, background);
        
        // Draw lines
        
        corrected = mix(corrected, vec4(lineColor, 1.), line);
        
        // Add outline
        
        vec4 outlinePreview =getValue(outlineBuffer, 0, 0);
        float outlineColorCorrection = 1. / max(0.2, outlinePreview.a);
        vec3 outlineColor = outlinePreview.rgb * outlineColorCorrection;
        
        // thickness between 10 and 2, opacity between 1 and 0.2
	    int outlineThickness = int(outlinePreview.a * 10.);
	    
	    float outlineDiff = 0.;
        
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 1, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, -1, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, -1).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, 1).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, outlineThickness, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, -outlineThickness, 0).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, -outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, 0, outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, outlineThickness, outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, -outlineThickness, outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, -outlineThickness, -outlineThickness).a);
        outlineDiff += step(0.1, getValue(outlineBuffer, outlineThickness, -outlineThickness).a);
        
        float outLine = step(4., outlineDiff) * step(outlineDiff, 12.) * outlineEnabled;
        corrected = mix(corrected, vec4(outlineColor, 1.), outLine);
        
        gl_FragColor = corrected;
	}
			`}createOutlinePostProcessMaterial(){return new Ni({uniforms:{opacity:{value:this._opacity},debugVisualize:{value:0},sceneColorBuffer:{value:null},tolerance:{value:this._tolerance},planeBuffer:{value:null},glossBuffer:{value:null},outlineBuffer:{value:null},glossEnabled:{value:1},minGloss:{value:this._minGloss},maxGloss:{value:this._maxGloss},outlineEnabled:{value:0},glossExponent:{value:this._glossExponent},width:{value:1},lineColor:{value:new zt(this._lineColor)},screenSize:{value:new Hs(this.resolution.x,this.resolution.y,1/this.resolution.x,1/this.resolution.y)}},vertexShader:this.vertexShader,fragmentShader:this.fragmentShader})}newRenderTarget(){let e=new Ss(this.resolution.x,this.resolution.y);return e.texture.colorSpace="srgb-linear",e.texture.format=Tu,e.texture.type=nh,e.texture.minFilter=xs,e.texture.magFilter=xs,e.texture.generateMipmaps=!1,e.stencilBuffer=!1,e}},hb=class{constructor(e,t,i){if(Z(this,"composer"),Z(this,"overrideClippingPlanes",!1),Z(this,"_components"),Z(this,"_world"),Z(this,"_renderTarget"),Z(this,"_enabled",!1),Z(this,"_initialized",!1),Z(this,"_n8ao"),Z(this,"_customEffects"),Z(this,"_basePass"),Z(this,"_gammaPass"),Z(this,"_depthTexture"),Z(this,"_renderer"),Z(this,"_settings",{gamma:!0,custom:!0,ao:!1}),!i.renderer)throw new Error("The given world must have a renderer!");this._components=e,this._renderer=t,this._world=i,this._renderTarget=new Ss(window.innerWidth,window.innerHeight),this._renderTarget.texture.colorSpace="srgb-linear",this.composer=new ob(t,this._renderTarget),this.composer.setSize(window.innerWidth,window.innerHeight)}get basePass(){if(!this._basePass)throw new Error("Custom effects not initialized!");return this._basePass}get gammaPass(){if(!this._gammaPass)throw new Error("Custom effects not initialized!");return this._gammaPass}get customEffects(){if(!this._customEffects)throw new Error("Custom effects not initialized!");return this._customEffects}get n8ao(){if(!this._n8ao)throw new Error("Custom effects not initialized!");return this._n8ao}get enabled(){return this._enabled}set enabled(e){this._initialized||this.initialize(),this._enabled=e}get settings(){return Se({},this._settings)}dispose(){var e,t,i,n;this.composer.dispose(),this._renderTarget.dispose(),(e=this._depthTexture)==null||e.dispose(),(t=this._customEffects)==null||t.dispose(),(i=this._gammaPass)==null||i.dispose(),(n=this._n8ao)==null||n.dispose()}setPasses(e){let t=!1;for(let i in e){let n=i;if(this.settings[n]!==e[n]){t=!0;break}}if(t){for(let i in e){let n=i;this._settings[n]!==void 0&&(this._settings[n]=e[n])}this.updatePasses()}}setSize(e,t){if(!(e===0||t===0)&&this._initialized){let i=this._settings.custom;i&&this.setPasses({custom:!1}),this.setPasses({custom:!1}),this.composer.setSize(e,t),this.basePass.setSize(e,t),this.n8ao.setSize(e,t),this.customEffects.setSize(e,t),this.gammaPass.setSize(e,t),i&&this.setPasses({custom:!0})}}update(){this._enabled&&this.composer.render()}updateCamera(){let e=this._world.camera.three;this._n8ao&&(this._n8ao.camera=e),this._customEffects&&(this._customEffects.renderCamera=e),this._basePass&&(this._basePass.camera=e)}updateProjection(e){this.composer.passes.forEach(t=>{t.camera=e}),this.update()}initialize(){if(!this._world.renderer)throw new Error("The given world must have a renderer!");let e=this._world.scene.three,t=this._world.camera.three;if(!(e instanceof to))throw new Error("The given scene must have a THREE.Scene as core!");let i=this._world.camera;i.projection&&i.projection.onChanged.add(()=>{this.updateCamera()});let n=this._world.renderer;this.overrideClippingPlanes||(this._renderer.clippingPlanes=n.clippingPlanes),this._renderer.outputColorSpace="srgb",this._renderer.toneMapping=Fw,this.newBasePass(e,t),this.newSaoPass(e,t),this.newGammaPass(),this.newCustomPass(e,t),this._initialized=!0,this.updatePasses()}updatePasses(){for(let e of this.composer.passes)this.composer.removePass(e);this._basePass&&this.composer.addPass(this.basePass),this._settings.gamma&&this.composer.addPass(this.gammaPass),this._settings.ao&&this.composer.addPass(this.n8ao),this._settings.custom&&this.composer.addPass(this.customEffects)}newCustomPass(e,t){this._customEffects=new cb(new Bt(window.innerWidth,window.innerHeight),this._components,this._world,e,t)}newGammaPass(){this._gammaPass=new Hp(ML)}newSaoPass(e,t){if(!this._world.renderer)throw new Error("The given world must have a renderer!");let{width:i,height:n}=this._world.renderer.getSize();this._n8ao=new lb(e,t,i,n);let{configuration:r}=this._n8ao;r.aoSamples=16,r.denoiseSamples=1,r.denoiseRadius=13,r.aoRadius=1,r.distanceFalloff=4,r.aoRadius=1,r.intensity=4,r.halfRes=!0,r.color=new zt().setHex(13421772,"srgb-linear")}newBasePass(e,t){this._basePass=new ab(e,t)}},si=class extends kh{constructor(e,t,i){super(e,t,i),Z(this,"_postproduction"),this.onResize.add(n=>this.resizePostproduction(n)),this.onWorldChanged.add(()=>{this.currentWorld&&(this._postproduction&&this._postproduction.dispose(),this._postproduction=new hb(e,this.three,this.currentWorld),this.setPostproductionSize())})}get postproduction(){if(!this._postproduction)throw new Error("Renderer not initialized yet with a world!");return this._postproduction}update(){if(!this.enabled||!this.currentWorld)return;this.onBeforeUpdate.trigger();let e=this.currentWorld.scene.three,t=this.currentWorld.camera.three;this.postproduction.enabled?this.postproduction.composer.render():this.three.render(e,t),e instanceof to&&this.three2D.render(e,t),this.onAfterUpdate.trigger()}dispose(){super.dispose(),this.postproduction.dispose()}resizePostproduction(e){this.postproduction&&this.setPostproductionSize(e)}setPostproductionSize(e){if(!this.container)return;let t=e?e.x:this.container.clientWidth,i=e?e.y:this.container.clientHeight;this.postproduction.setSize(t,i)}},db=class{constructor(e,t,i,n,r){Z(this,"mesh",new $e(new kt)),Z(this,"components"),Z(this,"world"),Z(this,"styleName"),Z(this,"_precission",1e4),Z(this,"_tempVector",new ce),Z(this,"_plane"),Z(this,"_geometry"),Z(this,"_outlinedMesh"),Z(this,"_plane2DCoordinateSystem",new lt),Z(this,"_planeAxis"),this.components=e,this.world=t,this.mesh.material=r,this.mesh.frustumCulled=!1,this.mesh.userData.indexFragmentMap=new Map,this._plane=i;let{x:o,y:a,z:l}=i.normal;Math.abs(o)===1?this._planeAxis="x":Math.abs(a)===1?this._planeAxis="y":Math.abs(l)===1&&(this._planeAxis="z"),this._geometry=n,this.mesh.geometry.attributes.position=n.attributes.position;let c=i.normal.clone().multiplyScalar(.01);this._outlinedMesh=new $e(this.mesh.geometry),this.mesh.position.copy(c),this._outlinedMesh.position.copy(c),this.visible=!0}get visible(){return this.mesh.parent!==null}set visible(e){let t=this.getStyleAndScene();if(e){if(this.world.scene.three.add(this.mesh),t){let{style:i,outlineScene:n}=t;this._outlinedMesh.material=i.material,i.meshes.add(this._outlinedMesh),n.add(this._outlinedMesh)}}else if(this.mesh.removeFromParent(),t){let{style:i}=t;i.meshes.delete(this._outlinedMesh),this._outlinedMesh.removeFromParent()}}set geometry(e){this._geometry=e,this.mesh.geometry.attributes.position=e.attributes.position}dispose(){let e=this.getStyleAndScene();if(e){let{style:t}=e;t.meshes.delete(this._outlinedMesh),this._outlinedMesh.removeFromParent()}this.mesh.material=[],this._outlinedMesh.material=[],this.mesh.userData.indexFragmentMap.clear(),this.mesh.userData={},this.mesh.geometry.dispose(),this.mesh.removeFromParent(),this.mesh.geometry=null,this._outlinedMesh.geometry=null,this.mesh=null,this._plane=null,this._geometry=null,this.components=null}update(e,t){let i=this._geometry.attributes.position.array;if(!i)return;this.updatePlane2DCoordinateSystem();let{userData:n}=this.mesh,r=n.indexFragmentMap;r.clear();let o=0,a=[],l=0,c=this.components.get(Rt);for(let[d,h]of t)for(let u in h){let p=c.list.get(u);p&&(p.mesh.userData.fills||(p.mesh.userData.fills=new Set),p.mesh.userData.fills.add(this.mesh))}for(let d=0;d<e.length;d++){let h=e[d],u=[];for(let g=l;g<h;g+=2)u.push(g*3);let p=this.computeFill(u,i),f=t.get(h),m=0;for(let g of p)a.push(g),f&&m%3===0&&r.set(o++,f),m++;l=h}this.mesh.geometry.setIndex(a)}computeFill(e,t){let i=new Map,n={},r=new Map,o=0,a=new Map,l=new Map,c=new Set,d=this._precission;for(let u=0;u<e.length;u++){let p=e[u],f=0,m=0,g=0,b=0,v=t[p],E=t[p+1],y=t[p+2],w=t[p+3],C=t[p+4],A=t[p+5];if(this._tempVector.set(v,E,y),this._tempVector.applyMatrix4(this._plane2DCoordinateSystem),f=Math.trunc(this._tempVector.x*d)/d,m=Math.trunc(this._tempVector.y*d)/d,this._tempVector.set(w,C,A),this._tempVector.applyMatrix4(this._plane2DCoordinateSystem),g=Math.trunc(this._tempVector.x*d)/d,b=Math.trunc(this._tempVector.y*d)/d,f===g&&m===b)continue;let D=`${f}|${m}`,M=`${g}|${b}`;i.has(D)||i.set(D,p/3),i.has(M)||i.set(M,p/3+1);let I=i.get(D),O=i.get(M);n[I]=[f,m],n[O]=[g,b];let F=l.has(I),V=a.has(I),x=l.has(O),N=a.has(O);if(!F&&!V&&!x&&!N)l.set(I,o),a.set(O,o),c.add(o),r.set(o,[I,O]),o++;else if(F&&N){let z=l.get(I),G=a.get(O);if(z!==G){let X=r.get(G),k=r.get(z);if(!X||!k)continue;r.delete(z),c.delete(z),a.set(k[k.length-1],G),a.delete(X[X.length-1]);for(let B of k)X.push(B)}else c.delete(G);l.delete(I),a.delete(O)}else if(V&&x){let z=l.get(O),G=a.get(I);if(z!==G){let X=r.get(G),k=r.get(z);if(!X||!k)continue;r.delete(z),c.delete(z),a.set(k[k.length-1],G),a.delete(X[X.length-1]);for(let B of k)X.push(B)}else c.delete(G);l.delete(O),a.delete(I)}else if(F&&x){let z=l.get(O),G=l.get(I),X=r.get(G),k=r.get(z);if(!X||!k)continue;r.delete(z),c.delete(z),l.delete(X[0]),l.delete(k[0]),a.delete(k[k.length-1]),l.set(k[k.length-1],G),k.reverse(),X.splice(0,0,...k)}else if(V&&N){let z=a.get(O),G=a.get(I),X=r.get(G),k=r.get(z);if(!X||!k)continue;r.delete(z),c.delete(z),a.delete(X[X.length-1]),a.delete(k[k.length-1]),l.delete(k[0]),a.set(k[0],G),k.reverse(),X.push(...k)}else if(F){let z=l.get(I),G=r.get(z);if(!G)continue;G.unshift(O),l.delete(I),l.set(O,z)}else if(V){let z=a.get(I),G=r.get(z);if(!G)continue;G.push(O),a.delete(I),a.set(O,z)}else if(x){let z=l.get(O),G=r.get(z);if(!G)continue;G.unshift(I),l.delete(O),l.set(I,z)}else if(N){let z=a.get(O),G=r.get(z);if(!G)continue;G.push(I),a.delete(O),a.set(I,z)}}let h=[];for(let[u,p]of r){if(c.has(u))continue;let f=[],m=new Map,g=0;for(let v of p){let E=n[v];f.push(E[0],E[1]),m.set(g++,v)}let b=wL(f);for(let v of b){let E=m.get(v);if(E===void 0)throw new Error("Map error!");h.push(E)}}return h}updatePlane2DCoordinateSystem(){this._plane2DCoordinateSystem=new lt;let e=new ce(1,0,0),t=new ce(0,1,0),i=this._plane.normal,n=new ce;this._plane.coplanarPoint(n),this._planeAxis==="x"?e.crossVectors(t,i):this._planeAxis==="y"?t.crossVectors(i,e):this._planeAxis==="z"||(e.crossVectors(t,i).normalize(),t.crossVectors(i,e)),this._plane2DCoordinateSystem.fromArray([e.x,e.y,e.z,0,t.x,t.y,t.z,0,i.x,i.y,i.z,0,n.x,n.y,n.z,1]),this._plane2DCoordinateSystem.invert()}getStyleAndScene(){if(!this.world.renderer)return null;let e=this.world.renderer instanceof si;if(this.styleName&&e){let t=this.world.renderer,i=t.postproduction.customEffects.outlinedMeshes[this.styleName],n=t.postproduction.customEffects.outlineScene;return{style:i,outlineScene:n}}return null}},ub=class{constructor(e,t,i){Z(this,"onDisposed",new Oe),Z(this,"onAfterUpdate",new Oe),Z(this,"onBeforeUpdate",new Oe),Z(this,"enabled",!0),Z(this,"fillNeedsUpdate",!1),Z(this,"components"),Z(this,"world"),Z(this,"_edges",{}),Z(this,"_visible",!0),Z(this,"_inverseMatrix",new lt),Z(this,"_localPlane",new Ws),Z(this,"_tempLine",new en),Z(this,"_tempVector",new ce),Z(this,"_plane"),this.components=e,this.world=t,this._plane=i}get visible(){return this._visible}set visible(e){this._visible=e;for(let t in this._edges){let i=this._edges[t];e?this.world.scene.three.add(i.mesh):i.mesh.removeFromParent(),i.fill&&(i.fill.visible=e)}}get fillMeshes(){let e=[];for(let t in this._edges){let i=this._edges[t];i.fill&&e.push(i.fill.mesh)}return e}update(){let e=this.components.get(Ul).styles.list;this.updateDeletedEdges(e);for(let t in e)this.drawEdges(t);this.fillNeedsUpdate=!1}get(){return this._edges}dispose(){let e=Object.keys(this._edges);for(let t of e)this.disposeEdge(t);this.onDisposed.trigger(),this.onDisposed.reset()}newEdgesMesh(e){let t=this.components.get(Ul).styles.list[e].lineMaterial,i=new kt,n=new Float32Array(3e5),r=new Ti(n,3,!1);r.setUsage(Vw),i.setAttribute("position",r);let o=new Ou(i,t);return o.frustumCulled=!1,o}newFillMesh(e,t){let i=this.components.get(Ul).styles.list[e],n=i.fillMaterial;if(n){let r=new db(this.components,this.world,this._plane,t,n);return this.newFillOutline(e,r,i),r}}newFillOutline(e,t,i){if(!i.outlineMaterial||!this.world.renderer)return;let n=this.world.renderer;if(n instanceof si){let r=n.postproduction.customEffects.outlinedMeshes;r[e]||(r[e]={meshes:new Set,material:i.outlineMaterial}),t.styleName=e}}drawEdges(e){let t=this.components.get(Ul).styles.list[e];this._edges[e]||this.initializeStyle(e);let i=this._edges[e],n=0,r=i.mesh.geometry.attributes.position;r.array.fill(0);let o=[],a=0,l=new Map;for(let d of t.meshes)if(d.geometry){if(!d.geometry.boundsTree)throw new Error("Bounds tree not found for clipping edges subset.");if(d instanceof Jn){if(d.count===0)continue;let h=d;for(let u=0;u<h.count;u++){let p=h instanceof Fu,f=h,m=t.fragments[f.fragment.id];if(p&&m){let v=f.fragment.getItemID(u);if(v===null||!m.has(v))continue}let g=new $e(d.geometry);g.matrix.copy(d.matrix);let b=new lt;if(h.getMatrixAt(u,b),g.applyMatrix4(b),g.applyMatrix4(d.matrixWorld),g.updateMatrix(),g.updateMatrixWorld(),this._inverseMatrix.copy(g.matrixWorld).invert(),this._localPlane.copy(this._plane).applyMatrix4(this._inverseMatrix),n=this.shapecast(g,r,n),n!==a){if(p&&m){let v=f.fragment.getItemID(u);v!==null&&l.set(n,{[f.fragment.id]:new Set([v])})}o.push(n),a=n}}}else this._inverseMatrix.copy(d.matrixWorld).invert(),this._localPlane.copy(this._plane).applyMatrix4(this._inverseMatrix),n=this.shapecast(d,r,n),n!==a&&(o.push(n),a=n)}i.mesh.geometry.setDrawRange(0,n),i.mesh.position.copy(this._plane.normal).multiplyScalar(1e-4),r.needsUpdate=!0;let c=i.mesh.geometry.attributes.position;Number.isNaN(c.array[0])||this.fillNeedsUpdate&&i.fill&&(i.fill.geometry=i.mesh.geometry,i.fill.update(o,l),i.fill.visible=this._visible)}initializeStyle(e){let t=this.newEdgesMesh(e),i=t.geometry,n=this.newFillMesh(e,i);this._edges[e]={mesh:t,name:e,fill:n}}shapecast(e,t,i){return e.geometry.boundsTree.shapecast({intersectsBounds:n=>this._localPlane.intersectsBox(n),intersectsTriangle:n=>{let r=0;if(this._tempLine.start.copy(n.a),this._tempLine.end.copy(n.b),this._localPlane.intersectLine(this._tempLine,this._tempVector)){let o=this._tempVector.applyMatrix4(e.matrixWorld);t.setXYZ(i,o.x,o.y,o.z),r++,i++}if(this._tempLine.start.copy(n.b),this._tempLine.end.copy(n.c),this._localPlane.intersectLine(this._tempLine,this._tempVector)){let o=this._tempVector.applyMatrix4(e.matrixWorld);t.setXYZ(i,o.x,o.y,o.z),r++,i++}if(this._tempLine.start.copy(n.c),this._tempLine.end.copy(n.a),this._localPlane.intersectLine(this._tempLine,this._tempVector)){let o=this._tempVector.applyMatrix4(e.matrixWorld);t.setXYZ(i,o.x,o.y,o.z),r++,i++}r!==2&&(i-=r)}}),i}updateDeletedEdges(e){let t=Object.keys(this._edges);for(let i of t)e[i]===void 0&&(this.disposeEdge(i),this.disposeOutline(i))}disposeOutline(e){if(!this.world.renderer)return;let t=this.world.renderer;if(t instanceof si){let i=t.postproduction.customEffects.outlinedMeshes;delete i[e]}}disposeEdge(e){let t=this.components.get(nr),i=this._edges[e];i.fill&&i.fill.dispose(),t.destroy(i.mesh,!1),delete this._edges[e]}},go=class extends Dp{constructor(e,t,i,n,r,o=5,a=!0){super(e,t,i,n,r,o,a),Z(this,"edges"),Z(this,"edgesMaxUpdateRate",50),Z(this,"_visible",!0),Z(this,"_edgesVisible",!0),Z(this,"updateFill",()=>{this.edges.fillNeedsUpdate=!0,this.edges.update()}),this.edges=new ub(e,t,this.three),this.toggleControls(!0),this.edges.visible=!0,this.onDraggingEnded.add(()=>{this.updateFill(),this.edges.visible=!0}),this.onDraggingStarted.add(()=>this.edges.visible=!1)}get visible(){return this._visible}set visible(e){super.visible=e,this.toggleControls(e)}set enabled(e){this._enabled=e,this.world.renderer&&this.world.renderer.setPlane(e,this.three)}get enabled(){return super.enabled}dispose(){super.dispose(),this.edges.dispose()}},pb=class{constructor(){Z(this,"onDisposed",new Oe),Z(this,"enabled",!0),Z(this,"list",{}),Z(this,"_defaultLineMaterial",new Mn({color:0,linewidth:.001})),Z(this,"onAfterUpdate",new Oe),Z(this,"onBeforeUpdate",new Oe)}update(e){this.onBeforeUpdate.trigger(this.list),this.onAfterUpdate.trigger(this.list)}create(e,t,i,n,r,o){if(!i.renderer)throw new Error("The given world doesn't have a renderer!");n||(n=this._defaultLineMaterial);for(let c of t)c.geometry.boundsTree||c.geometry.computeBoundsTree();let a=i.renderer;n.clippingPlanes=a.clippingPlanes;let l={name:e,lineMaterial:n,meshes:t,fillMaterial:r,outlineMaterial:o,fragments:{}};return this.list[e]=l,l}dispose(){let e=Object.keys(this.list);for(let t of e)this.deleteStyle(t);this.list={},this.onDisposed.trigger(),this.onDisposed.reset()}deleteStyle(e,t=!0){var i,n;let r=this.list[e];r&&(r.meshes.clear(),t&&(r.lineMaterial.dispose(),(i=r.fillMaterial)==null||i.dispose(),(n=r.outlineMaterial)==null||n.dispose())),delete this.list[e]}},UC=class BC extends At{constructor(e){super(e),Z(this,"onDisposed",new Oe),Z(this,"enabled",!0),Z(this,"styles"),Z(this,"fillsNeedUpdate",!1),Z(this,"_visible",!0),this.components.list.set(BC.uuid,this),this.styles=new pb}get visible(){return this._visible}set visible(e){this._visible=e;let t=this.components.get(Bl);for(let i of t.list)i instanceof go&&(i.edges.visible=e)}dispose(){this.styles.dispose(),this.onDisposed.trigger()}update(e=!1){return ie(this,null,function*(){if(!this.enabled)return;let t=this.components.get(Bl);for(let i of t.list)i instanceof go&&(e||this.fillsNeedUpdate?i.updateFill():i.update());this.fillsNeedUpdate=!1})}};Z(UC,"uuid","24dfc306-a3c4-410f-8071-babc4afa5e4d");var Ul=UC,LL={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},FL={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`},kL=class Dl extends At{constructor(e){super(e),Z(this,"onDisposed",new Oe),Z(this,"enabled",!0),Z(this,"cameraHeight",10),Z(this,"darkness",1.2),Z(this,"opacity",1),Z(this,"resolution",512),Z(this,"amount",3.5),Z(this,"planeColor",16777215),Z(this,"shadowOffset",0),Z(this,"shadowExtraScaleFactor",1.5),Z(this,"list",{}),Z(this,"tempMaterial",new Ii({visible:!1})),Z(this,"depthMaterial",new gg),this.components.add(Dl.uuid,this),this.initializeDepthMaterial()}dispose(){for(let e in this.list)this.deleteShadow(e);this.tempMaterial.dispose(),this.depthMaterial.dispose(),this.components=null,this.onDisposed.trigger(Dl.uuid),this.onDisposed.reset()}create(e,t,i){if(this.list[t])throw new Error(`There is already a shadow with ID ${t}`);let{size:n,center:r,min:o}=this.getSizeCenterMin(e),a=this.createShadow(t,n,i);return this.initializeShadow(a,r,o),this.createPlanes(a,n),this.bakeShadow(e,a),a.root}deleteShadow(e){let t=this.components.get(nr),i=this.list[e];if(delete this.list[e],!i)throw new Error(`No shadow with ID ${e} was found.`);t.destroy(i.root),t.destroy(i.blurPlane),i.rt.dispose(),i.rtBlur.dispose()}createPlanes(e,t){let i=new hl(t.x,t.z).rotateX(Math.PI/2);this.createBasePlane(e,i),Dl.createBlurPlane(e,i)}initializeShadow(e,t,i){this.initializeRoot(e,t,i),Dl.initializeRenderTargets(e),Dl.initializeCamera(e)}bakeShadow(e,t){let i=t.world.scene.three;if(!(i instanceof to))throw new Error("The core of the scene of the world must be a scene!");if(!t.world.renderer)throw new Error("The given world must have a renderer!");let n=t.world.renderer.three,r=e.map(c=>!!c.parent);for(let c=0;c<e.length;c++)r[c]||i.add(e[c]);let o=i.children.filter(c=>!e.includes(c)&&c!==t.root);for(let c=o.length-1;c>=0;c--)i.remove(o[c]);let a=i.background;i.background=null,i.overrideMaterial=this.depthMaterial;let l=[];for(let c of e)l.push(c.visible),c.visible=!0;n.setRenderTarget(t.rt),n.render(i,t.camera),i.overrideMaterial=null,this.blurShadow(t,this.amount),this.blurShadow(t,this.amount*.4),n.setRenderTarget(null),i.background=a;for(let c=0;c<e.length;c++)e[c].visible=l[c];for(let c=o.length-1;c>=0;c--)i.add(o[c]);for(let c=0;c<e.length;c++)r[c]||i.remove(e[c])}static initializeCamera(e){e.camera.rotation.x=Math.PI/2,e.root.add(e.camera)}static initializeRenderTargets(e){e.rt.texture.generateMipmaps=!1,e.rtBlur.texture.generateMipmaps=!1}initializeRoot(e,t,i){let n=e.world.scene.three;e.root.position.set(t.x,i.y-this.shadowOffset,t.z),n.add(e.root)}createBasePlane(e,t){let i=this.createPlaneMaterial(e),n=new $e(t,i);n.renderOrder=2,e.root.add(n),n.scale.y=-1}static createBlurPlane(e,t){e.blurPlane.geometry=t,e.blurPlane.visible=!1,e.root.add(e.blurPlane)}createPlaneMaterial(e){if(!e.world.renderer)throw new Error("The given world must have a renderer!");let t=e.world.renderer.three;return new Ii({map:e.rt.texture,opacity:this.opacity,transparent:!0,depthWrite:!1,clippingPlanes:t.clippingPlanes})}initializeDepthMaterial(){this.depthMaterial.depthTest=!1,this.depthMaterial.depthWrite=!1;let e="gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );",t="gl_FragColor = vec4( vec3( 0.0 ), ( 1.0 - fragCoordZ ) * darkness );";this.depthMaterial.userData.darkness={value:this.darkness},this.depthMaterial.onBeforeCompile=i=>{i.uniforms.darkness=this.depthMaterial.userData.darkness,i.fragmentShader=`
						uniform float darkness;
						${i.fragmentShader.replace(e,t)}
					`}}createShadow(e,t,i){return this.list[e]={root:new qs,world:i,rt:new Ss(this.resolution,this.resolution),rtBlur:new Ss(this.resolution,this.resolution),blurPlane:new $e,camera:this.createCamera(t)},this.list[e]}createCamera(e){return new Ys(-e.x/2,e.x/2,e.z/2,-e.z/2,0,this.cameraHeight)}getSizeCenterMin(e){let t=e[0].parent,i=new qs;i.children=e;let n=new Qt().setFromObject(i);t?.add(...e);let r=new ce;n.getSize(r),r.x*=this.shadowExtraScaleFactor,r.z*=this.shadowExtraScaleFactor;let o=new ce;n.getCenter(o);let a=n.min;return{size:r,center:o,min:a}}blurShadow(e,t){if(!e.world.renderer)throw new Error("The given world must have a renderer!");let i=new Ni(LL);i.depthTest=!1;let n=new Ni(FL);n.depthTest=!1,e.blurPlane.visible=!0,e.blurPlane.material=i,e.blurPlane.material.uniforms.tDiffuse.value=e.rt.texture,i.uniforms.h.value=t*1/256;let r=e.world.renderer.three;r.setRenderTarget(e.rtBlur),r.render(e.blurPlane,e.camera),e.blurPlane.material=n,e.blurPlane.material.uniforms.tDiffuse.value=e.rtBlur.texture,n.uniforms.v.value=t*1/256,r.setRenderTarget(e.rt),r.render(e.blurPlane,e.camera),e.blurPlane.visible=!1}};Z(kL,"uuid","f833a09a-a3ab-4c58-b03e-da5298c7a1b6");var NL=["Station","Radius","Length","InitialKP","FinalKP","KP","Slope","Height","InitialKPV","FinalKPV"],zC=class VC extends At{constructor(e){super(e),Z(this,"enabled",!0),Z(this,"world",null),Z(this,"_markerKey",0),Z(this,"_list",new Map),Z(this,"type","horizontal"),Z(this,"divisionLength",100),e.add(VC.uuid,this)}addKPStation(e,t,i){let n=this.components.get(ua),r=document.createElement("div"),o=document.createElement("div");r.appendChild(o),o.innerHTML=t,o.style.color=n.color,o.style.borderBottom="1px dotted white",o.style.width="160px",o.style.textAlign="left";let a=new vn(e,r),l=new ce;l.x=i.geometry.attributes.position.getX(i.geometry.attributes.position.count-1),l.y=i.geometry.attributes.position.getY(i.geometry.attributes.position.count-1),l.z=i.geometry.attributes.position.getZ(i.geometry.attributes.position.count-1);let c=new ce;c.x=i.geometry.attributes.position.getX(i.geometry.attributes.position.count-2),c.y=i.geometry.attributes.position.getY(i.geometry.attributes.position.count-2),c.z=i.geometry.attributes.position.getZ(i.geometry.attributes.position.count-2);let d=new ce;d.x=(l.x+c.x)/2,d.y=(l.y+c.y)/2,d.z=(l.z+c.z)/2,a.three.position.copy(d);let h=new ce;h.subVectors(l,c).normalize();let u=new On;u.setFromUnitVectors(new ce(0,1,0),h);let p=new Pu().setFromQuaternion(u).z,f=_r.radToDeg(p);o.style.transform=`rotate(${-f-90}deg) translate(-35%, -50%)`;let m=this._markerKey.toString();n.setupEvents(e,!0),n.getWorldMarkerList(e).set(m,{label:a,key:m,merged:!1,static:!1}),this._markerKey++,this.save(m,"KP")}addVerticalMarker(e,t,i,n,r){let o=this.components.get(ua),a=document.createElement("span");a.innerHTML=t,a.style.color=o.color;let l=new vn(e,a,r);if(n==="Height"){let d=document.createElement("span");d.innerHTML=t,d.style.color=o.color;let{position:h}=i.geometry.attributes,u=(h.array.length/3-1)*3,p=h.array.slice(u,u+3);l.three.position.set(p[0],p[1]+10,p[2])}else if(n==="InitialKPV"){let{position:d}=i.geometry.attributes,h=d.getX(0),u=d.getY(0),p=d.getZ(0);l.three.position.set(h-20,u,p)}else if(n==="FinalKPV"){let{position:d}=i.geometry.attributes,h=d.getX(i.geometry.attributes.position.count-1),u=d.getY(i.geometry.attributes.position.count-1),p=d.getZ(i.geometry.attributes.position.count-1);l.three.position.set(h+20,u,p)}else if(n==="Slope"){a.style.color="grey";let{position:d}=i.geometry.attributes,h=new ce;h.x=d.getX(0),h.y=d.getY(0),h.z=d.getZ(0);let u=new ce;u.x=d.getX(d.count-1),u.y=d.getY(d.count-1),u.z=d.getZ(d.count-1);let p=new ce;p.addVectors(h,u).multiplyScalar(.5),l.three.position.set(p.x,p.y-10,p.z)}let c=this._markerKey.toString();return o.setupEvents(e,!0),o.getWorldMarkerList(e).set(c,{label:l,key:c,type:n,merged:!1,static:!1}),this._markerKey++,this.save(c,n),l}addCivilMarker(e,t,i,n){let r=this.components.get(ua),o=document.createElement("span");o.innerHTML=t,o.style.color=r.color;let a=new vn(e,o);if(n==="InitialKP"){let c=i.geometry.attributes.position.getX(0),d=i.geometry.attributes.position.getY(0),h=i.geometry.attributes.position.getZ(0);a.three.position.set(c+2,d+2,h)}else if(n==="FinalKP"){let c=i.geometry.attributes.position.getX(i.geometry.attributes.position.count-1),d=i.geometry.attributes.position.getY(i.geometry.attributes.position.count-1),h=i.geometry.attributes.position.getZ(i.geometry.attributes.position.count-1);a.three.position.set(c+2,d-2,h)}else if(n==="Length"){let c=new ce;c.x=i.geometry.attributes.position.getX(0),c.y=i.geometry.attributes.position.getY(0),c.z=i.geometry.attributes.position.getZ(0);let d=new ce;d.x=i.geometry.attributes.position.getX(i.geometry.attributes.position.count-1),d.y=i.geometry.attributes.position.getY(i.geometry.attributes.position.count-1),d.z=i.geometry.attributes.position.getZ(i.geometry.attributes.position.count-1);let h=c.distanceTo(d);a.three.element.innerText=h.toFixed(2);let u=d.clone().add(c).divideScalar(2);a.three.position.copy(u)}let l=this._markerKey.toString();return r.setupEvents(e,!0),r.getWorldMarkerList(e).set(l,{label:a,key:l,type:n,merged:!1,static:!1}),this._markerKey++,this.save(l,n),a}showKPStations(e){if(!this.world)throw new Error("A world is needed for this component to work!");if(this.type==="horizontal"){let t=this.generateStartAndEndKP(e);for(let[,n]of t)this.addKPStation(this.world,n.value,n.normal);let i=this.generateConstantKP(e);for(let[,n]of i)this.addKPStation(this.world,n.value,n.normal)}}showCurveLength(e,t){if(!this.world)throw new Error("A world is needed for this component to work!");let i=this.components.get(ua),n=e.length,r=`${t.toFixed(2)} m`,o=Math.round(n/2),a=e[o],l=i.create(this.world,r,a,!0);l!==void 0&&this.save(l,"Radius")}showLineLength(e,t){if(!this.world)throw new Error("A world is needed for this component to work!");let i=this.components.get(ua),n=new ce;n.x=e.geometry.getAttribute("position").getX(0),n.y=e.geometry.getAttribute("position").getY(0),n.z=e.geometry.getAttribute("position").getZ(0);let r=new ce;r.x=e.geometry.getAttribute("position").getX(1),r.y=e.geometry.getAttribute("position").getY(1),r.z=e.geometry.getAttribute("position").getZ(1);let o=`${t.toFixed(2)} m`,a=new ce;a.addVectors(n,r).multiplyScalar(.5);let l=i.create(this.world,o,a,!0);l!==void 0&&this.save(l,"Radius")}showCurveRadius(e,t){if(!this.world)throw new Error("A world is needed for this component to work!");let i=this.components.get(ua),n=new ce;n.x=e.geometry.getAttribute("position").getX(0),n.y=e.geometry.getAttribute("position").getY(0),n.z=e.geometry.getAttribute("position").getZ(0);let r=new ce;r.x=e.geometry.getAttribute("position").getX(1),r.y=e.geometry.getAttribute("position").getY(1),r.z=e.geometry.getAttribute("position").getZ(1);let o=`R = ${t.toFixed(2)} m`,a=new ce;a.addVectors(n,r).multiplyScalar(.5);let l=i.create(this.world,o,a,!0);l!==void 0&&this.save(l,"Radius")}deleteByType(e=NL){let t=this.components.get(ua);for(let i of e){let n=this._list.get(i);if(n){for(let r of n)t.delete(r);this._list.delete(i)}}}generateStartAndEndKP(e){let{alignment:t}=e.curve,i=new Map;for(let n of t.horizontal){let r=n.getLength();if(i.size>0){let o=n.index-1,a=i.get(o).distance+r,l=n.mesh.geometry.getAttribute("position"),c=l.count-1,d=new ce;d.x=l.getX(c),d.y=l.getY(c),d.z=l.getZ(c);let h=this.createNormalLine(n.mesh);i.set(n.index,{value:this.getShortendKPValue(a),distance:a,point:d,normal:h})}else{let o=n.mesh.geometry.getAttribute("position"),a=o.count-1,l=new ce;l.x=o.getX(a),l.y=o.getY(a),l.z=o.getZ(a);let c=this.createNormalLine(n.mesh);i.set(n.index,{value:this.getShortendKPValue(r),distance:r,point:l,normal:c})}}return i}createNormalLine(e){let t=e.geometry.attributes.position.count-1,i=t-1,n=new ce;n.x=e.geometry.attributes.position.getX(t),n.y=e.geometry.attributes.position.getY(t),n.z=e.geometry.attributes.position.getZ(t);let r=new ce;r.x=e.geometry.attributes.position.getX(i),r.y=e.geometry.attributes.position.getY(i),r.z=e.geometry.attributes.position.getZ(i);let o=new ce().subVectors(n,r).clone().applyAxisAngle(new ce(0,0,1),Math.PI*.5).normalize(),a=new kt().setFromPoints([o.clone().setLength(10).add(n),o.clone().setLength(-10).add(n)]);return new _i(a)}generateConstantKP(e){let{alignment:t}=e.curve,i=new Map,n=t.getLength("horizontal"),r=Math.floor(n/this.divisionLength);for(let o=0;o<r;o++){let a=o/r,l=t.getPointAt(a,"horizontal"),c=n*a,d=this.getNormal(t,l);i.set(o,{value:this.getShortendKPValue(c),distance:c,point:l,normal:d})}return i}getNormal(e,t){let i=[],n={start:new ce,end:new ce};for(let a=0;a<e.horizontal.length;a++){let l=e.horizontal[a].mesh.geometry.attributes.position,c=l.count;for(let d=0;d<c;d++){let h=l.getX(d),u=l.getY(d),p=l.getZ(d);i.push(new ce(h,u,p))}}for(let a=0;a<i.length-1;a++){let l=i[a],c=i[a+1],d=l.distanceTo(t),h=c.distanceTo(t),u=l.distanceTo(c);Math.abs(d+h-u)<1e-5&&(n.start=l,n.end=c)}let r=new ce().subVectors(n.end,n.start).clone().applyAxisAngle(new ce(0,0,1),Math.PI*.5).normalize(),o=new kt().setFromPoints([r.clone().setLength(10).add(t),r.clone().setLength(-10).add(t)]);return new _i(o,new Mn({color:16711680}))}getShortendKPValue(e){let t=e.toFixed(2),[i,n]=t.toString().split("."),r=n||"00";if(parseInt(i,10)>1e3&&parseInt(i,10)<1e4){let[o,...a]=i;return`${o}+${a.join("")}.${r}`}if(parseInt(i,10)>1e4){let[o,a,...l]=i;return`${o}${a}+${l.join("")}.${r}`}return`0+${i.padStart(3,"0")}.${r}`}save(e,t){this._list.has(t)||this._list.set(t,new Set),this._list.get(t).add(e)}};Z(zC,"uuid","0af12c32-81ee-4100-a030-e9ae546f6170");var Oh=zC,Wp=class extends At{constructor(e){super(e),Z(this,"onHighlight",new Oe),Z(this,"onMarkerChange",new Oe),Z(this,"onMarkerHidden",new Oe),Z(this,"onDisposed",new Oe),Z(this,"enabled",!0),Z(this,"mouseMarkers"),Z(this,"_curves",[]),Z(this,"_previousAlignment",null),Z(this,"_highlighter"),Z(this,"_world",null),Z(this,"updateLinesResolution",t=>{var i;(i=this._highlighter)==null||i.setResolution(t)}),Z(this,"onMouseMove",t=>{var i,n,r;if(!this._world)throw new Error("No world was given for this navigator!");if(!this._world.renderer)return;let o=this._world.renderer.three.domElement.parentElement,a=this._world.camera.three,l=(i=this._highlighter)==null?void 0:i.castRay(t,a,o,this._curves);if(l){let{object:c}=l;(n=this._highlighter)==null||n.hover(c),this.updateMarker(l,"hover");return}this.mouseMarkers&&(this.mouseMarkers.hover.visible=!1),(r=this._highlighter)==null||r.unHover(),this.onMarkerHidden.trigger({type:"hover"})}),Z(this,"onClick",t=>{var i,n;if(!this._world)throw new Error("No world was given for this navigator!");if(!this._world.renderer)return;let r=this._world.renderer.three.domElement.parentElement,o=this._world.camera.three,a=(i=this._highlighter)==null?void 0:i.castRay(t,o,r,this._curves);if(a){let l=a,c=l.object;if((n=this._highlighter)==null||n.select(c),this.updateMarker(l,"select"),this._world.camera.hasCameraControls()&&(c.geometry.boundingBox||c.geometry.computeBoundingBox(),c.geometry.boundingBox)){let d=this.getScaledBox(c.geometry.boundingBox,2);this._world.camera.controls.fitToBox(d,!0)}this.onHighlight.trigger({mesh:c,point:l.point}),this._previousAlignment!==c.curve.alignment&&(this.components.get(Oh).showKPStations(c),this._previousAlignment=c.curve.alignment)}}),Z(this,"onControlsUpdated",()=>{if(!this._world)throw new Error("No world was given for this navigator!");if(!(this._world.camera.three instanceof Ys)||!this._highlighter)return;let{zoom:t,left:i,right:n,top:r,bottom:o}=this._world.camera.three,a=i-n,l=r-o,c=Math.max(a,l)/t,d=40,{caster:h}=this._highlighter;h.params.Line.threshold=c/d})}get highlighter(){if(!this._highlighter)throw new Error("Highlighter not initialized. You must set a world first!");return this._highlighter}get world(){return this._world}set world(e){var t,i,n;if(e===this._world||(this._world&&this.setupEvents(!1),this._world=e,(t=this._highlighter)==null||t.dispose(),(i=this.mouseMarkers)==null||i.hover.dispose(),(n=this.mouseMarkers)==null||n.select.dispose(),!e))return;let r=e.scene.three;this._highlighter=new PC(r,this.view),this.mouseMarkers={select:this.newMouseMarker("#ffffff",e),hover:this.newMouseMarker("#575757",e)},this.setupEvents(!0)}draw(e,t){return ie(this,null,function*(){if(!e.civilData)throw new Error("The provided model doesn't have civil data!");if(!this._world)throw new Error("No world was given for this navigator!");let{alignments:i}=e.civilData,n=t||i.values(),r=this._world.scene.three,o=new Qt;o.makeEmpty(),o.min.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o.max.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let l of n){if(!l)throw new Error("Alignment not found!");for(let c of l[this.view])if(r.add(c.mesh),this._curves.push(c.mesh),!o.isEmpty())o.expandByObject(c.mesh);else{c.mesh.geometry.computeBoundingBox();let d=c.mesh.geometry.boundingBox;d instanceof Qt&&o.copy(d).applyMatrix4(c.mesh.matrixWorld)}}let a=this.getScaledBox(o,1.2);this._world.camera.hasCameraControls()&&(yield this._world.camera.controls.fitToBox(a,!1))})}dispose(){return ie(this,null,function*(){var e;(e=this._highlighter)==null||e.dispose(),this.clear(),this.onHighlight.reset(),this._curves=[],this.onDisposed.trigger(),this.onDisposed.reset()})}clear(){var e,t;(e=this._highlighter)==null||e.unSelect(),(t=this._highlighter)==null||t.unHover();for(let i of this._curves)i.removeFromParent();this._curves=[]}setMarker(e,t,i){if(!this._curves.length)return;let n=e.getCurveAt(t,this.view),r=e.getPointAt(t,this.view),{index:o}=n.curve.getSegmentAt(n.percentage);this.setMouseMarker(r,n.curve.mesh,o,i)}setDefSegments(e){let t=[],i=[],n=(r,o)=>{let a=o[1]-r[1],l=o[0]-r[0];return a/l};for(let r=0;r<e.length;r++){let o=e[r],a,l,c,d;for(let u=0;u<Object.keys(o).length/3;u++)if(o[u*3]!==void 0&&o[u*3+1]!==void 0){a=o[u*3],l=o[u*3+1];break}for(let u=Object.keys(o).length/3-1;u>=0;u--)if(o[u*3]!==void 0&&o[u*3+1]!==void 0){c=o[u*3],d=o[u*3+1];break}let h=(n([a,l],[c,d])*100).toFixed(2);i.push({slope:h})}for(let r of e)for(let o=0;o<r.length-3;o+=3){let a=r[o],l=r[o+1],c=r[o+2],d=r[o+3],h=r[o+4],u=r[o+5];t.push({start:new ce(a,l,c),end:new ce(d,h,u)})}return{defSegments:t,slope:i}}hideMarker(e){this.mouseMarkers&&(this.mouseMarkers[e].visible=!1)}setupEvents(e){var t,i;if(!this._world)throw new Error("No world was given for this navigator!");if(this._world.isDisposing||!this._world.renderer)return;let n=this._world.renderer.three.domElement.parentElement;(t=this._world.renderer)==null||t.onResize.remove(this.updateLinesResolution),n.removeEventListener("pointermove",this.onMouseMove),n.removeEventListener("click",this.onClick),this._world.camera.hasCameraControls()&&this._world.camera.controls.removeEventListener("update",this.onControlsUpdated),e&&(n.addEventListener("pointermove",this.onMouseMove),n.addEventListener("click",this.onClick),(i=this._world.renderer)==null||i.onResize.add(this.updateLinesResolution),this._world.camera.hasCameraControls()&&this._world.camera.controls.addEventListener("update",this.onControlsUpdated))}newMouseMarker(e,t){if(!this._world)throw new Error("No world was given for this navigator!");let i=t.scene.three,n=document.createElement("div"),r=document.createElement("div");n.appendChild(r),r.style.backgroundColor=e,r.style.width="3rem",r.style.height="3px";let o=new vn(this._world,n,i);return o.visible=!1,o}setMouseMarker(e,t,i,n){if(i===void 0||!this.mouseMarkers)return;this.mouseMarkers[n].visible=!0;let r=this.mouseMarkers[n].three;r.position.copy(e);let o=t,{startPoint:a,endPoint:l}=o.curve.getSegment(i),c=Math.atan2(l.y-a.y,l.x-a.x),d=r.element.children[0],h=90-c/Math.PI*180;d.style.transform=`rotate(${h}deg)`}updateMarker(e,t){let{point:i,index:n,object:r}=e,o=r,a=o.curve,l=o.curve.alignment,c=l.getPercentageAt(i,this.view),d=i.clone();this.setMouseMarker(d,o,n,t),c!==null&&this.onMarkerChange.trigger({alignment:l,percentage:c,type:t,curve:a})}getScaledBox(e,t){let i=new Qt,n=new ce,r=new ce;return e.getCenter(r),e.getSize(n),n.multiplyScalar(t),i.setFromCenterAndSize(r,n),i}},fb=class{constructor(e,t,i){Z(this,"components"),Z(this,"_scene"),Z(this,"_world"),Z(this,"offset",10),Z(this,"markupLines",[]),Z(this,"currentCurveMesh"),Z(this,"markupMaterial",new Mn({color:6842472})),this.components=e,this._scene=t,this._world=i}showCurveInfo(e){switch(this.disposeMarkups(),this.currentCurveMesh=e,e.curve.data.TYPE){case"LINE":this.showLineInfo(e,this.offset);break;case"CIRCULARARC":this.showCircularArcInfo(e,this.offset);break;case"CLOTHOID":this.showClothoidInfo(e,this.offset);break;default:console.log("Unknown curve type:",e.curve.data.TYPE);break}}updateOffset(e,t,i){let n=Math.max(e.height,e.width)/(t*150);n!==this.offset&&(this.offset=n,i&&this.currentCurveMesh&&this.showCurveInfo(this.currentCurveMesh))}dispose(){for(let e of this.markupLines)e.removeFromParent();this.disposeMarkups(),this.markupMaterial.dispose()}disposeMarkups(){for(let e of this.markupLines)e.geometry.dispose(),e.removeFromParent();this.markupLines=[]}unSelect(){this.disposeMarkups()}calculateTangent(e,t){let i=t*3,n=Math.max(0,i-3),r=Math.min(e.length-3,i+3),o=new ce().fromArray(e,n);return new ce().fromArray(e,r).clone().sub(o).normalize()}calculateParallelCurve(e,t,i){let n=[];for(let r=0;r<t;r++){let o=this.calculateTangent(e,r).clone().applyAxisAngle(new ce(0,0,1),Math.PI/2);o.normalize();let a=o.clone().multiplyScalar(i),l=r*3,c=new ce().fromArray(e,l).add(a);n.push(c)}return n}calculateDimensionLines(e,t){let i=[],n=e.geometry.attributes.position.array,r=t.geometry.attributes.position.array;if(n.length<6&&r.length<6)throw new Error("Line must have at least two vertices");let o=new ce(n[0],n[1],n[2]),a=new ce(r[0],r[1],r[2]),l=[],c=n.length-3,d=new ce(n[c],n[c+1],n[c+2]),h=r.length-3,u=new ce(r[h],r[h+1],r[h+2]);return i.push(o,a),l.push(d,u),{startDimensionPoints:i,endDimensionPoints:l}}offsetDimensionLine(e,t){let i=new ce().copy(e[e.length-1]).sub(e[0]).normalize().clone().multiplyScalar(t);return e.map(n=>n.clone().add(i))}showLineInfo(e,t){let i=this.components.get(Oh);i.world=this._world,i.deleteByType(["Length","Radius"]);let n=e.geometry.attributes.position.array,r=this.calculateParallelCurve(n,n.length/3,t),o=new kt().setFromPoints(r),a=new _i(o,this.markupMaterial);i.showLineLength(a,e.curve.getLength()),this._scene.add(a),this.markupLines.push(a);let{startDimensionPoints:l,endDimensionPoints:c}=this.calculateDimensionLines(e,a),d=this.offsetDimensionLine(l,t*.1),h=this.offsetDimensionLine(c,t*.1),u=new kt().setFromPoints(d),p=new kt().setFromPoints(h),f=new _i(u,this.markupMaterial);this._scene.add(f),this.markupLines.push(f);let m=new _i(p,this.markupMaterial);this._scene.add(m),this.markupLines.push(m)}showClothoidInfo(e,t){let i=this.components.get(Oh);i.world=this._world,i.deleteByType(["Length","Radius"]);let n=e.geometry.attributes.position.array,r=this.calculateParallelCurve(n,n.length/3,t),o=new kt().setFromPoints(r);i.showCurveLength(r,e.curve.getLength());let a=new _i(o,this.markupMaterial);this._scene.add(a),this.markupLines.push(a);let{startDimensionPoints:l,endDimensionPoints:c}=this.calculateDimensionLines(e,a),d=this.offsetDimensionLine(l,t*.1),h=this.offsetDimensionLine(c,t*.1),u=new kt().setFromPoints(d),p=new kt().setFromPoints(h),f=new _i(u,this.markupMaterial);this._scene.add(f),this.markupLines.push(f);let m=new _i(p,this.markupMaterial);this._scene.add(m),this.markupLines.push(m)}showCircularArcInfo(e,t){let i=this.components.get(Oh);i.world=this._world,i.deleteByType(["Length","Radius"]);let n=e.curve.data.RADIUS,r=e.geometry.attributes.position.array,o=e.geometry.attributes.position.count,a=[],l=new ce(r[0],r[1],r[2]),c=(o-1)*3,d=new ce(r[c],r[c+1],r[c+2]),h=o/2*3,u=new ce(r[h],r[h+1],r[h+2]),p=d.clone().sub(l).normalize(),f=new ce(-p.y,p.x,0);f.multiplyScalar(n);let m=u.clone().add(f);a.push(u),a.push(m);let g=new kt().setFromPoints(a),b=new _i(g,this.markupMaterial);i.showCurveRadius(b,Math.abs(n)),this._scene.add(b),this.markupLines.push(b);let v=[];for(let V=0;V<o;V++){let x=this.calculateTangent(r,V),N=e.curve.data.RADIUS,z=new ce(x.y,-x.x,0);z.normalize(),N<0&&z.negate();let G=z.clone().multiplyScalar(t),X=V*3,k=new ce(r[X]+G.x,r[X+1]+G.y,r[X+2]+G.z);v.push(k)}let E=new kt().setFromPoints(v);i.showCurveLength(v,e.curve.getLength());let y=new _i(E,this.markupMaterial);this._scene.add(y),this.markupLines.push(y);let{startDimensionPoints:w,endDimensionPoints:C}=this.calculateDimensionLines(e,y),A=this.offsetDimensionLine(w,t*.1),D=this.offsetDimensionLine(C,t*.1),M=new kt().setFromPoints(A),I=new kt().setFromPoints(D),O=new _i(M,this.markupMaterial);this._scene.add(O),this.markupLines.push(O);let F=new _i(I,this.markupMaterial);this._scene.add(F),this.markupLines.push(F)}},UL=class jC extends Wp{constructor(e){super(e),Z(this,"view","horizontal"),Z(this,"planHighlighter"),this.components.add(jC.uuid,this),this.onHighlight.add(({mesh:t})=>{!this._highlighter||!this.planHighlighter||this.planHighlighter.showCurveInfo(t)})}get world(){return super.world}set world(e){var t;super.world=e,e&&((t=this.planHighlighter)==null||t.dispose(),this.planHighlighter=new fb(this.components,e.scene.three,e))}};Z(UL,"uuid","3096dea0-5bc2-41c7-abce-9089b6c9431b");var BL=class HC extends Wp{constructor(e){super(e),Z(this,"enabled",!0),Z(this,"view","vertical"),this.components.add(HC.uuid,this)}get world(){return super.world}set world(e){this.world!==e&&(super.world=e,this._highlighter&&this._highlighter.onSelect.add(t=>{if(!this.world)throw new Error("A world is needed to work with this component!");let i=this.components.get(Oh);i.deleteByType(["Slope","Height","InitialKPV","FinalKPV"]);let{alignment:n}=t.curve,r=[];for(let c of n.vertical){let d=c.mesh.geometry.attributes.position.array;r.push(d)}let{defSegments:o,slope:a}=this.setDefSegments(r),l=this.world.scene.three;for(let c=0;c<n.vertical.length;c++){let d=n.vertical[c];i.addVerticalMarker(this.world,`S: ${a[c].slope}%`,d.mesh,"Slope",l),i.addVerticalMarker(this.world,`H: ${o[c].end.y.toFixed(2)}`,d.mesh,"Height",l)}i.addVerticalMarker(this.world,"KP: 0",n.vertical[0].mesh,"InitialKPV",l),i.addVerticalMarker(this.world,`KP: ${n.vertical.length}`,n.vertical[n.vertical.length-1].mesh,"FinalKPV",l)}))}};Z(BL,"uuid","097eea29-2d5a-431a-a247-204d44670621");var zL=class GC extends At{constructor(e){super(e),Z(this,"onHighlight",new Oe),Z(this,"onMarkerChange",new Oe),Z(this,"onMarkerHidden",new Oe),Z(this,"enabled",!0),Z(this,"mouseMarkers"),Z(this,"_highlighter"),Z(this,"_curves",[]),Z(this,"_world",null),Z(this,"updateLinesResolution",t=>{var i;(i=this.highlighter)==null||i.setResolution(t)}),Z(this,"onClick",t=>{if(!this.enabled||!this._highlighter)return;if(!this.world)throw new Error("No world found!");if(!this.world.renderer)return;let i=this.world.renderer.three.domElement,n=this.world.camera.three,r=this._highlighter.castRay(t,n,i,this._curves);if(r){let o=r.object;this._highlighter.select(o),this.updateMarker(r,"select");let{point:a,index:l}=r;l!==void 0&&this.onHighlight.trigger({curve:o,point:a,index:l});return}this._highlighter.unSelect(),this.mouseMarkers&&(this.mouseMarkers.hover.visible=!1),this.onMarkerHidden.trigger({type:"hover"})}),Z(this,"onMouseMove",t=>ie(this,null,function*(){if(!this.enabled||!this._highlighter)return;if(!this.world)throw new Error("No world found!");if(!this.world.renderer)return;let i=this.world.renderer.three.domElement,n=this.world.camera.three,r=this._highlighter.castRay(t,n,i,this._curves);if(r){this._highlighter.hover(r.object),this.updateMarker(r,"hover");return}this._highlighter.unHover()})),this.components.add(GC.uuid,this)}get world(){return this._world}set world(e){var t,i,n;if(e===this._world||(this._world&&this.setupEvents(!1),this._world=e,(t=this._highlighter)==null||t.dispose(),(i=this.mouseMarkers)==null||i.hover.dispose(),(n=this.mouseMarkers)==null||n.select.dispose(),!e))return;let r=e.scene.three;this._highlighter=new PC(r,"absolute"),this.mouseMarkers={select:this.newMouseMarker("#ffffff",e),hover:this.newMouseMarker("#575757",e)},this.setupEvents(!0)}get highlighter(){if(!this._highlighter)throw new Error("Navigator not initialized!");return this._highlighter}draw(e){if(!e.civilData)throw new Error("Model must have civil data!");if(!this.world)throw new Error("A world must be given before drawing an alignment!");let t=this.world.scene.three;for(let[i,n]of e.civilData.alignments)for(let{mesh:r}of n.absolute)t.add(r),this._curves.push(r)}setMarker(e,t,i){if(!this.mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");let n=e.getPointAt(t,"absolute");this.mouseMarkers[i].visible=!0,this.mouseMarkers[i].three.position.copy(n)}hideMarker(e){if(!this.mouseMarkers)throw new Error("No mouse markers found! Initialize the world before using this.");let t=this.mouseMarkers[e].three;t.visible=!1}newMouseMarker(e,t){let i=t.scene.three,n=document.createElement("div");n.style.backgroundColor=e,n.style.width="1rem",n.style.height="1rem",n.style.borderRadius="1rem";let r=new vn(t,n,i);return r.visible=!1,r}setupEvents(e){var t,i;if(!this.world)throw new Error("No world found!");if(this.world.isDisposing||!this.world.renderer)return;let n=this.world.renderer.three.domElement;(t=this.world.renderer)==null||t.onResize.remove(this.updateLinesResolution),n.removeEventListener("click",this.onClick),n.removeEventListener("pointermove",this.onMouseMove),e&&(n.addEventListener("click",this.onClick),n.addEventListener("pointermove",this.onMouseMove),(i=this.world.renderer)==null||i.onResize.add(this.updateLinesResolution))}updateMarker(e,t){if(!this.mouseMarkers)return;let{point:i,object:n}=e,r=n,o=r.curve,a=r.curve.alignment,l=a.getPercentageAt(i,"absolute");this.mouseMarkers[t].visible=!0,this.mouseMarkers[t].three.position.copy(i),l!==null&&this.onMarkerChange.trigger({alignment:a,percentage:l,type:t,curve:o})}};Z(zL,"uuid","0a59c09e-2b49-474a-9320-99f51f40f182");var VL=class WC extends At{constructor(e){super(e),Z(this,"enabled",!0),Z(this,"world",null),Z(this,"plane"),Z(this,"_world3D",null),this.components.add(WC.uuid,this)}get world3D(){return this._world3D}set world3D(e){var t;if(this._world3D=e,(t=this.plane)==null||t.dispose(),!e)return;let i=this.components.get(Bl),n=i.Type;i.Type=go,this.plane=i.createFromNormalAndCoplanarPoint(e,new ce(1,0,0),new ce),i.Type=n,this.plane.visible=!1,this.plane.enabled=!1}set(e,t){return ie(this,null,function*(){if(!this.world||!this.plane)throw new Error("You must set a world before using this component");this.plane.enabled=!0;let i=e.curve.getPercentageAt(t);if(i===null)return;let{startPoint:n,endPoint:r}=e.curve.getSegmentAt(i);if(e.geometry.index===null)throw new Error("Geometry must be indexed!");let o=new ce;o.subVectors(r,n),o.normalize(),this.plane.setFromNormalAndCoplanarPoint(o,t),this.plane.edges.update();let a=this.plane.helper.matrix.clone();a.invert();let l=this.world.scene.three,c=this.plane.edges.get();for(let d in c){let{mesh:h}=c[d];h.position.set(0,0,0),h.rotation.set(0,0,0),h.updateMatrix(),h.applyMatrix4(a),h.parent!==l&&l.add(h)}this.plane.enabled=!1})}};Z(VL,"uuid","96b2c87e-d90b-4639-8257-8f01136fe324");function bo(){let s=document.createElement("div");return s.style.backgroundColor="black",s.style.color="white",s.style.padding="8px",s.style.borderRadius="8px",s.style.fontFamily="sans-serif",s}var Ap=class Ip{constructor(e,t,i){Z(this,"label"),Z(this,"boundingBox",new $e),Z(this,"world"),Z(this,"components"),Z(this,"_length"),Z(this,"_visible",!0),Z(this,"_start"),Z(this,"_end"),Z(this,"_root",new qs),Z(this,"_endpoints",[]),Z(this,"_line"),this.components=e,this.world=t,this._start=i.start,this._end=i.end,this._length=this.getLength(),this._line=this.createLine(i),this.newEndpointElement(i.endpointElement),this.newEndpointElement(i.endpointElement.cloneNode(!0)),this.label=this.newText(),this._root.renderOrder=2,this.world.scene.three.add(this._root)}get visible(){return this._visible}set visible(e){this._visible=e,this.label.visible=e,this._endpoints[0].visible=e,this._endpoints[1].visible=e;let[t,i]=this._endpoints,n=t.three,r=i.three,o=this.label.three;e?(this.world.scene.three.add(this._root),this._root.add(o,n,r)):(o.removeFromParent(),n.removeFromParent(),r.removeFromParent(),this._root.removeFromParent())}get endPoint(){return this._end}set endPoint(e){this._end=e;let t=this._line.geometry.attributes.position;t.setXYZ(1,e.x,e.y,e.z),t.needsUpdate=!0,this._endpoints[1].three.position.copy(e),this.updateLabel()}get startPoint(){return this._start}set startPoint(e){this._start=e;let t=this._line.geometry.attributes.position;t.setXYZ(0,e.x,e.y,e.z),t.needsUpdate=!0,this._endpoints[0].three.position.copy(e),this.updateLabel()}get _center(){let e=this._end.clone().sub(this._start),t=e.length()*.5;return e=e.normalize().multiplyScalar(t),this._start.clone().add(e)}dispose(){let e=this.components.get(nr);this.visible=!1,e.destroy(this._root),e.destroy(this._line);for(let t of this._endpoints)t.dispose();this._endpoints.length=0,this.label.dispose(),this.boundingBox&&e.destroy(this.boundingBox),this.components=null}createBoundingBox(){this.boundingBox.geometry=new ki(1,1,this._length),this.boundingBox.position.copy(this._center),this.boundingBox.lookAt(this._end),this.boundingBox.visible=!1,this._root.add(this.boundingBox)}toggleLabel(){this.label.toggleVisibility()}newEndpointElement(e){let t=this._endpoints.length===0?this._start:this._end,i=new vn(this.world,e);i.three.position.copy(t),this._endpoints.push(i),this._root.add(i.three)}updateLabel(){this._length=this.getLength(),this.label.three.element.textContent=this.getTextContent(),this.label.three.position.copy(this._center),this._line.computeLineDistances()}createLine(e){let t=new kt;t.setFromPoints([e.start,e.end]);let i=new _i(t,e.lineMaterial);return this._root.add(i),i}newText(){let e=bo();e.textContent=this.getTextContent();let t=new vn(this.world,e);return t.three.position.copy(this._center),this._root.add(t.three),t}getTextContent(){return`${(this._length/Ip.scale).toFixed(Ip.rounding)} ${Ip.units}`}getLength(){return this._start.distanceTo(this._end)}};Z(Ap,"scale",1),Z(Ap,"units","m"),Z(Ap,"rounding",2);var Db=Ap,mb=class{constructor(e,t,i){Z(this,"enabled",!0),Z(this,"points",[]),Z(this,"workingPlane",null),Z(this,"labelMarker"),Z(this,"world"),Z(this,"components"),Z(this,"onDisposed",new Oe),Z(this,"onAreaComputed",new Oe),Z(this,"onWorkingPlaneComputed",new Oe),Z(this,"onPointAdded",new Oe),Z(this,"onPointRemoved",new Oe),Z(this,"_visible",!0),Z(this,"_rotationMatrix",null),Z(this,"_dimensionLines",[]),Z(this,"_defaultLineMaterial",new Mn({color:"red"})),this.world=t,this.components=e;let n=bo();this.labelMarker=new vn(t,n),this.labelMarker.visible=!1,this.onPointAdded.add(r=>{this.points.length===3&&!this._dimensionLines[2]&&(this.addDimensionLine(r,this.points[0]),this.labelMarker.visible=!0)}),i?.forEach(r=>this.setPoint(r))}get visible(){return this._visible}set visible(e){this._visible=e;for(let t of this._dimensionLines)t.visible=e,t.label.visible=!1;this.labelMarker.visible=e}setPoint(e,t){let i;if(t?i=t:i=this.points.length===0?0:this.points.length,i===0){this.points[0]=e;return}if(i<0||i>this.points.length)return;let n=this.points.length>i;this.points[i]=e,this.onPointAdded.trigger(e),n||this.addDimensionLine(this.points[i-1],e);let{previousLine:r,nextLine:o}=this.getLinesBetweenIndex(i);r&&(r.endPoint=e),o&&(o.startPoint=e)}removePoint(e){if(this.points.length===3)return;this.points.splice(e,1);let{previousLine:t,nextLine:i}=this.getLinesBetweenIndex(e);i&&(t.endPoint=i.endPoint),i?.dispose(),this._dimensionLines.splice(e,1),this.onPointRemoved.trigger()}toggleLabel(){this.labelMarker.toggleVisibility()}addDimensionLine(e,t){let i=new Db(this.components,this.world,{start:e,end:t,lineMaterial:this._defaultLineMaterial,endpointElement:bo()});return i.toggleLabel(),this._dimensionLines.length>1?this._dimensionLines.splice(this._dimensionLines.length-1,0,i):this._dimensionLines.push(i),i}getLinesBetweenIndex(e){let t=e===0?this._dimensionLines.length-1:e-1,i=this._dimensionLines[t],n=this._dimensionLines[e];return{previousLine:i,nextLine:n}}computeWorkingPlane(){this.workingPlane=new Ws().setFromCoplanarPoints(this.points[0],this.points[1],this.points[2]);let e=new ce(0,1,0),t=this.workingPlane.normal.angleTo(e),i=new ce().crossVectors(this.workingPlane.normal,e).normalize();this._rotationMatrix=new lt().makeRotationAxis(i,t),this.onWorkingPlaneComputed.trigger(this.workingPlane)}computeArea(){if(!(this._rotationMatrix&&this.workingPlane))return this.onAreaComputed.trigger(0),0;let e=0,t=0,i=this._rotationMatrix,n=this.points.map(o=>{let a=o.clone().applyMatrix4(i),l=new Bt(a.x,a.z);return e+=l.x,t+=l.y,l}),r=Math.abs($w.area(n));return this.labelMarker.three.element.textContent=`${r.toFixed(2)} m\xB2`,this.labelMarker.three.position.set(e/n.length,-this.workingPlane.constant,t/n.length).applyMatrix4(i.clone().invert()),this.onAreaComputed.trigger(r),r}dispose(){this.onAreaComputed.reset(),this.onWorkingPlaneComputed.reset(),this.onPointAdded.reset(),this.onPointRemoved.reset();for(let e of this._dimensionLines)e.dispose();this.labelMarker.dispose(),this._dimensionLines=[],this.points=[],this._rotationMatrix=null,this.workingPlane=null,this._defaultLineMaterial.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}get(){return{points:this.points,workingPlane:this.workingPlane,area:this.computeArea()}}},zh=class extends E0{constructor(e,t){super(e,t),Z(this,"onDisposed",new Oe),Z(this,"marker",null),Z(this,"_className","default-vertex-picker"),this.onEnabled.add(i=>{this.marker&&(this.marker.visible=i)})}get className(){return this._className}set className(e){this._className=e,this.marker&&(this.marker.three.element.className=e)}dispose(){this.marker&&this.marker.dispose(),super.dispose()}get(e){let t=super.get(e);return t?(this.marker||(this.marker=new vn(e),this.marker.three.element.className=this._className),this.marker.world!==e&&(this.marker.world=e,this.marker.three.removeFromParent(),e.scene.three.add(this.marker.three)),this.marker.visible=!0,this.marker.three.position.copy(t)):this.marker&&(this.marker.visible=!1),t}},YC=class gb extends At{constructor(e){super(e),Z(this,"onDisposed",new Oe),Z(this,"list",[]),Z(this,"world"),Z(this,"_enabled",!1),Z(this,"_visible",!0),Z(this,"_vertexPicker"),Z(this,"_currentAreaElement",null),Z(this,"_clickCount",0),Z(this,"create",()=>{if(!this.enabled)return;if(!this.world)throw new Error("World not defined for the area measurement!");let t=this._vertexPicker.get(this.world);if(t){if(!this._currentAreaElement){let i=new mb(this.components,this.world);i.onPointAdded.add(()=>{this._clickCount===2&&!i.workingPlane&&(i.computeWorkingPlane(),this._vertexPicker.workingPlane=i.workingPlane)}),i.onPointRemoved.add(()=>this._clickCount--),this._currentAreaElement=i}this._currentAreaElement.setPoint(t,this._clickCount),this._currentAreaElement.computeArea(),this._clickCount++}}),Z(this,"onMouseMove",()=>{if(!this.world){console.log("No world given for the area measurement!");return}let t=this._vertexPicker.get(this.world);t&&this._currentAreaElement&&(this._currentAreaElement.setPoint(t,this._clickCount),this._currentAreaElement.computeArea())}),Z(this,"onKeydown",t=>{this.enabled&&(t.key==="z"&&t.ctrlKey&&this._currentAreaElement&&this._currentAreaElement.removePoint(this._clickCount-1),t.key==="Enter"&&this._currentAreaElement&&this.endCreation(),t.key==="Escape"&&(this._clickCount===0&&!this._currentAreaElement?this.enabled=!1:this.cancelCreation()))}),this.components.add(gb.uuid,this),this._vertexPicker=new zh(e)}set enabled(e){this._enabled=e,this._vertexPicker.enabled=e,this.setupEvents(e),e||this.cancelCreation()}get enabled(){return this._enabled}set workingPlane(e){this._vertexPicker.workingPlane=e}get workingPlane(){return this._vertexPicker.workingPlane}get visible(){return this._visible}set visible(e){this._visible=e;for(let t of this.list)t.visible=e}dispose(){this.setupEvents(!1),this._vertexPicker.dispose(),this._currentAreaElement&&this._currentAreaElement.dispose();for(let e of this.list)e.dispose();this.components=null,this.onDisposed.trigger(gb.uuid),this.onDisposed.reset()}delete(){}deleteAll(){for(let e of this.list)e.dispose();this.list=[]}endCreation(){this._currentAreaElement&&(this._currentAreaElement.points.length<3||(this._currentAreaElement&&(this.list.push(this._currentAreaElement),this._currentAreaElement.removePoint(this._clickCount),this._currentAreaElement.computeWorkingPlane(),this._currentAreaElement.computeArea(),this._currentAreaElement=null),this._vertexPicker.workingPlane=null,this._clickCount=0))}cancelCreation(){this._currentAreaElement&&(this._currentAreaElement.dispose(),this._currentAreaElement=null),this._vertexPicker.workingPlane=null,this._clickCount=0}setupEvents(e){if(!this.world)throw new Error("The area measurement needs a world to work!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The world of the area measurement needs a renderer!");let t=this.world.renderer.three.domElement.parentElement;e?(t.addEventListener("pointermove",this.onMouseMove),window.addEventListener("keydown",this.onKeydown)):(t.removeEventListener("pointermove",this.onMouseMove),window.removeEventListener("keydown",this.onKeydown))}};Z(YC,"uuid","c453a99e-f054-4781-9060-33df617db4a5");var qC=YC,bb=class{constructor(e,t){Z(this,"enabled",!0),Z(this,"visible",!0),Z(this,"points",[]),Z(this,"world"),Z(this,"onDisposed",new Oe),Z(this,"_lineMaterial",new _a({color:6629591,linewidth:2})),Z(this,"_lineGeometry",new zl),Z(this,"_line",new Vp(this._lineGeometry,this._lineMaterial)),Z(this,"_labelMarker"),Z(this,"onAngleComputed",new Oe),Z(this,"onPointAdded",new Oe),this.world=e;let i=bo();this._labelMarker=new vn(e,i),this.labelMarker.visible=!0,this.onPointAdded.add(()=>{this.points.length===1&&e.scene.three.add(this._line),this.points.length===3&&(this.labelMarker.visible=!0)}),this.onAngleComputed.add(n=>{this.labelMarker.three.element.textContent=`${n.toFixed(2)}\xB0`,this.labelMarker.three.position.copy(this.points[1]??new ce)}),t?.forEach(n=>this.setPoint(n))}set lineMaterial(e){this._lineMaterial.dispose(),this._lineMaterial=e,this._line.material=e,this._lineMaterial.resolution.set(window.innerWidth,window.innerHeight)}get lineMaterial(){return this._lineMaterial}set labelMarker(e){this._labelMarker.dispose(),this._labelMarker=e}get labelMarker(){return this._labelMarker}get angle(){return{points:this.points,angle:this.computeAngle()}}setPoint(e,t){let i;if(t?i=t:i=this.points.length===0?0:this.points.length,![0,1,2].includes(i))return;this.points[i]=e,this.onPointAdded.trigger(e);let n=this.points.map(r=>[r.x,r.y,r.z]);this._lineGeometry.setPositions(n.flat())}toggleLabel(){this.labelMarker.toggleVisibility()}computeAngle(){let e=this.points[0],t=this.points[1],i=this.points[2];if(!(e&&t&&i))return 0;let n=new ce().subVectors(t,e),r=new ce().subVectors(t,i),o=_r.radToDeg(n.angleTo(r));return this.onAngleComputed.trigger(o),o}dispose(){this.points=[],this.labelMarker.dispose(),this.onAngleComputed.reset(),this.onPointAdded.reset(),this.labelMarker.dispose(),this._line.removeFromParent(),this._lineMaterial.dispose(),this._lineGeometry.dispose(),this.onDisposed.trigger(),this.onDisposed.reset()}},XC=class vb extends At{constructor(e){super(e),Z(this,"onDisposed",new Oe),Z(this,"world"),Z(this,"list",[]),Z(this,"_lineMaterial"),Z(this,"_enabled",!1),Z(this,"_vertexPicker"),Z(this,"_currentAngleElement",null),Z(this,"_clickCount",0),Z(this,"create",()=>{if(!this.enabled)return;if(!this.world){console.log("No world selected for angle measurement!");return}let t=this._vertexPicker.get(this.world);if(t){if(!this._currentAngleElement){let i=new bb(this.world);i.lineMaterial=this.lineMaterial,this._currentAngleElement=i}this._currentAngleElement.setPoint(t,this._clickCount),this._currentAngleElement.setPoint(t,this._clickCount+1),this._currentAngleElement.setPoint(t,this._clickCount+2),this._currentAngleElement.computeAngle(),this._clickCount++,this._clickCount===3&&this.endCreation()}}),Z(this,"onMouseMove",()=>{if(!this.world){console.log("No world selected for angle measurement!");return}let t=this._vertexPicker.get(this.world);t&&this._currentAngleElement&&(this._currentAngleElement.setPoint(t,this._clickCount),this._currentAngleElement.computeAngle())}),Z(this,"onKeyDown",t=>{this.enabled&&t.key==="Escape"&&this.cancelCreation()}),this.components.add(vb.uuid,this),this._vertexPicker=new zh(e),this._lineMaterial=new _a({color:6629591,linewidth:2})}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this.setupEvents(e),this._vertexPicker.enabled=e,e||this.cancelCreation()}get lineMaterial(){return this._lineMaterial}set lineMaterial(e){this._lineMaterial.dispose(),this._lineMaterial=e,this._lineMaterial.resolution.set(window.innerWidth,window.innerHeight)}get workingPlane(){return this._vertexPicker.workingPlane}set workingPlane(e){this._vertexPicker.workingPlane=e}dispose(){this.setupEvents(!1),this._lineMaterial.dispose(),this._vertexPicker.dispose();for(let e of this.list)e.dispose();this._currentAngleElement&&this._currentAngleElement.dispose(),this.components=null,this.onDisposed.trigger(vb.uuid),this.onDisposed.reset()}delete(){}deleteAll(){for(let e of this.list)e.dispose();this.list=[]}endCreation(){this._currentAngleElement&&(this.list.push(this._currentAngleElement),this._currentAngleElement.computeAngle(),this._currentAngleElement=null),this._clickCount=0}cancelCreation(){this._currentAngleElement&&(this._currentAngleElement.dispose(),this._currentAngleElement=null),this._clickCount=0}setupEvents(e){if(!this.world)throw new Error("No world selected for angle measurement!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The given world doesn't have a renderer!");let t=this.world.renderer.three.domElement.parentElement;e?(t.addEventListener("pointermove",this.onMouseMove),window.addEventListener("keydown",this.onKeyDown)):(t.removeEventListener("pointermove",this.onMouseMove),window.removeEventListener("keydown",this.onKeyDown))}};Z(XC,"uuid","622fb2c9-528c-4b0a-8a0e-6a1375f0a3aa");var KC=XC,$C=class yb extends At{constructor(e){super(e),Z(this,"onDisposed",new Oe),Z(this,"onBeforeUpdate",new Oe),Z(this,"onAfterUpdate",new Oe),Z(this,"snapDistance",.25),Z(this,"list",[]),Z(this,"world"),Z(this,"_vertexPicker"),Z(this,"_lineMaterial",new Mn({color:"#DC2626",linewidth:2,depthTest:!1})),Z(this,"_visible",!0),Z(this,"_enabled",!1),Z(this,"_temp",{isDragging:!1,start:new ce,end:new ce,dimension:void 0}),Z(this,"create",t=>{let i=t instanceof Gs?t:void 0;if(this._enabled){if(!this._temp.isDragging){this.drawStart(i);return}this.endCreation()}}),Z(this,"onMouseMove",()=>{this.world&&this._vertexPicker.get(this.world)}),this.components.add(yb.uuid,this),this._vertexPicker=new zh(e,{previewElement:bo(),snapDistance:this.snapDistance})}get enabled(){return this._enabled}set enabled(e){e||this.cancelCreation(),this._enabled=e,this._vertexPicker.enabled=e,this.setupEvents(e)}get visible(){return this._visible}set visible(e){this._visible=e;for(let t of this.list)t.visible=e}get color(){return this._lineMaterial.color}set color(e){this._lineMaterial.color=e}dispose(){this.setupEvents(!1),this.enabled=!1;for(let e of this.list)e.dispose();this._lineMaterial.dispose(),this.list=[],this._vertexPicker.dispose(),this.onDisposed.trigger(yb.uuid),this.onDisposed.reset()}update(e){return ie(this,null,function*(){this._enabled&&this._temp.isDragging&&this.drawInProcess()})}createOnPoints(e,t){let i=this.drawDimension();i.startPoint=e,i.endPoint=t,i.createBoundingBox(),this.list.push(i)}delete(){if(!this.world)throw new Error("World is needed for Length Measurement!");if(!this._enabled||this.list.length===0)return;let e=this.getBoundingBoxes(),t=this.components.get(rs).get(this.world).castRay(e);if(!t)return;let i=this.list.find(n=>n.boundingBox===t.object);if(i){let n=this.list.indexOf(i);this.list.splice(n,1),i.dispose()}}deleteMeasurement(e){return ie(this,null,function*(){if(e){let t=this.list.indexOf(e);this.list.splice(t,1),e.dispose()}})}deleteAll(){for(let e of this.list)e.dispose();this.list=[]}cancelCreation(){var e;this._temp.dimension&&(this._temp.isDragging=!1,(e=this._temp.dimension)==null||e.dispose(),this._temp.dimension=void 0)}endCreation(){this._temp.dimension&&(this._temp.dimension.createBoundingBox(),this.list.push(this._temp.dimension),this._temp.dimension=void 0,this._temp.isDragging=!1)}drawStart(e){if(!this.world)throw new Error("The length measurement needs a world to work!");let t=e?[e]:void 0,i=this.components.get(rs).get(this.world).castRay(t),n=this._vertexPicker.get(this.world);i&&n&&(this._temp.isDragging=!0,this._temp.start=e?i.point:n)}drawInProcess(){if(!this.world)throw new Error("The length measurement needs a world to work!");if(!this.components.get(rs).get(this.world).castRay())return;let e=this._vertexPicker.get(this.world);e&&(this._temp.end=e,this._temp.dimension||(this._temp.dimension=this.drawDimension()),this._temp.dimension.endPoint=this._temp.end)}drawDimension(){if(!this.world)throw new Error("The length measurement needs a world to work!");return new Db(this.components,this.world,{start:this._temp.start,end:this._temp.end,lineMaterial:this._lineMaterial,endpointElement:bo()})}getBoundingBoxes(){return this.list.map(e=>e.boundingBox).filter(e=>e!==void 0)}setupEvents(e){if(!this.world)throw new Error("The length measurement needs a world to work!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The world of the length measurement needs a renderer!");let t=this.world.renderer.three.domElement.parentElement;t&&(t.removeEventListener("pointermove",this.onMouseMove),e&&t.addEventListener("pointermove",this.onMouseMove))}};Z($C,"uuid","2f9bcacf-18a9-4be6-a293-e898eae64ea1");var fa=$C,jL=class ZC extends At{constructor(e){super(e),Z(this,"onDisposed",new Oe),Z(this,"onVolumeFound",new Oe),Z(this,"label",null),Z(this,"world"),Z(this,"_enabled",!1),Z(this,"create",()=>{if(!this.enabled)return;if(!this.world)throw new Error("World is needed for Volume Measurement!");let t=this.components.get(rs).get(this.world).castRay(),i=this.components.get(va);if(!t||!t.object)return;let{object:n}=t;if(n instanceof $e){let r=i.getVolumeFromMeshes([n]);this.onVolumeFound.trigger(r)}}),Z(this,"onMouseMove",()=>{}),Z(this,"onKeydown",t=>{}),this.components.add(ZC.uuid,this)}set enabled(e){this._enabled=e,this.setupEvents(e),e||this.cancelCreation()}get enabled(){return this._enabled}dispose(){return ie(this,null,function*(){var e;this.setupEvents(!1),(e=this.label)==null||e.dispose(),this.onDisposed.trigger(),this.onDisposed.reset(),this.components=null})}delete(){}deleteAll(){return ie(this,null,function*(){})}endCreation(){}cancelCreation(){}getVolumeFromFragments(e){let t=this.components.get(va).getVolumeFromFragments(e),i=this.components.get(Lp);i.reset(),i.addFragmentIdMap(e);let n=i.getSphere();return this.setLabel(n,t),t}getVolumeFromMeshes(e){let t=this.components.get(va),i=this.components.get(Lp);i.reset();for(let o of e)i.addMesh(o);let n=i.getSphere(),r=t.getVolumeFromMeshes(e);return this.setLabel(n,r),r}clear(){this.label&&(this.label.visible=!1)}newLabel(){if(!this.world)throw new Error("World is needed for Volume Measurement!");let e=bo();return new vn(this.world,e)}setupEvents(e){if(!this.world)throw new Error("The volume measurement needs a world to work!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The world of the volume measurement needs a renderer!");let t=this.world.renderer.three.domElement.parentElement;e?(t.addEventListener("click",this.create),t.addEventListener("pointermove",this.onMouseMove),window.addEventListener("keydown",this.onKeydown)):(t.removeEventListener("click",this.create),t.removeEventListener("pointermove",this.onMouseMove),window.removeEventListener("keydown",this.onKeydown))}setLabel(e,t){if(!this.world)throw new Error("World is needed for Volume Measurement!");this.label||(this.label=this.newLabel(),this.label.three.removeFromParent()),this.label.visible=!0,this.world.scene.three.add(this.label.three),this.label.three.position.copy(e.center);let i=Math.trunc(t*100)/100;this.label.three.element.textContent=i.toString()}};Z(jL,"uuid","811da532-7af3-4635-b592-1c06ae494af5");var HL=class QC extends At{constructor(e){super(e),Z(this,"onDisposed",new Oe),Z(this,"selection",[]),Z(this,"preview",new $e(new kt,new Ii({side:2,depthTest:!1,transparent:!0,opacity:.25,color:"#BCF124"}))),Z(this,"selectionMaterial",new Ii({side:2,depthTest:!1,transparent:!0,color:"#BCF124",opacity:.75})),Z(this,"world"),Z(this,"_enabled",!1),Z(this,"_currentSelelection",null),Z(this,"create",()=>{if(!this.world)throw new Error("No world given to the face measurement!");if(!this.enabled||!this._currentSelelection)return;let t=this.world.scene.three,i=new kt,n=new $e(i,this.selectionMaterial);i.setAttribute("position",this.preview.geometry.attributes.position),t.add(n),i.computeBoundingSphere();let{area:r,perimeter:o}=this._currentSelelection,a=this.newLabel(i,r);n.add(a.three),this.selection.push({area:r,perimeter:o,mesh:n,label:a})}),Z(this,"onMouseMove",()=>{if(!this.world)throw new Error("The face measurement needs a world to work!");if(!this.enabled){this.unselect();return}let t=this.components.get(rs).get(this.world).castRay();if(!t||!t.object||t.faceIndex===void 0){this.unselect();return}let{object:i,faceIndex:n}=t;i instanceof $e||i instanceof Jn?this.updateSelection(i,n,t.instanceId):this.unselect()}),Z(this,"onKeydown",t=>{}),this.components.add(QC.uuid,this),this.preview.frustumCulled=!1}set enabled(e){if(!this.world)throw new Error("No world given for the Face measurement!");this._enabled=e,this.setupEvents(e),e?this.world.scene.three.add(this.preview):(this.preview.removeFromParent(),this.cancelCreation()),this.setVisibility(e)}get enabled(){return this._enabled}dispose(){this.setupEvents(!1),this.deleteAll(),this.preview.removeFromParent(),this.preview.material.dispose(),this.preview.geometry.dispose(),this.selectionMaterial.dispose(),this.onDisposed.trigger(),this.onDisposed.reset(),this.components=null}delete(){if(!this.world)throw new Error("No world given to the face measurement!");let e=this.selection.map(r=>r.mesh),t=this.components.get(rs).get(this.world).castRay(e);if(!t||!t.object)return;let i=this.selection.find(r=>r.mesh===t.object);if(!i)return;i.mesh.removeFromParent(),i.mesh.geometry.dispose(),i.label.dispose();let n=this.selection.indexOf(i);this.selection.splice(n,1)}deleteAll(){for(let e of this.selection)e.mesh.removeFromParent(),e.mesh.geometry.dispose(),e.label.dispose();this.selection=[]}endCreation(){}cancelCreation(){}get(){let e=[];for(let t of this.selection){let i=t.mesh.geometry,{area:n,perimeter:r}=t,o=i.attributes.position.array;e.push({position:o,area:n,perimeter:r})}return e}set(e){if(!this.world)throw new Error("No world given to the face measurement!");let t=this.world.scene.three;for(let i of e){let n=new kt,r=new $e(n,this.selectionMaterial);t.add(r);let o=new Ti(i.position,3);n.setAttribute("position",o),n.computeBoundingSphere();let{area:a,perimeter:l}=i,c=this.newLabel(n,a);r.add(c.three),this.selection.push({area:a,perimeter:l,mesh:r,label:c})}}setupEvents(e){if(!this.world)throw new Error("The face measurement needs a world to work!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The world of the face measurement needs a renderer!");let t=this.world.renderer.three.domElement.parentElement;t.removeEventListener("pointermove",this.onMouseMove),window.removeEventListener("keydown",this.onKeydown),e&&(t.addEventListener("pointermove",this.onMouseMove),window.addEventListener("keydown",this.onKeydown))}setVisibility(e){if(!this.world)throw new Error("The face measurement needs a world to work!");if(this.world.isDisposing)return;let t=this.world.scene.three;for(let i of this.selection){let n=i.label.three;e?(t.add(i.mesh),i.mesh.add(n)):(i.mesh.removeFromParent(),n.removeFromParent())}}unselect(){this.preview.removeFromParent(),this._currentSelelection=null}updateSelection(e,t,i){if(!this.world)throw new Error("The face measurement needs a world to work!");this.world.scene.three.add(this.preview);let n=this.components.get(va).getFace(e,t,i);if(n===null)return;let r=this.regenerateHighlight(e,n.indices,i),o=0;for(let{distance:a}of n.edges)o+=a;this._currentSelelection={perimeter:o,area:r}}newLabel(e,t){if(!e.boundingSphere)throw new Error("Error computing area geometry");if(!this.world)throw new Error("The face measurement needs a world to work!");let{center:i}=e.boundingSphere,n=bo(),r=Math.trunc(t*100)/100;n.textContent=r.toString();let o=new vn(this.world,n);return o.three.position.copy(i),o}regenerateHighlight(e,t,i){let n=[],r=[],o=0,a=0,l=new wr,c=this.components.get(va);for(let u of t){let{p1:p,p2:f,p3:m}=c.getVerticesAndNormal(e,u,i);n.push(p.x,p.y,p.z),n.push(f.x,f.y,f.z),n.push(m.x,m.y,m.z),l.set(p,f,m),a+=l.getArea(),r.push(o,o+1,o+2),o+=3}this.preview.position.set(0,0,0),this.preview.rotation.set(0,0,0),this.preview.scale.set(1,1,1),this.preview.updateMatrix(),this.preview.applyMatrix4(e.matrixWorld);let d=new Float32Array(n),h=new Ti(d,3);return this.preview.geometry.setAttribute("position",h),this.preview.geometry.setIndex(r),a}};Z(HL,"uuid","30279548-1309-44f6-aa97-ce26eed73522");var GL=class JC extends At{constructor(e){super(e),Z(this,"onDisposed",new Oe),Z(this,"preview"),Z(this,"tolerance",.3),Z(this,"world"),Z(this,"_enabled",!1),Z(this,"_lineMaterial",new Mn({color:"#DC2626",linewidth:2,depthTest:!1,transparent:!0})),Z(this,"create",()=>ie(this,null,function*(){if(!this.preview||!this.enabled||!this.preview.visible)return;let t=this.components.get(fa);t.world=this.world;let i=this.preview.startPoint.clone(),n=this.preview.endPoint.clone();t.createOnPoints(i,n)})),Z(this,"onMouseMove",()=>{if(!this.preview)return;if(!this.world)throw new Error("The edge measurement needs a world to work!");if(!this.enabled){this.preview.visible=!1;return}let t=this.components.get(rs).get(this.world).castRay();if(!t||!t.object){this.preview.visible=!1;return}let{object:i,faceIndex:n,point:r}=t;if(n===void 0){this.preview.visible=!1;return}i instanceof $e||i instanceof Jn?this.updateSelection(i,r,n,t.instanceId):this.preview.visible=!1}),Z(this,"onKeydown",t=>{}),this.components.add(JC.uuid,this)}set enabled(e){if(this._enabled=e,this.setupEvents(e),e){if(!this.world)throw new Error("The edge measurement needs a world to work!");if(!this.preview){let t=document.createElement("div");t.className="w-2 h-2 bg-red-600 rounded-full",this.preview=new Db(this.components,this.world,{start:new ce,end:new ce,lineMaterial:this._lineMaterial,endpointElement:t}),this.preview.visible=!1}}else this.cancelCreation()}get enabled(){return this._enabled}dispose(){this.preview&&this.preview.dispose(),this._lineMaterial.dispose(),this.setupEvents(!1),this.onDisposed.trigger(),this.onDisposed.reset(),this.components=null}delete(){if(!this.enabled)return;let e=this.components.get(fa),t=e.enabled;e.enabled=!0,e.delete(),e.enabled=t}deleteAll(){this.components.get(fa).deleteAll()}endCreation(){}cancelCreation(){}get(){let e=this.components.get(fa).list,t=[];for(let i of e){let n=i.startPoint,r=i.endPoint,o=[n.x,n.y,n.z,r.x,r.y,r.z];t.push(o)}return t}set(e){let t=this.components.get(fa);t.world=this.world;for(let i of e){let[n,r,o,a,l,c]=i,d=new ce(n,r,o),h=new ce(a,l,c);t.createOnPoints(d,h)}}setupEvents(e){if(!this.world)throw new Error("The edge measurement needs a world to work!");if(this.world.isDisposing)return;if(!this.world.renderer)throw new Error("The world of the edge measurement needs a renderer!");let t=this.world.renderer.three.domElement.parentElement;e?(t.addEventListener("pointermove",this.onMouseMove),window.addEventListener("keydown",this.onKeydown)):(t.removeEventListener("pointermove",this.onMouseMove),window.removeEventListener("keydown",this.onKeydown))}updateSelection(e,t,i,n){if(!this.preview||!e.geometry.index)return;let r=this.components.get(va).getFace(e,i,n);if(!r)return;let{edges:o}=r,a=Number.MAX_VALUE,l=[];for(let h of o){let[u,p]=h.points,f=va.distanceFromPointToLine(t,u,p,!0);f<this.tolerance&&f<a&&(a=f,l=h.points)}if(!l.length){this.preview.visible=!1;return}let[c,d]=l;this.preview.startPoint=c,this.preview.endPoint=d,this.preview.visible=!0}};Z(GL,"uuid","e7be5749-89df-4514-8d25-83aa38ce12d8");var _b=class extends Rp{constructor(e,t,i){super(e,t,i),Z(this,"threshold",50),Z(this,"bboxThreshold",200),Z(this,"maxLostTime",3e4),Z(this,"maxHiddenTime",5e3),Z(this,"boxes",new Map),Z(this,"_staticGeometries",{culled:{},unculled:{}}),Z(this,"_geometry"),Z(this,"_material",new Ii({transparent:!0,side:2,opacity:1})),Z(this,"onViewUpdated",new ga),Z(this,"_modelIDIndex",new Map),Z(this,"_indexModelID",new Map),Z(this,"_nextModelID",0),Z(this,"_geometries",new Map),Z(this,"_geometriesGroups",new Map),Z(this,"_geometriesInMemory",new Set),Z(this,"_intervalID",null),Z(this,"codes",new Map),Z(this,"handleWorkerMessage",r=>ie(this,null,function*(){let o=r.data.colors,a={},l={},c={},d={},h=performance.now(),u=!1,p=new Set(this._geometriesInMemory);for(let[f,m]of o){let g=this._geometries.get(f);if(!g||!(m>this.threshold))continue;p.delete(f);let{exists:b}=g,v=this._indexModelID.get(g.modelIndex);b?(g.time=h,d[v]||(d[v]=new Set),d[v].add(g.geometryID),this._geometriesInMemory.add(f),u=!0):(a[v]||(a[v]=new Map),g.time=h,g.exists=!0,a[v].has(m)||a[v].set(m,new Set),a[v].get(m).add(g.geometryID),this._geometriesInMemory.add(f),u=!0)}for(let f of p){let m=this._geometries.get(f);m&&(this.handleLostGeometries(h,f,m,l,c),u=!0)}u&&(yield this.onViewUpdated.trigger({toLoad:a,toRemove:l,toHide:c,toShow:d})),this._isWorkerBusy=!1})),this.updateInterval=500,this._geometry=new ki(1,1,1),this._geometry.groups=[],this._geometry.deleteAttribute("uv");let n=this._geometry.attributes.position.array;for(let r=0;r<n.length;r++)n[r]+=.5;this._geometry.attributes.position.needsUpdate=!0,this.worker.addEventListener("message",this.handleWorkerMessage),this.autoUpdate&&(this._intervalID=window.setInterval(this.updateVisibility,this.updateInterval))}dispose(){super.dispose(),this.onViewUpdated.reset(),this._intervalID!==null&&(window.clearInterval(this._intervalID),this._intervalID=null);for(let[e,t]of this._geometriesGroups){t.removeFromParent();let i=[...t.children];for(let n of i)n.removeFromParent()}this._geometriesGroups.clear();for(let[e,t]of this.boxes)t.dispose(!0);this.boxes.clear();for(let[e,t]of this._geometries)t.fragment&&(t.fragment.dispose(!0),t.fragment=void 0);this._geometries.clear(),this._staticGeometries={culled:{},unculled:{}},this._geometry.dispose(),this._material.dispose(),this._modelIDIndex.clear(),this._indexModelID.clear(),this.codes.clear()}add(e,t,i){let n=this.createModelIndex(e),r=js.enabled;js.enabled=!1;let o=new Map,a=new lt,l=new sa(this._geometry,this._material,10);this.boxes.set(n,l),this.scene.add(l.mesh);let c=new qs;this.scene.add(c),this._geometriesGroups.set(n,c);let d=new Map;for(let u of t)for(let p of u.geometries){let{geometryID:f,transformation:m,color:g}=p,b=new zt;b.setRGB(g[0],g[1],g[2],"srgb");let v=this.getInstanceID(u.id,f),E=i[f];if(!E){console.log(`Geometry not found: ${f}`);continue}let{boundingBox:y}=E,w;o.has(f)?w=o.get(f):(w=this.getAvailableColor(),this.increaseColor(),o.set(f,w));let{r:C,g:A,b:D,code:M}=w,I=new zt;I.setRGB(C/255,A/255,D/255,"srgb"),this.codes.has(n)||this.codes.set(n,new Map),this.codes.get(n).set(f,M);let O=new lt,F=Object.values(y);if(O.fromArray(m),a.fromArray(F),O.multiply(a),d.has(v)){let V=d.get(v);if(V===void 0||!V.colors)throw new Error("Malformed item!");V.colors.push(I),V.geometryColors.push(b),V.transforms.push(O)}else d.set(v,{id:v,colors:[I],geometryColors:[b],transforms:[O]});if(this._geometries.has(M))this._geometries.get(M).assetIDs.add(u.id);else{let V=new Set([u.id]);this._geometries.set(M,{modelIndex:n,geometryID:f,assetIDs:V,exists:!1,hidden:!1,time:0})}}let h=Array.from(d.values());l.add(h),js.enabled=r}remove(e){let t=this._modelIDIndex.get(e);if(t===void 0)throw new Error("Model doesn't exist!");let i=this._geometriesGroups.get(t);i.removeFromParent();let n=[...i.children];for(let o of n)o.removeFromParent();this._geometriesGroups.delete(t),this.boxes.get(t).dispose(!1),this.boxes.delete(t);let r=this.codes.get(t);this.codes.delete(t);for(let[o,a]of r){let l=this._geometries.get(a);l&&l.fragment&&(l.fragment.dispose(!1),l.fragment=void 0),this._geometries.delete(a)}this._modelIDIndex.delete(e),this._indexModelID.delete(t),this._geometriesInMemory.clear()}addFragment(e,t,i){let n=js.enabled;js.enabled=!1;let r=this._modelIDIndex.get(e),o=this.codes.get(r).get(t),a=this._geometries.get(o);if(this.setGeometryVisibility(a,!1,!1),!a.fragment){a.fragment=new sa(i.mesh.geometry,this._material,i.capacity);let u=this._geometriesGroups.get(r);if(!u)throw new Error("Group not found!");u.add(a.fragment.mesh)}let[l,c,d]=o.split("-").map(u=>parseInt(u,10)),h=[];for(let u of i.ids){let p=i.get(u);if(!p.colors)throw new Error("Malformed fragments!");for(let f of p.colors)f.setRGB(l/255,c/255,d/255,"srgb");h.push(p)}a.fragment.add(h),js.enabled=n,this.needsUpdate=!0}removeFragment(e,t){let i=this._modelIDIndex.get(e),n=this.codes.get(i).get(t),r=this._geometries.get(n);if(r.hidden||this.setGeometryVisibility(r,!0,!1),r.fragment){let{fragment:o}=r;o.dispose(!1),r.fragment=void 0}}setModelTransformation(e,t){let i=this._modelIDIndex.get(e);if(i===void 0)throw new Error("Model not found!");let n=this.boxes.get(i);n&&(n.mesh.position.set(0,0,0),n.mesh.rotation.set(0,0,0),n.mesh.scale.set(1,1,1),n.mesh.applyMatrix4(t));let r=this._geometriesGroups.get(i);r&&(r.position.set(0,0,0),r.rotation.set(0,0,0),r.scale.set(1,1,1),r.applyMatrix4(t))}setVisibility(e,t,i){let n=this._modelIDIndex.get(t);if(n!==void 0)for(let[r,o]of i){let a=this.codes.get(n);if(a===void 0)throw new Error("Map not found!");let l=a.get(r),c=this._geometries.get(l);if(c===void 0)throw new Error("Geometry not found!");c.hidden=!e,this.setGeometryVisibility(c,e,!0,o)}}updateTransformations(e){let t=this._modelIDIndex.get(e);if(t===void 0)return;let i=this.components.get(Rt).groups.get(e);if(i){i.updateWorldMatrix(!0,!1),i.updateMatrix();let n=this.boxes.get(t);n&&(n.mesh.position.set(0,0,0),n.mesh.rotation.set(0,0,0),n.mesh.scale.set(1,1,1),n.mesh.updateMatrix(),n.mesh.applyMatrix4(i.matrixWorld),n.mesh.updateMatrix());let r=this._geometriesGroups.get(t);r&&(r.position.set(0,0,0),r.rotation.set(0,0,0),r.scale.set(1,1,1),r.updateMatrix(),r.applyMatrix4(i.matrixWorld),r.updateMatrix())}}addStaticGeometries(e,t=!0){return ie(this,null,function*(){let i={data:{colors:new Map}},n=this.threshold+1e3;for(let r in e){let o=this._modelIDIndex.get(r);if(o===void 0)continue;let a=this.codes.get(o);if(!a)continue;let l=e[r];for(let c of l){let d=a.get(c);if(!d)continue;let h=this._geometries.get(d);if(!h)continue;h.exists=!0,t||(h.hidden=!1,h.time=performance.now(),i.data.colors.set(d,n)),this._geometriesInMemory.add(d);let u=t?this._staticGeometries.culled:this._staticGeometries.unculled;u[r]||(u[r]=new Set),u[r].add(c)}}t||(yield this.handleWorkerMessage(i))})}removeStaticGeometries(e,t){let i=[];t===void 0?i.push("culled","unculled"):t===!0?i.push("culled"):i.push("unculled");for(let n in e){let r=e[n];for(let o of i){let a=this._staticGeometries[o][n];if(a)for(let l of r)a.delete(l)}}}setGeometryVisibility(e,t,i,n){let{modelIndex:r,geometryID:o,assetIDs:a}=e,l=this.boxes.get(r);if(l===void 0)throw new Error("Model not found!");let c=n||a;if(i&&e.fragment)e.fragment.setVisibility(t,c);else{let d=new Set;for(let h of c){let u=this.getInstanceID(h,o);d.add(u)}l.setVisibility(t,d)}}handleLostGeometries(e,t,i,n,r){var o,a,l;let c=this._indexModelID.get(i.modelIndex),d=e-i.time,{culled:h,unculled:u}=this._staticGeometries;if(d>this.maxLostTime){if((o=h[c])!=null&&o.has(i.geometryID)||(a=u[c])!=null&&a.has(i.geometryID))return;n[c]||(n[c]=new Set),i.exists=!1,n[c].add(i.geometryID),this._geometriesInMemory.delete(t)}else if(d>this.maxHiddenTime){if((l=u[c])!=null&&l.has(i.geometryID))return;r[c]||(r[c]=new Set),r[c].add(i.geometryID)}}createModelIndex(e){if(this._modelIDIndex.has(e))throw new Error("Can't load the same model twice!");let t=this._nextModelID;return this._nextModelID++,this._modelIDIndex.set(e,t),this._indexModelID.set(t,e),t}getInstanceID(e,t){let i=10**(Math.log(t)*Math.LOG10E+1|0);return e+t/i}},ex={exports:{}};(function(s,e){(function(t,i){s.exports=i()})(L1,function(){var t=function(_,S){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(L,H){L.__proto__=H}||function(L,H){for(var Y in H)Object.prototype.hasOwnProperty.call(H,Y)&&(L[Y]=H[Y])})(_,S)},i=function(){return(i=Object.assign||function(_){for(var S,L=1,H=arguments.length;L<H;L++)for(var Y in S=arguments[L])Object.prototype.hasOwnProperty.call(S,Y)&&(_[Y]=S[Y]);return _}).apply(this,arguments)};function n(_,S,L){for(var H,Y=0,ne=S.length;Y<ne;Y++)!H&&Y in S||((H=H||Array.prototype.slice.call(S,0,Y))[Y]=S[Y]);return _.concat(H||Array.prototype.slice.call(S))}var r=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:L1,o=Object.keys,a=Array.isArray;function l(_,S){return typeof S!="object"||o(S).forEach(function(L){_[L]=S[L]}),_}typeof Promise>"u"||r.Promise||(r.Promise=Promise);var c=Object.getPrototypeOf,d={}.hasOwnProperty;function h(_,S){return d.call(_,S)}function u(_,S){typeof S=="function"&&(S=S(c(_))),(typeof Reflect>"u"?o:Reflect.ownKeys)(S).forEach(function(L){f(_,L,S[L])})}var p=Object.defineProperty;function f(_,S,L,H){p(_,S,l(L&&h(L,"get")&&typeof L.get=="function"?{get:L.get,set:L.set,configurable:!0}:{value:L,configurable:!0,writable:!0},H))}function m(_){return{from:function(S){return _.prototype=Object.create(S.prototype),f(_.prototype,"constructor",_),{extend:u.bind(null,_.prototype)}}}}var g=Object.getOwnPropertyDescriptor,b=[].slice;function v(_,S,L){return b.call(_,S,L)}function E(_,S){return S(_)}function y(_){if(!_)throw new Error("Assertion Failed")}function w(_){r.setImmediate?setImmediate(_):setTimeout(_,0)}function C(_,S){if(typeof S=="string"&&h(_,S))return _[S];if(!S)return _;if(typeof S!="string"){for(var L=[],H=0,Y=S.length;H<Y;++H){var ne=C(_,S[H]);L.push(ne)}return L}var ae=S.indexOf(".");if(ae!==-1){var ue=_[S.substr(0,ae)];return ue==null?void 0:C(ue,S.substr(ae+1))}}function A(_,S,L){if(_&&S!==void 0&&!("isFrozen"in Object&&Object.isFrozen(_)))if(typeof S!="string"&&"length"in S){y(typeof L!="string"&&"length"in L);for(var H=0,Y=S.length;H<Y;++H)A(_,S[H],L[H])}else{var ne,ae,ue=S.indexOf(".");ue!==-1?(ne=S.substr(0,ue),(ae=S.substr(ue+1))===""?L===void 0?a(_)&&!isNaN(parseInt(ne))?_.splice(ne,1):delete _[ne]:_[ne]=L:A(ue=!(ue=_[ne])||!h(_,ne)?_[ne]={}:ue,ae,L)):L===void 0?a(_)&&!isNaN(parseInt(S))?_.splice(S,1):delete _[S]:_[S]=L}}function D(_){var S,L={};for(S in _)h(_,S)&&(L[S]=_[S]);return L}var M=[].concat;function I(_){return M.apply([],_)}var gr="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(I([8,16,32,64].map(function(_){return["Int","Uint","Float"].map(function(S){return S+_+"Array"})}))).filter(function(_){return r[_]}),O=new Set(gr.map(function(_){return r[_]})),F=null;function V(_){return F=new WeakMap,_=function S(L){if(!L||typeof L!="object")return L;var H=F.get(L);if(H)return H;if(a(L)){H=[],F.set(L,H);for(var Y=0,ne=L.length;Y<ne;++Y)H.push(S(L[Y]))}else if(O.has(L.constructor))H=L;else{var ae,ue=c(L);for(ae in H=ue===Object.prototype?{}:Object.create(ue),F.set(L,H),L)h(L,ae)&&(H[ae]=S(L[ae]))}return H}(_),F=null,_}var x={}.toString;function N(_){return x.call(_).slice(8,-1)}var z=typeof Symbol<"u"?Symbol.iterator:"@@iterator",G=typeof z=="symbol"?function(_){var S;return _!=null&&(S=_[z])&&S.apply(_)}:function(){return null};function X(_,S){return S=_.indexOf(S),0<=S&&_.splice(S,1),0<=S}var k={};function B(_){var S,L,H,Y;if(arguments.length===1){if(a(_))return _.slice();if(this===k&&typeof _=="string")return[_];if(Y=G(_)){for(L=[];!(H=Y.next()).done;)L.push(H.value);return L}if(_==null)return[_];if(typeof(S=_.length)!="number")return[_];for(L=new Array(S);S--;)L[S]=_[S];return L}for(S=arguments.length,L=new Array(S);S--;)L[S]=arguments[S];return L}var R=typeof Symbol<"u"?function(_){return _[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},je=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Kn=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(je),j={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function $(_,S){this.name=_,this.message=S}function T(_,S){return _+". Errors: "+Object.keys(S).map(function(L){return S[L].toString()}).filter(function(L,H,Y){return Y.indexOf(L)===H}).join(`
`)}function U(_,S,L,H){this.failures=S,this.failedKeys=H,this.successCount=L,this.message=T(_,S)}function W(_,S){this.name="BulkError",this.failures=Object.keys(S).map(function(L){return S[L]}),this.failuresByPos=S,this.message=T(_,this.failures)}m($).from(Error).extend({toString:function(){return this.name+": "+this.message}}),m(U).from($),m(W).from($);var Q=Kn.reduce(function(_,S){return _[S]=S+"Error",_},{}),te=$,J=Kn.reduce(function(_,S){var L=S+"Error";function H(Y,ne){this.name=L,Y?typeof Y=="string"?(this.message="".concat(Y).concat(ne?`
 `+ne:""),this.inner=ne||null):typeof Y=="object"&&(this.message="".concat(Y.name," ").concat(Y.message),this.inner=Y):(this.message=j[S]||L,this.inner=null)}return m(H).from(te),_[S]=H,_},{});J.Syntax=SyntaxError,J.Type=TypeError,J.Range=RangeError;var oe=je.reduce(function(_,S){return _[S+"Error"]=J[S],_},{}),pe=Kn.reduce(function(_,S){return["Syntax","Type","Range"].indexOf(S)===-1&&(_[S+"Error"]=J[S]),_},{});function de(){}function fe(_){return _}function P(_,S){return _==null||_===fe?S:function(L){return S(_(L))}}function se(_,S){return function(){_.apply(this,arguments),S.apply(this,arguments)}}function re(_,S){return _===de?S:function(){var L=_.apply(this,arguments);L!==void 0&&(arguments[0]=L);var H=this.onsuccess,Y=this.onerror;this.onsuccess=null,this.onerror=null;var ne=S.apply(this,arguments);return H&&(this.onsuccess=this.onsuccess?se(H,this.onsuccess):H),Y&&(this.onerror=this.onerror?se(Y,this.onerror):Y),ne!==void 0?ne:L}}function K(_,S){return _===de?S:function(){_.apply(this,arguments);var L=this.onsuccess,H=this.onerror;this.onsuccess=this.onerror=null,S.apply(this,arguments),L&&(this.onsuccess=this.onsuccess?se(L,this.onsuccess):L),H&&(this.onerror=this.onerror?se(H,this.onerror):H)}}function ee(_,S){return _===de?S:function(L){var H=_.apply(this,arguments);l(L,H);var Y=this.onsuccess,ne=this.onerror;return this.onsuccess=null,this.onerror=null,L=S.apply(this,arguments),Y&&(this.onsuccess=this.onsuccess?se(Y,this.onsuccess):Y),ne&&(this.onerror=this.onerror?se(ne,this.onerror):ne),H===void 0?L===void 0?void 0:L:l(H,L)}}function le(_,S){return _===de?S:function(){return S.apply(this,arguments)!==!1&&_.apply(this,arguments)}}function xe(_,S){return _===de?S:function(){var L=_.apply(this,arguments);if(L&&typeof L.then=="function"){for(var H=this,Y=arguments.length,ne=new Array(Y);Y--;)ne[Y]=arguments[Y];return L.then(function(){return S.apply(H,ne)})}return S.apply(this,arguments)}}pe.ModifyError=U,pe.DexieError=$,pe.BulkError=W;var ge=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function _e(_){ge=_}var Ue={},ke=100,gr=typeof Promise>"u"?[]:function(){var _=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[_,c(_),_];var S=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[S,c(S),_]}(),je=gr[0],Kn=gr[1],gr=gr[2],Kn=Kn&&Kn.then,Qe=je&&je.constructor,Et=!!gr,ht=function(_,S){yi.push([_,S]),Kt&&(queueMicrotask(Hr),Kt=!1)},ni=!0,Kt=!0,It=[],ci=[],Ct=fe,ti={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:de,pgp:!1,env:{},finalize:de},ot=ti,yi=[],dn=0,Fe=[];function he(_){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var S=this._PSD=ot;if(typeof _!="function"){if(_!==Ue)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&ut(this,this._value))}this._state=null,this._value=null,++S.ref,function L(H,Y){try{Y(function(ne){if(H._state===null){if(ne===H)throw new TypeError("A promise cannot be resolved with itself.");var ae=H._lib&&In();ne&&typeof ne.then=="function"?L(H,function(ue,ye){ne instanceof he?ne._then(ue,ye):ne.then(ue,ye)}):(H._state=!0,H._value=ne,Ut(H)),ae&&Pi()}},ut.bind(null,H))}catch(ne){ut(H,ne)}}(this,_)}var we={get:function(){var _=ot,S=Wr;function L(H,Y){var ne=this,ae=!_.global&&(_!==ot||S!==Wr),ue=ae&&!Xn(),ye=new he(function(be,Ae){jt(ne,new it(L_(H,_,ae,ue),L_(Y,_,ae,ue),be,Ae,_))});return this._consoleTask&&(ye._consoleTask=this._consoleTask),ye}return L.prototype=Ue,L},set:function(_){f(this,"then",_&&_.prototype===Ue?we:{get:function(){return _},set:we.set})}};function it(_,S,L,H,Y){this.onFulfilled=typeof _=="function"?_:null,this.onRejected=typeof S=="function"?S:null,this.resolve=L,this.reject=H,this.psd=Y}function ut(_,S){var L,H;ci.push(S),_._state===null&&(L=_._lib&&In(),S=Ct(S),_._state=!1,_._value=S,H=_,It.some(function(Y){return Y._value===H._value})||It.push(H),Ut(_),L&&Pi())}function Ut(_){var S=_._listeners;_._listeners=[];for(var L=0,H=S.length;L<H;++L)jt(_,S[L]);var Y=_._PSD;--Y.ref||Y.finalize(),dn===0&&(++dn,ht(function(){--dn==0&&Bs()},[]))}function jt(_,S){if(_._state!==null){var L=_._state?S.onFulfilled:S.onRejected;if(L===null)return(_._state?S.resolve:S.reject)(_._value);++S.psd.ref,++dn,ht(Yn,[L,_,S])}else _._listeners.push(S)}function Yn(_,S,L){try{var H,Y=S._value;!S._state&&ci.length&&(ci=[]),H=ge&&S._consoleTask?S._consoleTask.run(function(){return _(Y)}):_(Y),S._state||ci.indexOf(Y)!==-1||function(ne){for(var ae=It.length;ae;)if(It[--ae]._value===ne._value)return It.splice(ae,1)}(S),L.resolve(H)}catch(ne){L.reject(ne)}finally{--dn==0&&Bs(),--L.psd.ref||L.psd.finalize()}}function Hr(){Yo(ti,function(){In()&&Pi()})}function In(){var _=ni;return Kt=ni=!1,_}function Pi(){var _,S,L;do for(;0<yi.length;)for(_=yi,yi=[],L=_.length,S=0;S<L;++S){var H=_[S];H[0].apply(null,H[1])}while(0<yi.length);Kt=ni=!0}function Bs(){var _=It;It=[],_.forEach(function(H){H._PSD.onunhandled.call(null,H._value,H)});for(var S=Fe.slice(0),L=S.length;L;)S[--L]()}function Ln(_){return new he(Ue,!1,_)}function ii(_,S){var L=ot;return function(){var H=In(),Y=ot;try{return Yr(L,!0),_.apply(this,arguments)}catch(ne){S&&S(ne)}finally{Yr(Y,!1),H&&Pi()}}}u(he.prototype,{then:we,_then:function(_,S){jt(this,new it(null,null,_,S,ot))},catch:function(_){if(arguments.length===1)return this.then(null,_);var S=_,L=arguments[1];return typeof S=="function"?this.then(null,function(H){return(H instanceof S?L:Ln)(H)}):this.then(null,function(H){return(H&&H.name===S?L:Ln)(H)})},finally:function(_){return this.then(function(S){return he.resolve(_()).then(function(){return S})},function(S){return he.resolve(_()).then(function(){return Ln(S)})})},timeout:function(_,S){var L=this;return _<1/0?new he(function(H,Y){var ne=setTimeout(function(){return Y(new J.Timeout(S))},_);L.then(H,Y).finally(clearTimeout.bind(null,ne))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&f(he.prototype,Symbol.toStringTag,"Dexie.Promise"),ti.env=D_(),u(he,{all:function(){var _=B.apply(null,arguments).map(su);return new he(function(S,L){_.length===0&&S([]);var H=_.length;_.forEach(function(Y,ne){return he.resolve(Y).then(function(ae){_[ne]=ae,--H||S(_)},L)})})},resolve:function(_){return _ instanceof he?_:_&&typeof _.then=="function"?new he(function(S,L){_.then(S,L)}):new he(Ue,!0,_)},reject:Ln,race:function(){var _=B.apply(null,arguments).map(su);return new he(function(S,L){_.map(function(H){return he.resolve(H).then(S,L)})})},PSD:{get:function(){return ot},set:function(_){return ot=_}},totalEchoes:{get:function(){return Wr}},newPSD:Si,usePSD:Yo,scheduler:{get:function(){return ht},set:function(_){ht=_}},rejectionMapper:{get:function(){return Ct},set:function(_){Ct=_}},follow:function(_,S){return new he(function(L,H){return Si(function(Y,ne){var ae=ot;ae.unhandleds=[],ae.onunhandled=ne,ae.finalize=se(function(){var ue,ye=this;ue=function(){ye.unhandleds.length===0?Y():ne(ye.unhandleds[0])},Fe.push(function be(){ue(),Fe.splice(Fe.indexOf(be),1)}),++dn,ht(function(){--dn==0&&Bs()},[])},ae.finalize),_()},S,L,H)})}}),Qe&&(Qe.allSettled&&f(he,"allSettled",function(){var _=B.apply(null,arguments).map(su);return new he(function(S){_.length===0&&S([]);var L=_.length,H=new Array(L);_.forEach(function(Y,ne){return he.resolve(Y).then(function(ae){return H[ne]={status:"fulfilled",value:ae}},function(ae){return H[ne]={status:"rejected",reason:ae}}).then(function(){return--L||S(H)})})})}),Qe.any&&typeof AggregateError<"u"&&f(he,"any",function(){var _=B.apply(null,arguments).map(su);return new he(function(S,L){_.length===0&&L(new AggregateError([]));var H=_.length,Y=new Array(H);_.forEach(function(ne,ae){return he.resolve(ne).then(function(ue){return S(ue)},function(ue){Y[ae]=ue,--H||L(new AggregateError(Y))})})})}));var Nt={awaits:0,echoes:0,id:0},Qa=0,fr=[],Gr=0,Wr=0,Wo=0;function Si(_,S,L,H){var Y=ot,ne=Object.create(Y);return ne.parent=Y,ne.ref=0,ne.global=!1,ne.id=++Wo,ti.env,ne.env=Et?{Promise:he,PromiseProp:{value:he,configurable:!0,writable:!0},all:he.all,race:he.race,allSettled:he.allSettled,any:he.any,resolve:he.resolve,reject:he.reject}:{},S&&l(ne,S),++Y.ref,ne.finalize=function(){--this.parent.ref||this.parent.finalize()},H=Yo(ne,_,L,H),ne.ref===0&&ne.finalize(),H}function qn(){return Nt.id||(Nt.id=++Qa),++Nt.awaits,Nt.echoes+=ke,Nt.id}function Xn(){return!!Nt.awaits&&(--Nt.awaits==0&&(Nt.id=0),Nt.echoes=Nt.awaits*ke,!0)}function su(_){return Nt.echoes&&_&&_.constructor===Qe?(qn(),_.then(function(S){return Xn(),S},function(S){return Xn(),Oi(S)})):_}function D2(){var _=fr[fr.length-1];fr.pop(),Yr(_,!1)}function Yr(_,S){var L,H=ot;(S?!Nt.echoes||Gr++&&_===ot:!Gr||--Gr&&_===ot)||queueMicrotask(S?(function(Y){++Wr,Nt.echoes&&--Nt.echoes!=0||(Nt.echoes=Nt.awaits=Nt.id=0),fr.push(ot),Yr(Y,!0)}).bind(null,_):D2),_!==ot&&(ot=_,H===ti&&(ti.env=D_()),Et&&(L=ti.env.Promise,S=_.env,(H.global||_.global)&&(Object.defineProperty(r,"Promise",S.PromiseProp),L.all=S.all,L.race=S.race,L.resolve=S.resolve,L.reject=S.reject,S.allSettled&&(L.allSettled=S.allSettled),S.any&&(L.any=S.any))))}function D_(){var _=r.Promise;return Et?{Promise:_,PromiseProp:Object.getOwnPropertyDescriptor(r,"Promise"),all:_.all,race:_.race,allSettled:_.allSettled,any:_.any,resolve:_.resolve,reject:_.reject}:{}}function Yo(_,S,L,H,Y){var ne=ot;try{return Yr(_,!0),S(L,H,Y)}finally{Yr(ne,!1)}}function L_(_,S,L,H){return typeof _!="function"?_:function(){var Y=ot;L&&qn(),Yr(S,!0);try{return _.apply(this,arguments)}finally{Yr(Y,!1),H&&queueMicrotask(Xn)}}}function Om(_){Promise===Qe&&Nt.echoes===0?Gr===0?_():enqueueNativeMicroTask(_):setTimeout(_,0)}(""+Kn).indexOf("[native code]")===-1&&(qn=Xn=de);var Oi=he.reject,qo="\uFFFF",mr="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",F_="String expected.",Ja=[],ru="__dbnames",Mm="readonly",Rm="readwrite";function Xo(_,S){return _?S?function(){return _.apply(this,arguments)&&S.apply(this,arguments)}:_:S}var k_={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function ou(_){return typeof _!="string"||/\./.test(_)?function(S){return S}:function(S){return S[_]===void 0&&_ in S&&delete(S=V(S))[_],S}}function N_(){throw J.Type()}function Ht(_,S){try{var L=U_(_),H=U_(S);if(L!==H)return L==="Array"?1:H==="Array"?-1:L==="binary"?1:H==="binary"?-1:L==="string"?1:H==="string"?-1:L==="Date"?1:H!=="Date"?NaN:-1;switch(L){case"number":case"Date":case"string":return S<_?1:_<S?-1:0;case"binary":return function(Y,ne){for(var ae=Y.length,ue=ne.length,ye=ae<ue?ae:ue,be=0;be<ye;++be)if(Y[be]!==ne[be])return Y[be]<ne[be]?-1:1;return ae===ue?0:ae<ue?-1:1}(B_(_),B_(S));case"Array":return function(Y,ne){for(var ae=Y.length,ue=ne.length,ye=ae<ue?ae:ue,be=0;be<ye;++be){var Ae=Ht(Y[be],ne[be]);if(Ae!==0)return Ae}return ae===ue?0:ae<ue?-1:1}(_,S)}}catch{}return NaN}function U_(_){var S=typeof _;return S!="object"?S:ArrayBuffer.isView(_)?"binary":(_=N(_),_==="ArrayBuffer"?"binary":_)}function B_(_){return _ instanceof Uint8Array?_:ArrayBuffer.isView(_)?new Uint8Array(_.buffer,_.byteOffset,_.byteLength):new Uint8Array(_)}var z_=(di.prototype._trans=function(_,S,L){var H=this._tx||ot.trans,Y=this.name,ne=ge&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(_==="readonly"?"read":"write"," ").concat(this.name));function ae(be,Ae,me){if(!me.schema[Y])throw new J.NotFound("Table "+Y+" not part of transaction");return S(me.idbtrans,me)}var ue=In();try{var ye=H&&H.db._novip===this.db._novip?H===ot.trans?H._promise(_,ae,L):Si(function(){return H._promise(_,ae,L)},{trans:H,transless:ot.transless||ot}):function be(Ae,me,Ie,ve){if(Ae.idbdb&&(Ae._state.openComplete||ot.letThrough||Ae._vip)){var Ee=Ae._createTransaction(me,Ie,Ae._dbSchema);try{Ee.create(),Ae._state.PR1398_maxLoop=3}catch(Te){return Te.name===Q.InvalidState&&Ae.isOpen()&&0<--Ae._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),Ae.close({disableAutoOpen:!1}),Ae.open().then(function(){return be(Ae,me,Ie,ve)})):Oi(Te)}return Ee._promise(me,function(Te,Ce){return Si(function(){return ot.trans=Ee,ve(Te,Ce,Ee)})}).then(function(Te){if(me==="readwrite")try{Ee.idbtrans.commit()}catch{}return me==="readonly"?Te:Ee._completion.then(function(){return Te})})}if(Ae._state.openComplete)return Oi(new J.DatabaseClosed(Ae._state.dbOpenError));if(!Ae._state.isBeingOpened){if(!Ae._state.autoOpen)return Oi(new J.DatabaseClosed);Ae.open().catch(de)}return Ae._state.dbReadyPromise.then(function(){return be(Ae,me,Ie,ve)})}(this.db,_,[this.name],ae);return ne&&(ye._consoleTask=ne,ye=ye.catch(function(be){return console.trace(be),Oi(be)})),ye}finally{ue&&Pi()}},di.prototype.get=function(_,S){var L=this;return _&&_.constructor===Object?this.where(_).first(S):_==null?Oi(new J.Type("Invalid argument to Table.get()")):this._trans("readonly",function(H){return L.core.get({trans:H,key:_}).then(function(Y){return L.hook.reading.fire(Y)})}).then(S)},di.prototype.where=function(_){if(typeof _=="string")return new this.db.WhereClause(this,_);if(a(_))return new this.db.WhereClause(this,"[".concat(_.join("+"),"]"));var S=o(_);if(S.length===1)return this.where(S[0]).equals(_[S[0]]);var L=this.schema.indexes.concat(this.schema.primKey).filter(function(ye){if(ye.compound&&S.every(function(Ae){return 0<=ye.keyPath.indexOf(Ae)})){for(var be=0;be<S.length;++be)if(S.indexOf(ye.keyPath[be])===-1)return!1;return!0}return!1}).sort(function(ye,be){return ye.keyPath.length-be.keyPath.length})[0];if(L&&this.db._maxKey!==qo){var ae=L.keyPath.slice(0,S.length);return this.where(ae).equals(ae.map(function(be){return _[be]}))}!L&&ge&&console.warn("The query ".concat(JSON.stringify(_)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(S.join("+"),"]"));var H=this.schema.idxByName,Y=this.db._deps.indexedDB;function ne(ye,be){return Y.cmp(ye,be)===0}var ue=S.reduce(function(Ie,be){var Ae=Ie[0],me=Ie[1],Ie=H[be],ve=_[be];return[Ae||Ie,Ae||!Ie?Xo(me,Ie&&Ie.multi?function(Ee){return Ee=C(Ee,be),a(Ee)&&Ee.some(function(Te){return ne(ve,Te)})}:function(Ee){return ne(ve,C(Ee,be))}):me]},[null,null]),ae=ue[0],ue=ue[1];return ae?this.where(ae.name).equals(_[ae.keyPath]).filter(ue):L?this.filter(ue):this.where(S).equals("")},di.prototype.filter=function(_){return this.toCollection().and(_)},di.prototype.count=function(_){return this.toCollection().count(_)},di.prototype.offset=function(_){return this.toCollection().offset(_)},di.prototype.limit=function(_){return this.toCollection().limit(_)},di.prototype.each=function(_){return this.toCollection().each(_)},di.prototype.toArray=function(_){return this.toCollection().toArray(_)},di.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},di.prototype.orderBy=function(_){return new this.db.Collection(new this.db.WhereClause(this,a(_)?"[".concat(_.join("+"),"]"):_))},di.prototype.reverse=function(){return this.toCollection().reverse()},di.prototype.mapToClass=function(_){var S,L=this.db,H=this.name;function Y(){return S!==null&&S.apply(this,arguments)||this}(this.schema.mappedClass=_).prototype instanceof N_&&(function(ye,be){if(typeof be!="function"&&be!==null)throw new TypeError("Class extends value "+String(be)+" is not a constructor or null");function Ae(){this.constructor=ye}t(ye,be),ye.prototype=be===null?Object.create(be):(Ae.prototype=be.prototype,new Ae)}(Y,S=_),Object.defineProperty(Y.prototype,"db",{get:function(){return L},enumerable:!1,configurable:!0}),Y.prototype.table=function(){return H},_=Y);for(var ne=new Set,ae=_.prototype;ae;ae=c(ae))Object.getOwnPropertyNames(ae).forEach(function(ye){return ne.add(ye)});function ue(ye){if(!ye)return ye;var be,Ae=Object.create(_.prototype);for(be in ye)if(!ne.has(be))try{Ae[be]=ye[be]}catch{}return Ae}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=ue,this.hook("reading",ue),_},di.prototype.defineClass=function(){return this.mapToClass(function(_){l(this,_)})},di.prototype.add=function(_,S){var L=this,H=this.schema.primKey,Y=H.auto,ne=H.keyPath,ae=_;return ne&&Y&&(ae=ou(ne)(_)),this._trans("readwrite",function(ue){return L.core.mutate({trans:ue,type:"add",keys:S!=null?[S]:null,values:[ae]})}).then(function(ue){return ue.numFailures?he.reject(ue.failures[0]):ue.lastResult}).then(function(ue){if(ne)try{A(_,ne,ue)}catch{}return ue})},di.prototype.update=function(_,S){return typeof _!="object"||a(_)?this.where(":id").equals(_).modify(S):(_=C(_,this.schema.primKey.keyPath),_===void 0?Oi(new J.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(_).modify(S))},di.prototype.put=function(_,S){var L=this,H=this.schema.primKey,Y=H.auto,ne=H.keyPath,ae=_;return ne&&Y&&(ae=ou(ne)(_)),this._trans("readwrite",function(ue){return L.core.mutate({trans:ue,type:"put",values:[ae],keys:S!=null?[S]:null})}).then(function(ue){return ue.numFailures?he.reject(ue.failures[0]):ue.lastResult}).then(function(ue){if(ne)try{A(_,ne,ue)}catch{}return ue})},di.prototype.delete=function(_){var S=this;return this._trans("readwrite",function(L){return S.core.mutate({trans:L,type:"delete",keys:[_]})}).then(function(L){return L.numFailures?he.reject(L.failures[0]):void 0})},di.prototype.clear=function(){var _=this;return this._trans("readwrite",function(S){return _.core.mutate({trans:S,type:"deleteRange",range:k_})}).then(function(S){return S.numFailures?he.reject(S.failures[0]):void 0})},di.prototype.bulkGet=function(_){var S=this;return this._trans("readonly",function(L){return S.core.getMany({keys:_,trans:L}).then(function(H){return H.map(function(Y){return S.hook.reading.fire(Y)})})})},di.prototype.bulkAdd=function(_,S,L){var H=this,Y=Array.isArray(S)?S:void 0,ne=(L=L||(Y?void 0:S))?L.allKeys:void 0;return this._trans("readwrite",function(ae){var be=H.schema.primKey,ue=be.auto,be=be.keyPath;if(be&&Y)throw new J.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(Y&&Y.length!==_.length)throw new J.InvalidArgument("Arguments objects and keys must have the same length");var ye=_.length,be=be&&ue?_.map(ou(be)):_;return H.core.mutate({trans:ae,type:"add",keys:Y,values:be,wantResults:ne}).then(function(Ee){var me=Ee.numFailures,Ie=Ee.results,ve=Ee.lastResult,Ee=Ee.failures;if(me===0)return ne?Ie:ve;throw new W("".concat(H.name,".bulkAdd(): ").concat(me," of ").concat(ye," operations failed"),Ee)})})},di.prototype.bulkPut=function(_,S,L){var H=this,Y=Array.isArray(S)?S:void 0,ne=(L=L||(Y?void 0:S))?L.allKeys:void 0;return this._trans("readwrite",function(ae){var be=H.schema.primKey,ue=be.auto,be=be.keyPath;if(be&&Y)throw new J.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(Y&&Y.length!==_.length)throw new J.InvalidArgument("Arguments objects and keys must have the same length");var ye=_.length,be=be&&ue?_.map(ou(be)):_;return H.core.mutate({trans:ae,type:"put",keys:Y,values:be,wantResults:ne}).then(function(Ee){var me=Ee.numFailures,Ie=Ee.results,ve=Ee.lastResult,Ee=Ee.failures;if(me===0)return ne?Ie:ve;throw new W("".concat(H.name,".bulkPut(): ").concat(me," of ").concat(ye," operations failed"),Ee)})})},di.prototype.bulkUpdate=function(_){var S=this,L=this.core,H=_.map(function(ae){return ae.key}),Y=_.map(function(ae){return ae.changes}),ne=[];return this._trans("readwrite",function(ae){return L.getMany({trans:ae,keys:H,cache:"clone"}).then(function(ue){var ye=[],be=[];_.forEach(function(me,Ie){var ve=me.key,Ee=me.changes,Te=ue[Ie];if(Te){for(var Ce=0,Pe=Object.keys(Ee);Ce<Pe.length;Ce++){var Re=Pe[Ce],De=Ee[Re];if(Re===S.schema.primKey.keyPath){if(Ht(De,ve)!==0)throw new J.Constraint("Cannot update primary key in bulkUpdate()")}else A(Te,Re,De)}ne.push(Ie),ye.push(ve),be.push(Te)}});var Ae=ye.length;return L.mutate({trans:ae,type:"put",keys:ye,values:be,updates:{keys:H,changeSpecs:Y}}).then(function(me){var Ie=me.numFailures,ve=me.failures;if(Ie===0)return Ae;for(var Ee=0,Te=Object.keys(ve);Ee<Te.length;Ee++){var Ce,Pe=Te[Ee],Re=ne[Number(Pe)];Re!=null&&(Ce=ve[Pe],delete ve[Pe],ve[Re]=Ce)}throw new W("".concat(S.name,".bulkUpdate(): ").concat(Ie," of ").concat(Ae," operations failed"),ve)})})})},di.prototype.bulkDelete=function(_){var S=this,L=_.length;return this._trans("readwrite",function(H){return S.core.mutate({trans:H,type:"delete",keys:_})}).then(function(ae){var Y=ae.numFailures,ne=ae.lastResult,ae=ae.failures;if(Y===0)return ne;throw new W("".concat(S.name,".bulkDelete(): ").concat(Y," of ").concat(L," operations failed"),ae)})},di);function di(){}function Gc(_){function S(ae,ue){if(ue){for(var ye=arguments.length,be=new Array(ye-1);--ye;)be[ye-1]=arguments[ye];return L[ae].subscribe.apply(null,be),_}if(typeof ae=="string")return L[ae]}var L={};S.addEventType=ne;for(var H=1,Y=arguments.length;H<Y;++H)ne(arguments[H]);return S;function ne(ae,ue,ye){if(typeof ae!="object"){var be;ue=ue||le;var Ae={subscribers:[],fire:ye=ye||de,subscribe:function(me){Ae.subscribers.indexOf(me)===-1&&(Ae.subscribers.push(me),Ae.fire=ue(Ae.fire,me))},unsubscribe:function(me){Ae.subscribers=Ae.subscribers.filter(function(Ie){return Ie!==me}),Ae.fire=Ae.subscribers.reduce(ue,ye)}};return L[ae]=S[ae]=Ae}o(be=ae).forEach(function(me){var Ie=be[me];if(a(Ie))ne(me,be[me][0],be[me][1]);else{if(Ie!=="asap")throw new J.InvalidArgument("Invalid event config");var ve=ne(me,fe,function(){for(var Ee=arguments.length,Te=new Array(Ee);Ee--;)Te[Ee]=arguments[Ee];ve.subscribers.forEach(function(Ce){w(function(){Ce.apply(null,Te)})})})}})}}function Wc(_,S){return m(S).from({prototype:_}),S}function el(_,S){return!(_.filter||_.algorithm||_.or)&&(S?_.justLimit:!_.replayFilter)}function Dm(_,S){_.filter=Xo(_.filter,S)}function Lm(_,S,L){var H=_.replayFilter;_.replayFilter=H?function(){return Xo(H(),S())}:S,_.justLimit=L&&!H}function au(_,S){if(_.isPrimKey)return S.primaryKey;var L=S.getIndexByKeyPath(_.index);if(!L)throw new J.Schema("KeyPath "+_.index+" on object store "+S.name+" is not indexed");return L}function V_(_,S,L){var H=au(_,S.schema);return S.openCursor({trans:L,values:!_.keysOnly,reverse:_.dir==="prev",unique:!!_.unique,query:{index:H,range:_.range}})}function lu(_,S,L,H){var Y=_.replayFilter?Xo(_.filter,_.replayFilter()):_.filter;if(_.or){var ne={},ae=function(ue,ye,be){var Ae,me;Y&&!Y(ye,be,function(Ie){return ye.stop(Ie)},function(Ie){return ye.fail(Ie)})||((me=""+(Ae=ye.primaryKey))=="[object ArrayBuffer]"&&(me=""+new Uint8Array(Ae)),h(ne,me)||(ne[me]=!0,S(ue,ye,be)))};return Promise.all([_.or._iterate(ae,L),j_(V_(_,H,L),_.algorithm,ae,!_.keysOnly&&_.valueMapper)])}return j_(V_(_,H,L),Xo(_.algorithm,Y),S,!_.keysOnly&&_.valueMapper)}function j_(_,S,L,H){var Y=ii(H?function(ne,ae,ue){return L(H(ne),ae,ue)}:L);return _.then(function(ne){if(ne)return ne.start(function(){var ae=function(){return ne.continue()};S&&!S(ne,function(ue){return ae=ue},function(ue){ne.stop(ue),ae=de},function(ue){ne.fail(ue),ae=de})||Y(ne.value,ne,function(ue){return ae=ue}),ae()})})}var gr=Symbol(),Yc=(H_.prototype.execute=function(_){if(this.add!==void 0){var S=this.add;if(a(S))return n(n([],a(_)?_:[],!0),S).sort();if(typeof S=="number")return(Number(_)||0)+S;if(typeof S=="bigint")try{return BigInt(_)+S}catch{return BigInt(0)+S}throw new TypeError("Invalid term ".concat(S))}if(this.remove!==void 0){var L=this.remove;if(a(L))return a(_)?_.filter(function(H){return!L.includes(H)}).sort():[];if(typeof L=="number")return Number(_)-L;if(typeof L=="bigint")try{return BigInt(_)-L}catch{return BigInt(0)-L}throw new TypeError("Invalid subtrahend ".concat(L))}return S=(S=this.replacePrefix)===null||S===void 0?void 0:S[0],S&&typeof _=="string"&&_.startsWith(S)?this.replacePrefix[1]+_.substring(S.length):_},H_);function H_(_){Object.assign(this,_)}var L2=(Wt.prototype._read=function(_,S){var L=this._ctx;return L.error?L.table._trans(null,Oi.bind(null,L.error)):L.table._trans("readonly",_).then(S)},Wt.prototype._write=function(_){var S=this._ctx;return S.error?S.table._trans(null,Oi.bind(null,S.error)):S.table._trans("readwrite",_,"locked")},Wt.prototype._addAlgorithm=function(_){var S=this._ctx;S.algorithm=Xo(S.algorithm,_)},Wt.prototype._iterate=function(_,S){return lu(this._ctx,_,S,this._ctx.table.core)},Wt.prototype.clone=function(_){var S=Object.create(this.constructor.prototype),L=Object.create(this._ctx);return _&&l(L,_),S._ctx=L,S},Wt.prototype.raw=function(){return this._ctx.valueMapper=null,this},Wt.prototype.each=function(_){var S=this._ctx;return this._read(function(L){return lu(S,_,L,S.table.core)})},Wt.prototype.count=function(_){var S=this;return this._read(function(L){var H=S._ctx,Y=H.table.core;if(el(H,!0))return Y.count({trans:L,query:{index:au(H,Y.schema),range:H.range}}).then(function(ae){return Math.min(ae,H.limit)});var ne=0;return lu(H,function(){return++ne,!1},L,Y).then(function(){return ne})}).then(_)},Wt.prototype.sortBy=function(_,S){var L=_.split(".").reverse(),H=L[0],Y=L.length-1;function ne(ye,be){return be?ne(ye[L[be]],be-1):ye[H]}var ae=this._ctx.dir==="next"?1:-1;function ue(ye,be){return ye=ne(ye,Y),be=ne(be,Y),ye<be?-ae:be<ye?ae:0}return this.toArray(function(ye){return ye.sort(ue)}).then(S)},Wt.prototype.toArray=function(_){var S=this;return this._read(function(L){var H=S._ctx;if(H.dir==="next"&&el(H,!0)&&0<H.limit){var Y=H.valueMapper,ne=au(H,H.table.core.schema);return H.table.core.query({trans:L,limit:H.limit,values:!0,query:{index:ne,range:H.range}}).then(function(ue){return ue=ue.result,Y?ue.map(Y):ue})}var ae=[];return lu(H,function(ue){return ae.push(ue)},L,H.table.core).then(function(){return ae})},_)},Wt.prototype.offset=function(_){var S=this._ctx;return _<=0||(S.offset+=_,el(S)?Lm(S,function(){var L=_;return function(H,Y){return L===0||(L===1?--L:Y(function(){H.advance(L),L=0}),!1)}}):Lm(S,function(){var L=_;return function(){return--L<0}})),this},Wt.prototype.limit=function(_){return this._ctx.limit=Math.min(this._ctx.limit,_),Lm(this._ctx,function(){var S=_;return function(L,H,Y){return--S<=0&&H(Y),0<=S}},!0),this},Wt.prototype.until=function(_,S){return Dm(this._ctx,function(L,H,Y){return!_(L.value)||(H(Y),S)}),this},Wt.prototype.first=function(_){return this.limit(1).toArray(function(S){return S[0]}).then(_)},Wt.prototype.last=function(_){return this.reverse().first(_)},Wt.prototype.filter=function(_){var S;return Dm(this._ctx,function(L){return _(L.value)}),(S=this._ctx).isMatch=Xo(S.isMatch,_),this},Wt.prototype.and=function(_){return this.filter(_)},Wt.prototype.or=function(_){return new this.db.WhereClause(this._ctx.table,_,this)},Wt.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},Wt.prototype.desc=function(){return this.reverse()},Wt.prototype.eachKey=function(_){var S=this._ctx;return S.keysOnly=!S.isMatch,this.each(function(L,H){_(H.key,H)})},Wt.prototype.eachUniqueKey=function(_){return this._ctx.unique="unique",this.eachKey(_)},Wt.prototype.eachPrimaryKey=function(_){var S=this._ctx;return S.keysOnly=!S.isMatch,this.each(function(L,H){_(H.primaryKey,H)})},Wt.prototype.keys=function(_){var S=this._ctx;S.keysOnly=!S.isMatch;var L=[];return this.each(function(H,Y){L.push(Y.key)}).then(function(){return L}).then(_)},Wt.prototype.primaryKeys=function(_){var S=this._ctx;if(S.dir==="next"&&el(S,!0)&&0<S.limit)return this._read(function(H){var Y=au(S,S.table.core.schema);return S.table.core.query({trans:H,values:!1,limit:S.limit,query:{index:Y,range:S.range}})}).then(function(H){return H.result}).then(_);S.keysOnly=!S.isMatch;var L=[];return this.each(function(H,Y){L.push(Y.primaryKey)}).then(function(){return L}).then(_)},Wt.prototype.uniqueKeys=function(_){return this._ctx.unique="unique",this.keys(_)},Wt.prototype.firstKey=function(_){return this.limit(1).keys(function(S){return S[0]}).then(_)},Wt.prototype.lastKey=function(_){return this.reverse().firstKey(_)},Wt.prototype.distinct=function(){var _=this._ctx,_=_.index&&_.table.schema.idxByName[_.index];if(!_||!_.multi)return this;var S={};return Dm(this._ctx,function(Y){var H=Y.primaryKey.toString(),Y=h(S,H);return S[H]=!0,!Y}),this},Wt.prototype.modify=function(_){var S=this,L=this._ctx;return this._write(function(H){var Y,ne,ae;ae=typeof _=="function"?_:(Y=o(_),ne=Y.length,function(Ce){for(var Pe=!1,Re=0;Re<ne;++Re){var De=Y[Re],Ve=_[De],Xe=C(Ce,De);Ve instanceof Yc?(A(Ce,De,Ve.execute(Xe)),Pe=!0):Xe!==Ve&&(A(Ce,De,Ve),Pe=!0)}return Pe});function ue(Ce,De){var Re=De.failures,De=De.numFailures;Ee+=Ce-De;for(var Ve=0,Xe=o(Re);Ve<Xe.length;Ve++){var et=Xe[Ve];ve.push(Re[et])}}var ye=L.table.core,be=ye.schema.primaryKey,Ae=be.outbound,me=be.extractKey,Ie=S.db._options.modifyChunkSize||200,ve=[],Ee=0,Te=[];return S.clone().primaryKeys().then(function(Ce){function Pe(De){var Ve=Math.min(Ie,Ce.length-De);return ye.getMany({trans:H,keys:Ce.slice(De,De+Ve),cache:"immutable"}).then(function(Xe){for(var et=[],Ke=[],Je=Ae?[]:null,tt=[],Ye=0;Ye<Ve;++Ye){var xt=Xe[Ye],St={value:V(xt),primKey:Ce[De+Ye]};ae.call(St,St.value,St)!==!1&&(St.value==null?tt.push(Ce[De+Ye]):Ae||Ht(me(xt),me(St.value))===0?(Ke.push(St.value),Ae&&Je.push(Ce[De+Ye])):(tt.push(Ce[De+Ye]),et.push(St.value)))}return Promise.resolve(0<et.length&&ye.mutate({trans:H,type:"add",values:et}).then(function(Lt){for(var Ot in Lt.failures)tt.splice(parseInt(Ot),1);ue(et.length,Lt)})).then(function(){return(0<Ke.length||Re&&typeof _=="object")&&ye.mutate({trans:H,type:"put",keys:Je,values:Ke,criteria:Re,changeSpec:typeof _!="function"&&_,isAdditionalChunk:0<De}).then(function(Lt){return ue(Ke.length,Lt)})}).then(function(){return(0<tt.length||Re&&_===Fm)&&ye.mutate({trans:H,type:"delete",keys:tt,criteria:Re,isAdditionalChunk:0<De}).then(function(Lt){return ue(tt.length,Lt)})}).then(function(){return Ce.length>De+Ve&&Pe(De+Ie)})})}var Re=el(L)&&L.limit===1/0&&(typeof _!="function"||_===Fm)&&{index:L.index,range:L.range};return Pe(0).then(function(){if(0<ve.length)throw new U("Error modifying one or more objects",ve,Ee,Te);return Ce.length})})})},Wt.prototype.delete=function(){var _=this._ctx,S=_.range;return el(_)&&(_.isPrimKey||S.type===3)?this._write(function(L){var H=_.table.core.schema.primaryKey,Y=S;return _.table.core.count({trans:L,query:{index:H,range:Y}}).then(function(ne){return _.table.core.mutate({trans:L,type:"deleteRange",range:Y}).then(function(ae){var ue=ae.failures;if(ae.lastResult,ae.results,ae=ae.numFailures,ae)throw new U("Could not delete some values",Object.keys(ue).map(function(ye){return ue[ye]}),ne-ae);return ne-ae})})}):this.modify(Fm)},Wt);function Wt(){}var Fm=function(_,S){return S.value=null};function F2(_,S){return _<S?-1:_===S?0:1}function k2(_,S){return S<_?-1:_===S?0:1}function Fn(_,S,L){return _=_ instanceof W_?new _.Collection(_):_,_._ctx.error=new(L||TypeError)(S),_}function tl(_){return new _.Collection(_,function(){return G_("")}).limit(0)}function cu(_,S,L,H){var Y,ne,ae,ue,ye,be,Ae,me=L.length;if(!L.every(function(Ee){return typeof Ee=="string"}))return Fn(_,F_);function Ie(Ee){Y=Ee==="next"?function(Ce){return Ce.toUpperCase()}:function(Ce){return Ce.toLowerCase()},ne=Ee==="next"?function(Ce){return Ce.toLowerCase()}:function(Ce){return Ce.toUpperCase()},ae=Ee==="next"?F2:k2;var Te=L.map(function(Ce){return{lower:ne(Ce),upper:Y(Ce)}}).sort(function(Ce,Pe){return ae(Ce.lower,Pe.lower)});ue=Te.map(function(Ce){return Ce.upper}),ye=Te.map(function(Ce){return Ce.lower}),Ae=(be=Ee)==="next"?"":H}Ie("next"),_=new _.Collection(_,function(){return qr(ue[0],ye[me-1]+H)}),_._ondirectionchange=function(Ee){Ie(Ee)};var ve=0;return _._addAlgorithm(function(Ee,Te,Ce){var Pe=Ee.key;if(typeof Pe!="string")return!1;var Re=ne(Pe);if(S(Re,ye,ve))return!0;for(var De=null,Ve=ve;Ve<me;++Ve){var Xe=function(et,Ke,Je,tt,Ye,xt){for(var St=Math.min(et.length,tt.length),Lt=-1,Ot=0;Ot<St;++Ot){var Es=Ke[Ot];if(Es!==tt[Ot])return Ye(et[Ot],Je[Ot])<0?et.substr(0,Ot)+Je[Ot]+Je.substr(Ot+1):Ye(et[Ot],tt[Ot])<0?et.substr(0,Ot)+tt[Ot]+Je.substr(Ot+1):0<=Lt?et.substr(0,Lt)+Ke[Lt]+Je.substr(Lt+1):null;Ye(et[Ot],Es)<0&&(Lt=Ot)}return St<tt.length&&xt==="next"?et+Je.substr(et.length):St<et.length&&xt==="prev"?et.substr(0,Je.length):Lt<0?null:et.substr(0,Lt)+tt[Lt]+Je.substr(Lt+1)}(Pe,Re,ue[Ve],ye[Ve],ae,be);Xe===null&&De===null?ve=Ve+1:(De===null||0<ae(De,Xe))&&(De=Xe)}return Te(De!==null?function(){Ee.continue(De+Ae)}:Ce),!1}),_}function qr(_,S,L,H){return{type:2,lower:_,upper:S,lowerOpen:L,upperOpen:H}}function G_(_){return{type:1,lower:_,upper:_}}var W_=(Object.defineProperty(ji.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),ji.prototype.between=function(_,S,L,H){L=L!==!1,H=H===!0;try{return 0<this._cmp(_,S)||this._cmp(_,S)===0&&(L||H)&&(!L||!H)?tl(this):new this.Collection(this,function(){return qr(_,S,!L,!H)})}catch{return Fn(this,mr)}},ji.prototype.equals=function(_){return _==null?Fn(this,mr):new this.Collection(this,function(){return G_(_)})},ji.prototype.above=function(_){return _==null?Fn(this,mr):new this.Collection(this,function(){return qr(_,void 0,!0)})},ji.prototype.aboveOrEqual=function(_){return _==null?Fn(this,mr):new this.Collection(this,function(){return qr(_,void 0,!1)})},ji.prototype.below=function(_){return _==null?Fn(this,mr):new this.Collection(this,function(){return qr(void 0,_,!1,!0)})},ji.prototype.belowOrEqual=function(_){return _==null?Fn(this,mr):new this.Collection(this,function(){return qr(void 0,_)})},ji.prototype.startsWith=function(_){return typeof _!="string"?Fn(this,F_):this.between(_,_+qo,!0,!0)},ji.prototype.startsWithIgnoreCase=function(_){return _===""?this.startsWith(_):cu(this,function(S,L){return S.indexOf(L[0])===0},[_],qo)},ji.prototype.equalsIgnoreCase=function(_){return cu(this,function(S,L){return S===L[0]},[_],"")},ji.prototype.anyOfIgnoreCase=function(){var _=B.apply(k,arguments);return _.length===0?tl(this):cu(this,function(S,L){return L.indexOf(S)!==-1},_,"")},ji.prototype.startsWithAnyOfIgnoreCase=function(){var _=B.apply(k,arguments);return _.length===0?tl(this):cu(this,function(S,L){return L.some(function(H){return S.indexOf(H)===0})},_,qo)},ji.prototype.anyOf=function(){var _=this,S=B.apply(k,arguments),L=this._cmp;try{S.sort(L)}catch{return Fn(this,mr)}if(S.length===0)return tl(this);var H=new this.Collection(this,function(){return qr(S[0],S[S.length-1])});H._ondirectionchange=function(ne){L=ne==="next"?_._ascending:_._descending,S.sort(L)};var Y=0;return H._addAlgorithm(function(ne,ae,ue){for(var ye=ne.key;0<L(ye,S[Y]);)if(++Y===S.length)return ae(ue),!1;return L(ye,S[Y])===0||(ae(function(){ne.continue(S[Y])}),!1)}),H},ji.prototype.notEqual=function(_){return this.inAnyRange([[-1/0,_],[_,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},ji.prototype.noneOf=function(){var _=B.apply(k,arguments);if(_.length===0)return new this.Collection(this);try{_.sort(this._ascending)}catch{return Fn(this,mr)}var S=_.reduce(function(L,H){return L?L.concat([[L[L.length-1][1],H]]):[[-1/0,H]]},null);return S.push([_[_.length-1],this.db._maxKey]),this.inAnyRange(S,{includeLowers:!1,includeUppers:!1})},ji.prototype.inAnyRange=function(Pe,S){var L=this,H=this._cmp,Y=this._ascending,ne=this._descending,ae=this._min,ue=this._max;if(Pe.length===0)return tl(this);if(!Pe.every(function(Re){return Re[0]!==void 0&&Re[1]!==void 0&&Y(Re[0],Re[1])<=0}))return Fn(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",J.InvalidArgument);var ye=!S||S.includeLowers!==!1,be=S&&S.includeUppers===!0,Ae,me=Y;function Ie(Re,De){return me(Re[0],De[0])}try{(Ae=Pe.reduce(function(Re,De){for(var Ve=0,Xe=Re.length;Ve<Xe;++Ve){var et=Re[Ve];if(H(De[0],et[1])<0&&0<H(De[1],et[0])){et[0]=ae(et[0],De[0]),et[1]=ue(et[1],De[1]);break}}return Ve===Xe&&Re.push(De),Re},[])).sort(Ie)}catch{return Fn(this,mr)}var ve=0,Ee=be?function(Re){return 0<Y(Re,Ae[ve][1])}:function(Re){return 0<=Y(Re,Ae[ve][1])},Te=ye?function(Re){return 0<ne(Re,Ae[ve][0])}:function(Re){return 0<=ne(Re,Ae[ve][0])},Ce=Ee,Pe=new this.Collection(this,function(){return qr(Ae[0][0],Ae[Ae.length-1][1],!ye,!be)});return Pe._ondirectionchange=function(Re){me=Re==="next"?(Ce=Ee,Y):(Ce=Te,ne),Ae.sort(Ie)},Pe._addAlgorithm(function(Re,De,Ve){for(var Xe,et=Re.key;Ce(et);)if(++ve===Ae.length)return De(Ve),!1;return!Ee(Xe=et)&&!Te(Xe)||(L._cmp(et,Ae[ve][1])===0||L._cmp(et,Ae[ve][0])===0||De(function(){me===Y?Re.continue(Ae[ve][0]):Re.continue(Ae[ve][1])}),!1)}),Pe},ji.prototype.startsWithAnyOf=function(){var _=B.apply(k,arguments);return _.every(function(S){return typeof S=="string"})?_.length===0?tl(this):this.inAnyRange(_.map(function(S){return[S,S+qo]})):Fn(this,"startsWithAnyOf() only works with strings")},ji);function ji(){}function zs(_){return ii(function(S){return qc(S),_(S.target.error),!1})}function qc(_){_.stopPropagation&&_.stopPropagation(),_.preventDefault&&_.preventDefault()}var Xc="storagemutated",km="x-storagemutated-1",Xr=Gc(null,Xc),N2=(Vs.prototype._lock=function(){return y(!ot.global),++this._reculock,this._reculock!==1||ot.global||(ot.lockOwnerFor=this),this},Vs.prototype._unlock=function(){if(y(!ot.global),--this._reculock==0)for(ot.global||(ot.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var _=this._blockedFuncs.shift();try{Yo(_[1],_[0])}catch{}}return this},Vs.prototype._locked=function(){return this._reculock&&ot.lockOwnerFor!==this},Vs.prototype.create=function(_){var S=this;if(!this.mode)return this;var L=this.db.idbdb,H=this.db._state.dbOpenError;if(y(!this.idbtrans),!_&&!L)switch(H&&H.name){case"DatabaseClosedError":throw new J.DatabaseClosed(H);case"MissingAPIError":throw new J.MissingAPI(H.message,H);default:throw new J.OpenFailed(H)}if(!this.active)throw new J.TransactionInactive;return y(this._completion._state===null),(_=this.idbtrans=_||(this.db.core||L).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=ii(function(Y){qc(Y),S._reject(_.error)}),_.onabort=ii(function(Y){qc(Y),S.active&&S._reject(new J.Abort(_.error)),S.active=!1,S.on("abort").fire(Y)}),_.oncomplete=ii(function(){S.active=!1,S._resolve(),"mutatedParts"in _&&Xr.storagemutated.fire(_.mutatedParts)}),this},Vs.prototype._promise=function(_,S,L){var H=this;if(_==="readwrite"&&this.mode!=="readwrite")return Oi(new J.ReadOnly("Transaction is readonly"));if(!this.active)return Oi(new J.TransactionInactive);if(this._locked())return new he(function(ne,ae){H._blockedFuncs.push([function(){H._promise(_,S,L).then(ne,ae)},ot])});if(L)return Si(function(){var ne=new he(function(ae,ue){H._lock();var ye=S(ae,ue,H);ye&&ye.then&&ye.then(ae,ue)});return ne.finally(function(){return H._unlock()}),ne._lib=!0,ne});var Y=new he(function(ne,ae){var ue=S(ne,ae,H);ue&&ue.then&&ue.then(ne,ae)});return Y._lib=!0,Y},Vs.prototype._root=function(){return this.parent?this.parent._root():this},Vs.prototype.waitFor=function(_){var S,L=this._root(),H=he.resolve(_);L._waitingFor?L._waitingFor=L._waitingFor.then(function(){return H}):(L._waitingFor=H,L._waitingQueue=[],S=L.idbtrans.objectStore(L.storeNames[0]),function ne(){for(++L._spinCount;L._waitingQueue.length;)L._waitingQueue.shift()();L._waitingFor&&(S.get(-1/0).onsuccess=ne)}());var Y=L._waitingFor;return new he(function(ne,ae){H.then(function(ue){return L._waitingQueue.push(ii(ne.bind(null,ue)))},function(ue){return L._waitingQueue.push(ii(ae.bind(null,ue)))}).finally(function(){L._waitingFor===Y&&(L._waitingFor=null)})})},Vs.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new J.Abort))},Vs.prototype.table=function(_){var S=this._memoizedTables||(this._memoizedTables={});if(h(S,_))return S[_];var L=this.schema[_];if(!L)throw new J.NotFound("Table "+_+" not part of transaction");return L=new this.db.Table(_,L,this),L.core=this.db.core.table(_),S[_]=L},Vs);function Vs(){}function Nm(_,S,L,H,Y,ne,ae){return{name:_,keyPath:S,unique:L,multi:H,auto:Y,compound:ne,src:(L&&!ae?"&":"")+(H?"*":"")+(Y?"++":"")+Y_(S)}}function Y_(_){return typeof _=="string"?_:_?"["+[].join.call(_,"+")+"]":""}function Um(_,S,L){return{name:_,primKey:S,indexes:L,mappedClass:null,idxByName:(H=function(Y){return[Y.name,Y]},L.reduce(function(Y,ne,ae){return ae=H(ne,ae),ae&&(Y[ae[0]]=ae[1]),Y},{}))};var H}var Kc=function(_){try{return _.only([[]]),Kc=function(){return[[]]},[[]]}catch{return Kc=function(){return qo},qo}};function Bm(_){return _==null?function(){}:typeof _=="string"?(S=_).split(".").length===1?function(L){return L[S]}:function(L){return C(L,S)}:function(L){return C(L,_)};var S}function q_(_){return[].slice.call(_)}var U2=0;function $c(_){return _==null?":id":typeof _=="string"?_:"[".concat(_.join("+"),"]")}function B2(_,S,ye){function H(Ce){if(Ce.type===3)return null;if(Ce.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var ve=Ce.lower,Ee=Ce.upper,Te=Ce.lowerOpen,Ce=Ce.upperOpen;return ve===void 0?Ee===void 0?null:S.upperBound(Ee,!!Ce):Ee===void 0?S.lowerBound(ve,!!Te):S.bound(ve,Ee,!!Te,!!Ce)}function Y(Ie){var ve,Ee=Ie.name;return{name:Ee,schema:Ie,mutate:function(Te){var Ce=Te.trans,Pe=Te.type,Re=Te.keys,De=Te.values,Ve=Te.range;return new Promise(function(Xe,et){Xe=ii(Xe);var Ke=Ce.objectStore(Ee),Je=Ke.keyPath==null,tt=Pe==="put"||Pe==="add";if(!tt&&Pe!=="delete"&&Pe!=="deleteRange")throw new Error("Invalid operation type: "+Pe);var Ye,xt=(Re||De||{length:1}).length;if(Re&&De&&Re.length!==De.length)throw new Error("Given keys array must have same length as given values array.");if(xt===0)return Xe({numFailures:0,failures:{},results:[],lastResult:void 0});function St(wn){++Es,qc(wn)}var Lt=[],Ot=[],Es=0;if(Pe==="deleteRange"){if(Ve.type===4)return Xe({numFailures:Es,failures:Ot,results:[],lastResult:void 0});Ve.type===3?Lt.push(Ye=Ke.clear()):Lt.push(Ye=Ke.delete(H(Ve)))}else{var Je=tt?Je?[De,Re]:[De,null]:[Re,null],Mt=Je[0],un=Je[1];if(tt)for(var pn=0;pn<xt;++pn)Lt.push(Ye=un&&un[pn]!==void 0?Ke[Pe](Mt[pn],un[pn]):Ke[Pe](Mt[pn])),Ye.onerror=St;else for(pn=0;pn<xt;++pn)Lt.push(Ye=Ke[Pe](Mt[pn])),Ye.onerror=St}function Eu(wn){wn=wn.target.result,Lt.forEach(function(Zo,ng){return Zo.error!=null&&(Ot[ng]=Zo.error)}),Xe({numFailures:Es,failures:Ot,results:Pe==="delete"?Re:Lt.map(function(Zo){return Zo.result}),lastResult:wn})}Ye.onerror=function(wn){St(wn),Eu(wn)},Ye.onsuccess=Eu})},getMany:function(Te){var Ce=Te.trans,Pe=Te.keys;return new Promise(function(Re,De){Re=ii(Re);for(var Ve,Xe=Ce.objectStore(Ee),et=Pe.length,Ke=new Array(et),Je=0,tt=0,Ye=function(Lt){Lt=Lt.target,Ke[Lt._pos]=Lt.result,++tt===Je&&Re(Ke)},xt=zs(De),St=0;St<et;++St)Pe[St]!=null&&((Ve=Xe.get(Pe[St]))._pos=St,Ve.onsuccess=Ye,Ve.onerror=xt,++Je);Je===0&&Re(Ke)})},get:function(Te){var Ce=Te.trans,Pe=Te.key;return new Promise(function(Re,De){Re=ii(Re);var Ve=Ce.objectStore(Ee).get(Pe);Ve.onsuccess=function(Xe){return Re(Xe.target.result)},Ve.onerror=zs(De)})},query:(ve=be,function(Te){return new Promise(function(Ce,Pe){Ce=ii(Ce);var Re,De,Ve,Je=Te.trans,Xe=Te.values,et=Te.limit,Ye=Te.query,Ke=et===1/0?void 0:et,tt=Ye.index,Ye=Ye.range,Je=Je.objectStore(Ee),tt=tt.isPrimaryKey?Je:Je.index(tt.name),Ye=H(Ye);if(et===0)return Ce({result:[]});ve?((Ke=Xe?tt.getAll(Ye,Ke):tt.getAllKeys(Ye,Ke)).onsuccess=function(xt){return Ce({result:xt.target.result})},Ke.onerror=zs(Pe)):(Re=0,De=!Xe&&"openKeyCursor"in tt?tt.openKeyCursor(Ye):tt.openCursor(Ye),Ve=[],De.onsuccess=function(xt){var St=De.result;return St?(Ve.push(Xe?St.value:St.primaryKey),++Re===et?Ce({result:Ve}):void St.continue()):Ce({result:Ve})},De.onerror=zs(Pe))})}),openCursor:function(Te){var Ce=Te.trans,Pe=Te.values,Re=Te.query,De=Te.reverse,Ve=Te.unique;return new Promise(function(Xe,et){Xe=ii(Xe);var tt=Re.index,Ke=Re.range,Je=Ce.objectStore(Ee),Je=tt.isPrimaryKey?Je:Je.index(tt.name),tt=De?Ve?"prevunique":"prev":Ve?"nextunique":"next",Ye=!Pe&&"openKeyCursor"in Je?Je.openKeyCursor(H(Ke),tt):Je.openCursor(H(Ke),tt);Ye.onerror=zs(et),Ye.onsuccess=ii(function(xt){var St,Lt,Ot,Es,Mt=Ye.result;Mt?(Mt.___id=++U2,Mt.done=!1,St=Mt.continue.bind(Mt),Lt=(Lt=Mt.continuePrimaryKey)&&Lt.bind(Mt),Ot=Mt.advance.bind(Mt),Es=function(){throw new Error("Cursor not stopped")},Mt.trans=Ce,Mt.stop=Mt.continue=Mt.continuePrimaryKey=Mt.advance=function(){throw new Error("Cursor not started")},Mt.fail=ii(et),Mt.next=function(){var un=this,pn=1;return this.start(function(){return pn--?un.continue():un.stop()}).then(function(){return un})},Mt.start=function(un){function pn(){if(Ye.result)try{un()}catch(wn){Mt.fail(wn)}else Mt.done=!0,Mt.start=function(){throw new Error("Cursor behind last entry")},Mt.stop()}var Eu=new Promise(function(wn,Zo){wn=ii(wn),Ye.onerror=zs(Zo),Mt.fail=Zo,Mt.stop=function(ng){Mt.stop=Mt.continue=Mt.continuePrimaryKey=Mt.advance=Es,wn(ng)}});return Ye.onsuccess=ii(function(wn){Ye.onsuccess=pn,pn()}),Mt.continue=St,Mt.continuePrimaryKey=Lt,Mt.advance=Ot,pn(),Eu},Xe(Mt)):Xe(null)},et)})},count:function(Te){var Ce=Te.query,Pe=Te.trans,Re=Ce.index,De=Ce.range;return new Promise(function(Ve,Xe){var et=Pe.objectStore(Ee),Ke=Re.isPrimaryKey?et:et.index(Re.name),et=H(De),Ke=et?Ke.count(et):Ke.count();Ke.onsuccess=ii(function(Je){return Ve(Je.target.result)}),Ke.onerror=zs(Xe)})}}}var ne,ae,ue,Ae=(ae=ye,ue=q_((ne=_).objectStoreNames),{schema:{name:ne.name,tables:ue.map(function(Ie){return ae.objectStore(Ie)}).map(function(Ie){var ve=Ie.keyPath,Ce=Ie.autoIncrement,Ee=a(ve),Te={},Ce={name:Ie.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:ve==null,compound:Ee,keyPath:ve,autoIncrement:Ce,unique:!0,extractKey:Bm(ve)},indexes:q_(Ie.indexNames).map(function(Pe){return Ie.index(Pe)}).map(function(Ve){var Re=Ve.name,De=Ve.unique,Xe=Ve.multiEntry,Ve=Ve.keyPath,Xe={name:Re,compound:a(Ve),keyPath:Ve,unique:De,multiEntry:Xe,extractKey:Bm(Ve)};return Te[$c(Ve)]=Xe}),getIndexByKeyPath:function(Pe){return Te[$c(Pe)]}};return Te[":id"]=Ce.primaryKey,ve!=null&&(Te[$c(ve)]=Ce.primaryKey),Ce})},hasGetAll:0<ue.length&&"getAll"in ae.objectStore(ue[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}),ye=Ae.schema,be=Ae.hasGetAll,Ae=ye.tables.map(Y),me={};return Ae.forEach(function(Ie){return me[Ie.name]=Ie}),{stack:"dbcore",transaction:_.transaction.bind(_),table:function(Ie){if(!me[Ie])throw new Error("Table '".concat(Ie,"' not found"));return me[Ie]},MIN_KEY:-1/0,MAX_KEY:Kc(S),schema:ye}}function z2(_,S,L,H){var Y=L.IDBKeyRange;return L.indexedDB,{dbcore:(H=B2(S,Y,H),_.dbcore.reduce(function(ne,ae){return ae=ae.create,i(i({},ne),ae(ne))},H))}}function hu(_,H){var L=H.db,H=z2(_._middlewares,L,_._deps,H);_.core=H.dbcore,_.tables.forEach(function(Y){var ne=Y.name;_.core.schema.tables.some(function(ae){return ae.name===ne})&&(Y.core=_.core.table(ne),_[ne]instanceof _.Table&&(_[ne].core=Y.core))})}function du(_,S,L,H){L.forEach(function(Y){var ne=H[Y];S.forEach(function(ae){var ue=function ye(be,Ae){return g(be,Ae)||(be=c(be))&&ye(be,Ae)}(ae,Y);(!ue||"value"in ue&&ue.value===void 0)&&(ae===_.Transaction.prototype||ae instanceof _.Transaction?f(ae,Y,{get:function(){return this.table(Y)},set:function(ye){p(this,Y,{value:ye,writable:!0,configurable:!0,enumerable:!0})}}):ae[Y]=new _.Table(Y,ne))})})}function zm(_,S){S.forEach(function(L){for(var H in L)L[H]instanceof _.Table&&delete L[H]})}function V2(_,S){return _._cfg.version-S._cfg.version}function j2(_,S,L,H){var Y=_._dbSchema;L.objectStoreNames.contains("$meta")&&!Y.$meta&&(Y.$meta=Um("$meta",K_("")[0],[]),_._storeNames.push("$meta"));var ne=_._createTransaction("readwrite",_._storeNames,Y);ne.create(L),ne._completion.catch(H);var ae=ne._reject.bind(ne),ue=ot.transless||ot;Si(function(){return ot.trans=ne,ot.transless=ue,S!==0?(hu(_,L),be=S,((ye=ne).storeNames.includes("$meta")?ye.table("$meta").get("version").then(function(Ae){return Ae??be}):he.resolve(be)).then(function(Ae){return Ie=Ae,ve=ne,Ee=L,Te=[],Ae=(me=_)._versions,Ce=me._dbSchema=pu(0,me.idbdb,Ee),(Ae=Ae.filter(function(Pe){return Pe._cfg.version>=Ie})).length!==0?(Ae.forEach(function(Pe){Te.push(function(){var Re=Ce,De=Pe._cfg.dbschema;fu(me,Re,Ee),fu(me,De,Ee),Ce=me._dbSchema=De;var Ve=Vm(Re,De);Ve.add.forEach(function(tt){jm(Ee,tt[0],tt[1].primKey,tt[1].indexes)}),Ve.change.forEach(function(tt){if(tt.recreate)throw new J.Upgrade("Not yet support for changing primary key");var Ye=Ee.objectStore(tt.name);tt.add.forEach(function(xt){return uu(Ye,xt)}),tt.change.forEach(function(xt){Ye.deleteIndex(xt.name),uu(Ye,xt)}),tt.del.forEach(function(xt){return Ye.deleteIndex(xt)})});var Xe=Pe._cfg.contentUpgrade;if(Xe&&Pe._cfg.version>Ie){hu(me,Ee),ve._memoizedTables={};var et=D(De);Ve.del.forEach(function(tt){et[tt]=Re[tt]}),zm(me,[me.Transaction.prototype]),du(me,[me.Transaction.prototype],o(et),et),ve.schema=et;var Ke,Je=R(Xe);return Je&&qn(),Ve=he.follow(function(){var tt;(Ke=Xe(ve))&&Je&&(tt=Xn.bind(null,null),Ke.then(tt,tt))}),Ke&&typeof Ke.then=="function"?he.resolve(Ke):Ve.then(function(){return Ke})}}),Te.push(function(Re){var De,Ve,Xe=Pe._cfg.dbschema;De=Xe,Ve=Re,[].slice.call(Ve.db.objectStoreNames).forEach(function(et){return De[et]==null&&Ve.db.deleteObjectStore(et)}),zm(me,[me.Transaction.prototype]),du(me,[me.Transaction.prototype],me._storeNames,me._dbSchema),ve.schema=me._dbSchema}),Te.push(function(Re){me.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(me.idbdb.version/10)===Pe._cfg.version?(me.idbdb.deleteObjectStore("$meta"),delete me._dbSchema.$meta,me._storeNames=me._storeNames.filter(function(De){return De!=="$meta"})):Re.objectStore("$meta").put(Pe._cfg.version,"version"))})}),function Pe(){return Te.length?he.resolve(Te.shift()(ve.idbtrans)).then(Pe):he.resolve()}().then(function(){X_(Ce,Ee)})):he.resolve();var me,Ie,ve,Ee,Te,Ce}).catch(ae)):(o(Y).forEach(function(Ae){jm(L,Ae,Y[Ae].primKey,Y[Ae].indexes)}),hu(_,L),void he.follow(function(){return _.on.populate.fire(ne)}).catch(ae));var ye,be})}function H2(_,S){X_(_._dbSchema,S),S.db.version%10!=0||S.objectStoreNames.contains("$meta")||S.db.createObjectStore("$meta").add(Math.ceil(S.db.version/10-1),"version");var L=pu(0,_.idbdb,S);fu(_,_._dbSchema,S);for(var H=0,Y=Vm(L,_._dbSchema).change;H<Y.length;H++){var ne=function(ae){if(ae.change.length||ae.recreate)return console.warn("Unable to patch indexes of table ".concat(ae.name," because it has changes on the type of index or primary key.")),{value:void 0};var ue=S.objectStore(ae.name);ae.add.forEach(function(ye){ge&&console.debug("Dexie upgrade patch: Creating missing index ".concat(ae.name,".").concat(ye.src)),uu(ue,ye)})}(Y[H]);if(typeof ne=="object")return ne.value}}function Vm(_,S){var L,H={del:[],add:[],change:[]};for(L in _)S[L]||H.del.push(L);for(L in S){var Y=_[L],ne=S[L];if(Y){var ae={name:L,def:ne,recreate:!1,del:[],add:[],change:[]};if(""+(Y.primKey.keyPath||"")!=""+(ne.primKey.keyPath||"")||Y.primKey.auto!==ne.primKey.auto)ae.recreate=!0,H.change.push(ae);else{var ue=Y.idxByName,ye=ne.idxByName,be=void 0;for(be in ue)ye[be]||ae.del.push(be);for(be in ye){var Ae=ue[be],me=ye[be];Ae?Ae.src!==me.src&&ae.change.push(me):ae.add.push(me)}(0<ae.del.length||0<ae.add.length||0<ae.change.length)&&H.change.push(ae)}}else H.add.push([L,ne])}return H}function jm(_,S,L,H){var Y=_.db.createObjectStore(S,L.keyPath?{keyPath:L.keyPath,autoIncrement:L.auto}:{autoIncrement:L.auto});return H.forEach(function(ne){return uu(Y,ne)}),Y}function X_(_,S){o(_).forEach(function(L){S.db.objectStoreNames.contains(L)||(ge&&console.debug("Dexie: Creating missing table",L),jm(S,L,_[L].primKey,_[L].indexes))})}function uu(_,S){_.createIndex(S.name,S.keyPath,{unique:S.unique,multiEntry:S.multi})}function pu(_,S,L){var H={};return v(S.objectStoreNames,0).forEach(function(Y){for(var ne=L.objectStore(Y),ae=Nm(Y_(be=ne.keyPath),be||"",!0,!1,!!ne.autoIncrement,be&&typeof be!="string",!0),ue=[],ye=0;ye<ne.indexNames.length;++ye){var Ae=ne.index(ne.indexNames[ye]),be=Ae.keyPath,Ae=Nm(Ae.name,be,!!Ae.unique,!!Ae.multiEntry,!1,be&&typeof be!="string",!1);ue.push(Ae)}H[Y]=Um(Y,ae,ue)}),H}function fu(_,S,L){for(var H=L.db.objectStoreNames,Y=0;Y<H.length;++Y){var ne=H[Y],ae=L.objectStore(ne);_._hasGetAll="getAll"in ae;for(var ue=0;ue<ae.indexNames.length;++ue){var ye=ae.indexNames[ue],be=ae.index(ye).keyPath,Ae=typeof be=="string"?be:"["+v(be).join("+")+"]";!S[ne]||(be=S[ne].idxByName[Ae])&&(be.name=ye,delete S[ne].idxByName[Ae],S[ne].idxByName[ye]=be)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&r.WorkerGlobalScope&&r instanceof r.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(_._hasGetAll=!1)}function K_(_){return _.split(",").map(function(S,L){var H=(S=S.trim()).replace(/([&*]|\+\+)/g,""),Y=/^\[/.test(H)?H.match(/^\[(.*)\]$/)[1].split("+"):H;return Nm(H,Y||null,/\&/.test(S),/\*/.test(S),/\+\+/.test(S),a(Y),L===0)})}var G2=(mu.prototype._parseStoresSpec=function(_,S){o(_).forEach(function(L){if(_[L]!==null){var H=K_(_[L]),Y=H.shift();if(Y.unique=!0,Y.multi)throw new J.Schema("Primary key cannot be multi-valued");H.forEach(function(ne){if(ne.auto)throw new J.Schema("Only primary key can be marked as autoIncrement (++)");if(!ne.keyPath)throw new J.Schema("Index must have a name and cannot be an empty string")}),S[L]=Um(L,Y,H)}})},mu.prototype.stores=function(L){var S=this.db;this._cfg.storesSource=this._cfg.storesSource?l(this._cfg.storesSource,L):L;var L=S._versions,H={},Y={};return L.forEach(function(ne){l(H,ne._cfg.storesSource),Y=ne._cfg.dbschema={},ne._parseStoresSpec(H,Y)}),S._dbSchema=Y,zm(S,[S._allTables,S,S.Transaction.prototype]),du(S,[S._allTables,S,S.Transaction.prototype,this._cfg.tables],o(Y),Y),S._storeNames=o(Y),this},mu.prototype.upgrade=function(_){return this._cfg.contentUpgrade=xe(this._cfg.contentUpgrade||de,_),this},mu);function mu(){}function Hm(_,S){var L=_._dbNamesDB;return L||(L=_._dbNamesDB=new br(ru,{addons:[],indexedDB:_,IDBKeyRange:S})).version(1).stores({dbnames:"name"}),L.table("dbnames")}function Gm(_){return _&&typeof _.databases=="function"}function Wm(_){return Si(function(){return ot.letThrough=!0,_()})}function Ym(_){return!("from"in _)}var _n=function(_,S){if(!this){var L=new _n;return _&&"d"in _&&l(L,_),L}l(this,arguments.length?{d:1,from:_,to:1<arguments.length?S:_}:{d:0})};function Zc(_,S,L){var H=Ht(S,L);if(!isNaN(H)){if(0<H)throw RangeError();if(Ym(_))return l(_,{from:S,to:L,d:1});var Y=_.l,H=_.r;if(Ht(L,_.from)<0)return Y?Zc(Y,S,L):_.l={from:S,to:L,d:1,l:null,r:null},Z_(_);if(0<Ht(S,_.to))return H?Zc(H,S,L):_.r={from:S,to:L,d:1,l:null,r:null},Z_(_);Ht(S,_.from)<0&&(_.from=S,_.l=null,_.d=H?H.d+1:1),0<Ht(L,_.to)&&(_.to=L,_.r=null,_.d=_.l?_.l.d+1:1),L=!_.r,Y&&!_.l&&Qc(_,Y),H&&L&&Qc(_,H)}}function Qc(_,S){Ym(S)||function L(H,ye){var ne=ye.from,ae=ye.to,ue=ye.l,ye=ye.r;Zc(H,ne,ae),ue&&L(H,ue),ye&&L(H,ye)}(_,S)}function $_(_,S){var L=gu(S),H=L.next();if(H.done)return!1;for(var Y=H.value,ne=gu(_),ae=ne.next(Y.from),ue=ae.value;!H.done&&!ae.done;){if(Ht(ue.from,Y.to)<=0&&0<=Ht(ue.to,Y.from))return!0;Ht(Y.from,ue.from)<0?Y=(H=L.next(ue.from)).value:ue=(ae=ne.next(Y.from)).value}return!1}function gu(_){var S=Ym(_)?null:{s:0,n:_};return{next:function(L){for(var H=0<arguments.length;S;)switch(S.s){case 0:if(S.s=1,H)for(;S.n.l&&Ht(L,S.n.from)<0;)S={up:S,n:S.n.l,s:1};else for(;S.n.l;)S={up:S,n:S.n.l,s:1};case 1:if(S.s=2,!H||Ht(L,S.n.to)<=0)return{value:S.n,done:!1};case 2:if(S.n.r){S.s=3,S={up:S,n:S.n.r,s:0};continue}case 3:S=S.up}return{done:!0}}}}function Z_(_){var S,L,H=(((S=_.r)===null||S===void 0?void 0:S.d)||0)-(((L=_.l)===null||L===void 0?void 0:L.d)||0),Y=1<H?"r":H<-1?"l":"";Y&&(S=Y=="r"?"l":"r",L=i({},_),H=_[Y],_.from=H.from,_.to=H.to,_[Y]=H[Y],L[Y]=H[S],(_[S]=L).d=Q_(L)),_.d=Q_(_)}function Q_(L){var S=L.r,L=L.l;return(S?L?Math.max(S.d,L.d):S.d:L?L.d:0)+1}function bu(_,S){return o(S).forEach(function(L){_[L]?Qc(_[L],S[L]):_[L]=function H(Y){var ne,ae,ue={};for(ne in Y)h(Y,ne)&&(ae=Y[ne],ue[ne]=!ae||typeof ae!="object"||O.has(ae.constructor)?ae:H(ae));return ue}(S[L])}),_}function qm(_,S){return _.all||S.all||Object.keys(_).some(function(L){return S[L]&&$_(S[L],_[L])})}u(_n.prototype,((Kn={add:function(_){return Qc(this,_),this},addKey:function(_){return Zc(this,_,_),this},addKeys:function(_){var S=this;return _.forEach(function(L){return Zc(S,L,L)}),this},hasKey:function(_){var S=gu(this).next(_).value;return S&&Ht(S.from,_)<=0&&0<=Ht(S.to,_)}})[z]=function(){return gu(this)},Kn));var Ko={},Xm={},Km=!1;function vu(_){bu(Xm,_),Km||(Km=!0,setTimeout(function(){Km=!1,$m(Xm,!(Xm={}))},0))}function $m(_,S){S===void 0&&(S=!1);var L=new Set;if(_.all)for(var H=0,Y=Object.values(Ko);H<Y.length;H++)J_(ae=Y[H],_,L,S);else for(var ne in _){var ae,ue=/^idb\:\/\/(.*)\/(.*)\//.exec(ne);ue&&(ne=ue[1],ue=ue[2],(ae=Ko["idb://".concat(ne,"/").concat(ue)])&&J_(ae,_,L,S))}L.forEach(function(ye){return ye()})}function J_(_,S,L,H){for(var Y=[],ne=0,ae=Object.entries(_.queries.query);ne<ae.length;ne++){for(var ue=ae[ne],ye=ue[0],be=[],Ae=0,me=ue[1];Ae<me.length;Ae++){var Ie=me[Ae];qm(S,Ie.obsSet)?Ie.subscribers.forEach(function(Ce){return L.add(Ce)}):H&&be.push(Ie)}H&&Y.push([ye,be])}if(H)for(var ve=0,Ee=Y;ve<Ee.length;ve++){var Te=Ee[ve],ye=Te[0],be=Te[1];_.queries.query[ye]=be}}function W2(_){var S=_._state,L=_._deps.indexedDB;if(S.isBeingOpened||_.idbdb)return S.dbReadyPromise.then(function(){return S.dbOpenError?Oi(S.dbOpenError):_});S.isBeingOpened=!0,S.dbOpenError=null,S.openComplete=!1;var H=S.openCanceller,Y=Math.round(10*_.verno),ne=!1;function ae(){if(S.openCanceller!==H)throw new J.DatabaseClosed("db.open() was cancelled")}function ue(){return new he(function(Ie,ve){if(ae(),!L)throw new J.MissingAPI;var Ee=_.name,Te=S.autoSchema||!Y?L.open(Ee):L.open(Ee,Y);if(!Te)throw new J.MissingAPI;Te.onerror=zs(ve),Te.onblocked=ii(_._fireOnBlocked),Te.onupgradeneeded=ii(function(Ce){var Pe;Ae=Te.transaction,S.autoSchema&&!_._options.allowEmptyDB?(Te.onerror=qc,Ae.abort(),Te.result.close(),(Pe=L.deleteDatabase(Ee)).onsuccess=Pe.onerror=ii(function(){ve(new J.NoSuchDatabase("Database ".concat(Ee," doesnt exist")))})):(Ae.onerror=zs(ve),Ce=Ce.oldVersion>Math.pow(2,62)?0:Ce.oldVersion,me=Ce<1,_.idbdb=Te.result,ne&&H2(_,Ae),j2(_,Ce/10,Ae,ve))},ve),Te.onsuccess=ii(function(){Ae=null;var Ce,Pe,Re,De,Ve,Xe=_.idbdb=Te.result,et=v(Xe.objectStoreNames);if(0<et.length)try{var Ke=Xe.transaction((De=et).length===1?De[0]:De,"readonly");if(S.autoSchema)Pe=Xe,Re=Ke,(Ce=_).verno=Pe.version/10,Re=Ce._dbSchema=pu(0,Pe,Re),Ce._storeNames=v(Pe.objectStoreNames,0),du(Ce,[Ce._allTables],o(Re),Re);else if(fu(_,_._dbSchema,Ke),((Ve=Vm(pu(0,(Ve=_).idbdb,Ke),Ve._dbSchema)).add.length||Ve.change.some(function(Je){return Je.add.length||Je.change.length}))&&!ne)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),Xe.close(),Y=Xe.version+1,ne=!0,Ie(ue());hu(_,Ke)}catch{}Ja.push(_),Xe.onversionchange=ii(function(Je){S.vcFired=!0,_.on("versionchange").fire(Je)}),Xe.onclose=ii(function(Je){_.on("close").fire(Je)}),me&&(Ve=_._deps,Ke=Ee,Xe=Ve.indexedDB,Ve=Ve.IDBKeyRange,Gm(Xe)||Ke===ru||Hm(Xe,Ve).put({name:Ke}).catch(de)),Ie()},ve)}).catch(function(Ie){switch(Ie?.name){case"UnknownError":if(0<S.PR1398_maxLoop)return S.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),ue();break;case"VersionError":if(0<Y)return Y=0,ue()}return he.reject(Ie)})}var ye,be=S.dbReadyResolve,Ae=null,me=!1;return he.race([H,(typeof navigator>"u"?he.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(Ie){function ve(){return indexedDB.databases().finally(Ie)}ye=setInterval(ve,100),ve()}).finally(function(){return clearInterval(ye)}):Promise.resolve()).then(ue)]).then(function(){return ae(),S.onReadyBeingFired=[],he.resolve(Wm(function(){return _.on.ready.fire(_.vip)})).then(function Ie(){if(0<S.onReadyBeingFired.length){var ve=S.onReadyBeingFired.reduce(xe,de);return S.onReadyBeingFired=[],he.resolve(Wm(function(){return ve(_.vip)})).then(Ie)}})}).finally(function(){S.openCanceller===H&&(S.onReadyBeingFired=null,S.isBeingOpened=!1)}).catch(function(Ie){S.dbOpenError=Ie;try{Ae&&Ae.abort()}catch{}return H===S.openCanceller&&_._close(),Oi(Ie)}).finally(function(){S.openComplete=!0,be()}).then(function(){var Ie;return me&&(Ie={},_.tables.forEach(function(ve){ve.schema.indexes.forEach(function(Ee){Ee.name&&(Ie["idb://".concat(_.name,"/").concat(ve.name,"/").concat(Ee.name)]=new _n(-1/0,[[[]]]))}),Ie["idb://".concat(_.name,"/").concat(ve.name,"/")]=Ie["idb://".concat(_.name,"/").concat(ve.name,"/:dels")]=new _n(-1/0,[[[]]])}),Xr(Xc).fire(Ie),$m(Ie,!0)),_})}function Zm(_){function S(ne){return _.next(ne)}var L=Y(S),H=Y(function(ne){return _.throw(ne)});function Y(ne){return function(ye){var ue=ne(ye),ye=ue.value;return ue.done?ye:ye&&typeof ye.then=="function"?ye.then(L,H):a(ye)?Promise.all(ye).then(L,H):L(ye)}}return Y(S)()}function yu(_,S,L){for(var H=a(_)?_.slice():[_],Y=0;Y<L;++Y)H.push(S);return H}var Y2={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(_){return i(i({},_),{table:function(S){var L=_.table(S),H=L.schema,Y={},ne=[];function ae(me,Ie,ve){var Ee=$c(me),Te=Y[Ee]=Y[Ee]||[],Ce=me==null?0:typeof me=="string"?1:me.length,Pe=0<Ie,Pe=i(i({},ve),{name:Pe?"".concat(Ee,"(virtual-from:").concat(ve.name,")"):ve.name,lowLevelIndex:ve,isVirtual:Pe,keyTail:Ie,keyLength:Ce,extractKey:Bm(me),unique:!Pe&&ve.unique});return Te.push(Pe),Pe.isPrimaryKey||ne.push(Pe),1<Ce&&ae(Ce===2?me[0]:me.slice(0,Ce-1),Ie+1,ve),Te.sort(function(Re,De){return Re.keyTail-De.keyTail}),Pe}S=ae(H.primaryKey.keyPath,0,H.primaryKey),Y[":id"]=[S];for(var ue=0,ye=H.indexes;ue<ye.length;ue++){var be=ye[ue];ae(be.keyPath,0,be)}function Ae(me){var Ie,ve=me.query.index;return ve.isVirtual?i(i({},me),{query:{index:ve.lowLevelIndex,range:(Ie=me.query.range,ve=ve.keyTail,{type:Ie.type===1?2:Ie.type,lower:yu(Ie.lower,Ie.lowerOpen?_.MAX_KEY:_.MIN_KEY,ve),lowerOpen:!0,upper:yu(Ie.upper,Ie.upperOpen?_.MIN_KEY:_.MAX_KEY,ve),upperOpen:!0})}}):me}return i(i({},L),{schema:i(i({},H),{primaryKey:S,indexes:ne,getIndexByKeyPath:function(me){return(me=Y[$c(me)])&&me[0]}}),count:function(me){return L.count(Ae(me))},query:function(me){return L.query(Ae(me))},openCursor:function(me){var Ie=me.query.index,ve=Ie.keyTail,Ee=Ie.isVirtual,Te=Ie.keyLength;return Ee?L.openCursor(Ae(me)).then(function(Pe){return Pe&&Ce(Pe)}):L.openCursor(me);function Ce(Pe){return Object.create(Pe,{continue:{value:function(Re){Re!=null?Pe.continue(yu(Re,me.reverse?_.MAX_KEY:_.MIN_KEY,ve)):me.unique?Pe.continue(Pe.key.slice(0,Te).concat(me.reverse?_.MIN_KEY:_.MAX_KEY,ve)):Pe.continue()}},continuePrimaryKey:{value:function(Re,De){Pe.continuePrimaryKey(yu(Re,_.MAX_KEY,ve),De)}},primaryKey:{get:function(){return Pe.primaryKey}},key:{get:function(){var Re=Pe.key;return Te===1?Re[0]:Re.slice(0,Te)}},value:{get:function(){return Pe.value}}})}}})}})}};function Qm(_,S,L,H){return L=L||{},H=H||"",o(_).forEach(function(Y){var ne,ae,ue;h(S,Y)?(ne=_[Y],ae=S[Y],typeof ne=="object"&&typeof ae=="object"&&ne&&ae?(ue=N(ne))!==N(ae)?L[H+Y]=S[Y]:ue==="Object"?Qm(ne,ae,L,H+Y+"."):ne!==ae&&(L[H+Y]=S[Y]):ne!==ae&&(L[H+Y]=S[Y])):L[H+Y]=void 0}),o(S).forEach(function(Y){h(_,Y)||(L[H+Y]=S[Y])}),L}function Jm(_,S){return S.type==="delete"?S.keys:S.keys||S.values.map(_.extractKey)}var q2={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(_){return i(i({},_),{table:function(S){var L=_.table(S),H=L.schema.primaryKey;return i(i({},L),{mutate:function(Y){var ne=ot.trans,ae=ne.table(S).hook,ue=ae.deleting,ye=ae.creating,be=ae.updating;switch(Y.type){case"add":if(ye.fire===de)break;return ne._promise("readwrite",function(){return Ae(Y)},!0);case"put":if(ye.fire===de&&be.fire===de)break;return ne._promise("readwrite",function(){return Ae(Y)},!0);case"delete":if(ue.fire===de)break;return ne._promise("readwrite",function(){return Ae(Y)},!0);case"deleteRange":if(ue.fire===de)break;return ne._promise("readwrite",function(){return function me(Ie,ve,Ee){return L.query({trans:Ie,values:!1,query:{index:H,range:ve},limit:Ee}).then(function(Te){var Ce=Te.result;return Ae({type:"delete",keys:Ce,trans:Ie}).then(function(Pe){return 0<Pe.numFailures?Promise.reject(Pe.failures[0]):Ce.length<Ee?{failures:[],numFailures:0,lastResult:void 0}:me(Ie,i(i({},ve),{lower:Ce[Ce.length-1],lowerOpen:!0}),Ee)})})}(Y.trans,Y.range,1e4)},!0)}return L.mutate(Y);function Ae(me){var Ie,ve,Ee,Te=ot.trans,Ce=me.keys||Jm(H,me);if(!Ce)throw new Error("Keys missing");return(me=me.type==="add"||me.type==="put"?i(i({},me),{keys:Ce}):i({},me)).type!=="delete"&&(me.values=n([],me.values)),me.keys&&(me.keys=n([],me.keys)),Ie=L,Ee=Ce,((ve=me).type==="add"?Promise.resolve([]):Ie.getMany({trans:ve.trans,keys:Ee,cache:"immutable"})).then(function(Pe){var Re=Ce.map(function(De,Ve){var Xe,et,Ke,Je=Pe[Ve],tt={onerror:null,onsuccess:null};return me.type==="delete"?ue.fire.call(tt,De,Je,Te):me.type==="add"||Je===void 0?(Xe=ye.fire.call(tt,De,me.values[Ve],Te),De==null&&Xe!=null&&(me.keys[Ve]=De=Xe,H.outbound||A(me.values[Ve],H.keyPath,De))):(Xe=Qm(Je,me.values[Ve]),(et=be.fire.call(tt,Xe,De,Je,Te))&&(Ke=me.values[Ve],Object.keys(et).forEach(function(Ye){h(Ke,Ye)?Ke[Ye]=et[Ye]:A(Ke,Ye,et[Ye])}))),tt});return L.mutate(me).then(function(De){for(var Ve=De.failures,Xe=De.results,et=De.numFailures,De=De.lastResult,Ke=0;Ke<Ce.length;++Ke){var Je=(Xe||Ce)[Ke],tt=Re[Ke];Je==null?tt.onerror&&tt.onerror(Ve[Ke]):tt.onsuccess&&tt.onsuccess(me.type==="put"&&Pe[Ke]?me.values[Ke]:Je)}return{failures:Ve,results:Xe,numFailures:et,lastResult:De}}).catch(function(De){return Re.forEach(function(Ve){return Ve.onerror&&Ve.onerror(De)}),Promise.reject(De)})})}}})}})}};function ew(_,S,L){try{if(!S||S.keys.length<_.length)return null;for(var H=[],Y=0,ne=0;Y<S.keys.length&&ne<_.length;++Y)Ht(S.keys[Y],_[ne])===0&&(H.push(L?V(S.values[Y]):S.values[Y]),++ne);return H.length===_.length?H:null}catch{return null}}var X2={stack:"dbcore",level:-1,create:function(_){return{table:function(S){var L=_.table(S);return i(i({},L),{getMany:function(H){if(!H.cache)return L.getMany(H);var Y=ew(H.keys,H.trans._cache,H.cache==="clone");return Y?he.resolve(Y):L.getMany(H).then(function(ne){return H.trans._cache={keys:H.keys,values:H.cache==="clone"?V(ne):ne},ne})},mutate:function(H){return H.type!=="add"&&(H.trans._cache=null),L.mutate(H)}})}}}};function tw(_,S){return _.trans.mode==="readonly"&&!!_.subscr&&!_.trans.explicit&&_.trans.db._options.cache!=="disabled"&&!S.schema.primaryKey.outbound}function iw(_,S){switch(_){case"query":return S.values&&!S.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var K2={stack:"dbcore",level:0,name:"Observability",create:function(_){var S=_.schema.name,L=new _n(_.MIN_KEY,_.MAX_KEY);return i(i({},_),{transaction:function(H,Y,ne){if(ot.subscr&&Y!=="readonly")throw new J.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(ot.querier));return _.transaction(H,Y,ne)},table:function(H){var Y=_.table(H),ne=Y.schema,ae=ne.primaryKey,me=ne.indexes,ue=ae.extractKey,ye=ae.outbound,be=ae.autoIncrement&&me.filter(function(ve){return ve.compound&&ve.keyPath.includes(ae.keyPath)}),Ae=i(i({},Y),{mutate:function(ve){function Ee(Ye){return Ye="idb://".concat(S,"/").concat(H,"/").concat(Ye),De[Ye]||(De[Ye]=new _n)}var Te,Ce,Pe,Re=ve.trans,De=ve.mutatedParts||(ve.mutatedParts={}),Ve=Ee(""),Xe=Ee(":dels"),et=ve.type,tt=ve.type==="deleteRange"?[ve.range]:ve.type==="delete"?[ve.keys]:ve.values.length<50?[Jm(ae,ve).filter(function(Ye){return Ye}),ve.values]:[],Ke=tt[0],Je=tt[1],tt=ve.trans._cache;return a(Ke)?(Ve.addKeys(Ke),(tt=et==="delete"||Ke.length===Je.length?ew(Ke,tt):null)||Xe.addKeys(Ke),(tt||Je)&&(Te=Ee,Ce=tt,Pe=Je,ne.indexes.forEach(function(Ye){var xt=Te(Ye.name||"");function St(Ot){return Ot!=null?Ye.extractKey(Ot):null}function Lt(Ot){return Ye.multiEntry&&a(Ot)?Ot.forEach(function(Es){return xt.addKey(Es)}):xt.addKey(Ot)}(Ce||Pe).forEach(function(Ot,un){var Mt=Ce&&St(Ce[un]),un=Pe&&St(Pe[un]);Ht(Mt,un)!==0&&(Mt!=null&&Lt(Mt),un!=null&&Lt(un))})}))):Ke?(Je={from:Ke.lower,to:Ke.upper},Xe.add(Je),Ve.add(Je)):(Ve.add(L),Xe.add(L),ne.indexes.forEach(function(Ye){return Ee(Ye.name).add(L)})),Y.mutate(ve).then(function(Ye){return!Ke||ve.type!=="add"&&ve.type!=="put"||(Ve.addKeys(Ye.results),be&&be.forEach(function(xt){var St=ve.values.map(function(Ot){return xt.extractKey(Ot)}),Lt=xt.keyPath.findIndex(function(Ot){return Ot===ae.keyPath});Ye.results.forEach(function(Ot){return St[Lt]=Ot}),Ee(xt.name).addKeys(St)})),Re.mutatedParts=bu(Re.mutatedParts||{},De),Ye})}}),me=function(Ee){var Te=Ee.query,Ee=Te.index,Te=Te.range;return[Ee,new _n((Ee=Te.lower)!==null&&Ee!==void 0?Ee:_.MIN_KEY,(Te=Te.upper)!==null&&Te!==void 0?Te:_.MAX_KEY)]},Ie={get:function(ve){return[ae,new _n(ve.key)]},getMany:function(ve){return[ae,new _n().addKeys(ve.keys)]},count:me,query:me,openCursor:me};return o(Ie).forEach(function(ve){Ae[ve]=function(Ee){var Te=ot.subscr,Ce=!!Te,Pe=tw(ot,Y)&&iw(ve,Ee)?Ee.obsSet={}:Te;if(Ce){var Re=function(Je){return Je="idb://".concat(S,"/").concat(H,"/").concat(Je),Pe[Je]||(Pe[Je]=new _n)},De=Re(""),Ve=Re(":dels"),Te=Ie[ve](Ee),Ce=Te[0],Te=Te[1];if((ve==="query"&&Ce.isPrimaryKey&&!Ee.values?Ve:Re(Ce.name||"")).add(Te),!Ce.isPrimaryKey){if(ve!=="count"){var Xe=ve==="query"&&ye&&Ee.values&&Y.query(i(i({},Ee),{values:!1}));return Y[ve].apply(this,arguments).then(function(Je){if(ve==="query"){if(ye&&Ee.values)return Xe.then(function(St){return St=St.result,De.addKeys(St),Je});var tt=Ee.values?Je.result.map(ue):Je.result;(Ee.values?De:Ve).addKeys(tt)}else if(ve==="openCursor"){var Ye=Je,xt=Ee.values;return Ye&&Object.create(Ye,{key:{get:function(){return Ve.addKey(Ye.primaryKey),Ye.key}},primaryKey:{get:function(){var St=Ye.primaryKey;return Ve.addKey(St),St}},value:{get:function(){return xt&&De.addKey(Ye.primaryKey),Ye.value}}})}return Je})}Ve.add(L)}}return Y[ve].apply(this,arguments)}}),Ae}})}};function nw(_,S,L){if(L.numFailures===0)return S;if(S.type==="deleteRange")return null;var H=S.keys?S.keys.length:"values"in S&&S.values?S.values.length:1;return L.numFailures===H?null:(S=i({},S),a(S.keys)&&(S.keys=S.keys.filter(function(Y,ne){return!(ne in L.failures)})),"values"in S&&a(S.values)&&(S.values=S.values.filter(function(Y,ne){return!(ne in L.failures)})),S)}function eg(_,S){return L=_,((H=S).lower===void 0||(H.lowerOpen?0<Ht(L,H.lower):0<=Ht(L,H.lower)))&&(_=_,(S=S).upper===void 0||(S.upperOpen?Ht(_,S.upper)<0:Ht(_,S.upper)<=0));var L,H}function sw(_,S,Ie,H,Y,ne){if(!Ie||Ie.length===0)return _;var ae=S.query.index,ue=ae.multiEntry,ye=S.query.range,be=H.schema.primaryKey.extractKey,Ae=ae.extractKey,me=(ae.lowLevelIndex||ae).extractKey,Ie=Ie.reduce(function(ve,Ee){var Te=ve,Ce=[];if(Ee.type==="add"||Ee.type==="put")for(var Pe=new _n,Re=Ee.values.length-1;0<=Re;--Re){var De,Ve=Ee.values[Re],Xe=be(Ve);Pe.hasKey(Xe)||(De=Ae(Ve),(ue&&a(De)?De.some(function(tt){return eg(tt,ye)}):eg(De,ye))&&(Pe.addKey(Xe),Ce.push(Ve)))}switch(Ee.type){case"add":Te=ve.concat(S.values?Ce:Ce.map(function(Ye){return be(Ye)}));break;case"put":var et=new _n().addKeys(Ee.values.map(function(Ye){return be(Ye)})),Te=ve.filter(function(Ye){return!et.hasKey(S.values?be(Ye):Ye)}).concat(S.values?Ce:Ce.map(function(Ye){return be(Ye)}));break;case"delete":var Ke=new _n().addKeys(Ee.keys);Te=ve.filter(function(Ye){return!Ke.hasKey(S.values?be(Ye):Ye)});break;case"deleteRange":var Je=Ee.range;Te=ve.filter(function(Ye){return!eg(be(Ye),Je)})}return Te},_);return Ie===_?_:(Ie.sort(function(ve,Ee){return Ht(me(ve),me(Ee))||Ht(be(ve),be(Ee))}),S.limit&&S.limit<1/0&&(Ie.length>S.limit?Ie.length=S.limit:_.length===S.limit&&Ie.length<S.limit&&(Y.dirty=!0)),ne?Object.freeze(Ie):Ie)}function rw(_,S){return Ht(_.lower,S.lower)===0&&Ht(_.upper,S.upper)===0&&!!_.lowerOpen==!!S.lowerOpen&&!!_.upperOpen==!!S.upperOpen}function $2(_,S){return function(L,H,Y,ne){if(L===void 0)return H!==void 0?-1:0;if(H===void 0)return 1;if((H=Ht(L,H))===0){if(Y&&ne)return 0;if(Y)return 1;if(ne)return-1}return H}(_.lower,S.lower,_.lowerOpen,S.lowerOpen)<=0&&0<=function(L,H,Y,ne){if(L===void 0)return H!==void 0?1:0;if(H===void 0)return-1;if((H=Ht(L,H))===0){if(Y&&ne)return 0;if(Y)return-1;if(ne)return 1}return H}(_.upper,S.upper,_.upperOpen,S.upperOpen)}function Z2(_,S,L,H){_.subscribers.add(L),H.addEventListener("abort",function(){var Y,ne;_.subscribers.delete(L),_.subscribers.size===0&&(Y=_,ne=S,setTimeout(function(){Y.subscribers.size===0&&X(ne,Y)},3e3))})}var Q2={stack:"dbcore",level:0,name:"Cache",create:function(_){var S=_.schema.name;return i(i({},_),{transaction:function(L,H,Y){var ne,ae,ue=_.transaction(L,H,Y);return H==="readwrite"&&(ae=(ne=new AbortController).signal,Y=function(ye){return function(){if(ne.abort(),H==="readwrite"){for(var be=new Set,Ae=0,me=L;Ae<me.length;Ae++){var Ie=me[Ae],ve=Ko["idb://".concat(S,"/").concat(Ie)];if(ve){var Ee=_.table(Ie),Te=ve.optimisticOps.filter(function(xt){return xt.trans===ue});if(ue._explicit&&ye&&ue.mutatedParts)for(var Ce=0,Pe=Object.values(ve.queries.query);Ce<Pe.length;Ce++)for(var Re=0,De=(et=Pe[Ce]).slice();Re<De.length;Re++)qm((Ke=De[Re]).obsSet,ue.mutatedParts)&&(X(et,Ke),Ke.subscribers.forEach(function(xt){return be.add(xt)}));else if(0<Te.length){ve.optimisticOps=ve.optimisticOps.filter(function(xt){return xt.trans!==ue});for(var Ve=0,Xe=Object.values(ve.queries.query);Ve<Xe.length;Ve++)for(var et,Ke,Je,tt=0,Ye=(et=Xe[Ve]).slice();tt<Ye.length;tt++)(Ke=Ye[tt]).res!=null&&ue.mutatedParts&&(ye&&!Ke.dirty?(Je=Object.isFrozen(Ke.res),Je=sw(Ke.res,Ke.req,Te,Ee,Ke,Je),Ke.dirty?(X(et,Ke),Ke.subscribers.forEach(function(xt){return be.add(xt)})):Je!==Ke.res&&(Ke.res=Je,Ke.promise=he.resolve({result:Je}))):(Ke.dirty&&X(et,Ke),Ke.subscribers.forEach(function(xt){return be.add(xt)})))}}}be.forEach(function(xt){return xt()})}}},ue.addEventListener("abort",Y(!1),{signal:ae}),ue.addEventListener("error",Y(!1),{signal:ae}),ue.addEventListener("complete",Y(!0),{signal:ae})),ue},table:function(L){var H=_.table(L),Y=H.schema.primaryKey;return i(i({},H),{mutate:function(ne){var ae=ot.trans;if(Y.outbound||ae.db._options.cache==="disabled"||ae.explicit)return H.mutate(ne);var ue=Ko["idb://".concat(S,"/").concat(L)];return ue?(ae=H.mutate(ne),ne.type!=="add"&&ne.type!=="put"||!(50<=ne.values.length||Jm(Y,ne).some(function(ye){return ye==null}))?(ue.optimisticOps.push(ne),ne.mutatedParts&&vu(ne.mutatedParts),ae.then(function(ye){0<ye.numFailures&&(X(ue.optimisticOps,ne),(ye=nw(0,ne,ye))&&ue.optimisticOps.push(ye),ne.mutatedParts&&vu(ne.mutatedParts))}),ae.catch(function(){X(ue.optimisticOps,ne),ne.mutatedParts&&vu(ne.mutatedParts)})):ae.then(function(ye){var be=nw(0,i(i({},ne),{values:ne.values.map(function(ve,me){var Ie,ve=(Ie=Y.keyPath)!==null&&Ie!==void 0&&Ie.includes(".")?V(ve):i({},ve);return A(ve,Y.keyPath,ye.results[me]),ve})}),ye);ue.optimisticOps.push(be),queueMicrotask(function(){return ne.mutatedParts&&vu(ne.mutatedParts)})}),ae):H.mutate(ne)},query:function(ne){if(!tw(ot,H)||!iw("query",ne))return H.query(ne);var ae=((be=ot.trans)===null||be===void 0?void 0:be.db._options.cache)==="immutable",me=ot,ue=me.requery,ye=me.signal,be=function(Ee,Te,Ce,Pe){var Re=Ko["idb://".concat(Ee,"/").concat(Te)];if(!Re)return[];if(!(Te=Re.queries[Ce]))return[null,!1,Re,null];var De=Te[(Pe.query?Pe.query.index.name:null)||""];if(!De)return[null,!1,Re,null];switch(Ce){case"query":var Ve=De.find(function(Xe){return Xe.req.limit===Pe.limit&&Xe.req.values===Pe.values&&rw(Xe.req.query.range,Pe.query.range)});return Ve?[Ve,!0,Re,De]:[De.find(function(Xe){return("limit"in Xe.req?Xe.req.limit:1/0)>=Pe.limit&&(!Pe.values||Xe.req.values)&&$2(Xe.req.query.range,Pe.query.range)}),!1,Re,De];case"count":return Ve=De.find(function(Xe){return rw(Xe.req.query.range,Pe.query.range)}),[Ve,!!Ve,Re,De]}}(S,L,"query",ne),Ae=be[0],me=be[1],Ie=be[2],ve=be[3];return Ae&&me?Ae.obsSet=ne.obsSet:(me=H.query(ne).then(function(Ee){var Te=Ee.result;if(Ae&&(Ae.res=Te),ae){for(var Ce=0,Pe=Te.length;Ce<Pe;++Ce)Object.freeze(Te[Ce]);Object.freeze(Te)}else Ee.result=V(Te);return Ee}).catch(function(Ee){return ve&&Ae&&X(ve,Ae),Promise.reject(Ee)}),Ae={obsSet:ne.obsSet,promise:me,subscribers:new Set,type:"query",req:ne,dirty:!1},ve?ve.push(Ae):(ve=[Ae],(Ie=Ie||(Ko["idb://".concat(S,"/").concat(L)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[ne.query.index.name||""]=ve)),Z2(Ae,ve,ue,ye),Ae.promise.then(function(Ee){return{result:sw(Ee.result,ne,Ie?.optimisticOps,H,Ae,ae)}})}})}})}};function _u(_,S){return new Proxy(_,{get:function(L,H,Y){return H==="db"?S:Reflect.get(L,H,Y)}})}var br=(Mi.prototype.version=function(_){if(isNaN(_)||_<.1)throw new J.Type("Given version is not a positive number");if(_=Math.round(10*_)/10,this.idbdb||this._state.isBeingOpened)throw new J.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,_);var S=this._versions,L=S.filter(function(H){return H._cfg.version===_})[0];return L||(L=new this.Version(_),S.push(L),S.sort(V2),L.stores({}),this._state.autoSchema=!1,L)},Mi.prototype._whenReady=function(_){var S=this;return this.idbdb&&(this._state.openComplete||ot.letThrough||this._vip)?_():new he(function(L,H){if(S._state.openComplete)return H(new J.DatabaseClosed(S._state.dbOpenError));if(!S._state.isBeingOpened){if(!S._state.autoOpen)return void H(new J.DatabaseClosed);S.open().catch(de)}S._state.dbReadyPromise.then(L,H)}).then(_)},Mi.prototype.use=function(_){var S=_.stack,L=_.create,H=_.level,Y=_.name;return Y&&this.unuse({stack:S,name:Y}),_=this._middlewares[S]||(this._middlewares[S]=[]),_.push({stack:S,create:L,level:H??10,name:Y}),_.sort(function(ne,ae){return ne.level-ae.level}),this},Mi.prototype.unuse=function(_){var S=_.stack,L=_.name,H=_.create;return S&&this._middlewares[S]&&(this._middlewares[S]=this._middlewares[S].filter(function(Y){return H?Y.create!==H:!!L&&Y.name!==L})),this},Mi.prototype.open=function(){var _=this;return Yo(ti,function(){return W2(_)})},Mi.prototype._close=function(){var _=this._state,S=Ja.indexOf(this);if(0<=S&&Ja.splice(S,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}_.isBeingOpened||(_.dbReadyPromise=new he(function(L){_.dbReadyResolve=L}),_.openCanceller=new he(function(L,H){_.cancelOpen=H}))},Mi.prototype.close=function(L){var S=(L===void 0?{disableAutoOpen:!0}:L).disableAutoOpen,L=this._state;S?(L.isBeingOpened&&L.cancelOpen(new J.DatabaseClosed),this._close(),L.autoOpen=!1,L.dbOpenError=new J.DatabaseClosed):(this._close(),L.autoOpen=this._options.autoOpen||L.isBeingOpened,L.openComplete=!1,L.dbOpenError=null)},Mi.prototype.delete=function(_){var S=this;_===void 0&&(_={disableAutoOpen:!0});var L=0<arguments.length&&typeof arguments[0]!="object",H=this._state;return new he(function(Y,ne){function ae(){S.close(_);var ue=S._deps.indexedDB.deleteDatabase(S.name);ue.onsuccess=ii(function(){var ye,be,Ae;ye=S._deps,be=S.name,Ae=ye.indexedDB,ye=ye.IDBKeyRange,Gm(Ae)||be===ru||Hm(Ae,ye).delete(be).catch(de),Y()}),ue.onerror=zs(ne),ue.onblocked=S._fireOnBlocked}if(L)throw new J.InvalidArgument("Invalid closeOptions argument to db.delete()");H.isBeingOpened?H.dbReadyPromise.then(ae):ae()})},Mi.prototype.backendDB=function(){return this.idbdb},Mi.prototype.isOpen=function(){return this.idbdb!==null},Mi.prototype.hasBeenClosed=function(){var _=this._state.dbOpenError;return _&&_.name==="DatabaseClosed"},Mi.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Mi.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Mi.prototype,"tables",{get:function(){var _=this;return o(this._allTables).map(function(S){return _._allTables[S]})},enumerable:!1,configurable:!0}),Mi.prototype.transaction=function(){var _=(function(S,L,H){var Y=arguments.length;if(Y<2)throw new J.InvalidArgument("Too few arguments");for(var ne=new Array(Y-1);--Y;)ne[Y-1]=arguments[Y];return H=ne.pop(),[S,I(ne),H]}).apply(this,arguments);return this._transaction.apply(this,_)},Mi.prototype._transaction=function(_,S,L){var H=this,Y=ot.trans;Y&&Y.db===this&&_.indexOf("!")===-1||(Y=null);var ne,ae,ue=_.indexOf("?")!==-1;_=_.replace("!","").replace("?","");try{if(ae=S.map(function(be){if(be=be instanceof H.Table?be.name:be,typeof be!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return be}),_=="r"||_===Mm)ne=Mm;else{if(_!="rw"&&_!=Rm)throw new J.InvalidArgument("Invalid transaction mode: "+_);ne=Rm}if(Y){if(Y.mode===Mm&&ne===Rm){if(!ue)throw new J.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");Y=null}Y&&ae.forEach(function(be){if(Y&&Y.storeNames.indexOf(be)===-1){if(!ue)throw new J.SubTransaction("Table "+be+" not included in parent transaction.");Y=null}}),ue&&Y&&!Y.active&&(Y=null)}}catch(be){return Y?Y._promise(null,function(Ae,me){me(be)}):Oi(be)}var ye=(function be(Ae,me,Ie,ve,Ee){return he.resolve().then(function(){var Te=ot.transless||ot,Ce=Ae._createTransaction(me,Ie,Ae._dbSchema,ve);if(Ce.explicit=!0,Te={trans:Ce,transless:Te},ve)Ce.idbtrans=ve.idbtrans;else try{Ce.create(),Ce.idbtrans._explicit=!0,Ae._state.PR1398_maxLoop=3}catch(De){return De.name===Q.InvalidState&&Ae.isOpen()&&0<--Ae._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),Ae.close({disableAutoOpen:!1}),Ae.open().then(function(){return be(Ae,me,Ie,null,Ee)})):Oi(De)}var Pe,Re=R(Ee);return Re&&qn(),Te=he.follow(function(){var De;(Pe=Ee.call(Ce,Ce))&&(Re?(De=Xn.bind(null,null),Pe.then(De,De)):typeof Pe.next=="function"&&typeof Pe.throw=="function"&&(Pe=Zm(Pe)))},Te),(Pe&&typeof Pe.then=="function"?he.resolve(Pe).then(function(De){return Ce.active?De:Oi(new J.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):Te.then(function(){return Pe})).then(function(De){return ve&&Ce._resolve(),Ce._completion.then(function(){return De})}).catch(function(De){return Ce._reject(De),Oi(De)})})}).bind(null,this,ne,ae,Y,L);return Y?Y._promise(ne,ye,"lock"):ot.trans?Yo(ot.transless,function(){return H._whenReady(ye)}):this._whenReady(ye)},Mi.prototype.table=function(_){if(!h(this._allTables,_))throw new J.InvalidTable("Table ".concat(_," does not exist"));return this._allTables[_]},Mi);function Mi(_,S){var L=this;this._middlewares={},this.verno=0;var H=Mi.dependencies;this._options=S=i({addons:Mi.addons,autoOpen:!0,indexedDB:H.indexedDB,IDBKeyRange:H.IDBKeyRange,cache:"cloned"},S),this._deps={indexedDB:S.indexedDB,IDBKeyRange:S.IDBKeyRange},H=S.addons,this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;var Y,ne,ae,ue,ye,be={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:de,dbReadyPromise:null,cancelOpen:de,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:S.autoOpen};be.dbReadyPromise=new he(function(me){be.dbReadyResolve=me}),be.openCanceller=new he(function(me,Ie){be.cancelOpen=Ie}),this._state=be,this.name=_,this.on=Gc(this,"populate","blocked","versionchange","close",{ready:[xe,de]}),this.on.ready.subscribe=E(this.on.ready.subscribe,function(me){return function(Ie,ve){Mi.vip(function(){var Ee,Te=L._state;Te.openComplete?(Te.dbOpenError||he.resolve().then(Ie),ve&&me(Ie)):Te.onReadyBeingFired?(Te.onReadyBeingFired.push(Ie),ve&&me(Ie)):(me(Ie),Ee=L,ve||me(function Ce(){Ee.on.ready.unsubscribe(Ie),Ee.on.ready.unsubscribe(Ce)}))})}}),this.Collection=(Y=this,Wc(L2.prototype,function(Pe,Ce){this.db=Y;var ve=k_,Ee=null;if(Ce)try{ve=Ce()}catch(Re){Ee=Re}var Te=Pe._ctx,Ce=Te.table,Pe=Ce.hook.reading.fire;this._ctx={table:Ce,index:Te.index,isPrimKey:!Te.index||Ce.schema.primKey.keyPath&&Te.index===Ce.schema.primKey.name,range:ve,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:Ee,or:Te.or,valueMapper:Pe!==fe?Pe:null}})),this.Table=(ne=this,Wc(z_.prototype,function(me,Ie,ve){this.db=ne,this._tx=ve,this.name=me,this.schema=Ie,this.hook=ne._allTables[me]?ne._allTables[me].hook:Gc(null,{creating:[re,de],reading:[P,fe],updating:[ee,de],deleting:[K,de]})})),this.Transaction=(ae=this,Wc(N2.prototype,function(me,Ie,ve,Ee,Te){var Ce=this;this.db=ae,this.mode=me,this.storeNames=Ie,this.schema=ve,this.chromeTransactionDurability=Ee,this.idbtrans=null,this.on=Gc(this,"complete","error","abort"),this.parent=Te||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new he(function(Pe,Re){Ce._resolve=Pe,Ce._reject=Re}),this._completion.then(function(){Ce.active=!1,Ce.on.complete.fire()},function(Pe){var Re=Ce.active;return Ce.active=!1,Ce.on.error.fire(Pe),Ce.parent?Ce.parent._reject(Pe):Re&&Ce.idbtrans&&Ce.idbtrans.abort(),Oi(Pe)})})),this.Version=(ue=this,Wc(G2.prototype,function(me){this.db=ue,this._cfg={version:me,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(ye=this,Wc(W_.prototype,function(me,Ie,ve){if(this.db=ye,this._ctx={table:me,index:Ie===":id"?null:Ie,or:ve},this._cmp=this._ascending=Ht,this._descending=function(Ee,Te){return Ht(Te,Ee)},this._max=function(Ee,Te){return 0<Ht(Ee,Te)?Ee:Te},this._min=function(Ee,Te){return Ht(Ee,Te)<0?Ee:Te},this._IDBKeyRange=ye._deps.IDBKeyRange,!this._IDBKeyRange)throw new J.MissingAPI})),this.on("versionchange",function(me){0<me.newVersion?console.warn("Another connection wants to upgrade database '".concat(L.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(L.name,"'. Closing db now to resume the delete request.")),L.close({disableAutoOpen:!1})}),this.on("blocked",function(me){!me.newVersion||me.newVersion<me.oldVersion?console.warn("Dexie.delete('".concat(L.name,"') was blocked")):console.warn("Upgrade '".concat(L.name,"' blocked by other connection holding version ").concat(me.oldVersion/10))}),this._maxKey=Kc(S.IDBKeyRange),this._createTransaction=function(me,Ie,ve,Ee){return new L.Transaction(me,Ie,ve,L._options.chromeTransactionDurability,Ee)},this._fireOnBlocked=function(me){L.on("blocked").fire(me),Ja.filter(function(Ie){return Ie.name===L.name&&Ie!==L&&!Ie._state.vcFired}).map(function(Ie){return Ie.on("versionchange").fire(me)})},this.use(X2),this.use(Q2),this.use(K2),this.use(Y2),this.use(q2);var Ae=new Proxy(this,{get:function(me,Ie,ve){if(Ie==="_vip")return!0;if(Ie==="table")return function(Te){return _u(L.table(Te),Ae)};var Ee=Reflect.get(me,Ie,ve);return Ee instanceof z_?_u(Ee,Ae):Ie==="tables"?Ee.map(function(Te){return _u(Te,Ae)}):Ie==="_createTransaction"?function(){return _u(Ee.apply(this,arguments),Ae)}:Ee}});this.vip=Ae,H.forEach(function(me){return me(L)})}var wu,Kn=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",J2=(tg.prototype.subscribe=function(_,S,L){return this._subscribe(_&&typeof _!="function"?_:{next:_,error:S,complete:L})},tg.prototype[Kn]=function(){return this},tg);function tg(_){this._subscribe=_}try{wu={indexedDB:r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB,IDBKeyRange:r.IDBKeyRange||r.webkitIDBKeyRange}}catch{wu={indexedDB:null,IDBKeyRange:null}}function ow(_){var S,L=!1,H=new J2(function(Y){var ne=R(_),ae,ue=!1,ye={},be={},Ae={get closed(){return ue},unsubscribe:function(){ue||(ue=!0,ae&&ae.abort(),me&&Xr.storagemutated.unsubscribe(ve))}};Y.start&&Y.start(Ae);var me=!1,Ie=function(){return Om(Ee)},ve=function(Te){bu(ye,Te),qm(be,ye)&&Ie()},Ee=function(){var Te,Ce,Pe;!ue&&wu.indexedDB&&(ye={},Te={},ae&&ae.abort(),ae=new AbortController,Pe=function(Re){var De=In();try{ne&&qn();var Ve=Si(_,Re);return Ve=ne?Ve.finally(Xn):Ve}finally{De&&Pi()}}(Ce={subscr:Te,signal:ae.signal,requery:Ie,querier:_,trans:null}),Promise.resolve(Pe).then(function(Re){L=!0,S=Re,ue||Ce.signal.aborted||(ye={},function(De){for(var Ve in De)if(h(De,Ve))return;return 1}(be=Te)||me||(Xr(Xc,ve),me=!0),Om(function(){return!ue&&Y.next&&Y.next(Re)}))},function(Re){L=!1,["DatabaseClosedError","AbortError"].includes(Re?.name)||ue||Om(function(){ue||Y.error&&Y.error(Re)})}))};return setTimeout(Ie,0),Ae});return H.hasValue=function(){return L},H.getValue=function(){return S},H}var $o=br;function ig(_){var S=Kr;try{Kr=!0,Xr.storagemutated.fire(_),$m(_,!0)}finally{Kr=S}}u($o,i(i({},pe),{delete:function(_){return new $o(_,{addons:[]}).delete()},exists:function(_){return new $o(_,{addons:[]}).open().then(function(S){return S.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(_){try{return S=$o.dependencies,L=S.indexedDB,S=S.IDBKeyRange,(Gm(L)?Promise.resolve(L.databases()).then(function(H){return H.map(function(Y){return Y.name}).filter(function(Y){return Y!==ru})}):Hm(L,S).toCollection().primaryKeys()).then(_)}catch{return Oi(new J.MissingAPI)}var S,L},defineClass:function(){return function(_){l(this,_)}},ignoreTransaction:function(_){return ot.trans?Yo(ot.transless,_):_()},vip:Wm,async:function(_){return function(){try{var S=Zm(_.apply(this,arguments));return S&&typeof S.then=="function"?S:he.resolve(S)}catch(L){return Oi(L)}}},spawn:function(_,S,L){try{var H=Zm(_.apply(L,S||[]));return H&&typeof H.then=="function"?H:he.resolve(H)}catch(Y){return Oi(Y)}},currentTransaction:{get:function(){return ot.trans||null}},waitFor:function(_,S){return S=he.resolve(typeof _=="function"?$o.ignoreTransaction(_):_).timeout(S||6e4),ot.trans?ot.trans.waitFor(S):S},Promise:he,debug:{get:function(){return ge},set:function(_){_e(_)}},derive:m,extend:l,props:u,override:E,Events:Gc,on:Xr,liveQuery:ow,extendObservabilitySet:bu,getByKeyPath:C,setByKeyPath:A,delByKeyPath:function(_,S){typeof S=="string"?A(_,S,void 0):"length"in S&&[].map.call(S,function(L){A(_,L,void 0)})},shallowClone:D,deepClone:V,getObjectDiff:Qm,cmp:Ht,asap:w,minKey:-1/0,addons:[],connections:Ja,errnames:Q,dependencies:wu,cache:Ko,semVer:"4.0.8",version:"4.0.8".split(".").map(function(_){return parseInt(_)}).reduce(function(_,S,L){return _+S/Math.pow(10,2*L)})})),$o.maxKey=Kc($o.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Xr(Xc,function(_){Kr||(_=new CustomEvent(km,{detail:_}),Kr=!0,dispatchEvent(_),Kr=!1)}),addEventListener(km,function(_){_=_.detail,Kr||ig(_)}));var il,Kr=!1,aw=function(){};return typeof BroadcastChannel<"u"&&((aw=function(){(il=new BroadcastChannel(km)).onmessage=function(_){return _.data&&ig(_.data)}})(),typeof il.unref=="function"&&il.unref(),Xr(Xc,function(_){Kr||il.postMessage(_)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(_){if(!br.disableBfCache&&_.persisted){ge&&console.debug("Dexie: handling persisted pagehide"),il?.close();for(var S=0,L=Ja;S<L.length;S++)L[S].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(_){!br.disableBfCache&&_.persisted&&(ge&&console.debug("Dexie: handling persisted pageshow"),aw(),ig({all:new _n(-1/0,[[]])}))})),he.rejectionMapper=function(_,S){return!_||_ instanceof $||_ instanceof TypeError||_ instanceof SyntaxError||!_.name||!oe[_.name]?_:(S=new oe[_.name](S||_.message,_),"stack"in _&&f(S,"stack",{get:function(){return this.inner.stack}}),S)},_e(ge),i(br,Object.freeze({__proto__:null,Dexie:br,liveQuery:ow,Entity:N_,cmp:Ht,PropModSymbol:gr,PropModification:Yc,replacePrefix:function(_,S){return new Yc({replacePrefix:[_,S]})},add:function(_){return new Yc({add:_})},remove:function(_){return new Yc({remove:_})},default:br,RangeSet:_n,mergeRanges:Qc,rangesOverlap:$_}),{default:br}),br})})(ex);var WL=ex.exports,wb=RC(WL),k1=Symbol.for("Dexie"),Eb=globalThis[k1]||(globalThis[k1]=wb);if(wb.semVer!==Eb.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${wb.semVer} and ${Eb.semVer}`);var Cb=class extends Eb{constructor(){super("MyAppDatabase"),Z(this,"files"),this.version(1).stores({files:"id, file"})}},xb=class{constructor(e){Z(this,"interval",1e4),Z(this,"maxTime",6e4),Z(this,"list",new Map),Z(this,"_enabled",!1),Z(this,"_intervalId",null),Z(this,"_fileCache"),this._fileCache=e}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e){if(this._enabled=e,!e){this._intervalId!==null&&clearInterval(this._intervalId),this._intervalId=null;return}this._intervalId=window.setInterval(()=>{let t=new Date().getTime();for(let[i,n]of this.list)t-n>this.maxTime&&this.clean(i)},this.interval)}}update(e){this.enabled&&this.list.set(e,new Date().getTime())}clear(){return ie(this,null,function*(){for(let[e]of this.list)this.clean(e)})}clean(e){try{this._fileCache.files.delete(e)}catch{console.log(`File not found in indexedDB: ${e}`)}this.list.delete(e)}},tx=class Sb extends At{constructor(e){super(e),Z(this,"enabled",!0),Z(this,"onFragmentsDeleted",new Oe),Z(this,"onFragmentsLoaded",new Oe),Z(this,"onDisposed",new Oe),Z(this,"models",{}),Z(this,"serializer",new vg),Z(this,"maxRamTime",5e3),Z(this,"useCache",!0),Z(this,"dbCleaner"),Z(this,"fetch",t=>ie(this,null,function*(){return fetch(t)})),Z(this,"_culler",null),Z(this,"_world",null),Z(this,"_ramCache",new Map),Z(this,"_fileCache",new Cb),Z(this,"_url",null),Z(this,"_isDisposing",!1),Z(this,"_geometryInstances",{}),Z(this,"_loadedFragments",{}),Z(this,"fragIDData",new Map),Z(this,"_baseMaterial",new io),Z(this,"_baseMaterialT",new io({transparent:!0,opacity:.5})),Z(this,"disposeStreamedGroup",t=>{this._isDisposing=!0;let{groupID:i,fragmentIDs:n}=t;if(this.models[i]){delete this.models[i],delete this._geometryInstances[i],delete this._loadedFragments[i];for(let r of n)this.fragIDData.delete(r);this.culler.remove(i),this._isDisposing=!1}}),this.components.add(Sb.uuid,this),this.dbCleaner=new xb(this._fileCache),this.components.get(Rt).onFragmentsDisposed.add(this.disposeStreamedGroup)}get url(){if(!this._url)throw new Error("url must be set before using the streaming service!");return this._url}set url(e){this._url=e}get world(){if(!this._world)throw new Error("You must set a world before using the streamer!");return this._world}set world(e){var t;this._world=e,(t=this._culler)==null||t.dispose(),this._culler=new _b(this.components,e),this._culler.onViewUpdated.add(a=>ie(this,[a],function*({toLoad:i,toRemove:n,toShow:r,toHide:o}){yield this.loadFoundGeometries(i),yield this.unloadLostGeometries(n),this.setMeshVisibility(r,!0),this.setMeshVisibility(o,!1)}))}get culler(){if(!this._culler)throw new Error("You must set a world before using the streamer!");return this._culler}dispose(){var e;this._isDisposing=!0,this.onFragmentsLoaded.reset(),this.onFragmentsDeleted.reset(),this._ramCache.clear(),this.components.get(Rt).onFragmentsDisposed.remove(this.disposeStreamedGroup),this.models={},this._geometryInstances={},this._loadedFragments={},this.fragIDData.clear(),this._baseMaterial.dispose(),this._baseMaterialT.dispose(),(e=this._culler)==null||e.dispose(),this.onDisposed.trigger(Sb.uuid),this.onDisposed.reset(),this._isDisposing=!1}load(e,t,i){return ie(this,null,function*(){let{assets:n,geometries:r,globalDataFileId:o}=e,a=this.url+o,l=yield(yield this.fetch(a)).arrayBuffer(),c=new Uint8Array(l),d=this.components.get(Rt).load(c,{coordinate:t,isStreamed:!0});d.name=o.replace("-processed-global",""),this.world.scene.three.add(d);let{opaque:h,transparent:u}=d.geometryIDs;for(let[f,m]of h){let g=d.keyFragments.get(m);if(g===void 0)throw new Error("Malformed fragments group!");this.fragIDData.set(g,[d,f,new Set])}for(let[f,m]of u){let g=d.keyFragments.get(m);if(g===void 0)throw new Error("Malformed fragments group!");this.fragIDData.set(g,[d,Math.abs(f),new Set])}this.culler.add(d.uuid,n,r),this.models[d.uuid]={assets:n,geometries:r};let p=new Map;for(let f of n){let m=f.id;for(let{transformation:g,geometryID:b,color:v}of f.geometries){p.has(b)||p.set(b,[]);let E=p.get(b);if(!E)throw new Error("Malformed instances");E.push({id:m,transformation:g,color:v})}}if(this._geometryInstances[d.uuid]=p,i){let f=new Map,m=new Map;for(let w in i.ids){let C=i.ids[w],A=parseInt(w,10);f.set(A,C)}for(let w in i.types){let C=i.types[w],A=parseInt(w,10);m.set(A,C)}let g=o.replace("-global","-properties");d.streamSettings={baseUrl:this.url,baseFileName:g,ids:f,types:m};let{indexesFile:b}=i,v=this.url+b,E=yield(yield this.fetch(v)).text(),y=this.components.get(jh);y.setRelationMap(d,y.getRelationsMapFromJSON(E))}return this.culler.updateTransformations(d.uuid),this.culler.needsUpdate=!0,d})}remove(e){let t=this.components.get(Rt),i=t.groups.get(e);i&&t.disposeGroup(i)}setVisibility(e,t){let i=new Map;for(let n in t){let r=this.fragIDData.get(n);if(r===void 0)throw new Error("Geometry not found!");let[o,a,l]=r,c=o.uuid;i.has(c)||i.set(c,new Map);let d=i.get(c),h=t[n];for(let p of h)e?l.delete(p):l.add(p);d.get(a)||d.set(a,new Set);let u=d.get(a);for(let p of h)u.add(p)}for(let[n,r]of i){this.culler.setVisibility(e,n,r);for(let[o]of r){let a=this._loadedFragments[n];if(!a)continue;let l=a[o];if(l)for(let c of l){let d=t[c.id];d&&c.setVisibility(e,d)}}}this.culler.needsUpdate=!0}clearCache(){return ie(this,null,function*(){yield this._fileCache.delete()})}setStatic(e,t,i){return ie(this,null,function*(){let n={};for(let r of e){let o=this.fragIDData.get(r);if(!o){console.log(`Item not found: ${r}.`);continue}let[a,l]=o,c=a.uuid;n[c]||(n[c]=new Set),n[c].add(l)}if(t){let r={};for(let o in n){let a=new Map;a.set(1,n[o]),r[o]=a}yield this.loadFoundGeometries(r,!1),yield this.culler.addStaticGeometries(n,i)}else this.culler.removeStaticGeometries(n,i)})}loadFoundGeometries(e,t=!0){return ie(this,null,function*(){for(let i in e){if(this._isDisposing)return;let n=this.components.get(Rt).groups.get(i);if(!n)return;let{geometries:r}=this.models[i],o=new Map,a=new Set;for(let[h,u]of e[i])for(let p of u){a.add(p);let f=r[p];if(!f)throw new Error("Geometry not found");if(f.geometryFile){let m=f.geometryFile,g=o.get(m)||0;o.set(m,g+h)}}let l=Array.from(o).sort((h,u)=>u[1]-h[1]);for(let[h]of l){let u=this.url+h;if(!this._ramCache.has(u)){let m=new Uint8Array;if(this.useCache){this.dbCleaner.update(u);let b=yield this._fileCache.files.get(u);if(b)m=b.file;else{let v=yield(yield this.fetch(u)).arrayBuffer();m=new Uint8Array(v),this._fileCache.files.add({file:m,id:u})}}else{let b=yield(yield this.fetch(u)).arrayBuffer();m=new Uint8Array(b)}let g=this.serializer.import(m);this._ramCache.set(u,{data:g,time:performance.now()})}let p=this._ramCache.get(u);if(!p)continue;p.time=performance.now();let f=[];if(p)for(let[m,{position:g,index:b,normal:v}]of p.data){if(this._isDisposing)return;if(!a.has(m)||!this._geometryInstances[i]||!this._geometryInstances[i].has(m))continue;let E=this._geometryInstances[i].get(m);if(!E)throw new Error("Instances not found!");let y=new kt,w=new Ti(g,3),C=new Ti(v,3);y.setAttribute("position",w),y.setAttribute("normal",C),y.setIndex(Array.from(b));let A=[],D=[];for(let M of E)M.color[3]===1?D.push(M):A.push(M);this.newFragment(n,m,y,A,!0,f,t),this.newFragment(n,m,y,D,!1,f,t)}f.length&&!this._isDisposing&&this.onFragmentsLoaded.trigger(f)}let c=new Set,d=performance.now();for(let[h,{time:u}]of this._ramCache)d-u>this.maxRamTime&&c.add(h);for(let h of c)this._ramCache.delete(h)}})}unloadLostGeometries(e){return ie(this,null,function*(){if(this._isDisposing)return;let t=[],i=this.components.get(Rt);for(let n in e){let r=i.groups.get(n);if(!r)throw new Error("Fragment group not found!");if(!this._loadedFragments[n])continue;let o=this._loadedFragments[n],a=e[n];for(let l of a){if(this.culler.removeFragment(r.uuid,l),!o[l])continue;let c=o[l];for(let d of c)r.items.splice(r.items.indexOf(d),1),t.push(d);delete o[l]}}t.length&&this.onFragmentsDeleted.trigger(t);for(let n of t)i.list.delete(n.id),this.world.meshes.delete(n.mesh),n.mesh.material=[],n.dispose(!0)})}setMeshVisibility(e,t){for(let i in e)for(let n of e[i]){let r=this._loadedFragments[i];if(!r)continue;let o=r[n];if(o)for(let a of o)a.mesh.visible=t}}newFragment(e,t,i,n,r,o,a){if(n.length===0||this._isDisposing)return;let l=e.geometryIDs,c=r?l.transparent:l.opaque,d=t*(r?-1:1),h=c.get(d);if(h===void 0)return;let u=e.keyFragments.get(h);if(u===void 0)return;let p=this.components.get(Rt);if(p.list.has(u))return;let f=r?this._baseMaterialT:this._baseMaterial,m=new sa(i,f,n.length);m.mesh.visible=a,m.id=u,m.mesh.uuid=u,m.group=e,e.add(m.mesh),e.items.push(m),p.list.set(m.id,m),this.world.meshes.add(m.mesh),this._loadedFragments[e.uuid]||(this._loadedFragments[e.uuid]={});let g=this._loadedFragments[e.uuid];g[t]||(g[t]=[]),g[t].push(m);let b=new Map;for(let w=0;w<n.length;w++){let C=new lt,A=new zt,{id:D,transformation:M,color:I}=n[w];C.fromArray(M);let[O,F,V]=I;if(A.setRGB(O,F,V,"srgb"),b.has(D)){let x=b.get(D);if(!x)continue;x.transforms.push(C),x.colors&&x.colors.push(A)}else b.set(D,{id:D,colors:[A],transforms:[C]})}let v=Array.from(b.values());m.add(v);let E=this.fragIDData.get(m.id);if(!E)throw new Error("Fragment data not found!");let y=E[2];y.size&&m.setVisibility(!1,y),this.culler.addFragment(e.uuid,t,m),o.push(m)}};Z(tx,"uuid","22437e8d-9dbc-4b99-a04f-d2da280d50c8");var Ds=tx,Ab=class{constructor(){Z(this,"_meshes",new Map)}highlight(e,t,i,n){if(!t.userData.indexFragmentMap||!t.geometry.index)return;let{userData:r}=t,o=r.indexFragmentMap,a=[],l=t.geometry.index.array;for(let[h,u]of o)for(let p in u)if(n[p]){for(let f of u[p])if(n[p].has(f)){let m=l[h*3],g=l[h*3+1],b=l[h*3+2];a.push(m,g,b)}}this._meshes.has(e)||this._meshes.set(e,new Map);let c=this._meshes.get(e);if(!c.has(t.uuid)){let h=new Ii({depthTest:!1,side:2,color:i}),u=new kt;u.attributes=t.geometry.attributes;let p=new $e(u,h);p.frustumCulled=!1,c.set(t.uuid,p)}let d=c.get(t.uuid);d.position.copy(t.position),t.parent&&t.parent!==d.parent&&t.parent.add(d),d.geometry.setIndex(a),d.material.color.copy(i)}clear(e){for(let[t,i]of this._meshes)if(!(e&&e!==t))for(let[n,r]of i)r.removeFromParent()}dispose(){for(let[e,t]of this._meshes)for(let[i,n]of t)n.removeFromParent(),n.geometry.attributes={},n.geometry.dispose(),n.material.dispose();this._meshes.clear()}},ix=class Ib extends At{constructor(e){super(e),Z(this,"onDisposed",new Oe),Z(this,"onBeforeUpdate",new Oe),Z(this,"onAfterUpdate",new Oe),Z(this,"onSetup",new Oe),Z(this,"isSetup",!1),Z(this,"enabled",!0),Z(this,"events",{}),Z(this,"multiple","ctrlKey"),Z(this,"zoomFactor",1.5),Z(this,"zoomToSelection",!1),Z(this,"backupColor",null),Z(this,"selection",{}),Z(this,"config",{selectName:"select",hoverName:"hover",selectionColor:new zt("#BCF124"),hoverColor:new zt("#6528D7"),autoHighlightOnClick:!0,world:null,selectEnabled:!0,hoverEnabled:!0}),Z(this,"colors",new Map),Z(this,"autoToggle",new Set),Z(this,"selectable",{}),Z(this,"_fills",new Ab),Z(this,"_mouseState",{down:!1,moved:!1}),Z(this,"_colorsBeforeSelect",{}),Z(this,"saveHighlightersBeforeSelect",t=>{var i;let n=this.components.get(Rt);for(let r in t){let o=n.list.get(r);if(!o)continue;let a=(i=o.group)==null?void 0:i.uuid;if(a)for(let l in this.selection){if(l===this.config.selectName||l===this.config.hoverName)continue;let c=this.selection[l][r];if(c){l in this._colorsBeforeSelect||(this._colorsBeforeSelect[l]={}),a in this._colorsBeforeSelect[l]||(this._colorsBeforeSelect[l]={[a]:new Set});for(let d of c)this._colorsBeforeSelect[l][a].add(d)}}}}),Z(this,"restoreHighlightersAfterDeselect",()=>{let t=this.components.get(Rt);for(let i in this._colorsBeforeSelect){let n={},r=this._colorsBeforeSelect[i];for(let o in r){let a=t.groups.get(o);if(!a)continue;let l=a.getFragmentMap(r[o]);n=Se(Se({},n),l)}this.highlightByID(i,n,!1,!1)}this._colorsBeforeSelect={}}),Z(this,"clearHover",()=>{this.selection[this.config.hoverName]={}}),Z(this,"onMouseDown",()=>{this.enabled&&(this._mouseState.down=!0)}),Z(this,"onMouseUp",t=>ie(this,null,function*(){if(!this.enabled)return;let{world:i,autoHighlightOnClick:n,selectEnabled:r}=this.config;if(!i)throw new Error("No world found!");if(!i.renderer)throw new Error("This world doesn't have a renderer!");if(t.target===i.renderer.three.domElement){if(this._mouseState.down=!1,this._mouseState.moved||t.button!==0){this._mouseState.moved=!1;return}if(this._mouseState.moved=!1,n&&r){let o=this.multiple==="none"?!0:!t[this.multiple];yield this.highlight(this.config.selectName,o,this.zoomToSelection)}}})),Z(this,"onMouseMove",()=>ie(this,null,function*(){if(!this.enabled)return;let{hoverName:t,hoverEnabled:i}=this.config;if(this._mouseState.moved){this.clear(t);return}this._mouseState.moved=this._mouseState.down;let n={};for(let r in this.selection){if(r===t)continue;let o=this.selection[r];for(let a in o){a in n||(n[a]=new Set);let l=o[a];for(let c of l)n[a].add(c)}}i&&(yield this.highlight(this.config.hoverName,!0,!1,n))})),this.components.add(Ib.uuid,this)}dispose(){return ie(this,null,function*(){this.setupEvents(!1),this._fills.dispose(),this.onBeforeUpdate.reset(),this.onAfterUpdate.reset(),this.selection={};for(let e in this.events)this.events[e].onClear.reset(),this.events[e].onHighlight.reset();this.onSetup.reset(),this.events={},this.onDisposed.trigger(Ib.uuid),this.onDisposed.reset()})}add(e,t){if(this.selection[e]||this.colors.has(e))throw new Error("A selection with that name already exists!");this.colors.set(e,t),this.selection[e]={},this.events[e]={onHighlight:new Oe,onClear:new Oe}}highlight(r){return ie(this,arguments,function*(e,t=!0,i=this.zoomToSelection,n={}){if(!this.enabled)return null;if(!this.config.world)throw new Error("No world found in config!");let o=this.config.world;if(!this.selection[e])throw new Error(`Selection ${e} does not exist.`);let a=[],l=this.components.get(Rt).meshes;for(let b of l)a.push(b);let c=this.components.get(Bl);for(let b of c.list){let v=b;if(v.edges){let E=v.edges.fillMeshes;for(let y of E)a.push(y)}}let d=this.components.get(rs).get(o).castRay(a);if(!d||!d.face)return this.clear(e),null;let h=d.object;if(!h.fragment&&h.userData.indexFragmentMap){if(d.faceIndex===void 0||!h.geometry.index)return null;let{userData:b}=h,v=b.indexFragmentMap.get(d.faceIndex);if(v){yield this.highlightByID(e,v,t,i,n,h,!0);let E=Object.keys(v)[0];return{id:Array.from(v[E])[0],fragments:v}}return null}let u=h.geometry,p=d.instanceId;if(!u||p===void 0)return null;let f=h.fragment.getItemID(p);if(f===null)throw new Error("Item ID not found!");let m=h.fragment.group;if(!m)throw new Error("Fragment must belong to a FragmentsGroup!");let g=m.getFragmentMap([f]);return yield this.highlightByID(e,g,t,i,n,void 0,!0),{id:f,fragments:g}})}highlightByID(l,c){return ie(this,arguments,function*(e,t,i=!0,n=this.zoomToSelection,r={},o=void 0,a=!1){if(!this.enabled)return;i&&this.clear(e);let d=this.components.get(Rt),h=this.colors.get(e);if(!h)throw new Error("Color for selection not found!");let u={};for(let p in t){let f=t[p],m=r[p];for(let g of f)if(!(m&&m.has(g))){if(this.selectable[e]){let b=this.selectable[e];if(!b[p]||!b[p].has(g))continue}u[p]||(u[p]=new Set),u[p].add(g)}}for(let p in u){this.selection[e][p]||(this.selection[e][p]=new Set);let f=u[p],m=new Set,g=new Set;for(let v of f){let E=this.selection[e][p];a&&this.autoToggle.has(e)&&E.has(v)?(m.add(v),E.delete(v)):(E.add(v),g.add(v))}let b=d.list.get(p);if(b&&(m.size&&(this.backupColor?b.setColor(this.backupColor,m):b.resetColor(m)),g.size&&b.setColor(h,g),b.mesh.userData.fills))for(let v of b.mesh.userData.fills)this._fills.highlight(e,v,h,t)}this.events[e].onHighlight.trigger(this.selection[e]),o&&this._fills.highlight(e,o,h,t),n&&(yield this.zoomSelection(e))})}clear(e){let t=e?[e]:Object.keys(this.selection);for(let i of t){this._fills.clear(i);let n=this.components.get(Rt),r=this.selection[i];for(let o in this.selection[i]){let a=n.list.get(o);if(!a)continue;let l=r[o];l&&(this.backupColor?a.setColor(this.backupColor,l):a.resetColor(l))}this.events[i].onClear.trigger(null),this.selection[i]={}}}setup(e){this.config=Se(Se({},this.config),e),this.add(this.config.selectName,this.config.selectionColor),this.autoToggle.add(this.config.selectName),this.add(this.config.hoverName,this.config.hoverColor),this.setupEvents(!0),this.enabled=!0,this.isSetup=!0,this.onSetup.trigger(this)}updateFragments(e){for(let t of e)for(let i in this.selection){let n=this.selection[i][t.id],r=this.colors.get(i);n&&r&&t.setColor(r,n)}}zoomSelection(e){return ie(this,null,function*(){if(!this.config.world)throw new Error("No world found in config!");let t=this.config.world;if(!t.camera.hasCameraControls())return;let i=this.components.get(Lp),n=this.components.get(Rt);i.reset();let r=this.selection[e];if(!Object.keys(r).length)return;for(let m in r){let g=n.list.get(m);if(!g)continue;let b=r[m];i.addMesh(g.mesh,b)}let o=i.getSphere(),a=1/0,l=-1/0,{x:c,y:d,z:h}=o.center,u=o.radius===a||c===a||d===a||h===a,p=o.radius===l||c===l||d===l||h===l,f=o.radius===0;u||p||f||(o.radius*=this.zoomFactor,yield t.camera.controls.fitToSphere(o,!0))})}setupEvents(e){if(!this.config.world){console.log("No world found while setting up events!");return}if(this.config.world.isDisposing)return;if(!this.config.world.renderer)throw new Error("The given world doesn't have a renderer!");let t=this.config.world.renderer.three.domElement,i=this.events[this.config.selectName].onHighlight;i.remove(this.clearHover),i.remove(this.saveHighlightersBeforeSelect);let n=this.events[this.config.selectName].onClear;n.remove(this.restoreHighlightersAfterDeselect),t.removeEventListener("mousedown",this.onMouseDown),t.removeEventListener("mouseup",this.onMouseUp),t.removeEventListener("pointermove",this.onMouseMove),e&&(i.add(this.clearHover),i.add(this.saveHighlightersBeforeSelect),n.add(this.restoreHighlightersAfterDeselect),t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("mouseup",this.onMouseUp),t.addEventListener("pointermove",this.onMouseMove))}};Z(ix,"uuid","cb8a76f2-654a-4b50-80c6-66fd83cafd77");var Hl=ix,Vh=class extends At{constructor(){super(...arguments),Z(this,"onDisposed",new Oe),Z(this,"world")}get enabled(){return this.world?this.getRenderer().postproduction.customEffects.outlineEnabled:!1}set enabled(e){if(!this.world)throw new Error("Before enabling the outliner, provide a world!");let t=this.getRenderer();t.postproduction.customEffects.outlineEnabled=e}create(e,t){let i=this.getRenderer();if(i.postproduction.customEffects.outlinedMeshes[e]!==void 0)throw new Error(`There's already a style with the name ${e}.`);i.postproduction.customEffects.outlinedMeshes[e]={material:t,meshes:new Set}}add(e,t){let i=this.getRenderer(),n=this.getStyles()[e];if(!n)throw new Error(`The style ${e} does not exist`);let r=i.postproduction.customEffects.outlineScene,o=this.components.get(Rt);for(let a in t){let l=o.list.get(a);if(!l)continue;let c=t[a],d=l.clone(c);d.mesh.instanceColor=null,d.mesh.material=[n.material],n.meshes.add(d.mesh),r.add(d.mesh)}}clear(e){if(e){this.clearStyle(e,!1);return}let t=this.getStyles(),i=Object.keys(t);for(let n of i)this.clearStyle(n,!1);this.world=void 0}dispose(){let e=this.getStyles(),t=Object.keys(e);for(let i of t)this.clearStyle(i,!0);this.onDisposed.trigger(),this.onDisposed.reset()}clearStyle(e,t){let i=this.getStyles(),n=i[e];if(!n)return;let r=this.components.get(nr);for(let o of n.meshes){let a=o;a.fragment&&a.fragment.dispose(!1),r.destroy(o)}n.meshes.clear(),t&&(n.material.dispose(),delete i[e])}getStyles(){return this.getRenderer().postproduction.customEffects.outlinedMeshes}getRenderer(){if(!this.world)throw new Error("You must set a world to use the outliner!");let e=this.world.renderer;if(!e.postproduction)throw new Error("The world given to the outliner must use the postproduction renderer.");return e}};Z(Vh,"uuid","2fd3bcc5-b3b6-4ded-9f64-f47a02854a10");var Ms=class extends At{constructor(){super(...arguments),Z(this,"enabled",!1),Z(this,"onDisposed",new Oe),Z(this,"onNavigated",new Oe),Z(this,"onExited",new Oe),Z(this,"planeType","section"),Z(this,"offset",100),Z(this,"list",new Map),Z(this,"world"),Z(this,"current",null),Z(this,"cached3DCamera",{position:new ce,target:new ce,projection:"Perspective",zoom:1,top:10,bottom:-10,right:10,left:-10})}create(e){let t=this.getWorld(),{id:i,point:n,normal:r,type:o}=e,{name:a,offset:l}=e,c=this.components.get(Bl),d=c.Type;c.Type=go;let h=c.createFromNormalAndCoplanarPoint(t,r,n);h.visible=!1,h.edges.visible=!1,h.enabled=!1,a=a||i,l=l||this.offset,h.type=o||this.planeType,h.updateFill();let u=r.clone().multiplyScalar(-l).add(n),p=n.clone(),f={id:i,name:a,plane:h,offset:l,cached:{position:u,target:p,zoom:1,size:10}};return this.list.set(i,f),c.Type=d,f}delete(e){let t=this.list.get(e);t&&(t.plane.dispose(),this.list.delete(e))}goTo(e,t=!1){return ie(this,null,function*(){var i;let n=this.getCamera();if(((i=this.current)==null?void 0:i.id)===e)return;let r=this.list.get(e);if(!r)throw new Error(`There's no section with the ID: ${e}.`);this.cacheCameraPosition(),yield this.hidePreviousClippingPlane(),yield n.projection.set("Orthographic"),this.current=r;let o=new ce,a=new ce,{cached:l}=r,{position:c,target:d}=l;o.copy(d),a.copy(c),yield n.controls.setLookAt(a.x,a.y,a.z,o.x,o.y,o.z,t);let h=r.cached.size,u=n.threePersp.aspect;n.threeOrtho.top=h,n.threeOrtho.bottom=-h,n.threeOrtho.left=-h*u,n.threeOrtho.right=h*u,n.threeOrtho.updateProjectionMatrix(),yield n.controls.zoomTo(l.zoom,!1),n.set("Plan"),this.current.plane&&(this.current.plane.enabled=!0,this.current.plane.edges.fillNeedsUpdate=!0,this.current.plane.edges.visible=!0),this.enabled=!0,this.onNavigated.trigger({id:e})})}exit(e=!1){return ie(this,null,function*(){if(!this.enabled||!this.world)return;this.cacheCameraPosition();let t=this.getCamera();t.set("Orbit");let{position:i,target:n,projection:r}=this.cached3DCamera;yield t.projection.set(r),this.current&&(this.current.plane.enabled=!1,this.current.plane.edges.enabled=!1,this.current.plane.edges.visible=!1),this.current=null;let{x:o,y:a,z:l}=i,{x:c,y:d,z:h}=n;yield t.controls.setLookAt(o,a,l,c,d,h,e),t.projection.current==="Orthographic"&&(yield t.controls.zoomTo(this.cached3DCamera.zoom,!1),t.threeOrtho.left=this.cached3DCamera.left,t.threeOrtho.right=this.cached3DCamera.right,t.threeOrtho.top=this.cached3DCamera.top,t.threeOrtho.bottom=this.cached3DCamera.bottom),this.enabled=!1,this.onExited.trigger()})}dispose(){for(let[,{plane:e}]of this.list)e.dispose();this.list.clear(),this.onDisposed.trigger(),this.onDisposed.reset()}getWorld(){if(!this.world)throw new Error("World is needed to create sections!");return this.world}getCamera(){let e=this.getWorld().camera;if(!e.hasCameraControls()||!e.projection)throw new Error("The world given to sections must have an OrthoPerspective camera.");return e}cacheCameraPosition(){if(!this.world)throw new Error("World is needed to create clipping planes!");let e=this.getCamera();if(this.enabled){if(!this.current)throw new Error("Current section not found!");let{cached:t}=this.current,{position:i,target:n}=t;e.controls.getPosition(i),e.controls.getTarget(n),t.zoom=e.threeOrtho.zoom,t.size=e.threeOrtho.top}else{e.three.getWorldPosition(this.cached3DCamera.position),e.controls.getTarget(this.cached3DCamera.target),this.cached3DCamera.projection=e.projection.current,this.cached3DCamera.zoom=e.threeOrtho.zoom;let{top:t,bottom:i,left:n,right:r}=e.threeOrtho;this.cached3DCamera.top=t,this.cached3DCamera.bottom=i,this.cached3DCamera.left=n,this.cached3DCamera.right=r}}hidePreviousClippingPlane(){return ie(this,null,function*(){if(this.current){let e=this.current.plane;e&&(e.enabled=!1),this.current.plane.edges.visible=!1}})}};Z(Ms,"uuid","45b41ba3-7bb8-4e08-909f-e0fa87973965");var YL=class nx extends At{constructor(e){super(e),Z(this,"onDisposed",new Oe),Z(this,"planeType","floorplan"),Z(this,"onNavigated",new Oe),Z(this,"onExited",new Oe),Z(this,"enabled",!1),Z(this,"currentPlan",null),Z(this,"offset",1.5),Z(this,"list",[]),Z(this,"_cachedPlanCamera",null),this.components.add(nx.uuid,this)}get world(){return this.components.get(Ms).world}set world(e){let t=this.components.get(Ms);t.world=e}get defaultCameraOffset(){return this.components.get(Ms).offset}set defaultCameraOffset(e){let t=this.components.get(Ms);t.offset=e}dispose(){this.onExited.reset(),this.onNavigated.reset();let e=this.components.get(Ms);for(let t of this.list)e.delete(t.id);this.list=[],this.onDisposed.trigger(),this.onDisposed.reset()}generate(e){return ie(this,null,function*(){if(!e.hasProperties)throw new Error("Properties are needed to compute plan views!");let t=yield e.getAllPropertiesOfType(ah);if(!t)throw new Error("Floorplans not found!");let i=e.coordinationMatrix.elements[13],n=yield uo.getUnits(e);for(let r of Object.values(t)){let o={value:0};this.getAbsoluteFloorHeight(r.ObjectPlacement,o);let a=o.value*n+i+this.offset;this.create({name:r.Name.value,id:r.GlobalId.value,normal:new ce(0,-1,0),point:new ce(0,a,0)})}})}create(e){let t=this.components.get(Ms);e.type=e.type||this.planeType;let i=yt(Se({},t.create(e)),{planOffset:this.offset});this.list.push(i)}goTo(e,t=!1){return ie(this,null,function*(){this.enabled&&this.cachePlanCamera(),yield this.components.get(Ms).goTo(e,t),yield this.applyCachedPlanCamera(),this.enabled=!0})}exitPlanView(e=!1){return ie(this,null,function*(){this.enabled&&(this.cachePlanCamera(),yield this.components.get(Ms).exit(e),this.enabled=!1,this.onExited.trigger())})}cachePlanCamera(){var e;let t=(e=this.world)==null?void 0:e.camera,i=new ce,n=new ce;t.controls.getTarget(i),t.controls.getPosition(n),this._cachedPlanCamera={target:i,position:n,zoom:t.threeOrtho.zoom,top:t.threeOrtho.top,right:t.threeOrtho.right,bottom:t.threeOrtho.bottom,left:t.threeOrtho.left}}applyCachedPlanCamera(){return ie(this,null,function*(){var e;if(!this._cachedPlanCamera)return;let t=(e=this.world)==null?void 0:e.camera,{position:i,target:n}=this._cachedPlanCamera,r=new ce,o=new ce;t.controls.getPosition(r),t.controls.getTarget(o);let a=r.y,l=o.y;yield t.controls.setLookAt(i.x,a,i.z,n.x,l,n.z),yield t.controls.zoomTo(this._cachedPlanCamera.zoom),t.threeOrtho.top=this._cachedPlanCamera.top,t.threeOrtho.bottom=this._cachedPlanCamera.bottom,t.threeOrtho.left=this._cachedPlanCamera.left,t.threeOrtho.right=this._cachedPlanCamera.right,t.threeOrtho.updateProjectionMatrix()})}getAbsoluteFloorHeight(e,t){let i=e.RelativePlacement.Location.Coordinates;t.value+=i[2].value,e.PlacementRelTo&&this.getAbsoluteFloorHeight(e.PlacementRelTo,t)}};Z(YL,"uuid","a80874aa-1c93-43a4-80f2-df346da086b1");function sx(s,e){let t={};return Object.keys(s).forEach(i=>{s[i].has(e)&&(t[i]=new Set([e]))}),t}var rx=Cs(la());var Lb=(()=>{let e=class e extends mn{constructor(i){super(i),this.enabled=!0,this.events=new rx.EventEmitter;let r=this.components.get(Hi).list.values().next().value;this._container=r.renderer.container,this._world=r,this._highlighter=i.get(Hl),this._initEventListeners()}get(){return e.uuid}destroy(){this._container.removeEventListener("dragover",this._ev1),this._container.removeEventListener("drop",this._ev2)}_initEventListeners(){let i=new no,n=new Bt,o=this.components.get(_E).get(this._world);this._ev1=this._container.addEventListener("dragover",a=>ie(this,null,function*(){a.preventDefault(),a.stopImmediatePropagation(),n.x=a.clientX/window.innerWidth*2-1,n.y=-(a.clientY/window.innerHeight)*2+1,i.setFromCamera(n,this._world.camera.three);let l=i.intersectObjects(this._world.scene.three.children),c=o.filterClippingPlanes(l),d=c.length>0?c[0]:null;if(!d){this._previousHoveredElement=void 0,this.events.emit("filesHoveredOverElement",void 0);return}let h=d?yield this._highlight(d,"hover",!0,!1):void 0;h?.id!==this._previousHoveredElement?.id&&(this.events.emit("filesHoveredOverElement",h),this._previousHoveredElement=h)})),this._ev2=this._container.addEventListener("drop",a=>{if(a.preventDefault(),a.stopPropagation(),this._previousHoveredElement!==void 0){let l=a.dataTransfer?.files;l!==void 0&&this.events.emit("filesDroppedOnElement",this._previousHoveredElement,l)}})}_highlight(l,c){return ie(this,arguments,function*(i,n,r=!0,o=!1,a={}){if(!this.enabled)return;let d=i.object;if(!d.fragment&&d.userData.indexFragmentMap){if(i.faceIndex===void 0||!d.geometry.index)return;let{userData:g}=d,v=g.indexFragmentMap.get(i.faceIndex);if(v){yield this._highlighter.highlightByID(n,v,r,o,a,d);let E=Object.keys(v)[0];return{id:Array.from(v[E])[0],fragments:v}}return}let h=d.geometry,u=i.instanceId;if(!h||u===void 0)return;let p=d.fragment.getItemID(u);if(p===null)throw new Error("Item ID not found!");let f=d.fragment.group;if(!f)throw new Error("Fragment must belong to a FragmentsGroup!");let m=f.getFragmentMap([p]);return yield this._highlighter.highlightByID(n,m,r,o,a,void 0),{id:p,fragments:m}})}};e.uuid="7e28edb0-3912-4dd5-ba90-73c9c98f18af";let s=e;return s})();var Gl=(()=>{let e=class e extends mn{constructor(i){super(i),this._enabled=!0,this._settings=new gl,this.events=new ox.EventEmitter,this._idMapping=i.get(gn);let n=this.components.get(Hi);this._world=n.list.values().next().value,this._highlighter=i.get(Hl),this._outliner=i.get(Vh),this._outliner.world=this._world,this._outliner.enabled=!0,this._fileDrop=i.get(Lb),this._fileDrop.events.addListener("filesDroppedOnElement",r=>console.log(r)),this._fileDrop=i.get(Lb),this._fileDrop.events.addListener("filesDroppedOnElement",r=>console.log(r)),this._settings.config.world=this._world,this._highlighter.isSetup||(this._highlighter.setup(this._settings.config),this.settings=this._settings),this._createOutliners(),this._initEventListeners()}dispose(){this._highlighter.dispose()}get(){return e.uuid}set enabled(i){this._enabled=i,this._highlighter.enabled=i,i||this.clearSelection()}get enabled(){return this._enabled}set settings(i){i.config.world=this._world,this._enabled=i.enabled,this._highlighter.enabled=i.enabled,this._highlighter.zoomToSelection=i.zoomToSelection,this._highlighter.config=i.config,this._highlighter.colors.set("hover",i.config.hoverColor),this._highlighter.colors.set("select",i.config.selectionColor),this._highlighter.multiple="shiftKey",this._settings=i}setSelectedElements(i,n=!0){return ie(this,null,function*(){if(i.length===0)this.clearSelection();else{let r=this._idMapping.getFragmentIDMap(i);this._highlighter.highlightByID("select",r,!0)}})}clearSelection(){this._highlighter.events.select!==void 0&&this._highlighter.clear("select"),this._highlighter.events.hover!==void 0&&this._highlighter.clear("hover")}_initEventListeners(){this._highlighter.events.hover.onHighlight.add(i=>{if(!this._enabled)return;let n=this._getHighlightElements(i);this.events.emit("hoveredElement",n[0])}),this._highlighter.events.hover.onClear.add(()=>{this._enabled&&this.events.emit("hoveredElement",void 0)}),this._highlighter.events.select.onHighlight.add(i=>{if(!this._enabled)return;this._outliner.clear("select"),this._outliner.add("select",i);let n=this._getHighlightElements(i);this.events.emit("selectionChange",n)}),this._highlighter.events.select.onClear.add(()=>{this._enabled&&(this._outliner.clear("select"),this.events.emit("selectionChange",[]))})}_getHighlightElements(i){let n=new Set;return Object.values(i).forEach(r=>r.forEach(o=>n.add(o))),Array.from(n).map(r=>{let o,a,l=sx(i,r),c=Object.keys(l).find(d=>this._idMapping.modelUUIDFromFragmentID(d)!==void 0);return c!==void 0&&(o=this._idMapping.modelUUIDFromFragmentID(c),a=o!==void 0?this._idMapping.getElementUUID(o,r):void 0),{expressID:r,modelUUID:o,elementUUID:a,fragmentIdMap:l}})}_createOutliners(){this._outliner.create("select",this._settings.selectOutlinerMaterial)}};e.uuid="9d416ec9-fa15-4bb0-8e47-065e4c1f0751";let s=e;return s})();var lx=Cs(la());var yo=class{constructor(){this.urlAuthenticator=(e,t="processed")=>ie(this,null,function*(){return e}),this.culler=new Fb}};var Fb=class{constructor(){this.threshold=10,this.bboxThreshold=200,this.maxHiddenTime=1e3,this.maxLostTime=4e4}};function ax(s,e=t=>ie(this,null,function*(){return t})){return ie(this,null,function*(){s.fetch=t=>ie(this,null,function*(){return t=t.split("to-be-removed")[1],t=yield e(t),fetch(t)}),s.load=function(t,i,n){return ie(this,null,function*(){let{geometries:r,globalDataFileId:o,skipSpaces:a,skipOpenings:l,typeMap:c}=t,{assets:d}=t;(a||l)&&(d=d.filter(y=>{if(c!==void 0){let w=c[y.id];if(a&&w===As)return y.geometries.forEach(C=>delete r[C.geometryID]),!1;if(l&&w===oh)return y.geometries.forEach(C=>delete r[C.geometryID]),!1}return!0}));let h=this.url+o,p=yield(yield this.fetch(h)).arrayBuffer(),f=new Uint8Array(p),g=this.components.get(Gi).load(f,{coordinate:i,isStreamed:!0});g.name=o.replace("-processed-global",""),this.world.scene.three.add(g);let{opaque:b,transparent:v}=g.geometryIDs;for(let[y,w]of b){let C=g.keyFragments.get(w);if(C===void 0)throw new Error("Malformed fragments group!");this.fragIDData.set(C,[g,y,new Set])}for(let[y,w]of v){let C=g.keyFragments.get(w);if(C===void 0)throw new Error("Malformed fragments group!");this.fragIDData.set(C,[g,Math.abs(y),new Set])}this.culler.add(g.uuid,d,r),this.models[g.uuid]={assets:d,geometries:r};let E=new Map;for(let y of d){let w=y.id;if(!(a&&c!==void 0&&c[w]===As))for(let{transformation:C,geometryID:A,color:D}of y.geometries){E.has(A)||E.set(A,[]);let M=E.get(A);if(!M)throw new Error("Malformed instances");M.push({id:w,transformation:C,color:D})}}if(this._geometryInstances[g.uuid]=E,n){let y=new Map,w=new Map;for(let F in n.ids){let V=n.ids[F],x=parseInt(F,10);y.set(x,V)}for(let F in n.types){let V=n.types[F],x=parseInt(F,10);w.set(x,V)}let C=o.replace("-global","-properties");g.streamSettings={baseUrl:this.url,baseFileName:C,ids:y,types:w};let{indexesFile:A}=n,D=this.url+A,I=yield(yield this.fetch(D)).text(),O=this.components.get(Nn);O.setRelationMap(g,O.getRelationsMapFromJSON(I))}return this.culler.updateTransformations(g.uuid),this.culler.needsUpdate=!0,g})},s.loadFoundGeometries=function(t,i=!0){return ie(this,null,function*(){for(let n in t){if(this._isDisposing)return;let o=this.components.get(Gi).groups.get(n);if(!o)return;let{geometries:a}=this.models[n],l=new Map,c=new Set;for(let[p,f]of t[n])for(let m of f){c.add(m);let g=a[m];if(!g){console.warn("Geometry not found"),c.delete(m);continue}if(g.geometryFile){let b=g.geometryFile,v=l.get(b)||0;l.set(b,v+p)}}let d=Array.from(l).sort((p,f)=>f[1]-p[1]);for(let[p]of d){let f=this.url+p;if(!this._ramCache.has(f)){let b=new Uint8Array;if(this.useCache){this.dbCleaner.update(f);let E=yield this._fileCache.files.get(f);if(E)b=E.file;else{let w=yield(yield this.fetch(f)).arrayBuffer();b=new Uint8Array(w),this._fileCache.files.add({file:b,id:f})}}else{let y=yield(yield this.fetch(f)).arrayBuffer();b=new Uint8Array(y)}let v=this.serializer.import(b);this._ramCache.set(f,{data:v,time:performance.now()})}let m=this._ramCache.get(f);if(!m)continue;m.time=performance.now();let g=[];if(m)for(let[b,{position:v,index:E,normal:y}]of m.data){if(this._isDisposing)return;if(!c.has(b)||!this._geometryInstances[n]||!this._geometryInstances[n].has(b))continue;let C=this._geometryInstances[n].get(b);if(!C)throw new Error("Instances not found!");let A=new kt,D=new Ti(v,3),M=new Ti(y,3);A.setAttribute("position",D),A.setAttribute("normal",M),A.setIndex(Array.from(E));let I=[],O=[];for(let F of C)F.color[3]===1?O.push(F):I.push(F);this.newFragment(o,b,A,I,!0,g,i),this.newFragment(o,b,A,O,!1,g,i)}g.length&&!this._isDisposing&&this.onFragmentsLoaded.trigger(g)}let h=new Set,u=performance.now();for(let[p,{time:f}]of this._ramCache)u-f>this.maxRamTime&&h.add(p);for(let p of h)this._ramCache.delete(p)}})}})}var Ea=(()=>{let e=class e extends mn{constructor(i){super(i),this.enabled=!0,this._settings=new yo,this._loadedModels=[],this.events=new lx.EventEmitter,this._streamLoader=i.get(Ds),this._fragments=i.get(Gi);let n=this.components.get(Hi);this._world=n.list.values().next().value,this._streamLoader.world=this._world,this._applySettings(),this._idMapping=i.get(gn),this._idMapping.events.addListener("loadedModels",r=>{this._loadedModels=r,this.events.emit("modelListUpdated",r)}),this._fragmentBBox=i.get(EE),this._initEventListeners(this._world)}set settings(i){this._settings=i,this._applySettings(),ax(this._streamLoader,this._settings.urlAuthenticator)}set world(i){this.world=i,this._streamLoader.world=i}dispose(){return ie(this,null,function*(){yield this.unloadAll(),this._streamLoader.dispose(),this._fragmentBBox.reset()})}get(){return e.uuid}loadStream(i,n=!0){return ie(this,null,function*(){this._streamLoader.url="to-be-removed";let r=yield this._streamLoader.load(i,n);return this.events.emit("modelWasLoaded",r),this._afterLoad(i.modelUUID,i.idMap,r),r})}resourceLoad(l,c){return ie(this,arguments,function*(i,n,r=[],o=!0,a=!0){let d=yield this._settings.urlAuthenticator(`${i}/tiles/${n}-gdef`),h=yield DE(d,r);return h.skipSpaces=o,h.skipOpenings=a,yield this.loadStream(h)})}loadFragments(o){return ie(this,arguments,function*(i,n="",r={}){let a=yield this._fragments.load(i);n===""&&(n=a.uuid),this._afterLoad(n,r,a)})}unloadAll(){return ie(this,null,function*(){this._loadedModels.forEach(i=>{let n=this._idMapping.getFragmentsGroupFromModelUUID(i);n!==void 0&&this._unloadFragmentGroup(n)})})}unloadModel(i){let n=this._idMapping?.getFragmentsGroupFromModelUUID(i);if(n===void 0)throw new Error("Unknown model");this._unloadFragmentGroup(n)}getBBox(){return this._fragmentBBox.getMesh()}setVisibility(i,n){let r=this._idMapping?.getFragmentsGroupFromModelUUID(n);if(r===void 0)return;r.visible=i;let o=new Set;r.items.forEach(l=>l.ids.forEach(c=>o.add(c)));let a=r.getFragmentMap(o);this._streamLoader.setVisibility(i,a),this._streamLoader.culler.needsUpdate=!0}setStatic(i,n,r){this._streamLoader.setStatic(i,n,r)}clearCache(){return ie(this,null,function*(){yield this._streamLoader.clearCache()})}_unloadFragmentGroup(i){this._idMapping.removeIdMap(i.uuid),this._fragments.disposeGroup(i)}_afterLoad(i,n={},r){this._idMapping.setModelIdMaps(i,r.uuid,n),this._fragmentBBox.add(r),this._world.update(),window.dispatchEvent(new Event("resize"))}_initEventListeners(i){i?.camera?.controls?.addEventListener("rest",()=>{this._streamLoader.culler.needsUpdate=!0})}_applySettings(){this._streamLoader.culler.threshold=this._settings.culler.threshold,this._streamLoader.culler.maxHiddenTime=this._settings.culler.maxHiddenTime,this._streamLoader.culler.maxLostTime=this._settings.culler.maxLostTime,this._streamLoader.culler.bboxThreshold=this._settings.culler.bboxThreshold}};e.uuid="d85b66db-564c-42c9-b92f-7632d740f607";let s=e;return s})();var qt=class{constructor(){this.nearPlane=.1,this.visibility=new Gh,this.makeAllDoubleSided=!0,this.highlighter=new gl,this.uiSettings=new zb,this.loading=new yo,this.labels=new Wb}},Gh=class{constructor(){this.showGrid=!1,this.showNavCube=!0,this.showStats=!0,this.showDebugFrame=!1,this.ui=new kb}},kb=class{constructor(){this.enabled=!0,this.toolbar=new Nb,this.contextMenu=new Bb,this.showElementPropertiesOnClick=!0,this.showProjectModels=!0,this.showSpatialDecomposition=!0}},Nb=class{constructor(){this.enabled=!0,this.visibility=new Ub,this.showSectionsSection=!0,this.showMeasureSection=!0,this.showAdminSection=!1}},Ub=class{constructor(){this.enabled=!0,this.showHideToggleGridOption=!0,this.showFitModelOption=!0}},Bb=class{constructor(){this.enabled=!0,this.showHideElementOption=!0,this.showIsolateElementOption=!0,this.showFocusElementOption=!0}},zb=class{constructor(){this.showUI=!1,this.generalUISettings=new Vb,this.mepUISettings=new jb}},Vb=class{constructor(){this.show=!0,this.measureTools=new Hb,this.sectionTools=new Gb}},jb=class{constructor(){this.show=!0}},Hb=class{constructor(){this.angle=!0,this.area=!0,this.length=!0}},Gb=class{constructor(){this.show=!0}},Wb=class{constructor(){this.navCube={rightText:"RIGHT",leftText:"LEFT",topText:"TOP",bottomText:"BOTTOM",frontText:"FRONT",backText:"BACK"}}},Wh=class{constructor(e,t,i=1,n){this.point=e,this.direction=t,this.length=i,this.color=n}};var XL=Object.defineProperty,KL=(s,e,t)=>e in s?XL(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Ca=(s,e,t)=>(KL(s,typeof e!="symbol"?e+"":e,t),t),Yl=Math.min,Ar=Math.max,tf=Math.round,Eo=s=>({x:s,y:s}),$L={left:"right",right:"left",bottom:"top",top:"bottom"},ZL={start:"end",end:"start"};function cx(s,e,t){return Ar(s,Yl(e,t))}function rd(s,e){return typeof s=="function"?s(e):s}function Ir(s){return s.split("-")[0]}function pf(s){return s.split("-")[1]}function Kx(s){return s==="x"?"y":"x"}function $x(s){return s==="y"?"height":"width"}function Ia(s){return["top","bottom"].includes(Ir(s))?"y":"x"}function Zx(s){return Kx(Ia(s))}function QL(s,e,t){t===void 0&&(t=!1);let i=pf(s),n=Zx(s),r=$x(n),o=n==="x"?i===(t?"end":"start")?"right":"left":i==="start"?"bottom":"top";return e.reference[r]>e.floating[r]&&(o=nf(o)),[o,nf(o)]}function JL(s){let e=nf(s);return[Qb(s),e,Qb(e)]}function Qb(s){return s.replace(/start|end/g,e=>ZL[e])}function eF(s,e,t){let i=["left","right"],n=["right","left"],r=["top","bottom"],o=["bottom","top"];switch(s){case"top":case"bottom":return t?e?n:i:e?i:n;case"left":case"right":return e?r:o;default:return[]}}function tF(s,e,t,i){let n=pf(s),r=eF(Ir(s),t==="start",i);return n&&(r=r.map(o=>o+"-"+n),e&&(r=r.concat(r.map(Qb)))),r}function nf(s){return s.replace(/left|right|bottom|top/g,e=>$L[e])}function iF(s){return Se({top:0,right:0,bottom:0,left:0},s)}function Qx(s){return typeof s!="number"?iF(s):{top:s,right:s,bottom:s,left:s}}function ql(s){let{x:e,y:t,width:i,height:n}=s;return{width:i,height:n,top:t,left:e,right:e+i,bottom:t+n,x:e,y:t}}function hx(s,e,t){let{reference:i,floating:n}=s,r=Ia(e),o=Zx(e),a=$x(o),l=Ir(e),c=r==="y",d=i.x+i.width/2-n.width/2,h=i.y+i.height/2-n.height/2,u=i[a]/2-n[a]/2,p;switch(l){case"top":p={x:d,y:i.y-n.height};break;case"bottom":p={x:d,y:i.y+i.height};break;case"right":p={x:i.x+i.width,y:h};break;case"left":p={x:i.x-n.width,y:h};break;default:p={x:i.x,y:i.y}}switch(pf(e)){case"start":p[o]-=u*(t&&c?-1:1);break;case"end":p[o]+=u*(t&&c?-1:1);break}return p}var nF=(s,e,t)=>ie(void 0,null,function*(){let{placement:i="bottom",strategy:n="absolute",middleware:r=[],platform:o}=t,a=r.filter(Boolean),l=yield o.isRTL==null?void 0:o.isRTL(e),c=yield o.getElementRects({reference:s,floating:e,strategy:n}),{x:d,y:h}=hx(c,i,l),u=i,p={},f=0;for(let m=0;m<a.length;m++){let{name:g,fn:b}=a[m],{x:v,y:E,data:y,reset:w}=yield b({x:d,y:h,initialPlacement:i,placement:u,strategy:n,middlewareData:p,rects:c,platform:o,elements:{reference:s,floating:e}});d=v??d,h=E??h,p=yt(Se({},p),{[g]:Se(Se({},p[g]),y)}),w&&f<=50&&(f++,typeof w=="object"&&(w.placement&&(u=w.placement),w.rects&&(c=w.rects===!0?yield o.getElementRects({reference:s,floating:e,strategy:n}):w.rects),{x:d,y:h}=hx(c,u,l)),m=-1)}return{x:d,y:h,placement:u,strategy:n,middlewareData:p}});function Jx(s,e){return ie(this,null,function*(){var t;e===void 0&&(e={});let{x:i,y:n,platform:r,rects:o,elements:a,strategy:l}=s,{boundary:c="clippingAncestors",rootBoundary:d="viewport",elementContext:h="floating",altBoundary:u=!1,padding:p=0}=rd(e,s),f=Qx(p),m=a[u?h==="floating"?"reference":"floating":h],g=ql(yield r.getClippingRect({element:(t=yield r.isElement==null?void 0:r.isElement(m))==null||t?m:m.contextElement||(yield r.getDocumentElement==null?void 0:r.getDocumentElement(a.floating)),boundary:c,rootBoundary:d,strategy:l})),b=h==="floating"?{x:i,y:n,width:o.floating.width,height:o.floating.height}:o.reference,v=yield r.getOffsetParent==null?void 0:r.getOffsetParent(a.floating),E=(yield r.isElement==null?void 0:r.isElement(v))?(yield r.getScale==null?void 0:r.getScale(v))||{x:1,y:1}:{x:1,y:1},y=ql(r.convertOffsetParentRelativeRectToViewportRelativeRect?yield r.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:b,offsetParent:v,strategy:l}):b);return{top:(g.top-y.top+f.top)/E.y,bottom:(y.bottom-g.bottom+f.bottom)/E.y,left:(g.left-y.left+f.left)/E.x,right:(y.right-g.right+f.right)/E.x}})}var sF=function(s){return s===void 0&&(s={}),{name:"flip",options:s,fn(t){return ie(this,null,function*(){var i,n;let{placement:r,middlewareData:o,rects:a,initialPlacement:l,platform:c,elements:d}=t,N=rd(s,t),{mainAxis:h=!0,crossAxis:u=!0,fallbackPlacements:p,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:g=!0}=N,b=nl(N,["mainAxis","crossAxis","fallbackPlacements","fallbackStrategy","fallbackAxisSideDirection","flipAlignment"]);if((i=o.arrow)!=null&&i.alignmentOffset)return{};let v=Ir(r),E=Ia(l),y=Ir(l)===l,w=yield c.isRTL==null?void 0:c.isRTL(d.floating),C=p||(y||!g?[nf(l)]:JL(l)),A=m!=="none";!p&&A&&C.push(...tF(l,g,m,w));let D=[l,...C],M=yield Jx(t,b),I=[],O=((n=o.flip)==null?void 0:n.overflows)||[];if(h&&I.push(M[v]),u){let z=QL(r,a,w);I.push(M[z[0]],M[z[1]])}if(O=[...O,{placement:r,overflows:I}],!I.every(z=>z<=0)){var F,V;let z=(((F=o.flip)==null?void 0:F.index)||0)+1,G=D[z];if(G)return{data:{index:z,overflows:O},reset:{placement:G}};let X=(V=O.filter(k=>k.overflows[0]<=0).sort((k,B)=>k.overflows[1]-B.overflows[1])[0])==null?void 0:V.placement;if(!X)switch(f){case"bestFit":{var x;let k=(x=O.filter(B=>{if(A){let R=Ia(B.placement);return R===E||R==="y"}return!0}).map(B=>[B.placement,B.overflows.filter(R=>R>0).reduce((R,j)=>R+j,0)]).sort((B,R)=>B[1]-R[1])[0])==null?void 0:x[0];k&&(X=k);break}case"initialPlacement":X=l;break}if(r!==X)return{reset:{placement:X}}}return{}})}}};function eS(s){let e=Yl(...s.map(r=>r.left)),t=Yl(...s.map(r=>r.top)),i=Ar(...s.map(r=>r.right)),n=Ar(...s.map(r=>r.bottom));return{x:e,y:t,width:i-e,height:n-t}}function rF(s){let e=s.slice().sort((n,r)=>n.y-r.y),t=[],i=null;for(let n=0;n<e.length;n++){let r=e[n];!i||r.y-i.y>i.height/2?t.push([r]):t[t.length-1].push(r),i=r}return t.map(n=>ql(eS(n)))}var oF=function(s){return s===void 0&&(s={}),{name:"inline",options:s,fn(t){return ie(this,null,function*(){let{placement:i,elements:n,rects:r,platform:o,strategy:a}=t,{padding:l=2,x:c,y:d}=rd(s,t),h=Array.from((yield o.getClientRects==null?void 0:o.getClientRects(n.reference))||[]),u=rF(h),p=ql(eS(h)),f=Qx(l);function m(){if(u.length===2&&u[0].left>u[1].right&&c!=null&&d!=null)return u.find(b=>c>b.left-f.left&&c<b.right+f.right&&d>b.top-f.top&&d<b.bottom+f.bottom)||p;if(u.length>=2){if(Ia(i)==="y"){let O=u[0],F=u[u.length-1],V=Ir(i)==="top",x=O.top,N=F.bottom,z=V?O.left:F.left,G=V?O.right:F.right,X=G-z,k=N-x;return{top:x,bottom:N,left:z,right:G,width:X,height:k,x:z,y:x}}let b=Ir(i)==="left",v=Ar(...u.map(O=>O.right)),E=Yl(...u.map(O=>O.left)),y=u.filter(O=>b?O.left===E:O.right===v),w=y[0].top,C=y[y.length-1].bottom,A=E,D=v,M=D-A,I=C-w;return{top:w,bottom:C,left:A,right:D,width:M,height:I,x:A,y:w}}return p}let g=yield o.getElementRects({reference:{getBoundingClientRect:m},floating:n.floating,strategy:a});return r.reference.x!==g.reference.x||r.reference.y!==g.reference.y||r.reference.width!==g.reference.width||r.reference.height!==g.reference.height?{reset:{rects:g}}:{}})}}};function aF(s,e){return ie(this,null,function*(){let{placement:t,platform:i,elements:n}=s,r=yield i.isRTL==null?void 0:i.isRTL(n.floating),o=Ir(t),a=pf(t),l=Ia(t)==="y",c=["left","top"].includes(o)?-1:1,d=r&&l?-1:1,h=rd(e,s),{mainAxis:u,crossAxis:p,alignmentAxis:f}=typeof h=="number"?{mainAxis:h,crossAxis:0,alignmentAxis:null}:Se({mainAxis:0,crossAxis:0,alignmentAxis:null},h);return a&&typeof f=="number"&&(p=a==="end"?f*-1:f),l?{x:p*d,y:u*c}:{x:u*c,y:p*d}})}var tS=function(s){return{name:"offset",options:s,fn(t){return ie(this,null,function*(){var i,n;let{x:r,y:o,placement:a,middlewareData:l}=t,c=yield aF(t,s);return a===((i=l.offset)==null?void 0:i.placement)&&(n=l.arrow)!=null&&n.alignmentOffset?{}:{x:r+c.x,y:o+c.y,data:yt(Se({},c),{placement:a})}})}}},lF=function(s){return s===void 0&&(s={}),{name:"shift",options:s,fn(t){return ie(this,null,function*(){let{x:i,y:n,placement:r}=t,b=rd(s,t),{mainAxis:o=!0,crossAxis:a=!1,limiter:l={fn:v=>{let{x:E,y}=v;return{x:E,y}}}}=b,c=nl(b,["mainAxis","crossAxis","limiter"]),d={x:i,y:n},h=yield Jx(t,c),u=Ia(Ir(r)),p=Kx(u),f=d[p],m=d[u];if(o){let v=p==="y"?"top":"left",E=p==="y"?"bottom":"right",y=f+h[v],w=f-h[E];f=cx(y,f,w)}if(a){let v=u==="y"?"top":"left",E=u==="y"?"bottom":"right",y=m+h[v],w=m-h[E];m=cx(y,m,w)}let g=l.fn(yt(Se({},t),{[p]:f,[u]:m}));return yt(Se({},g),{data:{x:g.x-i,y:g.y-n}})})}}};function Co(s){return iS(s)?(s.nodeName||"").toLowerCase():"#document"}function Vn(s){var e;return(s==null||(e=s.ownerDocument)==null?void 0:e.defaultView)||window}function So(s){var e;return(e=(iS(s)?s.ownerDocument:s.document)||window.document)==null?void 0:e.documentElement}function iS(s){return s instanceof Node||s instanceof Vn(s).Node}function sr(s){return s instanceof Element||s instanceof Vn(s).Element}function rr(s){return s instanceof HTMLElement||s instanceof Vn(s).HTMLElement}function dx(s){return typeof ShadowRoot>"u"?!1:s instanceof ShadowRoot||s instanceof Vn(s).ShadowRoot}function od(s){let{overflow:e,overflowX:t,overflowY:i,display:n}=as(s);return/auto|scroll|overlay|hidden|clip/.test(e+i+t)&&!["inline","contents"].includes(n)}function cF(s){return["table","td","th"].includes(Co(s))}function hF(s){return[":popover-open",":modal"].some(e=>{try{return s.matches(e)}catch{return!1}})}function yv(s){let e=_v(),t=sr(s)?as(s):s;return t.transform!=="none"||t.perspective!=="none"||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","perspective","filter"].some(i=>(t.willChange||"").includes(i))||["paint","layout","strict","content"].some(i=>(t.contain||"").includes(i))}function dF(s){let e=Xl(s);for(;rr(e)&&!ff(e);){if(yv(e))return e;if(hF(e))return null;e=Xl(e)}return null}function _v(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function ff(s){return["html","body","#document"].includes(Co(s))}function as(s){return Vn(s).getComputedStyle(s)}function mf(s){return sr(s)?{scrollLeft:s.scrollLeft,scrollTop:s.scrollTop}:{scrollLeft:s.scrollX,scrollTop:s.scrollY}}function Xl(s){if(Co(s)==="html")return s;let e=s.assignedSlot||s.parentNode||dx(s)&&s.host||So(s);return dx(e)?e.host:e}function nS(s){let e=Xl(s);return ff(e)?s.ownerDocument?s.ownerDocument.body:s.body:rr(e)&&od(e)?e:nS(e)}function Jb(s,e,t){var i;e===void 0&&(e=[]),t===void 0&&(t=!0);let n=nS(s),r=n===((i=s.ownerDocument)==null?void 0:i.body),o=Vn(n);if(r){let a=uF(o);return e.concat(o,o.visualViewport||[],od(n)?n:[],a&&t?Jb(a):[])}return e.concat(n,Jb(n,[],t))}function uF(s){return s.parent&&Object.getPrototypeOf(s.parent)?s.frameElement:null}function sS(s){let e=as(s),t=parseFloat(e.width)||0,i=parseFloat(e.height)||0,n=rr(s),r=n?s.offsetWidth:t,o=n?s.offsetHeight:i,a=tf(t)!==r||tf(i)!==o;return a&&(t=r,i=o),{width:t,height:i,$:a}}function rS(s){return sr(s)?s:s.contextElement}function Wl(s){let e=rS(s);if(!rr(e))return Eo(1);let t=e.getBoundingClientRect(),{width:i,height:n,$:r}=sS(e),o=(r?tf(t.width):t.width)/i,a=(r?tf(t.height):t.height)/n;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}var pF=Eo(0);function oS(s){let e=Vn(s);return!_v()||!e.visualViewport?pF:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function fF(s,e,t){return e===void 0&&(e=!1),!t||e&&t!==Vn(s)?!1:e}function Zh(s,e,t,i){e===void 0&&(e=!1),t===void 0&&(t=!1);let n=s.getBoundingClientRect(),r=rS(s),o=Eo(1);e&&(i?sr(i)&&(o=Wl(i)):o=Wl(s));let a=fF(r,t,i)?oS(r):Eo(0),l=(n.left+a.x)/o.x,c=(n.top+a.y)/o.y,d=n.width/o.x,h=n.height/o.y;if(r){let u=Vn(r),p=i&&sr(i)?Vn(i):i,f=u,m=f.frameElement;for(;m&&i&&p!==f;){let g=Wl(m),b=m.getBoundingClientRect(),v=as(m),E=b.left+(m.clientLeft+parseFloat(v.paddingLeft))*g.x,y=b.top+(m.clientTop+parseFloat(v.paddingTop))*g.y;l*=g.x,c*=g.y,d*=g.x,h*=g.y,l+=E,c+=y,f=Vn(m),m=f.frameElement}}return ql({width:d,height:h,x:l,y:c})}var mF=[":popover-open",":modal"];function aS(s){return mF.some(e=>{try{return s.matches(e)}catch{return!1}})}function gF(s){let{elements:e,rect:t,offsetParent:i,strategy:n}=s,r=n==="fixed",o=So(i),a=e?aS(e.floating):!1;if(i===o||a&&r)return t;let l={scrollLeft:0,scrollTop:0},c=Eo(1),d=Eo(0),h=rr(i);if((h||!h&&!r)&&((Co(i)!=="body"||od(o))&&(l=mf(i)),rr(i))){let u=Zh(i);c=Wl(i),d.x=u.x+i.clientLeft,d.y=u.y+i.clientTop}return{width:t.width*c.x,height:t.height*c.y,x:t.x*c.x-l.scrollLeft*c.x+d.x,y:t.y*c.y-l.scrollTop*c.y+d.y}}function bF(s){return Array.from(s.getClientRects())}function lS(s){return Zh(So(s)).left+mf(s).scrollLeft}function vF(s){let e=So(s),t=mf(s),i=s.ownerDocument.body,n=Ar(e.scrollWidth,e.clientWidth,i.scrollWidth,i.clientWidth),r=Ar(e.scrollHeight,e.clientHeight,i.scrollHeight,i.clientHeight),o=-t.scrollLeft+lS(s),a=-t.scrollTop;return as(i).direction==="rtl"&&(o+=Ar(e.clientWidth,i.clientWidth)-n),{width:n,height:r,x:o,y:a}}function yF(s,e){let t=Vn(s),i=So(s),n=t.visualViewport,r=i.clientWidth,o=i.clientHeight,a=0,l=0;if(n){r=n.width,o=n.height;let c=_v();(!c||c&&e==="fixed")&&(a=n.offsetLeft,l=n.offsetTop)}return{width:r,height:o,x:a,y:l}}function _F(s,e){let t=Zh(s,!0,e==="fixed"),i=t.top+s.clientTop,n=t.left+s.clientLeft,r=rr(s)?Wl(s):Eo(1),o=s.clientWidth*r.x,a=s.clientHeight*r.y,l=n*r.x,c=i*r.y;return{width:o,height:a,x:l,y:c}}function ux(s,e,t){let i;if(e==="viewport")i=yF(s,t);else if(e==="document")i=vF(So(s));else if(sr(e))i=_F(e,t);else{let n=oS(s);i=yt(Se({},e),{x:e.x-n.x,y:e.y-n.y})}return ql(i)}function cS(s,e){let t=Xl(s);return t===e||!sr(t)||ff(t)?!1:as(t).position==="fixed"||cS(t,e)}function wF(s,e){let t=e.get(s);if(t)return t;let i=Jb(s,[],!1).filter(a=>sr(a)&&Co(a)!=="body"),n=null,r=as(s).position==="fixed",o=r?Xl(s):s;for(;sr(o)&&!ff(o);){let a=as(o),l=yv(o);!l&&a.position==="fixed"&&(n=null),(r?!l&&!n:!l&&a.position==="static"&&n&&["absolute","fixed"].includes(n.position)||od(o)&&!l&&cS(s,o))?i=i.filter(c=>c!==o):n=a,o=Xl(o)}return e.set(s,i),i}function EF(s){let{element:e,boundary:t,rootBoundary:i,strategy:n}=s,r=[...t==="clippingAncestors"?wF(e,this._c):[].concat(t),i],o=r[0],a=r.reduce((l,c)=>{let d=ux(e,c,n);return l.top=Ar(d.top,l.top),l.right=Yl(d.right,l.right),l.bottom=Yl(d.bottom,l.bottom),l.left=Ar(d.left,l.left),l},ux(e,o,n));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function CF(s){let{width:e,height:t}=sS(s);return{width:e,height:t}}function xF(s,e,t){let i=rr(e),n=So(e),r=t==="fixed",o=Zh(s,!0,r,e),a={scrollLeft:0,scrollTop:0},l=Eo(0);if(i||!i&&!r)if((Co(e)!=="body"||od(n))&&(a=mf(e)),i){let h=Zh(e,!0,r,e);l.x=h.x+e.clientLeft,l.y=h.y+e.clientTop}else n&&(l.x=lS(n));let c=o.left+a.scrollLeft-l.x,d=o.top+a.scrollTop-l.y;return{x:c,y:d,width:o.width,height:o.height}}function px(s,e){return!rr(s)||as(s).position==="fixed"?null:e?e(s):s.offsetParent}function hS(s,e){let t=Vn(s);if(!rr(s)||aS(s))return t;let i=px(s,e);for(;i&&cF(i)&&as(i).position==="static";)i=px(i,e);return i&&(Co(i)==="html"||Co(i)==="body"&&as(i).position==="static"&&!yv(i))?t:i||dF(s)||t}var SF=function(s){return ie(this,null,function*(){let e=this.getOffsetParent||hS,t=this.getDimensions;return{reference:xF(s.reference,yield e(s.floating),s.strategy),floating:Se({x:0,y:0},yield t(s.floating))}})};function AF(s){return as(s).direction==="rtl"}var IF={convertOffsetParentRelativeRectToViewportRelativeRect:gF,getDocumentElement:So,getClippingRect:EF,getOffsetParent:hS,getElementRects:SF,getClientRects:bF,getDimensions:CF,getScale:Wl,isElement:sr,isRTL:AF},dS=lF,uS=sF,pS=oF,fS=(s,e,t)=>{let i=new Map,n=Se({platform:IF},t),r=yt(Se({},n.platform),{_c:i});return nF(s,e,yt(Se({},n),{platform:r}))};var Jp=globalThis,wv=Jp.ShadowRoot&&(Jp.ShadyCSS===void 0||Jp.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Ev=Symbol(),fx=new WeakMap,mS=class{constructor(s,e,t){if(this._$cssResult$=!0,t!==Ev)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=s,this.t=e}get styleSheet(){let s=this.o,e=this.t;if(wv&&s===void 0){let t=e!==void 0&&e.length===1;t&&(s=fx.get(e)),s===void 0&&((this.o=s=new CSSStyleSheet).replaceSync(this.cssText),t&&fx.set(e,s))}return s}toString(){return this.cssText}},TF=s=>new mS(typeof s=="string"?s:s+"",void 0,Ev),ri=(s,...e)=>{let t=s.length===1?s[0]:e.reduce((i,n,r)=>i+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+s[r+1],s[0]);return new mS(t,s,Ev)},PF=(s,e)=>{if(wv)s.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(let t of e){let i=document.createElement("style"),n=Jp.litNonce;n!==void 0&&i.setAttribute("nonce",n),i.textContent=t.cssText,s.appendChild(i)}},mx=wv?s=>s:s=>s instanceof CSSStyleSheet?(e=>{let t="";for(let i of e.cssRules)t+=i.cssText;return TF(t)})(s):s;var{is:OF,defineProperty:MF,getOwnPropertyDescriptor:RF,getOwnPropertyNames:DF,getOwnPropertySymbols:LF,getPrototypeOf:FF}=Object,Kl=globalThis,gx=Kl.trustedTypes,kF=gx?gx.emptyScript:"",bx=Kl.reactiveElementPolyfillSupport,qh=(s,e)=>s,sf={toAttribute(s,e){switch(e){case Boolean:s=s?kF:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,e){let t=s;switch(e){case Boolean:t=s!==null;break;case Number:t=s===null?null:Number(s);break;case Object:case Array:try{t=JSON.parse(s)}catch{t=null}}return t}},Cv=(s,e)=>!OF(s,e),vx={attribute:!0,type:String,converter:sf,reflect:!1,hasChanged:Cv};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),Kl.litPropertyMetadata??(Kl.litPropertyMetadata=new WeakMap);var _o=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??(this.l=[])).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=vx){if(t.state&&(t.attribute=!1),this._$Ei(),this.elementProperties.set(e,t),!t.noAccessor){let i=Symbol(),n=this.getPropertyDescriptor(e,i,t);n!==void 0&&MF(this.prototype,e,n)}}static getPropertyDescriptor(e,t,i){let{get:n,set:r}=RF(this.prototype,e)??{get(){return this[t]},set(o){this[t]=o}};return{get(){return n?.call(this)},set(o){let a=n?.call(this);r.call(this,o),this.requestUpdate(e,a,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??vx}static _$Ei(){if(this.hasOwnProperty(qh("elementProperties")))return;let e=FF(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(qh("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(qh("properties"))){let t=this.properties,i=[...DF(t),...LF(t)];for(let n of i)this.createProperty(n,t[n])}let e=this[Symbol.metadata];if(e!==null){let t=litPropertyMetadata.get(e);if(t!==void 0)for(let[i,n]of t)this.elementProperties.set(i,n)}this._$Eh=new Map;for(let[t,i]of this.elementProperties){let n=this._$Eu(t,i);n!==void 0&&this._$Eh.set(n,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){let t=[];if(Array.isArray(e)){let i=new Set(e.flat(1/0).reverse());for(let n of i)t.unshift(mx(n))}else e!==void 0&&t.push(mx(e));return t}static _$Eu(e,t){let i=t.attribute;return i===!1?void 0:typeof i=="string"?i:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach(t=>t(this))}addController(e){var t;(this._$EO??(this._$EO=new Set)).add(e),this.renderRoot!==void 0&&this.isConnected&&((t=e.hostConnected)==null||t.call(e))}removeController(e){var t;(t=this._$EO)==null||t.delete(e)}_$E_(){let e=new Map,t=this.constructor.elementProperties;for(let i of t.keys())this.hasOwnProperty(i)&&(e.set(i,this[i]),delete this[i]);e.size>0&&(this._$Ep=e)}createRenderRoot(){let e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return PF(e,this.constructor.elementStyles),e}connectedCallback(){var e;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$EO)==null||e.forEach(t=>{var i;return(i=t.hostConnected)==null?void 0:i.call(t)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$EO)==null||e.forEach(t=>{var i;return(i=t.hostDisconnected)==null?void 0:i.call(t)})}attributeChangedCallback(e,t,i){this._$AK(e,i)}_$EC(e,t){var i;let n=this.constructor.elementProperties.get(e),r=this.constructor._$Eu(e,n);if(r!==void 0&&n.reflect===!0){let o=(((i=n.converter)==null?void 0:i.toAttribute)!==void 0?n.converter:sf).toAttribute(t,n.type);this._$Em=e,o==null?this.removeAttribute(r):this.setAttribute(r,o),this._$Em=null}}_$AK(e,t){var i;let n=this.constructor,r=n._$Eh.get(e);if(r!==void 0&&this._$Em!==r){let o=n.getPropertyOptions(r),a=typeof o.converter=="function"?{fromAttribute:o.converter}:((i=o.converter)==null?void 0:i.fromAttribute)!==void 0?o.converter:sf;this._$Em=r,this[r]=a.fromAttribute(t,o.type),this._$Em=null}}requestUpdate(e,t,i){if(e!==void 0){if(i??(i=this.constructor.getPropertyOptions(e)),!(i.hasChanged??Cv)(this[e],t))return;this.P(e,t,i)}this.isUpdatePending===!1&&(this._$ES=this._$ET())}P(e,t,i){this._$AL.has(e)||this._$AL.set(e,t),i.reflect===!0&&this._$Em!==e&&(this._$Ej??(this._$Ej=new Set)).add(e)}_$ET(){return ie(this,null,function*(){this.isUpdatePending=!0;try{yield this._$ES}catch(t){Promise.reject(t)}let e=this.scheduleUpdate();return e!=null&&(yield e),!this.isUpdatePending})}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(let[r,o]of this._$Ep)this[r]=o;this._$Ep=void 0}let n=this.constructor.elementProperties;if(n.size>0)for(let[r,o]of n)o.wrapped!==!0||this._$AL.has(r)||this[r]===void 0||this.P(r,this[r],o)}let t=!1,i=this._$AL;try{t=this.shouldUpdate(i),t?(this.willUpdate(i),(e=this._$EO)==null||e.forEach(n=>{var r;return(r=n.hostUpdate)==null?void 0:r.call(n)}),this.update(i)):this._$EU()}catch(n){throw t=!1,this._$EU(),n}t&&this._$AE(i)}willUpdate(e){}_$AE(e){var t;(t=this._$EO)==null||t.forEach(i=>{var n;return(n=i.hostUpdated)==null?void 0:n.call(i)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Ej&&(this._$Ej=this._$Ej.forEach(t=>this._$EC(t,this[t]))),this._$EU()}updated(e){}firstUpdated(e){}};_o.elementStyles=[],_o.shadowRootOptions={mode:"open"},_o[qh("elementProperties")]=new Map,_o[qh("finalized")]=new Map,bx?.({ReactiveElement:_o}),(Kl.reactiveElementVersions??(Kl.reactiveElementVersions=[])).push("2.0.4");var rf=globalThis,of=rf.trustedTypes,yx=of?of.createPolicy("lit-html",{createHTML:s=>s}):void 0,gS="$lit$",wo=`lit$${Math.random().toFixed(9).slice(2)}$`,bS="?"+wo,NF=`<${bS}>`,Ta=document,Qh=()=>Ta.createComment(""),Jh=s=>s===null||typeof s!="object"&&typeof s!="function",xv=Array.isArray,UF=s=>xv(s)||typeof s?.[Symbol.iterator]=="function",Yb=`[ 	
\f\r]`,Yh=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,_x=/-->/g,wx=/>/g,xa=RegExp(`>|${Yb}(?:([^\\s"'>=/]+)(${Yb}*=${Yb}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),Ex=/'/g,Cx=/"/g,vS=/^(?:script|style|textarea|title)$/i,BF=s=>(e,...t)=>({_$litType$:s,strings:e,values:t}),ct=BF(1),Pa=Symbol.for("lit-noChange"),Di=Symbol.for("lit-nothing"),xx=new WeakMap,Sa=Ta.createTreeWalker(Ta,129);function yS(s,e){if(!xv(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return yx!==void 0?yx.createHTML(e):e}var zF=(s,e)=>{let t=s.length-1,i=[],n,r=e===2?"<svg>":e===3?"<math>":"",o=Yh;for(let a=0;a<t;a++){let l=s[a],c,d,h=-1,u=0;for(;u<l.length&&(o.lastIndex=u,d=o.exec(l),d!==null);)u=o.lastIndex,o===Yh?d[1]==="!--"?o=_x:d[1]!==void 0?o=wx:d[2]!==void 0?(vS.test(d[2])&&(n=RegExp("</"+d[2],"g")),o=xa):d[3]!==void 0&&(o=xa):o===xa?d[0]===">"?(o=n??Yh,h=-1):d[1]===void 0?h=-2:(h=o.lastIndex-d[2].length,c=d[1],o=d[3]===void 0?xa:d[3]==='"'?Cx:Ex):o===Cx||o===Ex?o=xa:o===_x||o===wx?o=Yh:(o=xa,n=void 0);let p=o===xa&&s[a+1].startsWith("/>")?" ":"";r+=o===Yh?l+NF:h>=0?(i.push(c),l.slice(0,h)+gS+l.slice(h)+wo+p):l+wo+(h===-2?a:p)}return[yS(s,r+(s[t]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),i]},ed=class s{constructor({strings:e,_$litType$:t},i){let n;this.parts=[];let r=0,o=0,a=e.length-1,l=this.parts,[c,d]=zF(e,t);if(this.el=s.createElement(c,i),Sa.currentNode=this.el.content,t===2||t===3){let h=this.el.content.firstChild;h.replaceWith(...h.childNodes)}for(;(n=Sa.nextNode())!==null&&l.length<a;){if(n.nodeType===1){if(n.hasAttributes())for(let h of n.getAttributeNames())if(h.endsWith(gS)){let u=d[o++],p=n.getAttribute(h).split(wo),f=/([.?@])?(.*)/.exec(u);l.push({type:1,index:r,name:f[2],strings:p,ctor:f[1]==="."?tv:f[1]==="?"?iv:f[1]==="@"?nv:Zl}),n.removeAttribute(h)}else h.startsWith(wo)&&(l.push({type:6,index:r}),n.removeAttribute(h));if(vS.test(n.tagName)){let h=n.textContent.split(wo),u=h.length-1;if(u>0){n.textContent=of?of.emptyScript:"";for(let p=0;p<u;p++)n.append(h[p],Qh()),Sa.nextNode(),l.push({type:2,index:++r});n.append(h[u],Qh())}}}else if(n.nodeType===8)if(n.data===bS)l.push({type:2,index:r});else{let h=-1;for(;(h=n.data.indexOf(wo,h+1))!==-1;)l.push({type:7,index:r}),h+=wo.length-1}r++}}static createElement(e,t){let i=Ta.createElement("template");return i.innerHTML=e,i}};function $l(s,e,t=s,i){var n,r;if(e===Pa)return e;let o=i!==void 0?(n=t.o)==null?void 0:n[i]:t.l,a=Jh(e)?void 0:e._$litDirective$;return o?.constructor!==a&&((r=o?._$AO)==null||r.call(o,!1),a===void 0?o=void 0:(o=new a(s),o._$AT(s,t,i)),i!==void 0?(t.o??(t.o=[]))[i]=o:t.l=o),o!==void 0&&(e=$l(s,o._$AS(s,e.values),o,i)),e}var ev=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){let{el:{content:t},parts:i}=this._$AD,n=(e?.creationScope??Ta).importNode(t,!0);Sa.currentNode=n;let r=Sa.nextNode(),o=0,a=0,l=i[0];for(;l!==void 0;){if(o===l.index){let c;l.type===2?c=new td(r,r.nextSibling,this,e):l.type===1?c=new l.ctor(r,l.name,l.strings,this,e):l.type===6&&(c=new sv(r,this,e)),this._$AV.push(c),l=i[++a]}o!==l?.index&&(r=Sa.nextNode(),o++)}return Sa.currentNode=Ta,n}p(e){let t=0;for(let i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(e,i,t),t+=i.strings.length-2):i._$AI(e[t])),t++}},td=class s{get _$AU(){var e;return((e=this._$AM)==null?void 0:e._$AU)??this.v}constructor(e,t,i,n){this.type=2,this._$AH=Di,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=i,this.options=n,this.v=n?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode,t=this._$AM;return t!==void 0&&e?.nodeType===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=$l(this,e,t),Jh(e)?e===Di||e==null||e===""?(this._$AH!==Di&&this._$AR(),this._$AH=Di):e!==this._$AH&&e!==Pa&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):UF(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==Di&&Jh(this._$AH)?this._$AA.nextSibling.data=e:this.T(Ta.createTextNode(e)),this._$AH=e}$(e){var t;let{values:i,_$litType$:n}=e,r=typeof n=="number"?this._$AC(e):(n.el===void 0&&(n.el=ed.createElement(yS(n.h,n.h[0]),this.options)),n);if(((t=this._$AH)==null?void 0:t._$AD)===r)this._$AH.p(i);else{let o=new ev(r,this),a=o.u(this.options);o.p(i),this.T(a),this._$AH=o}}_$AC(e){let t=xx.get(e.strings);return t===void 0&&xx.set(e.strings,t=new ed(e)),t}k(e){xv(this._$AH)||(this._$AH=[],this._$AR());let t=this._$AH,i,n=0;for(let r of e)n===t.length?t.push(i=new s(this.O(Qh()),this.O(Qh()),this,this.options)):i=t[n],i._$AI(r),n++;n<t.length&&(this._$AR(i&&i._$AB.nextSibling,n),t.length=n)}_$AR(e=this._$AA.nextSibling,t){var i;for((i=this._$AP)==null?void 0:i.call(this,!1,!0,t);e&&e!==this._$AB;){let n=e.nextSibling;e.remove(),e=n}}setConnected(e){var t;this._$AM===void 0&&(this.v=e,(t=this._$AP)==null||t.call(this,e))}},Zl=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,i,n,r){this.type=1,this._$AH=Di,this._$AN=void 0,this.element=e,this.name=t,this._$AM=n,this.options=r,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=Di}_$AI(e,t=this,i,n){let r=this.strings,o=!1;if(r===void 0)e=$l(this,e,t,0),o=!Jh(e)||e!==this._$AH&&e!==Pa,o&&(this._$AH=e);else{let a=e,l,c;for(e=r[0],l=0;l<r.length-1;l++)c=$l(this,a[i+l],t,l),c===Pa&&(c=this._$AH[l]),o||(o=!Jh(c)||c!==this._$AH[l]),c===Di?e=Di:e!==Di&&(e+=(c??"")+r[l+1]),this._$AH[l]=c}o&&!n&&this.j(e)}j(e){e===Di?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}},tv=class extends Zl{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Di?void 0:e}},iv=class extends Zl{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==Di)}},nv=class extends Zl{constructor(e,t,i,n,r){super(e,t,i,n,r),this.type=5}_$AI(e,t=this){if((e=$l(this,e,t,0)??Di)===Pa)return;let i=this._$AH,n=e===Di&&i!==Di||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,r=e!==Di&&(i===Di||n);n&&this.element.removeEventListener(this.name,this,i),r&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t;typeof this._$AH=="function"?this._$AH.call(((t=this.options)==null?void 0:t.host)??this.element,e):this._$AH.handleEvent(e)}},sv=class{constructor(e,t,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){$l(this,e)}},Sx=rf.litHtmlPolyfillSupport;Sx?.(ed,td),(rf.litHtmlVersions??(rf.litHtmlVersions=[])).push("3.2.0");var Ql=(s,e,t)=>{let i=t?.renderBefore??e,n=i._$litPart$;if(n===void 0){let r=t?.renderBefore??null;i._$litPart$=n=new td(e.insertBefore(Qh(),r),r,void 0,t??{})}return n._$AI(s),n};var Xt=class extends _o{constructor(){super(...arguments),this.renderOptions={host:this},this.o=void 0}createRenderRoot(){var e;let t=super.createRenderRoot();return(e=this.renderOptions).renderBefore??(e.renderBefore=t.firstChild),t}update(e){let t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this.o=Ql(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this.o)==null||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this.o)==null||e.setConnected(!1)}render(){return Pa}},Ax;Xt._$litElement$=!0,Xt.finalized=!0,(Ax=globalThis.litElementHydrateSupport)==null||Ax.call(globalThis,{LitElement:Xt});var Ix=globalThis.litElementPolyfillSupport;Ix?.({LitElement:Xt});(globalThis.litElementVersions??(globalThis.litElementVersions=[])).push("4.1.0");var VF={attribute:!0,type:String,converter:sf,reflect:!1,hasChanged:Cv},jF=(s=VF,e,t)=>{let{kind:i,metadata:n}=t,r=globalThis.litPropertyMetadata.get(n);if(r===void 0&&globalThis.litPropertyMetadata.set(n,r=new Map),r.set(t.name,s),i==="accessor"){let{name:o}=t;return{set(a){let l=e.get.call(this);e.set.call(this,a),this.requestUpdate(o,l,s)},init(a){return a!==void 0&&this.P(o,void 0,s),a}}}if(i==="setter"){let{name:o}=t;return function(a){let l=this[o];e.call(this,a),this.requestUpdate(o,l,s)}}throw Error("Unsupported decorator location: "+i)};function Be(s){return(e,t)=>typeof t=="object"?jF(s,e,t):((i,n,r)=>{let o=n.hasOwnProperty(r);return n.constructor.createProperty(r,o?yt(Se({},i),{wrapped:!0}):i),o?Object.getOwnPropertyDescriptor(n,r):void 0})(s,e,t)}function ic(s){return Be(yt(Se({},s),{state:!0,attribute:!1}))}var HF=s=>s.strings===void 0;var _S={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},wS=s=>(...e)=>({_$litDirective$:s,values:e}),af=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,i){this.t=e,this._$AM=t,this.i=i}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}};var Xh=(s,e)=>{var t;let i=s._$AN;if(i===void 0)return!1;for(let n of i)(t=n._$AO)==null||t.call(n,e,!1),Xh(n,e);return!0},lf=s=>{let e,t;do{if((e=s._$AM)===void 0)break;t=e._$AN,t.delete(s),s=e}while(t?.size===0)},ES=s=>{for(let e;e=s._$AM;s=e){let t=e._$AN;if(t===void 0)e._$AN=t=new Set;else if(t.has(s))break;t.add(s),YF(e)}};function GF(s){this._$AN!==void 0?(lf(this),this._$AM=s,ES(this)):this._$AM=s}function WF(s,e=!1,t=0){let i=this._$AH,n=this._$AN;if(n!==void 0&&n.size!==0)if(e)if(Array.isArray(i))for(let r=t;r<i.length;r++)Xh(i[r],!1),lf(i[r]);else i!=null&&(Xh(i,!1),lf(i));else Xh(this,s)}var YF=s=>{s.type==_S.CHILD&&(s._$AP??(s._$AP=WF),s._$AQ??(s._$AQ=GF))},rv=class extends af{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,t,i){super._$AT(e,t,i),ES(this),this.isConnected=e._$AU}_$AO(e,t=!0){var i,n;e!==this.isConnected&&(this.isConnected=e,e?(i=this.reconnected)==null||i.call(this):(n=this.disconnected)==null||n.call(this)),t&&(Xh(this,e),lf(this))}setValue(e){if(HF(this.t))this.t._$AI(e,this);else{let t=[...this.t._$AH];t[this.i]=e,this.t._$AI(t,this,0)}}disconnected(){}reconnected(){}};var Jl=()=>new ov,ov=class{},qb=new WeakMap,ec=wS(class extends rv{render(s){return Di}update(s,[e]){var t;let i=e!==this.Y;return i&&this.Y!==void 0&&this.rt(void 0),(i||this.lt!==this.ct)&&(this.Y=e,this.ht=(t=s.options)==null?void 0:t.host,this.rt(this.ct=s.element)),Di}rt(s){if(this.isConnected||(s=void 0),typeof this.Y=="function"){let e=this.ht??globalThis,t=qb.get(e);t===void 0&&(t=new WeakMap,qb.set(e,t)),t.get(this.Y)!==void 0&&this.Y.call(this.ht,void 0),t.set(this.Y,s),s!==void 0&&this.Y.call(this.ht,s)}else this.Y.value=s}get lt(){var s,e;return typeof this.Y=="function"?(s=qb.get(this.ht??globalThis))==null?void 0:s.get(this.Y):(e=this.Y)==null?void 0:e.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});var CS=Object.freeze({left:0,top:0,width:16,height:16}),cf=Object.freeze({rotate:0,vFlip:!1,hFlip:!1}),ad=Object.freeze(Se(Se({},CS),cf)),av=Object.freeze(yt(Se({},ad),{body:"",hidden:!1})),qF=Object.freeze({width:null,height:null}),xS=Object.freeze(Se(Se({},qF),cf));function XF(s,e=0){let t=s.replace(/^-?[0-9.]*/,"");function i(n){for(;n<0;)n+=4;return n%4}if(t===""){let n=parseInt(s);return isNaN(n)?0:i(n)}else if(t!==s){let n=0;switch(t){case"%":n=25;break;case"deg":n=90}if(n){let r=parseFloat(s.slice(0,s.length-t.length));return isNaN(r)?0:(r=r/n,r%1===0?i(r):0)}}return e}var KF=/[\s,]+/;function $F(s,e){e.split(KF).forEach(t=>{switch(t.trim()){case"horizontal":s.hFlip=!0;break;case"vertical":s.vFlip=!0;break}})}var SS=yt(Se({},xS),{preserveAspectRatio:""});function Tx(s){let e=Se({},SS),t=(i,n)=>s.getAttribute(i)||n;return e.width=t("width",null),e.height=t("height",null),e.rotate=XF(t("rotate","")),$F(e,t("flip","")),e.preserveAspectRatio=t("preserveAspectRatio",t("preserveaspectratio","")),e}function ZF(s,e){for(let t in SS)if(s[t]!==e[t])return!0;return!1}var Kh=/^[a-z0-9]+(-[a-z0-9]+)*$/,ld=(s,e,t,i="")=>{let n=s.split(":");if(s.slice(0,1)==="@"){if(n.length<2||n.length>3)return null;i=n.shift().slice(1)}if(n.length>3||!n.length)return null;if(n.length>1){let a=n.pop(),l=n.pop(),c={provider:n.length>0?n[0]:i,prefix:l,name:a};return e&&!ef(c)?null:c}let r=n[0],o=r.split("-");if(o.length>1){let a={provider:i,prefix:o.shift(),name:o.join("-")};return e&&!ef(a)?null:a}if(t&&i===""){let a={provider:i,prefix:"",name:r};return e&&!ef(a,t)?null:a}return null},ef=(s,e)=>s?!!((s.provider===""||s.provider.match(Kh))&&(e&&s.prefix===""||s.prefix.match(Kh))&&s.name.match(Kh)):!1;function QF(s,e){let t={};!s.hFlip!=!e.hFlip&&(t.hFlip=!0),!s.vFlip!=!e.vFlip&&(t.vFlip=!0);let i=((s.rotate||0)+(e.rotate||0))%4;return i&&(t.rotate=i),t}function Px(s,e){let t=QF(s,e);for(let i in av)i in cf?i in s&&!(i in t)&&(t[i]=cf[i]):i in e?t[i]=e[i]:i in s&&(t[i]=s[i]);return t}function JF(s,e){let t=s.icons,i=s.aliases||Object.create(null),n=Object.create(null);function r(o){if(t[o])return n[o]=[];if(!(o in n)){n[o]=null;let a=i[o]&&i[o].parent,l=a&&r(a);l&&(n[o]=[a].concat(l))}return n[o]}return Object.keys(t).concat(Object.keys(i)).forEach(r),n}function ek(s,e,t){let i=s.icons,n=s.aliases||Object.create(null),r={};function o(a){r=Px(i[a]||n[a],r)}return o(e),t.forEach(o),Px(s,r)}function AS(s,e){let t=[];if(typeof s!="object"||typeof s.icons!="object")return t;s.not_found instanceof Array&&s.not_found.forEach(n=>{e(n,null),t.push(n)});let i=JF(s);for(let n in i){let r=i[n];r&&(e(n,ek(s,n,r)),t.push(n))}return t}var tk=Se({provider:"",aliases:{},not_found:{}},CS);function Xb(s,e){for(let t in e)if(t in s&&typeof s[t]!=typeof e[t])return!1;return!0}function IS(s){if(typeof s!="object"||s===null)return null;let e=s;if(typeof e.prefix!="string"||!s.icons||typeof s.icons!="object"||!Xb(s,tk))return null;let t=e.icons;for(let n in t){let r=t[n];if(!n.match(Kh)||typeof r.body!="string"||!Xb(r,av))return null}let i=e.aliases||Object.create(null);for(let n in i){let r=i[n],o=r.parent;if(!n.match(Kh)||typeof o!="string"||!t[o]&&!i[o]||!Xb(r,av))return null}return e}var hf=Object.create(null);function ik(s,e){return{provider:s,prefix:e,icons:Object.create(null),missing:new Set}}function xo(s,e){let t=hf[s]||(hf[s]=Object.create(null));return t[e]||(t[e]=ik(s,e))}function Sv(s,e){return IS(e)?AS(e,(t,i)=>{i?s.icons[t]=i:s.missing.add(t)}):[]}function nk(s,e,t){try{if(typeof t.body=="string")return s.icons[e]=Se({},t),!0}catch{}return!1}function sk(s,e){let t=[];return(typeof s=="string"?[s]:Object.keys(hf)).forEach(i=>{(typeof i=="string"&&typeof e=="string"?[e]:Object.keys(hf[i]||{})).forEach(n=>{let r=xo(i,n);t=t.concat(Object.keys(r.icons).map(o=>(i!==""?"@"+i+":":"")+n+":"+o))})}),t}var id=!1;function TS(s){return typeof s=="boolean"&&(id=s),id}function nd(s){let e=typeof s=="string"?ld(s,!0,id):s;if(e){let t=xo(e.provider,e.prefix),i=e.name;return t.icons[i]||(t.missing.has(i)?null:void 0)}}function PS(s,e){let t=ld(s,!0,id);if(!t)return!1;let i=xo(t.provider,t.prefix);return nk(i,t.name,e)}function Ox(s,e){if(typeof s!="object")return!1;if(typeof e!="string"&&(e=s.provider||""),id&&!e&&!s.prefix){let n=!1;return IS(s)&&(s.prefix="",AS(s,(r,o)=>{o&&PS(r,o)&&(n=!0)})),n}let t=s.prefix;if(!ef({provider:e,prefix:t,name:"a"}))return!1;let i=xo(e,t);return!!Sv(i,s)}function Mx(s){return!!nd(s)}function rk(s){let e=nd(s);return e?Se(Se({},ad),e):null}function ok(s){let e={loaded:[],missing:[],pending:[]},t=Object.create(null);s.sort((n,r)=>n.provider!==r.provider?n.provider.localeCompare(r.provider):n.prefix!==r.prefix?n.prefix.localeCompare(r.prefix):n.name.localeCompare(r.name));let i={provider:"",prefix:"",name:""};return s.forEach(n=>{if(i.name===n.name&&i.prefix===n.prefix&&i.provider===n.provider)return;i=n;let r=n.provider,o=n.prefix,a=n.name,l=t[r]||(t[r]=Object.create(null)),c=l[o]||(l[o]=xo(r,o)),d;a in c.icons?d=e.loaded:o===""||c.missing.has(a)?d=e.missing:d=e.pending;let h={provider:r,prefix:o,name:a};d.push(h)}),e}function OS(s,e){s.forEach(t=>{let i=t.loaderCallbacks;i&&(t.loaderCallbacks=i.filter(n=>n.id!==e))})}function ak(s){s.pendingCallbacksFlag||(s.pendingCallbacksFlag=!0,setTimeout(()=>{s.pendingCallbacksFlag=!1;let e=s.loaderCallbacks?s.loaderCallbacks.slice(0):[];if(!e.length)return;let t=!1,i=s.provider,n=s.prefix;e.forEach(r=>{let o=r.icons,a=o.pending.length;o.pending=o.pending.filter(l=>{if(l.prefix!==n)return!0;let c=l.name;if(s.icons[c])o.loaded.push({provider:i,prefix:n,name:c});else if(s.missing.has(c))o.missing.push({provider:i,prefix:n,name:c});else return t=!0,!0;return!1}),o.pending.length!==a&&(t||OS([s],r.id),r.callback(o.loaded.slice(0),o.missing.slice(0),o.pending.slice(0),r.abort))})}))}var lk=0;function ck(s,e,t){let i=lk++,n=OS.bind(null,t,i);if(!e.pending.length)return n;let r={id:i,icons:e,callback:s,abort:n};return t.forEach(o=>{(o.loaderCallbacks||(o.loaderCallbacks=[])).push(r)}),n}var lv=Object.create(null);function Rx(s,e){lv[s]=e}function cv(s){return lv[s]||lv[""]}function hk(s,e=!0,t=!1){let i=[];return s.forEach(n=>{let r=typeof n=="string"?ld(n,e,t):n;r&&i.push(r)}),i}var dk={resources:[],index:0,timeout:2e3,rotate:750,random:!1,dataAfterTimeout:!1};function uk(s,e,t,i){let n=s.resources.length,r=s.random?Math.floor(Math.random()*n):s.index,o;if(s.random){let C=s.resources.slice(0);for(o=[];C.length>1;){let A=Math.floor(Math.random()*C.length);o.push(C[A]),C=C.slice(0,A).concat(C.slice(A+1))}o=o.concat(C)}else o=s.resources.slice(r).concat(s.resources.slice(0,r));let a=Date.now(),l="pending",c=0,d,h=null,u=[],p=[];typeof i=="function"&&p.push(i);function f(){h&&(clearTimeout(h),h=null)}function m(){l==="pending"&&(l="aborted"),f(),u.forEach(C=>{C.status==="pending"&&(C.status="aborted")}),u=[]}function g(C,A){A&&(p=[]),typeof C=="function"&&p.push(C)}function b(){return{startTime:a,payload:e,status:l,queriesSent:c,queriesPending:u.length,subscribe:g,abort:m}}function v(){l="failed",p.forEach(C=>{C(void 0,d)})}function E(){u.forEach(C=>{C.status==="pending"&&(C.status="aborted")}),u=[]}function y(C,A,D){let M=A!=="success";switch(u=u.filter(I=>I!==C),l){case"pending":break;case"failed":if(M||!s.dataAfterTimeout)return;break;default:return}if(A==="abort"){d=D,v();return}if(M){d=D,u.length||(o.length?w():v());return}if(f(),E(),!s.random){let I=s.resources.indexOf(C.resource);I!==-1&&I!==s.index&&(s.index=I)}l="completed",p.forEach(I=>{I(D)})}function w(){if(l!=="pending")return;f();let C=o.shift();if(C===void 0){if(u.length){h=setTimeout(()=>{f(),l==="pending"&&(E(),v())},s.timeout);return}v();return}let A={status:"pending",resource:C,callback:(D,M)=>{y(A,D,M)}};u.push(A),c++,h=setTimeout(w,s.rotate),t(C,e,A.callback)}return setTimeout(w),b}function MS(s){let e=Se(Se({},dk),s),t=[];function i(){t=t.filter(o=>o().status==="pending")}function n(o,a,l){let c=uk(e,o,a,(d,h)=>{i(),l&&l(d,h)});return t.push(c),c}function r(o){return t.find(a=>o(a))||null}return{query:n,find:r,setIndex:o=>{e.index=o},getIndex:()=>e.index,cleanup:i}}function Av(s){let e;if(typeof s.resources=="string")e=[s.resources];else if(e=s.resources,!(e instanceof Array)||!e.length)return null;return{resources:e,path:s.path||"/",maxURL:s.maxURL||500,rotate:s.rotate||750,timeout:s.timeout||5e3,random:s.random===!0,index:s.index||0,dataAfterTimeout:s.dataAfterTimeout!==!1}}var gf=Object.create(null),Zp=["https://api.simplesvg.com","https://api.unisvg.com"],hv=[];for(;Zp.length>0;)Zp.length===1||Math.random()>.5?hv.push(Zp.shift()):hv.push(Zp.pop());gf[""]=Av({resources:["https://api.iconify.design"].concat(hv)});function Dx(s,e){let t=Av(e);return t===null?!1:(gf[s]=t,!0)}function bf(s){return gf[s]}function pk(){return Object.keys(gf)}function Lx(){}var Kb=Object.create(null);function fk(s){if(!Kb[s]){let e=bf(s);if(!e)return;let t=MS(e),i={config:e,redundancy:t};Kb[s]=i}return Kb[s]}function RS(s,e,t){let i,n;if(typeof s=="string"){let r=cv(s);if(!r)return t(void 0,424),Lx;n=r.send;let o=fk(s);o&&(i=o.redundancy)}else{let r=Av(s);if(r){i=MS(r);let o=s.resources?s.resources[0]:"",a=cv(o);a&&(n=a.send)}}return!i||!n?(t(void 0,424),Lx):i.query(e,n,t)().abort}var Fx="iconify2",sd="iconify",DS=sd+"-count",kx=sd+"-version",LS=36e5,mk=168,gk=50;function dv(s,e){try{return s.getItem(e)}catch{}}function Iv(s,e,t){try{return s.setItem(e,t),!0}catch{}}function Nx(s,e){try{s.removeItem(e)}catch{}}function uv(s,e){return Iv(s,DS,e.toString())}function pv(s){return parseInt(dv(s,DS))||0}var Aa={local:!0,session:!0},FS={local:new Set,session:new Set},Tv=!1;function bk(s){Tv=s}var Qp=typeof window>"u"?{}:window;function kS(s){let e=s+"Storage";try{if(Qp&&Qp[e]&&typeof Qp[e].length=="number")return Qp[e]}catch{}Aa[s]=!1}function NS(s,e){let t=kS(s);if(!t)return;let i=dv(t,kx);if(i!==Fx){if(i){let a=pv(t);for(let l=0;l<a;l++)Nx(t,sd+l.toString())}Iv(t,kx,Fx),uv(t,0);return}let n=Math.floor(Date.now()/LS)-mk,r=a=>{let l=sd+a.toString(),c=dv(t,l);if(typeof c=="string"){try{let d=JSON.parse(c);if(typeof d=="object"&&typeof d.cached=="number"&&d.cached>n&&typeof d.provider=="string"&&typeof d.data=="object"&&typeof d.data.prefix=="string"&&e(d,a))return!0}catch{}Nx(t,l)}},o=pv(t);for(let a=o-1;a>=0;a--)r(a)||(a===o-1?(o--,uv(t,o)):FS[s].add(a))}function US(){if(!Tv){bk(!0);for(let s in Aa)NS(s,e=>{let t=e.data,i=e.provider,n=t.prefix,r=xo(i,n);if(!Sv(r,t).length)return!1;let o=t.lastModified||-1;return r.lastModifiedCached=r.lastModifiedCached?Math.min(r.lastModifiedCached,o):o,!0})}}function vk(s,e){let t=s.lastModifiedCached;if(t&&t>=e)return t===e;if(s.lastModifiedCached=e,t)for(let i in Aa)NS(i,n=>{let r=n.data;return n.provider!==s.provider||r.prefix!==s.prefix||r.lastModified===e});return!0}function yk(s,e){Tv||US();function t(i){let n;if(!Aa[i]||!(n=kS(i)))return;let r=FS[i],o;if(r.size)r.delete(o=Array.from(r).shift());else if(o=pv(n),o>=gk||!uv(n,o+1))return;let a={cached:Math.floor(Date.now()/LS),provider:s.provider,data:e};return Iv(n,sd+o.toString(),JSON.stringify(a))}e.lastModified&&!vk(s,e.lastModified)||Object.keys(e.icons).length&&(e.not_found&&(e=Object.assign({},e),delete e.not_found),t("local")||t("session"))}function Ux(){}function _k(s){s.iconsLoaderFlag||(s.iconsLoaderFlag=!0,setTimeout(()=>{s.iconsLoaderFlag=!1,ak(s)}))}function wk(s,e){s.iconsToLoad?s.iconsToLoad=s.iconsToLoad.concat(e).sort():s.iconsToLoad=e,s.iconsQueueFlag||(s.iconsQueueFlag=!0,setTimeout(()=>{s.iconsQueueFlag=!1;let{provider:t,prefix:i}=s,n=s.iconsToLoad;delete s.iconsToLoad;let r;!n||!(r=cv(t))||r.prepare(t,i,n).forEach(o=>{RS(t,o,a=>{if(typeof a!="object")o.icons.forEach(l=>{s.missing.add(l)});else try{let l=Sv(s,a);if(!l.length)return;let c=s.pendingIcons;c&&l.forEach(d=>{c.delete(d)}),yk(s,a)}catch(l){console.error(l)}_k(s)})})}))}var Pv=(s,e)=>{let t=hk(s,!0,TS()),i=ok(t);if(!i.pending.length){let l=!0;return e&&setTimeout(()=>{l&&e(i.loaded,i.missing,i.pending,Ux)}),()=>{l=!1}}let n=Object.create(null),r=[],o,a;return i.pending.forEach(l=>{let{provider:c,prefix:d}=l;if(d===a&&c===o)return;o=c,a=d,r.push(xo(c,d));let h=n[c]||(n[c]=Object.create(null));h[d]||(h[d]=[])}),i.pending.forEach(l=>{let{provider:c,prefix:d,name:h}=l,u=xo(c,d),p=u.pendingIcons||(u.pendingIcons=new Set);p.has(h)||(p.add(h),n[c][d].push(h))}),r.forEach(l=>{let{provider:c,prefix:d}=l;n[c][d].length&&wk(l,n[c][d])}),e?ck(e,i,r):Ux},Ek=s=>new Promise((e,t)=>{let i=typeof s=="string"?ld(s,!0):s;if(!i){t(s);return}Pv([i||s],n=>{if(n.length&&i){let r=nd(i);if(r){e(Se(Se({},ad),r));return}}t(s)})});function Ck(s){try{let e=typeof s=="string"?JSON.parse(s):s;if(typeof e.body=="string")return Se({},e)}catch{}}function xk(s,e){let t=typeof s=="string"?ld(s,!0,!0):null;if(!t){let r=Ck(s);return{value:s,data:r}}let i=nd(t);if(i!==void 0||!t.prefix)return{value:s,name:t,data:i};let n=Pv([t],()=>e(s,t,nd(t)));return{value:s,name:t,loading:n}}function $b(s){return s.hasAttribute("inline")}var BS=!1;try{BS=navigator.vendor.indexOf("Apple")===0}catch{}function Sk(s,e){switch(e){case"svg":case"bg":case"mask":return e}return e!=="style"&&(BS||s.indexOf("<a")===-1)?"svg":s.indexOf("currentColor")===-1?"bg":"mask"}var Ak=/(-?[0-9.]*[0-9]+[0-9.]*)/g,Ik=/^-?[0-9.]*[0-9]+[0-9.]*$/g;function fv(s,e,t){if(e===1)return s;if(t=t||100,typeof s=="number")return Math.ceil(s*e*t)/t;if(typeof s!="string")return s;let i=s.split(Ak);if(i===null||!i.length)return s;let n=[],r=i.shift(),o=Ik.test(r);for(;;){if(o){let a=parseFloat(r);isNaN(a)?n.push(r):n.push(Math.ceil(a*e*t)/t)}else n.push(r);if(r=i.shift(),r===void 0)return n.join("");o=!o}}function Tk(s,e="defs"){let t="",i=s.indexOf("<"+e);for(;i>=0;){let n=s.indexOf(">",i),r=s.indexOf("</"+e);if(n===-1||r===-1)break;let o=s.indexOf(">",r);if(o===-1)break;t+=s.slice(n+1,r).trim(),s=s.slice(0,i).trim()+s.slice(o+1)}return{defs:t,content:s}}function Pk(s,e){return s?"<defs>"+s+"</defs>"+e:e}function Ok(s,e,t){let i=Tk(s);return Pk(i.defs,e+i.content+t)}var Mk=s=>s==="unset"||s==="undefined"||s==="none";function zS(s,e){let t=Se(Se({},ad),s),i=Se(Se({},xS),e),n={left:t.left,top:t.top,width:t.width,height:t.height},r=t.body;[t,i].forEach(m=>{let g=[],b=m.hFlip,v=m.vFlip,E=m.rotate;b?v?E+=2:(g.push("translate("+(n.width+n.left).toString()+" "+(0-n.top).toString()+")"),g.push("scale(-1 1)"),n.top=n.left=0):v&&(g.push("translate("+(0-n.left).toString()+" "+(n.height+n.top).toString()+")"),g.push("scale(1 -1)"),n.top=n.left=0);let y;switch(E<0&&(E-=Math.floor(E/4)*4),E=E%4,E){case 1:y=n.height/2+n.top,g.unshift("rotate(90 "+y.toString()+" "+y.toString()+")");break;case 2:g.unshift("rotate(180 "+(n.width/2+n.left).toString()+" "+(n.height/2+n.top).toString()+")");break;case 3:y=n.width/2+n.left,g.unshift("rotate(-90 "+y.toString()+" "+y.toString()+")");break}E%2===1&&(n.left!==n.top&&(y=n.left,n.left=n.top,n.top=y),n.width!==n.height&&(y=n.width,n.width=n.height,n.height=y)),g.length&&(r=Ok(r,'<g transform="'+g.join(" ")+'">',"</g>"))});let o=i.width,a=i.height,l=n.width,c=n.height,d,h;o===null?(h=a===null?"1em":a==="auto"?c:a,d=fv(h,l/c)):(d=o==="auto"?l:o,h=a===null?fv(d,c/l):a==="auto"?c:a);let u={},p=(m,g)=>{Mk(g)||(u[m]=g.toString())};p("width",d),p("height",h);let f=[n.left,n.top,l,c];return u.viewBox=f.join(" "),{attributes:u,viewBox:f,body:r}}function Ov(s,e){let t=s.indexOf("xlink:")===-1?"":' xmlns:xlink="http://www.w3.org/1999/xlink"';for(let i in e)t+=" "+i+'="'+e[i]+'"';return'<svg xmlns="http://www.w3.org/2000/svg"'+t+">"+s+"</svg>"}function Rk(s){return s.replace(/"/g,"'").replace(/%/g,"%25").replace(/#/g,"%23").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/\s+/g," ")}function Dk(s){return"data:image/svg+xml,"+Rk(s)}function VS(s){return'url("'+Dk(s)+'")'}var Lk=()=>{let s;try{if(s=fetch,typeof s=="function")return s}catch{}},df=Lk();function Fk(s){df=s}function kk(){return df}function Nk(s,e){let t=bf(s);if(!t)return 0;let i;if(!t.maxURL)i=0;else{let n=0;t.resources.forEach(o=>{n=Math.max(n,o.length)});let r=e+".json?icons=";i=t.maxURL-n-t.path.length-r.length}return i}function Uk(s){return s===404}var Bk=(s,e,t)=>{let i=[],n=Nk(s,e),r="icons",o={type:r,provider:s,prefix:e,icons:[]},a=0;return t.forEach((l,c)=>{a+=l.length+1,a>=n&&c>0&&(i.push(o),o={type:r,provider:s,prefix:e,icons:[]},a=l.length),o.icons.push(l)}),i.push(o),i};function zk(s){if(typeof s=="string"){let e=bf(s);if(e)return e.path}return"/"}var Vk=(s,e,t)=>{if(!df){t("abort",424);return}let i=zk(e.provider);switch(e.type){case"icons":{let r=e.prefix,o=e.icons.join(","),a=new URLSearchParams({icons:o});i+=r+".json?"+a.toString();break}case"custom":{let r=e.uri;i+=r.slice(0,1)==="/"?r.slice(1):r;break}default:t("abort",400);return}let n=503;df(s+i).then(r=>{let o=r.status;if(o!==200){setTimeout(()=>{t(Uk(o)?"abort":"next",o)});return}return n=501,r.json()}).then(r=>{if(typeof r!="object"||r===null){setTimeout(()=>{r===404?t("abort",r):t("next",n)});return}setTimeout(()=>{t("success",r)})}).catch(()=>{t("next",n)})},jk={prepare:Bk,send:Vk};function Bx(s,e){switch(s){case"local":case"session":Aa[s]=e;break;case"all":for(let t in Aa)Aa[t]=e;break}}var Zb="data-style",jS="";function Hk(s){jS=s}function zx(s,e){let t=Array.from(s.childNodes).find(i=>i.hasAttribute&&i.hasAttribute(Zb));t||(t=document.createElement("style"),t.setAttribute(Zb,Zb),s.appendChild(t)),t.textContent=":host{display:inline-block;vertical-align:"+(e?"-0.125em":"0")+"}span,svg{display:block}"+jS}function HS(){Rx("",jk),TS(!0);let s;try{s=window}catch{}if(s){if(US(),s.IconifyPreload!==void 0){let e=s.IconifyPreload,t="Invalid IconifyPreload syntax.";typeof e=="object"&&e!==null&&(e instanceof Array?e:[e]).forEach(i=>{try{(typeof i!="object"||i===null||i instanceof Array||typeof i.icons!="object"||typeof i.prefix!="string"||!Ox(i))&&console.error(t)}catch{console.error(t)}})}if(s.IconifyProviders!==void 0){let e=s.IconifyProviders;if(typeof e=="object"&&e!==null)for(let t in e){let i="IconifyProviders["+t+"] is invalid.";try{let n=e[t];if(typeof n!="object"||!n||n.resources===void 0)continue;Dx(t,n)||console.error(i)}catch{console.error(i)}}}}return{enableCache:e=>Bx(e,!0),disableCache:e=>Bx(e,!1),iconLoaded:Mx,iconExists:Mx,getIcon:rk,listIcons:sk,addIcon:PS,addCollection:Ox,calculateSize:fv,buildIcon:zS,iconToHTML:Ov,svgToURL:VS,loadIcons:Pv,loadIcon:Ek,addAPIProvider:Dx,appendCustomStyle:Hk,_api:{getAPIConfig:bf,setAPIModule:Rx,sendAPIQuery:RS,setFetch:Fk,getFetch:kk,listAPIProviders:pk}}}var mv={"background-color":"currentColor"},GS={"background-color":"transparent"},Vx={image:"var(--svg)",repeat:"no-repeat",size:"100% 100%"},jx={"-webkit-mask":mv,mask:mv,background:GS};for(let s in jx){let e=jx[s];for(let t in Vx)e[s+"-"+t]=Vx[t]}function Hx(s){return s?s+(s.match(/^[-0-9.]+$/)?"px":""):"inherit"}function Gk(s,e,t){let i=document.createElement("span"),n=s.body;n.indexOf("<a")!==-1&&(n+="<!-- "+Date.now()+" -->");let r=s.attributes,o=Ov(n,yt(Se({},r),{width:e.width+"",height:e.height+""})),a=VS(o),l=i.style,c=Se({"--svg":a,width:Hx(r.width),height:Hx(r.height)},t?mv:GS);for(let d in c)l.setProperty(d,c[d]);return i}var $h;function Wk(){try{$h=window.trustedTypes.createPolicy("iconify",{createHTML:s=>s})}catch{$h=null}}function Yk(s){return $h===void 0&&Wk(),$h?$h.createHTML(s):s}function qk(s){let e=document.createElement("span"),t=s.attributes,i="";t.width||(i="width: inherit;"),t.height||(i+="height: inherit;"),i&&(t.style=i);let n=Ov(s.body,t);return e.innerHTML=Yk(n),e.firstChild}function gv(s){return Array.from(s.childNodes).find(e=>{let t=e.tagName&&e.tagName.toUpperCase();return t==="SPAN"||t==="SVG"})}function Gx(s,e){let t=e.icon.data,i=e.customisations,n=zS(t,i);i.preserveAspectRatio&&(n.attributes.preserveAspectRatio=i.preserveAspectRatio);let r=e.renderedMode,o;switch(r){case"svg":o=qk(n);break;default:o=Gk(n,Se(Se({},ad),t),r==="mask")}let a=gv(s);a?o.tagName==="SPAN"&&a.tagName===o.tagName?a.setAttribute("style",o.getAttribute("style")):s.replaceChild(o,a):s.appendChild(o)}function Wx(s,e,t){let i=t&&(t.rendered?t:t.lastRender);return{rendered:!1,inline:e,icon:s,lastRender:i}}function Xk(s="iconify-icon"){let e,t;try{e=window.customElements,t=window.HTMLElement}catch{return}if(!e||!t)return;let i=e.get(s);if(i)return i;let n=["icon","mode","inline","observe","width","height","rotate","flip"],r=class extends t{constructor(){super(),Ca(this,"_shadowRoot"),Ca(this,"_initialised",!1),Ca(this,"_state"),Ca(this,"_checkQueued",!1),Ca(this,"_connected",!1),Ca(this,"_observer",null),Ca(this,"_visible",!0);let a=this._shadowRoot=this.attachShadow({mode:"open"}),l=$b(this);zx(a,l),this._state=Wx({value:""},l),this._queueCheck()}connectedCallback(){this._connected=!0,this.startObserver()}disconnectedCallback(){this._connected=!1,this.stopObserver()}static get observedAttributes(){return n.slice(0)}attributeChangedCallback(a){switch(a){case"inline":{let l=$b(this),c=this._state;l!==c.inline&&(c.inline=l,zx(this._shadowRoot,l));break}case"observer":{this.observer?this.startObserver():this.stopObserver();break}default:this._queueCheck()}}get icon(){let a=this.getAttribute("icon");if(a&&a.slice(0,1)==="{")try{return JSON.parse(a)}catch{}return a}set icon(a){typeof a=="object"&&(a=JSON.stringify(a)),this.setAttribute("icon",a)}get inline(){return $b(this)}set inline(a){a?this.setAttribute("inline","true"):this.removeAttribute("inline")}get observer(){return this.hasAttribute("observer")}set observer(a){a?this.setAttribute("observer","true"):this.removeAttribute("observer")}restartAnimation(){let a=this._state;if(a.rendered){let l=this._shadowRoot;if(a.renderedMode==="svg")try{l.lastChild.setCurrentTime(0);return}catch{}Gx(l,a)}}get status(){let a=this._state;return a.rendered?"rendered":a.icon.data===null?"failed":"loading"}_queueCheck(){this._checkQueued||(this._checkQueued=!0,setTimeout(()=>{this._check()}))}_check(){if(!this._checkQueued)return;this._checkQueued=!1;let a=this._state,l=this.getAttribute("icon");if(l!==a.icon.value){this._iconChanged(l);return}if(!a.rendered||!this._visible)return;let c=this.getAttribute("mode"),d=Tx(this);(a.attrMode!==c||ZF(a.customisations,d)||!gv(this._shadowRoot))&&this._renderIcon(a.icon,d,c)}_iconChanged(a){let l=xk(a,(c,d,h)=>{let u=this._state;if(u.rendered||this.getAttribute("icon")!==c)return;let p={value:c,name:d,data:h};p.data?this._gotIconData(p):u.icon=p});l.data?this._gotIconData(l):this._state=Wx(l,this._state.inline,this._state)}_forceRender(){if(!this._visible){let a=gv(this._shadowRoot);a&&this._shadowRoot.removeChild(a);return}this._queueCheck()}_gotIconData(a){this._checkQueued=!1,this._renderIcon(a,Tx(this),this.getAttribute("mode"))}_renderIcon(a,l,c){let d=Sk(a.data.body,c),h=this._state.inline;Gx(this._shadowRoot,this._state={rendered:!0,icon:a,inline:h,customisations:l,attrMode:c,renderedMode:d})}startObserver(){if(!this._observer)try{this._observer=new IntersectionObserver(a=>{let l=a.some(c=>c.isIntersecting);l!==this._visible&&(this._visible=l,this._forceRender())}),this._observer.observe(this)}catch{if(this._observer){try{this._observer.disconnect()}catch{}this._observer=null}}}stopObserver(){this._observer&&(this._observer.disconnect(),this._observer=null,this._visible=!0,this._connected&&this._forceRender())}};n.forEach(a=>{a in r.prototype||Object.defineProperty(r.prototype,a,{get:function(){return this.getAttribute(a)},set:function(l){l!==null?this.setAttribute(a,l):this.removeAttribute(a)}})});let o=HS();for(let a in o)r[a]=r.prototype[a]=o[a];return e.define(s,r),r}Xk()||HS();var Kk=Object.defineProperty,$k=Object.getOwnPropertyDescriptor,Ls=(s,e,t,i)=>{for(var n=i>1?void 0:i?$k(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Kk(e,t,n),n},WS=class extends Xt{constructor(){super(),this.labelHidden=!1,this.active=!1,this.disabled=!1,this.vertical=!1,this.tooltipVisible=!1,this._stateBeforeLoading={disabled:!1,icon:""},this._loading=!1,this._parent=Jl(),this._tooltip=Jl(),this._mouseLeave=!1,this.onClick=e=>{e.stopPropagation(),this.disabled||this.dispatchEvent(new Event("click"))},this.showContextMenu=()=>{let e=this._contextMenu;e&&(e.visible=!0)},this.mouseLeave=!0}set loading(e){if(this._loading=e,e)this._stateBeforeLoading={disabled:this.disabled,icon:this.icon},this.disabled=e,this.icon="eos-icons:loading";else{let{disabled:t,icon:i}=this._stateBeforeLoading;this.disabled=t,this.icon=i}}get loading(){return this._loading}set mouseLeave(e){this._mouseLeave=e,e&&(this.tooltipVisible=!1,clearTimeout(this.timeoutID))}get mouseLeave(){return this._mouseLeave}computeTooltipPosition(){let{value:e}=this._parent,{value:t}=this._tooltip;e&&t&&fS(e,t,{placement:"bottom",middleware:[tS(10),pS(),uS(),dS({padding:5})]}).then(i=>{let{x:n,y:r}=i;Object.assign(t.style,{left:`${n}px`,top:`${r}px`})})}onMouseEnter(){if(!(this.tooltipTitle||this.tooltipText))return;this.mouseLeave=!1;let e=this.tooltipTime??700;this.timeoutID=setTimeout(()=>{this.mouseLeave||(this.computeTooltipPosition(),this.tooltipVisible=!0)},e)}click(){this.disabled||super.click()}get _contextMenu(){return this.querySelector("bim-context-menu")}connectedCallback(){super.connectedCallback(),this.addEventListener("click",this.showContextMenu)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("click",this.showContextMenu)}render(){let e=ct`
      <div ${ec(this._tooltip)} class="tooltip">
        ${this.tooltipTitle?ct`<p style="text-wrap: nowrap;">
              <strong>${this.tooltipTitle}</strong>
            </p>`:null}
        ${this.tooltipText?ct`<p style="width: 9rem;">${this.tooltipText}</p>`:null}
      </div>
    `;return ct`
      <div ${ec(this._parent)} class="parent" @click=${this.onClick}>
        ${this.label||this.icon?ct`
              <div
                class="button"
                @mouseenter=${this.onMouseEnter}
                @mouseleave=${()=>this.mouseLeave=!0}
              >
                <bim-label
                  .icon=${this.icon}
                  .vertical=${this.vertical}
                  .labelHidden=${this.labelHidden}
                  >${this.label}</bim-label
                >
              </div>
            `:null}
        ${this.tooltipTitle||this.tooltipText?e:null}
      </div>
      <slot></slot>
    `}};WS.styles=ri`
    :host {
      --bim-label--c: var(--bim-ui_bg-contrast-100, white);
      display: block;
      flex: 1;
      pointer-events: none;
      background-color: var(--bim-button--bgc, var(--bim-ui_bg-contrast-20));
      border-radius: var(--bim-ui_size-4xs);
      transition: all 0.15s;
    }

    :host(:not([disabled]):hover) {
      cursor: pointer;
    }

    bim-label {
      pointer-events: none;
    }

    .parent {
      --bim-icon--c: var(--bim-label--c);
      position: relative;
      display: flex;
      height: 100%;
      user-select: none;
      row-gap: 0.125rem;
      min-height: var(--bim-ui_size-5xl);
      min-width: var(--bim-ui_size-5xl);
    }

    .button,
    .children {
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: auto;
    }

    .children {
      padding: 0 0.375rem;
      position: absolute;
      height: 100%;
      right: 0;
    }

    :host(:not([label-hidden])[icon][vertical]) .parent {
      min-height: 2.5rem;
    }

    .button {
      flex-grow: 1;
    }

    :host(:not([label-hidden])[label]) .button {
      justify-content: var(--bim-button--jc, center);
    }

    :host(:hover),
    :host([active]) {
      --bim-label--c: var(--bim-ui_main-contrast);
      background-color: var(--bim-ui_main-base);
    }

    :host(:not([label]):not([icon])) .children {
      flex: 1;
    }

    :host([vertical]) .parent {
      justify-content: center;
    }

    :host(:not([label-hidden])[label]) .button {
      padding: 0 0.5rem;
    }

    :host([disabled]) {
      --bim-label--c: var(--bim-ui_bg-contrast-80);
      background-color: gray;
    }

    ::slotted(bim-button) {
      --bim-icon--fz: var(--bim-ui_size-base);
      --bim-button--bdrs: var(--bim-ui_size-4xs);
      --bim-button--olw: 0;
      --bim-button--olc: transparent;
    }

    .tooltip {
      position: absolute;
      padding: 0.75rem;
      z-index: 99;
      display: flex;
      flex-flow: column;
      row-gap: 0.375rem;
      box-shadow: 0 0 10px 3px rgba(0 0 0 / 20%);
      outline: 1px solid var(--bim-ui_bg-contrast-40);
      font-size: var(--bim-ui_size-xs);
      border-radius: var(--bim-ui_size-4xs);
      background-color: var(--bim-ui_bg-contrast-20);
      color: var(--bim-ui_bg-contrast-100);
    }

    .tooltip p {
      margin: 0;
      padding: 0;
    }

    :host(:not([tooltip-visible])) .tooltip {
      display: none;
    }
  `;var ls=WS;Ls([Be({type:String,reflect:!0})],ls.prototype,"label",2);Ls([Be({type:Boolean,attribute:"label-hidden",reflect:!0})],ls.prototype,"labelHidden",2);Ls([Be({type:Boolean,reflect:!0})],ls.prototype,"active",2);Ls([Be({type:Boolean,reflect:!0,attribute:"disabled"})],ls.prototype,"disabled",2);Ls([Be({type:String,reflect:!0})],ls.prototype,"icon",2);Ls([Be({type:Boolean,reflect:!0})],ls.prototype,"vertical",2);Ls([Be({type:Number,attribute:"tooltip-time",reflect:!0})],ls.prototype,"tooltipTime",2);Ls([Be({type:Boolean,attribute:"tooltip-visible",reflect:!0})],ls.prototype,"tooltipVisible",2);Ls([Be({type:String,attribute:"tooltip-title",reflect:!0})],ls.prototype,"tooltipTitle",2);Ls([Be({type:String,attribute:"tooltip-text",reflect:!0})],ls.prototype,"tooltipText",2);Ls([Be({type:Boolean,reflect:!0})],ls.prototype,"loading",1);var Zk=Object.defineProperty,cd=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&Zk(e,t,n),n},YS=class extends Xt{constructor(){super(...arguments),this.checked=!1,this.inverted=!1,this.onValueChange=new Event("change")}get value(){return this.checked}onChange(e){e.stopPropagation(),this.checked=e.target.checked,this.dispatchEvent(this.onValueChange)}render(){return ct`
      <div class="parent">
        ${this.label?ct`<bim-label .icon="${this.icon}">${this.label}</bim-label> `:null}
        <input
          type="checkbox"
          aria-label=${this.label||this.name||"Checkbox Input"}
          @change="${this.onChange}"
          .checked="${this.checked}"
        />
      </div>
    `}};YS.styles=ri`
    :host {
      display: block;
    }

    .parent {
      display: flex;
      justify-content: space-between;
      height: 1.75rem;
      column-gap: 0.25rem;
      width: 100%;
      align-items: center;
      transition: all 0.15s;
    }

    :host([inverted]) .parent {
      flex-direction: row-reverse;
      justify-content: start;
    }

    input {
      height: 1rem;
      width: 1rem;
      cursor: pointer;
      border: none;
      outline: none;
      accent-color: var(--bim-checkbox--c, var(--bim-ui_main-base));
      transition: all 0.15s;
    }

    input:focus {
      outline: var(--bim-checkbox--olw, 2px) solid
        var(--bim-checkbox--olc, var(--bim-ui_accent-base));
    }
  `;var nc=YS;cd([Be({type:String,reflect:!0})],nc.prototype,"icon");cd([Be({type:String,reflect:!0})],nc.prototype,"name");cd([Be({type:String,reflect:!0})],nc.prototype,"label");cd([Be({type:Boolean,reflect:!0})],nc.prototype,"checked");cd([Be({type:Boolean,reflect:!0})],nc.prototype,"inverted");var Qk=Object.defineProperty,sc=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&Qk(e,t,n),n},qS=class extends Xt{constructor(){super(...arguments),this.vertical=!1,this.color="#bcf124",this._colorInput=Jl(),this._textInput=Jl(),this.onValueChange=new Event("input"),this.onOpacityInput=e=>{let t=e.target;this.opacity=t.value,this.dispatchEvent(this.onValueChange)}}set value(e){let{color:t,opacity:i}=e;this.color=t,i&&(this.opacity=i)}get value(){let e={color:this.color};return this.opacity&&(e.opacity=this.opacity),e}onColorInput(e){e.stopPropagation();let{value:t}=this._colorInput;t&&(this.color=t.value,this.dispatchEvent(this.onValueChange))}onTextInput(e){e.stopPropagation();let{value:t}=this._textInput;if(!t)return;let{value:i}=t,n=i.replace(/[^a-fA-F0-9]/g,"");n.startsWith("#")||(n=`#${n}`),t.value=n.slice(0,7),t.value.length===7&&(this.color=t.value,this.dispatchEvent(this.onValueChange))}focus(){let{value:e}=this._colorInput;e&&e.click()}render(){return ct`
      <div class="parent">
        <bim-input
          .label=${this.label}
          .icon=${this.icon}
          .vertical="${this.vertical}"
        >
          <div class="color-container">
            <div
              style="display: flex; align-items: center; gap: .375rem; height: 100%; flex: 1; padding: 0 0.5rem;"
            >
              <input
                ${ec(this._colorInput)}
                @input="${this.onColorInput}"
                type="color"
                aria-label=${this.label||this.name||"Color Input"}
                value="${this.color}"
              />
              <div
                @click=${this.focus}
                class="sample"
                style="background-color: ${this.color}"
              ></div>
              <input
                ${ec(this._textInput)}
                @input="${this.onTextInput}"
                value="${this.color}"
                type="text"
                aria-label=${this.label||this.name||"Text Color Input"}
              />
            </div>
            ${this.opacity!==void 0?ct`<bim-number-input
                  @change=${this.onOpacityInput}
                  slider
                  suffix="%"
                  min="0"
                  value=${this.opacity}
                  max="100"
                ></bim-number-input>`:null}
          </div>
        </bim-input>
      </div>
    `}};qS.styles=ri`
    :host {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
      flex: 1;
      display: block;
    }

    :host(:focus) {
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(--bim-ui_accent-base);
    }

    .parent {
      display: flex;
      gap: 0.375rem;
    }

    .color-container {
      position: relative;
      outline: none;
      display: flex;
      height: 100%;
      gap: 0.5rem;
      justify-content: flex-start;
      align-items: center;
      flex: 1;
      border-radius: var(--bim-color-input--bdrs, var(--bim-ui_size-4xs));
    }

    .color-container input[type="color"] {
      position: absolute;
      bottom: -0.25rem;
      visibility: hidden;
      width: 0;
      height: 0;
    }

    .color-container .sample {
      width: 1rem;
      height: 1rem;
      border-radius: 0.125rem;
      background-color: #fff;
    }

    .color-container input[type="text"] {
      height: 100%;
      flex: 1;
      width: 3.25rem;
      text-transform: uppercase;
      font-size: 0.75rem;
      background-color: transparent;
      padding: 0%;
      outline: none;
      border: none;
      color: var(--bim-color-input--c, var(--bim-ui_bg-contrast-100));
    }

    bim-number-input {
      flex-grow: 0;
    }
  `;var Oa=qS;sc([Be({type:String,reflect:!0})],Oa.prototype,"name");sc([Be({type:String,reflect:!0})],Oa.prototype,"label");sc([Be({type:String,reflect:!0})],Oa.prototype,"icon");sc([Be({type:Boolean,reflect:!0})],Oa.prototype,"vertical");sc([Be({type:Number,reflect:!0})],Oa.prototype,"opacity");sc([Be({type:String,reflect:!0})],Oa.prototype,"color");var Jk=ri`
  ::-webkit-scrollbar {
    width: 0.4rem;
    height: 0.4rem;
    overflow: hidden;
  }

  ::-webkit-scrollbar-thumb {
    border-radius: 0.25rem;
    background-color: var(
      --bim-scrollbar--c,
      color-mix(in lab, var(--bim-ui_main-base), white 15%)
    );
  }

  ::-webkit-scrollbar-track {
    background-color: var(--bim-scrollbar--bgc, var(--bim-ui_bg-base));
  }
`,eN=ri`
  :root {
    /* Grayscale Colors */
    --bim-ui_gray-0: hsl(210 10% 5%);
    --bim-ui_gray-1: hsl(210 10% 10%);
    --bim-ui_gray-2: hsl(210 10% 20%);
    --bim-ui_gray-3: hsl(210 10% 30%);
    --bim-ui_gray-4: hsl(210 10% 40%);
    --bim-ui_gray-6: hsl(210 10% 60%);
    --bim-ui_gray-7: hsl(210 10% 70%);
    --bim-ui_gray-8: hsl(210 10% 80%);
    --bim-ui_gray-9: hsl(210 10% 90%);
    --bim-ui_gray-10: hsl(210 10% 95%);

    /* Brand Colors */
    --bim-ui_main-base: #6528d7;
    --bim-ui_accent-base: #bcf124;

    /* Brand Colors Contrasts */
    --bim-ui_main-contrast: var(--bim-ui_gray-10);
    --bim-ui_accent-contrast: var(--bim-ui_gray-0);

    /* Sizes */
    --bim-ui_size-4xs: 0.375rem;
    --bim-ui_size-3xs: 0.5rem;
    --bim-ui_size-2xs: 0.625rem;
    --bim-ui_size-xs: 0.75rem;
    --bim-ui_size-sm: 0.875rem;
    --bim-ui_size-base: 1rem;
    --bim-ui_size-lg: 1.125rem;
    --bim-ui_size-xl: 1.25rem;
    --bim-ui_size-2xl: 1.375rem;
    --bim-ui_size-3xl: 1.5rem;
    --bim-ui_size-4xl: 1.625rem;
    --bim-ui_size-5xl: 1.75rem;
    --bim-ui_size-6xl: 1.875rem;
    --bim-ui_size-7xl: 2rem;
    --bim-ui_size-8xl: 2.125rem;
    --bim-ui_size-9xl: 2.25rem;
  }

  /* Background Colors */
  @media (prefers-color-scheme: dark) {
    :root {
      --bim-ui_bg-base: var(--bim-ui_gray-0);
      --bim-ui_bg-contrast-10: var(--bim-ui_gray-1);
      --bim-ui_bg-contrast-20: var(--bim-ui_gray-2);
      --bim-ui_bg-contrast-30: var(--bim-ui_gray-3);
      --bim-ui_bg-contrast-40: var(--bim-ui_gray-4);
      --bim-ui_bg-contrast-60: var(--bim-ui_gray-6);
      --bim-ui_bg-contrast-80: var(--bim-ui_gray-8);
      --bim-ui_bg-contrast-100: var(--bim-ui_gray-10);
    }
  }

  @media (prefers-color-scheme: light) {
    :root {
      --bim-ui_bg-base: var(--bim-ui_gray-10);
      --bim-ui_bg-contrast-10: var(--bim-ui_gray-9);
      --bim-ui_bg-contrast-20: var(--bim-ui_gray-8);
      --bim-ui_bg-contrast-30: var(--bim-ui_gray-7);
      --bim-ui_bg-contrast-40: var(--bim-ui_gray-6);
      --bim-ui_bg-contrast-60: var(--bim-ui_gray-4);
      --bim-ui_bg-contrast-80: var(--bim-ui_gray-2);
      --bim-ui_bg-contrast-100: var(--bim-ui_gray-0);
      --bim-ui_accent-base: #6528d7;
    }
  }

  html.bim-ui-dark {
    --bim-ui_bg-base: var(--bim-ui_gray-0);
    --bim-ui_bg-contrast-10: var(--bim-ui_gray-1);
    --bim-ui_bg-contrast-20: var(--bim-ui_gray-2);
    --bim-ui_bg-contrast-30: var(--bim-ui_gray-3);
    --bim-ui_bg-contrast-40: var(--bim-ui_gray-4);
    --bim-ui_bg-contrast-60: var(--bim-ui_gray-6);
    --bim-ui_bg-contrast-80: var(--bim-ui_gray-8);
    --bim-ui_bg-contrast-100: var(--bim-ui_gray-10);
  }

  html.bim-ui-light {
    --bim-ui_bg-base: var(--bim-ui_gray-10);
    --bim-ui_bg-contrast-10: var(--bim-ui_gray-9);
    --bim-ui_bg-contrast-20: var(--bim-ui_gray-8);
    --bim-ui_bg-contrast-30: var(--bim-ui_gray-7);
    --bim-ui_bg-contrast-40: var(--bim-ui_gray-6);
    --bim-ui_bg-contrast-60: var(--bim-ui_gray-4);
    --bim-ui_bg-contrast-80: var(--bim-ui_gray-2);
    --bim-ui_bg-contrast-100: var(--bim-ui_gray-0);
    --bim-ui_accent-base: #6528d7;
  }

  [data-context-dialog]::backdrop {
    background-color: transparent;
  }
`,Ao={scrollbar:Jk,globalStyles:eN},XS=class $t{static set config(e){this._config=Se(Se({},$t._config),e)}static get config(){return $t._config}static addGlobalStyles(){let e=document.querySelector("style[id='bim-ui']");if(e)return;e=document.createElement("style"),e.id="bim-ui",e.textContent=Ao.globalStyles.cssText;let t=document.head.firstChild;t?document.head.insertBefore(e,t):document.head.append(e)}static defineCustomElement(e,t){customElements.get(e)||customElements.define(e,t)}static registerComponents(){$t.init()}static init(){$t.addGlobalStyles(),$t.defineCustomElement("bim-button",ls),$t.defineCustomElement("bim-checkbox",nc),$t.defineCustomElement("bim-color-input",Oa),$t.defineCustomElement("bim-context-menu",nN),$t.defineCustomElement("bim-dropdown",Tr),$t.defineCustomElement("bim-grid",Rv),$t.defineCustomElement("bim-icon",hN),$t.defineCustomElement("bim-input",dd),$t.defineCustomElement("bim-label",rc),$t.defineCustomElement("bim-number-input",jn),$t.defineCustomElement("bim-option",qi),$t.defineCustomElement("bim-panel",Ma),$t.defineCustomElement("bim-panel-section",oc),$t.defineCustomElement("bim-selector",ac),$t.defineCustomElement("bim-table",hs),$t.defineCustomElement("bim-tabs",Da),$t.defineCustomElement("bim-tab",os),$t.defineCustomElement("bim-table-cell",aA),$t.defineCustomElement("bim-table-children",cA),$t.defineCustomElement("bim-table-group",dA),$t.defineCustomElement("bim-table-row",Ra),$t.defineCustomElement("bim-text-input",or),$t.defineCustomElement("bim-toolbar",Cf),$t.defineCustomElement("bim-toolbar-group",wf),$t.defineCustomElement("bim-toolbar-section",hc),$t.defineCustomElement("bim-viewport",EA)}static newRandomId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="";for(let i=0;i<10;i++){let n=Math.floor(Math.random()*e.length);t+=e.charAt(n)}return t}};XS._config={sectionLabelOnVerticalToolbar:!1};var hd=XS,tc=class extends Xt{constructor(){super(...arguments),this._lazyLoadObserver=null,this._visibleElements=[],this.ELEMENTS_BEFORE_OBSERVER=20,this.useObserver=!1,this.elements=new Set,this.observe=e=>{if(!this.useObserver)return;for(let i of e)this.elements.add(i);let t=e.slice(this.ELEMENTS_BEFORE_OBSERVER);for(let i of t)i.remove();this.observeLastElement()}}set visibleElements(e){this._visibleElements=this.useObserver?e:[],this.requestUpdate()}get visibleElements(){return this._visibleElements}getLazyObserver(){if(!this.useObserver)return null;if(this._lazyLoadObserver)return this._lazyLoadObserver;let e=new IntersectionObserver(t=>{let i=t[0];if(!i.isIntersecting)return;let n=i.target;e.unobserve(n);let r=this.ELEMENTS_BEFORE_OBSERVER+this.visibleElements.length,o=[...this.elements][r];o&&(this.visibleElements=[...this.visibleElements,o],e.observe(o))},{threshold:.5});return e}observeLastElement(){let e=this.getLazyObserver();if(!e)return;let t=this.ELEMENTS_BEFORE_OBSERVER+this.visibleElements.length-1,i=[...this.elements][t];i&&e.observe(i)}resetVisibleElements(){let e=this.getLazyObserver();if(e){for(let t of this.elements)e.unobserve(t);this.visibleElements=[],this.observeLastElement()}}static create(e,t){let i=document.createDocumentFragment();if(e.length===0)return Ql(e(),i),i.firstElementChild;if(!t)throw new Error("UIComponent: Initial state is required for statefull components.");let n=t,r=e,o=l=>(n=Se(Se({},n),l),Ql(r(n),i),n);o(t);let a=()=>n;return[i.firstElementChild,o,a]}},tN=Object.defineProperty,iN=Object.getOwnPropertyDescriptor,KS=(s,e,t,i)=>{for(var n=iN(e,t),r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&tN(e,t,n),n},Yi,Mv=(Yi=class extends Xt{constructor(){super(...arguments),this._previousContainer=null,this._visible=!1}get placement(){return this._placement}set placement(s){this._placement=s,this.updatePosition()}static removeMenus(){for(let s of Yi.menus)s instanceof Yi&&(s.visible=!1);Yi.dialog.close(),Yi.dialog.remove()}get visible(){return this._visible}set visible(s){var e;this._visible=s,s?(Yi.dialog.parentElement||document.body.append(Yi.dialog),this._previousContainer=this.parentElement,Yi.dialog.style.top=`${window.scrollY||document.documentElement.scrollTop}px`,Yi.dialog.append(this),Yi.dialog.showModal(),this.updatePosition(),this.dispatchEvent(new Event("visible"))):((e=this._previousContainer)==null||e.append(this),this._previousContainer=null,this.dispatchEvent(new Event("hidden")))}updatePosition(){return ie(this,null,function*(){if(!(this.visible&&this._previousContainer))return;let s=this.placement??"right",e=yield fS(this._previousContainer,this,{placement:s,middleware:[tS(10),pS(),uS(),dS({padding:5})]}),{x:t,y:i}=e;this.style.left=`${t}px`,this.style.top=`${i}px`})}connectedCallback(){super.connectedCallback(),Yi.menus.push(this)}render(){return ct` <slot></slot> `}},Yi.styles=[Ao.scrollbar,ri`
      :host {
        pointer-events: auto;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 999;
        overflow: auto;
        max-height: 20rem;
        min-width: 3rem;
        flex-direction: column;
        box-shadow: 1px 2px 8px 2px rgba(0, 0, 0, 0.15);
        padding: 0.5rem;
        border-radius: var(--bim-ui_size-4xs);
        display: flex;
        background-color: var(
          --bim-context-menu--bgc,
          var(--bim-ui_bg-contrast-20)
        );
      }

      :host(:not([visible])) {
        display: none;
      }
    `],Yi.dialog=tc.create(()=>ct` <dialog
      @click=${s=>{s.target===Yi.dialog&&Yi.removeMenus()}}
      @cancel=${()=>Yi.removeMenus()}
      data-context-dialog
      style="
      width: 0;
      height: 0;
      position: relative;
      padding: 0;
      border: none;
      outline: none;
      margin: none;
      overflow: visible;
      background-color: transparent;
    "
    ></dialog>`),Yi.menus=[],Yi);KS([Be({type:String,reflect:!0})],Mv.prototype,"placement");KS([Be({type:Boolean,reflect:!0})],Mv.prototype,"visible");var nN=Mv,uf=(s,e={},t=!0)=>{let i={};for(let n of s.children){let r=n,o=r.getAttribute("name")||r.getAttribute("label"),a=e[o];if(o){if("value"in r&&typeof r.value<"u"&&r.value!==null){let l=r.value;if(typeof l=="object"&&!Array.isArray(l)&&Object.keys(l).length===0)continue;i[o]=a?a(r.value):r.value}else if(t){let l=uf(r,e);if(Object.keys(l).length===0)continue;i[o]=a?a(l):l}}else t&&(i=Se(Se({},i),uf(r,e)))}return i},vf=s=>s==="true"||s==="false"?s==="true":s&&!isNaN(Number(s))&&s.trim()!==""?Number(s):s,sN=[">=","<=","=",">","<","?","/","#"];function Yx(s){let e=sN.find(o=>s.split(o).length===2),t=s.split(e).map(o=>o.trim()),[i,n]=t,r=n.startsWith("'")&&n.endsWith("'")?n.replace(/'/g,""):vf(n);return{key:i,condition:e,value:r}}var bv=s=>{try{let e=[],t=s.split(/&(?![^()]*\))/).map(i=>i.trim());for(let i of t){let n=!i.startsWith("(")&&!i.endsWith(")"),r=i.startsWith("(")&&i.endsWith(")");if(n){let o=Yx(i);e.push(o)}if(r){let o={operator:"&",queries:i.replace(/^(\()|(\))$/g,"").split("&").map(a=>a.trim()).map((a,l)=>{let c=Yx(a);return l>0&&(c.operator="&"),c})};e.push(o)}}return e}catch{return null}},qx=(s,e,t)=>{let i=!1;switch(e){case"=":i=s===t;break;case"?":i=String(s).includes(String(t));break;case"<":(typeof s=="number"||typeof t=="number")&&(i=s<t);break;case"<=":(typeof s=="number"||typeof t=="number")&&(i=s<=t);break;case">":(typeof s=="number"||typeof t=="number")&&(i=s>t);break;case">=":(typeof s=="number"||typeof t=="number")&&(i=s>=t);break;case"/":i=String(s).startsWith(String(t));break}return i},rN=Object.defineProperty,oN=Object.getOwnPropertyDescriptor,Io=(s,e,t,i)=>{for(var n=i>1?void 0:i?oN(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&rN(e,t,n),n},$S=class extends Xt{constructor(){super(...arguments),this.checked=!1,this.checkbox=!1,this.noMark=!1,this.vertical=!1}get value(){return this._value!==void 0?this._value:this.label?vf(this.label):this.label}set value(e){this._value=e}render(){return ct`
      <div class="parent" .title=${this.label??""}>
        ${this.img||this.icon||this.label?ct` <div style="display: flex; column-gap: 0.375rem">
              ${this.checkbox&&!this.noMark?ct`<bim-checkbox
                    style="pointer-events: none"
                    .checked=${this.checked}
                  ></bim-checkbox>`:null}
              <bim-label
                .vertical=${this.vertical}
                .icon=${this.icon}
                .img=${this.img}
                >${this.label}</bim-label
              >
            </div>`:null}
        ${!this.checkbox&&!this.noMark&&this.checked?ct`<svg
              xmlns="http://www.w3.org/2000/svg"
              height="1.125rem"
              viewBox="0 0 24 24"
              width="1.125rem"
              fill="#FFFFFF"
            >
              <path d="M0 0h24v24H0z" fill="none" />
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
            </svg>`:null}
        <slot></slot>
      </div>
    `}};$S.styles=ri`
    :host {
      --bim-label--c: var(--bim-ui_bg-contrast-100);
      display: block;
      box-sizing: border-box;
      flex: 1;
      padding: 0rem 0.5rem;
      border-radius: var(--bim-ui_size-4xs);
      transition: all 0.15s;
    }

    :host(:hover) {
      cursor: pointer;
      background-color: color-mix(
        in lab,
        var(--bim-selector--bgc, var(--bim-ui_bg-contrast-20)),
        var(--bim-ui_main-base) 10%
      );
    }

    :host([checked]) {
      --bim-label--c: color-mix(in lab, var(--bim-ui_main-base), white 30%);
    }

    :host([checked]) svg {
      fill: color-mix(in lab, var(--bim-ui_main-base), white 30%);
    }

    .parent {
      box-sizing: border-box;
      display: flex;
      justify-content: var(--bim-option--jc, space-between);
      column-gap: 0.5rem;
      align-items: center;
      min-height: 1.75rem;
      height: 100%;
    }

    input {
      height: 1rem;
      width: 1rem;
      cursor: pointer;
      border: none;
      outline: none;
      accent-color: var(--bim-checkbox--c, var(--bim-ui_main-base));
    }

    input:focus {
      outline: var(--bim-checkbox--olw, 2px) solid
        var(--bim-checkbox--olc, var(--bim-ui_accent-base));
    }

    bim-label {
      pointer-events: none;
    }
  `;var qi=$S;Io([Be({type:String,reflect:!0})],qi.prototype,"img",2);Io([Be({type:String,reflect:!0})],qi.prototype,"label",2);Io([Be({type:String,reflect:!0})],qi.prototype,"icon",2);Io([Be({type:Boolean,reflect:!0})],qi.prototype,"checked",2);Io([Be({type:Boolean,reflect:!0})],qi.prototype,"checkbox",2);Io([Be({type:Boolean,attribute:"no-mark",reflect:!0})],qi.prototype,"noMark",2);Io([Be({converter:{fromAttribute(s){return s&&vf(s)}}})],qi.prototype,"value",1);Io([Be({type:Boolean,reflect:!0})],qi.prototype,"vertical",2);var aN=Object.defineProperty,lN=Object.getOwnPropertyDescriptor,To=(s,e,t,i)=>{for(var n=i>1?void 0:i?lN(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&aN(e,t,n),n},ZS=class extends tc{constructor(){super(),this.multiple=!1,this.required=!1,this.vertical=!1,this._visible=!1,this._value=new Set,this.onValueChange=new Event("change"),this._contextMenu=Jl(),this.onOptionClick=e=>{let t=e.target,i=this._value.has(t);if(!this.multiple&&!this.required&&!i)this._value=new Set([t]);else if(!this.multiple&&!this.required&&i)this._value=new Set([]);else if(!this.multiple&&this.required&&!i)this._value=new Set([t]);else if(this.multiple&&!this.required&&!i)this._value=new Set([...this._value,t]);else if(this.multiple&&!this.required&&i){let n=[...this._value].filter(r=>r!==t);this._value=new Set(n)}else if(this.multiple&&this.required&&!i)this._value=new Set([...this._value,t]);else if(this.multiple&&this.required&&i){let n=[...this._value].filter(o=>o!==t),r=new Set(n);r.size!==0&&(this._value=r)}this.updateOptionsState(),this.dispatchEvent(this.onValueChange)},this.useObserver=!0}set visible(e){if(e){let{value:t}=this._contextMenu;if(!t)return;for(let i of this.elements)t.append(i);this._visible=!0}else{for(let t of this.elements)this.append(t);this._visible=!1,this.resetVisibleElements()}}get visible(){return this._visible}set value(e){if(this.required&&Object.keys(e).length===0)return;let t=new Set;for(let i of e){let n=this.findOption(i);if(n&&(t.add(n),!this.multiple&&Object.keys(e).length===1))break}this._value=t,this.updateOptionsState(),this.dispatchEvent(this.onValueChange)}get value(){return[...this._value].filter(e=>e instanceof qi&&e.checked).map(e=>e.value)}get _options(){let e=new Set([...this.elements]);for(let t of this.children)t instanceof qi&&e.add(t);return[...e]}onSlotChange(e){let t=e.target.assignedElements();this.observe(t);let i=new Set;for(let n of this.elements){if(!(n instanceof qi)){n.remove();continue}n.checked&&i.add(n),n.removeEventListener("click",this.onOptionClick),n.addEventListener("click",this.onOptionClick)}this._value=i}updateOptionsState(){for(let e of this._options)e instanceof qi&&(e.checked=this._value.has(e))}findOption(e){return this._options.find(t=>t instanceof qi?t.label===e||t.value===e:!1)}render(){let e,t,i;if(this._value.size===0)e="Select an option...";else if(this._value.size===1){let n=[...this._value][0];e=n?.label||n?.value,t=n?.img,i=n?.icon}else e=`Multiple (${this._value.size})`;return ct`
      <bim-input
        title=${this.label??""}
        .label=${this.label}
        .icon=${this.icon}
        .vertical=${this.vertical}
      >
        <div class="input" @click=${()=>this.visible=!this.visible}>
          <bim-label
            .img=${t}
            .icon=${i}
            style="overflow: hidden;"
            >${e}</bim-label
          >
          <svg
            style="flex-shrink: 0; fill: var(--bim-dropdown--c, var(--bim-ui_bg-contrast-100))"
            xmlns="http://www.w3.org/2000/svg"
            height="1.125rem"
            viewBox="0 0 24 24"
            width="1.125rem"
            fill="#9ca3af"
          >
            <path d="M0 0h24v24H0V0z" fill="none" />
            <path d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z" />
          </svg>
          <bim-context-menu
            ${ec(this._contextMenu)}
            .visible=${this.visible}
            @hidden=${()=>{this.visible&&(this.visible=!1)}}
          >
            <slot @slotchange=${this.onSlotChange}></slot>
          </bim-context-menu>
        </div>
      </bim-input>
    `}};ZS.styles=[Ao.scrollbar,ri`
      :host {
        --bim-input--bgc: var(
          --bim-dropdown--bgc,
          var(--bim-ui_bg-contrast-20)
        );
        --bim-input--olw: 2px;
        --bim-input--olc: transparent;
        --bim-input--bdrs: var(--bim-ui_size-4xs);
        flex: 1;
        display: block;
      }

      :host([visible]) {
        --bim-input--olc: var(--bim-ui_accent-base);
      }

      .input {
        --bim-label--fz: var(--bim-drodown--fz, var(--bim-ui_size-xs));
        --bim-label--c: var(--bim-dropdown--c, var(--bim-ui_bg-contrast-100));
        height: 100%;
        display: flex;
        flex: 1;
        overflow: hidden;
        column-gap: 0.25rem;
        outline: none;
        cursor: pointer;
        align-items: center;
        justify-content: space-between;
        padding: 0 0.5rem;
      }

      bim-label {
        pointer-events: none;
      }
    `];var Tr=ZS;To([Be({type:String,reflect:!0})],Tr.prototype,"name",2);To([Be({type:String,reflect:!0})],Tr.prototype,"icon",2);To([Be({type:String,reflect:!0})],Tr.prototype,"label",2);To([Be({type:Boolean,reflect:!0})],Tr.prototype,"multiple",2);To([Be({type:Boolean,reflect:!0})],Tr.prototype,"required",2);To([Be({type:Boolean,reflect:!0})],Tr.prototype,"vertical",2);To([Be({type:Boolean,reflect:!0})],Tr.prototype,"visible",1);To([ic()],Tr.prototype,"_value",2);var cN=Object.defineProperty,QS=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&cN(e,t,n),n},JS=class extends Xt{constructor(){super(...arguments),this.floating=!1,this.layouts={}}getUniqueAreasFromTemplate(e){let t=e.split(`
`).map(i=>i.trim()).map(i=>i.split('"')[1]).filter(i=>i!==void 0).flatMap(i=>i.split(/\s+/));return[...new Set(t)].filter(i=>i!=="")}firstUpdated(){this._onLayoutChange=new Event("layoutchange")}render(){if(this.layout){if(this.layouts[this.layout]){this.innerHTML="";let e=this.layouts[this.layout],t=this.getUniqueAreasFromTemplate(e.template).map(i=>{let n=e.elements[i];return n&&(n.style.gridArea=i),n}).filter(i=>!!i);this.style.gridTemplate=e.template,this._onLayoutChange&&this.dispatchEvent(this._onLayoutChange),this.append(...t)}}else this.innerHTML="",this.style.gridTemplate="",this._onLayoutChange&&this.dispatchEvent(this._onLayoutChange);return ct`<slot></slot>`}};JS.styles=ri`
    :host {
      display: grid;
      height: 100%;
      width: 100%;
      overflow: hidden;
      box-sizing: border-box;
    }

    /* :host(:not([layout])) {
      display: none;
    } */

    :host([floating]) {
      --bim-panel--bdrs: var(--bim-ui_size-4xs);
      background-color: transparent;
      padding: 1rem;
      gap: 1rem;
      position: absolute;
      pointer-events: none;
      top: 0px;
      left: 0px;
    }

    :host(:not([floating])) {
      --bim-panel--bdrs: 0;
      background-color: var(--bim-ui_bg-contrast-20);
      gap: 1px;
    }
  `;var Rv=JS;QS([Be({type:Boolean,reflect:!0})],Rv.prototype,"floating");QS([Be({type:String,reflect:!0})],Rv.prototype,"layout");var vv=class extends Xt{render(){return ct`
      <iconify-icon .icon=${this.icon} height="none"></iconify-icon>
    `}};vv.styles=ri`
    :host {
      height: var(--bim-icon--fz, var(--bim-ui_size-sm));
      width: var(--bim-icon--fz, var(--bim-ui_size-sm));
    }

    iconify-icon {
      height: var(--bim-icon--fz, var(--bim-ui_size-sm));
      width: var(--bim-icon--fz, var(--bim-ui_size-sm));
      color: var(--bim-icon--c);
      transition: all 0.15s;
    }
  `,vv.properties={icon:{type:String}};var hN=vv,dN=Object.defineProperty,yf=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&dN(e,t,n),n},eA=class extends Xt{constructor(){super(...arguments),this.vertical=!1,this.onValueChange=new Event("change")}get value(){let e={};for(let t of this.children){let i=t;"value"in i?e[i.name||i.label]=i.value:"checked"in i&&(e[i.name||i.label]=i.checked)}return e}set value(e){let t=[...this.children];for(let i in e){let n=t.find(a=>{let l=a;return l.name===i||l.label===i});if(!n)continue;let r=n,o=e[i];typeof o=="boolean"?r.checked=o:r.value=o}}render(){return ct`
      <div class="parent">
        ${this.label||this.icon?ct`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        <div class="input">
          <slot></slot>
        </div>
      </div>
    `}};eA.styles=ri`
    :host {
      flex: 1;
      display: block;
    }

    .parent {
      display: flex;
      flex-wrap: wrap;
      column-gap: 1rem;
      row-gap: 0.375rem;
      user-select: none;
      flex: 1;
    }

    :host(:not([vertical])) .parent {
      justify-content: space-between;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    .input {
      overflow: hidden;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      min-height: 1.75rem;
      min-width: 3rem;
      gap: var(--bim-input--g, var(--bim-ui_size-4xs));
      padding: var(--bim-input--p, 0);
      background-color: var(--bim-input--bgc, transparent);
      outline: var(--bim-input--olw, 2px) solid
        var(--bim-input--olc, transparent);
      border-radius: var(--bim-input--bdrs, var(--bim-ui_size-4xs));
      transition: all 0.15s;
    }

    :host(:not([vertical])) .input {
      flex: 1;
      justify-content: flex-end;
    }

    :host(:not([vertical])[label]) .input {
      max-width: fit-content;
    }
  `;var dd=eA;yf([Be({type:String,reflect:!0})],dd.prototype,"name");yf([Be({type:String,reflect:!0})],dd.prototype,"label");yf([Be({type:String,reflect:!0})],dd.prototype,"icon");yf([Be({type:Boolean,reflect:!0})],dd.prototype,"vertical");var uN=Object.defineProperty,ud=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&uN(e,t,n),n},tA=class extends Xt{constructor(){super(...arguments),this.labelHidden=!1,this.iconHidden=!1,this.vertical=!1}get value(){return this.textContent?vf(this.textContent):this.textContent}render(){return ct`
      <div class="parent" .title=${this.textContent??""}>
        ${this.img?ct`<img .src=${this.img} .alt=${this.textContent||""} />`:null}
        ${!this.iconHidden&&this.icon?ct`<bim-icon .icon=${this.icon}></bim-icon>`:null}
        <p><slot></slot></p>
      </div>
    `}};tA.styles=ri`
    :host {
      --bim-icon--c: var(--bim-label--c);
      color: var(--bim-label--c, var(--bim-ui_bg-contrast-60));
      font-size: var(--bim-label--fz, var(--bim-ui_size-xs));
      overflow: hidden;
      display: block;
      white-space: nowrap;
      line-height: 1.1rem;
      transition: all 0.15s;
    }

    .parent {
      display: flex;
      align-items: center;
      column-gap: 0.25rem;
      row-gap: 0.125rem;
      user-select: none;
      height: 100%;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    .parent p {
      margin: 0;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    :host([label-hidden]) .parent p,
    :host(:empty) .parent p {
      display: none;
    }

    img {
      height: 100%;
      aspect-ratio: 1;
      border-radius: 100%;
      margin-right: 0.125rem;
    }

    :host(:not([vertical])) img {
      max-height: var(
        --bim-label_icon--sz,
        calc(var(--bim-label--fz, var(--bim-ui_size-xs)) * 1.8)
      );
    }

    :host([vertical]) img {
      max-height: var(
        --bim-label_icon--sz,
        calc(var(--bim-label--fz, var(--bim-ui_size-xs)) * 4)
      );
    }
  `;var rc=tA;ud([Be({type:String,reflect:!0})],rc.prototype,"img");ud([Be({type:Boolean,attribute:"label-hidden",reflect:!0})],rc.prototype,"labelHidden");ud([Be({type:String,reflect:!0})],rc.prototype,"icon");ud([Be({type:Boolean,attribute:"icon-hidden",reflect:!0})],rc.prototype,"iconHidden");ud([Be({type:Boolean,reflect:!0})],rc.prototype,"vertical");var pN=Object.defineProperty,fN=Object.getOwnPropertyDescriptor,cs=(s,e,t,i)=>{for(var n=i>1?void 0:i?fN(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&pN(e,t,n),n},iA=class extends Xt{constructor(){super(...arguments),this._value=0,this.vertical=!1,this.slider=!1,this._input=Jl(),this.onValueChange=new Event("change")}set value(e){this.setValue(e.toString())}get value(){return this._value}onChange(e){e.stopPropagation();let{value:t}=this._input;t&&this.setValue(t.value)}setValue(e){let{value:t}=this._input,i=e;if(i=i.replace(/[^0-9.-]/g,""),i=i.replace(/(\..*)\./g,"$1"),i.endsWith(".")||(i.lastIndexOf("-")>0&&(i=i[0]+i.substring(1).replace(/-/g,"")),i==="-"||i==="-0"))return;let n=Number(i);Number.isNaN(n)||(n=this.min!==void 0?Math.max(n,this.min):n,n=this.max!==void 0?Math.min(n,this.max):n,this.value!==n&&(this._value=n,t&&(t.value=this.value.toString()),this.requestUpdate(),this.dispatchEvent(this.onValueChange)))}onBlur(){let{value:e}=this._input;e&&Number.isNaN(Number(e.value))&&(e.value=this.value.toString())}onSliderMouseDown(e){document.body.style.cursor="w-resize";let{clientX:t}=e,i=this.value,n=!1,r=l=>{var c;n=!0;let{clientX:d}=l,h=this.step??1,u=((c=h.toString().split(".")[1])==null?void 0:c.length)||0,p=1/(this.sensitivity??1),f=(d-t)/p;if(Math.floor(Math.abs(f))!==Math.abs(f))return;let m=i+f*h;this.setValue(m.toFixed(u))},o=()=>{this.slider=!0,this.removeEventListener("blur",o)},a=()=>{document.removeEventListener("mousemove",r),document.body.style.cursor="default",n?n=!1:(this.addEventListener("blur",o),this.slider=!1,requestAnimationFrame(()=>this.focus())),document.removeEventListener("mouseup",a)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",a)}onFocus(e){e.stopPropagation();let t=i=>{i.key==="Escape"&&(this.blur(),window.removeEventListener("keydown",t))};window.addEventListener("keydown",t)}connectedCallback(){super.connectedCallback(),this.min&&this.min>this.value&&(this._value=this.min),this.max&&this.max<this.value&&(this._value=this.max)}focus(){let{value:e}=this._input;e&&e.focus()}render(){let e=ct`
      ${this.pref||this.icon?ct`<bim-label
            style="pointer-events: auto"
            @mousedown=${this.onSliderMouseDown}
            .icon=${this.icon}
            >${this.pref}</bim-label
          >`:null}
      <input
        ${ec(this._input)}
        type="text"
        aria-label=${this.label||this.name||"Number Input"}
        size="1"
        @input=${a=>a.stopPropagation()}
        @change=${this.onChange}
        @blur=${this.onBlur}
        @focus=${this.onFocus}
        .value=${this.value.toString()}
      />
      ${this.suffix?ct`<bim-label
            style="pointer-events: auto"
            @mousedown=${this.onSliderMouseDown}
            >${this.suffix}</bim-label
          >`:null}
    `,t=this.min??-1/0,i=this.max??1/0,n=100*(this.value-t)/(i-t),r=ct`
      <style>
        .slider-indicator {
          width: ${`${n}%`};
        }
      </style>
      <div class="slider" @mousedown=${this.onSliderMouseDown}>
        <div class="slider-indicator"></div>
        ${this.pref||this.icon?ct`<bim-label
              style="z-index: 1; margin-right: 0.125rem"
              .icon=${this.icon}
              >${`${this.pref}: `}</bim-label
            >`:null}
        <bim-label style="z-index: 1;">${this.value}</bim-label>
        ${this.suffix?ct`<bim-label style="z-index: 1;">${this.suffix}</bim-label>`:null}
      </div>
    `,o=`${this.label||this.name||this.pref?`${this.label||this.name||this.pref}: `:""}${this.value}${this.suffix??""}`;return ct`
      <bim-input
        title=${o}
        .label=${this.label}
        .icon=${this.icon}
        .vertical=${this.vertical}
      >
        ${this.slider?r:e}
      </bim-input>
    `}};iA.styles=ri`
    :host {
      --bim-input--bgc: var(
        --bim-number-input--bgc,
        var(--bim-ui_bg-contrast-20)
      );
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(--bim-number-input--olc, transparent);
      --bim-input--bdrs: var(--bim-number-input--bdrs, var(--bim-ui_size-4xs));
      --bim-input--p: 0 0.375rem;
      flex: 1;
      display: block;
    }

    :host(:focus) {
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(
        --bim-number-input¡focus--c,
        var(--bim-ui_accent-base)
      );
    }

    :host(:not([slider])) bim-label {
      --bim-label--c: var(
        --bim-number-input_affixes--c,
        var(--bim-ui_bg-contrast-60)
      );
      --bim-label--fz: var(
        --bim-number-input_affixes--fz,
        var(--bim-ui_size-xs)
      );
    }

    p {
      margin: 0;
      padding: 0;
    }

    input {
      background-color: transparent;
      outline: none;
      border: none;
      padding: 0;
      flex-grow: 1;
      text-align: right;
      font-family: inherit;
      font-feature-settings: inherit;
      font-variation-settings: inherit;
      font-size: var(--bim-number-input--fz, var(--bim-ui_size-xs));
      color: var(--bim-number-input--c, var(--bim-ui_bg-contrast-100));
    }

    :host([suffix]:not([pref])) input {
      text-align: left;
    }

    :host([slider]) {
      --bim-input--p: 0;
    }

    :host([slider]) .slider {
      --bim-label--c: var(--bim-ui_bg-contrast-100);
    }

    .slider {
      position: relative;
      display: flex;
      justify-content: center;
      width: 100%;
      height: 100%;
      padding: 0 0.5rem;
    }

    .slider-indicator {
      height: 100%;
      background-color: var(--bim-ui_main-base);
      position: absolute;
      top: 0;
      left: 0;
      border-radius: var(--bim-input--bdrs, var(--bim-ui_size-4xs));
    }

    bim-input {
      display: flex;
    }

    bim-label {
      pointer-events: none;
    }
  `;var jn=iA;cs([Be({type:String,reflect:!0})],jn.prototype,"name",2);cs([Be({type:String,reflect:!0})],jn.prototype,"icon",2);cs([Be({type:String,reflect:!0})],jn.prototype,"label",2);cs([Be({type:String,reflect:!0})],jn.prototype,"pref",2);cs([Be({type:Number,reflect:!0})],jn.prototype,"min",2);cs([Be({type:Number,reflect:!0})],jn.prototype,"value",1);cs([Be({type:Number,reflect:!0})],jn.prototype,"step",2);cs([Be({type:Number,reflect:!0})],jn.prototype,"sensitivity",2);cs([Be({type:Number,reflect:!0})],jn.prototype,"max",2);cs([Be({type:String,reflect:!0})],jn.prototype,"suffix",2);cs([Be({type:Boolean,reflect:!0})],jn.prototype,"vertical",2);cs([Be({type:Boolean,reflect:!0})],jn.prototype,"slider",2);var mN=Object.defineProperty,gN=Object.getOwnPropertyDescriptor,pd=(s,e,t,i)=>{for(var n=i>1?void 0:i?gN(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&mN(e,t,n),n},nA=class extends Xt{constructor(){super(...arguments),this.onValueChange=new Event("change"),this._hidden=!1,this.headerHidden=!1,this.valueTransform={},this.activationButton=document.createElement("bim-button")}set hidden(e){this._hidden=e,this.activationButton.active=!e,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}get value(){return uf(this,this.valueTransform)}set value(e){let t=[...this.children];for(let i in e){let n=t.find(o=>{let a=o;return a.name===i||a.label===i});if(!n)continue;let r=n;r.value=e[i]}}connectedCallback(){super.connectedCallback(),this.activationButton.active=!this.hidden,this.activationButton.onclick=()=>this.hidden=!this.hidden}disconnectedCallback(){super.disconnectedCallback(),this.activationButton.remove()}collapseSections(){let e=this.querySelectorAll("bim-panel-section");for(let t of e)t.collapsed=!0}expandSections(){let e=this.querySelectorAll("bim-panel-section");for(let t of e)t.collapsed=!1}render(){return this.activationButton.icon=this.icon,this.activationButton.label=this.label||this.name,this.activationButton.tooltipTitle=this.label||this.name,ct`
      <div class="parent">
        ${this.label||this.name||this.icon?ct`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        <div class="sections">
          <slot></slot>
        </div>
      </div>
    `}};nA.styles=[Ao.scrollbar,ri`
      :host {
        display: flex;
        border-radius: var(--bim-ui_size-base);
        background-color: var(--bim-ui_bg-base);
        overflow: auto;
      }

      :host([hidden]) {
        display: none;
      }

      .parent {
        display: flex;
        flex: 1;
        flex-direction: column;
        pointer-events: auto;
        overflow: auto;
      }

      .parent bim-label {
        --bim-label--c: var(--bim-panel--c, var(--bim-ui_bg-contrast-80));
        --bim-label--fz: var(--bim-panel--fz, var(--bim-ui_size-sm));
        font-weight: 600;
        padding: 1rem;
        flex-shrink: 0;
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([header-hidden]) .parent bim-label {
        display: none;
      }

      .sections {
        display: flex;
        flex-direction: column;
        overflow: auto;
      }

      ::slotted(bim-panel-section:not(:last-child)) {
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }
    `];var Ma=nA;pd([Be({type:String,reflect:!0})],Ma.prototype,"icon",2);pd([Be({type:String,reflect:!0})],Ma.prototype,"name",2);pd([Be({type:String,reflect:!0})],Ma.prototype,"label",2);pd([Be({type:Boolean,reflect:!0})],Ma.prototype,"hidden",1);pd([Be({type:Boolean,attribute:"header-hidden",reflect:!0})],Ma.prototype,"headerHidden",2);var bN=Object.defineProperty,fd=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&bN(e,t,n),n},sA=class extends Xt{constructor(){super(...arguments),this.onValueChange=new Event("change"),this.valueTransform={}}get value(){let e=this.parentElement,t;return e instanceof Ma&&(t=e.valueTransform),Object.values(this.valueTransform).length!==0&&(t=this.valueTransform),uf(this,t)}set value(e){let t=[...this.children];for(let i in e){let n=t.find(o=>{let a=o;return a.name===i||a.label===i});if(!n)continue;let r=n;r.value=e[i]}}onHeaderClick(){this.fixed||(this.collapsed=!this.collapsed)}render(){let e=this.label||this.icon||this.name||this.fixed,t=ct`<svg
      xmlns="http://www.w3.org/2000/svg"
      height="1.125rem"
      viewBox="0 0 24 24"
      width="1.125rem"
    >
      <path d="M0 0h24v24H0V0z" fill="none" />
      <path d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z" />
    </svg>`,i=ct`<svg
      xmlns="http://www.w3.org/2000/svg"
      height="1.125rem"
      viewBox="0 0 24 24"
      width="1.125rem"
    >
      <path d="M0 0h24v24H0z" fill="none" />
      <path d="M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z" />
    </svg>`,n=this.collapsed?t:i,r=ct`
      <div
        class="header"
        title=${this.label??""}
        @click=${this.onHeaderClick}
      >
        ${this.label||this.icon||this.name?ct`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        ${this.fixed?null:n}
      </div>
    `;return ct`
      <div class="parent">
        ${e?r:null}
        <div class="components">
          <slot></slot>
        </div>
      </div>
    `}};sA.styles=[Ao.scrollbar,ri`
      :host {
        display: block;
        pointer-events: auto;
      }

      :host(:not([fixed])) .header:hover {
        --bim-label--c: var(--bim-ui_accent-base);
        color: var(--bim-ui_accent-base);
        cursor: pointer;
      }

      :host(:not([fixed])) .header:hover svg {
        fill: var(--bim-ui_accent-base);
      }

      .header {
        --bim-label--fz: var(--bim-ui_size-sm);
        --bim-label--c: var(--bim-ui_bg-contrast-80);
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 600;
        height: 1.5rem;
        padding: 0.75rem 1rem;
      }

      .header svg {
        fill: var(--bim-ui_bg-contrast-80);
      }

      .title {
        display: flex;
        align-items: center;
        column-gap: 0.5rem;
      }

      .title p {
        font-size: var(--bim-ui_size-sm);
      }

      .components {
        display: flex;
        flex-direction: column;
        row-gap: 0.75rem;
        padding: 0.125rem 1rem 1rem;
      }

      :host(:not([fixed])[collapsed]) .components {
        display: none;
        height: 0px;
      }

      bim-label {
        pointer-events: none;
      }
    `];var oc=sA;fd([Be({type:String,reflect:!0})],oc.prototype,"icon");fd([Be({type:String,reflect:!0})],oc.prototype,"label");fd([Be({type:String,reflect:!0})],oc.prototype,"name");fd([Be({type:Boolean,reflect:!0})],oc.prototype,"fixed");fd([Be({type:Boolean,reflect:!0})],oc.prototype,"collapsed");var vN=Object.defineProperty,md=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&vN(e,t,n),n},rA=class extends Xt{constructor(){super(...arguments),this.vertical=!1,this.onValueChange=new Event("change"),this._canEmitEvents=!1,this._value=document.createElement("bim-option"),this.onOptionClick=e=>{this._value=e.target,this.dispatchEvent(this.onValueChange);for(let t of this.children)t instanceof qi&&(t.checked=t===e.target)}}get _options(){return[...this.querySelectorAll("bim-option")]}set value(e){let t=this.findOption(e);if(t){for(let i of this._options)i.checked=i===t;this._value=t,this._canEmitEvents&&this.dispatchEvent(this.onValueChange)}}get value(){return this._value.value}onSlotChange(e){let t=e.target.assignedElements();for(let i of t)i instanceof qi&&(i.noMark=!0,i.removeEventListener("click",this.onOptionClick),i.addEventListener("click",this.onOptionClick))}findOption(e){return this._options.find(t=>t instanceof qi?t.label===e||t.value===e:!1)}firstUpdated(){let e=[...this.children].find(t=>t instanceof qi&&t.checked);e&&(this._value=e)}render(){return ct`
      <bim-input
        .vertical=${this.vertical}
        .label=${this.label}
        .icon=${this.icon}
      >
        <slot @slotchange=${this.onSlotChange}></slot>
      </bim-input>
    `}};rA.styles=ri`
    :host {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
      --bim-input--g: 0;
      --bim-option--jc: center;
      flex: 1;
      display: block;
    }

    ::slotted(bim-option) {
      border-radius: 0;
    }

    ::slotted(bim-option[checked]) {
      --bim-label--c: var(--bim-ui_main-contrast);
      background-color: var(--bim-ui_main-base);
    }
  `;var ac=rA;md([Be({type:String,reflect:!0})],ac.prototype,"name");md([Be({type:String,reflect:!0})],ac.prototype,"icon");md([Be({type:String,reflect:!0})],ac.prototype,"label");md([Be({type:Boolean,reflect:!0})],ac.prototype,"vertical");md([ic()],ac.prototype,"_value");var yN=()=>ct`
    <style>
      div {
        display: flex;
        gap: 0.375rem;
        border-radius: 0.25rem;
        min-height: 1.25rem;
      }

      [data-type="row"] {
        background-color: var(--bim-ui_bg-contrast-10);
        animation: row-loading 1s linear infinite alternate;
        padding: 0.5rem;
      }

      [data-type="cell"] {
        background-color: var(--bim-ui_bg-contrast-20);
        flex: 0.25;
      }

      @keyframes row-loading {
        0% {
          background-color: var(--bim-ui_bg-contrast-10);
        }
        100% {
          background-color: var(--bim-ui_bg-contrast-20);
        }
      }
    </style>
    <div style="display: flex; flex-direction: column;">
      <div data-type="row" style="gap: 2rem">
        <div data-type="cell" style="flex: 1"></div>
        <div data-type="cell" style="flex: 2"></div>
        <div data-type="cell" style="flex: 1"></div>
        <div data-type="cell" style="flex: 0.5"></div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.7s5"></div>
        </div>
      </div>
    </div>
  `,_N=()=>ct`
    <style>
      .loader {
        grid-area: Processing;
        position: relative;
        padding: 0.125rem;
      }
      .loader:before {
        content: "";
        position: absolute;
      }
      .loader .loaderBar {
        position: absolute;
        top: 0;
        right: 100%;
        bottom: 0;
        left: 0;
        background: var(--bim-ui_main-base);
        /* width: 25%; */
        width: 0;
        animation: borealisBar 2s linear infinite;
      }

      @keyframes borealisBar {
        0% {
          left: 0%;
          right: 100%;
          width: 0%;
        }
        10% {
          left: 0%;
          right: 75%;
          width: 25%;
        }
        90% {
          right: 0%;
          left: 75%;
          width: 25%;
        }
        100% {
          left: 100%;
          right: 0%;
          width: 0%;
        }
      }
    </style>
    <div class="loader">
      <div class="loaderBar"></div>
    </div>
  `,wN=Object.defineProperty,EN=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&wN(e,t,n),n},oA=class extends Xt{constructor(){super(...arguments),this.column="",this.columnIndex=0,this.rowData={}}get data(){return this.column?this.rowData[this.column]:null}render(){return ct`
      <style>
        :host {
          grid-area: ${this.column??"unset"};
        }
      </style>
      <slot></slot>
    `}};oA.styles=ri`
    :host {
      padding: 0.375rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    :host([data-column-index="0"]:not([data-no-indentation])) {
      justify-content: normal;
    }

    :host([data-column-index="0"]:not([data-cell-header]))
      ::slotted(bim-label) {
      text-align: left;
    }

    ::slotted(*) {
      --bim-input--bgc: transparent;
      --bim-input--olc: var(--bim-ui_bg-contrast-20);
      --bim-input--olw: 1px;
    }

    ::slotted(bim-input) {
      --bim-input--olw: 0;
    }

    ::slotted(bim-label) {
      white-space: normal;
      text-align: center;
    }
  `;var aA=oA;EN([Be({type:String,reflect:!0})],aA.prototype,"column");var CN=Object.defineProperty,xN=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&CN(e,t,n),n},lA=class extends Xt{constructor(){super(...arguments),this._groups=[],this.data=[],this.table=this.closest("bim-table")}toggleGroups(e,t=!1){for(let i of this._groups)i.childrenHidden=typeof e>"u"?!i.childrenHidden:!e,t&&i.toggleChildren(e,t)}render(){return this._groups=[],ct`
      <slot></slot>
      ${this.data.map(e=>{let t=document.createElement("bim-table-group");return this._groups.push(t),t.table=this.table,t.data=e,t})}
    `}};lA.styles=ri`
    :host {
      --bim-button--bgc: transparent;
      position: relative;
      grid-area: Children;
    }

    :host([hidden]) {
      display: none;
    }

    ::slotted(.branch.branch-vertical) {
      top: 0;
      bottom: 1.125rem;
    }
  `;var cA=lA;xN([Be({type:Array,attribute:!1})],cA.prototype,"data");var SN=Object.defineProperty,AN=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&SN(e,t,n),n},hA=class extends Xt{constructor(){super(...arguments),this.data={data:{}},this.childrenHidden=!0,this.table=this.closest("bim-table")}connectedCallback(){super.connectedCallback(),this.table&&this.table.expanded?this.childrenHidden=!1:this.childrenHidden=!0}toggleChildren(e,t=!1){this._children&&(this.childrenHidden=typeof e>"u"?!this.childrenHidden:!e,t&&this._children.toggleGroups(e,t))}render(){if(!this.table)throw new Error("TableGroup: parent table wasn't found!");let e=this.table.getGroupIndentation(this.data)??0,t=ct`
      ${this.table.noIndentation?null:ct`
            <style>
              .branch-vertical {
                left: ${e+(this.table.selectableRows?1.9375:.5625)}rem;
              }
            </style>
            <div class="branch branch-vertical"></div>
          `}
    `,i=document.createDocumentFragment();Ql(t,i);let n=null;this.table.noIndentation||(n=document.createElement("div"),n.classList.add("branch","branch-horizontal"),n.style.left=`${e-1+(this.table.selectableRows?2.05:.5625)}rem`);let r=null;if(!this.table.noIndentation){let l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.setAttribute("height","9.5"),l.setAttribute("width","7.5"),l.setAttribute("viewBox","0 0 4.6666672 7.3333333");let c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d","m 1.7470835,6.9583848 2.5899999,-2.59 c 0.39,-0.39 0.39,-1.02 0,-1.41 L 1.7470835,0.36838483 c -0.63,-0.62000003 -1.71000005,-0.18 -1.71000005,0.70999997 v 5.17 c 0,0.9 1.08000005,1.34 1.71000005,0.71 z"),l.append(c);let d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttribute("height","6.5"),d.setAttribute("width","9.5"),d.setAttribute("viewBox","0 0 5.9111118 5.0175439");let h=document.createElementNS("http://www.w3.org/2000/svg","path");h.setAttribute("d","M -0.33616196,1.922522 2.253838,4.5125219 c 0.39,0.39 1.02,0.39 1.41,0 L 6.2538379,1.922522 c 0.6200001,-0.63 0.18,-1.71000007 -0.7099999,-1.71000007 H 0.37383804 c -0.89999997,0 -1.33999997,1.08000007 -0.71,1.71000007 z"),d.append(h),r=document.createElement("div"),r.addEventListener("click",u=>{u.stopPropagation(),this.toggleChildren()}),r.classList.add("caret"),r.style.left=`${(this.table.selectableRows?1.5:.125)+e}rem`,this.childrenHidden?r.append(l):r.append(d)}let o=document.createElement("bim-table-row");this.data.children&&!this.childrenHidden&&o.append(i),o.table=this.table,o.data=this.data.data,this.table.dispatchEvent(new CustomEvent("rowcreated",{detail:{row:o}})),r&&this.data.children&&o.append(r),e!==0&&(!this.data.children||this.childrenHidden)&&n&&o.append(n);let a;if(this.data.children){a=document.createElement("bim-table-children"),this._children=a,a.table=this.table,a.data=this.data.children;let l=document.createDocumentFragment();Ql(t,l),a.append(l)}return ct`
      <div class="parent">${o} ${this.childrenHidden?null:a}</div>
    `}};hA.styles=ri`
    :host {
      position: relative;
    }

    .parent {
      display: grid;
      grid-template-areas: "Data" "Children";
    }

    .branch {
      position: absolute;
      z-index: 1;
    }

    .branch-vertical {
      border-left: 1px dotted var(--bim-ui_bg-contrast-40);
    }

    .branch-horizontal {
      top: 50%;
      width: 1rem;
      border-bottom: 1px dotted var(--bim-ui_bg-contrast-40);
    }

    .caret {
      position: absolute;
      z-index: 2;
      transform: translateY(-50%) rotate(0deg);
      top: 50%;
      display: flex;
      width: 0.95rem;
      height: 0.95rem;
      justify-content: center;
      align-items: center;
      cursor: pointer;
    }

    .caret svg {
      fill: var(--bim-ui_bg-contrast-60);
    }
  `;var dA=hA;AN([Be({type:Boolean,attribute:"children-hidden",reflect:!0})],dA.prototype,"childrenHidden");var IN=Object.defineProperty,lc=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&IN(e,t,n),n},uA=class extends Xt{constructor(){super(...arguments),this.selected=!1,this.columns=[],this.hiddenColumns=[],this.data={},this.isHeader=!1,this.table=this.closest("bim-table"),this.onTableColumnsChange=()=>{this.table&&(this.columns=this.table.columns)},this.onTableColumnsHidden=()=>{this.table&&(this.hiddenColumns=this.table.hiddenColumns)},this._observer=new IntersectionObserver(e=>{this._intersecting=e[0].isIntersecting},{rootMargin:"36px"})}get _columnNames(){return this.columns.filter(e=>!this.hiddenColumns.includes(e.name)).map(e=>e.name)}get _columnWidths(){return this.columns.filter(e=>!this.hiddenColumns.includes(e.name)).map(e=>e.width)}get _isSelected(){var e;return(e=this.table)==null?void 0:e.selection.has(this.data)}onSelectionChange(e){if(!this.table)return;let t=e.target;this.selected=t.value,t.value?(this.table.selection.add(this.data),this.table.dispatchEvent(new CustomEvent("rowselected",{detail:{data:this.data}}))):(this.table.selection.delete(this.data),this.table.dispatchEvent(new CustomEvent("rowdeselected",{detail:{data:this.data}})))}connectedCallback(){super.connectedCallback(),this._observer.observe(this),this.table&&(this.columns=this.table.columns,this.hiddenColumns=this.table.hiddenColumns,this.table.addEventListener("columnschange",this.onTableColumnsChange),this.table.addEventListener("columnshidden",this.onTableColumnsHidden),this.toggleAttribute("selected",this._isSelected))}disconnectedCallback(){super.disconnectedCallback(),this._observer.unobserve(this),this.table&&(this.columns=[],this.hiddenColumns=[],this.table.removeEventListener("columnschange",this.onTableColumnsChange),this.table.removeEventListener("columnshidden",this.onTableColumnsHidden),this.toggleAttribute("selected",!1))}compute(){if(!this.table)throw new Error("TableRow: parent table wasn't found!");let e=this.table.getRowIndentation(this.data)??0,t=this.isHeader?this.data:this.table.applyDataTransform(this.data)??this.data,i=[];for(let n in t){if(this.hiddenColumns.includes(n))continue;let r=t[n],o;if(typeof r=="string"||typeof r=="boolean"||typeof r=="number"?(o=document.createElement("bim-label"),o.textContent=String(r)):r instanceof HTMLElement?o=r:(o=document.createDocumentFragment(),Ql(r,o)),!o)continue;let a=document.createElement("bim-table-cell");a.append(o),a.column=n,this._columnNames.indexOf(n)===0&&!this.isHeader&&(a.style.marginLeft=`${(this.table.noIndentation?0:e)+.75}rem`);let l=this._columnNames.indexOf(n);a.setAttribute("data-column-index",String(l)),a.toggleAttribute("data-no-indentation",l===0&&this.table.noIndentation),a.toggleAttribute("data-cell-header",this.isHeader),a.rowData=this.data,this.table.dispatchEvent(new CustomEvent("cellcreated",{detail:{cell:a}})),i.push(a)}return this.style.gridTemplateAreas=`"${this.table.selectableRows?"Selection":""} ${this._columnNames.join(" ")}"`,this.style.gridTemplateColumns=`${this.table.selectableRows?"1.6rem":""} ${this._columnWidths.join(" ")}`,ct`
      ${!this.isHeader&&this.table.selectableRows?ct`<bim-checkbox
            @change=${this.onSelectionChange}
            .checked=${this._isSelected}
            style="align-self: center; justify-self: center"
          ></bim-checkbox>`:null}
      ${i}
      <slot></slot>
    `}render(){return ct`${this._intersecting?this.compute():ct``}`}};uA.styles=ri`
    :host {
      position: relative;
      grid-area: Data;
      display: grid;
      min-height: 2.25rem;
      transition: all 0.15s;
    }

    ::slotted(.branch.branch-vertical) {
      top: 50%;
      bottom: 0;
    }

    :host([selected]) {
      background-color: color-mix(
        in lab,
        var(--bim-ui_bg-contrast-20) 30%,
        var(--bim-ui_main-base) 10%
      );
    }
  `;var Ra=uA;lc([Be({type:Boolean,reflect:!0})],Ra.prototype,"selected");lc([Be({attribute:!1})],Ra.prototype,"columns");lc([Be({attribute:!1})],Ra.prototype,"hiddenColumns");lc([Be({attribute:!1})],Ra.prototype,"data");lc([Be({type:Boolean,attribute:"is-header",reflect:!0})],Ra.prototype,"isHeader");lc([ic()],Ra.prototype,"_intersecting");var TN=Object.defineProperty,PN=Object.getOwnPropertyDescriptor,Fs=(s,e,t,i)=>{for(var n=i>1?void 0:i?PN(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&TN(e,t,n),n},pA=class extends Xt{constructor(){super(...arguments),this._columnsChange=new Event("columnschange"),this._filteredData=[],this.headersHidden=!1,this.minColWidth="4rem",this._columns=[],this._textDelimiters={comma:",",tab:"	"},this._queryString=null,this._data=[],this.expanded=!1,this.preserveStructureOnFilter=!1,this.indentationInText=!1,this.dataTransform={},this.selectableRows=!1,this.selection=new Set,this.noIndentation=!1,this.loading=!1,this._errorLoading=!1,this._onColumnsHidden=new Event("columnshidden"),this._hiddenColumns=[],this.loadingErrorElement=null,this._stringFilterFunction=(e,t)=>Object.values(t.data).some(i=>String(i).toLowerCase().includes(e.toLowerCase())),this._queryFilterFunction=(e,t)=>{let i=!1,n=bv(e)??[];for(let r of n){if("queries"in r){i=!1;break}let{condition:o,value:a}=r,{key:l}=r;if(l.startsWith("[")&&l.endsWith("]")){let c=l.replace("[","").replace("]","");l=c,i=Object.keys(t.data).filter(d=>d.includes(c)).map(d=>qx(t.data[d],o,a)).some(d=>d)}else i=qx(t.data[l],o,a);if(!i)break}return i}}set columns(e){let t=[];for(let i of e){let n=typeof i=="string"?{name:i,width:`minmax(${this.minColWidth}, 1fr)`}:i;t.push(n)}this._columns=t,this.computeMissingColumns(this.data),this.dispatchEvent(this._columnsChange)}get columns(){return this._columns}get _headerRowData(){let e={};for(let t of this.columns)if(typeof t=="string")e[t]=t;else{let{name:i}=t;e[i]=i}return e}get value(){return this._filteredData}set queryString(e){this.toggleAttribute("data-processing",!0),this._queryString=e&&e.trim()!==""?e.trim():null,this.updateFilteredData(),this.toggleAttribute("data-processing",!1)}get queryString(){return this._queryString}set data(e){this._data=e,this.updateFilteredData(),this.computeMissingColumns(e)&&(this.columns=this._columns)}get data(){return this._data}get dataAsync(){return new Promise(e=>{setTimeout(()=>{e(this.data)})})}set hiddenColumns(e){this._hiddenColumns=e,setTimeout(()=>{this.dispatchEvent(this._onColumnsHidden)})}get hiddenColumns(){return this._hiddenColumns}updateFilteredData(){this.queryString?(bv(this.queryString)?(this.filterFunction=this._queryFilterFunction,this._filteredData=this.filter(this.queryString)):(this.filterFunction=this._stringFilterFunction,this._filteredData=this.filter(this.queryString)),this.preserveStructureOnFilter&&(this._expandedBeforeFilter===void 0&&(this._expandedBeforeFilter=this.expanded),this.expanded=!0)):(this.preserveStructureOnFilter&&this._expandedBeforeFilter!==void 0&&(this.expanded=this._expandedBeforeFilter,this._expandedBeforeFilter=void 0),this._filteredData=this.data)}computeMissingColumns(e){let t=!1;for(let i of e){let{children:n,data:r}=i;for(let o in r)this._columns.map(a=>typeof a=="string"?a:a.name).includes(o)||(this._columns.push({name:o,width:`minmax(${this.minColWidth}, 1fr)`}),t=!0);if(n){let o=this.computeMissingColumns(n);o&&!t&&(t=o)}}return t}generateText(e="comma",t=this.value,i="",n=!0){let r=this._textDelimiters[e],o="",a=this.columns.map(l=>l.name);if(n){this.indentationInText&&(o+=`Indentation${r}`);let l=`${a.join(r)}
`;o+=l}for(let[l,c]of t.entries()){let{data:d,children:h}=c,u=this.indentationInText?`${i}${l+1}${r}`:"",p=a.map(m=>d[m]??""),f=`${u}${p.join(r)}
`;o+=f,h&&(o+=this.generateText(e,c.children,`${i}${l+1}.`,!1))}return o}get csv(){return this.generateText("comma")}get tsv(){return this.generateText("tab")}applyDataTransform(e){let t={};for(let i of Object.keys(this.dataTransform)){let n=this.columns.find(r=>r.name===i);n&&n.forceDataTransform&&(i in e||(e[i]=""))}for(let i in e){let n=this.dataTransform[i];n?t[i]=n(e[i],e):t[i]=e[i]}return t}downloadData(e="BIM Table Data",t="json"){let i=null;if(t==="json"&&(i=new File([JSON.stringify(this.value,void 0,2)],`${e}.json`)),t==="csv"&&(i=new File([this.csv],`${e}.csv`)),t==="tsv"&&(i=new File([this.tsv],`${e}.tsv`)),!i)return;let n=document.createElement("a");n.href=URL.createObjectURL(i),n.download=i.name,n.click(),URL.revokeObjectURL(n.href)}getRowIndentation(e,t=this.value,i=0){for(let n of t){if(n.data===e)return i;if(n.children){let r=this.getRowIndentation(e,n.children,i+1);if(r!==null)return r}}return null}getGroupIndentation(e,t=this.value,i=0){for(let n of t){if(n===e)return i;if(n.children){let r=this.getGroupIndentation(e,n.children,i+1);if(r!==null)return r}}return null}connectedCallback(){super.connectedCallback(),this.dispatchEvent(new Event("connected"))}disconnectedCallback(){super.disconnectedCallback(),this.dispatchEvent(new Event("disconnected"))}loadData(e=!1){return ie(this,null,function*(){if(this._filteredData.length!==0&&!e||!this.loadFunction)return!1;this.loading=!0;try{let t=yield this.loadFunction();return this.data=t,this.loading=!1,this._errorLoading=!1,!0}catch(t){return this.loading=!1,this._filteredData.length!==0||(t instanceof Error&&this.loadingErrorElement&&t.message.trim()!==""&&(this.loadingErrorElement.textContent=t.message),this._errorLoading=!0),!1}})}filter(e,t=this.filterFunction??this._stringFilterFunction,i=this.data){let n=[];for(let r of i)if(t(e,r)){if(this.preserveStructureOnFilter){let o={data:r.data};if(r.children){let a=this.filter(e,t,r.children);a.length&&(o.children=a)}n.push(o)}else if(n.push({data:r.data}),r.children){let o=this.filter(e,t,r.children);n.push(...o)}}else if(r.children){let o=this.filter(e,t,r.children);this.preserveStructureOnFilter&&o.length?n.push({data:r.data,children:o}):n.push(...o)}return n}get _missingDataElement(){return this.querySelector("[slot='missing-data']")}render(){if(this.loading)return yN();if(this._errorLoading)return ct`<slot name="error-loading"></slot>`;if(this._filteredData.length===0&&this._missingDataElement)return ct`<slot name="missing-data"></slot>`;let e=document.createElement("bim-table-row");e.table=this,e.isHeader=!0,e.data=this._headerRowData,e.style.gridArea="Header",e.style.position="sticky",e.style.top="0",e.style.zIndex="5";let t=document.createElement("bim-table-children");return t.table=this,t.data=this.value,t.style.gridArea="Body",t.style.backgroundColor="transparent",ct`
      <div class="parent">
        ${this.headersHidden?null:e} ${_N()}
        <div style="overflow-x: hidden; grid-area: Body">${t}</div>
      </div>
    `}};pA.styles=[Ao.scrollbar,ri`
      :host {
        position: relative;
        overflow: auto;
        display: block;
        pointer-events: auto;
      }

      :host(:not([data-processing])) .loader {
        display: none;
      }

      .parent {
        display: grid;
        grid-template:
          "Header" auto
          "Processing" auto
          "Body" 1fr
          "Footer" auto;
        overflow: auto;
        height: 100%;
      }

      .parent > bim-table-row[is-header] {
        color: var(--bim-table_header--c, var(--bim-ui_bg-contrast-100));
        background-color: var(
          --bim-table_header--bgc,
          var(--bim-ui_bg-contrast-20)
        );
      }

      .controls {
        display: flex;
        gap: 0.375rem;
        flex-wrap: wrap;
        margin-bottom: 0.5rem;
      }
    `];var hs=pA;Fs([ic()],hs.prototype,"_filteredData",2);Fs([Be({type:Boolean,attribute:"headers-hidden",reflect:!0})],hs.prototype,"headersHidden",2);Fs([Be({type:String,attribute:"min-col-width",reflect:!0})],hs.prototype,"minColWidth",2);Fs([Be({type:Array,attribute:!1})],hs.prototype,"columns",1);Fs([Be({type:Array,attribute:!1})],hs.prototype,"data",1);Fs([Be({type:Boolean,reflect:!0})],hs.prototype,"expanded",2);Fs([Be({type:Boolean,reflect:!0,attribute:"selectable-rows"})],hs.prototype,"selectableRows",2);Fs([Be({attribute:!1})],hs.prototype,"selection",2);Fs([Be({type:Boolean,attribute:"no-indentation",reflect:!0})],hs.prototype,"noIndentation",2);Fs([Be({type:Boolean,reflect:!0})],hs.prototype,"loading",2);Fs([ic()],hs.prototype,"_errorLoading",2);var ON=Object.defineProperty,MN=Object.getOwnPropertyDescriptor,_f=(s,e,t,i)=>{for(var n=i>1?void 0:i?MN(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&ON(e,t,n),n},fA=class extends Xt{constructor(){super(...arguments),this._defaultName="__unnamed__",this.name=this._defaultName,this._hidden=!1}set hidden(e){this._hidden=e,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}connectedCallback(){super.connectedCallback();let{parentElement:e}=this;if(e&&this.name===this._defaultName){let t=[...e.children].indexOf(this);this.name=`${this._defaultName}${t}`}}render(){return ct` <slot></slot> `}};fA.styles=ri`
    :host {
      display: block;
      height: 100%;
    }

    :host([hidden]) {
      display: none;
    }
  `;var os=fA;_f([Be({type:String,reflect:!0})],os.prototype,"name",2);_f([Be({type:String,reflect:!0})],os.prototype,"label",2);_f([Be({type:String,reflect:!0})],os.prototype,"icon",2);_f([Be({type:Boolean,reflect:!0})],os.prototype,"hidden",1);var RN=Object.defineProperty,DN=Object.getOwnPropertyDescriptor,cc=(s,e,t,i)=>{for(var n=i>1?void 0:i?DN(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&RN(e,t,n),n},mA=class extends Xt{constructor(){super(...arguments),this._switchers=[],this.bottom=!1,this.switchersHidden=!1,this.floating=!1,this.switchersFull=!1,this.onTabHiddenChange=e=>{let t=e.target;t instanceof os&&!t.hidden&&(t.removeEventListener("hiddenchange",this.onTabHiddenChange),this.tab=t.name,t.addEventListener("hiddenchange",this.onTabHiddenChange))}}set tab(e){this._tab=e;let t=[...this.children],i=t.find(n=>n instanceof os&&n.name===e);for(let n of t){if(!(n instanceof os))continue;n.hidden=i!==n;let r=this.getTabSwitcher(n.name);r&&r.toggleAttribute("data-active",!n.hidden)}}get tab(){return this._tab}getTabSwitcher(e){return this._switchers.find(t=>t.getAttribute("data-name")===e)}createSwitchers(){this._switchers=[];for(let e of this.children){if(!(e instanceof os))continue;let t=document.createElement("div");t.addEventListener("click",()=>{this.tab===e.name?this.toggleAttribute("tab",!1):this.tab=e.name}),t.setAttribute("data-name",e.name),t.className="switcher";let i=document.createElement("bim-label");i.textContent=e.label??"",i.icon=e.icon,t.append(i),this._switchers.push(t)}}onSlotChange(e){this.createSwitchers();let t=e.target.assignedElements(),i=t.find(n=>n instanceof os?this.tab?n.name===this.tab:!n.hidden:!1);i&&i instanceof os&&(this.tab=i.name);for(let n of t){if(!(n instanceof os)){n.remove();continue}n.removeEventListener("hiddenchange",this.onTabHiddenChange),i!==n&&(n.hidden=!0),n.addEventListener("hiddenchange",this.onTabHiddenChange)}}render(){return ct`
      <div class="parent">
        <div class="switchers">${this._switchers}</div>
        <div class="content">
          <slot @slotchange=${this.onSlotChange}></slot>
        </div>
      </div>
    `}};mA.styles=[Ao.scrollbar,ri`
      * {
        box-sizing: border-box;
      }

      :host {
        background-color: var(--bim-ui_bg-base);
        display: block;
        overflow: auto;
      }

      .parent {
        display: grid;
        grid-template: "switchers" auto "content" 1fr;
        height: 100%;
      }

      :host([bottom]) .parent {
        grid-template: "content" 1fr "switchers" auto;
      }

      .switchers {
        display: flex;
        height: 2.25rem;
        font-weight: 600;
        grid-area: switchers;
      }

      .switcher {
        --bim-label--c: var(--bim-ui_bg-contrast-80);
        background-color: var(--bim-ui_bg-base);
        cursor: pointer;
        pointer-events: auto;
        padding: 0rem 0.75rem;
        display: flex;
        justify-content: center;
        transition: all 0.15s;
      }

      :host([switchers-full]) .switcher {
        flex: 1;
      }

      .switcher:hover,
      .switcher[data-active] {
        --bim-label--c: var(--bim-ui_main-contrast);
        background-color: var(--bim-ui_main-base);
      }

      .switchers bim-label {
        pointer-events: none;
      }

      :host([switchers-hidden]) .switchers {
        display: none;
      }

      .content {
        grid-area: content;
        overflow: auto;
      }

      :host(:not([bottom])) .content {
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([bottom]) .content {
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host(:not([tab])) .content {
        display: none;
      }

      :host([floating]) {
        background-color: transparent;
      }

      :host([floating]) .switchers {
        justify-self: center;
        overflow: auto;
      }

      :host([floating]:not([bottom])) .switchers {
        border-radius: var(--bim-ui_size-2xs) var(--bim-ui_size-2xs) 0 0;
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
        border-left: 1px solid var(--bim-ui_bg-contrast-20);
        border-right: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating][bottom]) .switchers {
        border-radius: 0 0 var(--bim-ui_size-2xs) var(--bim-ui_size-2xs);
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
        border-left: 1px solid var(--bim-ui_bg-contrast-20);
        border-right: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating]:not([tab])) .switchers {
        border-radius: var(--bim-ui_size-2xs);
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating][bottom]:not([tab])) .switchers {
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating]) .content {
        border: 1px solid var(--bim-ui_bg-contrast-20);
        border-radius: var(--bim-ui_size-2xs);
        background-color: var(--bim-ui_bg-base);
      }
    `];var Da=mA;cc([ic()],Da.prototype,"_switchers",2);cc([Be({type:Boolean,reflect:!0})],Da.prototype,"bottom",2);cc([Be({type:Boolean,attribute:"switchers-hidden",reflect:!0})],Da.prototype,"switchersHidden",2);cc([Be({type:Boolean,reflect:!0})],Da.prototype,"floating",2);cc([Be({type:String,reflect:!0})],Da.prototype,"tab",1);cc([Be({type:Boolean,attribute:"switchers-full",reflect:!0})],Da.prototype,"switchersFull",2);var Xx=s=>s??Di,LN=Object.defineProperty,FN=Object.getOwnPropertyDescriptor,Pr=(s,e,t,i)=>{for(var n=i>1?void 0:i?FN(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&LN(e,t,n),n},gA=class extends Xt{constructor(){super(...arguments),this._inputTypes=["date","datetime-local","email","month","password","search","tel","text","time","url","week","area"],this.value="",this.vertical=!1,this._type="text",this.onValueChange=new Event("input")}set type(e){this._inputTypes.includes(e)&&(this._type=e)}get type(){return this._type}get query(){return bv(this.value)}onInputChange(e){e.stopPropagation();let t=e.target;clearTimeout(this._debounceTimeoutID),this._debounceTimeoutID=setTimeout(()=>{this.value=t.value,this.dispatchEvent(this.onValueChange)},this.debounce)}focus(){setTimeout(()=>{var e;let t=(e=this.shadowRoot)==null?void 0:e.querySelector("input");t?.focus()})}render(){return ct`
      <bim-input
        .name=${this.name}
        .icon=${this.icon}
        .label=${this.label}
        .vertical=${this.vertical}
      >
        ${this.type==="area"?ct` <textarea
              aria-label=${this.label||this.name||"Text Input"}
              .value=${this.value}
              .rows=${this.rows??5}
              placeholder=${Xx(this.placeholder)}
              @input=${this.onInputChange}
            ></textarea>`:ct` <input
              aria-label=${this.label||this.name||"Text Input"}
              .type=${this.type}
              .value=${this.value}
              placeholder=${Xx(this.placeholder)}
              @input=${this.onInputChange}
            />`}
      </bim-input>
    `}};gA.styles=[Ao.scrollbar,ri`
      :host {
        --bim-input--bgc: var(--bim-ui_bg-contrast-20);
        flex: 1;
        display: block;
      }

      input,
      textarea {
        font-family: inherit;
        background-color: transparent;
        border: none;
        width: 100%;
        padding: var(--bim-ui_size-3xs);
        color: var(--bim-text-input--c, var(--bim-ui_bg-contrast-100));
      }

      input {
        outline: none;
        height: 100%;
        padding: 0 var(--bim-ui_size-3xs); /* Override padding */
        border-radius: var(--bim-text-input--bdrs, var(--bim-ui_size-4xs));
      }

      textarea {
        line-height: 1.1rem;
        resize: vertical;
      }

      :host(:focus) {
        --bim-input--olc: var(--bim-ui_accent-base);
      }

      /* :host([disabled]) {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
    } */
    `];var or=gA;Pr([Be({type:String,reflect:!0})],or.prototype,"icon",2);Pr([Be({type:String,reflect:!0})],or.prototype,"label",2);Pr([Be({type:String,reflect:!0})],or.prototype,"name",2);Pr([Be({type:String,reflect:!0})],or.prototype,"placeholder",2);Pr([Be({type:String,reflect:!0})],or.prototype,"value",2);Pr([Be({type:Boolean,reflect:!0})],or.prototype,"vertical",2);Pr([Be({type:Number,reflect:!0})],or.prototype,"debounce",2);Pr([Be({type:Number,reflect:!0})],or.prototype,"rows",2);Pr([Be({type:String,reflect:!0})],or.prototype,"type",1);var kN=Object.defineProperty,NN=Object.getOwnPropertyDescriptor,bA=(s,e,t,i)=>{for(var n=i>1?void 0:i?NN(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&kN(e,t,n),n},vA=class extends Xt{constructor(){super(...arguments),this.rows=2,this._vertical=!1}set vertical(e){this._vertical=e,this.updateChildren()}get vertical(){return this._vertical}updateChildren(){let e=this.children;for(let t of e)this.vertical?t.setAttribute("label-hidden",""):t.removeAttribute("label-hidden")}render(){return ct`
      <style>
        .parent {
          grid-auto-flow: ${this.vertical?"row":"column"};
          grid-template-rows: repeat(${this.rows}, 1fr);
        }
      </style>
      <div class="parent">
        <slot @slotchange=${this.updateChildren}></slot>
      </div>
    `}};vA.styles=ri`
    .parent {
      display: grid;
      gap: 0.25rem;
    }

    ::slotted(bim-button[label]:not([vertical])) {
      --bim-button--jc: flex-start;
    }

    ::slotted(bim-button) {
      --bim-label--c: var(--bim-ui_bg-contrast-80);
    }
  `;var wf=vA;bA([Be({type:Number,reflect:!0})],wf.prototype,"rows",2);bA([Be({type:Boolean,reflect:!0})],wf.prototype,"vertical",1);var UN=Object.defineProperty,BN=Object.getOwnPropertyDescriptor,Ef=(s,e,t,i)=>{for(var n=i>1?void 0:i?BN(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&UN(e,t,n),n},yA=class extends Xt{constructor(){super(...arguments),this._vertical=!1,this._labelHidden=!1}set vertical(e){this._vertical=e,this.updateChildren()}get vertical(){return this._vertical}set labelHidden(e){this._labelHidden=e,this.updateChildren()}get labelHidden(){return this._labelHidden}updateChildren(){let e=this.children;for(let t of e)t instanceof wf&&(t.vertical=this.vertical),t.toggleAttribute("label-hidden",this.vertical)}render(){return ct`
      <div class="parent">
        <div class="children">
          <slot @slotchange=${this.updateChildren}></slot>
        </div>
        ${!this.labelHidden&&(this.label||this.icon)?ct`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
      </div>
    `}};yA.styles=ri`
    :host {
      --bim-label--fz: var(--bim-ui_size-xs);
      --bim-label--c: var(--bim-ui_bg-contrast-60);
      display: block;
      flex: 1;
    }

    :host(:not([vertical])) ::slotted(bim-button[vertical]) {
      --bim-icon--fz: var(--bim-ui_size-5xl);
      min-height: 3.75rem;
    }

    ::slotted(bim-button) {
      --bim-label--c: var(--bim-ui_bg-contrast-80);
    }

    .parent {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      align-items: center;
      padding: 0.5rem;
      height: 100%;
      box-sizing: border-box;
      justify-content: space-between;
    }

    :host([vertical]) .parent {
      flex-direction: row-reverse;
    }

    :host([vertical]) .parent > bim-label {
      writing-mode: tb;
    }

    .children {
      display: flex;
      gap: 0.25rem;
    }

    :host([vertical]) .children {
      flex-direction: column;
    }
  `;var hc=yA;Ef([Be({type:String,reflect:!0})],hc.prototype,"label",2);Ef([Be({type:String,reflect:!0})],hc.prototype,"icon",2);Ef([Be({type:Boolean,reflect:!0})],hc.prototype,"vertical",1);Ef([Be({type:Boolean,attribute:"label-hidden",reflect:!0})],hc.prototype,"labelHidden",1);var zN=Object.defineProperty,VN=Object.getOwnPropertyDescriptor,Dv=(s,e,t,i)=>{for(var n=i>1?void 0:i?VN(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&zN(e,t,n),n},_A=class extends Xt{constructor(){super(...arguments),this.labelsHidden=!1,this._vertical=!1,this._hidden=!1}set vertical(e){this._vertical=e,this.updateSections()}get vertical(){return this._vertical}set hidden(e){this._hidden=e,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}updateSections(){let e=this.children;for(let t of e)t instanceof hc&&(t.labelHidden=this.vertical&&!hd.config.sectionLabelOnVerticalToolbar,t.vertical=this.vertical)}render(){return ct`
      <div class="parent">
        <slot @slotchange=${this.updateSections}></slot>
      </div>
    `}};_A.styles=ri`
    :host {
      --bim-button--bgc: transparent;
      background-color: var(--bim-ui_bg-base);
      border-radius: var(--bim-ui_size-2xs);
      display: block;
    }

    :host([hidden]) {
      display: none;
    }

    .parent {
      display: flex;
      width: min-content;
      pointer-events: auto;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    :host([vertical]) {
      width: min-content;
      border-radius: var(--bim-ui_size-2xs);
      border: 1px solid var(--bim-ui_bg-contrast-20);
    }

    ::slotted(bim-toolbar-section:not(:last-child)) {
      border-right: 1px solid var(--bim-ui_bg-contrast-20);
      border-bottom: none;
    }

    :host([vertical]) ::slotted(bim-toolbar-section:not(:last-child)) {
      border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      border-right: none;
    }
  `;var Cf=_A;Dv([Be({type:String,reflect:!0})],Cf.prototype,"icon",2);Dv([Be({type:Boolean,attribute:"labels-hidden",reflect:!0})],Cf.prototype,"labelsHidden",2);Dv([Be({type:Boolean,reflect:!0})],Cf.prototype,"vertical",1);var jN=Object.defineProperty,HN=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&jN(e,t,n),n},wA=class extends Xt{constructor(){super(),this._onResize=new Event("resize"),new ResizeObserver(()=>{setTimeout(()=>{this.dispatchEvent(this._onResize)})}).observe(this)}render(){return ct`
      <div class="parent">
        <slot></slot>
      </div>
    `}};wA.styles=ri`
    :host {
      display: grid;
      min-width: 0;
      min-height: 0;
      height: 100%;
    }

    .parent {
      overflow: hidden;
      position: relative;
    }
  `;var EA=wA;HN([Be({type:String,reflect:!0})],EA.prototype,"name");var CA="important",GN=" !"+CA,A9=wS(class extends af{constructor(s){var e;if(super(s),s.type!==_S.ATTRIBUTE||s.name!=="style"||((e=s.strings)==null?void 0:e.length)>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(s){return Object.keys(s).reduce((e,t)=>{let i=s[t];return i==null?e:e+`${t=t.includes("-")?t:t.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${i};`},"")}update(s,[e]){let{style:t}=s.element;if(this.ft===void 0)return this.ft=new Set(Object.keys(e)),this.render(e);for(let i of this.ft)e[i]==null&&(this.ft.delete(i),i.includes("-")?t.removeProperty(i):t[i]=null);for(let i in e){let n=e[i];if(n!=null){this.ft.add(i);let r=typeof n=="string"&&n.endsWith(GN);i.includes("-")||r?t.setProperty(i,r?n.slice(0,-11):n,r?CA:""):t[i]=n}}return Pa}});var AA=Cs(SA());var kv=class{constructor(){this.opacity=.25,this.preserveColors=!1}},xf=(()=>{let e=class e extends mn{constructor(i){super(i),this.enabled=!0,this._transparentFragments={},this._settings=new kv,this._transparentElements=[],this._isolatedElements=[],this._transparentMaterial=new io({transparent:!0,opacity:this._settings.opacity});let n=this.components.get(Hi);this._streamLoader=i.get(Ds),this._idMap=i.get(gn),this._world=n.list.values().next().value,this._initEventListeners()}get(){return e.uuid}set settings(i){this._settings=i}set transparentElements(i){this._transparentElements=i,this._isolatedElements=[],this._updateView()}setIsolatedElements(i){return ie(this,null,function*(){if(!i.length){this.setAllNotTransparent();return}this._transparentElements=[],this._isolatedElements=i,this._updateView()})}setAllNotTransparent(i=this._settings.opacity){if(this._transparentFragments[i]!==void 0){this._isolatedElements=[],this._transparentElements=[];for(let[n,r]of this._transparentFragments[i])r.setVisibility(!1)}}disposeOpacityLevel(i,n){let r=Array.from(this._transparentFragments[n]).map(o=>o[0]);for(let o of r){let a=this._transparentFragments[n].get(o);a!==void 0&&(this._world.scene.three.remove(a.mesh),this._world.meshes.delete(a.mesh),i.destroy(a.mesh),a.dispose(),this._transparentFragments[n].delete(o))}}disposeAllOpacityLevels(i){for(let n in this._transparentFragments)this.disposeOpacityLevel(i,Number(n))}_updateView(){if(this._transparentElements.length===0&&this._isolatedElements.length===0){this.setAllNotTransparent();return}let i={};this._transparentElements.length?i=this._idMap?.getFragmentIDMap(this._transparentElements):this._isolatedElements.length&&(i=this._idMap?.getInverseFragmentIDMap(this._isolatedElements)),this._appliedMap={opacityLevel:this._settings.opacity,fragmentIdMap:i,transparent:!0},this._applyTransparency()}_applyTransparency(){if(this._appliedMap===void 0)return;let{opacityLevel:i,fragmentIdMap:n,transparent:r}=this._appliedMap;if(!this._transparentFragments[i]){console.error("Opacity level "+i+" not found");return}for(let o in n)if(this._transparentFragments[i].has(o)){let a=[...n[o]],l=this._transparentFragments[i].get(o);if(l===void 0)continue;l.setVisibility(r,a)}else console.error("Fragment "+o+" not found")}_createTransparentFragments(i,n){this._transparentFragments[n]===void 0&&(this._transparentFragments[n]=new Map);for(let r of i){let o=new Array;for(let d of r.mesh.material)o[o.length]=this._settings.preserveColors?this._copyToTransparentMaterial(d,n):this._transparentMaterial;let a=new sa(r.mesh.geometry,o,1),l=[];for(let d of r.ids){let h=r.get(d),u={id:h.id,transforms:[],colors:[]};for(let p of h.transforms)u.transforms[u.transforms.length]=p.clone();if(h.colors!==void 0)for(let p of h.colors)u.colors[u.colors.length]=p.clone();l[l.length]=u}a.add(l),a.mesh.frustumCulled=!1,a.group=r.group,a.setVisibility(!1),this._transparentFragments[n].set(r.id,a);let c=this._world.renderer;c&&c.postproduction.customEffects.excludedMeshes.push(a.mesh),this._world.scene.three.add(a.mesh),this._world.meshes.add(a.mesh)}}_copyToTransparentMaterial(i,n){let r=new io;return r.copy(i),r.transparent=!0,r.opacity=n,r}_initEventListeners(){this._streamLoader.onFragmentsLoaded.add(n=>{this._createTransparentFragments(n,this._settings.opacity),this._updateView()}),this.components.get(Gi).onFragmentsDisposed.add(n=>{})}};e.uuid="347562cd-76da-4c24-849f-a5175d658e0b";let s=e;return s})();var yn=(()=>{let e=class e{constructor(){this._components=new Dg,this._world=Ft(void 0),this._settings=new qt}destroy(){return ie(this,null,function*(){let i=this._components;i!==void 0&&this._world()!==void 0&&(i.get(gn).dispose(),yield this._loader?.dispose(),this._highlighter?.dispose(),this._loader=void 0,this._highlighter=void 0,this._world.set(void 0)),this._removeStats(),this._components=new Dg})}set settings(i){this._settings=i,this._highlighter!==void 0&&(this._highlighter.settings=i.highlighter),this._loader!==void 0&&(this._loader.settings=i.loading),this._updateSettings()}get world(){return this._world}get components(){return this._components}initViewer(i){let n=this._components,o=n.get(Hi).create(),a=tc.create(()=>ct`
        <bim-viewport>
          <bim-grid floating></bim-grid>
        </bim-viewport>
      `);hd.init(),o.scene=new ju(n),o.scene.setup(),o.scene.three.background=null,o.renderer=new si(n,i);let{postproduction:l}=o.renderer;o.camera=new aa(n),this._grid=n.get(Hu).create(o),this._grid.material.uniforms.uColor.value=new zt(4342338),this._grid.material.uniforms.uSize1.value=2,this._grid.material.uniforms.uSize2.value=8,this._grid.visible=this._settings.visibility.showGrid;let c=()=>{o.renderer?.resize(),o.camera.updateAspect()};return a.addEventListener("resize",c),n.init(),l.enabled=!0,l.customEffects.excludedMeshes.push(this._grid.three),l.setPasses({custom:!0,ao:!0,gamma:!0}),l.customEffects.lineColor=1513756,l.customEffects.outlineEnabled=!0,this._highlighter=n.get(Gl),this._highlighter.settings=this._settings.highlighter,o.camera.controls.restThreshold=.25,this._world.update(()=>o),n}loadStream(i){return ie(this,null,function*(){if(this._world()===void 0)throw new Error("World not defined");this._loader=this._components.get(Ea),this._loader.settings=this._settings.loading,yield this._loader.loadStream(i)})}resourceLoad(o,a){return ie(this,arguments,function*(i,n,r=[]){if(this._world()===void 0)throw new Error("World not defined");this._loader=this._components.get(Ea),this._loader.settings=this._settings.loading,yield this._loader.resourceLoad(i,n,r)})}unloadAll(){return ie(this,null,function*(){let i=this.components.get(xf),n=this.components.get(vE);yield i.disposeAllOpacityLevels(n),yield this._loader?.unloadAll()})}setStats(){let i=this._world();if(this._settings.visibility.showStats&&i!==void 0){let n=new AA.default;n.dom.id="bim-stats",n.showPanel(2),document.body.append(n.dom),n.dom.style.left="0px",n.dom.style.zIndex="unset",i.renderer?.onBeforeUpdate.add(()=>n.begin()),i.renderer?.onAfterUpdate.add(()=>n.end())}else this._removeStats()}setGrid(){this._grid!==void 0&&(this._grid.visible=this._settings.visibility.showGrid)}setNearPlane(){let n=this._world()?.camera.three;n!==void 0&&(n.near=this._settings.nearPlane,n.updateProjectionMatrix())}fitModel(){let i=this.world();if(i===void 0)throw new Error("World not set");let{camera:n}=i;n instanceof aa&&i.meshes.size>0&&n.fit(i.meshes,.5)}_updateSettings(){this.setStats(),this.setGrid(),this.setNearPlane()}_removeStats(){let i=document.getElementById("bim-stats");i&&document.body.removeChild(i)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=yr({token:e,factory:e.\u0275fac,providedIn:"root"});let s=e;return s})();function WN(s,e){if(s&1){let t=mt();He(0,"bim-button",3),rt("click",function(){pt(t);let n=Ze();return ft(n.toggleGridVisibility())}),We()}if(s&2){let t=Ze();Le("active",t.settings.visibility.showGrid)}}function YN(s,e){if(s&1){let t=mt();He(0,"bim-button",4),rt("click",function(){pt(t);let n=Ze();return ft(n.fitModel())}),We()}}var IA=(()=>{let e=class e{constructor(){this._service=qe(yn),this.settings=new qt}toggleGridVisibility(){this.settings.visibility.showGrid=!this.settings.visibility.showGrid,this._service.settings=this.settings}fitModel(){this._service.fitModel()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-visibility"]],inputs:{settings:"settings"},standalone:!0,features:[st],decls:3,vars:2,consts:[["label","Visibility","icon","mdi:eye-outline"],["label","Show grid","icon","simple-icons:traefikmesh",3,"active","click",4,"ngIf"],["label","Fit model","icon","material-symbols:fit-screen-rounded",3,"click",4,"ngIf"],["label","Show grid","icon","simple-icons:traefikmesh",3,"click","active"],["label","Fit model","icon","material-symbols:fit-screen-rounded",3,"click"]],template:function(n,r){n&1&&(He(0,"bim-toolbar-section",0),dt(1,WN,1,1,"bim-button",1)(2,YN,1,0,"bim-button",2),We()),n&2&&(Ge(),Le("ngIf",r.settings.visibility.ui.toolbar.visibility.showHideToggleGridOption),Ge(),Le("ngIf",r.settings.visibility.ui.toolbar.visibility.showFitModelOption))},dependencies:[at,bt]});let s=e;return s})();var qN=new Ii({color:15658734,side:2}),XN=new Mn({color:1513756,linewidth:5}),KN=new Ii({color:1513756,opacity:.2,side:2,transparent:!0}),TA=(()=>{let e=class e{constructor(){this._service=qe(yn),this.clipperEnabled=Ft(!1),this.settings=new qt,Gt(()=>{this._world=this._service.world(),this._world&&(this._clipper=this._service.components.get(wE),this._edges=this._service.components.get(Ul),this._clipper.Type=go,this._clipper.size=1,this._clipStyle=this._edges.styles.create("Outlines",this._world.meshes,this._world,XN,qN,KN),this._edges.update(!0))})}ngAfterViewInit(){so.getInstance().events.addListener("shortPressedLeft",()=>ie(this,null,function*(){this.clipperEnabled()&&this._clipper!==void 0&&this._world!==void 0&&(this._clipper.create(this._world),this._clipper.list.forEach(n=>n.updateFill()),this.clipperEnabled.set(!1))}))}ngOnDestroy(){this._clipStyle=void 0,this.clipperEnabled.set(!1)}toggleAdd(){this.clipperEnabled.set(!this.clipperEnabled())}clear(){this._clipper?.deleteAll(),this.clipperEnabled.set(!1)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-sections"]],inputs:{settings:"settings"},standalone:!0,features:[st],decls:3,vars:1,consts:[["label","Sections","icon","ant-design:scissor-outlined"],["label","Add","icon","material-symbols:add",3,"click","active"],["label","Clear","icon","material-symbols-light:delete-outline",3,"click"]],template:function(n,r){n&1&&(He(0,"bim-toolbar-section",0)(1,"bim-button",1),rt("click",function(){return r.toggleAdd()}),We(),He(2,"bim-button",2),rt("click",function(){return r.clear()}),We()()),n&2&&(Ge(),Le("active",r.clipperEnabled()))},dependencies:[at]});let s=e;return s})();var PA=(()=>{let e=class e{constructor(){this._service=qe(yn),this.settings=new qt,Gt(()=>{this._service.world()&&(this.lengthMeasure=this._service.components.get(fa),this.lengthMeasure.world=this._service.world(),this.areaMeasure=this._service.components.get(qC),this.areaMeasure.world=this._service.world(),this.angleMeasure=this._service.components.get(KC),this.angleMeasure.world=this._service.world())})}ngAfterViewInit(){so.getInstance().events.addListener("shortPressedLeft",()=>{this.lengthMeasure?.enabled?this.lengthMeasure?.create():this.areaMeasure?.enabled?this.areaMeasure?.create():this.angleMeasure?.enabled&&this.angleMeasure?.create()}),LE.getInstance().events.addListener("shortPressedKey",r=>{r!=="Enter"&&this.deleteAll()})}toggleLengthMeasure(){if(this.lengthMeasure===void 0)throw new Error("Length measure not available");this._disableAll(),this.lengthMeasure.enabled=!0}toggleAreaMeasure(){if(this.areaMeasure===void 0)throw new Error("Area measure not available");this._disableAll(),this.areaMeasure.enabled=!0}toggleAngleMeasure(){if(this.angleMeasure===void 0)throw new Error("Angle measure not available");this._disableAll(),this.angleMeasure.enabled=!0}deleteAll(){this.lengthMeasure?.deleteAll(),this.areaMeasure?.deleteAll(),this.angleMeasure?.deleteAll(),this._disableAll(),this._resetHighlighting()}_disableAll(){if(this.lengthMeasure===void 0)throw new Error("Length measure not available");if(this.areaMeasure===void 0)throw new Error("Area measure not available");if(this.angleMeasure===void 0)throw new Error("Angle measure not available");this.areaMeasure.enabled=!1,this.lengthMeasure.enabled=!1,this.angleMeasure.enabled=!1,this._tempDisableHighlighting()}_tempDisableHighlighting(){this._initialHighlightState===void 0&&(this._initialHighlightState=this.settings.highlighter.enabled),this.settings.highlighter.enabled=!1,this._service.settings=this.settings}_resetHighlighting(){if(this._initialHighlightState===void 0)throw new Error("Initial highlighter state was not saved");this.settings.highlighter.enabled=this._initialHighlightState,this._service.settings=this.settings}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-measure"]],inputs:{settings:"settings"},standalone:!0,features:[st],decls:5,vars:3,consts:[["label","Measure","icon","hugeicons:tape-measure"],["label","Length","icon","iconoir:select-edge-3d",3,"click","active"],["label","Area","icon","iconoir:select-face-3d",3,"click","active"],["label","Angle","icon","raphael:ruler",3,"click","active"],["label","Clear","icon","material-symbols-light:delete-outline",3,"click"]],template:function(n,r){n&1&&(He(0,"bim-toolbar-section",0)(1,"bim-button",1),rt("click",function(){return r.toggleLengthMeasure()}),We(),He(2,"bim-button",2),rt("click",function(){return r.toggleAreaMeasure()}),We(),He(3,"bim-button",3),rt("click",function(){return r.toggleAngleMeasure()}),We(),He(4,"bim-button",4),rt("click",function(){return r.deleteAll()}),We()()),n&2&&(Ge(),Le("active",r.lengthMeasure==null?null:r.lengthMeasure.enabled),Ge(),Le("active",r.areaMeasure==null?null:r.areaMeasure.enabled),Ge(),Le("active",r.angleMeasure==null?null:r.angleMeasure.enabled))},dependencies:[at]});let s=e;return s})();function GA(s){let e=s.cloneNode(!0),t=e.querySelectorAll("[id]"),i=s.nodeName.toLowerCase();e.removeAttribute("id");for(let n=0;n<t.length;n++)t[n].removeAttribute("id");return i==="canvas"?RA(s,e):(i==="input"||i==="select"||i==="textarea")&&MA(s,e),OA("canvas",s,e,RA),OA("input, textarea, select",s,e,MA),e}function OA(s,e,t,i){let n=e.querySelectorAll(s);if(n.length){let r=t.querySelectorAll(s);for(let o=0;o<n.length;o++)i(n[o],r[o])}}var $N=0;function MA(s,e){e.type!=="file"&&(e.value=s.value),e.type==="radio"&&e.name&&(e.name=`mat-clone-${e.name}-${$N++}`)}function RA(s,e){let t=e.getContext("2d");if(t)try{t.drawImage(s,0,0)}catch{}}function Gv(s){let e=s.getBoundingClientRect();return{top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.width,height:e.height,x:e.x,y:e.y}}function Uv(s,e,t){let{top:i,bottom:n,left:r,right:o}=s;return t>=i&&t<=n&&e>=r&&e<=o}function bd(s,e,t){s.top+=e,s.bottom=s.top+s.height,s.left+=t,s.right=s.left+s.width}function DA(s,e,t,i){let{top:n,right:r,bottom:o,left:a,width:l,height:c}=s,d=l*e,h=c*e;return i>n-h&&i<o+h&&t>a-d&&t<r+d}var Tf=class{constructor(e){this._document=e,this.positions=new Map}clear(){this.positions.clear()}cache(e){this.clear(),this.positions.set(this._document,{scrollPosition:this.getViewportScrollPosition()}),e.forEach(t=>{this.positions.set(t,{scrollPosition:{top:t.scrollTop,left:t.scrollLeft},clientRect:Gv(t)})})}handleScroll(e){let t=ih(e),i=this.positions.get(t);if(!i)return null;let n=i.scrollPosition,r,o;if(t===this._document){let c=this.getViewportScrollPosition();r=c.top,o=c.left}else r=t.scrollTop,o=t.scrollLeft;let a=n.top-r,l=n.left-o;return this.positions.forEach((c,d)=>{c.clientRect&&t!==d&&t.contains(d)&&bd(c.clientRect,a,l)}),n.top=r,n.left=o,{top:a,left:l}}getViewportScrollPosition(){return{top:window.scrollY,left:window.scrollX}}};function WA(s,e){let t=s.rootNodes;if(t.length===1&&t[0].nodeType===e.ELEMENT_NODE)return t[0];let i=e.createElement("div");return t.forEach(n=>i.appendChild(n)),i}function Wv(s,e,t){for(let i in e)if(e.hasOwnProperty(i)){let n=e[i];n?s.setProperty(i,n,t?.has(i)?"important":""):s.removeProperty(i)}return s}function dc(s,e){let t=e?"":"none";Wv(s.style,{"touch-action":e?"":"none","-webkit-user-drag":e?"":"none","-webkit-tap-highlight-color":e?"":"transparent","user-select":t,"-ms-user-select":t,"-webkit-user-select":t,"-moz-user-select":t})}function LA(s,e,t){Wv(s.style,{position:e?"":"fixed",top:e?"":"0",opacity:e?"":"0",left:e?"":"-999em"},t)}function Pf(s,e){return e&&e!="none"?s+" "+e:s}function FA(s,e){s.style.width=`${e.width}px`,s.style.height=`${e.height}px`,s.style.transform=Of(e.left,e.top)}function Of(s,e){return`translate3d(${Math.round(s)}px, ${Math.round(e)}px, 0)`}function kA(s){let e=s.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(s)*e}function ZN(s){let e=getComputedStyle(s),t=Nv(e,"transition-property"),i=t.find(a=>a==="transform"||a==="all");if(!i)return 0;let n=t.indexOf(i),r=Nv(e,"transition-duration"),o=Nv(e,"transition-delay");return kA(r[n])+kA(o[n])}function Nv(s,e){return s.getPropertyValue(e).split(",").map(i=>i.trim())}var QN=new Set(["position"]),Bv=class{constructor(e,t,i,n,r,o,a,l,c){this._document=e,this._rootElement=t,this._direction=i,this._initialDomRect=n,this._previewTemplate=r,this._previewClass=o,this._pickupPositionOnPage=a,this._initialTransform=l,this._zIndex=c}attach(e){this._preview=this._createPreview(),e.appendChild(this._preview),"showPopover"in this._preview&&this._preview.showPopover()}destroy(){this._preview.remove(),this._previewEmbeddedView?.destroy(),this._preview=this._previewEmbeddedView=null}setTransform(e){this._preview.style.transform=e}getBoundingClientRect(){return this._preview.getBoundingClientRect()}addClass(e){this._preview.classList.add(e)}getTransitionDuration(){return ZN(this._preview)}addEventListener(e,t){this._preview.addEventListener(e,t)}removeEventListener(e,t){this._preview.removeEventListener(e,t)}_createPreview(){let e=this._previewTemplate,t=this._previewClass,i=e?e.template:null,n;if(i&&e){let r=e.matchSize?this._initialDomRect:null,o=e.viewContainer.createEmbeddedView(i,e.context);o.detectChanges(),n=WA(o,this._document),this._previewEmbeddedView=o,e.matchSize?FA(n,r):n.style.transform=Of(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else n=GA(this._rootElement),FA(n,this._initialDomRect),this._initialTransform&&(n.style.transform=this._initialTransform);return Wv(n.style,{"pointer-events":"none",margin:"0",position:"fixed",top:"0",left:"0","z-index":this._zIndex+""},QN),dc(n,!1),n.classList.add("cdk-drag-preview"),n.setAttribute("popover","manual"),n.setAttribute("dir",this._direction),t&&(Array.isArray(t)?t.forEach(r=>n.classList.add(r)):n.classList.add(t)),n}},NA=th({passive:!0}),Sf=th({passive:!1}),UA=th({passive:!1,capture:!0}),JN=800,BA=new Set(["position"]),zv=class{get disabled(){return this._disabled||!!(this._dropContainer&&this._dropContainer.disabled)}set disabled(e){e!==this._disabled&&(this._disabled=e,this._toggleNativeDragInteractions(),this._handles.forEach(t=>dc(t,e)))}constructor(e,t,i,n,r,o){this._config=t,this._document=i,this._ngZone=n,this._viewportRuler=r,this._dragDropRegistry=o,this._passiveTransform={x:0,y:0},this._activeTransform={x:0,y:0},this._hasStartedDragging=Ft(!1),this._moveEvents=new pi,this._pointerMoveSubscription=sl.EMPTY,this._pointerUpSubscription=sl.EMPTY,this._scrollSubscription=sl.EMPTY,this._resizeSubscription=sl.EMPTY,this._boundaryElement=null,this._nativeInteractionsEnabled=!0,this._handles=[],this._disabledHandles=new Set,this._direction="ltr",this.dragStartDelay=0,this._disabled=!1,this.beforeStarted=new pi,this.started=new pi,this.released=new pi,this.ended=new pi,this.entered=new pi,this.exited=new pi,this.dropped=new pi,this.moved=this._moveEvents,this._pointerDown=a=>{if(this.beforeStarted.next(),this._handles.length){let l=this._getTargetHandle(a);l&&!this._disabledHandles.has(l)&&!this.disabled&&this._initializeDragSequence(l,a)}else this.disabled||this._initializeDragSequence(this._rootElement,a)},this._pointerMove=a=>{let l=this._getPointerPositionOnPage(a);if(!this._hasStartedDragging()){let d=Math.abs(l.x-this._pickupPositionOnPage.x),h=Math.abs(l.y-this._pickupPositionOnPage.y);if(d+h>=this._config.dragStartThreshold){let p=Date.now()>=this._dragStartTime+this._getDragStartDelay(a),f=this._dropContainer;if(!p){this._endDragSequence(a);return}(!f||!f.isDragging()&&!f.isReceiving())&&(a.cancelable&&a.preventDefault(),this._hasStartedDragging.set(!0),this._ngZone.run(()=>this._startDragSequence(a)))}return}a.cancelable&&a.preventDefault();let c=this._getConstrainedPointerPosition(l);if(this._hasMoved=!0,this._lastKnownPointerPosition=l,this._updatePointerDirectionDelta(c),this._dropContainer)this._updateActiveDropContainer(c,l);else{let d=this.constrainPosition?this._initialDomRect:this._pickupPositionOnPage,h=this._activeTransform;h.x=c.x-d.x+this._passiveTransform.x,h.y=c.y-d.y+this._passiveTransform.y,this._applyRootElementTransform(h.x,h.y)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:c,event:a,distance:this._getDragDistance(c),delta:this._pointerDirectionDelta})})},this._pointerUp=a=>{this._endDragSequence(a)},this._nativeDragStart=a=>{if(this._handles.length){let l=this._getTargetHandle(a);l&&!this._disabledHandles.has(l)&&!this.disabled&&a.preventDefault()}else this.disabled||a.preventDefault()},this.withRootElement(e).withParent(t.parentDragRef||null),this._parentPositions=new Tf(i),o.registerDragItem(this)}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(e){this._handles=e.map(i=>Pn(i)),this._handles.forEach(i=>dc(i,this.disabled)),this._toggleNativeDragInteractions();let t=new Set;return this._disabledHandles.forEach(i=>{this._handles.indexOf(i)>-1&&t.add(i)}),this._disabledHandles=t,this}withPreviewTemplate(e){return this._previewTemplate=e,this}withPlaceholderTemplate(e){return this._placeholderTemplate=e,this}withRootElement(e){let t=Pn(e);return t!==this._rootElement&&(this._rootElement&&this._removeRootElementListeners(this._rootElement),this._ngZone.runOutsideAngular(()=>{t.addEventListener("mousedown",this._pointerDown,Sf),t.addEventListener("touchstart",this._pointerDown,NA),t.addEventListener("dragstart",this._nativeDragStart,Sf)}),this._initialTransform=void 0,this._rootElement=t),typeof SVGElement<"u"&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(e){return this._boundaryElement=e?Pn(e):null,this._resizeSubscription.unsubscribe(),e&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(e){return this._parentDragRef=e,this}dispose(){this._removeRootElementListeners(this._rootElement),this.isDragging()&&this._rootElement?.remove(),this._anchor?.remove(),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeListeners(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._anchor=this._parentDragRef=null}isDragging(){return this._hasStartedDragging()&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}disableHandle(e){!this._disabledHandles.has(e)&&this._handles.indexOf(e)>-1&&(this._disabledHandles.add(e),dc(e,!0))}enableHandle(e){this._disabledHandles.has(e)&&(this._disabledHandles.delete(e),dc(e,this.disabled))}withDirection(e){return this._direction=e,this}_withDropContainer(e){this._dropContainer=e}getFreeDragPosition(){let e=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:e.x,y:e.y}}setFreeDragPosition(e){return this._activeTransform={x:0,y:0},this._passiveTransform.x=e.x,this._passiveTransform.y=e.y,this._dropContainer||this._applyRootElementTransform(e.x,e.y),this}withPreviewContainer(e){return this._previewContainer=e,this}_sortFromLastPointerPosition(){let e=this._lastKnownPointerPosition;e&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(e),e)}_removeListeners(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe(),this._getShadowRoot()?.removeEventListener("selectstart",VA,UA)}_destroyPreview(){this._preview?.destroy(),this._preview=null}_destroyPlaceholder(){this._placeholder?.remove(),this._placeholderRef?.destroy(),this._placeholder=this._placeholderRef=null}_endDragSequence(e){if(this._dragDropRegistry.isDragging(this)&&(this._removeListeners(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),!!this._hasStartedDragging()))if(this.released.next({source:this,event:e}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(e),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;let t=this._getPointerPositionOnPage(e);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(t),dropPoint:t,event:e})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(e){gd(e)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();let t=this._getShadowRoot(),i=this._dropContainer;if(t&&this._ngZone.runOutsideAngular(()=>{t.addEventListener("selectstart",VA,UA)}),i){let n=this._rootElement,r=n.parentNode,o=this._placeholder=this._createPlaceholderElement(),a=this._anchor=this._anchor||this._document.createComment("");r.insertBefore(a,n),this._initialTransform=n.style.transform||"",this._preview=new Bv(this._document,this._rootElement,this._direction,this._initialDomRect,this._previewTemplate||null,this.previewClass||null,this._pickupPositionOnPage,this._initialTransform,this._config.zIndex||1e3),this._preview.attach(this._getPreviewInsertionPoint(r,t)),LA(n,!1,BA),this._document.body.appendChild(r.replaceChild(o,n)),this.started.next({source:this,event:e}),i.start(),this._initialContainer=i,this._initialIndex=i.getItemIndex(this)}else this.started.next({source:this,event:e}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(i?i.getScrollableParents():[])}_initializeDragSequence(e,t){this._parentDragRef&&t.stopPropagation();let i=this.isDragging(),n=gd(t),r=!n&&t.button!==0,o=this._rootElement,a=ih(t),l=!n&&this._lastTouchEventTime&&this._lastTouchEventTime+JN>Date.now(),c=n?Pw(t):Tw(t);if(a&&a.draggable&&t.type==="mousedown"&&t.preventDefault(),i||r||l||c)return;if(this._handles.length){let u=o.style;this._rootElementTapHighlight=u.webkitTapHighlightColor||"",u.webkitTapHighlightColor="transparent"}this._hasMoved=!1,this._hasStartedDragging.set(this._hasMoved),this._removeListeners(),this._initialDomRect=this._rootElement.getBoundingClientRect(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(u=>this._updateOnScroll(u)),this._boundaryElement&&(this._boundaryRect=Gv(this._boundaryElement));let d=this._previewTemplate;this._pickupPositionInElement=d&&d.template&&!d.matchSize?{x:0,y:0}:this._getPointerPositionInElement(this._initialDomRect,e,t);let h=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(t);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:h.x,y:h.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,t)}_cleanupDragArtifacts(e){LA(this._rootElement,!0,BA),this._anchor.parentNode.replaceChild(this._rootElement,this._anchor),this._destroyPreview(),this._destroyPlaceholder(),this._initialDomRect=this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{let t=this._dropContainer,i=t.getItemIndex(this),n=this._getPointerPositionOnPage(e),r=this._getDragDistance(n),o=t._isOverContainer(n.x,n.y);this.ended.next({source:this,distance:r,dropPoint:n,event:e}),this.dropped.next({item:this,currentIndex:i,previousIndex:this._initialIndex,container:t,previousContainer:this._initialContainer,isPointerOverContainer:o,distance:r,dropPoint:n,event:e}),t.drop(this,i,this._initialIndex,this._initialContainer,o,r,n,e),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:e,y:t},{x:i,y:n}){let r=this._initialContainer._getSiblingContainerFromPosition(this,e,t);!r&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(e,t)&&(r=this._initialContainer),r&&r!==this._dropContainer&&this._ngZone.run(()=>{this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._dropContainer=r,this._dropContainer.enter(this,e,t,r===this._initialContainer&&r.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:r,currentIndex:r.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(i,n),this._dropContainer._sortItem(this,e,t,this._pointerDirectionDelta),this.constrainPosition?this._applyPreviewTransform(e,t):this._applyPreviewTransform(e-this._pickupPositionInElement.x,t-this._pickupPositionInElement.y))}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();let e=this._placeholder.getBoundingClientRect();this._preview.addClass("cdk-drag-animating"),this._applyPreviewTransform(e.left,e.top);let t=this._preview.getTransitionDuration();return t===0?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(i=>{let n=o=>{(!o||ih(o)===this._preview&&o.propertyName==="transform")&&(this._preview?.removeEventListener("transitionend",n),i(),clearTimeout(r))},r=setTimeout(n,t*1.5);this._preview.addEventListener("transitionend",n)}))}_createPlaceholderElement(){let e=this._placeholderTemplate,t=e?e.template:null,i;return t?(this._placeholderRef=e.viewContainer.createEmbeddedView(t,e.context),this._placeholderRef.detectChanges(),i=WA(this._placeholderRef,this._document)):i=GA(this._rootElement),i.style.pointerEvents="none",i.classList.add("cdk-drag-placeholder"),i}_getPointerPositionInElement(e,t,i){let n=t===this._rootElement?null:t,r=n?n.getBoundingClientRect():e,o=gd(i)?i.targetTouches[0]:i,a=this._getViewportScrollPosition(),l=o.pageX-r.left-a.left,c=o.pageY-r.top-a.top;return{x:r.left-e.left+l,y:r.top-e.top+c}}_getPointerPositionOnPage(e){let t=this._getViewportScrollPosition(),i=gd(e)?e.touches[0]||e.changedTouches[0]||{pageX:0,pageY:0}:e,n=i.pageX-t.left,r=i.pageY-t.top;if(this._ownerSVGElement){let o=this._ownerSVGElement.getScreenCTM();if(o){let a=this._ownerSVGElement.createSVGPoint();return a.x=n,a.y=r,a.matrixTransform(o.inverse())}}return{x:n,y:r}}_getConstrainedPointerPosition(e){let t=this._dropContainer?this._dropContainer.lockAxis:null,{x:i,y:n}=this.constrainPosition?this.constrainPosition(e,this,this._initialDomRect,this._pickupPositionInElement):e;if(this.lockAxis==="x"||t==="x"?n=this._pickupPositionOnPage.y-(this.constrainPosition?this._pickupPositionInElement.y:0):(this.lockAxis==="y"||t==="y")&&(i=this._pickupPositionOnPage.x-(this.constrainPosition?this._pickupPositionInElement.x:0)),this._boundaryRect){let{x:r,y:o}=this.constrainPosition?{x:0,y:0}:this._pickupPositionInElement,a=this._boundaryRect,{width:l,height:c}=this._getPreviewRect(),d=a.top+o,h=a.bottom-(c-o),u=a.left+r,p=a.right-(l-r);i=zA(i,u,p),n=zA(n,d,h)}return{x:i,y:n}}_updatePointerDirectionDelta(e){let{x:t,y:i}=e,n=this._pointerDirectionDelta,r=this._pointerPositionAtLastDirectionChange,o=Math.abs(t-r.x),a=Math.abs(i-r.y);return o>this._config.pointerDirectionChangeThreshold&&(n.x=t>r.x?1:-1,r.x=t),a>this._config.pointerDirectionChangeThreshold&&(n.y=i>r.y?1:-1,r.y=i),n}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;let e=this._handles.length>0||!this.isDragging();e!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=e,dc(this._rootElement,e))}_removeRootElementListeners(e){e.removeEventListener("mousedown",this._pointerDown,Sf),e.removeEventListener("touchstart",this._pointerDown,NA),e.removeEventListener("dragstart",this._nativeDragStart,Sf)}_applyRootElementTransform(e,t){let i=Of(e,t),n=this._rootElement.style;this._initialTransform==null&&(this._initialTransform=n.transform&&n.transform!="none"?n.transform:""),n.transform=Pf(i,this._initialTransform)}_applyPreviewTransform(e,t){let i=this._previewTemplate?.template?void 0:this._initialTransform,n=Of(e,t);this._preview.setTransform(Pf(n,i))}_getDragDistance(e){let t=this._pickupPositionOnPage;return t?{x:e.x-t.x,y:e.y-t.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:e,y:t}=this._passiveTransform;if(e===0&&t===0||this.isDragging()||!this._boundaryElement)return;let i=this._rootElement.getBoundingClientRect(),n=this._boundaryElement.getBoundingClientRect();if(n.width===0&&n.height===0||i.width===0&&i.height===0)return;let r=n.left-i.left,o=i.right-n.right,a=n.top-i.top,l=i.bottom-n.bottom;n.width>i.width?(r>0&&(e+=r),o>0&&(e-=o)):e=0,n.height>i.height?(a>0&&(t+=a),l>0&&(t-=l)):t=0,(e!==this._passiveTransform.x||t!==this._passiveTransform.y)&&this.setFreeDragPosition({y:t,x:e})}_getDragStartDelay(e){let t=this.dragStartDelay;return typeof t=="number"?t:gd(e)?t.touch:t?t.mouse:0}_updateOnScroll(e){let t=this._parentPositions.handleScroll(e);if(t){let i=ih(e);this._boundaryRect&&i!==this._boundaryElement&&i.contains(this._boundaryElement)&&bd(this._boundaryRect,t.top,t.left),this._pickupPositionOnPage.x+=t.left,this._pickupPositionOnPage.y+=t.top,this._dropContainer||(this._activeTransform.x-=t.left,this._activeTransform.y-=t.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){return this._parentPositions.positions.get(this._document)?.scrollPosition||this._parentPositions.getViewportScrollPosition()}_getShadowRoot(){return this._cachedShadowRoot===void 0&&(this._cachedShadowRoot=pg(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(e,t){let i=this._previewContainer||"global";if(i==="parent")return e;if(i==="global"){let n=this._document;return t||n.fullscreenElement||n.webkitFullscreenElement||n.mozFullScreenElement||n.msFullscreenElement||n.body}return Pn(i)}_getPreviewRect(){return(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=this._preview?this._preview.getBoundingClientRect():this._initialDomRect),this._previewRect}_getTargetHandle(e){return this._handles.find(t=>e.target&&(e.target===t||t.contains(e.target)))}};function zA(s,e,t){return Math.max(e,Math.min(t,s))}function gd(s){return s.type[0]==="t"}function VA(s){s.preventDefault()}function e3(s,e,t){let i=jA(e,s.length-1),n=jA(t,s.length-1);if(i===n)return;let r=s[i],o=n<i?-1:1;for(let a=i;a!==n;a+=o)s[a]=s[a+o];s[n]=r}function jA(s,e){return Math.max(0,Math.min(e,s))}var Vv=class{constructor(e,t){this._element=e,this._dragDropRegistry=t,this._itemPositions=[],this.orientation="vertical",this._previousSwap={drag:null,delta:0,overlaps:!1}}start(e){this.withItems(e)}sort(e,t,i,n){let r=this._itemPositions,o=this._getItemIndexFromPointerPosition(e,t,i,n);if(o===-1&&r.length>0)return null;let a=this.orientation==="horizontal",l=r.findIndex(g=>g.drag===e),c=r[o],d=r[l].clientRect,h=c.clientRect,u=l>o?1:-1,p=this._getItemOffsetPx(d,h,u),f=this._getSiblingOffsetPx(l,r,u),m=r.slice();return e3(r,l,o),r.forEach((g,b)=>{if(m[b]===g)return;let v=g.drag===e,E=v?p:f,y=v?e.getPlaceholderElement():g.drag.getRootElement();g.offset+=E,a?(y.style.transform=Pf(`translate3d(${Math.round(g.offset)}px, 0, 0)`,g.initialTransform),bd(g.clientRect,0,E)):(y.style.transform=Pf(`translate3d(0, ${Math.round(g.offset)}px, 0)`,g.initialTransform),bd(g.clientRect,E,0))}),this._previousSwap.overlaps=Uv(h,t,i),this._previousSwap.drag=c.drag,this._previousSwap.delta=a?n.x:n.y,{previousIndex:l,currentIndex:o}}enter(e,t,i,n){let r=n==null||n<0?this._getItemIndexFromPointerPosition(e,t,i):n,o=this._activeDraggables,a=o.indexOf(e),l=e.getPlaceholderElement(),c=o[r];if(c===e&&(c=o[r+1]),!c&&(r==null||r===-1||r<o.length-1)&&this._shouldEnterAsFirstChild(t,i)&&(c=o[0]),a>-1&&o.splice(a,1),c&&!this._dragDropRegistry.isDragging(c)){let d=c.getRootElement();d.parentElement.insertBefore(l,d),o.splice(r,0,e)}else Pn(this._element).appendChild(l),o.push(e);l.style.transform="",this._cacheItemPositions()}withItems(e){this._activeDraggables=e.slice(),this._cacheItemPositions()}withSortPredicate(e){this._sortPredicate=e}reset(){this._activeDraggables.forEach(e=>{let t=e.getRootElement();if(t){let i=this._itemPositions.find(n=>n.drag===e)?.initialTransform;t.style.transform=i||""}}),this._itemPositions=[],this._activeDraggables=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1}getActiveItemsSnapshot(){return this._activeDraggables}getItemIndex(e){return(this.orientation==="horizontal"&&this.direction==="rtl"?this._itemPositions.slice().reverse():this._itemPositions).findIndex(i=>i.drag===e)}updateOnScroll(e,t){this._itemPositions.forEach(({clientRect:i})=>{bd(i,e,t)}),this._itemPositions.forEach(({drag:i})=>{this._dragDropRegistry.isDragging(i)&&i._sortFromLastPointerPosition()})}_cacheItemPositions(){let e=this.orientation==="horizontal";this._itemPositions=this._activeDraggables.map(t=>{let i=t.getVisibleElement();return{drag:t,offset:0,initialTransform:i.style.transform||"",clientRect:Gv(i)}}).sort((t,i)=>e?t.clientRect.left-i.clientRect.left:t.clientRect.top-i.clientRect.top)}_getItemOffsetPx(e,t,i){let n=this.orientation==="horizontal",r=n?t.left-e.left:t.top-e.top;return i===-1&&(r+=n?t.width-e.width:t.height-e.height),r}_getSiblingOffsetPx(e,t,i){let n=this.orientation==="horizontal",r=t[e].clientRect,o=t[e+i*-1],a=r[n?"width":"height"]*i;if(o){let l=n?"left":"top",c=n?"right":"bottom";i===-1?a-=o.clientRect[l]-r[c]:a+=r[l]-o.clientRect[c]}return a}_shouldEnterAsFirstChild(e,t){if(!this._activeDraggables.length)return!1;let i=this._itemPositions,n=this.orientation==="horizontal";if(i[0].drag!==this._activeDraggables[0]){let o=i[i.length-1].clientRect;return n?e>=o.right:t>=o.bottom}else{let o=i[0].clientRect;return n?e<=o.left:t<=o.top}}_getItemIndexFromPointerPosition(e,t,i,n){let r=this.orientation==="horizontal",o=this._itemPositions.findIndex(({drag:a,clientRect:l})=>{if(a===e)return!1;if(n){let c=r?n.x:n.y;if(a===this._previousSwap.drag&&this._previousSwap.overlaps&&c===this._previousSwap.delta)return!1}return r?t>=Math.floor(l.left)&&t<Math.floor(l.right):i>=Math.floor(l.top)&&i<Math.floor(l.bottom)});return o===-1||!this._sortPredicate(o,e)?-1:o}},HA=.05,YA=.05,ds=function(s){return s[s.NONE=0]="NONE",s[s.UP=1]="UP",s[s.DOWN=2]="DOWN",s}(ds||{}),Sn=function(s){return s[s.NONE=0]="NONE",s[s.LEFT=1]="LEFT",s[s.RIGHT=2]="RIGHT",s}(Sn||{}),jv=class{constructor(e,t,i,n,r){this._dragDropRegistry=t,this._ngZone=n,this._viewportRuler=r,this.disabled=!1,this.sortingDisabled=!1,this.autoScrollDisabled=!1,this.autoScrollStep=2,this.enterPredicate=()=>!0,this.sortPredicate=()=>!0,this.beforeStarted=new pi,this.entered=new pi,this.exited=new pi,this.dropped=new pi,this.sorted=new pi,this.receivingStarted=new pi,this.receivingStopped=new pi,this._isDragging=!1,this._draggables=[],this._siblings=[],this._activeSiblings=new Set,this._viewportScrollSubscription=sl.EMPTY,this._verticalScrollDirection=ds.NONE,this._horizontalScrollDirection=Sn.NONE,this._stopScrollTimers=new pi,this._cachedShadowRoot=null,this._startScrollInterval=()=>{this._stopScrolling(),dw(0,cw).pipe(ai(this._stopScrollTimers)).subscribe(()=>{let o=this._scrollNode,a=this.autoScrollStep;this._verticalScrollDirection===ds.UP?o.scrollBy(0,-a):this._verticalScrollDirection===ds.DOWN&&o.scrollBy(0,a),this._horizontalScrollDirection===Sn.LEFT?o.scrollBy(-a,0):this._horizontalScrollDirection===Sn.RIGHT&&o.scrollBy(a,0)})},this.element=Pn(e),this._document=i,this.withScrollableParents([this.element]),t.registerDropContainer(this),this._parentPositions=new Tf(i),this._sortStrategy=new Vv(this.element,t),this._sortStrategy.withSortPredicate((o,a)=>this.sortPredicate(o,a,this))}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this.receivingStarted.complete(),this.receivingStopped.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(e,t,i,n){this._draggingStarted(),n==null&&this.sortingDisabled&&(n=this._draggables.indexOf(e)),this._sortStrategy.enter(e,t,i,n),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:e,container:this,currentIndex:this.getItemIndex(e)})}exit(e){this._reset(),this.exited.next({item:e,container:this})}drop(e,t,i,n,r,o,a,l={}){this._reset(),this.dropped.next({item:e,currentIndex:t,previousIndex:i,container:this,previousContainer:n,isPointerOverContainer:r,distance:o,dropPoint:a,event:l})}withItems(e){let t=this._draggables;return this._draggables=e,e.forEach(i=>i._withDropContainer(this)),this.isDragging()&&(t.filter(n=>n.isDragging()).every(n=>e.indexOf(n)===-1)?this._reset():this._sortStrategy.withItems(this._draggables)),this}withDirection(e){return this._sortStrategy.direction=e,this}connectedTo(e){return this._siblings=e.slice(),this}withOrientation(e){return this._sortStrategy.orientation=e,this}withScrollableParents(e){let t=Pn(this.element);return this._scrollableElements=e.indexOf(t)===-1?[t,...e]:e.slice(),this}getScrollableParents(){return this._scrollableElements}getItemIndex(e){return this._isDragging?this._sortStrategy.getItemIndex(e):this._draggables.indexOf(e)}isReceiving(){return this._activeSiblings.size>0}_sortItem(e,t,i,n){if(this.sortingDisabled||!this._domRect||!DA(this._domRect,HA,t,i))return;let r=this._sortStrategy.sort(e,t,i,n);r&&this.sorted.next({previousIndex:r.previousIndex,currentIndex:r.currentIndex,container:this,item:e})}_startScrollingIfNecessary(e,t){if(this.autoScrollDisabled)return;let i,n=ds.NONE,r=Sn.NONE;if(this._parentPositions.positions.forEach((o,a)=>{a===this._document||!o.clientRect||i||DA(o.clientRect,HA,e,t)&&([n,r]=t3(a,o.clientRect,this._sortStrategy.direction,e,t),(n||r)&&(i=a))}),!n&&!r){let{width:o,height:a}=this._viewportRuler.getViewportSize(),l={width:o,height:a,top:0,right:o,bottom:a,left:0};n=qA(l,t),r=XA(l,e),i=window}i&&(n!==this._verticalScrollDirection||r!==this._horizontalScrollDirection||i!==this._scrollNode)&&(this._verticalScrollDirection=n,this._horizontalScrollDirection=r,this._scrollNode=i,(n||r)&&i?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){let e=Pn(this.element).style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=e.msScrollSnapType||e.scrollSnapType||"",e.scrollSnapType=e.msScrollSnapType="none",this._sortStrategy.start(this._draggables),this._cacheParentPositions(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){let e=Pn(this.element);this._parentPositions.cache(this._scrollableElements),this._domRect=this._parentPositions.positions.get(e).clientRect}_reset(){this._isDragging=!1;let e=Pn(this.element).style;e.scrollSnapType=e.msScrollSnapType=this._initialScrollSnap,this._siblings.forEach(t=>t._stopReceiving(this)),this._sortStrategy.reset(),this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_isOverContainer(e,t){return this._domRect!=null&&Uv(this._domRect,e,t)}_getSiblingContainerFromPosition(e,t,i){return this._siblings.find(n=>n._canReceive(e,t,i))}_canReceive(e,t,i){if(!this._domRect||!Uv(this._domRect,t,i)||!this.enterPredicate(e,this))return!1;let n=this._getShadowRoot().elementFromPoint(t,i);if(!n)return!1;let r=Pn(this.element);return n===r||r.contains(n)}_startReceiving(e,t){let i=this._activeSiblings;!i.has(e)&&t.every(n=>this.enterPredicate(n,this)||this._draggables.indexOf(n)>-1)&&(i.add(e),this._cacheParentPositions(),this._listenToScrollEvents(),this.receivingStarted.next({initiator:e,receiver:this,items:t}))}_stopReceiving(e){this._activeSiblings.delete(e),this._viewportScrollSubscription.unsubscribe(),this.receivingStopped.next({initiator:e,receiver:this})}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(e=>{if(this.isDragging()){let t=this._parentPositions.handleScroll(e);t&&this._sortStrategy.updateOnScroll(t.top,t.left)}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){let e=pg(Pn(this.element));this._cachedShadowRoot=e||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){let e=this._sortStrategy.getActiveItemsSnapshot().filter(t=>t.isDragging());this._siblings.forEach(t=>t._startReceiving(this,e))}};function qA(s,e){let{top:t,bottom:i,height:n}=s,r=n*YA;return e>=t-r&&e<=t+r?ds.UP:e>=i-r&&e<=i+r?ds.DOWN:ds.NONE}function XA(s,e){let{left:t,right:i,width:n}=s,r=n*YA;return e>=t-r&&e<=t+r?Sn.LEFT:e>=i-r&&e<=i+r?Sn.RIGHT:Sn.NONE}function t3(s,e,t,i,n){let r=qA(e,n),o=XA(e,i),a=ds.NONE,l=Sn.NONE;if(r){let c=s.scrollTop;r===ds.UP?c>0&&(a=ds.UP):s.scrollHeight-c>s.clientHeight&&(a=ds.DOWN)}if(o){let c=s.scrollLeft;t==="rtl"?o===Sn.RIGHT?c<0&&(l=Sn.RIGHT):s.scrollWidth+c>s.clientWidth&&(l=Sn.LEFT):o===Sn.LEFT?c>0&&(l=Sn.LEFT):s.scrollWidth-c>s.clientWidth&&(l=Sn.RIGHT)}return[a,l]}var Af=th({passive:!1,capture:!0}),If=new Set,i3=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["ng-component"]],hostAttrs:["cdk-drag-resets-container",""],standalone:!0,features:[st],decls:0,vars:0,template:function(n,r){},styles:["@layer cdk-resets{.cdk-drag-preview{background:none;border:none;padding:0;color:inherit}}"],encapsulation:2,changeDetection:0});let s=e;return s})(),n3=(()=>{let e=class e{constructor(i,n){this._ngZone=i,this._appRef=qe(Sw),this._environmentInjector=qe(bw),this._dropInstances=new Set,this._dragInstances=new Set,this._activeDragInstances=Ft([]),this._globalListeners=new Map,this._draggingPredicate=r=>r.isDragging(),this.pointerMove=new pi,this.pointerUp=new pi,this.scroll=new pi,this._preventDefaultWhileDragging=r=>{this._activeDragInstances().length>0&&r.preventDefault()},this._persistentTouchmoveListener=r=>{this._activeDragInstances().length>0&&(this._activeDragInstances().some(this._draggingPredicate)&&r.preventDefault(),this.pointerMove.next(r))},this._document=n}registerDropContainer(i){this._dropInstances.has(i)||this._dropInstances.add(i)}registerDragItem(i){this._dragInstances.add(i),this._dragInstances.size===1&&this._ngZone.runOutsideAngular(()=>{this._document.addEventListener("touchmove",this._persistentTouchmoveListener,Af)})}removeDropContainer(i){this._dropInstances.delete(i)}removeDragItem(i){this._dragInstances.delete(i),this.stopDragging(i),this._dragInstances.size===0&&this._document.removeEventListener("touchmove",this._persistentTouchmoveListener,Af)}startDragging(i,n){if(!(this._activeDragInstances().indexOf(i)>-1)&&(this._loadResets(),this._activeDragInstances.update(r=>[...r,i]),this._activeDragInstances().length===1)){let r=n.type.startsWith("touch");this._globalListeners.set(r?"touchend":"mouseup",{handler:o=>this.pointerUp.next(o),options:!0}).set("scroll",{handler:o=>this.scroll.next(o),options:!0}).set("selectstart",{handler:this._preventDefaultWhileDragging,options:Af}),r||this._globalListeners.set("mousemove",{handler:o=>this.pointerMove.next(o),options:Af}),this._ngZone.runOutsideAngular(()=>{this._globalListeners.forEach((o,a)=>{this._document.addEventListener(a,o.handler,o.options)})})}}stopDragging(i){this._activeDragInstances.update(n=>{let r=n.indexOf(i);return r>-1?(n.splice(r,1),[...n]):n}),this._activeDragInstances().length===0&&this._clearGlobalListeners()}isDragging(i){return this._activeDragInstances().indexOf(i)>-1}scrolled(i){let n=[this.scroll];return i&&i!==this._document&&n.push(new rl(r=>this._ngZone.runOutsideAngular(()=>{let a=l=>{this._activeDragInstances().length&&r.next(l)};return i.addEventListener("scroll",a,!0),()=>{i.removeEventListener("scroll",a,!0)}}))),lg(...n)}ngOnDestroy(){this._dragInstances.forEach(i=>this.removeDragItem(i)),this._dropInstances.forEach(i=>this.removeDropContainer(i)),this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_clearGlobalListeners(){this._globalListeners.forEach((i,n)=>{this._document.removeEventListener(n,i.handler,i.options)}),this._globalListeners.clear()}_loadResets(){if(!If.has(this._appRef)){If.add(this._appRef);let i=Aw(i3,{environmentInjector:this._environmentInjector});this._appRef.onDestroy(()=>{If.delete(this._appRef),If.size===0&&i.destroy()})}}};e.\u0275fac=function(n){return new(n||e)(Qo(ol),Qo(al))},e.\u0275prov=yr({token:e,factory:e.\u0275fac,providedIn:"root"});let s=e;return s})(),s3={dragStartThreshold:5,pointerDirectionChangeThreshold:5},r3=(()=>{let e=class e{constructor(i,n,r,o){this._document=i,this._ngZone=n,this._viewportRuler=r,this._dragDropRegistry=o}createDrag(i,n=s3){return new zv(i,n,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry)}createDropList(i){return new jv(i,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}};e.\u0275fac=function(n){return new(n||e)(Qo(al),Qo(ol),Qo(FE),Qo(n3))},e.\u0275prov=yr({token:e,factory:e.\u0275fac,providedIn:"root"});let s=e;return s})(),Hv=new Jc("CDK_DRAG_PARENT");var KA=new Jc("CdkDragHandle"),$A=(()=>{let e=class e{get disabled(){return this._disabled}set disabled(i){this._disabled=i,this._stateChanges.next(this)}constructor(i,n){this.element=i,this._parentDrag=n,this._stateChanges=new pi,this._disabled=!1,n?._addHandle(this)}ngOnDestroy(){this._parentDrag?._removeHandle(this),this._stateChanges.complete()}};e.\u0275fac=function(n){return new(n||e)(Qi(eh),Qi(Hv,12))},e.\u0275dir=cg({type:e,selectors:[["","cdkDragHandle",""]],hostAttrs:[1,"cdk-drag-handle"],inputs:{disabled:[2,"cdkDragHandleDisabled","disabled",ug]},standalone:!0,features:[dg([{provide:KA,useExisting:e}]),hg]});let s=e;return s})(),o3=new Jc("CDK_DRAG_CONFIG"),a3="cdk-drag",l3=new Jc("CdkDropList"),ZA=(()=>{let e=class e{get disabled(){return this._disabled||this.dropContainer&&this.dropContainer.disabled}set disabled(i){this._disabled=i,this._dragRef.disabled=this._disabled}constructor(i,n,r,o,a,l,c,d,h,u,p){this.element=i,this.dropContainer=n,this._ngZone=o,this._viewContainerRef=a,this._dir=c,this._changeDetectorRef=h,this._selfHandle=u,this._parentDrag=p,this._destroyed=new pi,this._handles=new lw([]),this.started=new Vt,this.released=new Vt,this.ended=new Vt,this.entered=new Vt,this.exited=new Vt,this.dropped=new Vt,this.moved=new rl(f=>{let m=this._dragRef.moved.pipe(hw(g=>({source:this,pointerPosition:g.pointerPosition,event:g.event,delta:g.delta,distance:g.distance}))).subscribe(f);return()=>{m.unsubscribe()}}),this._injector=qe(vw),this._dragRef=d.createDrag(i,{dragStartThreshold:l&&l.dragStartThreshold!=null?l.dragStartThreshold:5,pointerDirectionChangeThreshold:l&&l.pointerDirectionChangeThreshold!=null?l.pointerDirectionChangeThreshold:5,zIndex:l?.zIndex}),this._dragRef.data=this,e._dragInstances.push(this),l&&this._assignDefaults(l),n&&(this._dragRef._withDropContainer(n._dropListRef),n.addItem(this)),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}setFreeDragPosition(i){this._dragRef.setFreeDragPosition(i)}ngAfterViewInit(){yw(()=>{this._updateRootElement(),this._setupHandlesListener(),this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)},{injector:this._injector})}ngOnChanges(i){let n=i.rootElementSelector,r=i.freeDragPosition;n&&!n.firstChange&&this._updateRootElement(),r&&!r.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this);let i=e._dragInstances.indexOf(this);i>-1&&e._dragInstances.splice(i,1),this._ngZone.runOutsideAngular(()=>{this._handles.complete(),this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_addHandle(i){let n=this._handles.getValue();n.push(i),this._handles.next(n)}_removeHandle(i){let n=this._handles.getValue(),r=n.indexOf(i);r>-1&&(n.splice(r,1),this._handles.next(n))}_setPreviewTemplate(i){this._previewTemplate=i}_resetPreviewTemplate(i){i===this._previewTemplate&&(this._previewTemplate=null)}_setPlaceholderTemplate(i){this._placeholderTemplate=i}_resetPlaceholderTemplate(i){i===this._placeholderTemplate&&(this._placeholderTemplate=null)}_updateRootElement(){let i=this.element.nativeElement,n=i;this.rootElementSelector&&(n=i.closest!==void 0?i.closest(this.rootElementSelector):i.parentElement?.closest(this.rootElementSelector)),this._dragRef.withRootElement(n||i)}_getBoundaryElement(){let i=this.boundaryElement;return i?typeof i=="string"?this.element.nativeElement.closest(i):Pn(i):null}_syncInputs(i){i.beforeStarted.subscribe(()=>{if(!i.isDragging()){let n=this._dir,r=this.dragStartDelay,o=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,a=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;i.disabled=this.disabled,i.lockAxis=this.lockAxis,i.dragStartDelay=typeof r=="object"&&r?r:Iw(r),i.constrainPosition=this.constrainPosition,i.previewClass=this.previewClass,i.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(o).withPreviewTemplate(a).withPreviewContainer(this.previewContainer||"global"),n&&i.withDirection(n.value)}}),i.beforeStarted.pipe(fw(1)).subscribe(()=>{if(this._parentDrag){i.withParent(this._parentDrag._dragRef);return}let n=this.element.nativeElement.parentElement;for(;n;){if(n.classList.contains(a3)){i.withParent(e._dragInstances.find(r=>r.element.nativeElement===n)?._dragRef||null);break}n=n.parentElement}})}_handleEvents(i){i.started.subscribe(n=>{this.started.emit({source:this,event:n.event}),this._changeDetectorRef.markForCheck()}),i.released.subscribe(n=>{this.released.emit({source:this,event:n.event})}),i.ended.subscribe(n=>{this.ended.emit({source:this,distance:n.distance,dropPoint:n.dropPoint,event:n.event}),this._changeDetectorRef.markForCheck()}),i.entered.subscribe(n=>{this.entered.emit({container:n.container.data,item:this,currentIndex:n.currentIndex})}),i.exited.subscribe(n=>{this.exited.emit({container:n.container.data,item:this})}),i.dropped.subscribe(n=>{this.dropped.emit({previousIndex:n.previousIndex,currentIndex:n.currentIndex,previousContainer:n.previousContainer.data,container:n.container.data,isPointerOverContainer:n.isPointerOverContainer,item:this,distance:n.distance,dropPoint:n.dropPoint,event:n.event})})}_assignDefaults(i){let{lockAxis:n,dragStartDelay:r,constrainPosition:o,previewClass:a,boundaryElement:l,draggingDisabled:c,rootElementSelector:d,previewContainer:h}=i;this.disabled=c??!1,this.dragStartDelay=r||0,n&&(this.lockAxis=n),o&&(this.constrainPosition=o),a&&(this.previewClass=a),l&&(this.boundaryElement=l),d&&(this.rootElementSelector=d),h&&(this.previewContainer=h)}_setupHandlesListener(){this._handles.pipe(Cu(i=>{let n=i.map(r=>r.element);this._selfHandle&&this.rootElementSelector&&n.push(this.element),this._dragRef.withHandles(n)}),gw(i=>lg(...i.map(n=>n._stateChanges.pipe(mw(n))))),ai(this._destroyed)).subscribe(i=>{let n=this._dragRef,r=i.element.nativeElement;i.disabled?n.disableHandle(r):n.enableHandle(r)})}};e._dragInstances=[],e.\u0275fac=function(n){return new(n||e)(Qi(eh),Qi(l3,12),Qi(al),Qi(ol),Qi(_w),Qi(o3,8),Qi(Ow,8),Qi(r3),Qi(Iu),Qi(KA,10),Qi(Hv,12))},e.\u0275dir=cg({type:e,selectors:[["","cdkDrag",""]],hostAttrs:[1,"cdk-drag"],hostVars:4,hostBindings:function(n,r){n&2&&xu("cdk-drag-disabled",r.disabled)("cdk-drag-dragging",r._dragRef.isDragging())},inputs:{data:[0,"cdkDragData","data"],lockAxis:[0,"cdkDragLockAxis","lockAxis"],rootElementSelector:[0,"cdkDragRootElement","rootElementSelector"],boundaryElement:[0,"cdkDragBoundary","boundaryElement"],dragStartDelay:[0,"cdkDragStartDelay","dragStartDelay"],freeDragPosition:[0,"cdkDragFreeDragPosition","freeDragPosition"],disabled:[2,"cdkDragDisabled","disabled",ug],constrainPosition:[0,"cdkDragConstrainPosition","constrainPosition"],previewClass:[0,"cdkDragPreviewClass","previewClass"],previewContainer:[0,"cdkDragPreviewContainer","previewContainer"]},outputs:{started:"cdkDragStarted",released:"cdkDragReleased",ended:"cdkDragEnded",entered:"cdkDragEntered",exited:"cdkDragExited",dropped:"cdkDragDropped",moved:"cdkDragMoved"},exportAs:["cdkDrag"],standalone:!0,features:[dg([{provide:Hv,useExisting:e}]),hg,Tn]});let s=e;return s})();var c3=["*"];function h3(s,e){if(s&1){let t=mt();He(0,"iconify-icon",4),rt("click",function(){pt(t);let n=Ze();return ft(n.clickedClose.emit())}),We()}}var us=function(s){return s[s.TopLeft=0]="TopLeft",s[s.TopRight=1]="TopRight",s[s.BottomLeft=2]="BottomLeft",s[s.BottomRight=3]="BottomRight",s}(us||{}),ar=(()=>{let e=class e{constructor(){this.label="Panel",this.showCloseBtn=!0,this.position=us.TopLeft,this.clickedClose=new Vt}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-draggable-panel"]],inputs:{label:"label",showCloseBtn:"showCloseBtn",position:"position"},outputs:{clickedClose:"clickedClose"},standalone:!0,features:[st],ngContentSelectors:c3,decls:7,vars:12,consts:[["cdkDrag","",1,"panel"],["id","close","class","clickable","height","1em","icon","mdi:close",3,"click",4,"ngIf"],["cdkDragHandle","",1,"header"],[1,"content"],["id","close","height","1em","icon","mdi:close",1,"clickable",3,"click"]],template:function(n,r){n&1&&(Ew(),He(0,"bim-panel",0),dt(1,h3,1,0,"iconify-icon",1),He(2,"div",2)(3,"bim-label"),fn(4),We()(),He(5,"div",3),Cw(6,0,["#content",""]),We()()),n&2&&($r("top",r.position===0||r.position===1?"0.5rem":"null")("bottom",r.position===2||r.position===3?"5rem":"null")("left",r.position===0||r.position===2?"0.5rem":"null")("right",r.position===1||r.position===3?"0.5rem":"null"),Ge(),Le("ngIf",r.showCloseBtn),Ge(2),$r("padding-right",r.showCloseBtn?"2rem":"1rem"),Ge(),Jo(r.label))},dependencies:[at,bt,ZA,$A],styles:[".panel[_ngcontent-%COMP%]{position:absolute;width:fit-content}.header[_ngcontent-%COMP%]{display:flex;flex:1;flex-direction:column;pointer-events:auto;overflow:auto}.header[_ngcontent-%COMP%]   bim-label[_ngcontent-%COMP%]{--bim-label--c: var(--bim-panel--c, var(--bim-ui_bg-contrast-80));--bim-label--fz: var(--bim-panel--fz, var(--bim-ui_size-sm));font-weight:600;padding:1rem 2rem 1rem 1rem;flex-shrink:0;border-bottom:1px solid var(--bim-ui_bg-contrast-20)}.header[_ngcontent-%COMP%]:hover{cursor:move}#close[_ngcontent-%COMP%]{position:absolute;top:.5rem;right:.5rem}.content[_ngcontent-%COMP%]{max-height:400px;overflow-y:auto}"]});let s=e;return s})();function Mf(s){let e=0,t=-1,i=-1;for(let n=0;n<s.length;n++)if(s[n]==="(")e++,e===1&&(t=n+1);else if(s[n]===")"&&(e--,e===0)){i=n;break}return t!==-1&&i!==-1?s.substring(t,i):null}var La=class{constructor(e,t,i){this.x=e,this.y=t,this.z=i}},Rf=class{constructor(e){this.points=e}};function Yv(s){s=s.trim().toUpperCase();let e=Mf(s),t=[];return e?.split(",").map(i=>i.trim().split(" ").map(n=>parseFloat(n))).map(i=>{t.push(new La(i[0],i[1],i[2]))}),new Rf(t)}function uc(s){s=s.trim().toUpperCase();let t=Mf(s)?.split(" ")??[];return s.includes("POINT Z")?new La(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2])):new La(parseFloat(t[0]),parseFloat(t[1]))}var ps=class{constructor(e,t=new Mr){this.wktString="",this.options=new Mr,this.type=Or.Unknown,this.transformYZ=!0,this.wktString=e.toLowerCase().trim(),this.options=t,this.setType()}setType(){this.wktString.startsWith("bbox")&&(this.type=Or.AABB),this.wktString.startsWith("point")&&(this.type=Or.Point),this.wktString.startsWith("linestring")&&(this.type=Or.LineString),this.wktString.startsWith("polygon")&&(this.type=Or.Polygon)}},Mr=class{constructor(e){this.color="#FF0000",this.size=.1,this.lineWidth=2,e!=null&&(this.color=e)}},Or=function(s){return s.Unknown="unknown",s.Polygon="polygon",s.LineString="lineString",s.Point="point",s.AABB="aabb",s}(Or||{});var An=window.THREE?window.THREE:{Box3:Qt,BufferGeometry:kt,Float32BufferAttribute:Er,InstancedBufferGeometry:Du,InstancedInterleavedBuffer:na,InterleavedBufferAttribute:Xs,Sphere:Qn,Vector3:ce,WireframeGeometry:Ru},pc=new An.BufferGeometry().setAttribute?"setAttribute":"addAttribute",QA=new An.Box3,Df=new An.Vector3,vd=class extends An.InstancedBufferGeometry{constructor(){super(),this.type="LineSegmentsGeometry";let e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],i=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(i),this[pc]("position",new An.Float32BufferAttribute(e,3)),this[pc]("uv",new An.Float32BufferAttribute(t,2))}applyMatrix4(e){let t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),i.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));let i=new An.InstancedInterleavedBuffer(t,6,1);return this[pc]("instanceStart",new An.InterleavedBufferAttribute(i,3,0)),this[pc]("instanceEnd",new An.InterleavedBufferAttribute(i,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));let i=new An.InstancedInterleavedBuffer(t,6,1);return this[pc]("instanceColorStart",new An.InterleavedBufferAttribute(i,3,0)),this[pc]("instanceColorEnd",new An.InterleavedBufferAttribute(i,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new An.WireframeGeometry(e.geometry)),this}fromLineSegments(e){let t=e.geometry;if(t.isGeometry){console.error("LineSegmentsGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else t.isBufferGeometry&&this.setPositions(t.attributes.position.array);return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new An.Box3);let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),QA.setFromBufferAttribute(t),this.boundingBox.union(QA))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new An.Sphere),this.boundingBox===null&&this.computeBoundingBox();let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){let i=this.boundingSphere.center;this.boundingBox.getCenter(i);let n=0;for(let r=0,o=e.count;r<o;r++)Df.fromBufferAttribute(e,r),n=Math.max(n,i.distanceToSquared(Df)),Df.fromBufferAttribute(t,r),n=Math.max(n,i.distanceToSquared(Df));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}};vd.prototype.isLineSegmentsGeometry=!0;var ms=window.THREE?window.THREE:{ShaderLib:ia,ShaderMaterial:Ni,UniformsLib:ta,UniformsUtils:cl,Vector2:Bt};ms.UniformsLib.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new ms.Vector2(1,1)},dashScale:{value:1},dashSize:{value:1},dashOffset:{value:0},gapSize:{value:1}};ms.ShaderLib.line={uniforms:ms.UniformsUtils.merge([ms.UniformsLib.common,ms.UniformsLib.fog,ms.UniformsLib.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		varying vec2 vUv;
		varying vec4 worldPos;
		varying vec3 worldStart;
		varying vec3 worldEnd;

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;

			#endif

			float aspect = resolution.x / resolution.y;

			vUv = uv;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			worldStart = start.xyz;
			worldEnd = end.xyz;

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segements overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

			vec2 offset = vec2( dir.y, - dir.x );
			// undo aspect ratio adjustment
			dir.x /= aspect;
			offset.x /= aspect;

			// sign flip
			if ( position.x < 0.0 ) offset *= - 1.0;

			// endcaps
			if ( position.y < 0.0 ) {

				offset += - dir;

			} else if ( position.y > 1.0 ) {

				offset += dir;

			}

			// adjust for linewidth
			offset *= linewidth;

			// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
			offset /= resolution.y;

			// select end
			vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

			// back to clip space
			offset *= clip.w;

			clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;
		varying vec4 worldPos;
		varying vec3 worldStart;
		varying vec3 worldEnd;

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		varying vec2 vUv;

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

			#endif

			#else

				#ifdef ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

			if ( abs( vUv.y ) > 1.0 ) {

				float a = vUv.x;
				float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
				float len2 = a * a + b * b;

				if ( len2 > 1.0 ) discard;

			}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};var Fa=class extends ms.ShaderMaterial{constructor(e){super({type:"LineMaterial",uniforms:ms.UniformsUtils.clone(ms.ShaderLib.line.uniforms),vertexShader:ms.ShaderLib.line.vertexShader,fragmentShader:ms.ShaderLib.line.fragmentShader,clipping:!0}),Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(t){!!t!="USE_DASH"in this.defines&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return"ALPHA_TO_COVERAGE"in this.defines},set:function(t){!!t!="ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),t===!0?(this.defines.ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}};Fa.prototype.isLineMaterial=!0;var Bi=window.THREE?window.THREE:{Box3:Qt,BufferGeometry:kt,InstancedInterleavedBuffer:na,InterleavedBufferAttribute:Xs,Line3:en,MathUtils:_r,Matrix4:lt,Mesh:$e,Sphere:Qn,Vector3:ce,Vector4:Hs},JA=new Bi.BufferGeometry().setAttribute?"setAttribute":"addAttribute",eI=new Bi.Vector3,tI=new Bi.Vector3,on=new Bi.Vector4,an=new Bi.Vector4,lr=new Bi.Vector4,qv=new Bi.Vector3,Xv=new Bi.Matrix4,fs=new Bi.Line3,iI=new Bi.Vector3,Rr=new Bi.Box3,Lf=new Bi.Sphere,cr=new Bi.Vector4,Ff=class extends Bi.Mesh{constructor(e=new vd,t=new Fa({color:Math.random()*16777215})){super(e,t),this.type="LineSegments2"}computeLineDistances(){let e=this.geometry,t=e.attributes.instanceStart,i=e.attributes.instanceEnd,n=new Float32Array(2*t.count);for(let o=0,a=0,l=t.count;o<l;o++,a+=2)eI.fromBufferAttribute(t,o),tI.fromBufferAttribute(i,o),n[a]=a===0?0:n[a-1],n[a+1]=n[a]+eI.distanceTo(tI);let r=new Bi.InstancedInterleavedBuffer(n,2,1);return e[JA]("instanceDistanceStart",new Bi.InterleavedBufferAttribute(r,1,0)),e[JA]("instanceDistanceEnd",new Bi.InterleavedBufferAttribute(r,1,1)),this}raycast(e,t){e.camera===null&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2.');let i=e.params.Line2!==void 0&&e.params.Line2.threshold||0,n=e.ray,r=e.camera,o=r.projectionMatrix,a=this.matrixWorld,l=this.geometry,c=this.material,d=c.resolution,h=c.linewidth+i,u=l.attributes.instanceStart,p=l.attributes.instanceEnd,f=-r.near,m=2*Math.max(h/d.width,h/d.height);l.boundingSphere===null&&l.computeBoundingSphere(),Lf.copy(l.boundingSphere).applyMatrix4(a);let g=Math.max(r.near,Lf.distanceToPoint(n.origin));cr.set(0,0,-g,1).applyMatrix4(r.projectionMatrix),cr.multiplyScalar(1/cr.w),cr.applyMatrix4(r.projectionMatrixInverse);let b=Math.abs(m/cr.w)*.5;if(Lf.radius+=b,e.ray.intersectsSphere(Lf)===!1)return;l.boundingBox===null&&l.computeBoundingBox(),Rr.copy(l.boundingBox).applyMatrix4(a);let v=Math.max(r.near,Rr.distanceToPoint(n.origin));cr.set(0,0,-v,1).applyMatrix4(r.projectionMatrix),cr.multiplyScalar(1/cr.w),cr.applyMatrix4(r.projectionMatrixInverse);let E=Math.abs(m/cr.w)*.5;if(Rr.max.x+=E,Rr.max.y+=E,Rr.max.z+=E,Rr.min.x-=E,Rr.min.y-=E,Rr.min.z-=E,e.ray.intersectsBox(Rr)!==!1){n.at(1,lr),lr.w=1,lr.applyMatrix4(r.matrixWorldInverse),lr.applyMatrix4(o),lr.multiplyScalar(1/lr.w),lr.x*=d.x/2,lr.y*=d.y/2,lr.z=0,qv.copy(lr),Xv.multiplyMatrices(r.matrixWorldInverse,a);for(let w=0,C=u.count;w<C;w++){on.fromBufferAttribute(u,w),an.fromBufferAttribute(p,w),on.w=1,an.w=1,on.applyMatrix4(Xv),an.applyMatrix4(Xv);var y=on.z>f&&an.z>f;if(y)continue;if(on.z>f){let O=on.z-an.z,F=(on.z-f)/O;on.lerp(an,F)}else if(an.z>f){let O=an.z-on.z,F=(an.z-f)/O;an.lerp(on,F)}on.applyMatrix4(o),an.applyMatrix4(o),on.multiplyScalar(1/on.w),an.multiplyScalar(1/an.w),on.x*=d.x/2,on.y*=d.y/2,an.x*=d.x/2,an.y*=d.y/2,fs.start.copy(on),fs.start.z=0,fs.end.copy(an),fs.end.z=0;let A=fs.closestPointToPointParameter(qv,!0);fs.at(A,iI);let D=Bi.MathUtils.lerp(on.z,an.z,A),M=D>=-1&&D<=1,I=qv.distanceTo(iI)<h*.5;if(M&&I){fs.start.fromBufferAttribute(u,w),fs.end.fromBufferAttribute(p,w),fs.start.applyMatrix4(a),fs.end.applyMatrix4(a);let O=new Bi.Vector3,F=new Bi.Vector3;n.distanceSqToSegment(fs.start,fs.end,F,O),t.push({point:F,pointOnLine:O,distance:n.origin.distanceTo(F),object:this,face:null,faceIndex:w,uv:null,uv2:null})}}}}};Ff.prototype.LineSegments2=!0;var fc=class extends vd{constructor(){super(),this.type="LineGeometry"}setPositions(e){for(var t=e.length-3,i=new Float32Array(2*t),n=0;n<t;n+=3)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];return super.setPositions(i),this}setColors(e){for(var t=e.length-3,i=new Float32Array(2*t),n=0;n<t;n+=3)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];return super.setColors(i),this}fromLine(e){var t=e.geometry;if(t.isGeometry){console.error("THREE.LineGeometry no longer supports Geometry. Use THREE.BufferGeometry instead.");return}else t.isBufferGeometry&&this.setPositions(t.attributes.position.array);return this}};fc.prototype.isLineGeometry=!0;var yd=class extends Ff{constructor(e=new fc,t=new Fa({color:Math.random()*16777215})){super(e,t),this.type="Line2"}};yd.prototype.isLine2=!0;var Kv=(()=>{let e=class e extends mn{constructor(i){super(i),this.enabled=!0;let r=this.components.get(Hi).list.values().next().value;this._scene=r?.scene.three}get(){return e.uuid}load(i){return ie(this,null,function*(){let n=this._getGeometryGroup(),r=[];i.forEach(a=>{a.type==Or.Point?r.push(this._buildPointMesh(a)):a.type==Or.LineString&&r.push(this._buildLineString(a))}),(yield Promise.all(r)).forEach(a=>n.add(a))})}resetAll(){this._wktGeometryGroup!==void 0&&(this._wktGeometryGroup.children=[],this._wktGeometryGroup=void 0)}_getGeometryGroup(){if(this._wktGeometryGroup!==void 0)return this._wktGeometryGroup;let i=new qs;return i.name="wkt",i.matrixAutoUpdate=!1,this._wktGeometryGroup=i,this._scene.add(this._wktGeometryGroup),i}_buildPointMesh(i){return ie(this,null,function*(){return new Promise(n=>{let r=uc(i.wktString),{size:o}=i.options,a=new Mu(o/2,32,16),l=this._buildMaterial(i),c=new $e(a,l);i.transformYZ?(c.position.x=r.x,c.position.y=r.z??0,c.position.z=-r.y):(c.position.x=r.x,c.position.y=r.y,c.position.z=r.z??0),n(c)})})}_buildLineString(i){return ie(this,null,function*(){return new Promise(n=>{let r=Yv(i.wktString),o=[];i.transformYZ?r.points.forEach(d=>{o.push(d.x),o.push(d.z),o.push(-d.y)}):r.points.forEach(d=>{o.push(d.x),o.push(d.y),o.push(d.z)});let a=new fc;a.setPositions(o);let l=new Fa({color:new zt(i.options.color).getHex(),linewidth:i.options.lineWidth,resolution:new Bt(640,480)}),c=new yd(a,l);c.computeLineDistances(),n(c)})})}_buildMaterial(i){let{opacity:n,color:r}=i.options,o=new Ii({color:new zt(r)});return n!==void 0&&n!==1&&(o.transparent=!0,o.opacity=n),o}};e.uuid="f078a44f-7d61-4aef-a7ed-b171bc56d20e";let s=e;return s})();var rI=[{id:"get-port-placements",query:`SELECT ?iri ?wkt 
        WHERE {
            ?iri a fso:Port ;
                omg:hasGeometry/omg:hasSimpleGeometryDescription ?wkt
        }`,postProcessing:s=>s?.results?.bindings===void 0?[]:s.results.bindings.map(e=>({iri:e.iri.value,wkt:e.wkt.value}))},{id:"get-elements-no-product-assigned",query:`SELECT ?iri
        WHERE {
            ?iri omg:hasGeometry ?g
            MINUS{?iri bpo:realisesObject ?product}
        }`,postProcessing:s=>s?.results?.bindings===void 0?[]:s.results.bindings.map(e=>e.iri.value.split("/").pop())},{id:"get-elements-no-volume-assigned",query:`SELECT DISTINCT ?iri
        WHERE {
            ?iri omg:hasGeometry/omg:transformsGeometry ?g .
            MINUS{?g obc:bvhVolume ?vol}
        }`,postProcessing:s=>s?.results?.bindings===void 0?[]:s.results.bindings.map(e=>e.iri.value.split("/").pop())},{id:"get-elements-volume-assigned",query:`SELECT DISTINCT ?iri
        WHERE {
            ?iri omg:hasGeometry/omg:transformsGeometry ?g .
            ?g obc:bvhVolume ?vol
        }`,postProcessing:s=>s?.results?.bindings===void 0?[]:s.results.bindings.map(e=>e.iri.value.split("/").pop())},{id:"get-elements-multiple-geometries",query:`SELECT ?iri
        WHERE {
            {
                SELECT ?iri (COUNT(?g) as ?count)
                WHERE{
                    ?iri omg:hasGeometry ?g .
                } GROUP BY ?iri
            }
            FILTER(?count > 1)
        }`,postProcessing:s=>s?.results?.bindings===void 0?[]:s.results.bindings.map(e=>e.iri.value.split("/").pop())},{id:"get-element-oobbs",query:`SELECT ?oobb ?t
        WHERE{
          <{{elementIRI}}> omg:hasGeometry [
              omg:transformsGeometry/obc:oobb ?oobb ;
              obc:transformation ?t ;
          ] .
        }`,postProcessing:s=>s?.results?.bindings===void 0?[]:s.results.bindings.map(e=>{let t=JSON.parse(e.oobb.value),i=JSON.parse(e.t.value);return Fg(t,i)})},{id:"get-adjacent-space-centroids",query:`SELECT ?c
        WHERE{
          <{{elementIRI}}> ^bot:adjacentElement/omg:hasGeometry [
              obc:oobbCentroid ?c
          ] .
        }`,postProcessing:s=>s?.results?.bindings===void 0?[]:s.results.bindings.map(e=>{let{x:t,y:i,z:n}=uc(e.c.value);return new ce(t,i,n)})},{id:"space-element-adjacencies",query:`PREFIX bot: <https://w3id.org/bot#>
    SELECT ?element ?space ?elementOOBBTransformations ?spaceOOBBTransformations {
      ?space {{relationship}} ?element .
      MINUS{?element qcy:orientation ?o }
      {
        SELECT ?element (GROUP_CONCAT(?oobbTrans; separator="|") AS ?elementOOBBTransformations)
        WHERE{
          ?element omg:hasGeometry [
              omg:transformsGeometry/obc:oobb ?oobb ;
              obc:transformation ?t ;
          ] .
          BIND(CONCAT(?oobb, "_", ?t) AS ?oobbTrans)
        } GROUP BY ?element
      }
      {
        SELECT ?space (GROUP_CONCAT(?oobbTrans; separator="|") AS ?spaceOOBBTransformations)
        WHERE{
          ?space omg:hasGeometry [
              omg:transformsGeometry/obc:oobb ?oobb ;
              obc:transformation ?t ;
          ] .
          BIND(CONCAT(?oobb, "_", ?t) AS ?oobbTrans)
        } GROUP BY ?space
      }
    }`,postProcessing:s=>{let e={};if(s?.results?.bindings===void 0)return e;let t=[];return s.results.bindings.forEach(i=>{console.log(i);let n=nI(i.elementOOBBTransformations.value),r=nI(i.spaceOOBBTransformations.value),o=Wu(n),a=sI([o],"red")[0],l=sI(r,"blue"),c=d3(o,r);t.push(a),t.push(...l),t.push(...c)}),t}}];function nI(s){return s.split("|").map(t=>{let i=t.split("_"),n=JSON.parse(i[0]),r=JSON.parse(i[1]);return Fg(n,r)})}function sI(s,e="red"){let t=new Mr(e);return t.size=.2,s.map(i=>{let n=i.getCenter(new ce),r=new ps(`POINT Z(${n.x} ${n.y} ${n.z})`,t);return r.transformYZ=!1,r})}function d3(s,e){let t=new Mr("black");t.lineWidth=1;let i=s.getCenter(new ce);return e.map(n=>{let r=n.getCenter(new ce),o=new ps(`LINESTRING Z(${i.x} ${i.y} ${i.z}, ${r.x} ${r.y} ${r.z})`,t);return o.transformYZ=!1,o})}var kf=class{constructor(){this._queryDefs=[]}addQueryDefinitions(e=[]){e.forEach(t=>{this._queryDefs.find(n=>n.id===t.id)===void 0&&(t.query=AE(t.query),this._queryDefs.push(t))})}get(e,t){let i=this._queryDefs.find(r=>r.id===e);if(i===void 0)throw new Error(`Unknown query with id "${e}"`);let n=this._replaceHandlebars(i.query,t);return{id:i.id,query:n,responseMimetype:i.responseMimetype,postProcessing:i.postProcessing}}_replaceHandlebars(e,t){if(t===void 0)return e;let i=/{{(.*?)}}/g;return e.replace(i,(n,r)=>Object.keys(t).includes(r)?t[r].toString():"")}};var Pt=(()=>{let e=class e{constructor(){this._available=Ft(!1),this._queryStore=new kf}set settings(i){this._available.set(!1),this._settings=i,this._available.set(i.endpoint!==void 0)}get available(){return this._available}destroy(){this._available.set(!1)}addQueryDefinitions(i){this._queryStore.addQueryDefinitions(i)}query(i,n){return ie(this,null,function*(){if(this._settings?.endpoint===void 0)throw new Error("Querying is not possible if an endpoint is not provided");if(this._settings?.spaceId===void 0)throw new Error("Querying is not possible if a space id is not provided");let r=this._settings?.headers!==void 0?this._settings?.headers:{};r["Content-type"]===void 0&&(r["Content-type"]="application/json"),n!==void 0&&(r.Accept=n);let o={method:"POST",headers:r,body:JSON.stringify({query:i,spaceId:this._settings.spaceId})};return(yield fetch(this._settings.endpoint,o)).json()})}execute(i,n){return ie(this,null,function*(){let r=this._queryStore.get(i,n);if(r===void 0)throw new Error(`No query with id ${i}`);let o=yield this.query(r.query,r.responseMimetype);return o.query=r.query,r.postProcessing!==void 0?yield r.postProcessing(o):o})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=yr({token:e,factory:e.\u0275fac,providedIn:"root"});let s=e;return s})();var aI=Cs(la());function oI(s){return ie(this,null,function*(){s.setVisibility=(e,t)=>ie(this,null,function*(){let i=new Map;for(let n in t){let r=s.fragIDData.get(n);if(r===void 0)throw new Error("Geometry not found!");let[o,a,l]=r,c=o.uuid;i.has(c)||i.set(c,new Map);let d=i.get(c),h=t[n];for(let p of h)e?l.delete(p):l.add(p);d.get(a)||d.set(a,new Set);let u=d.get(a);for(let p of h)u.add(p)}for(let[n,r]of i){try{s.culler.setVisibility(e,n,r)}catch{}for(let[o]of r){let a=s._loadedFragments[n];if(!a)continue;let l=a[o];if(l)for(let c of l){let d=t[c.id];d&&c.setVisibility(e,d)}}}s.culler.needsUpdate=!0})})}var lI=(()=>{let e=class e extends mn{constructor(i){super(i),this.enabled=!0,this.events=new aI.EventEmitter,this._loadedModels=[],this._hiddenElementsMap={},this._hiddenModelsMap={},this._isolatedElementsMap={},this._streamLoader=i.get(Ds),oI(this._streamLoader),this._idMap=i.get(gn),this._hider=i.get(hh),this._idMap.events.addListener("loadedModels",n=>this._loadedModels=n),this._initEventListeners()}dispose(){}get(){return e.uuid}unhideAll(){this._loadedModels.forEach(i=>{this.setModelVisibility(!0,i)}),this._isolatedElementsMap={}}setHidden(i,n=!0){(n||!i.length)&&(this._streamLoader.setVisibility(!0,this._hiddenElementsMap),this._hiddenElementsMap={});let r=this._idMap.getFragmentIDMap(i);Object.keys(r).length&&(this._hiddenElementsMap=n?r:Se(Se({},this._hiddenElementsMap),r),this._streamLoader.setVisibility(!1,this._hiddenElementsMap),this.events.emit("hiddenElements",[...i]))}setModelVisibility(i,n){let r=this._idMap.getFragmentsGroupFromModelUUID(n);if(r===void 0)return;let o=new Set;r.items.forEach(l=>l.ids.forEach(c=>o.add(c)));let a=r?.getFragmentMap(o);a!==void 0&&(i||(this._hiddenModelsMap=Se(Se({},this._hiddenModelsMap),a)),this._streamLoader.setVisibility(i,a),this._streamLoader.culler.needsUpdate=!0)}setIsolated(i){return ie(this,null,function*(){if(!i.length){this.unhideAll();return}let n=this._idMap?.getFragmentIDMap(i);this._isolatedElementsMap=n,n!==void 0&&Object.keys(n).length&&(this._hider.set(!1),this._streamLoader.setVisibility(!0,n),this.events.emit("isolatedElements",[...i]))})}_initEventListeners(){this._streamLoader.culler.onViewUpdated.add(n=>ie(this,[n],function*({toShow:i}){Object.keys(i).length&&Object.keys(this._isolatedElementsMap).length&&(this._hider.set(!1),this._streamLoader.setVisibility(!0,this._isolatedElementsMap))}))}};e.uuid="da8db28f-5fed-469d-8ffb-07d7b3cfccc1";let s=e;return s})();var cI=Cs(la());var hI=(()=>{let e=class e extends mn{constructor(i){super(i),this.enabled=!0,this._modelPreferences={},this._staticFragments=new Set,this.events=new cI.EventEmitter,this._dimmer=i.get(xf),this._hider=i.get(lI),this._idMap=i.get(gn),this._streamLoader=i.get(Ds),this._hider.events.addListener("hiddenElements",n=>this.events.emit("hiddenElements",n)),this._hider.events.addListener("isolatedElements",n=>this.events.emit("isolatedElements",n))}dispose(){this.removeAll()}get(){return e.uuid}setModelVisibility(i,n){this.components.get(Ea).setVisibility(i,n),this._dimmer.setAllNotTransparent()}setModelStylingPreferences(i,n){return ie(this,null,function*(){this._modelPreferences[i]=n})}removeAll(){this.setStatic([]),this.setHidden([]),this.setTransparent([]),this.events.emit("hiddenElements",[]),this.events.emit("isolatedElements",[]),this.events.emit("focusedElements",[]),this.events.emit("transparentElements",[]),this.events.emit("staticFragments",[]),this._modelPreferences={}}setHidden(i){this._hider.setHidden(i)}setTransparent(i){this._dimmer.transparentElements=i,this.events.emit("transparentElements",[...i])}setFocused(i){return ie(this,null,function*(){yield this.setIsolated(i),yield this._dimmer.setIsolatedElements(i),this.events.emit("focusedElements",i)})}setIsolated(i){return ie(this,null,function*(){return this._hider.setIsolated(i)})}setColorOverride(i,n){if(this._idMap===void 0)return;let r=this._idMap.getFragmentsGroupFromModelUUID(i);n.forEach(o=>{let a=this._idMap?.getFragmentIDMap(o.elementUUIDs);a!==void 0&&Object.keys(a).forEach(l=>{let c=r?.items.find(d=>d.id===l);c!==void 0&&c.setColor(o.color,a[l],!0)})})}setStatic(i,n=!0){return ie(this,null,function*(){this._idMap!==void 0&&(n&&this._staticFragments.size&&(yield this._streamLoader.setStatic(Array.from(this._staticFragments),!1,!0),this._staticFragments=new Set),this._staticFragments=this._idMap.getFragmentIDs(i),yield this._streamLoader.setStatic(Array.from(this._staticFragments),!0,!1),this.events.emit("staticFragments",Array.from(this._staticFragments)),this._streamLoader.culler.needsUpdate=!0)})}};e.uuid="d66b62c0-fef0-430c-a8c3-f4c610ad97cb";let s=e;return s})();var Nf=class{constructor(){this.isolated=[],this.hidden=[],this.focused=[],this.transparent=[],this.colored=[]}};function Uf(s){return new Promise(e=>setTimeout(e,s))}var dI=Cs(la());var vt=(()=>{let e=class e{constructor(){this._service=qe(yn),this._loadedModels=Ft([]),this._selectedElements=Ft([]),this._hoveredElement=Ft(void 0),this._hiddenElements=Ft([]),this._isolatedElements=Ft([]),this._transparentElements=Ft([]),this._focusedElements=Ft([]),this._staticFragments=Ft([]),this._wkt=Ft([]),this._arrows=Ft([]),this._boxes=Ft([]),this._selectedModel=Ft(void 0),this._viewedDocument=Ft(void 0),this.events=new dI.EventEmitter,Gt(()=>ie(this,null,function*(){this._service.world()!==void 0&&(yield Uf(10),this._idMap=this._service.components.get(gn),this._idMap.events.addListener("loadedModels",n=>{this._loadedModels.set(n)}),this._highlighter=this._service.components.get(Gl),this._highlighter.events.addListener("hoveredElement",n=>this._hoveredElement.set(n)),this._highlighter.events.addListener("selectionChange",n=>this._selectedElements.set(n)),this._styler=this._service.components.get(hI),this._styler.events.addListener("hiddenElements",n=>this._hiddenElements.set(n)),this._styler.events.addListener("isolatedElements",n=>this._isolatedElements.set(n)),this._styler.events.addListener("transparentElements",n=>this._transparentElements.set(n)),this._styler.events.addListener("focusedElements",n=>this._focusedElements.set(n)),this._styler.events.addListener("staticFragments",n=>this._staticFragments.set(n)))}))}destroy(){this._hoveredElement.set(void 0),this._selectedElements.set([]),this._hiddenElements.set([]),this._isolatedElements.set([]),this._transparentElements.set([]),this._selectedModel.set(void 0),this._focusedElements.set([]),this._idMap?.dispose(),this._styler?.dispose()}get selectedElements(){return this._selectedElements}setSelectedElements(i){return ie(this,null,function*(){if(this._highlighter===void 0)throw new Error("Highlighter not available");yield this._styler?.setStatic(i),yield this._highlighter.setSelectedElements(i)})}get hoveredElement(){return this._hoveredElement}get loadedModels(){return this._loadedModels}set selectedModel(i){this._selectedModel.set(i)}get selectedModel(){return this._selectedModel}set viewedDocument(i){this._viewedDocument.set(i)}get viewedDocument(){return this._viewedDocument}set wkt(i){console.log(i);let n=this._service.components.get(Kv);n.resetAll(),n.load(i),this._wkt.update(()=>i)}get wkt(){return this._wkt}addWKT(i){this._service.components.get(Kv).load(i),this._wkt.update(r=>[...r,...i])}set transparentElements(i){this._styler?.setTransparent(i)}get transparentElements(){return this._transparentElements}setFocusedElements(i){return ie(this,null,function*(){yield this._styler?.setStatic(i),yield this._styler?.setFocused(i)})}get focusedElements(){return this._focusedElements}setFocusedSelectedElements(i){return ie(this,null,function*(){yield this._styler?.setStatic(i),yield this._styler?.setFocused(i),yield this.setSelectedElements(i)})}hideElements(i){let n=this._hiddenElements();n.push(...i),this._styler?.setHidden(n)}set hiddenElements(i){this._styler?.setHidden(i)}get hiddenElements(){return this._hiddenElements}setIsolatedElements(i){return ie(this,null,function*(){yield this._styler?.setStatic(i),yield this._styler?.setIsolated(i)})}get isolatedElements(){return this._isolatedElements}setModelVisibility(i,n){this._styler?.setModelVisibility(i,n)}setModelStyles(i,n){return ie(this,null,function*(){n.isolated.length?yield this.setIsolatedElements(n.isolated):n.hidden.length&&(yield this.hideElements(n.hidden)),n.focused.length?yield this.setFocusedElements(n.focused):n.transparent.length&&(this.transparentElements=n.transparent)})}clearStatic(){return ie(this,null,function*(){this._staticFragments().length&&(yield this._styler?.setStatic([]))})}addArrow(i){let n=i.direction.normalize(),r=new tE(n,i.point,i.length,i.color);return this._getScene().add(r),this._arrows.update(a=>[...a,r]),r}get arrows(){return this._arrows}removeArrows(i=this._arrows()){let n=this._getScene();i.forEach(o=>n.remove(o));let r=i.map(o=>o.uuid);this._arrows.update(o=>o.filter(a=>!r.includes(a.uuid)))}addBox(i){let n=new eE(i,new zt(16776960));return this._getScene().add(n),this._boxes.update(o=>[...o,n]),n}get boxes(){return this._boxes}removeBoxes(i=this._boxes()){let n=this._getScene();i.forEach(o=>n.remove(o));let r=i.map(o=>o.uuid);this._arrows.update(o=>o.filter(a=>!r.includes(a.uuid)))}_getScene(){return this._service.components.get(Hi).list.values().next().value?.scene.three}};e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=yr({token:e,factory:e.\u0275fac,providedIn:"root"});let s=e;return s})();var uI=(()=>{let e=class e{constructor(){this._state=qe(vt),this._queryService=qe(Pt),this.wkt=new ps("POINT Z(-8.37 0.76 0)")}addWKTPoint(i,n,r){let o=new ps(i);o.options.size=n,o.options.color=r.color,o.options.opacity=r.opacity!==void 0?r.opacity/100:1,console.log(o.options.opacity),this._state.addWKT([o])}showPorts(i,n){return ie(this,null,function*(){let r=[];(yield this._queryService.execute("get-port-placements")).forEach(a=>{let l=new ps(a.wkt);l.options.size=i,l.options.color=n.color,l.options.opacity=n.opacity!==void 0?n.opacity/100:1,r.push(l)}),this._state.addWKT(r)})}removeAllWKT(){return ie(this,null,function*(){this._state.wkt=[]})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-wkt-tools"]],standalone:!0,features:[st],decls:10,vars:2,consts:[["wktStr",""],["pointSize",""],["pointColor",""],["label","WKT","collapsed","false"],["vertical","","name","WKT string","label","WKT string",3,"value"],["slider","","step","0.1","label","Point size","pref","d","min","0.1","max","5","suffix","m",3,"value"],["label","Point Color","color","#DF4E4E","opacity","20"],["label","Add WKT",3,"click"],["label","Show FSO ports",3,"click"],["label","Remove all WKT",3,"click"]],template:function(n,r){if(n&1){let o=mt();He(0,"bim-panel-section",3),_t(1,"bim-text-input",4,0)(3,"bim-number-input",5,1)(5,"bim-color-input",6,2),He(7,"bim-button",7),rt("click",function(){pt(o);let l=kn(2),c=kn(4),d=kn(6);return ft(r.addWKTPoint(l.value,c.value,d.value))}),We(),He(8,"bim-button",8),rt("click",function(){pt(o);let l=kn(4),c=kn(6);return ft(r.showPorts(l.value,c.value))}),We(),He(9,"bim-button",9),rt("click",function(){return pt(o),ft(r.removeAllWKT())}),We()()}n&2&&(Ge(),Le("value",r.wkt.wktString),Ge(2),Le("value",r.wkt.options.size))},dependencies:[at,Ks],encapsulation:2});let s=e;return s})();function u3(s,e){if(s&1){let t=mt();He(0,"bim-button",6),rt("click",function(){let n=pt(t).$implicit,r=Ze();return ft(r.execute(n.queryId))}),We()}if(s&2){let t=e.$implicit;Le("label",t.label)}}function p3(s,e){if(s&1&&(He(0,"p"),fn(1),We()),s&2){let t=Ze();Ge(),Au("",t.resultCount()," results")}}var pI=(()=>{let e=class e{constructor(){this._state=qe(vt),this._queryService=qe(Pt),this.resultCount=Ft(void 0),this.methods=[{label:"Elements with no product assigned",queryId:"get-elements-no-product-assigned"},{label:"Elements with volume assigned",queryId:"get-elements-volume-assigned"},{label:"Elements with no volume assigned",queryId:"get-elements-no-volume-assigned"},{label:"Elements with more than one geometry",queryId:"get-elements-multiple-geometries"}]}execute(i){return ie(this,null,function*(){let n=yield this._queryService.execute(i);this.resultCount.set(n.length),this._state.setIsolatedElements(n)})}showSpaceElementAdjacencies(){return ie(this,null,function*(){let i=yield this._queryService.execute("space-element-adjacencies",{relationship:"bot:adjacentElement"});this._state.wkt=i})}showSpaceElementContainments(){return ie(this,null,function*(){let i=yield this._queryService.execute("space-element-adjacencies",{relationship:"bot:containsElement"});this._state.wkt=i})}reset(){this._state.setIsolatedElements([]),this.resultCount.set(void 0),this._state.wkt=[]}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-qa-tools"]],standalone:!0,features:[st],decls:7,vars:1,consts:[["label","QA","collapsed","false"],[3,"label"],[4,"ngIf"],["label","Show space/element adjacencies",3,"click"],["label","Show space/element containment",3,"click"],["label","RESET",3,"click"],[3,"click","label"]],template:function(n,r){n&1&&(He(0,"bim-panel-section",0),Zr(1,u3,1,1,"bim-button",1,Su),dt(3,p3,2,1,"p",2),He(4,"bim-button",3),rt("click",function(){return r.showSpaceElementAdjacencies()}),We(),He(5,"bim-button",4),rt("click",function(){return r.showSpaceElementContainments()}),We(),He(6,"bim-button",5),rt("click",function(){return r.reset()}),We()()),n&2&&(Ge(),Qr(r.methods),Ge(2),Le("ngIf",r.resultCount()!==void 0))},dependencies:[at,bt,Ks],encapsulation:2});let s=e;return s})();var fI=(()=>{let e=class e{constructor(){this._state=qe(vt),this._queryService=qe(Pt),this.position={x:0,y:0,z:0},this.direction={x:0,y:1,z:0}}show(i,n,r,o,a,l){return ie(this,null,function*(){let c=new ce(i,n,r),d=new ce(o,a,l);this._state.addArrow({point:c,direction:d,length:2}),console.log(c),console.log(d)})}reset(){this._state.removeArrows()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-arrow-tool"]],standalone:!0,features:[st],decls:15,vars:6,consts:[["pointX",""],["pointY",""],["pointZ",""],["dirX",""],["dirY",""],["dirZ",""],["label","Arrow","collapsed","false"],["label","Point x",3,"value"],["label","Point y",3,"value"],["label","Point z",3,"value"],["label","Direction x",3,"value"],["label","Direction y",3,"value"],["label","Direction z",3,"value"],["label","Add",3,"click"],["label","Remove all",3,"click"]],template:function(n,r){if(n&1){let o=mt();He(0,"bim-panel-section",6),_t(1,"bim-number-input",7,0)(3,"bim-number-input",8,1)(5,"bim-number-input",9,2)(7,"bim-number-input",10,3)(9,"bim-number-input",11,4)(11,"bim-number-input",12,5),He(13,"bim-button",13),rt("click",function(){pt(o);let l=kn(2),c=kn(4),d=kn(6),h=kn(8),u=kn(10),p=kn(12);return ft(r.show(l.value,c.value,d.value,h.value,u.value,p.value))}),We(),He(14,"bim-button",14),rt("click",function(){return pt(o),ft(r.reset())}),We()()}n&2&&(Ge(),Le("value",r.position.x),Ge(2),Le("value",r.position.y),Ge(2),Le("value",r.position.z),Ge(2),Le("value",r.direction.x),Ge(2),Le("value",r.direction.y),Ge(2),Le("value",r.direction.z))},dependencies:[at,Ks],encapsulation:2});let s=e;return s})();function f3(s,e){s&1&&(He(0,"span"),fn(1,"Select exactly one element"),We())}function m3(s,e){if(s&1){let t=mt();$n(0),He(1,"bim-button",2),rt("click",function(){pt(t);let n=Ze();return ft(n.showOOBB())}),We(),He(2,"bim-button",3),rt("click",function(){pt(t);let n=Ze();return ft(n.calculateOrientation())}),We(),Zn()}}var mI=(()=>{let e=class e{constructor(){this._state=qe(vt),this._queryService=qe(Pt),this.settings=Fi.required(),this.selection=this._state.selectedElements,this.instanceNamespace=zi(()=>this.settings().querySettings?.instanceNamespace),this.elementIRI=zi(()=>{let i=this.selection()[0].elementUUID;if(i!==void 0)return`${this.instanceNamespace()}${i}`}),this.position={x:0,y:0,z:0},this.direction={x:0,y:1,z:0}}showOOBB(){return ie(this,null,function*(){let i=this.elementIRI();if(i===void 0)throw new Error("Element has no UUID");(yield this._queryService.execute("get-element-oobbs",{elementIRI:i})).forEach(r=>{this._state.addBox(r)})})}calculateOrientation(i=!0){return ie(this,null,function*(){let n=this.elementIRI();if(n===void 0)throw new Error("Element has no UUID");let[r,o]=yield Promise.all([this._queryService.execute("get-element-oobbs",{elementIRI:n}),this._queryService.execute("get-adjacent-space-centroids",{elementIRI:n})]),a=Wu(r);if(!o.length)throw new Error("Element has no adjacent space");if(o.length>1){let u=!0;for(let p in o){if(p==="0")continue;if(!TE(a,o[parseInt(p)-1],o[parseInt(p)])){u=!1;break}}if(!u)throw new Error("Element is adjacent to spaces on opposite sides of the element")}let l=o[0],c=a.getCenter(new ce),d=OE(a,l);if(!d)throw new Error("Couldn't calculate face normal");let h=ME(d);if(console.log("Orientation: "+h),i){this._state.addBox(a);let u=new Mr("red");u.size=.2;let p=new ps(`POINT Z(${c.x} ${c.y} ${c.z})`,u);p.transformYZ=!1;let f=new ps(`POINT Z(${l.x} ${l.y} ${l.z})`,u);f.transformYZ=!1,this._state.addWKT([p,f]),PE(a).forEach(m=>{let{normal:g,center:b}=m;this._state.addArrow(new Wh(b,g,1))}),this._state.addArrow(new Wh(c,d,2,new zt("red")))}})}reset(){this._state.removeArrows()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-selection-tools"]],inputs:{settings:[1,"settings"]},standalone:!0,features:[st],decls:3,vars:2,consts:[["label","Selection","collapsed","false"],[4,"ngIf"],["label","Show OOBB",3,"click"],["label","Calculate orientation",3,"click"]],template:function(n,r){n&1&&(He(0,"bim-panel-section",0),dt(1,f3,2,0,"span",1)(2,m3,3,0,"ng-container",1),We()),n&2&&(Ge(),Le("ngIf",r.selection().length!==1),Ge(),Le("ngIf",r.selection().length===1))},dependencies:[at,bt,Ks],encapsulation:2});let s=e;return s})();function g3(s,e){if(s&1){let t=mt();He(0,"lib-draggable-panel",3),rt("clickedClose",function(){pt(t);let n=Ze();return ft(n.toggleShow())}),He(1,"bim-panel"),_t(2,"lib-selection-tools",4)(3,"lib-wkt-tools")(4,"lib-qa-tools")(5,"lib-arrow-tool"),We()()}if(s&2){let t=Ze();Le("position",t.panelPosition),Ge(2),Le("settings",t.settings())}}var gI=(()=>{let e=class e{constructor(){this._queryService=qe(Pt),this.settings=Fi.required(),this.adminToolsVisible=Ft(!1),this.panelPosition=us.BottomRight,this._queryService.addQueryDefinitions(rI)}toggleShow(){let i=this.adminToolsVisible();this.adminToolsVisible.set(!i)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-admin"]],inputs:{settings:[1,"settings"]},standalone:!0,features:[st],decls:3,vars:2,consts:[["label","Admin tools","icon","ri:admin-line"],["label","Show","icon","material-symbols:visibility",3,"click","active"],["label","Admin tools",3,"position","clickedClose",4,"ngIf"],["label","Admin tools",3,"clickedClose","position"],[3,"settings"]],template:function(n,r){n&1&&(He(0,"bim-toolbar-section",0)(1,"bim-button",1),rt("click",function(){return r.toggleShow()}),We()(),dt(2,g3,6,2,"lib-draggable-panel",2)),n&2&&(Ge(),Le("active",r.adminToolsVisible()),Ge(),Le("ngIf",r.adminToolsVisible()))},dependencies:[at,bt,ar,Ks,uI,pI,fI,mI],encapsulation:2});let s=e;return s})();function b3(s,e){s&1&&_t(0,"lib-visibility",4)}function v3(s,e){s&1&&_t(0,"lib-sections",4)}function y3(s,e){s&1&&_t(0,"lib-measure")}function _3(s,e){if(s&1&&_t(0,"lib-admin",5),s&2){let t=Ze();Le("settings",t.settings())}}var bI=(()=>{let e=class e{constructor(){this.settings=Fi.required(),this.showToolbar=zi(()=>this.settings().visibility.ui.toolbar.visibility.enabled),this.showSectionsSection=zi(()=>this.settings().visibility.ui.toolbar.showSectionsSection),this.showMeasureSection=zi(()=>this.settings().visibility.ui.toolbar.showMeasureSection),this.showAdminSection=zi(()=>this.settings().visibility.ui.toolbar.showAdminSection)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-toolbar"]],inputs:{settings:[1,"settings"]},standalone:!0,features:[st],decls:5,vars:4,consts:[[1,"tb"],["class","section",4,"ngIf"],[4,"ngIf"],[3,"settings",4,"ngIf"],[1,"section"],[3,"settings"]],template:function(n,r){n&1&&(He(0,"bim-toolbar",0),dt(1,b3,1,0,"lib-visibility",1)(2,v3,1,0,"lib-sections",1)(3,y3,1,0,"lib-measure",2)(4,_3,1,1,"lib-admin",3),We()),n&2&&(Ge(),Le("ngIf",r.showToolbar()),Ge(),Le("ngIf",r.showSectionsSection()),Ge(),Le("ngIf",r.showMeasureSection()),Ge(),Le("ngIf",r.showAdminSection()))},dependencies:[at,bt,IA,TA,PA,gI],styles:[".section[_ngcontent-%COMP%]{border-right:1px solid var(--bim-ui_bg-contrast-20)}.tb[_ngcontent-%COMP%]{border-color:var(--mdc-elevated-card-container-color);box-shadow:var(--mdc-elevated-card-container-elevation)}"]});let s=e;return s})();function w3(s,e){if(s&1){let t=mt();He(0,"bim-button",1),rt("click",function(){pt(t);let n=Ze();return ft(n.hideSelection())}),We()}}var vI=(()=>{let e=class e{constructor(){this._state=qe(vt),this.executed=new Vt,this.selectedElements=this._state.selectedElements}hideSelection(){let i=this.selectedElements().map(n=>n.elementUUID);i!==void 0&&(this._state.hideElements(i),this.executed.emit())}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-hide-element"]],outputs:{executed:"executed"},standalone:!0,features:[st],decls:1,vars:1,consts:[["label","Hide selection","icon","mdi:hide-outline",3,"click",4,"ngIf"],["label","Hide selection","icon","mdi:hide-outline",3,"click"]],template:function(n,r){n&1&&dt(0,w3,1,0,"bim-button",0),n&2&&Le("ngIf",r.selectedElements().length)},dependencies:[at,bt]});let s=e;return s})();function E3(s,e){if(s&1){let t=mt();He(0,"bim-button",1),rt("click",function(){pt(t);let n=Ze();return ft(n.unhideAll())}),We()}}var yI=(()=>{let e=class e{constructor(){this._state=qe(vt),this.executed=new Vt,this.somethingToUnhide=zi(()=>!!(this._state.hiddenElements().length||this._state.isolatedElements().length||this._state.focusedElements().length||this._state.transparentElements().length))}unhideAll(){this._state.hiddenElements=[],this._state.setFocusedElements([]),this.executed.emit()}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-unhide-all"]],outputs:{executed:"executed"},standalone:!0,features:[st],decls:1,vars:1,consts:[["label","Unhide all","icon","mdi:show-outline",3,"click",4,"ngIf"],["label","Unhide all","icon","mdi:show-outline",3,"click"]],template:function(n,r){n&1&&dt(0,E3,1,0,"bim-button",0),n&2&&Le("ngIf",r.somethingToUnhide())},dependencies:[at,bt]});let s=e;return s})();function C3(s,e){if(s&1){let t=mt();He(0,"bim-button",1),rt("click",function(){pt(t);let n=Ze();return ft(n.isolateSelection())}),We()}}var _I=(()=>{let e=class e{constructor(){this._state=qe(vt),this.executed=new Vt,this.selectedElements=this._state.selectedElements}isolateSelection(){let i=this.selectedElements().map(n=>n.elementUUID);i!==void 0&&(this._state.setIsolatedElements(i),this.executed.emit())}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-isolate-element"]],outputs:{executed:"executed"},standalone:!0,features:[st],decls:1,vars:1,consts:[["label","Isolate selection","icon","mdi:show-outline",3,"click",4,"ngIf"],["label","Isolate selection","icon","mdi:show-outline",3,"click"]],template:function(n,r){n&1&&dt(0,C3,1,0,"bim-button",0),n&2&&Le("ngIf",r.selectedElements().length)},dependencies:[at,bt]});let s=e;return s})();var wI=[{id:"list-upstream",query:`SELECT ?source ?target WHERE {
        BIND(<{{elementIRI}}> AS ?source)
        ?system a fso:DistributionSystem ;
            fso:hasComponent ?source , ?target .
        ?source fso:hasFluidSuppliedBy+ ?target
        }`,postProcessing:$v},{id:"list-downstream",query:`SELECT ?source ?target WHERE {
        BIND(<{{elementIRI}}> AS ?source)
        ?system a fso:DistributionSystem ;
            fso:hasComponent ?source , ?target .
        ?source fso:suppliesFluidTo+ ?target
        }`,postProcessing:$v},{id:"list-connected",query:`SELECT ?source ?target WHERE {
        BIND(<{{elementIRI}}> AS ?source)
        ?system a fso:DistributionSystem ;
            fso:hasComponent ?source , ?target .
        ?source fso:connectedWith+ ?target
        }`,postProcessing:$v}];function $v(s){if(s.results===void 0)return[];let e=new Set;return s.results.bindings.map(t=>{let i=t.source.value.split("/").pop(),n=t.target.value.split("/").pop();i!==void 0&&e.add(i),n!==void 0&&e.add(n)}),Array.from(e)}var EI=(()=>{let e=class e{constructor(){this._queryService=qe(Pt),this._state=qe(vt),this.settings=new qt}showUpstream(){return ie(this,null,function*(){if(this.menuElement===void 0)return;let i=`${this.settings.querySettings?.instanceNamespace}${this.menuElement.elementUUID}`,n=yield this._queryService.execute("list-upstream",{elementIRI:i});yield this._state.setSelectedElements(n)})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-show-upstream"]],inputs:{settings:"settings",menuElement:"menuElement"},standalone:!0,features:[st],decls:1,vars:0,consts:[["label","Show upstream","icon","mdi:show-outline",3,"click"]],template:function(n,r){n&1&&(He(0,"bim-button",0),rt("click",function(){return r.showUpstream()}),We())},dependencies:[at],encapsulation:2});let s=e;return s})();var CI=(()=>{let e=class e{constructor(){this._queryService=qe(Pt),this._state=qe(vt),this.settings=new qt}showDownstream(){return ie(this,null,function*(){if(this.menuElement===void 0)return;let i=`${this.settings.querySettings?.instanceNamespace}${this.menuElement.elementUUID}`,n=yield this._queryService.execute("list-downstream",{elementIRI:i});yield this._state.setSelectedElements(n)})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-show-downstream"]],inputs:{settings:"settings",menuElement:"menuElement"},standalone:!0,features:[st],decls:1,vars:0,consts:[["label","Show downstream","icon","mdi:show-outline",3,"click"]],template:function(n,r){n&1&&(He(0,"bim-button",0),rt("click",function(){return r.showDownstream()}),We())},dependencies:[at],encapsulation:2});let s=e;return s})();var xI=(()=>{let e=class e{constructor(){this._queryService=qe(Pt),this._state=qe(vt),this.settings=new qt}showConnected(){return ie(this,null,function*(){if(this.menuElement===void 0)return;let i=`${this.settings.querySettings?.instanceNamespace}${this.menuElement.elementUUID}`,n=yield this._queryService.execute("list-connected",{elementIRI:i});yield this._state.setSelectedElements(n)})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-show-connected"]],inputs:{settings:"settings",menuElement:"menuElement"},standalone:!0,features:[st],decls:1,vars:0,consts:[["label","Show connected","icon","mdi:show-outline",3,"click"]],template:function(n,r){n&1&&(He(0,"bim-button",0),rt("click",function(){return r.showConnected()}),We())},dependencies:[at],encapsulation:2});let s=e;return s})();var SI=(()=>{let e=class e{constructor(){this._queryService=qe(Pt),this.settings=new qt}ngOnInit(){this._queryService.addQueryDefinitions(wI)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-mep"]],inputs:{settings:"settings",menuElement:"menuElement"},standalone:!0,features:[st],decls:3,vars:6,consts:[[3,"settings","menuElement"]],template:function(n,r){n&1&&_t(0,"lib-show-upstream",0)(1,"lib-show-downstream",0)(2,"lib-show-connected",0),n&2&&(Le("settings",r.settings)("menuElement",r.menuElement),Ge(),Le("settings",r.settings)("menuElement",r.menuElement),Ge(),Le("settings",r.settings)("menuElement",r.menuElement))},dependencies:[at,EI,CI,xI],encapsulation:2});let s=e;return s})();function x3(s,e){if(s&1){let t=mt();He(0,"bim-button",1),rt("click",function(){pt(t);let n=Ze();return ft(n.focusSelection())}),We()}}var AI=(()=>{let e=class e{constructor(){this._state=qe(vt),this.executed=new Vt,this.selectedElements=this._state.selectedElements}focusSelection(){return ie(this,null,function*(){let i=this.selectedElements().map(n=>n.elementUUID);i!==void 0&&(yield this._state.setFocusedElements(i),this.executed.emit())})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-focus-element"]],outputs:{executed:"executed"},standalone:!0,features:[st],decls:1,vars:1,consts:[["label","Focus selection","icon","mdi:show-outline",3,"click",4,"ngIf"],["label","Focus selection","icon","mdi:show-outline",3,"click"]],template:function(n,r){n&1&&dt(0,x3,1,0,"bim-button",0),n&2&&Le("ngIf",r.selectedElements().length)},dependencies:[at,bt]});let s=e;return s})();function S3(s,e){if(s&1){let t=mt();He(0,"lib-hide-element",4),rt("executed",function(){pt(t);let n=Ze(2);return ft(n.hideMenu())}),We()}}function A3(s,e){if(s&1){let t=mt();He(0,"lib-unhide-all",4),rt("executed",function(){pt(t);let n=Ze(2);return ft(n.hideMenu())}),We()}}function I3(s,e){if(s&1){let t=mt();He(0,"lib-isolate-element",4),rt("executed",function(){pt(t);let n=Ze(2);return ft(n.hideMenu())}),We()}}function T3(s,e){if(s&1){let t=mt();He(0,"lib-focus-element",4),rt("executed",function(){pt(t);let n=Ze(2);return ft(n.hideMenu())}),We()}}function P3(s,e){if(s&1&&($n(0),_t(1,"hr")(2,"lib-mep",5),Zn()),s&2){let t=Ze(2);Ge(2),Le("settings",t.settings)("menuElement",t.menuElement)}}function O3(s,e){if(s&1){let t=mt();He(0,"div",1),rt("clickOutside",function(){pt(t);let n=Ze();return ft(n.hideMenu())}),dt(1,S3,1,0,"lib-hide-element",2)(2,A3,1,0,"lib-unhide-all",2)(3,I3,1,0,"lib-isolate-element",2)(4,T3,1,0,"lib-focus-element",2)(5,P3,3,2,"ng-container",3),We()}if(s&2){let t=Ze();$r("left",t.clickCoordinate.x)("top",t.clickCoordinate.y),Ge(),Le("ngIf",t.settings.visibility.ui.contextMenu.showHideElementOption),Ge(),Le("ngIf",t.settings.visibility.ui.contextMenu.showHideElementOption),Ge(),Le("ngIf",t.settings.visibility.ui.contextMenu.showIsolateElementOption),Ge(),Le("ngIf",t.settings.visibility.ui.contextMenu.showFocusElementOption),Ge(),Le("ngIf",t.queryEndpointProvided())}}function M3(s,e){if(s&1){let t=mt();He(0,"lib-unhide-all",4),rt("executed",function(){pt(t);let n=Ze(2);return ft(n.hideMenu())}),We()}}function R3(s,e){if(s&1){let t=mt();He(0,"bim-panel",1),rt("clickOutside",function(){pt(t);let n=Ze();return ft(n.hideMenu())}),dt(1,M3,1,0,"lib-unhide-all",2),We()}if(s&2){let t=Ze();$r("left",t.clickCoordinate.x)("top",t.clickCoordinate.y),Ge(),Le("ngIf",t.settings.visibility.ui.contextMenu.showHideElementOption)}}var II=(()=>{let e=class e{constructor(){this._state=qe(vt),this.settings=new qt,this.displayElementContextMenu=Ft(!1),this.displayCanvasContextMenu=Ft(!1),this.clickCoordinate={x:"0",y:"0"},this.queryEndpointProvided=Ft(!1)}ngOnInit(){let i=so.getInstance();i.events.addListener("shortPressedRight",n=>{console.log("SHORT"),this.clickCoordinate={x:`${n.offsetX}px`,y:`${n.offsetY}px`};let r=this._state.hoveredElement()!==void 0||this._state.selectedElements().length!==0;this.displayElementContextMenu.set(r),r&&(this.menuElement=this._state.selectedElements()[0]),r||this.displayCanvasContextMenu.set(!0)}),i.events.addListener("longPressedRight",()=>this.hideMenu())}ngOnChanges(i){"settings"in i&&(this.settings.querySettings!==void 0?this.queryEndpointProvided.set(!0):this.queryEndpointProvided.set(!1))}hideMenu(){this.displayElementContextMenu.set(!1),this.displayCanvasContextMenu.set(!1)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-context-menu"]],inputs:{settings:"settings"},standalone:!0,features:[Tn,st],decls:2,vars:2,consts:[["libClickOutside","","class","container",3,"left","top","clickOutside",4,"ngIf"],["libClickOutside","",1,"container",3,"clickOutside"],[3,"executed",4,"ngIf"],[4,"ngIf"],[3,"executed"],[3,"settings","menuElement"]],template:function(n,r){n&1&&dt(0,O3,6,9,"div",0)(1,R3,2,5,"bim-panel",0),n&2&&(Le("ngIf",r.displayElementContextMenu()&&r.settings.visibility.ui.contextMenu.enabled),Ge(),Le("ngIf",r.displayCanvasContextMenu()&&r.settings.visibility.ui.contextMenu.enabled))},dependencies:[at,bt,Yu,vI,yI,_I,AI,SI],styles:[".container[_ngcontent-%COMP%]{position:absolute}"]});let s=e;return s})();var TI=[{id:"list-models",query:"SELECT ?s ?name WHERE {?s a omg:GeometryContext ; qcy:hasLocation ?loc . ?loc qcy:name ?name}",postProcessing:s=>s.results.bindings.map(e=>({iri:e.s.value,name:e.name.value}))}];var D3=(s,e)=>e.iri;function L3(s,e){if(s&1){let t=mt();He(0,"bim-button",8),rt("click",function(){pt(t);let n=Ze(2).$implicit,r=Ze(2);return ft(r.hide(n))}),We()}}function F3(s,e){if(s&1){let t=mt();He(0,"bim-button",9),rt("click",function(){pt(t);let n=Ze(2).$implicit,r=Ze(2);return ft(r.unhide(n))}),We()}}function k3(s,e){if(s&1){let t=mt();$n(0),dt(1,L3,1,0,"bim-button",5)(2,F3,1,0,"bim-button",6),He(3,"bim-button",7),rt("click",function(){pt(t);let n=Ze().$implicit,r=Ze(2);return ft(r.remove(n))}),We(),Zn()}if(s&2){let t=Ze().$implicit;Ge(),Le("ngIf",t.visible),Ge(),Le("ngIf",!t.visible)}}function N3(s,e){if(s&1){let t=mt();$n(0),He(1,"bim-button",10),rt("click",function(){pt(t);let n=Ze().$implicit,r=Ze(2);return ft(r.load(n))}),We(),Zn()}}function U3(s,e){s&1&&($n(0),_t(1,"bim-button",11),Zn())}function B3(s,e){if(s&1){let t=mt();He(0,"div",2)(1,"span",3),rt("click",function(){let n=pt(t).$implicit,r=Ze(2);return ft(r.setSelected(n.modelUUID))}),fn(2),We(),He(3,"div",2),dt(4,k3,4,2,"ng-container",4)(5,N3,2,0,"ng-container",4)(6,U3,2,0,"ng-container",4),We()()}if(s&2){let t=e.$implicit,i=Ze(2);Ge(),xu("clickable",t.loaded)("selected",i.selectedModel()===t.modelUUID),Ge(),Jo(t.name),Ge(2),Le("ngIf",t.loaded),Ge(),Le("ngIf",!t.loaded&&!t.modelLoading),Ge(),Le("ngIf",t.modelLoading)}}function z3(s,e){if(s&1){let t=mt();He(0,"lib-draggable-panel",1),rt("clickedClose",function(){pt(t);let n=Ze();return ft(n.visible=!1)}),Zr(1,B3,7,8,"div",2,D3),We()}if(s&2){let t=Ze();Le("position",t.panelPosition),Ge(),Qr(t.projectModels())}}var PI=(()=>{let e=class e{constructor(){this._service=qe(yn),this._state=qe(vt),this._queryService=qe(Pt),this.settings=new qt,this.available=this._queryService.available,this.panelPosition=us.TopLeft,this.visible=!0,this._serverModels=[],this.projectModels=Ft([]),this.selectedModel=this._state.selectedModel,this._queryService.addQueryDefinitions(TI),Gt(()=>{this._service.world()!==void 0&&(this._idMapping=this._service.components.get(gn),this._loader=this._service.components.get(Ea))}),Gt(()=>ie(this,null,function*(){this.available()&&(this._serverModels=yield this._queryService.execute("list-models"),this._updateList())})),Gt(()=>{this._state.loadedModels(),this._updateList()},{allowSignalWrites:!0})}ngOnDestroy(){this._serverModels=[]}hide(i){if(i.fragmentGroup===void 0)throw new Error("Fragment Group not available");i.visible=!1,this._state.setModelVisibility(!1,i.modelUUID)}unhide(i){if(i.fragmentGroup===void 0)throw new Error("Fragment Group not available");i.visible=!0,this._state.setModelVisibility(!0,i.modelUUID)}load(i){return ie(this,null,function*(){if(this._loader===void 0)throw new Error("Model loader not available");if(this.settings.querySettings?.spaceId===void 0)throw new Error("Space id not available");i.modelLoading=!0,yield this._loader?.resourceLoad(this.settings.querySettings.spaceId,i.modelUUID),i.modelLoading=!1,i.loaded=!0,i.visible=!0})}remove(i){if(this._loader===void 0)throw new Error("Model loader not available");this._loader.unloadModel(i.modelUUID),i.loaded=!1,i.visible=!1}setSelected(i){this.projectModels().find(r=>r.modelUUID===i)?.loaded&&(this._state.selectedModel=i)}_updateList(){let i=[];this._serverModels.forEach(n=>{let r=n.iri.split("/").pop();if(r===void 0)return;let o=this._state.loadedModels().includes(r)??!1,a=this._idMapping?.getFragmentsGroupFromModelUUID(r),l=a?.visible??!1;i.push(yt(Se({},n),{loaded:o,modelUUID:r,visible:l,fragmentGroup:a}))}),this.projectModels.update(()=>i)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-project-models"]],inputs:{settings:"settings"},standalone:!0,features:[st],decls:1,vars:1,consts:[["label","Project models",3,"position","clickedClose",4,"ngIf"],["label","Project models",3,"clickedClose","position"],[1,"row"],[1,"model-name",3,"click"],[4,"ngIf"],["icon","mdi:show-outline","tooltip-title","Hide",3,"click",4,"ngIf"],["icon","mdi:hide-outline","tooltip-title","Unhide",3,"click",4,"ngIf"],["icon","mdi:delete-outline","tooltip-title","Delete",3,"click"],["icon","mdi:show-outline","tooltip-title","Hide",3,"click"],["icon","mdi:hide-outline","tooltip-title","Unhide",3,"click"],["icon","mdi:cloud-download-outline","tooltip-title","Load",3,"click"],["icon","eos-icons:three-dots-loading","tooltip-title","Loading","tooltip-text","The geometry definition is being set. Once this is ready the model geometries will start to appear in the scene"]],template:function(n,r){n&1&&dt(0,z3,3,1,"lib-draggable-panel",0),n&2&&Le("ngIf",r.projectModels().length&&r.visible&&r.settings.visibility.ui.showProjectModels)},dependencies:[at,bt,ar],styles:[".row[_ngcontent-%COMP%]{display:flex;flex-direction:row;padding:.2rem .5rem;justify-content:space-between;align-items:center;gap:.2rem}.model-name[_ngcontent-%COMP%]{margin-right:1rem;font-size:.8rem}.selected[_ngcontent-%COMP%]{border:1px solid var(--borderColor-default);border-radius:5px}"]});let s=e;return s})();var V3=IE.getInstance(),OI=[{id:"get-element-properties",query:`SELECT * WHERE {
            <{{elementIRI}}> dicv:hasProperty ?p .
            ?p dicv:hasValue ?pKey ;
                dicv:hasPropertyState ?ps .
            ?ps dicv:hasValue ?pVal
        }`,postProcessing:s=>{let e=new Set,t={};if(s?.results?.bindings===void 0)return[];s.results.bindings.forEach(n=>{let r=n.pKey.value,o=r.split("@")[0],a=r.split("@")[1]??"General";e.has(a)||(e.add(a),t[a]=[]),t[a].push({value:n.pVal.value,property:o,pSet:a})});let i=[{data:{Name:"Properties"},children:[]}];return Array.from(e).sort().forEach(n=>{let r=t[n].map(o=>({data:{Name:o.property,Value:o.value}}));i[0].children.push({data:{Name:n},children:r})}),i}},{id:"get-direct-properties",query:`SELECT * 
        WHERE {
            BIND(<{{elementIRI}}> as ?iri)
            {?iri qcy:name ?name}
            UNION
            {?iri schema:name ?name}
            UNION
            {?iri qcy:number ?number}
            UNION
            {?iri qcy:elevation ?elevation}
        }`,postProcessing:s=>{if(s?.results?.bindings===void 0)return[];let e=[];return s.results.bindings.forEach(t=>{["name","number","elevation"].forEach(i=>{t[i]?.value!==void 0&&e.push({property:i,value:t[i].value})})}),e}},{id:"get-element-classes",query:"SELECT DISTINCT ?iri WHERE {<{{elementIRI}}> a ?iri}",postProcessing:s=>s?.results?.bindings===void 0?[]:s.results.bindings.map(e=>({iri:e.iri.value,label:V3.compactIRI(e.iri.value)}))},{id:"get-element-systems",query:`SELECT ?iri ?label
        WHERE {
        ?iri a fso:DistributionSystem ;
            fso:hasComponent <{{elementIRI}}> ;
            rdfs:label ?label
        }`,postProcessing:s=>s?.results?.bindings===void 0?[]:s.results.bindings.map(e=>({iri:e.iri.value,label:e.label.value}))},{id:"get-element-type",query:`SELECT ?iri ?label ?d
        WHERE {
            <{{elementIRI}}> bpo:realisesObject ?iri .
            ?iri schema:name ?label
            OPTIONAL{?iri schema:depth ?d}
        }`,postProcessing:s=>s?.results?.bindings===void 0?[]:s.results.bindings.map(e=>{let t=e.d?.value,i=e.label.value;return t!==void 0&&(i+=` (d=${parseFloat(t)})`),{iri:e.iri.value,label:i}})},{id:"get-element-volumes",query:`SELECT *
        WHERE {
            <{{elementIRI}}> omg:hasGeometry ?gt .
            ?gt omg:transformsGeometry ?iri ;
                obc:transformation ?t ;
                obc:color ?c .
            ?iri obc:bvhVolume ?v ;
                obc:oobb ?oobb ;
                obc:hasHoles ?hh
        }`,postProcessing:s=>s?.results?.bindings===void 0?[]:s.results.bindings.map(e=>{let t=parseFloat(e.v.value);return{iri:e.iri.value,volume:t,oobb:e.oobb.value,color:e.c.value,transformation:e.t.value,hasHoles:e.hh.value==="true"}})},{id:"get-product-materials",query:`SELECT ?iri ?material ?label ?thickness
        WHERE{
            BIND(<{{productIRI}}> AS ?product)
            ?product bpo:consistsOf ?iri .
            ?iri schema:name ?label ;
                schema:material ?material .
            OPTIONAL{?iri schema:depth ?thickness}
        }`,postProcessing:s=>s?.results?.bindings===void 0?[]:s.results.bindings.map(e=>{let t=e.thickness?.value?parseFloat(e.thickness?.value):void 0,i=e.label.value;return t!==void 0&&(i+=` (d=${t})`),{iri:e.iri.value,label:i,material:e.material.value,thickness:t}})},{id:"get-all-of-type",query:"SELECT ?iri WHERE { ?iri bpo:realisesObject <{{typeIRI}}> }",postProcessing:s=>s?.results?.bindings===void 0?[]:s.results.bindings.map(e=>({iri:e.iri.value,label:""}))},{id:"get-system-components",query:"SELECT ?iri WHERE { <{{systemIRI}}> fso:hasComponent ?iri }",postProcessing:s=>s?.results?.bindings===void 0?[]:s.results.bindings.map(e=>({iri:e.iri.value,label:""}))}];var j3=["table"];function H3(s,e){if(s&1&&_t(0,"bim-table",2,0),s&2){let t=Ze();Le("data",t.systemTable)}}var MI=(()=>{let e=class e{constructor(){this._queryService=qe(Pt),this._state=qe(vt),this.elementIRI=Fi.required(),this.systemList=[],this.systemTable=[],this.onElementChange=Gt(()=>{this._getSystems()})}set chipTable(i){if(i){let n=i.nativeElement;this._initEventListeners(n)}}ngOnDestroy(){this.systemList=[],this.systemTable=[]}_getSystems(){return ie(this,null,function*(){this.systemList=yield this._queryService.execute("get-element-systems",{elementIRI:this.elementIRI()});let i=this.systemList.map(r=>({data:{Name:`${r.label}`}})),n=[{data:{Name:"Systems"},children:i}];this.systemTable=n})}_getSystemComponents(i){return ie(this,null,function*(){let r=(yield this._queryService.execute("get-system-components",{systemIRI:i})).map(o=>o.iri.split("/").pop()??"");yield this._state.setSelectedElements(r)})}_initEventListeners(i){i.addEventListener("rowcreated",n=>{}),i.addEventListener("cellcreated",n=>{let{cell:r}=n.detail;if(r.column==="Name"){let o=r.getElementsByTagName("bim-label")[0],a=this.systemList.find(l=>l.label===o.innerHTML);if(a===void 0)return;r.style.cursor="pointer",r.addEventListener("click",l=>{l.stopImmediatePropagation(),this._getSystemComponents(a?.iri)})}})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-system-table"]],viewQuery:function(n,r){if(n&1&&fi(j3,5),n&2){let o;mi(o=gi())&&(r.chipTable=o.first)}},inputs:{elementIRI:[1,"elementIRI"]},standalone:!0,features:[st],decls:1,vars:1,consts:[["table",""],["headers-hidden","",3,"data",4,"ngIf"],["headers-hidden","",3,"data"]],template:function(n,r){n&1&&dt(0,H3,2,1,"bim-table",1),n&2&&Le("ngIf",r.systemList.length)},dependencies:[at,bt],encapsulation:2});let s=e;return s})();var G3=["table"];function W3(s,e){if(s&1&&_t(0,"bim-table",2,0),s&2){let t=Ze();Le("data",t.tableData)}}var RI=(()=>{let e=class e{constructor(){this._queryService=qe(Pt),this.elementIRI=Fi.required(),this.entryList=[],this.tableData=[],this.onElementChange=Gt(()=>{this._getClasses()})}set chipTable(i){if(i){let n=i.nativeElement;this._initEventListeners(n)}}ngOnDestroy(){this.entryList=[],this.tableData=[]}_getClasses(){return ie(this,null,function*(){this.entryList=yield this._queryService.execute("get-element-classes",{elementIRI:this.elementIRI()});let i=this.entryList.map(r=>({data:{Name:`${r.label}`}})),n=[{data:{Name:"Classes"},children:i}];this.tableData=n})}_initEventListeners(i){i.addEventListener("rowcreated",n=>{}),i.addEventListener("cellcreated",n=>{let{cell:r}=n.detail;if(r.column==="Name"){let o=r.getElementsByTagName("bim-label")[0],a=this.entryList.find(l=>l.label===o.innerHTML);a!==void 0&&(o.classList.add("chip"),o.id=a.iri,o.style.backgroundColor="var(--bim-ui_main-base)",o.style.padding="0.1rem 0.25rem",o.style.color="var(--bim-ui_main-contrast)",o.style.borderRadius="0.25rem")}})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-class-table"]],viewQuery:function(n,r){if(n&1&&fi(G3,5),n&2){let o;mi(o=gi())&&(r.chipTable=o.first)}},inputs:{elementIRI:[1,"elementIRI"]},standalone:!0,features:[st],decls:1,vars:1,consts:[["table",""],["headers-hidden","",3,"data",4,"ngIf"],["headers-hidden","",3,"data"]],template:function(n,r){n&1&&dt(0,W3,2,1,"bim-table",1),n&2&&Le("ngIf",r.entryList.length)},dependencies:[at,bt],encapsulation:2});let s=e;return s})();var Y3=["table"],DI=(()=>{let e=class e{constructor(){this._queryService=qe(Pt),this.elementIRI=Fi.required(),this.tableData=[],this.onElementChange=Gt(()=>{this._getProperties()})}set chipTable(i){if(i){let n=i.nativeElement;this._initEventListeners(n)}}ngOnDestroy(){this.tableData=[]}_getProperties(){return ie(this,null,function*(){this.tableData=yield this._queryService.execute("get-element-properties",{elementIRI:this.elementIRI()})})}_initEventListeners(i){i.addEventListener("rowcreated",n=>{}),i.addEventListener("cellcreated",n=>{})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-property-table"]],viewQuery:function(n,r){if(n&1&&fi(Y3,5),n&2){let o;mi(o=gi())&&(r.chipTable=o.first)}},inputs:{elementIRI:[1,"elementIRI"]},standalone:!0,features:[st],decls:2,vars:1,consts:[["table",""],["headers-hidden","",3,"data"]],template:function(n,r){n&1&&_t(0,"bim-table",1,0),n&2&&Le("data",r.tableData)},dependencies:[at],encapsulation:2});let s=e;return s})();var q3=["table"];function X3(s,e){if(s&1&&_t(0,"bim-table",2,0),s&2){let t=Ze();Le("data",t.tableData)("hiddenColumns",t.hiddenColumns)}}var LI=(()=>{let e=class e{constructor(){this._state=qe(vt),this.elementIRI=Fi.required(),this.hiddenColumns=["iri","type"],this.entryList=[],this.tableData=[],this.onElementChange=Gt(()=>{this._getDocuments()})}set chipTable(i){if(i){let n=i.nativeElement;this._initEventListeners(n)}}ngOnDestroy(){this.entryList=[],this.tableData=[]}closeDocumentWindow(){console.log("CLOSE")}_getDocuments(){return ie(this,null,function*(){})}_initEventListeners(i){i.addEventListener("rowcreated",n=>{}),i.addEventListener("cellcreated",n=>{let{cell:r}=n.detail;if("type"in r.rowData){let o=r.children[0],a="ion:document-text-outline";switch(r.rowData.type){case RE.PDF:a="mingcute:pdf-line";break;default:a="ion:document-text-outline"}o.setAttribute("icon",a),r.style.cursor="pointer",r.addEventListener("click",()=>this._state.viewedDocument=r.rowData)}})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-document-table"]],viewQuery:function(n,r){if(n&1&&fi(q3,5),n&2){let o;mi(o=gi())&&(r.chipTable=o.first)}},inputs:{elementIRI:[1,"elementIRI"]},standalone:!0,features:[st],decls:1,vars:1,consts:[["table",""],["headers-hidden","",3,"data","hiddenColumns",4,"ngIf"],["headers-hidden","",3,"data","hiddenColumns"]],template:function(n,r){n&1&&dt(0,X3,2,2,"bim-table",1),n&2&&Le("ngIf",r.tableData.length)},dependencies:[at,bt],encapsulation:2});let s=e;return s})();var K3=["table"];function $3(s,e){if(s&1&&_t(0,"bim-table",3,0),s&2){let t=Ze();Le("data",t.tableData)}}function Z3(s,e){if(s&1){let t=mt();He(0,"bim-button",4),rt("click",function(){pt(t);let n=Ze();return ft(n.selectSame())}),We()}if(s&2){let t=Ze();xw("label","Select ",t.elementsOfSameType.length," elements of same type")}}var FI=(()=>{let e=class e{constructor(){this._queryService=qe(Pt),this._state=qe(vt),this.elementIRI=Fi.required(),this.entryList=[],this.tableData=[],this.elementsOfSameType=[],this.onElementChange=Gt(()=>ie(this,null,function*(){yield this._getClasses();let i=this.entryList[0];if(i===void 0)return;let n=i.iri;yield this._getAllOfType(n)}))}set chipTable(i){if(i){let n=i.nativeElement;this._initEventListeners(n)}}ngOnDestroy(){this.entryList=[],this.tableData=[]}selectSame(){return ie(this,null,function*(){let i=this.elementsOfSameType.map(n=>n.iri.split("/").pop()??"");yield this._state.setSelectedElements(i)})}_getClasses(){return ie(this,null,function*(){this.entryList=yield this._queryService.execute("get-element-type",{elementIRI:this.elementIRI()});let i=[];this.entryList.length&&(yield this._queryService.execute("get-product-materials",{productIRI:this.entryList[0].iri})).forEach(a=>i.push({data:{Name:a.label}}));let n=this.entryList.map(o=>({data:{Name:`${o.label}`},children:i})),r=[{data:{Name:"Type data"},children:n}];this.tableData=r})}_getAllOfType(i){return ie(this,null,function*(){this.elementsOfSameType=yield this._queryService.execute("get-all-of-type",{typeIRI:i})})}_initEventListeners(i){i.addEventListener("rowcreated",n=>{}),i.addEventListener("cellcreated",n=>{let{cell:r}=n.detail;if(r.column==="Name"){let o=r.getElementsByTagName("bim-label")[0],a=this.entryList.find(l=>l.label===o.innerHTML);a!==void 0&&(o.classList.add("chip"),o.id=a.iri,o.style.backgroundColor="var(--bim-ui_main-base)",o.style.padding="0.1rem 0.25rem",o.style.color="var(--bim-ui_main-contrast)",o.style.borderRadius="0.25rem",r.style.cursor="pointer",r.addEventListener("click",l=>{l.stopImmediatePropagation(),this._state.events.emit("clickedGoToResource",a?.iri)}))}})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-type-table"]],viewQuery:function(n,r){if(n&1&&fi(K3,5),n&2){let o;mi(o=gi())&&(r.chipTable=o.first)}},inputs:{elementIRI:[1,"elementIRI"]},standalone:!0,features:[st],decls:2,vars:2,consts:[["table",""],["headers-hidden","",3,"data",4,"ngIf"],[3,"label","click",4,"ngIf"],["headers-hidden","",3,"data"],[3,"click","label"]],template:function(n,r){n&1&&dt(0,$3,2,1,"bim-table",1)(1,Z3,1,2,"bim-button",2),n&2&&(Le("ngIf",r.entryList.length),Ge(),Le("ngIf",r.elementsOfSameType.length>1))},dependencies:[at,bt],encapsulation:2});let s=e;return s})();function Q3(s,e){if(s&1&&_t(0,"bim-table",2,0),s&2){let t=Ze();Le("data",t.tableData)}}var kI=(()=>{let e=class e{constructor(){this._queryService=qe(Pt),this._state=qe(vt),this.elementIRI=Fi.required(),this.entryList=[],this.tableData=[],this.elementsOfSameType=[],this.onElementChange=Gt(()=>ie(this,null,function*(){yield this._getData();let i=this.entryList[0];if(i===void 0)return;let n=i.iri;yield this._getAllOfType(n)}))}ngOnDestroy(){this.entryList=[],this.tableData=[]}selectSame(){return ie(this,null,function*(){let i=this.elementsOfSameType.map(n=>n.iri.split("/").pop()??"");yield this._state.setSelectedElements(i)})}_getData(){return ie(this,null,function*(){let i=yield this._queryService.execute("get-element-volumes",{elementIRI:this.elementIRI()})})}_getAllOfType(i){return ie(this,null,function*(){this.elementsOfSameType=yield this._queryService.execute("get-all-of-type",{typeIRI:i})})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-geometry-table"]],inputs:{elementIRI:[1,"elementIRI"]},standalone:!0,features:[st],decls:1,vars:1,consts:[["table",""],["headers-hidden","",3,"data",4,"ngIf"],["headers-hidden","",3,"data"]],template:function(n,r){n&1&&dt(0,Q3,2,1,"bim-table",1),n&2&&Le("ngIf",r.entryList.length)},dependencies:[at,bt],encapsulation:2});let s=e;return s})();function J3(s,e){if(s&1&&(He(0,"span",4),fn(1),We()),s&2){let t=Ze(2);Ge(),Au("",t.selectionSize()," elements selected")}}function eU(s,e){if(s&1&&(He(0,"div",5)(1,"span",7),fn(2),We(),He(3,"span",8),fn(4),We()()),s&2){let t=e.$implicit;Ge(2),Jo(t.property),Ge(2),Jo(t.value)}}function tU(s,e){if(s&1&&($n(0),Zr(1,eU,5,2,"div",5,ww),_t(3,"lib-document-table",6)(4,"lib-class-table",6)(5,"lib-property-table",6)(6,"lib-system-table",6)(7,"lib-geometry-table",6)(8,"lib-type-table",6),Zn()),s&2){let t=Ze(2);Ge(),Qr(t.directProperties()),Ge(2),Le("elementIRI",t.elementIRI()),Ge(),Le("elementIRI",t.elementIRI()),Ge(),Le("elementIRI",t.elementIRI()),Ge(),Le("elementIRI",t.elementIRI()),Ge(),Le("elementIRI",t.elementIRI()),Ge(),Le("elementIRI",t.elementIRI())}}function iU(s,e){if(s&1){let t=mt();He(0,"lib-draggable-panel",1),rt("clickedClose",function(){pt(t);let n=Ze();return ft(n.hide())}),dt(1,J3,2,1,"span",2)(2,tU,9,6,"ng-container",3),We()}if(s&2){let t=Ze();Le("position",t.panelPosition),Ge(),Le("ngIf",t.selectionSize()>1),Ge(),Le("ngIf",t.elementIRI()!=="")}}var NI=(()=>{let e=class e{hide(){this._hiddenByUser.set(!0)}constructor(){this._state=qe(vt),this._queryService=qe(Pt),this._mousePressHandler=so.getInstance(),this.settings=Fi(new qt),this.instanceNamespace=zi(()=>this.settings().querySettings?.instanceNamespace),this.elementIRI=zi(()=>{let i=this._state.selectedElements();if(i.length===1){let n=i[0].elementUUID;if(n!==void 0)return`${this.instanceNamespace()}${n}`}return""}),this._hiddenByUser=Ft(!1),this.selectionSize=zi(()=>this._state.selectedElements().length),this.visible=zi(()=>this._hiddenByUser()?!1:this.selectionSize()>=1),this.directProperties=Ft([]),this.panelPosition=us.TopRight,this.getDirectPropertiesOnElementChange=Gt(()=>{let i=this.elementIRI();i!==""&&this._getDirectProperties(i)},{allowSignalWrites:!0}),this.unhideOnElementChange=Gt(()=>{this.elementIRI()!==""&&this._hiddenByUser.set(!1)},{allowSignalWrites:!0}),this._queryService.addQueryDefinitions(OI)}_getDirectProperties(i){return ie(this,null,function*(){let n=yield this._queryService.execute("get-direct-properties",{elementIRI:i});this.directProperties.update(()=>n)})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-element-menu"]],inputs:{settings:[1,"settings"]},standalone:!0,features:[st],decls:1,vars:1,consts:[["label","Element overview",3,"position","clickedClose",4,"ngIf"],["label","Element overview",3,"clickedClose","position"],["class","row","style","font-size: var(--bim-label--fz, var(--bim-ui_size-xs))",4,"ngIf"],[4,"ngIf"],[1,"row",2,"font-size","var(--bim-label--fz, var(--bim-ui_size-xs))"],[1,"prop"],[3,"elementIRI"],[2,"font-size","var(--bim-label--fz, var(--bim-ui_size-xs))","font-weight","600"],[2,"font-size","var(--bim-label--fz, var(--bim-ui_size-xs))"]],template:function(n,r){n&1&&dt(0,iU,3,3,"lib-draggable-panel",0),n&2&&Le("ngIf",r.visible()&&r.settings().visibility.ui.showElementPropertiesOnClick)},dependencies:[at,bt,ar,RI,DI,MI,FI,LI,kI],styles:[".row[_ngcontent-%COMP%]{display:flex;flex-direction:row;padding:.2rem .5rem;justify-content:space-between;align-items:center;gap:.2rem;max-width:30vw;flex-wrap:wrap}bim-label[_ngcontent-%COMP%]{background-color:var(--bim-ui_main-base);padding:0 .25rem;color:var(--bim-ui_main-contrast);border-radius:.25rem}bim-table[_ngcontent-%COMP%]{max-width:30vw}[_nghost-%COMP%]     .chip{background-color:var(--bim-ui_main-base)!important;padding:0 .25rem!important;color:var(--bim-ui_main-contrast)!important;border-radius:.25rem!important}.prop[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:.2rem .5rem}"]});let s=e;return s})();var Zv=Cs(eM());var nU={"@context":{hasElements:`${Lg.bot}hasElement`},hasElements:{}},sU={"@context":{bot:Lg.bot,hasSpaces:"bot:hasSpace",contained:"bot:containsElement",adjacent:"bot:adjacentElement"},"@type":"bot:Storey",hasSpaces:{"@type":"bot:Space",contained:{"@type":"bot:Element"},adjacent:{"@type":"bot:Element"}}};var zI=[{id:"model-has-spaces",query:`ASK WHERE {
            ?s qcy:hasTarget <{{modelIRI}}> .
            ?s a bot:Space .
            ?s bot:adjacentElement|bot:containsElement ?el
        }`,postProcessing:s=>s.results=="true"},{id:"model-has-storeys",query:`ASK WHERE {
            ?s qcy:hasTarget <{{modelIRI}}> .
            ?s a bot:Storey ;
                bot:hasElement ?e
        }`,postProcessing:s=>s.results=="true"},{id:"model-has-systems",query:`ASK WHERE {
            ?s qcy:hasTarget <{{modelIRI}}> .
            ?s a fso:DistributionSystem
        }`,postProcessing:s=>s.results=="true"},{id:"entity-property",query:`SELECT * WHERE {
      VALUES ?s { {{iris}} }
      ?s dicv:hasProperty ?p .
      ?p dicv:hasValue "{{propertyName}}" ;
        dicv:hasPropertyState/dicv:hasValue ?v .
    }`,postProcessing:s=>{let e={};return s.results===void 0?{}:(s.results.bindings.forEach(t=>{e[t.s.value]=t.v.value}),e)}},{id:"storey-element",query:`CONSTRUCT{
            ?b bot:hasStorey ?lvl .
            ?lvl a bot:Storey ;
                bot:hasElement ?e .
            ?e a bot:Element .
        }
        WHERE {
            ?b qcy:hasTarget <{{modelIRI}}> .
            ?b bot:hasStorey ?lvl .
            ?lvl bot:hasElement ?e .
        }`,postProcessing:s=>ie(void 0,null,function*(){let e=yield(0,Zv.frame)(s,nU),t=Object.keys(e).includes("@graph")?e["@graph"]:[e];return t===void 0||!Object.keys(t[0]).includes("hasElements")?[]:t.map(i=>{let r=BI(i.hasElements).map(o=>o["@id"]);return{data:{iri:i["@id"],Name:`Level [${r.length}]`,childIRIs:r}}})})},{id:"storey-space",query:`CONSTRUCT{
            ?b bot:hasStorey ?lvl .
            ?lvl a bot:Storey ;
                bot:hasSpace ?sp .
            ?sp a bot:Space ;
                bot:containsElement ?eC ;
                bot:adjacentElement ?eA .
            ?eC a bot:Element .
            ?eA a bot:Element .
        }
        WHERE {
            ?b qcy:hasTarget <{{modelIRI}}> .
            ?b bot:hasStorey ?lvl .
            ?lvl bot:hasSpace ?sp .
            OPTIONAL{?sp bot:containsElement ?eC}
            OPTIONAL{?sp bot:adjacentElement ?eA}
        }`,postProcessing:s=>ie(void 0,null,function*(){let e=yield(0,Zv.frame)(s,sU),t=Object.keys(e).includes("@graph")?e["@graph"]:[e];return t===void 0||!Object.keys(t[0]).includes("hasSpaces")?[]:t.map(i=>{let n=BI(i.hasSpaces),r=new Set,o=n.map(a=>{let l=new Set,c=[],d=UI(a.adjacent);d.length&&(d.forEach(u=>{l.add(u),r.add(u)}),c.push({data:{Name:"Adjacent",iri:a["@id"],childIRIs:d}}));let h=UI(a.contained);return h.length&&(h.forEach(u=>{l.add(u),r.add(u)}),c.push({data:{Name:"Contained",iri:a["@id"],childIRIs:h}})),{data:{iri:a["@id"],Name:"Space",childIRIs:Array.from(l)},children:c}});return{data:{iri:i["@id"],Name:`Level [${o.length}]`,childIRIs:Array.from(r)},children:o}})})}];function UI(s){return s!==void 0&&Array.isArray(s)&&s.length?s.map(e=>e["@id"]):[]}function BI(s){return!s||s===void 0?[]:Array.isArray(s)?s:[s]}var rU=["table"];function oU(s,e){s&1&&(He(0,"p"),fn(1,"Building decomposition..."),We())}var VI=(()=>{let e=class e{constructor(){this._queryService=qe(Pt),this._state=qe(vt),this.visibilityOverrideEnabled=new Vt(!1),this.tableData=[],this.hiddenColumns=["iri","childIRIs","elevation"],this.loading=!1}set chipTable(i){if(i){let n=i.nativeElement;this._initEventListeners(n)}}ngOnChanges(){this.modelIRI!==void 0&&this._getStoreyElements(this.modelIRI)}ngOnDestroy(){this.tableData=[],this.modelIRI=void 0}_getStoreyElements(i){return ie(this,null,function*(){this.loading=!0,this.tableData=yield this._queryService.execute("storey-element",{modelIRI:i});let n=this.tableData.map(r=>`<${r.data.iri}>`).join(" ");yield Promise.allSettled([this._appendNames(n),this._appendElevations(n)]),this.tableData.sort((r,o)=>o.data.Elevation-r.data.Elevation),this.loading=!1})}_appendNames(i){return ie(this,null,function*(){let n=yield this._queryService.execute("entity-property",{iris:i,propertyName:"Name"});Object.keys(n).length&&(this.tableData=this.tableData.map(r=>{let o=n[r.data.iri];return o!==void 0&&(r.data.Name=r.data.Name.replace("Level",o)),r}))})}_appendElevations(i){return ie(this,null,function*(){let n=yield this._queryService.execute("entity-property",{iris:i,propertyName:"Elevation"});Object.keys(n).length&&(this.tableData=this.tableData.map(r=>{let o=n[r.data.iri];return o!==void 0&&(r.data.elevation=parseFloat(o)),r}))})}_initEventListeners(i){i.addEventListener("cellcreated",n=>{let{cell:r}=n.detail,o=r.style;o.cursor="Pointer",r.addEventListener("click",()=>ie(this,null,function*(){let a=r.rowData.childIRIs.map(l=>l.split("/").pop());yield this._selectElements(a),this.visibilityOverrideEnabled.emit(!0)}))})}_selectElements(i){return ie(this,null,function*(){yield this._state.setFocusedSelectedElements(Array.from(i))})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-storey-element"]],viewQuery:function(n,r){if(n&1&&fi(rU,5),n&2){let o;mi(o=gi())&&(r.chipTable=o.first)}},inputs:{modelIRI:"modelIRI"},outputs:{visibilityOverrideEnabled:"visibilityOverrideEnabled"},standalone:!0,features:[Tn,st],decls:3,vars:3,consts:[["table",""],["headers-hidden","",3,"data","hiddenColumns"],[4,"ngIf"]],template:function(n,r){n&1&&(_t(0,"bim-table",1,0),dt(2,oU,2,0,"p",2)),n&2&&(Le("data",r.tableData)("hiddenColumns",r.hiddenColumns),Ge(2),Le("ngIf",r.loading))},dependencies:[at,bt],encapsulation:2});let s=e;return s})();var aU=["table"];function lU(s,e){s&1&&(He(0,"p"),fn(1,"Building decomposition..."),We())}var jI=(()=>{let e=class e{constructor(){this._queryService=qe(Pt),this._state=qe(vt),this.visibilityOverrideEnabled=new Vt(!1),this.tableData=[],this.hiddenColumns=["iri","elevation","childIRIs"],this.loading=!1}set chipTable(i){if(i){let n=i.nativeElement;this._initEventListeners(n)}}ngOnChanges(){this.modelIRI!==void 0&&this._getStoreyElements(this.modelIRI)}ngOnDestroy(){this.tableData=[],this.modelIRI=void 0}_getStoreyElements(i){return ie(this,null,function*(){this.loading=!0,this.tableData=yield this._queryService.execute("storey-space",{modelIRI:i});let n=this.tableData.map(o=>`<${o.data.iri}>`).join(" "),r=this.tableData.flatMap(o=>o.children).map(o=>`<${o.data.iri}>`).join(" ");yield Promise.allSettled([this._appendNames(`${n}  ${r}`),this._appendElevations(n)]),this.tableData.sort((o,a)=>a.data.Elevation-o.data.Elevation),this.loading=!1})}_appendNames(i){return ie(this,null,function*(){let n=yield this._queryService.execute("entity-property",{iris:i,propertyName:"Name"});Object.keys(n).length&&(this.tableData=this.tableData.map(r=>{let o=n[r.data.iri];return o!==void 0&&(r.data.Name=r.data.Name.replace("Level",o)),r.children=r.children.map(a=>{let l=n[a.data.iri];return l!==void 0&&(a.data.Name=l),a}),r}))})}_appendElevations(i){return ie(this,null,function*(){let n=yield this._queryService.execute("entity-property",{iris:i,propertyName:"Elevation"});Object.keys(n).length&&(this.tableData=this.tableData.map(r=>{let o=n[r.data.iri];return o!==void 0&&(r.data.elevation=parseFloat(o)),r}))})}_initEventListeners(i){i.addEventListener("cellcreated",n=>{let{cell:r}=n.detail,o=r.style;o.cursor="Pointer","childIRIs"in r.rowData&&r.addEventListener("click",()=>ie(this,null,function*(){let a=r.rowData.childIRIs.map(l=>l.split("/").pop());yield this._selectElements(a),this.visibilityOverrideEnabled.emit(!0)}))})}_selectElements(i){return ie(this,null,function*(){yield this._state.setFocusedSelectedElements(Array.from(i))})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-storey-space"]],viewQuery:function(n,r){if(n&1&&fi(aU,5),n&2){let o;mi(o=gi())&&(r.chipTable=o.first)}},inputs:{modelIRI:"modelIRI"},outputs:{visibilityOverrideEnabled:"visibilityOverrideEnabled"},standalone:!0,features:[Tn,st],decls:3,vars:3,consts:[["table",""],["headers-hidden","",3,"data","hiddenColumns"],[4,"ngIf"]],template:function(n,r){n&1&&(_t(0,"bim-table",1,0),dt(2,lU,2,0,"p",2)),n&2&&(Le("data",r.tableData)("hiddenColumns",r.hiddenColumns),Ge(2),Le("ngIf",r.loading))},dependencies:[at,bt],encapsulation:2});let s=e;return s})();var cU=["selector"];function hU(s,e){if(s&1&&_t(0,"bim-option",4),s&2){let t=e.$implicit;Le("value",t)("label",t)}}function dU(s,e){if(s&1){let t=mt();He(0,"lib-storey-element",6),rt("visibilityOverrideEnabled",function(n){pt(t);let r=Ze(2);return ft(r.visibilityOverrideEnabled=n)}),We()}if(s&2){let t=Ze(2);Le("modelIRI",t.modelIRI)}}function uU(s,e){if(s&1){let t=mt();He(0,"lib-storey-space",6),rt("visibilityOverrideEnabled",function(n){pt(t);let r=Ze(2);return ft(r.visibilityOverrideEnabled=n)}),We()}if(s&2){let t=Ze(2);Le("modelIRI",t.modelIRI)}}function pU(s,e){if(s&1){let t=mt();He(0,"lib-draggable-panel",2),rt("clickedClose",function(){pt(t);let n=Ze();return ft(n.visible=!1)})("clickOutside",function(){pt(t);let n=Ze();return ft(n.cleanSelection())}),He(1,"bim-selector",3,0),Zr(3,hU,1,2,"bim-option",4,Su),We(),dt(5,dU,1,1,"lib-storey-element",5)(6,uU,1,1,"lib-storey-space",5),We()}if(s&2){let t=Ze();Le("position",t.panelPosition),Ge(),Le("value",t.selectedDecomposition),Ge(2),Qr(t.decompositionOptions),Ge(2),Le("ngIf",t.modelIRI&&t.selectedDecomposition==="STOREY"),Ge(),Le("ngIf",t.modelIRI&&t.selectedDecomposition==="SPACE")}}var _d=function(s){return s.STOREY="STOREY",s.SPACE="SPACE",s.SYSTEM="SYSTEM",s}(_d||{}),HI=(()=>{let e=class e{set selector(i){if(i){let n=i.nativeElement;this._initEventListeners(n)}}constructor(){this._state=qe(vt),this._queryService=qe(Pt),this.settings=new qt,this.panelPosition=us.BottomLeft,this.visible=!1,this.mode=_d.STOREY,this.visibilityOverrideEnabled=!1,this.decompositionOptions=[],this._queryService.addQueryDefinitions(zI),Gt(()=>{let i=this._state.selectedModel(),n=this.settings.querySettings;i!==void 0&&n!==void 0&&(this.modelIRI=`${n.instanceNamespace}${i}`,this._checkAvailableDecompositions(this.modelIRI))})}ngOnDestroy(){this.modelIRI=void 0,this.decompositionOptions=[]}cleanSelection(){return ie(this,null,function*(){this.visibilityOverrideEnabled&&(yield this._state.setSelectedElements([]),yield this._state.setFocusedElements([]),yield this._state.clearStatic(),this.visibilityOverrideEnabled=!1)})}_checkAvailableDecompositions(i){return ie(this,null,function*(){console.log("CHECK AVAILABLE DECOMPOSITION"),this.decompositionOptions=[];let[n,r,o]=yield Promise.all([this._queryService.execute("model-has-storeys",{modelIRI:i}),this._queryService.execute("model-has-spaces",{modelIRI:i}),this._queryService.execute("model-has-systems",{modelIRI:i})]);n&&this.decompositionOptions.push(_d.STOREY),r&&this.decompositionOptions.push(_d.SPACE),o&&this.decompositionOptions.push(_d.SYSTEM),this.selectedDecomposition=this.decompositionOptions[0],this.visible=this.decompositionOptions.length!==0})}_initEventListeners(i){i.addEventListener("change",()=>this.selectedDecomposition=i.value)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-spatial-decomposition"]],viewQuery:function(n,r){if(n&1&&fi(cU,5),n&2){let o;mi(o=gi())&&(r.selector=o.first)}},inputs:{settings:"settings"},standalone:!0,features:[st],decls:1,vars:1,consts:[["selector",""],["label","Model decomposition","libClickOutside","",3,"position","clickedClose","clickOutside",4,"ngIf"],["label","Model decomposition","libClickOutside","",3,"clickedClose","clickOutside","position"],["vertical","",3,"value"],[3,"value","label"],[3,"modelIRI","visibilityOverrideEnabled",4,"ngIf"],[3,"visibilityOverrideEnabled","modelIRI"]],template:function(n,r){n&1&&dt(0,pU,7,4,"lib-draggable-panel",1),n&2&&Le("ngIf",r.visible&&r.settings.visibility.ui.showSpatialDecomposition)},dependencies:[at,bt,ar,VI,jI,Yu],styles:[".row[_ngcontent-%COMP%]{display:flex;flex-direction:row;padding:.2rem .5rem;justify-content:space-between;align-items:center;gap:.2rem;max-width:30vw;flex-wrap:wrap}bim-label[_ngcontent-%COMP%]{background-color:var(--bim-ui_main-base);padding:0 .25rem;color:var(--bim-ui_main-contrast);border-radius:.25rem}bim-table[_ngcontent-%COMP%]{max-width:30vw}bim-selector[_ngcontent-%COMP%]{padding:10px}"]});let s=e;return s})();var fU=Object.defineProperty,mU=(s,e,t)=>e in s?fU(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ka=(s,e,t)=>(mU(s,typeof e!="symbol"?e+"":e,t),t),gc=Math.min,Fr=Math.max,Xf=Math.round,ko=s=>({x:s,y:s}),gU={left:"right",right:"left",bottom:"top",top:"bottom"},bU={start:"end",end:"start"};function GI(s,e,t){return Fr(s,gc(e,t))}function Vd(s,e){return typeof s=="function"?s(e):s}function Nr(s){return s.split("-")[0]}function um(s){return s.split("-")[1]}function WT(s){return s==="x"?"y":"x"}function YT(s){return s==="y"?"height":"width"}function ja(s){return["top","bottom"].includes(Nr(s))?"y":"x"}function qT(s){return WT(ja(s))}function vU(s,e,t){t===void 0&&(t=!1);let i=um(s),n=qT(s),r=YT(n),o=n==="x"?i===(t?"end":"start")?"right":"left":i==="start"?"bottom":"top";return e.reference[r]>e.floating[r]&&(o=Kf(o)),[o,Kf(o)]}function yU(s){let e=Kf(s);return[ly(s),e,ly(e)]}function ly(s){return s.replace(/start|end/g,e=>bU[e])}function _U(s,e,t){let i=["left","right"],n=["right","left"],r=["top","bottom"],o=["bottom","top"];switch(s){case"top":case"bottom":return t?e?n:i:e?i:n;case"left":case"right":return e?r:o;default:return[]}}function wU(s,e,t,i){let n=um(s),r=_U(Nr(s),t==="start",i);return n&&(r=r.map(o=>o+"-"+n),e&&(r=r.concat(r.map(ly)))),r}function Kf(s){return s.replace(/left|right|bottom|top/g,e=>gU[e])}function EU(s){return Se({top:0,right:0,bottom:0,left:0},s)}function XT(s){return typeof s!="number"?EU(s):{top:s,right:s,bottom:s,left:s}}function bc(s){let{x:e,y:t,width:i,height:n}=s;return{width:i,height:n,top:t,left:e,right:e+i,bottom:t+n,x:e,y:t}}function WI(s,e,t){let{reference:i,floating:n}=s,r=ja(e),o=qT(e),a=YT(o),l=Nr(e),c=r==="y",d=i.x+i.width/2-n.width/2,h=i.y+i.height/2-n.height/2,u=i[a]/2-n[a]/2,p;switch(l){case"top":p={x:d,y:i.y-n.height};break;case"bottom":p={x:d,y:i.y+i.height};break;case"right":p={x:i.x+i.width,y:h};break;case"left":p={x:i.x-n.width,y:h};break;default:p={x:i.x,y:i.y}}switch(um(e)){case"start":p[o]-=u*(t&&c?-1:1);break;case"end":p[o]+=u*(t&&c?-1:1);break}return p}var CU=(s,e,t)=>ie(void 0,null,function*(){let{placement:i="bottom",strategy:n="absolute",middleware:r=[],platform:o}=t,a=r.filter(Boolean),l=yield o.isRTL==null?void 0:o.isRTL(e),c=yield o.getElementRects({reference:s,floating:e,strategy:n}),{x:d,y:h}=WI(c,i,l),u=i,p={},f=0;for(let m=0;m<a.length;m++){let{name:g,fn:b}=a[m],{x:v,y:E,data:y,reset:w}=yield b({x:d,y:h,initialPlacement:i,placement:u,strategy:n,middlewareData:p,rects:c,platform:o,elements:{reference:s,floating:e}});d=v??d,h=E??h,p=yt(Se({},p),{[g]:Se(Se({},p[g]),y)}),w&&f<=50&&(f++,typeof w=="object"&&(w.placement&&(u=w.placement),w.rects&&(c=w.rects===!0?yield o.getElementRects({reference:s,floating:e,strategy:n}):w.rects),{x:d,y:h}=WI(c,u,l)),m=-1)}return{x:d,y:h,placement:u,strategy:n,middlewareData:p}});function KT(s,e){return ie(this,null,function*(){var t;e===void 0&&(e={});let{x:i,y:n,platform:r,rects:o,elements:a,strategy:l}=s,{boundary:c="clippingAncestors",rootBoundary:d="viewport",elementContext:h="floating",altBoundary:u=!1,padding:p=0}=Vd(e,s),f=XT(p),m=a[u?h==="floating"?"reference":"floating":h],g=bc(yield r.getClippingRect({element:(t=yield r.isElement==null?void 0:r.isElement(m))==null||t?m:m.contextElement||(yield r.getDocumentElement==null?void 0:r.getDocumentElement(a.floating)),boundary:c,rootBoundary:d,strategy:l})),b=h==="floating"?{x:i,y:n,width:o.floating.width,height:o.floating.height}:o.reference,v=yield r.getOffsetParent==null?void 0:r.getOffsetParent(a.floating),E=(yield r.isElement==null?void 0:r.isElement(v))?(yield r.getScale==null?void 0:r.getScale(v))||{x:1,y:1}:{x:1,y:1},y=bc(r.convertOffsetParentRelativeRectToViewportRelativeRect?yield r.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:b,offsetParent:v,strategy:l}):b);return{top:(g.top-y.top+f.top)/E.y,bottom:(y.bottom-g.bottom+f.bottom)/E.y,left:(g.left-y.left+f.left)/E.x,right:(y.right-g.right+f.right)/E.x}})}var xU=function(s){return s===void 0&&(s={}),{name:"flip",options:s,fn(t){return ie(this,null,function*(){var i,n;let{placement:r,middlewareData:o,rects:a,initialPlacement:l,platform:c,elements:d}=t,N=Vd(s,t),{mainAxis:h=!0,crossAxis:u=!0,fallbackPlacements:p,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:m="none",flipAlignment:g=!0}=N,b=nl(N,["mainAxis","crossAxis","fallbackPlacements","fallbackStrategy","fallbackAxisSideDirection","flipAlignment"]);if((i=o.arrow)!=null&&i.alignmentOffset)return{};let v=Nr(r),E=ja(l),y=Nr(l)===l,w=yield c.isRTL==null?void 0:c.isRTL(d.floating),C=p||(y||!g?[Kf(l)]:yU(l)),A=m!=="none";!p&&A&&C.push(...wU(l,g,m,w));let D=[l,...C],M=yield KT(t,b),I=[],O=((n=o.flip)==null?void 0:n.overflows)||[];if(h&&I.push(M[v]),u){let z=vU(r,a,w);I.push(M[z[0]],M[z[1]])}if(O=[...O,{placement:r,overflows:I}],!I.every(z=>z<=0)){var F,V;let z=(((F=o.flip)==null?void 0:F.index)||0)+1,G=D[z];if(G)return{data:{index:z,overflows:O},reset:{placement:G}};let X=(V=O.filter(k=>k.overflows[0]<=0).sort((k,B)=>k.overflows[1]-B.overflows[1])[0])==null?void 0:V.placement;if(!X)switch(f){case"bestFit":{var x;let k=(x=O.filter(B=>{if(A){let R=ja(B.placement);return R===E||R==="y"}return!0}).map(B=>[B.placement,B.overflows.filter(R=>R>0).reduce((R,j)=>R+j,0)]).sort((B,R)=>B[1]-R[1])[0])==null?void 0:x[0];k&&(X=k);break}case"initialPlacement":X=l;break}if(r!==X)return{reset:{placement:X}}}return{}})}}};function $T(s){let e=gc(...s.map(r=>r.left)),t=gc(...s.map(r=>r.top)),i=Fr(...s.map(r=>r.right)),n=Fr(...s.map(r=>r.bottom));return{x:e,y:t,width:i-e,height:n-t}}function SU(s){let e=s.slice().sort((n,r)=>n.y-r.y),t=[],i=null;for(let n=0;n<e.length;n++){let r=e[n];!i||r.y-i.y>i.height/2?t.push([r]):t[t.length-1].push(r),i=r}return t.map(n=>bc($T(n)))}var AU=function(s){return s===void 0&&(s={}),{name:"inline",options:s,fn(t){return ie(this,null,function*(){let{placement:i,elements:n,rects:r,platform:o,strategy:a}=t,{padding:l=2,x:c,y:d}=Vd(s,t),h=Array.from((yield o.getClientRects==null?void 0:o.getClientRects(n.reference))||[]),u=SU(h),p=bc($T(h)),f=XT(l);function m(){if(u.length===2&&u[0].left>u[1].right&&c!=null&&d!=null)return u.find(b=>c>b.left-f.left&&c<b.right+f.right&&d>b.top-f.top&&d<b.bottom+f.bottom)||p;if(u.length>=2){if(ja(i)==="y"){let O=u[0],F=u[u.length-1],V=Nr(i)==="top",x=O.top,N=F.bottom,z=V?O.left:F.left,G=V?O.right:F.right,X=G-z,k=N-x;return{top:x,bottom:N,left:z,right:G,width:X,height:k,x:z,y:x}}let b=Nr(i)==="left",v=Fr(...u.map(O=>O.right)),E=gc(...u.map(O=>O.left)),y=u.filter(O=>b?O.left===E:O.right===v),w=y[0].top,C=y[y.length-1].bottom,A=E,D=v,M=D-A,I=C-w;return{top:w,bottom:C,left:A,right:D,width:M,height:I,x:A,y:w}}return p}let g=yield o.getElementRects({reference:{getBoundingClientRect:m},floating:n.floating,strategy:a});return r.reference.x!==g.reference.x||r.reference.y!==g.reference.y||r.reference.width!==g.reference.width||r.reference.height!==g.reference.height?{reset:{rects:g}}:{}})}}};function IU(s,e){return ie(this,null,function*(){let{placement:t,platform:i,elements:n}=s,r=yield i.isRTL==null?void 0:i.isRTL(n.floating),o=Nr(t),a=um(t),l=ja(t)==="y",c=["left","top"].includes(o)?-1:1,d=r&&l?-1:1,h=Vd(e,s),{mainAxis:u,crossAxis:p,alignmentAxis:f}=typeof h=="number"?{mainAxis:h,crossAxis:0,alignmentAxis:null}:Se({mainAxis:0,crossAxis:0,alignmentAxis:null},h);return a&&typeof f=="number"&&(p=a==="end"?f*-1:f),l?{x:p*d,y:u*c}:{x:u*c,y:p*d}})}var ZT=function(s){return{name:"offset",options:s,fn(t){return ie(this,null,function*(){var i,n;let{x:r,y:o,placement:a,middlewareData:l}=t,c=yield IU(t,s);return a===((i=l.offset)==null?void 0:i.placement)&&(n=l.arrow)!=null&&n.alignmentOffset?{}:{x:r+c.x,y:o+c.y,data:yt(Se({},c),{placement:a})}})}}},TU=function(s){return s===void 0&&(s={}),{name:"shift",options:s,fn(t){return ie(this,null,function*(){let{x:i,y:n,placement:r}=t,b=Vd(s,t),{mainAxis:o=!0,crossAxis:a=!1,limiter:l={fn:v=>{let{x:E,y}=v;return{x:E,y}}}}=b,c=nl(b,["mainAxis","crossAxis","limiter"]),d={x:i,y:n},h=yield KT(t,c),u=ja(Nr(r)),p=WT(u),f=d[p],m=d[u];if(o){let v=p==="y"?"top":"left",E=p==="y"?"bottom":"right",y=f+h[v],w=f-h[E];f=GI(y,f,w)}if(a){let v=u==="y"?"top":"left",E=u==="y"?"bottom":"right",y=m+h[v],w=m-h[E];m=GI(y,m,w)}let g=l.fn(yt(Se({},t),{[p]:f,[u]:m}));return yt(Se({},g),{data:{x:g.x-i,y:g.y-n}})})}}};function No(s){return QT(s)?(s.nodeName||"").toLowerCase():"#document"}function Hn(s){var e;return(s==null||(e=s.ownerDocument)==null?void 0:e.defaultView)||window}function Bo(s){var e;return(e=(QT(s)?s.ownerDocument:s.document)||window.document)==null?void 0:e.documentElement}function QT(s){return s instanceof Node||s instanceof Hn(s).Node}function hr(s){return s instanceof Element||s instanceof Hn(s).Element}function dr(s){return s instanceof HTMLElement||s instanceof Hn(s).HTMLElement}function YI(s){return typeof ShadowRoot>"u"?!1:s instanceof ShadowRoot||s instanceof Hn(s).ShadowRoot}function jd(s){let{overflow:e,overflowX:t,overflowY:i,display:n}=bs(s);return/auto|scroll|overlay|hidden|clip/.test(e+i+t)&&!["inline","contents"].includes(n)}function PU(s){return["table","td","th"].includes(No(s))}function OU(s){return[":popover-open",":modal"].some(e=>{try{return s.matches(e)}catch{return!1}})}function By(s){let e=zy(),t=hr(s)?bs(s):s;return t.transform!=="none"||t.perspective!=="none"||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","perspective","filter"].some(i=>(t.willChange||"").includes(i))||["paint","layout","strict","content"].some(i=>(t.contain||"").includes(i))}function MU(s){let e=vc(s);for(;dr(e)&&!pm(e);){if(By(e))return e;if(OU(e))return null;e=vc(e)}return null}function zy(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function pm(s){return["html","body","#document"].includes(No(s))}function bs(s){return Hn(s).getComputedStyle(s)}function fm(s){return hr(s)?{scrollLeft:s.scrollLeft,scrollTop:s.scrollTop}:{scrollLeft:s.scrollX,scrollTop:s.scrollY}}function vc(s){if(No(s)==="html")return s;let e=s.assignedSlot||s.parentNode||YI(s)&&s.host||Bo(s);return YI(e)?e.host:e}function JT(s){let e=vc(s);return pm(e)?s.ownerDocument?s.ownerDocument.body:s.body:dr(e)&&jd(e)?e:JT(e)}function cy(s,e,t){var i;e===void 0&&(e=[]),t===void 0&&(t=!0);let n=JT(s),r=n===((i=s.ownerDocument)==null?void 0:i.body),o=Hn(n);if(r){let a=RU(o);return e.concat(o,o.visualViewport||[],jd(n)?n:[],a&&t?cy(a):[])}return e.concat(n,cy(n,[],t))}function RU(s){return s.parent&&Object.getPrototypeOf(s.parent)?s.frameElement:null}function eP(s){let e=bs(s),t=parseFloat(e.width)||0,i=parseFloat(e.height)||0,n=dr(s),r=n?s.offsetWidth:t,o=n?s.offsetHeight:i,a=Xf(t)!==r||Xf(i)!==o;return a&&(t=r,i=o),{width:t,height:i,$:a}}function tP(s){return hr(s)?s:s.contextElement}function mc(s){let e=tP(s);if(!dr(e))return ko(1);let t=e.getBoundingClientRect(),{width:i,height:n,$:r}=eP(e),o=(r?Xf(t.width):t.width)/i,a=(r?Xf(t.height):t.height)/n;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}var DU=ko(0);function iP(s){let e=Hn(s);return!zy()||!e.visualViewport?DU:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function LU(s,e,t){return e===void 0&&(e=!1),!t||e&&t!==Hn(s)?!1:e}function Pd(s,e,t,i){e===void 0&&(e=!1),t===void 0&&(t=!1);let n=s.getBoundingClientRect(),r=tP(s),o=ko(1);e&&(i?hr(i)&&(o=mc(i)):o=mc(s));let a=LU(r,t,i)?iP(r):ko(0),l=(n.left+a.x)/o.x,c=(n.top+a.y)/o.y,d=n.width/o.x,h=n.height/o.y;if(r){let u=Hn(r),p=i&&hr(i)?Hn(i):i,f=u,m=f.frameElement;for(;m&&i&&p!==f;){let g=mc(m),b=m.getBoundingClientRect(),v=bs(m),E=b.left+(m.clientLeft+parseFloat(v.paddingLeft))*g.x,y=b.top+(m.clientTop+parseFloat(v.paddingTop))*g.y;l*=g.x,c*=g.y,d*=g.x,h*=g.y,l+=E,c+=y,f=Hn(m),m=f.frameElement}}return bc({width:d,height:h,x:l,y:c})}var FU=[":popover-open",":modal"];function nP(s){return FU.some(e=>{try{return s.matches(e)}catch{return!1}})}function kU(s){let{elements:e,rect:t,offsetParent:i,strategy:n}=s,r=n==="fixed",o=Bo(i),a=e?nP(e.floating):!1;if(i===o||a&&r)return t;let l={scrollLeft:0,scrollTop:0},c=ko(1),d=ko(0),h=dr(i);if((h||!h&&!r)&&((No(i)!=="body"||jd(o))&&(l=fm(i)),dr(i))){let u=Pd(i);c=mc(i),d.x=u.x+i.clientLeft,d.y=u.y+i.clientTop}return{width:t.width*c.x,height:t.height*c.y,x:t.x*c.x-l.scrollLeft*c.x+d.x,y:t.y*c.y-l.scrollTop*c.y+d.y}}function NU(s){return Array.from(s.getClientRects())}function sP(s){return Pd(Bo(s)).left+fm(s).scrollLeft}function UU(s){let e=Bo(s),t=fm(s),i=s.ownerDocument.body,n=Fr(e.scrollWidth,e.clientWidth,i.scrollWidth,i.clientWidth),r=Fr(e.scrollHeight,e.clientHeight,i.scrollHeight,i.clientHeight),o=-t.scrollLeft+sP(s),a=-t.scrollTop;return bs(i).direction==="rtl"&&(o+=Fr(e.clientWidth,i.clientWidth)-n),{width:n,height:r,x:o,y:a}}function BU(s,e){let t=Hn(s),i=Bo(s),n=t.visualViewport,r=i.clientWidth,o=i.clientHeight,a=0,l=0;if(n){r=n.width,o=n.height;let c=zy();(!c||c&&e==="fixed")&&(a=n.offsetLeft,l=n.offsetTop)}return{width:r,height:o,x:a,y:l}}function zU(s,e){let t=Pd(s,!0,e==="fixed"),i=t.top+s.clientTop,n=t.left+s.clientLeft,r=dr(s)?mc(s):ko(1),o=s.clientWidth*r.x,a=s.clientHeight*r.y,l=n*r.x,c=i*r.y;return{width:o,height:a,x:l,y:c}}function qI(s,e,t){let i;if(e==="viewport")i=BU(s,t);else if(e==="document")i=UU(Bo(s));else if(hr(e))i=zU(e,t);else{let n=iP(s);i=yt(Se({},e),{x:e.x-n.x,y:e.y-n.y})}return bc(i)}function rP(s,e){let t=vc(s);return t===e||!hr(t)||pm(t)?!1:bs(t).position==="fixed"||rP(t,e)}function VU(s,e){let t=e.get(s);if(t)return t;let i=cy(s,[],!1).filter(a=>hr(a)&&No(a)!=="body"),n=null,r=bs(s).position==="fixed",o=r?vc(s):s;for(;hr(o)&&!pm(o);){let a=bs(o),l=By(o);!l&&a.position==="fixed"&&(n=null),(r?!l&&!n:!l&&a.position==="static"&&n&&["absolute","fixed"].includes(n.position)||jd(o)&&!l&&rP(s,o))?i=i.filter(c=>c!==o):n=a,o=vc(o)}return e.set(s,i),i}function jU(s){let{element:e,boundary:t,rootBoundary:i,strategy:n}=s,r=[...t==="clippingAncestors"?VU(e,this._c):[].concat(t),i],o=r[0],a=r.reduce((l,c)=>{let d=qI(e,c,n);return l.top=Fr(d.top,l.top),l.right=gc(d.right,l.right),l.bottom=gc(d.bottom,l.bottom),l.left=Fr(d.left,l.left),l},qI(e,o,n));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function HU(s){let{width:e,height:t}=eP(s);return{width:e,height:t}}function GU(s,e,t){let i=dr(e),n=Bo(e),r=t==="fixed",o=Pd(s,!0,r,e),a={scrollLeft:0,scrollTop:0},l=ko(0);if(i||!i&&!r)if((No(e)!=="body"||jd(n))&&(a=fm(e)),i){let h=Pd(e,!0,r,e);l.x=h.x+e.clientLeft,l.y=h.y+e.clientTop}else n&&(l.x=sP(n));let c=o.left+a.scrollLeft-l.x,d=o.top+a.scrollTop-l.y;return{x:c,y:d,width:o.width,height:o.height}}function XI(s,e){return!dr(s)||bs(s).position==="fixed"?null:e?e(s):s.offsetParent}function oP(s,e){let t=Hn(s);if(!dr(s)||nP(s))return t;let i=XI(s,e);for(;i&&PU(i)&&bs(i).position==="static";)i=XI(i,e);return i&&(No(i)==="html"||No(i)==="body"&&bs(i).position==="static"&&!By(i))?t:i||MU(s)||t}var WU=function(s){return ie(this,null,function*(){let e=this.getOffsetParent||oP,t=this.getDimensions;return{reference:GU(s.reference,yield e(s.floating),s.strategy),floating:Se({x:0,y:0},yield t(s.floating))}})};function YU(s){return bs(s).direction==="rtl"}var qU={convertOffsetParentRelativeRectToViewportRelativeRect:kU,getDocumentElement:Bo,getClippingRect:jU,getOffsetParent:oP,getElementRects:WU,getClientRects:NU,getDimensions:HU,getScale:mc,isElement:hr,isRTL:YU},aP=TU,lP=xU,cP=AU,hP=(s,e,t)=>{let i=new Map,n=Se({platform:qU},t),r=yt(Se({},n.platform),{_c:i});return CU(s,e,yt(Se({},n),{platform:r}))};var jf=globalThis,Vy=jf.ShadowRoot&&(jf.ShadyCSS===void 0||jf.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,jy=Symbol(),KI=new WeakMap,dP=class{constructor(s,e,t){if(this._$cssResult$=!0,t!==jy)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=s,this.t=e}get styleSheet(){let s=this.o,e=this.t;if(Vy&&s===void 0){let t=e!==void 0&&e.length===1;t&&(s=KI.get(e)),s===void 0&&((this.o=s=new CSSStyleSheet).replaceSync(this.cssText),t&&KI.set(e,s))}return s}toString(){return this.cssText}},XU=s=>new dP(typeof s=="string"?s:s+"",void 0,jy),oi=(s,...e)=>{let t=s.length===1?s[0]:e.reduce((i,n,r)=>i+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+s[r+1],s[0]);return new dP(t,s,jy)},KU=(s,e)=>{if(Vy)s.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(let t of e){let i=document.createElement("style"),n=jf.litNonce;n!==void 0&&i.setAttribute("nonce",n),i.textContent=t.cssText,s.appendChild(i)}},$I=Vy?s=>s:s=>s instanceof CSSStyleSheet?(e=>{let t="";for(let i of e.cssRules)t+=i.cssText;return XU(t)})(s):s;var{is:$U,defineProperty:ZU,getOwnPropertyDescriptor:QU,getOwnPropertyNames:JU,getOwnPropertySymbols:eB,getPrototypeOf:tB}=Object,yc=globalThis,ZI=yc.trustedTypes,iB=ZI?ZI.emptyScript:"",QI=yc.reactiveElementPolyfillSupport,xd=(s,e)=>s,$f={toAttribute(s,e){switch(e){case Boolean:s=s?iB:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,e){let t=s;switch(e){case Boolean:t=s!==null;break;case Number:t=s===null?null:Number(s);break;case Object:case Array:try{t=JSON.parse(s)}catch{t=null}}return t}},Hy=(s,e)=>!$U(s,e),JI={attribute:!0,type:String,converter:$f,reflect:!1,hasChanged:Hy};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),yc.litPropertyMetadata??(yc.litPropertyMetadata=new WeakMap);var Mo=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??(this.l=[])).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=JI){if(t.state&&(t.attribute=!1),this._$Ei(),this.elementProperties.set(e,t),!t.noAccessor){let i=Symbol(),n=this.getPropertyDescriptor(e,i,t);n!==void 0&&ZU(this.prototype,e,n)}}static getPropertyDescriptor(e,t,i){let{get:n,set:r}=QU(this.prototype,e)??{get(){return this[t]},set(o){this[t]=o}};return{get(){return n?.call(this)},set(o){let a=n?.call(this);r.call(this,o),this.requestUpdate(e,a,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??JI}static _$Ei(){if(this.hasOwnProperty(xd("elementProperties")))return;let e=tB(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(xd("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(xd("properties"))){let t=this.properties,i=[...JU(t),...eB(t)];for(let n of i)this.createProperty(n,t[n])}let e=this[Symbol.metadata];if(e!==null){let t=litPropertyMetadata.get(e);if(t!==void 0)for(let[i,n]of t)this.elementProperties.set(i,n)}this._$Eh=new Map;for(let[t,i]of this.elementProperties){let n=this._$Eu(t,i);n!==void 0&&this._$Eh.set(n,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){let t=[];if(Array.isArray(e)){let i=new Set(e.flat(1/0).reverse());for(let n of i)t.unshift($I(n))}else e!==void 0&&t.push($I(e));return t}static _$Eu(e,t){let i=t.attribute;return i===!1?void 0:typeof i=="string"?i:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach(t=>t(this))}addController(e){var t;(this._$EO??(this._$EO=new Set)).add(e),this.renderRoot!==void 0&&this.isConnected&&((t=e.hostConnected)==null||t.call(e))}removeController(e){var t;(t=this._$EO)==null||t.delete(e)}_$E_(){let e=new Map,t=this.constructor.elementProperties;for(let i of t.keys())this.hasOwnProperty(i)&&(e.set(i,this[i]),delete this[i]);e.size>0&&(this._$Ep=e)}createRenderRoot(){let e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return KU(e,this.constructor.elementStyles),e}connectedCallback(){var e;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$EO)==null||e.forEach(t=>{var i;return(i=t.hostConnected)==null?void 0:i.call(t)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$EO)==null||e.forEach(t=>{var i;return(i=t.hostDisconnected)==null?void 0:i.call(t)})}attributeChangedCallback(e,t,i){this._$AK(e,i)}_$EC(e,t){var i;let n=this.constructor.elementProperties.get(e),r=this.constructor._$Eu(e,n);if(r!==void 0&&n.reflect===!0){let o=(((i=n.converter)==null?void 0:i.toAttribute)!==void 0?n.converter:$f).toAttribute(t,n.type);this._$Em=e,o==null?this.removeAttribute(r):this.setAttribute(r,o),this._$Em=null}}_$AK(e,t){var i;let n=this.constructor,r=n._$Eh.get(e);if(r!==void 0&&this._$Em!==r){let o=n.getPropertyOptions(r),a=typeof o.converter=="function"?{fromAttribute:o.converter}:((i=o.converter)==null?void 0:i.fromAttribute)!==void 0?o.converter:$f;this._$Em=r,this[r]=a.fromAttribute(t,o.type),this._$Em=null}}requestUpdate(e,t,i){if(e!==void 0){if(i??(i=this.constructor.getPropertyOptions(e)),!(i.hasChanged??Hy)(this[e],t))return;this.P(e,t,i)}this.isUpdatePending===!1&&(this._$ES=this._$ET())}P(e,t,i){this._$AL.has(e)||this._$AL.set(e,t),i.reflect===!0&&this._$Em!==e&&(this._$Ej??(this._$Ej=new Set)).add(e)}_$ET(){return ie(this,null,function*(){this.isUpdatePending=!0;try{yield this._$ES}catch(t){Promise.reject(t)}let e=this.scheduleUpdate();return e!=null&&(yield e),!this.isUpdatePending})}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(let[r,o]of this._$Ep)this[r]=o;this._$Ep=void 0}let n=this.constructor.elementProperties;if(n.size>0)for(let[r,o]of n)o.wrapped!==!0||this._$AL.has(r)||this[r]===void 0||this.P(r,this[r],o)}let t=!1,i=this._$AL;try{t=this.shouldUpdate(i),t?(this.willUpdate(i),(e=this._$EO)==null||e.forEach(n=>{var r;return(r=n.hostUpdate)==null?void 0:r.call(n)}),this.update(i)):this._$EU()}catch(n){throw t=!1,this._$EU(),n}t&&this._$AE(i)}willUpdate(e){}_$AE(e){var t;(t=this._$EO)==null||t.forEach(i=>{var n;return(n=i.hostUpdated)==null?void 0:n.call(i)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Ej&&(this._$Ej=this._$Ej.forEach(t=>this._$EC(t,this[t]))),this._$EU()}updated(e){}firstUpdated(e){}};Mo.elementStyles=[],Mo.shadowRootOptions={mode:"open"},Mo[xd("elementProperties")]=new Map,Mo[xd("finalized")]=new Map,QI?.({ReactiveElement:Mo}),(yc.reactiveElementVersions??(yc.reactiveElementVersions=[])).push("2.0.4");var Zf=globalThis,Qf=Zf.trustedTypes,eT=Qf?Qf.createPolicy("lit-html",{createHTML:s=>s}):void 0,uP="$lit$",Ro=`lit$${Math.random().toFixed(9).slice(2)}$`,pP="?"+Ro,nB=`<${pP}>`,Ha=document,Od=()=>Ha.createComment(""),Md=s=>s===null||typeof s!="object"&&typeof s!="function",Gy=Array.isArray,sB=s=>Gy(s)||typeof s?.[Symbol.iterator]=="function",Qv=`[ 	
\f\r]`,wd=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,tT=/-->/g,iT=/>/g,Na=RegExp(`>|${Qv}(?:([^\\s"'>=/]+)(${Qv}*=${Qv}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),nT=/'/g,sT=/"/g,fP=/^(?:script|style|textarea|title)$/i,rB=s=>(e,...t)=>({_$litType$:s,strings:e,values:t}),Me=rB(1),Ga=Symbol.for("lit-noChange"),Li=Symbol.for("lit-nothing"),rT=new WeakMap,Ba=Ha.createTreeWalker(Ha,129);function mP(s,e){if(!Gy(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return eT!==void 0?eT.createHTML(e):e}var oB=(s,e)=>{let t=s.length-1,i=[],n,r=e===2?"<svg>":e===3?"<math>":"",o=wd;for(let a=0;a<t;a++){let l=s[a],c,d,h=-1,u=0;for(;u<l.length&&(o.lastIndex=u,d=o.exec(l),d!==null);)u=o.lastIndex,o===wd?d[1]==="!--"?o=tT:d[1]!==void 0?o=iT:d[2]!==void 0?(fP.test(d[2])&&(n=RegExp("</"+d[2],"g")),o=Na):d[3]!==void 0&&(o=Na):o===Na?d[0]===">"?(o=n??wd,h=-1):d[1]===void 0?h=-2:(h=o.lastIndex-d[2].length,c=d[1],o=d[3]===void 0?Na:d[3]==='"'?sT:nT):o===sT||o===nT?o=Na:o===tT||o===iT?o=wd:(o=Na,n=void 0);let p=o===Na&&s[a+1].startsWith("/>")?" ":"";r+=o===wd?l+nB:h>=0?(i.push(c),l.slice(0,h)+uP+l.slice(h)+Ro+p):l+Ro+(h===-2?a:p)}return[mP(s,r+(s[t]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),i]},Rd=class s{constructor({strings:e,_$litType$:t},i){let n;this.parts=[];let r=0,o=0,a=e.length-1,l=this.parts,[c,d]=oB(e,t);if(this.el=s.createElement(c,i),Ba.currentNode=this.el.content,t===2||t===3){let h=this.el.content.firstChild;h.replaceWith(...h.childNodes)}for(;(n=Ba.nextNode())!==null&&l.length<a;){if(n.nodeType===1){if(n.hasAttributes())for(let h of n.getAttributeNames())if(h.endsWith(uP)){let u=d[o++],p=n.getAttribute(h).split(Ro),f=/([.?@])?(.*)/.exec(u);l.push({type:1,index:r,name:f[2],strings:p,ctor:f[1]==="."?dy:f[1]==="?"?uy:f[1]==="@"?py:wc}),n.removeAttribute(h)}else h.startsWith(Ro)&&(l.push({type:6,index:r}),n.removeAttribute(h));if(fP.test(n.tagName)){let h=n.textContent.split(Ro),u=h.length-1;if(u>0){n.textContent=Qf?Qf.emptyScript:"";for(let p=0;p<u;p++)n.append(h[p],Od()),Ba.nextNode(),l.push({type:2,index:++r});n.append(h[u],Od())}}}else if(n.nodeType===8)if(n.data===pP)l.push({type:2,index:r});else{let h=-1;for(;(h=n.data.indexOf(Ro,h+1))!==-1;)l.push({type:7,index:r}),h+=Ro.length-1}r++}}static createElement(e,t){let i=Ha.createElement("template");return i.innerHTML=e,i}};function _c(s,e,t=s,i){var n,r;if(e===Ga)return e;let o=i!==void 0?(n=t.o)==null?void 0:n[i]:t.l,a=Md(e)?void 0:e._$litDirective$;return o?.constructor!==a&&((r=o?._$AO)==null||r.call(o,!1),a===void 0?o=void 0:(o=new a(s),o._$AT(s,t,i)),i!==void 0?(t.o??(t.o=[]))[i]=o:t.l=o),o!==void 0&&(e=_c(s,o._$AS(s,e.values),o,i)),e}var hy=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){let{el:{content:t},parts:i}=this._$AD,n=(e?.creationScope??Ha).importNode(t,!0);Ba.currentNode=n;let r=Ba.nextNode(),o=0,a=0,l=i[0];for(;l!==void 0;){if(o===l.index){let c;l.type===2?c=new Dd(r,r.nextSibling,this,e):l.type===1?c=new l.ctor(r,l.name,l.strings,this,e):l.type===6&&(c=new fy(r,this,e)),this._$AV.push(c),l=i[++a]}o!==l?.index&&(r=Ba.nextNode(),o++)}return Ba.currentNode=Ha,n}p(e){let t=0;for(let i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(e,i,t),t+=i.strings.length-2):i._$AI(e[t])),t++}},Dd=class s{get _$AU(){var e;return((e=this._$AM)==null?void 0:e._$AU)??this.v}constructor(e,t,i,n){this.type=2,this._$AH=Li,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=i,this.options=n,this.v=n?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode,t=this._$AM;return t!==void 0&&e?.nodeType===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=_c(this,e,t),Md(e)?e===Li||e==null||e===""?(this._$AH!==Li&&this._$AR(),this._$AH=Li):e!==this._$AH&&e!==Ga&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):sB(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==Li&&Md(this._$AH)?this._$AA.nextSibling.data=e:this.T(Ha.createTextNode(e)),this._$AH=e}$(e){var t;let{values:i,_$litType$:n}=e,r=typeof n=="number"?this._$AC(e):(n.el===void 0&&(n.el=Rd.createElement(mP(n.h,n.h[0]),this.options)),n);if(((t=this._$AH)==null?void 0:t._$AD)===r)this._$AH.p(i);else{let o=new hy(r,this),a=o.u(this.options);o.p(i),this.T(a),this._$AH=o}}_$AC(e){let t=rT.get(e.strings);return t===void 0&&rT.set(e.strings,t=new Rd(e)),t}k(e){Gy(this._$AH)||(this._$AH=[],this._$AR());let t=this._$AH,i,n=0;for(let r of e)n===t.length?t.push(i=new s(this.O(Od()),this.O(Od()),this,this.options)):i=t[n],i._$AI(r),n++;n<t.length&&(this._$AR(i&&i._$AB.nextSibling,n),t.length=n)}_$AR(e=this._$AA.nextSibling,t){var i;for((i=this._$AP)==null?void 0:i.call(this,!1,!0,t);e&&e!==this._$AB;){let n=e.nextSibling;e.remove(),e=n}}setConnected(e){var t;this._$AM===void 0&&(this.v=e,(t=this._$AP)==null||t.call(this,e))}},wc=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,i,n,r){this.type=1,this._$AH=Li,this._$AN=void 0,this.element=e,this.name=t,this._$AM=n,this.options=r,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=Li}_$AI(e,t=this,i,n){let r=this.strings,o=!1;if(r===void 0)e=_c(this,e,t,0),o=!Md(e)||e!==this._$AH&&e!==Ga,o&&(this._$AH=e);else{let a=e,l,c;for(e=r[0],l=0;l<r.length-1;l++)c=_c(this,a[i+l],t,l),c===Ga&&(c=this._$AH[l]),o||(o=!Md(c)||c!==this._$AH[l]),c===Li?e=Li:e!==Li&&(e+=(c??"")+r[l+1]),this._$AH[l]=c}o&&!n&&this.j(e)}j(e){e===Li?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}},dy=class extends wc{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Li?void 0:e}},uy=class extends wc{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==Li)}},py=class extends wc{constructor(e,t,i,n,r){super(e,t,i,n,r),this.type=5}_$AI(e,t=this){if((e=_c(this,e,t,0)??Li)===Ga)return;let i=this._$AH,n=e===Li&&i!==Li||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,r=e!==Li&&(i===Li||n);n&&this.element.removeEventListener(this.name,this,i),r&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t;typeof this._$AH=="function"?this._$AH.call(((t=this.options)==null?void 0:t.host)??this.element,e):this._$AH.handleEvent(e)}},fy=class{constructor(e,t,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){_c(this,e)}},oT=Zf.litHtmlPolyfillSupport;oT?.(Rd,Dd),(Zf.litHtmlVersions??(Zf.litHtmlVersions=[])).push("3.2.0");var Ec=(s,e,t)=>{let i=t?.renderBefore??e,n=i._$litPart$;if(n===void 0){let r=t?.renderBefore??null;i._$litPart$=n=new Dd(e.insertBefore(Od(),r),r,void 0,t??{})}return n._$AI(s),n};var ei=class extends Mo{constructor(){super(...arguments),this.renderOptions={host:this},this.o=void 0}createRenderRoot(){var s;let e=super.createRenderRoot();return(s=this.renderOptions).renderBefore??(s.renderBefore=e.firstChild),e}update(s){let e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(s),this.o=Ec(e,this.renderRoot,this.renderOptions)}connectedCallback(){var s;super.connectedCallback(),(s=this.o)==null||s.setConnected(!0)}disconnectedCallback(){var s;super.disconnectedCallback(),(s=this.o)==null||s.setConnected(!1)}render(){return Ga}},aT;ei._$litElement$=!0,ei.finalized=!0,(aT=globalThis.litElementHydrateSupport)==null||aT.call(globalThis,{LitElement:ei});var lT=globalThis.litElementPolyfillSupport;lT?.({LitElement:ei});(globalThis.litElementVersions??(globalThis.litElementVersions=[])).push("4.1.0");var aB={attribute:!0,type:String,converter:$f,reflect:!1,hasChanged:Hy},lB=(s=aB,e,t)=>{let{kind:i,metadata:n}=t,r=globalThis.litPropertyMetadata.get(n);if(r===void 0&&globalThis.litPropertyMetadata.set(n,r=new Map),r.set(t.name,s),i==="accessor"){let{name:o}=t;return{set(a){let l=e.get.call(this);e.set.call(this,a),this.requestUpdate(o,l,s)},init(a){return a!==void 0&&this.P(o,void 0,s),a}}}if(i==="setter"){let{name:o}=t;return function(a){let l=this[o];e.call(this,a),this.requestUpdate(o,l,s)}}throw Error("Unsupported decorator location: "+i)};function ze(s){return(e,t)=>typeof t=="object"?lB(s,e,t):((i,n,r)=>{let o=n.hasOwnProperty(r);return n.constructor.createProperty(r,o?yt(Se({},i),{wrapped:!0}):i),o?Object.getOwnPropertyDescriptor(n,r):void 0})(s,e,t)}function Pc(s){return ze(yt(Se({},s),{state:!0,attribute:!1}))}var cB=s=>s.strings===void 0;var gP={ATTRIBUTE:1,CHILD:2,PROPERTY:3,BOOLEAN_ATTRIBUTE:4,EVENT:5,ELEMENT:6},bP=s=>(...e)=>({_$litDirective$:s,values:e}),Jf=class{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,i){this.t=e,this._$AM=t,this.i=i}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}};var Sd=(s,e)=>{var t;let i=s._$AN;if(i===void 0)return!1;for(let n of i)(t=n._$AO)==null||t.call(n,e,!1),Sd(n,e);return!0},em=s=>{let e,t;do{if((e=s._$AM)===void 0)break;t=e._$AN,t.delete(s),s=e}while(t?.size===0)},vP=s=>{for(let e;e=s._$AM;s=e){let t=e._$AN;if(t===void 0)e._$AN=t=new Set;else if(t.has(s))break;t.add(s),uB(e)}};function hB(s){this._$AN!==void 0?(em(this),this._$AM=s,vP(this)):this._$AM=s}function dB(s,e=!1,t=0){let i=this._$AH,n=this._$AN;if(n!==void 0&&n.size!==0)if(e)if(Array.isArray(i))for(let r=t;r<i.length;r++)Sd(i[r],!1),em(i[r]);else i!=null&&(Sd(i,!1),em(i));else Sd(this,s)}var uB=s=>{s.type==gP.CHILD&&(s._$AP??(s._$AP=dB),s._$AQ??(s._$AQ=hB))},my=class extends Jf{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,t,i){super._$AT(e,t,i),vP(this),this.isConnected=e._$AU}_$AO(e,t=!0){var i,n;e!==this.isConnected&&(this.isConnected=e,e?(i=this.reconnected)==null||i.call(this):(n=this.disconnected)==null||n.call(this)),t&&(Sd(this,e),em(this))}setValue(e){if(cB(this.t))this.t._$AI(e,this);else{let t=[...this.t._$AH];t[this.i]=e,this.t._$AI(t,this,0)}}disconnected(){}reconnected(){}};var Cc=()=>new gy,gy=class{},Jv=new WeakMap,vs=bP(class extends my{render(s){return Li}update(s,[e]){var t;let i=e!==this.Y;return i&&this.Y!==void 0&&this.rt(void 0),(i||this.lt!==this.ct)&&(this.Y=e,this.ht=(t=s.options)==null?void 0:t.host,this.rt(this.ct=s.element)),Li}rt(s){if(this.isConnected||(s=void 0),typeof this.Y=="function"){let e=this.ht??globalThis,t=Jv.get(e);t===void 0&&(t=new WeakMap,Jv.set(e,t)),t.get(this.Y)!==void 0&&this.Y.call(this.ht,void 0),t.set(this.Y,s),s!==void 0&&this.Y.call(this.ht,s)}else this.Y.value=s}get lt(){var s,e;return typeof this.Y=="function"?(s=Jv.get(this.ht??globalThis))==null?void 0:s.get(this.Y):(e=this.Y)==null?void 0:e.value}disconnected(){this.lt===this.ct&&this.rt(void 0)}reconnected(){this.rt(this.ct)}});var yP=Object.freeze({left:0,top:0,width:16,height:16}),tm=Object.freeze({rotate:0,vFlip:!1,hFlip:!1}),Hd=Object.freeze(Se(Se({},yP),tm)),by=Object.freeze(yt(Se({},Hd),{body:"",hidden:!1})),pB=Object.freeze({width:null,height:null}),_P=Object.freeze(Se(Se({},pB),tm));function fB(s,e=0){let t=s.replace(/^-?[0-9.]*/,"");function i(n){for(;n<0;)n+=4;return n%4}if(t===""){let n=parseInt(s);return isNaN(n)?0:i(n)}else if(t!==s){let n=0;switch(t){case"%":n=25;break;case"deg":n=90}if(n){let r=parseFloat(s.slice(0,s.length-t.length));return isNaN(r)?0:(r=r/n,r%1===0?i(r):0)}}return e}var mB=/[\s,]+/;function gB(s,e){e.split(mB).forEach(t=>{switch(t.trim()){case"horizontal":s.hFlip=!0;break;case"vertical":s.vFlip=!0;break}})}var wP=yt(Se({},_P),{preserveAspectRatio:""});function cT(s){let e=Se({},wP),t=(i,n)=>s.getAttribute(i)||n;return e.width=t("width",null),e.height=t("height",null),e.rotate=fB(t("rotate","")),gB(e,t("flip","")),e.preserveAspectRatio=t("preserveAspectRatio",t("preserveaspectratio","")),e}function bB(s,e){for(let t in wP)if(s[t]!==e[t])return!0;return!1}var Ad=/^[a-z0-9]+(-[a-z0-9]+)*$/,Gd=(s,e,t,i="")=>{let n=s.split(":");if(s.slice(0,1)==="@"){if(n.length<2||n.length>3)return null;i=n.shift().slice(1)}if(n.length>3||!n.length)return null;if(n.length>1){let a=n.pop(),l=n.pop(),c={provider:n.length>0?n[0]:i,prefix:l,name:a};return e&&!Hf(c)?null:c}let r=n[0],o=r.split("-");if(o.length>1){let a={provider:i,prefix:o.shift(),name:o.join("-")};return e&&!Hf(a)?null:a}if(t&&i===""){let a={provider:i,prefix:"",name:r};return e&&!Hf(a,t)?null:a}return null},Hf=(s,e)=>s?!!((s.provider===""||s.provider.match(Ad))&&(e&&s.prefix===""||s.prefix.match(Ad))&&s.name.match(Ad)):!1;function vB(s,e){let t={};!s.hFlip!=!e.hFlip&&(t.hFlip=!0),!s.vFlip!=!e.vFlip&&(t.vFlip=!0);let i=((s.rotate||0)+(e.rotate||0))%4;return i&&(t.rotate=i),t}function hT(s,e){let t=vB(s,e);for(let i in by)i in tm?i in s&&!(i in t)&&(t[i]=tm[i]):i in e?t[i]=e[i]:i in s&&(t[i]=s[i]);return t}function yB(s,e){let t=s.icons,i=s.aliases||Object.create(null),n=Object.create(null);function r(o){if(t[o])return n[o]=[];if(!(o in n)){n[o]=null;let a=i[o]&&i[o].parent,l=a&&r(a);l&&(n[o]=[a].concat(l))}return n[o]}return Object.keys(t).concat(Object.keys(i)).forEach(r),n}function _B(s,e,t){let i=s.icons,n=s.aliases||Object.create(null),r={};function o(a){r=hT(i[a]||n[a],r)}return o(e),t.forEach(o),hT(s,r)}function EP(s,e){let t=[];if(typeof s!="object"||typeof s.icons!="object")return t;s.not_found instanceof Array&&s.not_found.forEach(n=>{e(n,null),t.push(n)});let i=yB(s);for(let n in i){let r=i[n];r&&(e(n,_B(s,n,r)),t.push(n))}return t}var wB=Se({provider:"",aliases:{},not_found:{}},yP);function ey(s,e){for(let t in e)if(t in s&&typeof s[t]!=typeof e[t])return!1;return!0}function CP(s){if(typeof s!="object"||s===null)return null;let e=s;if(typeof e.prefix!="string"||!s.icons||typeof s.icons!="object"||!ey(s,wB))return null;let t=e.icons;for(let n in t){let r=t[n];if(!n.match(Ad)||typeof r.body!="string"||!ey(r,by))return null}let i=e.aliases||Object.create(null);for(let n in i){let r=i[n],o=r.parent;if(!n.match(Ad)||typeof o!="string"||!t[o]&&!i[o]||!ey(r,by))return null}return e}var im=Object.create(null);function EB(s,e){return{provider:s,prefix:e,icons:Object.create(null),missing:new Set}}function Uo(s,e){let t=im[s]||(im[s]=Object.create(null));return t[e]||(t[e]=EB(s,e))}function Wy(s,e){return CP(e)?EP(e,(t,i)=>{i?s.icons[t]=i:s.missing.add(t)}):[]}function CB(s,e,t){try{if(typeof t.body=="string")return s.icons[e]=Se({},t),!0}catch{}return!1}function xB(s,e){let t=[];return(typeof s=="string"?[s]:Object.keys(im)).forEach(i=>{(typeof i=="string"&&typeof e=="string"?[e]:Object.keys(im[i]||{})).forEach(n=>{let r=Uo(i,n);t=t.concat(Object.keys(r.icons).map(o=>(i!==""?"@"+i+":":"")+n+":"+o))})}),t}var Ld=!1;function xP(s){return typeof s=="boolean"&&(Ld=s),Ld}function Fd(s){let e=typeof s=="string"?Gd(s,!0,Ld):s;if(e){let t=Uo(e.provider,e.prefix),i=e.name;return t.icons[i]||(t.missing.has(i)?null:void 0)}}function SP(s,e){let t=Gd(s,!0,Ld);if(!t)return!1;let i=Uo(t.provider,t.prefix);return CB(i,t.name,e)}function dT(s,e){if(typeof s!="object")return!1;if(typeof e!="string"&&(e=s.provider||""),Ld&&!e&&!s.prefix){let n=!1;return CP(s)&&(s.prefix="",EP(s,(r,o)=>{o&&SP(r,o)&&(n=!0)})),n}let t=s.prefix;if(!Hf({provider:e,prefix:t,name:"a"}))return!1;let i=Uo(e,t);return!!Wy(i,s)}function uT(s){return!!Fd(s)}function SB(s){let e=Fd(s);return e?Se(Se({},Hd),e):null}function AB(s){let e={loaded:[],missing:[],pending:[]},t=Object.create(null);s.sort((n,r)=>n.provider!==r.provider?n.provider.localeCompare(r.provider):n.prefix!==r.prefix?n.prefix.localeCompare(r.prefix):n.name.localeCompare(r.name));let i={provider:"",prefix:"",name:""};return s.forEach(n=>{if(i.name===n.name&&i.prefix===n.prefix&&i.provider===n.provider)return;i=n;let r=n.provider,o=n.prefix,a=n.name,l=t[r]||(t[r]=Object.create(null)),c=l[o]||(l[o]=Uo(r,o)),d;a in c.icons?d=e.loaded:o===""||c.missing.has(a)?d=e.missing:d=e.pending;let h={provider:r,prefix:o,name:a};d.push(h)}),e}function AP(s,e){s.forEach(t=>{let i=t.loaderCallbacks;i&&(t.loaderCallbacks=i.filter(n=>n.id!==e))})}function IB(s){s.pendingCallbacksFlag||(s.pendingCallbacksFlag=!0,setTimeout(()=>{s.pendingCallbacksFlag=!1;let e=s.loaderCallbacks?s.loaderCallbacks.slice(0):[];if(!e.length)return;let t=!1,i=s.provider,n=s.prefix;e.forEach(r=>{let o=r.icons,a=o.pending.length;o.pending=o.pending.filter(l=>{if(l.prefix!==n)return!0;let c=l.name;if(s.icons[c])o.loaded.push({provider:i,prefix:n,name:c});else if(s.missing.has(c))o.missing.push({provider:i,prefix:n,name:c});else return t=!0,!0;return!1}),o.pending.length!==a&&(t||AP([s],r.id),r.callback(o.loaded.slice(0),o.missing.slice(0),o.pending.slice(0),r.abort))})}))}var TB=0;function PB(s,e,t){let i=TB++,n=AP.bind(null,t,i);if(!e.pending.length)return n;let r={id:i,icons:e,callback:s,abort:n};return t.forEach(o=>{(o.loaderCallbacks||(o.loaderCallbacks=[])).push(r)}),n}var vy=Object.create(null);function pT(s,e){vy[s]=e}function yy(s){return vy[s]||vy[""]}function OB(s,e=!0,t=!1){let i=[];return s.forEach(n=>{let r=typeof n=="string"?Gd(n,e,t):n;r&&i.push(r)}),i}var MB={resources:[],index:0,timeout:2e3,rotate:750,random:!1,dataAfterTimeout:!1};function RB(s,e,t,i){let n=s.resources.length,r=s.random?Math.floor(Math.random()*n):s.index,o;if(s.random){let C=s.resources.slice(0);for(o=[];C.length>1;){let A=Math.floor(Math.random()*C.length);o.push(C[A]),C=C.slice(0,A).concat(C.slice(A+1))}o=o.concat(C)}else o=s.resources.slice(r).concat(s.resources.slice(0,r));let a=Date.now(),l="pending",c=0,d,h=null,u=[],p=[];typeof i=="function"&&p.push(i);function f(){h&&(clearTimeout(h),h=null)}function m(){l==="pending"&&(l="aborted"),f(),u.forEach(C=>{C.status==="pending"&&(C.status="aborted")}),u=[]}function g(C,A){A&&(p=[]),typeof C=="function"&&p.push(C)}function b(){return{startTime:a,payload:e,status:l,queriesSent:c,queriesPending:u.length,subscribe:g,abort:m}}function v(){l="failed",p.forEach(C=>{C(void 0,d)})}function E(){u.forEach(C=>{C.status==="pending"&&(C.status="aborted")}),u=[]}function y(C,A,D){let M=A!=="success";switch(u=u.filter(I=>I!==C),l){case"pending":break;case"failed":if(M||!s.dataAfterTimeout)return;break;default:return}if(A==="abort"){d=D,v();return}if(M){d=D,u.length||(o.length?w():v());return}if(f(),E(),!s.random){let I=s.resources.indexOf(C.resource);I!==-1&&I!==s.index&&(s.index=I)}l="completed",p.forEach(I=>{I(D)})}function w(){if(l!=="pending")return;f();let C=o.shift();if(C===void 0){if(u.length){h=setTimeout(()=>{f(),l==="pending"&&(E(),v())},s.timeout);return}v();return}let A={status:"pending",resource:C,callback:(D,M)=>{y(A,D,M)}};u.push(A),c++,h=setTimeout(w,s.rotate),t(C,e,A.callback)}return setTimeout(w),b}function IP(s){let e=Se(Se({},MB),s),t=[];function i(){t=t.filter(o=>o().status==="pending")}function n(o,a,l){let c=RB(e,o,a,(d,h)=>{i(),l&&l(d,h)});return t.push(c),c}function r(o){return t.find(a=>o(a))||null}return{query:n,find:r,setIndex:o=>{e.index=o},getIndex:()=>e.index,cleanup:i}}function Yy(s){let e;if(typeof s.resources=="string")e=[s.resources];else if(e=s.resources,!(e instanceof Array)||!e.length)return null;return{resources:e,path:s.path||"/",maxURL:s.maxURL||500,rotate:s.rotate||750,timeout:s.timeout||5e3,random:s.random===!0,index:s.index||0,dataAfterTimeout:s.dataAfterTimeout!==!1}}var mm=Object.create(null),Bf=["https://api.simplesvg.com","https://api.unisvg.com"],_y=[];for(;Bf.length>0;)Bf.length===1||Math.random()>.5?_y.push(Bf.shift()):_y.push(Bf.pop());mm[""]=Yy({resources:["https://api.iconify.design"].concat(_y)});function fT(s,e){let t=Yy(e);return t===null?!1:(mm[s]=t,!0)}function gm(s){return mm[s]}function DB(){return Object.keys(mm)}function mT(){}var ty=Object.create(null);function LB(s){if(!ty[s]){let e=gm(s);if(!e)return;let t=IP(e),i={config:e,redundancy:t};ty[s]=i}return ty[s]}function TP(s,e,t){let i,n;if(typeof s=="string"){let r=yy(s);if(!r)return t(void 0,424),mT;n=r.send;let o=LB(s);o&&(i=o.redundancy)}else{let r=Yy(s);if(r){i=IP(r);let o=s.resources?s.resources[0]:"",a=yy(o);a&&(n=a.send)}}return!i||!n?(t(void 0,424),mT):i.query(e,n,t)().abort}var gT="iconify2",kd="iconify",PP=kd+"-count",bT=kd+"-version",OP=36e5,FB=168,kB=50;function wy(s,e){try{return s.getItem(e)}catch{}}function qy(s,e,t){try{return s.setItem(e,t),!0}catch{}}function vT(s,e){try{s.removeItem(e)}catch{}}function Ey(s,e){return qy(s,PP,e.toString())}function Cy(s){return parseInt(wy(s,PP))||0}var Va={local:!0,session:!0},MP={local:new Set,session:new Set},Xy=!1;function NB(s){Xy=s}var zf=typeof window>"u"?{}:window;function RP(s){let e=s+"Storage";try{if(zf&&zf[e]&&typeof zf[e].length=="number")return zf[e]}catch{}Va[s]=!1}function DP(s,e){let t=RP(s);if(!t)return;let i=wy(t,bT);if(i!==gT){if(i){let a=Cy(t);for(let l=0;l<a;l++)vT(t,kd+l.toString())}qy(t,bT,gT),Ey(t,0);return}let n=Math.floor(Date.now()/OP)-FB,r=a=>{let l=kd+a.toString(),c=wy(t,l);if(typeof c=="string"){try{let d=JSON.parse(c);if(typeof d=="object"&&typeof d.cached=="number"&&d.cached>n&&typeof d.provider=="string"&&typeof d.data=="object"&&typeof d.data.prefix=="string"&&e(d,a))return!0}catch{}vT(t,l)}},o=Cy(t);for(let a=o-1;a>=0;a--)r(a)||(a===o-1?(o--,Ey(t,o)):MP[s].add(a))}function LP(){if(!Xy){NB(!0);for(let s in Va)DP(s,e=>{let t=e.data,i=e.provider,n=t.prefix,r=Uo(i,n);if(!Wy(r,t).length)return!1;let o=t.lastModified||-1;return r.lastModifiedCached=r.lastModifiedCached?Math.min(r.lastModifiedCached,o):o,!0})}}function UB(s,e){let t=s.lastModifiedCached;if(t&&t>=e)return t===e;if(s.lastModifiedCached=e,t)for(let i in Va)DP(i,n=>{let r=n.data;return n.provider!==s.provider||r.prefix!==s.prefix||r.lastModified===e});return!0}function BB(s,e){Xy||LP();function t(i){let n;if(!Va[i]||!(n=RP(i)))return;let r=MP[i],o;if(r.size)r.delete(o=Array.from(r).shift());else if(o=Cy(n),o>=kB||!Ey(n,o+1))return;let a={cached:Math.floor(Date.now()/OP),provider:s.provider,data:e};return qy(n,kd+o.toString(),JSON.stringify(a))}e.lastModified&&!UB(s,e.lastModified)||Object.keys(e.icons).length&&(e.not_found&&(e=Object.assign({},e),delete e.not_found),t("local")||t("session"))}function yT(){}function zB(s){s.iconsLoaderFlag||(s.iconsLoaderFlag=!0,setTimeout(()=>{s.iconsLoaderFlag=!1,IB(s)}))}function VB(s,e){s.iconsToLoad?s.iconsToLoad=s.iconsToLoad.concat(e).sort():s.iconsToLoad=e,s.iconsQueueFlag||(s.iconsQueueFlag=!0,setTimeout(()=>{s.iconsQueueFlag=!1;let{provider:t,prefix:i}=s,n=s.iconsToLoad;delete s.iconsToLoad;let r;!n||!(r=yy(t))||r.prepare(t,i,n).forEach(o=>{TP(t,o,a=>{if(typeof a!="object")o.icons.forEach(l=>{s.missing.add(l)});else try{let l=Wy(s,a);if(!l.length)return;let c=s.pendingIcons;c&&l.forEach(d=>{c.delete(d)}),BB(s,a)}catch(l){console.error(l)}zB(s)})})}))}var Ky=(s,e)=>{let t=OB(s,!0,xP()),i=AB(t);if(!i.pending.length){let l=!0;return e&&setTimeout(()=>{l&&e(i.loaded,i.missing,i.pending,yT)}),()=>{l=!1}}let n=Object.create(null),r=[],o,a;return i.pending.forEach(l=>{let{provider:c,prefix:d}=l;if(d===a&&c===o)return;o=c,a=d,r.push(Uo(c,d));let h=n[c]||(n[c]=Object.create(null));h[d]||(h[d]=[])}),i.pending.forEach(l=>{let{provider:c,prefix:d,name:h}=l,u=Uo(c,d),p=u.pendingIcons||(u.pendingIcons=new Set);p.has(h)||(p.add(h),n[c][d].push(h))}),r.forEach(l=>{let{provider:c,prefix:d}=l;n[c][d].length&&VB(l,n[c][d])}),e?PB(e,i,r):yT},jB=s=>new Promise((e,t)=>{let i=typeof s=="string"?Gd(s,!0):s;if(!i){t(s);return}Ky([i||s],n=>{if(n.length&&i){let r=Fd(i);if(r){e(Se(Se({},Hd),r));return}}t(s)})});function HB(s){try{let e=typeof s=="string"?JSON.parse(s):s;if(typeof e.body=="string")return Se({},e)}catch{}}function GB(s,e){let t=typeof s=="string"?Gd(s,!0,!0):null;if(!t){let r=HB(s);return{value:s,data:r}}let i=Fd(t);if(i!==void 0||!t.prefix)return{value:s,name:t,data:i};let n=Ky([t],()=>e(s,t,Fd(t)));return{value:s,name:t,loading:n}}function iy(s){return s.hasAttribute("inline")}var FP=!1;try{FP=navigator.vendor.indexOf("Apple")===0}catch{}function WB(s,e){switch(e){case"svg":case"bg":case"mask":return e}return e!=="style"&&(FP||s.indexOf("<a")===-1)?"svg":s.indexOf("currentColor")===-1?"bg":"mask"}var YB=/(-?[0-9.]*[0-9]+[0-9.]*)/g,qB=/^-?[0-9.]*[0-9]+[0-9.]*$/g;function xy(s,e,t){if(e===1)return s;if(t=t||100,typeof s=="number")return Math.ceil(s*e*t)/t;if(typeof s!="string")return s;let i=s.split(YB);if(i===null||!i.length)return s;let n=[],r=i.shift(),o=qB.test(r);for(;;){if(o){let a=parseFloat(r);isNaN(a)?n.push(r):n.push(Math.ceil(a*e*t)/t)}else n.push(r);if(r=i.shift(),r===void 0)return n.join("");o=!o}}function XB(s,e="defs"){let t="",i=s.indexOf("<"+e);for(;i>=0;){let n=s.indexOf(">",i),r=s.indexOf("</"+e);if(n===-1||r===-1)break;let o=s.indexOf(">",r);if(o===-1)break;t+=s.slice(n+1,r).trim(),s=s.slice(0,i).trim()+s.slice(o+1)}return{defs:t,content:s}}function KB(s,e){return s?"<defs>"+s+"</defs>"+e:e}function $B(s,e,t){let i=XB(s);return KB(i.defs,e+i.content+t)}var ZB=s=>s==="unset"||s==="undefined"||s==="none";function kP(s,e){let t=Se(Se({},Hd),s),i=Se(Se({},_P),e),n={left:t.left,top:t.top,width:t.width,height:t.height},r=t.body;[t,i].forEach(m=>{let g=[],b=m.hFlip,v=m.vFlip,E=m.rotate;b?v?E+=2:(g.push("translate("+(n.width+n.left).toString()+" "+(0-n.top).toString()+")"),g.push("scale(-1 1)"),n.top=n.left=0):v&&(g.push("translate("+(0-n.left).toString()+" "+(n.height+n.top).toString()+")"),g.push("scale(1 -1)"),n.top=n.left=0);let y;switch(E<0&&(E-=Math.floor(E/4)*4),E=E%4,E){case 1:y=n.height/2+n.top,g.unshift("rotate(90 "+y.toString()+" "+y.toString()+")");break;case 2:g.unshift("rotate(180 "+(n.width/2+n.left).toString()+" "+(n.height/2+n.top).toString()+")");break;case 3:y=n.width/2+n.left,g.unshift("rotate(-90 "+y.toString()+" "+y.toString()+")");break}E%2===1&&(n.left!==n.top&&(y=n.left,n.left=n.top,n.top=y),n.width!==n.height&&(y=n.width,n.width=n.height,n.height=y)),g.length&&(r=$B(r,'<g transform="'+g.join(" ")+'">',"</g>"))});let o=i.width,a=i.height,l=n.width,c=n.height,d,h;o===null?(h=a===null?"1em":a==="auto"?c:a,d=xy(h,l/c)):(d=o==="auto"?l:o,h=a===null?xy(d,c/l):a==="auto"?c:a);let u={},p=(m,g)=>{ZB(g)||(u[m]=g.toString())};p("width",d),p("height",h);let f=[n.left,n.top,l,c];return u.viewBox=f.join(" "),{attributes:u,viewBox:f,body:r}}function $y(s,e){let t=s.indexOf("xlink:")===-1?"":' xmlns:xlink="http://www.w3.org/1999/xlink"';for(let i in e)t+=" "+i+'="'+e[i]+'"';return'<svg xmlns="http://www.w3.org/2000/svg"'+t+">"+s+"</svg>"}function QB(s){return s.replace(/"/g,"'").replace(/%/g,"%25").replace(/#/g,"%23").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/\s+/g," ")}function JB(s){return"data:image/svg+xml,"+QB(s)}function NP(s){return'url("'+JB(s)+'")'}var e5=()=>{let s;try{if(s=fetch,typeof s=="function")return s}catch{}},nm=e5();function t5(s){nm=s}function i5(){return nm}function n5(s,e){let t=gm(s);if(!t)return 0;let i;if(!t.maxURL)i=0;else{let n=0;t.resources.forEach(o=>{n=Math.max(n,o.length)});let r=e+".json?icons=";i=t.maxURL-n-t.path.length-r.length}return i}function s5(s){return s===404}var r5=(s,e,t)=>{let i=[],n=n5(s,e),r="icons",o={type:r,provider:s,prefix:e,icons:[]},a=0;return t.forEach((l,c)=>{a+=l.length+1,a>=n&&c>0&&(i.push(o),o={type:r,provider:s,prefix:e,icons:[]},a=l.length),o.icons.push(l)}),i.push(o),i};function o5(s){if(typeof s=="string"){let e=gm(s);if(e)return e.path}return"/"}var a5=(s,e,t)=>{if(!nm){t("abort",424);return}let i=o5(e.provider);switch(e.type){case"icons":{let r=e.prefix,o=e.icons.join(","),a=new URLSearchParams({icons:o});i+=r+".json?"+a.toString();break}case"custom":{let r=e.uri;i+=r.slice(0,1)==="/"?r.slice(1):r;break}default:t("abort",400);return}let n=503;nm(s+i).then(r=>{let o=r.status;if(o!==200){setTimeout(()=>{t(s5(o)?"abort":"next",o)});return}return n=501,r.json()}).then(r=>{if(typeof r!="object"||r===null){setTimeout(()=>{r===404?t("abort",r):t("next",n)});return}setTimeout(()=>{t("success",r)})}).catch(()=>{t("next",n)})},l5={prepare:r5,send:a5};function _T(s,e){switch(s){case"local":case"session":Va[s]=e;break;case"all":for(let t in Va)Va[t]=e;break}}var ny="data-style",UP="";function c5(s){UP=s}function wT(s,e){let t=Array.from(s.childNodes).find(i=>i.hasAttribute&&i.hasAttribute(ny));t||(t=document.createElement("style"),t.setAttribute(ny,ny),s.appendChild(t)),t.textContent=":host{display:inline-block;vertical-align:"+(e?"-0.125em":"0")+"}span,svg{display:block}"+UP}function BP(){pT("",l5),xP(!0);let s;try{s=window}catch{}if(s){if(LP(),s.IconifyPreload!==void 0){let e=s.IconifyPreload,t="Invalid IconifyPreload syntax.";typeof e=="object"&&e!==null&&(e instanceof Array?e:[e]).forEach(i=>{try{(typeof i!="object"||i===null||i instanceof Array||typeof i.icons!="object"||typeof i.prefix!="string"||!dT(i))&&console.error(t)}catch{console.error(t)}})}if(s.IconifyProviders!==void 0){let e=s.IconifyProviders;if(typeof e=="object"&&e!==null)for(let t in e){let i="IconifyProviders["+t+"] is invalid.";try{let n=e[t];if(typeof n!="object"||!n||n.resources===void 0)continue;fT(t,n)||console.error(i)}catch{console.error(i)}}}}return{enableCache:e=>_T(e,!0),disableCache:e=>_T(e,!1),iconLoaded:uT,iconExists:uT,getIcon:SB,listIcons:xB,addIcon:SP,addCollection:dT,calculateSize:xy,buildIcon:kP,iconToHTML:$y,svgToURL:NP,loadIcons:Ky,loadIcon:jB,addAPIProvider:fT,appendCustomStyle:c5,_api:{getAPIConfig:gm,setAPIModule:pT,sendAPIQuery:TP,setFetch:t5,getFetch:i5,listAPIProviders:DB}}}var Sy={"background-color":"currentColor"},zP={"background-color":"transparent"},ET={image:"var(--svg)",repeat:"no-repeat",size:"100% 100%"},CT={"-webkit-mask":Sy,mask:Sy,background:zP};for(let s in CT){let e=CT[s];for(let t in ET)e[s+"-"+t]=ET[t]}function xT(s){return s?s+(s.match(/^[-0-9.]+$/)?"px":""):"inherit"}function h5(s,e,t){let i=document.createElement("span"),n=s.body;n.indexOf("<a")!==-1&&(n+="<!-- "+Date.now()+" -->");let r=s.attributes,o=$y(n,yt(Se({},r),{width:e.width+"",height:e.height+""})),a=NP(o),l=i.style,c=Se({"--svg":a,width:xT(r.width),height:xT(r.height)},t?Sy:zP);for(let d in c)l.setProperty(d,c[d]);return i}var Id;function d5(){try{Id=window.trustedTypes.createPolicy("iconify",{createHTML:s=>s})}catch{Id=null}}function u5(s){return Id===void 0&&d5(),Id?Id.createHTML(s):s}function p5(s){let e=document.createElement("span"),t=s.attributes,i="";t.width||(i="width: inherit;"),t.height||(i+="height: inherit;"),i&&(t.style=i);let n=$y(s.body,t);return e.innerHTML=u5(n),e.firstChild}function Ay(s){return Array.from(s.childNodes).find(e=>{let t=e.tagName&&e.tagName.toUpperCase();return t==="SPAN"||t==="SVG"})}function ST(s,e){let t=e.icon.data,i=e.customisations,n=kP(t,i);i.preserveAspectRatio&&(n.attributes.preserveAspectRatio=i.preserveAspectRatio);let r=e.renderedMode,o;switch(r){case"svg":o=p5(n);break;default:o=h5(n,Se(Se({},Hd),t),r==="mask")}let a=Ay(s);a?o.tagName==="SPAN"&&a.tagName===o.tagName?a.setAttribute("style",o.getAttribute("style")):s.replaceChild(o,a):s.appendChild(o)}function AT(s,e,t){let i=t&&(t.rendered?t:t.lastRender);return{rendered:!1,inline:e,icon:s,lastRender:i}}function f5(s="iconify-icon"){let e,t;try{e=window.customElements,t=window.HTMLElement}catch{return}if(!e||!t)return;let i=e.get(s);if(i)return i;let n=["icon","mode","inline","observe","width","height","rotate","flip"],r=class extends t{constructor(){super(),ka(this,"_shadowRoot"),ka(this,"_initialised",!1),ka(this,"_state"),ka(this,"_checkQueued",!1),ka(this,"_connected",!1),ka(this,"_observer",null),ka(this,"_visible",!0);let a=this._shadowRoot=this.attachShadow({mode:"open"}),l=iy(this);wT(a,l),this._state=AT({value:""},l),this._queueCheck()}connectedCallback(){this._connected=!0,this.startObserver()}disconnectedCallback(){this._connected=!1,this.stopObserver()}static get observedAttributes(){return n.slice(0)}attributeChangedCallback(a){switch(a){case"inline":{let l=iy(this),c=this._state;l!==c.inline&&(c.inline=l,wT(this._shadowRoot,l));break}case"observer":{this.observer?this.startObserver():this.stopObserver();break}default:this._queueCheck()}}get icon(){let a=this.getAttribute("icon");if(a&&a.slice(0,1)==="{")try{return JSON.parse(a)}catch{}return a}set icon(a){typeof a=="object"&&(a=JSON.stringify(a)),this.setAttribute("icon",a)}get inline(){return iy(this)}set inline(a){a?this.setAttribute("inline","true"):this.removeAttribute("inline")}get observer(){return this.hasAttribute("observer")}set observer(a){a?this.setAttribute("observer","true"):this.removeAttribute("observer")}restartAnimation(){let a=this._state;if(a.rendered){let l=this._shadowRoot;if(a.renderedMode==="svg")try{l.lastChild.setCurrentTime(0);return}catch{}ST(l,a)}}get status(){let a=this._state;return a.rendered?"rendered":a.icon.data===null?"failed":"loading"}_queueCheck(){this._checkQueued||(this._checkQueued=!0,setTimeout(()=>{this._check()}))}_check(){if(!this._checkQueued)return;this._checkQueued=!1;let a=this._state,l=this.getAttribute("icon");if(l!==a.icon.value){this._iconChanged(l);return}if(!a.rendered||!this._visible)return;let c=this.getAttribute("mode"),d=cT(this);(a.attrMode!==c||bB(a.customisations,d)||!Ay(this._shadowRoot))&&this._renderIcon(a.icon,d,c)}_iconChanged(a){let l=GB(a,(c,d,h)=>{let u=this._state;if(u.rendered||this.getAttribute("icon")!==c)return;let p={value:c,name:d,data:h};p.data?this._gotIconData(p):u.icon=p});l.data?this._gotIconData(l):this._state=AT(l,this._state.inline,this._state)}_forceRender(){if(!this._visible){let a=Ay(this._shadowRoot);a&&this._shadowRoot.removeChild(a);return}this._queueCheck()}_gotIconData(a){this._checkQueued=!1,this._renderIcon(a,cT(this),this.getAttribute("mode"))}_renderIcon(a,l,c){let d=WB(a.data.body,c),h=this._state.inline;ST(this._shadowRoot,this._state={rendered:!0,icon:a,inline:h,customisations:l,attrMode:c,renderedMode:d})}startObserver(){if(!this._observer)try{this._observer=new IntersectionObserver(a=>{let l=a.some(c=>c.isIntersecting);l!==this._visible&&(this._visible=l,this._forceRender())}),this._observer.observe(this)}catch{if(this._observer){try{this._observer.disconnect()}catch{}this._observer=null}}}stopObserver(){this._observer&&(this._observer.disconnect(),this._observer=null,this._visible=!0,this._connected&&this._forceRender())}};n.forEach(a=>{a in r.prototype||Object.defineProperty(r.prototype,a,{get:function(){return this.getAttribute(a)},set:function(l){l!==null?this.setAttribute(a,l):this.removeAttribute(a)}})});let o=BP();for(let a in o)r[a]=r.prototype[a]=o[a];return e.define(s,r),r}f5()||BP();var m5=Object.defineProperty,g5=Object.getOwnPropertyDescriptor,ks=(s,e,t,i)=>{for(var n=i>1?void 0:i?g5(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&m5(e,t,n),n},VP=class extends ei{constructor(){super(),this.labelHidden=!1,this.active=!1,this.disabled=!1,this.vertical=!1,this.tooltipVisible=!1,this._stateBeforeLoading={disabled:!1,icon:""},this._loading=!1,this._parent=Cc(),this._tooltip=Cc(),this._mouseLeave=!1,this.onClick=s=>{s.stopPropagation(),this.disabled||this.dispatchEvent(new Event("click"))},this.showContextMenu=()=>{let s=this._contextMenu;s&&(s.visible=!0)},this.mouseLeave=!0}set loading(s){if(this._loading=s,s)this._stateBeforeLoading={disabled:this.disabled,icon:this.icon},this.disabled=s,this.icon="eos-icons:loading";else{let{disabled:e,icon:t}=this._stateBeforeLoading;this.disabled=e,this.icon=t}}get loading(){return this._loading}set mouseLeave(s){this._mouseLeave=s,s&&(this.tooltipVisible=!1,clearTimeout(this.timeoutID))}get mouseLeave(){return this._mouseLeave}computeTooltipPosition(){let{value:s}=this._parent,{value:e}=this._tooltip;s&&e&&hP(s,e,{placement:"bottom",middleware:[ZT(10),cP(),lP(),aP({padding:5})]}).then(t=>{let{x:i,y:n}=t;Object.assign(e.style,{left:`${i}px`,top:`${n}px`})})}onMouseEnter(){if(!(this.tooltipTitle||this.tooltipText))return;this.mouseLeave=!1;let s=this.tooltipTime??700;this.timeoutID=setTimeout(()=>{this.mouseLeave||(this.computeTooltipPosition(),this.tooltipVisible=!0)},s)}click(){this.disabled||super.click()}get _contextMenu(){return this.querySelector("bim-context-menu")}connectedCallback(){super.connectedCallback(),this.addEventListener("click",this.showContextMenu)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("click",this.showContextMenu)}render(){let s=Me`
      <div ${vs(this._tooltip)} class="tooltip">
        ${this.tooltipTitle?Me`<p style="text-wrap: nowrap;">
              <strong>${this.tooltipTitle}</strong>
            </p>`:null}
        ${this.tooltipText?Me`<p style="width: 9rem;">${this.tooltipText}</p>`:null}
      </div>
    `;return Me`
      <div ${vs(this._parent)} class="parent" @click=${this.onClick}>
        ${this.label||this.icon?Me`
              <div
                class="button"
                @mouseenter=${this.onMouseEnter}
                @mouseleave=${()=>this.mouseLeave=!0}
              >
                <bim-label
                  .icon=${this.icon}
                  .vertical=${this.vertical}
                  .labelHidden=${this.labelHidden}
                  >${this.label}</bim-label
                >
              </div>
            `:null}
        ${this.tooltipTitle||this.tooltipText?s:null}
      </div>
      <slot></slot>
    `}};VP.styles=oi`
    :host {
      --bim-label--c: var(--bim-ui_bg-contrast-100, white);
      display: block;
      flex: 1;
      pointer-events: none;
      background-color: var(--bim-button--bgc, var(--bim-ui_bg-contrast-20));
      border-radius: var(--bim-ui_size-4xs);
      transition: all 0.15s;
    }

    :host(:not([disabled]):hover) {
      cursor: pointer;
    }

    bim-label {
      pointer-events: none;
    }

    .parent {
      --bim-icon--c: var(--bim-label--c);
      position: relative;
      display: flex;
      height: 100%;
      user-select: none;
      row-gap: 0.125rem;
      min-height: var(--bim-ui_size-5xl);
      min-width: var(--bim-ui_size-5xl);
    }

    .button,
    .children {
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: auto;
    }

    .children {
      padding: 0 0.375rem;
      position: absolute;
      height: 100%;
      right: 0;
    }

    :host(:not([label-hidden])[icon][vertical]) .parent {
      min-height: 2.5rem;
    }

    .button {
      flex-grow: 1;
    }

    :host(:not([label-hidden])[label]) .button {
      justify-content: var(--bim-button--jc, center);
    }

    :host(:hover),
    :host([active]) {
      --bim-label--c: var(--bim-ui_main-contrast);
      background-color: var(--bim-ui_main-base);
    }

    :host(:not([label]):not([icon])) .children {
      flex: 1;
    }

    :host([vertical]) .parent {
      justify-content: center;
    }

    :host(:not([label-hidden])[label]) .button {
      padding: 0 0.5rem;
    }

    :host([disabled]) {
      --bim-label--c: var(--bim-ui_bg-contrast-80);
      background-color: gray;
    }

    ::slotted(bim-button) {
      --bim-icon--fz: var(--bim-ui_size-base);
      --bim-button--bdrs: var(--bim-ui_size-4xs);
      --bim-button--olw: 0;
      --bim-button--olc: transparent;
    }

    .tooltip {
      position: absolute;
      padding: 0.75rem;
      z-index: 99;
      display: flex;
      flex-flow: column;
      row-gap: 0.375rem;
      box-shadow: 0 0 10px 3px rgba(0 0 0 / 20%);
      outline: 1px solid var(--bim-ui_bg-contrast-40);
      font-size: var(--bim-ui_size-xs);
      border-radius: var(--bim-ui_size-4xs);
      background-color: var(--bim-ui_bg-contrast-20);
      color: var(--bim-ui_bg-contrast-100);
    }

    .tooltip p {
      margin: 0;
      padding: 0;
    }

    :host(:not([tooltip-visible])) .tooltip {
      display: none;
    }
  `;var ys=VP;ks([ze({type:String,reflect:!0})],ys.prototype,"label",2);ks([ze({type:Boolean,attribute:"label-hidden",reflect:!0})],ys.prototype,"labelHidden",2);ks([ze({type:Boolean,reflect:!0})],ys.prototype,"active",2);ks([ze({type:Boolean,reflect:!0,attribute:"disabled"})],ys.prototype,"disabled",2);ks([ze({type:String,reflect:!0})],ys.prototype,"icon",2);ks([ze({type:Boolean,reflect:!0})],ys.prototype,"vertical",2);ks([ze({type:Number,attribute:"tooltip-time",reflect:!0})],ys.prototype,"tooltipTime",2);ks([ze({type:Boolean,attribute:"tooltip-visible",reflect:!0})],ys.prototype,"tooltipVisible",2);ks([ze({type:String,attribute:"tooltip-title",reflect:!0})],ys.prototype,"tooltipTitle",2);ks([ze({type:String,attribute:"tooltip-text",reflect:!0})],ys.prototype,"tooltipText",2);ks([ze({type:Boolean,reflect:!0})],ys.prototype,"loading",1);var b5=Object.defineProperty,Wd=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&b5(e,t,n),n},jP=class extends ei{constructor(){super(...arguments),this.checked=!1,this.inverted=!1,this.onValueChange=new Event("change")}get value(){return this.checked}onChange(s){s.stopPropagation(),this.checked=s.target.checked,this.dispatchEvent(this.onValueChange)}render(){return Me`
      <div class="parent">
        ${this.label?Me`<bim-label .icon="${this.icon}">${this.label}</bim-label> `:null}
        <input
          type="checkbox"
          aria-label=${this.label||this.name||"Checkbox Input"}
          @change="${this.onChange}"
          .checked="${this.checked}"
        />
      </div>
    `}};jP.styles=oi`
    :host {
      display: block;
    }

    .parent {
      display: flex;
      justify-content: space-between;
      height: 1.75rem;
      column-gap: 0.25rem;
      width: 100%;
      align-items: center;
      transition: all 0.15s;
    }

    :host([inverted]) .parent {
      flex-direction: row-reverse;
      justify-content: start;
    }

    input {
      height: 1rem;
      width: 1rem;
      cursor: pointer;
      border: none;
      outline: none;
      accent-color: var(--bim-checkbox--c, var(--bim-ui_main-base));
      transition: all 0.15s;
    }

    input:focus {
      outline: var(--bim-checkbox--olw, 2px) solid
        var(--bim-checkbox--olc, var(--bim-ui_accent-base));
    }
  `;var Oc=jP;Wd([ze({type:String,reflect:!0})],Oc.prototype,"icon");Wd([ze({type:String,reflect:!0})],Oc.prototype,"name");Wd([ze({type:String,reflect:!0})],Oc.prototype,"label");Wd([ze({type:Boolean,reflect:!0})],Oc.prototype,"checked");Wd([ze({type:Boolean,reflect:!0})],Oc.prototype,"inverted");var v5=Object.defineProperty,Mc=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&v5(e,t,n),n},HP=class extends ei{constructor(){super(...arguments),this.vertical=!1,this.color="#bcf124",this._colorInput=Cc(),this._textInput=Cc(),this.onValueChange=new Event("input"),this.onOpacityInput=s=>{let e=s.target;this.opacity=e.value,this.dispatchEvent(this.onValueChange)}}set value(s){let{color:e,opacity:t}=s;this.color=e,t&&(this.opacity=t)}get value(){let s={color:this.color};return this.opacity&&(s.opacity=this.opacity),s}onColorInput(s){s.stopPropagation();let{value:e}=this._colorInput;e&&(this.color=e.value,this.dispatchEvent(this.onValueChange))}onTextInput(s){s.stopPropagation();let{value:e}=this._textInput;if(!e)return;let{value:t}=e,i=t.replace(/[^a-fA-F0-9]/g,"");i.startsWith("#")||(i=`#${i}`),e.value=i.slice(0,7),e.value.length===7&&(this.color=e.value,this.dispatchEvent(this.onValueChange))}focus(){let{value:s}=this._colorInput;s&&s.click()}render(){return Me`
      <div class="parent">
        <bim-input
          .label=${this.label}
          .icon=${this.icon}
          .vertical="${this.vertical}"
        >
          <div class="color-container">
            <div
              style="display: flex; align-items: center; gap: .375rem; height: 100%; flex: 1; padding: 0 0.5rem;"
            >
              <input
                ${vs(this._colorInput)}
                @input="${this.onColorInput}"
                type="color"
                aria-label=${this.label||this.name||"Color Input"}
                value="${this.color}"
              />
              <div
                @click=${this.focus}
                class="sample"
                style="background-color: ${this.color}"
              ></div>
              <input
                ${vs(this._textInput)}
                @input="${this.onTextInput}"
                value="${this.color}"
                type="text"
                aria-label=${this.label||this.name||"Text Color Input"}
              />
            </div>
            ${this.opacity!==void 0?Me`<bim-number-input
                  @change=${this.onOpacityInput}
                  slider
                  suffix="%"
                  min="0"
                  value=${this.opacity}
                  max="100"
                ></bim-number-input>`:null}
          </div>
        </bim-input>
      </div>
    `}};HP.styles=oi`
    :host {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
      flex: 1;
      display: block;
    }

    :host(:focus) {
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(--bim-ui_accent-base);
    }

    .parent {
      display: flex;
      gap: 0.375rem;
    }

    .color-container {
      position: relative;
      outline: none;
      display: flex;
      height: 100%;
      gap: 0.5rem;
      justify-content: flex-start;
      align-items: center;
      flex: 1;
      border-radius: var(--bim-color-input--bdrs, var(--bim-ui_size-4xs));
    }

    .color-container input[type="color"] {
      position: absolute;
      bottom: -0.25rem;
      visibility: hidden;
      width: 0;
      height: 0;
    }

    .color-container .sample {
      width: 1rem;
      height: 1rem;
      border-radius: 0.125rem;
      background-color: #fff;
    }

    .color-container input[type="text"] {
      height: 100%;
      flex: 1;
      width: 3.25rem;
      text-transform: uppercase;
      font-size: 0.75rem;
      background-color: transparent;
      padding: 0%;
      outline: none;
      border: none;
      color: var(--bim-color-input--c, var(--bim-ui_bg-contrast-100));
    }

    bim-number-input {
      flex-grow: 0;
    }
  `;var Ya=HP;Mc([ze({type:String,reflect:!0})],Ya.prototype,"name");Mc([ze({type:String,reflect:!0})],Ya.prototype,"label");Mc([ze({type:String,reflect:!0})],Ya.prototype,"icon");Mc([ze({type:Boolean,reflect:!0})],Ya.prototype,"vertical");Mc([ze({type:Number,reflect:!0})],Ya.prototype,"opacity");Mc([ze({type:String,reflect:!0})],Ya.prototype,"color");var y5=oi`
  ::-webkit-scrollbar {
    width: 0.4rem;
    height: 0.4rem;
    overflow: hidden;
  }

  ::-webkit-scrollbar-thumb {
    border-radius: 0.25rem;
    background-color: var(
      --bim-scrollbar--c,
      color-mix(in lab, var(--bim-ui_main-base), white 15%)
    );
  }

  ::-webkit-scrollbar-track {
    background-color: var(--bim-scrollbar--bgc, var(--bim-ui_bg-base));
  }
`,_5=oi`
  :root {
    /* Grayscale Colors */
    --bim-ui_gray-0: hsl(210 10% 5%);
    --bim-ui_gray-1: hsl(210 10% 10%);
    --bim-ui_gray-2: hsl(210 10% 20%);
    --bim-ui_gray-3: hsl(210 10% 30%);
    --bim-ui_gray-4: hsl(210 10% 40%);
    --bim-ui_gray-6: hsl(210 10% 60%);
    --bim-ui_gray-7: hsl(210 10% 70%);
    --bim-ui_gray-8: hsl(210 10% 80%);
    --bim-ui_gray-9: hsl(210 10% 90%);
    --bim-ui_gray-10: hsl(210 10% 95%);

    /* Brand Colors */
    --bim-ui_main-base: #6528d7;
    --bim-ui_accent-base: #bcf124;

    /* Brand Colors Contrasts */
    --bim-ui_main-contrast: var(--bim-ui_gray-10);
    --bim-ui_accent-contrast: var(--bim-ui_gray-0);

    /* Sizes */
    --bim-ui_size-4xs: 0.375rem;
    --bim-ui_size-3xs: 0.5rem;
    --bim-ui_size-2xs: 0.625rem;
    --bim-ui_size-xs: 0.75rem;
    --bim-ui_size-sm: 0.875rem;
    --bim-ui_size-base: 1rem;
    --bim-ui_size-lg: 1.125rem;
    --bim-ui_size-xl: 1.25rem;
    --bim-ui_size-2xl: 1.375rem;
    --bim-ui_size-3xl: 1.5rem;
    --bim-ui_size-4xl: 1.625rem;
    --bim-ui_size-5xl: 1.75rem;
    --bim-ui_size-6xl: 1.875rem;
    --bim-ui_size-7xl: 2rem;
    --bim-ui_size-8xl: 2.125rem;
    --bim-ui_size-9xl: 2.25rem;
  }

  /* Background Colors */
  @media (prefers-color-scheme: dark) {
    :root {
      --bim-ui_bg-base: var(--bim-ui_gray-0);
      --bim-ui_bg-contrast-10: var(--bim-ui_gray-1);
      --bim-ui_bg-contrast-20: var(--bim-ui_gray-2);
      --bim-ui_bg-contrast-30: var(--bim-ui_gray-3);
      --bim-ui_bg-contrast-40: var(--bim-ui_gray-4);
      --bim-ui_bg-contrast-60: var(--bim-ui_gray-6);
      --bim-ui_bg-contrast-80: var(--bim-ui_gray-8);
      --bim-ui_bg-contrast-100: var(--bim-ui_gray-10);
    }
  }

  @media (prefers-color-scheme: light) {
    :root {
      --bim-ui_bg-base: var(--bim-ui_gray-10);
      --bim-ui_bg-contrast-10: var(--bim-ui_gray-9);
      --bim-ui_bg-contrast-20: var(--bim-ui_gray-8);
      --bim-ui_bg-contrast-30: var(--bim-ui_gray-7);
      --bim-ui_bg-contrast-40: var(--bim-ui_gray-6);
      --bim-ui_bg-contrast-60: var(--bim-ui_gray-4);
      --bim-ui_bg-contrast-80: var(--bim-ui_gray-2);
      --bim-ui_bg-contrast-100: var(--bim-ui_gray-0);
      --bim-ui_accent-base: #6528d7;
    }
  }

  html.bim-ui-dark {
    --bim-ui_bg-base: var(--bim-ui_gray-0);
    --bim-ui_bg-contrast-10: var(--bim-ui_gray-1);
    --bim-ui_bg-contrast-20: var(--bim-ui_gray-2);
    --bim-ui_bg-contrast-30: var(--bim-ui_gray-3);
    --bim-ui_bg-contrast-40: var(--bim-ui_gray-4);
    --bim-ui_bg-contrast-60: var(--bim-ui_gray-6);
    --bim-ui_bg-contrast-80: var(--bim-ui_gray-8);
    --bim-ui_bg-contrast-100: var(--bim-ui_gray-10);
  }

  html.bim-ui-light {
    --bim-ui_bg-base: var(--bim-ui_gray-10);
    --bim-ui_bg-contrast-10: var(--bim-ui_gray-9);
    --bim-ui_bg-contrast-20: var(--bim-ui_gray-8);
    --bim-ui_bg-contrast-30: var(--bim-ui_gray-7);
    --bim-ui_bg-contrast-40: var(--bim-ui_gray-6);
    --bim-ui_bg-contrast-60: var(--bim-ui_gray-4);
    --bim-ui_bg-contrast-80: var(--bim-ui_gray-2);
    --bim-ui_bg-contrast-100: var(--bim-ui_gray-0);
    --bim-ui_accent-base: #6528d7;
  }

  [data-context-dialog]::backdrop {
    background-color: transparent;
  }
`,zo={scrollbar:y5,globalStyles:_5},GP=class Zt{static set config(e){this._config=Se(Se({},Zt._config),e)}static get config(){return Zt._config}static addGlobalStyles(){let e=document.querySelector("style[id='bim-ui']");if(e)return;e=document.createElement("style"),e.id="bim-ui",e.textContent=zo.globalStyles.cssText;let t=document.head.firstChild;t?document.head.insertBefore(e,t):document.head.append(e)}static defineCustomElement(e,t){customElements.get(e)||customElements.define(e,t)}static registerComponents(){Zt.init()}static init(){Zt.addGlobalStyles(),Zt.defineCustomElement("bim-button",ys),Zt.defineCustomElement("bim-checkbox",Oc),Zt.defineCustomElement("bim-color-input",Ya),Zt.defineCustomElement("bim-context-menu",C5),Zt.defineCustomElement("bim-dropdown",Ur),Zt.defineCustomElement("bim-grid",Qy),Zt.defineCustomElement("bim-icon",O5),Zt.defineCustomElement("bim-input",Yd),Zt.defineCustomElement("bim-label",Rc),Zt.defineCustomElement("bim-number-input",Gn),Zt.defineCustomElement("bim-option",$i),Zt.defineCustomElement("bim-panel",qa),Zt.defineCustomElement("bim-panel-section",Dc),Zt.defineCustomElement("bim-selector",Lc),Zt.defineCustomElement("bim-table",ws),Zt.defineCustomElement("bim-tabs",Ka),Zt.defineCustomElement("bim-tab",gs),Zt.defineCustomElement("bim-table-cell",nO),Zt.defineCustomElement("bim-table-children",rO),Zt.defineCustomElement("bim-table-group",aO),Zt.defineCustomElement("bim-table-row",Xa),Zt.defineCustomElement("bim-text-input",ur),Zt.defineCustomElement("bim-toolbar",Em),Zt.defineCustomElement("bim-toolbar-group",_m),Zt.defineCustomElement("bim-toolbar-section",Nc),Zt.defineCustomElement("bim-viewport",vO)}static newRandomId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="";for(let i=0;i<10;i++){let n=Math.floor(Math.random()*e.length);t+=e.charAt(n)}return t}};GP._config={sectionLabelOnVerticalToolbar:!1};var Iy=GP,Vi=class extends ei{constructor(){super(...arguments),this._lazyLoadObserver=null,this._visibleElements=[],this.ELEMENTS_BEFORE_OBSERVER=20,this.useObserver=!1,this.elements=new Set,this.observe=e=>{if(!this.useObserver)return;for(let i of e)this.elements.add(i);let t=e.slice(this.ELEMENTS_BEFORE_OBSERVER);for(let i of t)i.remove();this.observeLastElement()}}set visibleElements(e){this._visibleElements=this.useObserver?e:[],this.requestUpdate()}get visibleElements(){return this._visibleElements}getLazyObserver(){if(!this.useObserver)return null;if(this._lazyLoadObserver)return this._lazyLoadObserver;let e=new IntersectionObserver(t=>{let i=t[0];if(!i.isIntersecting)return;let n=i.target;e.unobserve(n);let r=this.ELEMENTS_BEFORE_OBSERVER+this.visibleElements.length,o=[...this.elements][r];o&&(this.visibleElements=[...this.visibleElements,o],e.observe(o))},{threshold:.5});return e}observeLastElement(){let e=this.getLazyObserver();if(!e)return;let t=this.ELEMENTS_BEFORE_OBSERVER+this.visibleElements.length-1,i=[...this.elements][t];i&&e.observe(i)}resetVisibleElements(){let e=this.getLazyObserver();if(e){for(let t of this.elements)e.unobserve(t);this.visibleElements=[],this.observeLastElement()}}static create(e,t){let i=document.createDocumentFragment();if(e.length===0)return Ec(e(),i),i.firstElementChild;if(!t)throw new Error("UIComponent: Initial state is required for statefull components.");let n=t,r=e,o=l=>(n=Se(Se({},n),l),Ec(r(n),i),n);o(t);let a=()=>n;return[i.firstElementChild,o,a]}},w5=Object.defineProperty,E5=Object.getOwnPropertyDescriptor,WP=(s,e,t,i)=>{for(var n=E5(e,t),r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&w5(e,t,n),n},Xi,Zy=(Xi=class extends ei{constructor(){super(...arguments),this._previousContainer=null,this._visible=!1}get placement(){return this._placement}set placement(s){this._placement=s,this.updatePosition()}static removeMenus(){for(let s of Xi.menus)s instanceof Xi&&(s.visible=!1);Xi.dialog.close(),Xi.dialog.remove()}get visible(){return this._visible}set visible(s){var e;this._visible=s,s?(Xi.dialog.parentElement||document.body.append(Xi.dialog),this._previousContainer=this.parentElement,Xi.dialog.style.top=`${window.scrollY||document.documentElement.scrollTop}px`,Xi.dialog.append(this),Xi.dialog.showModal(),this.updatePosition(),this.dispatchEvent(new Event("visible"))):((e=this._previousContainer)==null||e.append(this),this._previousContainer=null,this.dispatchEvent(new Event("hidden")))}updatePosition(){return ie(this,null,function*(){if(!(this.visible&&this._previousContainer))return;let s=this.placement??"right",e=yield hP(this._previousContainer,this,{placement:s,middleware:[ZT(10),cP(),lP(),aP({padding:5})]}),{x:t,y:i}=e;this.style.left=`${t}px`,this.style.top=`${i}px`})}connectedCallback(){super.connectedCallback(),Xi.menus.push(this)}render(){return Me` <slot></slot> `}},Xi.styles=[zo.scrollbar,oi`
      :host {
        pointer-events: auto;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 999;
        overflow: auto;
        max-height: 20rem;
        min-width: 3rem;
        flex-direction: column;
        box-shadow: 1px 2px 8px 2px rgba(0, 0, 0, 0.15);
        padding: 0.5rem;
        border-radius: var(--bim-ui_size-4xs);
        display: flex;
        background-color: var(
          --bim-context-menu--bgc,
          var(--bim-ui_bg-contrast-20)
        );
      }

      :host(:not([visible])) {
        display: none;
      }
    `],Xi.dialog=Vi.create(()=>Me` <dialog
      @click=${s=>{s.target===Xi.dialog&&Xi.removeMenus()}}
      @cancel=${()=>Xi.removeMenus()}
      data-context-dialog
      style="
      width: 0;
      height: 0;
      position: relative;
      padding: 0;
      border: none;
      outline: none;
      margin: none;
      overflow: visible;
      background-color: transparent;
    "
    ></dialog>`),Xi.menus=[],Xi);WP([ze({type:String,reflect:!0})],Zy.prototype,"placement");WP([ze({type:Boolean,reflect:!0})],Zy.prototype,"visible");var C5=Zy,sm=(s,e={},t=!0)=>{let i={};for(let n of s.children){let r=n,o=r.getAttribute("name")||r.getAttribute("label"),a=e[o];if(o){if("value"in r&&typeof r.value<"u"&&r.value!==null){let l=r.value;if(typeof l=="object"&&!Array.isArray(l)&&Object.keys(l).length===0)continue;i[o]=a?a(r.value):r.value}else if(t){let l=sm(r,e);if(Object.keys(l).length===0)continue;i[o]=a?a(l):l}}else t&&(i=Se(Se({},i),sm(r,e)))}return i},bm=s=>s==="true"||s==="false"?s==="true":s&&!isNaN(Number(s))&&s.trim()!==""?Number(s):s,x5=[">=","<=","=",">","<","?","/","#"];function IT(s){let e=x5.find(o=>s.split(o).length===2),t=s.split(e).map(o=>o.trim()),[i,n]=t,r=n.startsWith("'")&&n.endsWith("'")?n.replace(/'/g,""):bm(n);return{key:i,condition:e,value:r}}var Ty=s=>{try{let e=[],t=s.split(/&(?![^()]*\))/).map(i=>i.trim());for(let i of t){let n=!i.startsWith("(")&&!i.endsWith(")"),r=i.startsWith("(")&&i.endsWith(")");if(n){let o=IT(i);e.push(o)}if(r){let o={operator:"&",queries:i.replace(/^(\()|(\))$/g,"").split("&").map(a=>a.trim()).map((a,l)=>{let c=IT(a);return l>0&&(c.operator="&"),c})};e.push(o)}}return e}catch{return null}},TT=(s,e,t)=>{let i=!1;switch(e){case"=":i=s===t;break;case"?":i=String(s).includes(String(t));break;case"<":(typeof s=="number"||typeof t=="number")&&(i=s<t);break;case"<=":(typeof s=="number"||typeof t=="number")&&(i=s<=t);break;case">":(typeof s=="number"||typeof t=="number")&&(i=s>t);break;case">=":(typeof s=="number"||typeof t=="number")&&(i=s>=t);break;case"/":i=String(s).startsWith(String(t));break}return i},S5=Object.defineProperty,A5=Object.getOwnPropertyDescriptor,Vo=(s,e,t,i)=>{for(var n=i>1?void 0:i?A5(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&S5(e,t,n),n},YP=class extends ei{constructor(){super(...arguments),this.checked=!1,this.checkbox=!1,this.noMark=!1,this.vertical=!1}get value(){return this._value!==void 0?this._value:this.label?bm(this.label):this.label}set value(s){this._value=s}render(){return Me`
      <div class="parent" .title=${this.label??""}>
        ${this.img||this.icon||this.label?Me` <div style="display: flex; column-gap: 0.375rem">
              ${this.checkbox&&!this.noMark?Me`<bim-checkbox
                    style="pointer-events: none"
                    .checked=${this.checked}
                  ></bim-checkbox>`:null}
              <bim-label
                .vertical=${this.vertical}
                .icon=${this.icon}
                .img=${this.img}
                >${this.label}</bim-label
              >
            </div>`:null}
        ${!this.checkbox&&!this.noMark&&this.checked?Me`<svg
              xmlns="http://www.w3.org/2000/svg"
              height="1.125rem"
              viewBox="0 0 24 24"
              width="1.125rem"
              fill="#FFFFFF"
            >
              <path d="M0 0h24v24H0z" fill="none" />
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
            </svg>`:null}
        <slot></slot>
      </div>
    `}};YP.styles=oi`
    :host {
      --bim-label--c: var(--bim-ui_bg-contrast-100);
      display: block;
      box-sizing: border-box;
      flex: 1;
      padding: 0rem 0.5rem;
      border-radius: var(--bim-ui_size-4xs);
      transition: all 0.15s;
    }

    :host(:hover) {
      cursor: pointer;
      background-color: color-mix(
        in lab,
        var(--bim-selector--bgc, var(--bim-ui_bg-contrast-20)),
        var(--bim-ui_main-base) 10%
      );
    }

    :host([checked]) {
      --bim-label--c: color-mix(in lab, var(--bim-ui_main-base), white 30%);
    }

    :host([checked]) svg {
      fill: color-mix(in lab, var(--bim-ui_main-base), white 30%);
    }

    .parent {
      box-sizing: border-box;
      display: flex;
      justify-content: var(--bim-option--jc, space-between);
      column-gap: 0.5rem;
      align-items: center;
      min-height: 1.75rem;
      height: 100%;
    }

    input {
      height: 1rem;
      width: 1rem;
      cursor: pointer;
      border: none;
      outline: none;
      accent-color: var(--bim-checkbox--c, var(--bim-ui_main-base));
    }

    input:focus {
      outline: var(--bim-checkbox--olw, 2px) solid
        var(--bim-checkbox--olc, var(--bim-ui_accent-base));
    }

    bim-label {
      pointer-events: none;
    }
  `;var $i=YP;Vo([ze({type:String,reflect:!0})],$i.prototype,"img",2);Vo([ze({type:String,reflect:!0})],$i.prototype,"label",2);Vo([ze({type:String,reflect:!0})],$i.prototype,"icon",2);Vo([ze({type:Boolean,reflect:!0})],$i.prototype,"checked",2);Vo([ze({type:Boolean,reflect:!0})],$i.prototype,"checkbox",2);Vo([ze({type:Boolean,attribute:"no-mark",reflect:!0})],$i.prototype,"noMark",2);Vo([ze({converter:{fromAttribute(s){return s&&bm(s)}}})],$i.prototype,"value",1);Vo([ze({type:Boolean,reflect:!0})],$i.prototype,"vertical",2);var I5=Object.defineProperty,T5=Object.getOwnPropertyDescriptor,jo=(s,e,t,i)=>{for(var n=i>1?void 0:i?T5(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&I5(e,t,n),n},qP=class extends Vi{constructor(){super(),this.multiple=!1,this.required=!1,this.vertical=!1,this._visible=!1,this._value=new Set,this.onValueChange=new Event("change"),this._contextMenu=Cc(),this.onOptionClick=s=>{let e=s.target,t=this._value.has(e);if(!this.multiple&&!this.required&&!t)this._value=new Set([e]);else if(!this.multiple&&!this.required&&t)this._value=new Set([]);else if(!this.multiple&&this.required&&!t)this._value=new Set([e]);else if(this.multiple&&!this.required&&!t)this._value=new Set([...this._value,e]);else if(this.multiple&&!this.required&&t){let i=[...this._value].filter(n=>n!==e);this._value=new Set(i)}else if(this.multiple&&this.required&&!t)this._value=new Set([...this._value,e]);else if(this.multiple&&this.required&&t){let i=[...this._value].filter(r=>r!==e),n=new Set(i);n.size!==0&&(this._value=n)}this.updateOptionsState(),this.dispatchEvent(this.onValueChange)},this.useObserver=!0}set visible(s){if(s){let{value:e}=this._contextMenu;if(!e)return;for(let t of this.elements)e.append(t);this._visible=!0}else{for(let e of this.elements)this.append(e);this._visible=!1,this.resetVisibleElements()}}get visible(){return this._visible}set value(s){if(this.required&&Object.keys(s).length===0)return;let e=new Set;for(let t of s){let i=this.findOption(t);if(i&&(e.add(i),!this.multiple&&Object.keys(s).length===1))break}this._value=e,this.updateOptionsState(),this.dispatchEvent(this.onValueChange)}get value(){return[...this._value].filter(s=>s instanceof $i&&s.checked).map(s=>s.value)}get _options(){let s=new Set([...this.elements]);for(let e of this.children)e instanceof $i&&s.add(e);return[...s]}onSlotChange(s){let e=s.target.assignedElements();this.observe(e);let t=new Set;for(let i of this.elements){if(!(i instanceof $i)){i.remove();continue}i.checked&&t.add(i),i.removeEventListener("click",this.onOptionClick),i.addEventListener("click",this.onOptionClick)}this._value=t}updateOptionsState(){for(let s of this._options)s instanceof $i&&(s.checked=this._value.has(s))}findOption(s){return this._options.find(e=>e instanceof $i?e.label===s||e.value===s:!1)}render(){let s,e,t;if(this._value.size===0)s="Select an option...";else if(this._value.size===1){let i=[...this._value][0];s=i?.label||i?.value,e=i?.img,t=i?.icon}else s=`Multiple (${this._value.size})`;return Me`
      <bim-input
        title=${this.label??""}
        .label=${this.label}
        .icon=${this.icon}
        .vertical=${this.vertical}
      >
        <div class="input" @click=${()=>this.visible=!this.visible}>
          <bim-label
            .img=${e}
            .icon=${t}
            style="overflow: hidden;"
            >${s}</bim-label
          >
          <svg
            style="flex-shrink: 0; fill: var(--bim-dropdown--c, var(--bim-ui_bg-contrast-100))"
            xmlns="http://www.w3.org/2000/svg"
            height="1.125rem"
            viewBox="0 0 24 24"
            width="1.125rem"
            fill="#9ca3af"
          >
            <path d="M0 0h24v24H0V0z" fill="none" />
            <path d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z" />
          </svg>
          <bim-context-menu
            ${vs(this._contextMenu)}
            .visible=${this.visible}
            @hidden=${()=>{this.visible&&(this.visible=!1)}}
          >
            <slot @slotchange=${this.onSlotChange}></slot>
          </bim-context-menu>
        </div>
      </bim-input>
    `}};qP.styles=[zo.scrollbar,oi`
      :host {
        --bim-input--bgc: var(
          --bim-dropdown--bgc,
          var(--bim-ui_bg-contrast-20)
        );
        --bim-input--olw: 2px;
        --bim-input--olc: transparent;
        --bim-input--bdrs: var(--bim-ui_size-4xs);
        flex: 1;
        display: block;
      }

      :host([visible]) {
        --bim-input--olc: var(--bim-ui_accent-base);
      }

      .input {
        --bim-label--fz: var(--bim-drodown--fz, var(--bim-ui_size-xs));
        --bim-label--c: var(--bim-dropdown--c, var(--bim-ui_bg-contrast-100));
        height: 100%;
        display: flex;
        flex: 1;
        overflow: hidden;
        column-gap: 0.25rem;
        outline: none;
        cursor: pointer;
        align-items: center;
        justify-content: space-between;
        padding: 0 0.5rem;
      }

      bim-label {
        pointer-events: none;
      }
    `];var Ur=qP;jo([ze({type:String,reflect:!0})],Ur.prototype,"name",2);jo([ze({type:String,reflect:!0})],Ur.prototype,"icon",2);jo([ze({type:String,reflect:!0})],Ur.prototype,"label",2);jo([ze({type:Boolean,reflect:!0})],Ur.prototype,"multiple",2);jo([ze({type:Boolean,reflect:!0})],Ur.prototype,"required",2);jo([ze({type:Boolean,reflect:!0})],Ur.prototype,"vertical",2);jo([ze({type:Boolean,reflect:!0})],Ur.prototype,"visible",1);jo([Pc()],Ur.prototype,"_value",2);var P5=Object.defineProperty,XP=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&P5(e,t,n),n},KP=class extends ei{constructor(){super(...arguments),this.floating=!1,this.layouts={}}getUniqueAreasFromTemplate(s){let e=s.split(`
`).map(t=>t.trim()).map(t=>t.split('"')[1]).filter(t=>t!==void 0).flatMap(t=>t.split(/\s+/));return[...new Set(e)].filter(t=>t!=="")}firstUpdated(){this._onLayoutChange=new Event("layoutchange")}render(){if(this.layout){if(this.layouts[this.layout]){this.innerHTML="";let s=this.layouts[this.layout],e=this.getUniqueAreasFromTemplate(s.template).map(t=>{let i=s.elements[t];return i&&(i.style.gridArea=t),i}).filter(t=>!!t);this.style.gridTemplate=s.template,this._onLayoutChange&&this.dispatchEvent(this._onLayoutChange),this.append(...e)}}else this.innerHTML="",this.style.gridTemplate="",this._onLayoutChange&&this.dispatchEvent(this._onLayoutChange);return Me`<slot></slot>`}};KP.styles=oi`
    :host {
      display: grid;
      height: 100%;
      width: 100%;
      overflow: hidden;
      box-sizing: border-box;
    }

    /* :host(:not([layout])) {
      display: none;
    } */

    :host([floating]) {
      --bim-panel--bdrs: var(--bim-ui_size-4xs);
      background-color: transparent;
      padding: 1rem;
      gap: 1rem;
      position: absolute;
      pointer-events: none;
      top: 0px;
      left: 0px;
    }

    :host(:not([floating])) {
      --bim-panel--bdrs: 0;
      background-color: var(--bim-ui_bg-contrast-20);
      gap: 1px;
    }
  `;var Qy=KP;XP([ze({type:Boolean,reflect:!0})],Qy.prototype,"floating");XP([ze({type:String,reflect:!0})],Qy.prototype,"layout");var Py=class extends ei{render(){return Me`
      <iconify-icon .icon=${this.icon} height="none"></iconify-icon>
    `}};Py.styles=oi`
    :host {
      height: var(--bim-icon--fz, var(--bim-ui_size-sm));
      width: var(--bim-icon--fz, var(--bim-ui_size-sm));
    }

    iconify-icon {
      height: var(--bim-icon--fz, var(--bim-ui_size-sm));
      width: var(--bim-icon--fz, var(--bim-ui_size-sm));
      color: var(--bim-icon--c);
      transition: all 0.15s;
    }
  `,Py.properties={icon:{type:String}};var O5=Py,M5=Object.defineProperty,vm=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&M5(e,t,n),n},$P=class extends ei{constructor(){super(...arguments),this.vertical=!1,this.onValueChange=new Event("change")}get value(){let s={};for(let e of this.children){let t=e;"value"in t?s[t.name||t.label]=t.value:"checked"in t&&(s[t.name||t.label]=t.checked)}return s}set value(s){let e=[...this.children];for(let t in s){let i=e.find(o=>{let a=o;return a.name===t||a.label===t});if(!i)continue;let n=i,r=s[t];typeof r=="boolean"?n.checked=r:n.value=r}}render(){return Me`
      <div class="parent">
        ${this.label||this.icon?Me`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        <div class="input">
          <slot></slot>
        </div>
      </div>
    `}};$P.styles=oi`
    :host {
      flex: 1;
      display: block;
    }

    .parent {
      display: flex;
      flex-wrap: wrap;
      column-gap: 1rem;
      row-gap: 0.375rem;
      user-select: none;
      flex: 1;
    }

    :host(:not([vertical])) .parent {
      justify-content: space-between;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    .input {
      overflow: hidden;
      box-sizing: border-box;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      min-height: 1.75rem;
      min-width: 3rem;
      gap: var(--bim-input--g, var(--bim-ui_size-4xs));
      padding: var(--bim-input--p, 0);
      background-color: var(--bim-input--bgc, transparent);
      outline: var(--bim-input--olw, 2px) solid
        var(--bim-input--olc, transparent);
      border-radius: var(--bim-input--bdrs, var(--bim-ui_size-4xs));
      transition: all 0.15s;
    }

    :host(:not([vertical])) .input {
      flex: 1;
      justify-content: flex-end;
    }

    :host(:not([vertical])[label]) .input {
      max-width: fit-content;
    }
  `;var Yd=$P;vm([ze({type:String,reflect:!0})],Yd.prototype,"name");vm([ze({type:String,reflect:!0})],Yd.prototype,"label");vm([ze({type:String,reflect:!0})],Yd.prototype,"icon");vm([ze({type:Boolean,reflect:!0})],Yd.prototype,"vertical");var R5=Object.defineProperty,qd=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&R5(e,t,n),n},ZP=class extends ei{constructor(){super(...arguments),this.labelHidden=!1,this.iconHidden=!1,this.vertical=!1}get value(){return this.textContent?bm(this.textContent):this.textContent}render(){return Me`
      <div class="parent" .title=${this.textContent??""}>
        ${this.img?Me`<img .src=${this.img} .alt=${this.textContent||""} />`:null}
        ${!this.iconHidden&&this.icon?Me`<bim-icon .icon=${this.icon}></bim-icon>`:null}
        <p><slot></slot></p>
      </div>
    `}};ZP.styles=oi`
    :host {
      --bim-icon--c: var(--bim-label--c);
      color: var(--bim-label--c, var(--bim-ui_bg-contrast-60));
      font-size: var(--bim-label--fz, var(--bim-ui_size-xs));
      overflow: hidden;
      display: block;
      white-space: nowrap;
      line-height: 1.1rem;
      transition: all 0.15s;
    }

    .parent {
      display: flex;
      align-items: center;
      column-gap: 0.25rem;
      row-gap: 0.125rem;
      user-select: none;
      height: 100%;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    .parent p {
      margin: 0;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    :host([label-hidden]) .parent p,
    :host(:empty) .parent p {
      display: none;
    }

    img {
      height: 100%;
      aspect-ratio: 1;
      border-radius: 100%;
      margin-right: 0.125rem;
    }

    :host(:not([vertical])) img {
      max-height: var(
        --bim-label_icon--sz,
        calc(var(--bim-label--fz, var(--bim-ui_size-xs)) * 1.8)
      );
    }

    :host([vertical]) img {
      max-height: var(
        --bim-label_icon--sz,
        calc(var(--bim-label--fz, var(--bim-ui_size-xs)) * 4)
      );
    }
  `;var Rc=ZP;qd([ze({type:String,reflect:!0})],Rc.prototype,"img");qd([ze({type:Boolean,attribute:"label-hidden",reflect:!0})],Rc.prototype,"labelHidden");qd([ze({type:String,reflect:!0})],Rc.prototype,"icon");qd([ze({type:Boolean,attribute:"icon-hidden",reflect:!0})],Rc.prototype,"iconHidden");qd([ze({type:Boolean,reflect:!0})],Rc.prototype,"vertical");var D5=Object.defineProperty,L5=Object.getOwnPropertyDescriptor,_s=(s,e,t,i)=>{for(var n=i>1?void 0:i?L5(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&D5(e,t,n),n},QP=class extends ei{constructor(){super(...arguments),this._value=0,this.vertical=!1,this.slider=!1,this._input=Cc(),this.onValueChange=new Event("change")}set value(s){this.setValue(s.toString())}get value(){return this._value}onChange(s){s.stopPropagation();let{value:e}=this._input;e&&this.setValue(e.value)}setValue(s){let{value:e}=this._input,t=s;if(t=t.replace(/[^0-9.-]/g,""),t=t.replace(/(\..*)\./g,"$1"),t.endsWith(".")||(t.lastIndexOf("-")>0&&(t=t[0]+t.substring(1).replace(/-/g,"")),t==="-"||t==="-0"))return;let i=Number(t);Number.isNaN(i)||(i=this.min!==void 0?Math.max(i,this.min):i,i=this.max!==void 0?Math.min(i,this.max):i,this.value!==i&&(this._value=i,e&&(e.value=this.value.toString()),this.requestUpdate(),this.dispatchEvent(this.onValueChange)))}onBlur(){let{value:s}=this._input;s&&Number.isNaN(Number(s.value))&&(s.value=this.value.toString())}onSliderMouseDown(s){document.body.style.cursor="w-resize";let{clientX:e}=s,t=this.value,i=!1,n=a=>{var l;i=!0;let{clientX:c}=a,d=this.step??1,h=((l=d.toString().split(".")[1])==null?void 0:l.length)||0,u=1/(this.sensitivity??1),p=(c-e)/u;if(Math.floor(Math.abs(p))!==Math.abs(p))return;let f=t+p*d;this.setValue(f.toFixed(h))},r=()=>{this.slider=!0,this.removeEventListener("blur",r)},o=()=>{document.removeEventListener("mousemove",n),document.body.style.cursor="default",i?i=!1:(this.addEventListener("blur",r),this.slider=!1,requestAnimationFrame(()=>this.focus())),document.removeEventListener("mouseup",o)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",o)}onFocus(s){s.stopPropagation();let e=t=>{t.key==="Escape"&&(this.blur(),window.removeEventListener("keydown",e))};window.addEventListener("keydown",e)}connectedCallback(){super.connectedCallback(),this.min&&this.min>this.value&&(this._value=this.min),this.max&&this.max<this.value&&(this._value=this.max)}focus(){let{value:s}=this._input;s&&s.focus()}render(){let s=Me`
      ${this.pref||this.icon?Me`<bim-label
            style="pointer-events: auto"
            @mousedown=${this.onSliderMouseDown}
            .icon=${this.icon}
            >${this.pref}</bim-label
          >`:null}
      <input
        ${vs(this._input)}
        type="text"
        aria-label=${this.label||this.name||"Number Input"}
        size="1"
        @input=${o=>o.stopPropagation()}
        @change=${this.onChange}
        @blur=${this.onBlur}
        @focus=${this.onFocus}
        .value=${this.value.toString()}
      />
      ${this.suffix?Me`<bim-label
            style="pointer-events: auto"
            @mousedown=${this.onSliderMouseDown}
            >${this.suffix}</bim-label
          >`:null}
    `,e=this.min??-1/0,t=this.max??1/0,i=100*(this.value-e)/(t-e),n=Me`
      <style>
        .slider-indicator {
          width: ${`${i}%`};
        }
      </style>
      <div class="slider" @mousedown=${this.onSliderMouseDown}>
        <div class="slider-indicator"></div>
        ${this.pref||this.icon?Me`<bim-label
              style="z-index: 1; margin-right: 0.125rem"
              .icon=${this.icon}
              >${`${this.pref}: `}</bim-label
            >`:null}
        <bim-label style="z-index: 1;">${this.value}</bim-label>
        ${this.suffix?Me`<bim-label style="z-index: 1;">${this.suffix}</bim-label>`:null}
      </div>
    `,r=`${this.label||this.name||this.pref?`${this.label||this.name||this.pref}: `:""}${this.value}${this.suffix??""}`;return Me`
      <bim-input
        title=${r}
        .label=${this.label}
        .icon=${this.icon}
        .vertical=${this.vertical}
      >
        ${this.slider?n:s}
      </bim-input>
    `}};QP.styles=oi`
    :host {
      --bim-input--bgc: var(
        --bim-number-input--bgc,
        var(--bim-ui_bg-contrast-20)
      );
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(--bim-number-input--olc, transparent);
      --bim-input--bdrs: var(--bim-number-input--bdrs, var(--bim-ui_size-4xs));
      --bim-input--p: 0 0.375rem;
      flex: 1;
      display: block;
    }

    :host(:focus) {
      --bim-input--olw: var(--bim-number-input--olw, 2px);
      --bim-input--olc: var(
        --bim-number-input¡focus--c,
        var(--bim-ui_accent-base)
      );
    }

    :host(:not([slider])) bim-label {
      --bim-label--c: var(
        --bim-number-input_affixes--c,
        var(--bim-ui_bg-contrast-60)
      );
      --bim-label--fz: var(
        --bim-number-input_affixes--fz,
        var(--bim-ui_size-xs)
      );
    }

    p {
      margin: 0;
      padding: 0;
    }

    input {
      background-color: transparent;
      outline: none;
      border: none;
      padding: 0;
      flex-grow: 1;
      text-align: right;
      font-family: inherit;
      font-feature-settings: inherit;
      font-variation-settings: inherit;
      font-size: var(--bim-number-input--fz, var(--bim-ui_size-xs));
      color: var(--bim-number-input--c, var(--bim-ui_bg-contrast-100));
    }

    :host([suffix]:not([pref])) input {
      text-align: left;
    }

    :host([slider]) {
      --bim-input--p: 0;
    }

    :host([slider]) .slider {
      --bim-label--c: var(--bim-ui_bg-contrast-100);
    }

    .slider {
      position: relative;
      display: flex;
      justify-content: center;
      width: 100%;
      height: 100%;
      padding: 0 0.5rem;
    }

    .slider-indicator {
      height: 100%;
      background-color: var(--bim-ui_main-base);
      position: absolute;
      top: 0;
      left: 0;
      border-radius: var(--bim-input--bdrs, var(--bim-ui_size-4xs));
    }

    bim-input {
      display: flex;
    }

    bim-label {
      pointer-events: none;
    }
  `;var Gn=QP;_s([ze({type:String,reflect:!0})],Gn.prototype,"name",2);_s([ze({type:String,reflect:!0})],Gn.prototype,"icon",2);_s([ze({type:String,reflect:!0})],Gn.prototype,"label",2);_s([ze({type:String,reflect:!0})],Gn.prototype,"pref",2);_s([ze({type:Number,reflect:!0})],Gn.prototype,"min",2);_s([ze({type:Number,reflect:!0})],Gn.prototype,"value",1);_s([ze({type:Number,reflect:!0})],Gn.prototype,"step",2);_s([ze({type:Number,reflect:!0})],Gn.prototype,"sensitivity",2);_s([ze({type:Number,reflect:!0})],Gn.prototype,"max",2);_s([ze({type:String,reflect:!0})],Gn.prototype,"suffix",2);_s([ze({type:Boolean,reflect:!0})],Gn.prototype,"vertical",2);_s([ze({type:Boolean,reflect:!0})],Gn.prototype,"slider",2);var F5=Object.defineProperty,k5=Object.getOwnPropertyDescriptor,Xd=(s,e,t,i)=>{for(var n=i>1?void 0:i?k5(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&F5(e,t,n),n},JP=class extends ei{constructor(){super(...arguments),this.onValueChange=new Event("change"),this._hidden=!1,this.headerHidden=!1,this.valueTransform={},this.activationButton=document.createElement("bim-button")}set hidden(s){this._hidden=s,this.activationButton.active=!s,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}get value(){return sm(this,this.valueTransform)}set value(s){let e=[...this.children];for(let t in s){let i=e.find(r=>{let o=r;return o.name===t||o.label===t});if(!i)continue;let n=i;n.value=s[t]}}connectedCallback(){super.connectedCallback(),this.activationButton.active=!this.hidden,this.activationButton.onclick=()=>this.hidden=!this.hidden}disconnectedCallback(){super.disconnectedCallback(),this.activationButton.remove()}collapseSections(){let s=this.querySelectorAll("bim-panel-section");for(let e of s)e.collapsed=!0}expandSections(){let s=this.querySelectorAll("bim-panel-section");for(let e of s)e.collapsed=!1}render(){return this.activationButton.icon=this.icon,this.activationButton.label=this.label||this.name,this.activationButton.tooltipTitle=this.label||this.name,Me`
      <div class="parent">
        ${this.label||this.name||this.icon?Me`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        <div class="sections">
          <slot></slot>
        </div>
      </div>
    `}};JP.styles=[zo.scrollbar,oi`
      :host {
        display: flex;
        border-radius: var(--bim-ui_size-base);
        background-color: var(--bim-ui_bg-base);
        overflow: auto;
      }

      :host([hidden]) {
        display: none;
      }

      .parent {
        display: flex;
        flex: 1;
        flex-direction: column;
        pointer-events: auto;
        overflow: auto;
      }

      .parent bim-label {
        --bim-label--c: var(--bim-panel--c, var(--bim-ui_bg-contrast-80));
        --bim-label--fz: var(--bim-panel--fz, var(--bim-ui_size-sm));
        font-weight: 600;
        padding: 1rem;
        flex-shrink: 0;
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([header-hidden]) .parent bim-label {
        display: none;
      }

      .sections {
        display: flex;
        flex-direction: column;
        overflow: auto;
      }

      ::slotted(bim-panel-section:not(:last-child)) {
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }
    `];var qa=JP;Xd([ze({type:String,reflect:!0})],qa.prototype,"icon",2);Xd([ze({type:String,reflect:!0})],qa.prototype,"name",2);Xd([ze({type:String,reflect:!0})],qa.prototype,"label",2);Xd([ze({type:Boolean,reflect:!0})],qa.prototype,"hidden",1);Xd([ze({type:Boolean,attribute:"header-hidden",reflect:!0})],qa.prototype,"headerHidden",2);var N5=Object.defineProperty,Kd=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&N5(e,t,n),n},eO=class extends ei{constructor(){super(...arguments),this.onValueChange=new Event("change"),this.valueTransform={}}get value(){let s=this.parentElement,e;return s instanceof qa&&(e=s.valueTransform),Object.values(this.valueTransform).length!==0&&(e=this.valueTransform),sm(this,e)}set value(s){let e=[...this.children];for(let t in s){let i=e.find(r=>{let o=r;return o.name===t||o.label===t});if(!i)continue;let n=i;n.value=s[t]}}onHeaderClick(){this.fixed||(this.collapsed=!this.collapsed)}render(){let s=this.label||this.icon||this.name||this.fixed,e=Me`<svg
      xmlns="http://www.w3.org/2000/svg"
      height="1.125rem"
      viewBox="0 0 24 24"
      width="1.125rem"
    >
      <path d="M0 0h24v24H0V0z" fill="none" />
      <path d="M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z" />
    </svg>`,t=Me`<svg
      xmlns="http://www.w3.org/2000/svg"
      height="1.125rem"
      viewBox="0 0 24 24"
      width="1.125rem"
    >
      <path d="M0 0h24v24H0z" fill="none" />
      <path d="M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z" />
    </svg>`,i=this.collapsed?e:t,n=Me`
      <div
        class="header"
        title=${this.label??""}
        @click=${this.onHeaderClick}
      >
        ${this.label||this.icon||this.name?Me`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
        ${this.fixed?null:i}
      </div>
    `;return Me`
      <div class="parent">
        ${s?n:null}
        <div class="components">
          <slot></slot>
        </div>
      </div>
    `}};eO.styles=[zo.scrollbar,oi`
      :host {
        display: block;
        pointer-events: auto;
      }

      :host(:not([fixed])) .header:hover {
        --bim-label--c: var(--bim-ui_accent-base);
        color: var(--bim-ui_accent-base);
        cursor: pointer;
      }

      :host(:not([fixed])) .header:hover svg {
        fill: var(--bim-ui_accent-base);
      }

      .header {
        --bim-label--fz: var(--bim-ui_size-sm);
        --bim-label--c: var(--bim-ui_bg-contrast-80);
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 600;
        height: 1.5rem;
        padding: 0.75rem 1rem;
      }

      .header svg {
        fill: var(--bim-ui_bg-contrast-80);
      }

      .title {
        display: flex;
        align-items: center;
        column-gap: 0.5rem;
      }

      .title p {
        font-size: var(--bim-ui_size-sm);
      }

      .components {
        display: flex;
        flex-direction: column;
        row-gap: 0.75rem;
        padding: 0.125rem 1rem 1rem;
      }

      :host(:not([fixed])[collapsed]) .components {
        display: none;
        height: 0px;
      }

      bim-label {
        pointer-events: none;
      }
    `];var Dc=eO;Kd([ze({type:String,reflect:!0})],Dc.prototype,"icon");Kd([ze({type:String,reflect:!0})],Dc.prototype,"label");Kd([ze({type:String,reflect:!0})],Dc.prototype,"name");Kd([ze({type:Boolean,reflect:!0})],Dc.prototype,"fixed");Kd([ze({type:Boolean,reflect:!0})],Dc.prototype,"collapsed");var U5=Object.defineProperty,$d=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&U5(e,t,n),n},tO=class extends ei{constructor(){super(...arguments),this.vertical=!1,this.onValueChange=new Event("change"),this._canEmitEvents=!1,this._value=document.createElement("bim-option"),this.onOptionClick=s=>{this._value=s.target,this.dispatchEvent(this.onValueChange);for(let e of this.children)e instanceof $i&&(e.checked=e===s.target)}}get _options(){return[...this.querySelectorAll("bim-option")]}set value(s){let e=this.findOption(s);if(e){for(let t of this._options)t.checked=t===e;this._value=e,this._canEmitEvents&&this.dispatchEvent(this.onValueChange)}}get value(){return this._value.value}onSlotChange(s){let e=s.target.assignedElements();for(let t of e)t instanceof $i&&(t.noMark=!0,t.removeEventListener("click",this.onOptionClick),t.addEventListener("click",this.onOptionClick))}findOption(s){return this._options.find(e=>e instanceof $i?e.label===s||e.value===s:!1)}firstUpdated(){let s=[...this.children].find(e=>e instanceof $i&&e.checked);s&&(this._value=s)}render(){return Me`
      <bim-input
        .vertical=${this.vertical}
        .label=${this.label}
        .icon=${this.icon}
      >
        <slot @slotchange=${this.onSlotChange}></slot>
      </bim-input>
    `}};tO.styles=oi`
    :host {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
      --bim-input--g: 0;
      --bim-option--jc: center;
      flex: 1;
      display: block;
    }

    ::slotted(bim-option) {
      border-radius: 0;
    }

    ::slotted(bim-option[checked]) {
      --bim-label--c: var(--bim-ui_main-contrast);
      background-color: var(--bim-ui_main-base);
    }
  `;var Lc=tO;$d([ze({type:String,reflect:!0})],Lc.prototype,"name");$d([ze({type:String,reflect:!0})],Lc.prototype,"icon");$d([ze({type:String,reflect:!0})],Lc.prototype,"label");$d([ze({type:Boolean,reflect:!0})],Lc.prototype,"vertical");$d([Pc()],Lc.prototype,"_value");var B5=()=>Me`
    <style>
      div {
        display: flex;
        gap: 0.375rem;
        border-radius: 0.25rem;
        min-height: 1.25rem;
      }

      [data-type="row"] {
        background-color: var(--bim-ui_bg-contrast-10);
        animation: row-loading 1s linear infinite alternate;
        padding: 0.5rem;
      }

      [data-type="cell"] {
        background-color: var(--bim-ui_bg-contrast-20);
        flex: 0.25;
      }

      @keyframes row-loading {
        0% {
          background-color: var(--bim-ui_bg-contrast-10);
        }
        100% {
          background-color: var(--bim-ui_bg-contrast-20);
        }
      }
    </style>
    <div style="display: flex; flex-direction: column;">
      <div data-type="row" style="gap: 2rem">
        <div data-type="cell" style="flex: 1"></div>
        <div data-type="cell" style="flex: 2"></div>
        <div data-type="cell" style="flex: 1"></div>
        <div data-type="cell" style="flex: 0.5"></div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
      </div>
      <div style="display: flex;">
        <div data-type="row" style="flex: 1">
          <div data-type="cell"></div>
        </div>
        <div data-type="row" style="flex: 2">
          <div data-type="cell" style="flex: 0.5"></div>
        </div>
        <div data-type="row" style="flex: 1">
          <div data-type="cell" style="flex: 0.75"></div>
        </div>
        <div data-type="row" style="flex: 0.5">
          <div data-type="cell" style="flex: 0.7s5"></div>
        </div>
      </div>
    </div>
  `,z5=()=>Me`
    <style>
      .loader {
        grid-area: Processing;
        position: relative;
        padding: 0.125rem;
      }
      .loader:before {
        content: "";
        position: absolute;
      }
      .loader .loaderBar {
        position: absolute;
        top: 0;
        right: 100%;
        bottom: 0;
        left: 0;
        background: var(--bim-ui_main-base);
        /* width: 25%; */
        width: 0;
        animation: borealisBar 2s linear infinite;
      }

      @keyframes borealisBar {
        0% {
          left: 0%;
          right: 100%;
          width: 0%;
        }
        10% {
          left: 0%;
          right: 75%;
          width: 25%;
        }
        90% {
          right: 0%;
          left: 75%;
          width: 25%;
        }
        100% {
          left: 100%;
          right: 0%;
          width: 0%;
        }
      }
    </style>
    <div class="loader">
      <div class="loaderBar"></div>
    </div>
  `,V5=Object.defineProperty,j5=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&V5(e,t,n),n},iO=class extends ei{constructor(){super(...arguments),this.column="",this.columnIndex=0,this.rowData={}}get data(){return this.column?this.rowData[this.column]:null}render(){return Me`
      <style>
        :host {
          grid-area: ${this.column??"unset"};
        }
      </style>
      <slot></slot>
    `}};iO.styles=oi`
    :host {
      padding: 0.375rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    :host([data-column-index="0"]:not([data-no-indentation])) {
      justify-content: normal;
    }

    :host([data-column-index="0"]:not([data-cell-header]))
      ::slotted(bim-label) {
      text-align: left;
    }

    ::slotted(*) {
      --bim-input--bgc: transparent;
      --bim-input--olc: var(--bim-ui_bg-contrast-20);
      --bim-input--olw: 1px;
    }

    ::slotted(bim-input) {
      --bim-input--olw: 0;
    }

    ::slotted(bim-label) {
      white-space: normal;
      text-align: center;
    }
  `;var nO=iO;j5([ze({type:String,reflect:!0})],nO.prototype,"column");var H5=Object.defineProperty,G5=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&H5(e,t,n),n},sO=class extends ei{constructor(){super(...arguments),this._groups=[],this.data=[],this.table=this.closest("bim-table")}toggleGroups(s,e=!1){for(let t of this._groups)t.childrenHidden=typeof s>"u"?!t.childrenHidden:!s,e&&t.toggleChildren(s,e)}render(){return this._groups=[],Me`
      <slot></slot>
      ${this.data.map(s=>{let e=document.createElement("bim-table-group");return this._groups.push(e),e.table=this.table,e.data=s,e})}
    `}};sO.styles=oi`
    :host {
      --bim-button--bgc: transparent;
      position: relative;
      grid-area: Children;
    }

    :host([hidden]) {
      display: none;
    }

    ::slotted(.branch.branch-vertical) {
      top: 0;
      bottom: 1.125rem;
    }
  `;var rO=sO;G5([ze({type:Array,attribute:!1})],rO.prototype,"data");var W5=Object.defineProperty,Y5=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&W5(e,t,n),n},oO=class extends ei{constructor(){super(...arguments),this.data={data:{}},this.childrenHidden=!0,this.table=this.closest("bim-table")}connectedCallback(){super.connectedCallback(),this.table&&this.table.expanded?this.childrenHidden=!1:this.childrenHidden=!0}toggleChildren(s,e=!1){this._children&&(this.childrenHidden=typeof s>"u"?!this.childrenHidden:!s,e&&this._children.toggleGroups(s,e))}render(){if(!this.table)throw new Error("TableGroup: parent table wasn't found!");let s=this.table.getGroupIndentation(this.data)??0,e=Me`
      ${this.table.noIndentation?null:Me`
            <style>
              .branch-vertical {
                left: ${s+(this.table.selectableRows?1.9375:.5625)}rem;
              }
            </style>
            <div class="branch branch-vertical"></div>
          `}
    `,t=document.createDocumentFragment();Ec(e,t);let i=null;this.table.noIndentation||(i=document.createElement("div"),i.classList.add("branch","branch-horizontal"),i.style.left=`${s-1+(this.table.selectableRows?2.05:.5625)}rem`);let n=null;if(!this.table.noIndentation){let a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("height","9.5"),a.setAttribute("width","7.5"),a.setAttribute("viewBox","0 0 4.6666672 7.3333333");let l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d","m 1.7470835,6.9583848 2.5899999,-2.59 c 0.39,-0.39 0.39,-1.02 0,-1.41 L 1.7470835,0.36838483 c -0.63,-0.62000003 -1.71000005,-0.18 -1.71000005,0.70999997 v 5.17 c 0,0.9 1.08000005,1.34 1.71000005,0.71 z"),a.append(l);let c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.setAttribute("height","6.5"),c.setAttribute("width","9.5"),c.setAttribute("viewBox","0 0 5.9111118 5.0175439");let d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d","M -0.33616196,1.922522 2.253838,4.5125219 c 0.39,0.39 1.02,0.39 1.41,0 L 6.2538379,1.922522 c 0.6200001,-0.63 0.18,-1.71000007 -0.7099999,-1.71000007 H 0.37383804 c -0.89999997,0 -1.33999997,1.08000007 -0.71,1.71000007 z"),c.append(d),n=document.createElement("div"),n.addEventListener("click",h=>{h.stopPropagation(),this.toggleChildren()}),n.classList.add("caret"),n.style.left=`${(this.table.selectableRows?1.5:.125)+s}rem`,this.childrenHidden?n.append(a):n.append(c)}let r=document.createElement("bim-table-row");this.data.children&&!this.childrenHidden&&r.append(t),r.table=this.table,r.data=this.data.data,this.table.dispatchEvent(new CustomEvent("rowcreated",{detail:{row:r}})),n&&this.data.children&&r.append(n),s!==0&&(!this.data.children||this.childrenHidden)&&i&&r.append(i);let o;if(this.data.children){o=document.createElement("bim-table-children"),this._children=o,o.table=this.table,o.data=this.data.children;let a=document.createDocumentFragment();Ec(e,a),o.append(a)}return Me`
      <div class="parent">${r} ${this.childrenHidden?null:o}</div>
    `}};oO.styles=oi`
    :host {
      position: relative;
    }

    .parent {
      display: grid;
      grid-template-areas: "Data" "Children";
    }

    .branch {
      position: absolute;
      z-index: 1;
    }

    .branch-vertical {
      border-left: 1px dotted var(--bim-ui_bg-contrast-40);
    }

    .branch-horizontal {
      top: 50%;
      width: 1rem;
      border-bottom: 1px dotted var(--bim-ui_bg-contrast-40);
    }

    .caret {
      position: absolute;
      z-index: 2;
      transform: translateY(-50%) rotate(0deg);
      top: 50%;
      display: flex;
      width: 0.95rem;
      height: 0.95rem;
      justify-content: center;
      align-items: center;
      cursor: pointer;
    }

    .caret svg {
      fill: var(--bim-ui_bg-contrast-60);
    }
  `;var aO=oO;Y5([ze({type:Boolean,attribute:"children-hidden",reflect:!0})],aO.prototype,"childrenHidden");var q5=Object.defineProperty,Fc=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&q5(e,t,n),n},lO=class extends ei{constructor(){super(...arguments),this.selected=!1,this.columns=[],this.hiddenColumns=[],this.data={},this.isHeader=!1,this.table=this.closest("bim-table"),this.onTableColumnsChange=()=>{this.table&&(this.columns=this.table.columns)},this.onTableColumnsHidden=()=>{this.table&&(this.hiddenColumns=this.table.hiddenColumns)},this._observer=new IntersectionObserver(s=>{this._intersecting=s[0].isIntersecting},{rootMargin:"36px"})}get _columnNames(){return this.columns.filter(s=>!this.hiddenColumns.includes(s.name)).map(s=>s.name)}get _columnWidths(){return this.columns.filter(s=>!this.hiddenColumns.includes(s.name)).map(s=>s.width)}get _isSelected(){var s;return(s=this.table)==null?void 0:s.selection.has(this.data)}onSelectionChange(s){if(!this.table)return;let e=s.target;this.selected=e.value,e.value?(this.table.selection.add(this.data),this.table.dispatchEvent(new CustomEvent("rowselected",{detail:{data:this.data}}))):(this.table.selection.delete(this.data),this.table.dispatchEvent(new CustomEvent("rowdeselected",{detail:{data:this.data}})))}connectedCallback(){super.connectedCallback(),this._observer.observe(this),this.table&&(this.columns=this.table.columns,this.hiddenColumns=this.table.hiddenColumns,this.table.addEventListener("columnschange",this.onTableColumnsChange),this.table.addEventListener("columnshidden",this.onTableColumnsHidden),this.toggleAttribute("selected",this._isSelected))}disconnectedCallback(){super.disconnectedCallback(),this._observer.unobserve(this),this.table&&(this.columns=[],this.hiddenColumns=[],this.table.removeEventListener("columnschange",this.onTableColumnsChange),this.table.removeEventListener("columnshidden",this.onTableColumnsHidden),this.toggleAttribute("selected",!1))}compute(){if(!this.table)throw new Error("TableRow: parent table wasn't found!");let s=this.table.getRowIndentation(this.data)??0,e=this.isHeader?this.data:this.table.applyDataTransform(this.data)??this.data,t=[];for(let i in e){if(this.hiddenColumns.includes(i))continue;let n=e[i],r;if(typeof n=="string"||typeof n=="boolean"||typeof n=="number"?(r=document.createElement("bim-label"),r.textContent=String(n)):n instanceof HTMLElement?r=n:(r=document.createDocumentFragment(),Ec(n,r)),!r)continue;let o=document.createElement("bim-table-cell");o.append(r),o.column=i,this._columnNames.indexOf(i)===0&&!this.isHeader&&(o.style.marginLeft=`${(this.table.noIndentation?0:s)+.75}rem`);let a=this._columnNames.indexOf(i);o.setAttribute("data-column-index",String(a)),o.toggleAttribute("data-no-indentation",a===0&&this.table.noIndentation),o.toggleAttribute("data-cell-header",this.isHeader),o.rowData=this.data,this.table.dispatchEvent(new CustomEvent("cellcreated",{detail:{cell:o}})),t.push(o)}return this.style.gridTemplateAreas=`"${this.table.selectableRows?"Selection":""} ${this._columnNames.join(" ")}"`,this.style.gridTemplateColumns=`${this.table.selectableRows?"1.6rem":""} ${this._columnWidths.join(" ")}`,Me`
      ${!this.isHeader&&this.table.selectableRows?Me`<bim-checkbox
            @change=${this.onSelectionChange}
            .checked=${this._isSelected}
            style="align-self: center; justify-self: center"
          ></bim-checkbox>`:null}
      ${t}
      <slot></slot>
    `}render(){return Me`${this._intersecting?this.compute():Me``}`}};lO.styles=oi`
    :host {
      position: relative;
      grid-area: Data;
      display: grid;
      min-height: 2.25rem;
      transition: all 0.15s;
    }

    ::slotted(.branch.branch-vertical) {
      top: 50%;
      bottom: 0;
    }

    :host([selected]) {
      background-color: color-mix(
        in lab,
        var(--bim-ui_bg-contrast-20) 30%,
        var(--bim-ui_main-base) 10%
      );
    }
  `;var Xa=lO;Fc([ze({type:Boolean,reflect:!0})],Xa.prototype,"selected");Fc([ze({attribute:!1})],Xa.prototype,"columns");Fc([ze({attribute:!1})],Xa.prototype,"hiddenColumns");Fc([ze({attribute:!1})],Xa.prototype,"data");Fc([ze({type:Boolean,attribute:"is-header",reflect:!0})],Xa.prototype,"isHeader");Fc([Pc()],Xa.prototype,"_intersecting");var X5=Object.defineProperty,K5=Object.getOwnPropertyDescriptor,Ns=(s,e,t,i)=>{for(var n=i>1?void 0:i?K5(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&X5(e,t,n),n},cO=class extends ei{constructor(){super(...arguments),this._columnsChange=new Event("columnschange"),this._filteredData=[],this.headersHidden=!1,this.minColWidth="4rem",this._columns=[],this._textDelimiters={comma:",",tab:"	"},this._queryString=null,this._data=[],this.expanded=!1,this.preserveStructureOnFilter=!1,this.indentationInText=!1,this.dataTransform={},this.selectableRows=!1,this.selection=new Set,this.noIndentation=!1,this.loading=!1,this._errorLoading=!1,this._onColumnsHidden=new Event("columnshidden"),this._hiddenColumns=[],this.loadingErrorElement=null,this._stringFilterFunction=(s,e)=>Object.values(e.data).some(t=>String(t).toLowerCase().includes(s.toLowerCase())),this._queryFilterFunction=(s,e)=>{let t=!1,i=Ty(s)??[];for(let n of i){if("queries"in n){t=!1;break}let{condition:r,value:o}=n,{key:a}=n;if(a.startsWith("[")&&a.endsWith("]")){let l=a.replace("[","").replace("]","");a=l,t=Object.keys(e.data).filter(c=>c.includes(l)).map(c=>TT(e.data[c],r,o)).some(c=>c)}else t=TT(e.data[a],r,o);if(!t)break}return t}}set columns(s){let e=[];for(let t of s){let i=typeof t=="string"?{name:t,width:`minmax(${this.minColWidth}, 1fr)`}:t;e.push(i)}this._columns=e,this.computeMissingColumns(this.data),this.dispatchEvent(this._columnsChange)}get columns(){return this._columns}get _headerRowData(){let s={};for(let e of this.columns)if(typeof e=="string")s[e]=e;else{let{name:t}=e;s[t]=t}return s}get value(){return this._filteredData}set queryString(s){this.toggleAttribute("data-processing",!0),this._queryString=s&&s.trim()!==""?s.trim():null,this.updateFilteredData(),this.toggleAttribute("data-processing",!1)}get queryString(){return this._queryString}set data(s){this._data=s,this.updateFilteredData(),this.computeMissingColumns(s)&&(this.columns=this._columns)}get data(){return this._data}get dataAsync(){return new Promise(s=>{setTimeout(()=>{s(this.data)})})}set hiddenColumns(s){this._hiddenColumns=s,setTimeout(()=>{this.dispatchEvent(this._onColumnsHidden)})}get hiddenColumns(){return this._hiddenColumns}updateFilteredData(){this.queryString?(Ty(this.queryString)?(this.filterFunction=this._queryFilterFunction,this._filteredData=this.filter(this.queryString)):(this.filterFunction=this._stringFilterFunction,this._filteredData=this.filter(this.queryString)),this.preserveStructureOnFilter&&(this._expandedBeforeFilter===void 0&&(this._expandedBeforeFilter=this.expanded),this.expanded=!0)):(this.preserveStructureOnFilter&&this._expandedBeforeFilter!==void 0&&(this.expanded=this._expandedBeforeFilter,this._expandedBeforeFilter=void 0),this._filteredData=this.data)}computeMissingColumns(s){let e=!1;for(let t of s){let{children:i,data:n}=t;for(let r in n)this._columns.map(o=>typeof o=="string"?o:o.name).includes(r)||(this._columns.push({name:r,width:`minmax(${this.minColWidth}, 1fr)`}),e=!0);if(i){let r=this.computeMissingColumns(i);r&&!e&&(e=r)}}return e}generateText(s="comma",e=this.value,t="",i=!0){let n=this._textDelimiters[s],r="",o=this.columns.map(a=>a.name);if(i){this.indentationInText&&(r+=`Indentation${n}`);let a=`${o.join(n)}
`;r+=a}for(let[a,l]of e.entries()){let{data:c,children:d}=l,h=this.indentationInText?`${t}${a+1}${n}`:"",u=o.map(f=>c[f]??""),p=`${h}${u.join(n)}
`;r+=p,d&&(r+=this.generateText(s,l.children,`${t}${a+1}.`,!1))}return r}get csv(){return this.generateText("comma")}get tsv(){return this.generateText("tab")}applyDataTransform(s){let e={};for(let t of Object.keys(this.dataTransform)){let i=this.columns.find(n=>n.name===t);i&&i.forceDataTransform&&(t in s||(s[t]=""))}for(let t in s){let i=this.dataTransform[t];i?e[t]=i(s[t],s):e[t]=s[t]}return e}downloadData(s="BIM Table Data",e="json"){let t=null;if(e==="json"&&(t=new File([JSON.stringify(this.value,void 0,2)],`${s}.json`)),e==="csv"&&(t=new File([this.csv],`${s}.csv`)),e==="tsv"&&(t=new File([this.tsv],`${s}.tsv`)),!t)return;let i=document.createElement("a");i.href=URL.createObjectURL(t),i.download=t.name,i.click(),URL.revokeObjectURL(i.href)}getRowIndentation(s,e=this.value,t=0){for(let i of e){if(i.data===s)return t;if(i.children){let n=this.getRowIndentation(s,i.children,t+1);if(n!==null)return n}}return null}getGroupIndentation(s,e=this.value,t=0){for(let i of e){if(i===s)return t;if(i.children){let n=this.getGroupIndentation(s,i.children,t+1);if(n!==null)return n}}return null}connectedCallback(){super.connectedCallback(),this.dispatchEvent(new Event("connected"))}disconnectedCallback(){super.disconnectedCallback(),this.dispatchEvent(new Event("disconnected"))}loadData(s=!1){return ie(this,null,function*(){if(this._filteredData.length!==0&&!s||!this.loadFunction)return!1;this.loading=!0;try{let e=yield this.loadFunction();return this.data=e,this.loading=!1,this._errorLoading=!1,!0}catch(e){return this.loading=!1,this._filteredData.length!==0||(e instanceof Error&&this.loadingErrorElement&&e.message.trim()!==""&&(this.loadingErrorElement.textContent=e.message),this._errorLoading=!0),!1}})}filter(s,e=this.filterFunction??this._stringFilterFunction,t=this.data){let i=[];for(let n of t)if(e(s,n)){if(this.preserveStructureOnFilter){let r={data:n.data};if(n.children){let o=this.filter(s,e,n.children);o.length&&(r.children=o)}i.push(r)}else if(i.push({data:n.data}),n.children){let r=this.filter(s,e,n.children);i.push(...r)}}else if(n.children){let r=this.filter(s,e,n.children);this.preserveStructureOnFilter&&r.length?i.push({data:n.data,children:r}):i.push(...r)}return i}get _missingDataElement(){return this.querySelector("[slot='missing-data']")}render(){if(this.loading)return B5();if(this._errorLoading)return Me`<slot name="error-loading"></slot>`;if(this._filteredData.length===0&&this._missingDataElement)return Me`<slot name="missing-data"></slot>`;let s=document.createElement("bim-table-row");s.table=this,s.isHeader=!0,s.data=this._headerRowData,s.style.gridArea="Header",s.style.position="sticky",s.style.top="0",s.style.zIndex="5";let e=document.createElement("bim-table-children");return e.table=this,e.data=this.value,e.style.gridArea="Body",e.style.backgroundColor="transparent",Me`
      <div class="parent">
        ${this.headersHidden?null:s} ${z5()}
        <div style="overflow-x: hidden; grid-area: Body">${e}</div>
      </div>
    `}};cO.styles=[zo.scrollbar,oi`
      :host {
        position: relative;
        overflow: auto;
        display: block;
        pointer-events: auto;
      }

      :host(:not([data-processing])) .loader {
        display: none;
      }

      .parent {
        display: grid;
        grid-template:
          "Header" auto
          "Processing" auto
          "Body" 1fr
          "Footer" auto;
        overflow: auto;
        height: 100%;
      }

      .parent > bim-table-row[is-header] {
        color: var(--bim-table_header--c, var(--bim-ui_bg-contrast-100));
        background-color: var(
          --bim-table_header--bgc,
          var(--bim-ui_bg-contrast-20)
        );
      }

      .controls {
        display: flex;
        gap: 0.375rem;
        flex-wrap: wrap;
        margin-bottom: 0.5rem;
      }
    `];var ws=cO;Ns([Pc()],ws.prototype,"_filteredData",2);Ns([ze({type:Boolean,attribute:"headers-hidden",reflect:!0})],ws.prototype,"headersHidden",2);Ns([ze({type:String,attribute:"min-col-width",reflect:!0})],ws.prototype,"minColWidth",2);Ns([ze({type:Array,attribute:!1})],ws.prototype,"columns",1);Ns([ze({type:Array,attribute:!1})],ws.prototype,"data",1);Ns([ze({type:Boolean,reflect:!0})],ws.prototype,"expanded",2);Ns([ze({type:Boolean,reflect:!0,attribute:"selectable-rows"})],ws.prototype,"selectableRows",2);Ns([ze({attribute:!1})],ws.prototype,"selection",2);Ns([ze({type:Boolean,attribute:"no-indentation",reflect:!0})],ws.prototype,"noIndentation",2);Ns([ze({type:Boolean,reflect:!0})],ws.prototype,"loading",2);Ns([Pc()],ws.prototype,"_errorLoading",2);var $5=Object.defineProperty,Z5=Object.getOwnPropertyDescriptor,ym=(s,e,t,i)=>{for(var n=i>1?void 0:i?Z5(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&$5(e,t,n),n},hO=class extends ei{constructor(){super(...arguments),this._defaultName="__unnamed__",this.name=this._defaultName,this._hidden=!1}set hidden(s){this._hidden=s,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}connectedCallback(){super.connectedCallback();let{parentElement:s}=this;if(s&&this.name===this._defaultName){let e=[...s.children].indexOf(this);this.name=`${this._defaultName}${e}`}}render(){return Me` <slot></slot> `}};hO.styles=oi`
    :host {
      display: block;
      height: 100%;
    }

    :host([hidden]) {
      display: none;
    }
  `;var gs=hO;ym([ze({type:String,reflect:!0})],gs.prototype,"name",2);ym([ze({type:String,reflect:!0})],gs.prototype,"label",2);ym([ze({type:String,reflect:!0})],gs.prototype,"icon",2);ym([ze({type:Boolean,reflect:!0})],gs.prototype,"hidden",1);var Q5=Object.defineProperty,J5=Object.getOwnPropertyDescriptor,kc=(s,e,t,i)=>{for(var n=i>1?void 0:i?J5(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&Q5(e,t,n),n},dO=class extends ei{constructor(){super(...arguments),this._switchers=[],this.bottom=!1,this.switchersHidden=!1,this.floating=!1,this.switchersFull=!1,this.onTabHiddenChange=s=>{let e=s.target;e instanceof gs&&!e.hidden&&(e.removeEventListener("hiddenchange",this.onTabHiddenChange),this.tab=e.name,e.addEventListener("hiddenchange",this.onTabHiddenChange))}}set tab(s){this._tab=s;let e=[...this.children],t=e.find(i=>i instanceof gs&&i.name===s);for(let i of e){if(!(i instanceof gs))continue;i.hidden=t!==i;let n=this.getTabSwitcher(i.name);n&&n.toggleAttribute("data-active",!i.hidden)}}get tab(){return this._tab}getTabSwitcher(s){return this._switchers.find(e=>e.getAttribute("data-name")===s)}createSwitchers(){this._switchers=[];for(let s of this.children){if(!(s instanceof gs))continue;let e=document.createElement("div");e.addEventListener("click",()=>{this.tab===s.name?this.toggleAttribute("tab",!1):this.tab=s.name}),e.setAttribute("data-name",s.name),e.className="switcher";let t=document.createElement("bim-label");t.textContent=s.label??"",t.icon=s.icon,e.append(t),this._switchers.push(e)}}onSlotChange(s){this.createSwitchers();let e=s.target.assignedElements(),t=e.find(i=>i instanceof gs?this.tab?i.name===this.tab:!i.hidden:!1);t&&t instanceof gs&&(this.tab=t.name);for(let i of e){if(!(i instanceof gs)){i.remove();continue}i.removeEventListener("hiddenchange",this.onTabHiddenChange),t!==i&&(i.hidden=!0),i.addEventListener("hiddenchange",this.onTabHiddenChange)}}render(){return Me`
      <div class="parent">
        <div class="switchers">${this._switchers}</div>
        <div class="content">
          <slot @slotchange=${this.onSlotChange}></slot>
        </div>
      </div>
    `}};dO.styles=[zo.scrollbar,oi`
      * {
        box-sizing: border-box;
      }

      :host {
        background-color: var(--bim-ui_bg-base);
        display: block;
        overflow: auto;
      }

      .parent {
        display: grid;
        grid-template: "switchers" auto "content" 1fr;
        height: 100%;
      }

      :host([bottom]) .parent {
        grid-template: "content" 1fr "switchers" auto;
      }

      .switchers {
        display: flex;
        height: 2.25rem;
        font-weight: 600;
        grid-area: switchers;
      }

      .switcher {
        --bim-label--c: var(--bim-ui_bg-contrast-80);
        background-color: var(--bim-ui_bg-base);
        cursor: pointer;
        pointer-events: auto;
        padding: 0rem 0.75rem;
        display: flex;
        justify-content: center;
        transition: all 0.15s;
      }

      :host([switchers-full]) .switcher {
        flex: 1;
      }

      .switcher:hover,
      .switcher[data-active] {
        --bim-label--c: var(--bim-ui_main-contrast);
        background-color: var(--bim-ui_main-base);
      }

      .switchers bim-label {
        pointer-events: none;
      }

      :host([switchers-hidden]) .switchers {
        display: none;
      }

      .content {
        grid-area: content;
        overflow: auto;
      }

      :host(:not([bottom])) .content {
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([bottom]) .content {
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host(:not([tab])) .content {
        display: none;
      }

      :host([floating]) {
        background-color: transparent;
      }

      :host([floating]) .switchers {
        justify-self: center;
        overflow: auto;
      }

      :host([floating]:not([bottom])) .switchers {
        border-radius: var(--bim-ui_size-2xs) var(--bim-ui_size-2xs) 0 0;
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
        border-left: 1px solid var(--bim-ui_bg-contrast-20);
        border-right: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating][bottom]) .switchers {
        border-radius: 0 0 var(--bim-ui_size-2xs) var(--bim-ui_size-2xs);
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
        border-left: 1px solid var(--bim-ui_bg-contrast-20);
        border-right: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating]:not([tab])) .switchers {
        border-radius: var(--bim-ui_size-2xs);
        border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating][bottom]:not([tab])) .switchers {
        border-top: 1px solid var(--bim-ui_bg-contrast-20);
      }

      :host([floating]) .content {
        border: 1px solid var(--bim-ui_bg-contrast-20);
        border-radius: var(--bim-ui_size-2xs);
        background-color: var(--bim-ui_bg-base);
      }
    `];var Ka=dO;kc([Pc()],Ka.prototype,"_switchers",2);kc([ze({type:Boolean,reflect:!0})],Ka.prototype,"bottom",2);kc([ze({type:Boolean,attribute:"switchers-hidden",reflect:!0})],Ka.prototype,"switchersHidden",2);kc([ze({type:Boolean,reflect:!0})],Ka.prototype,"floating",2);kc([ze({type:String,reflect:!0})],Ka.prototype,"tab",1);kc([ze({type:Boolean,attribute:"switchers-full",reflect:!0})],Ka.prototype,"switchersFull",2);var PT=s=>s??Li,e4=Object.defineProperty,t4=Object.getOwnPropertyDescriptor,Br=(s,e,t,i)=>{for(var n=i>1?void 0:i?t4(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&e4(e,t,n),n},uO=class extends ei{constructor(){super(...arguments),this._inputTypes=["date","datetime-local","email","month","password","search","tel","text","time","url","week","area"],this.value="",this.vertical=!1,this._type="text",this.onValueChange=new Event("input")}set type(s){this._inputTypes.includes(s)&&(this._type=s)}get type(){return this._type}get query(){return Ty(this.value)}onInputChange(s){s.stopPropagation();let e=s.target;clearTimeout(this._debounceTimeoutID),this._debounceTimeoutID=setTimeout(()=>{this.value=e.value,this.dispatchEvent(this.onValueChange)},this.debounce)}focus(){setTimeout(()=>{var s;let e=(s=this.shadowRoot)==null?void 0:s.querySelector("input");e?.focus()})}render(){return Me`
      <bim-input
        .name=${this.name}
        .icon=${this.icon}
        .label=${this.label}
        .vertical=${this.vertical}
      >
        ${this.type==="area"?Me` <textarea
              aria-label=${this.label||this.name||"Text Input"}
              .value=${this.value}
              .rows=${this.rows??5}
              placeholder=${PT(this.placeholder)}
              @input=${this.onInputChange}
            ></textarea>`:Me` <input
              aria-label=${this.label||this.name||"Text Input"}
              .type=${this.type}
              .value=${this.value}
              placeholder=${PT(this.placeholder)}
              @input=${this.onInputChange}
            />`}
      </bim-input>
    `}};uO.styles=[zo.scrollbar,oi`
      :host {
        --bim-input--bgc: var(--bim-ui_bg-contrast-20);
        flex: 1;
        display: block;
      }

      input,
      textarea {
        font-family: inherit;
        background-color: transparent;
        border: none;
        width: 100%;
        padding: var(--bim-ui_size-3xs);
        color: var(--bim-text-input--c, var(--bim-ui_bg-contrast-100));
      }

      input {
        outline: none;
        height: 100%;
        padding: 0 var(--bim-ui_size-3xs); /* Override padding */
        border-radius: var(--bim-text-input--bdrs, var(--bim-ui_size-4xs));
      }

      textarea {
        line-height: 1.1rem;
        resize: vertical;
      }

      :host(:focus) {
        --bim-input--olc: var(--bim-ui_accent-base);
      }

      /* :host([disabled]) {
      --bim-input--bgc: var(--bim-ui_bg-contrast-20);
    } */
    `];var ur=uO;Br([ze({type:String,reflect:!0})],ur.prototype,"icon",2);Br([ze({type:String,reflect:!0})],ur.prototype,"label",2);Br([ze({type:String,reflect:!0})],ur.prototype,"name",2);Br([ze({type:String,reflect:!0})],ur.prototype,"placeholder",2);Br([ze({type:String,reflect:!0})],ur.prototype,"value",2);Br([ze({type:Boolean,reflect:!0})],ur.prototype,"vertical",2);Br([ze({type:Number,reflect:!0})],ur.prototype,"debounce",2);Br([ze({type:Number,reflect:!0})],ur.prototype,"rows",2);Br([ze({type:String,reflect:!0})],ur.prototype,"type",1);var i4=Object.defineProperty,n4=Object.getOwnPropertyDescriptor,pO=(s,e,t,i)=>{for(var n=i>1?void 0:i?n4(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&i4(e,t,n),n},fO=class extends ei{constructor(){super(...arguments),this.rows=2,this._vertical=!1}set vertical(s){this._vertical=s,this.updateChildren()}get vertical(){return this._vertical}updateChildren(){let s=this.children;for(let e of s)this.vertical?e.setAttribute("label-hidden",""):e.removeAttribute("label-hidden")}render(){return Me`
      <style>
        .parent {
          grid-auto-flow: ${this.vertical?"row":"column"};
          grid-template-rows: repeat(${this.rows}, 1fr);
        }
      </style>
      <div class="parent">
        <slot @slotchange=${this.updateChildren}></slot>
      </div>
    `}};fO.styles=oi`
    .parent {
      display: grid;
      gap: 0.25rem;
    }

    ::slotted(bim-button[label]:not([vertical])) {
      --bim-button--jc: flex-start;
    }

    ::slotted(bim-button) {
      --bim-label--c: var(--bim-ui_bg-contrast-80);
    }
  `;var _m=fO;pO([ze({type:Number,reflect:!0})],_m.prototype,"rows",2);pO([ze({type:Boolean,reflect:!0})],_m.prototype,"vertical",1);var s4=Object.defineProperty,r4=Object.getOwnPropertyDescriptor,wm=(s,e,t,i)=>{for(var n=i>1?void 0:i?r4(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&s4(e,t,n),n},mO=class extends ei{constructor(){super(...arguments),this._vertical=!1,this._labelHidden=!1}set vertical(s){this._vertical=s,this.updateChildren()}get vertical(){return this._vertical}set labelHidden(s){this._labelHidden=s,this.updateChildren()}get labelHidden(){return this._labelHidden}updateChildren(){let s=this.children;for(let e of s)e instanceof _m&&(e.vertical=this.vertical),e.toggleAttribute("label-hidden",this.vertical)}render(){return Me`
      <div class="parent">
        <div class="children">
          <slot @slotchange=${this.updateChildren}></slot>
        </div>
        ${!this.labelHidden&&(this.label||this.icon)?Me`<bim-label .icon=${this.icon}>${this.label}</bim-label>`:null}
      </div>
    `}};mO.styles=oi`
    :host {
      --bim-label--fz: var(--bim-ui_size-xs);
      --bim-label--c: var(--bim-ui_bg-contrast-60);
      display: block;
      flex: 1;
    }

    :host(:not([vertical])) ::slotted(bim-button[vertical]) {
      --bim-icon--fz: var(--bim-ui_size-5xl);
      min-height: 3.75rem;
    }

    ::slotted(bim-button) {
      --bim-label--c: var(--bim-ui_bg-contrast-80);
    }

    .parent {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      align-items: center;
      padding: 0.5rem;
      height: 100%;
      box-sizing: border-box;
      justify-content: space-between;
    }

    :host([vertical]) .parent {
      flex-direction: row-reverse;
    }

    :host([vertical]) .parent > bim-label {
      writing-mode: tb;
    }

    .children {
      display: flex;
      gap: 0.25rem;
    }

    :host([vertical]) .children {
      flex-direction: column;
    }
  `;var Nc=mO;wm([ze({type:String,reflect:!0})],Nc.prototype,"label",2);wm([ze({type:String,reflect:!0})],Nc.prototype,"icon",2);wm([ze({type:Boolean,reflect:!0})],Nc.prototype,"vertical",1);wm([ze({type:Boolean,attribute:"label-hidden",reflect:!0})],Nc.prototype,"labelHidden",1);var o4=Object.defineProperty,a4=Object.getOwnPropertyDescriptor,Jy=(s,e,t,i)=>{for(var n=i>1?void 0:i?a4(e,t):e,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=(i?o(e,t,n):o(n))||n);return i&&n&&o4(e,t,n),n},gO=class extends ei{constructor(){super(...arguments),this.labelsHidden=!1,this._vertical=!1,this._hidden=!1}set vertical(s){this._vertical=s,this.updateSections()}get vertical(){return this._vertical}set hidden(s){this._hidden=s,this.dispatchEvent(new Event("hiddenchange"))}get hidden(){return this._hidden}updateSections(){let s=this.children;for(let e of s)e instanceof Nc&&(e.labelHidden=this.vertical&&!Iy.config.sectionLabelOnVerticalToolbar,e.vertical=this.vertical)}render(){return Me`
      <div class="parent">
        <slot @slotchange=${this.updateSections}></slot>
      </div>
    `}};gO.styles=oi`
    :host {
      --bim-button--bgc: transparent;
      background-color: var(--bim-ui_bg-base);
      border-radius: var(--bim-ui_size-2xs);
      display: block;
    }

    :host([hidden]) {
      display: none;
    }

    .parent {
      display: flex;
      width: min-content;
      pointer-events: auto;
    }

    :host([vertical]) .parent {
      flex-direction: column;
    }

    :host([vertical]) {
      width: min-content;
      border-radius: var(--bim-ui_size-2xs);
      border: 1px solid var(--bim-ui_bg-contrast-20);
    }

    ::slotted(bim-toolbar-section:not(:last-child)) {
      border-right: 1px solid var(--bim-ui_bg-contrast-20);
      border-bottom: none;
    }

    :host([vertical]) ::slotted(bim-toolbar-section:not(:last-child)) {
      border-bottom: 1px solid var(--bim-ui_bg-contrast-20);
      border-right: none;
    }
  `;var Em=gO;Jy([ze({type:String,reflect:!0})],Em.prototype,"icon",2);Jy([ze({type:Boolean,attribute:"labels-hidden",reflect:!0})],Em.prototype,"labelsHidden",2);Jy([ze({type:Boolean,reflect:!0})],Em.prototype,"vertical",1);var l4=Object.defineProperty,c4=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&l4(e,t,n),n},bO=class extends ei{constructor(){super(),this._onResize=new Event("resize"),new ResizeObserver(()=>{setTimeout(()=>{this.dispatchEvent(this._onResize)})}).observe(this)}render(){return Me`
      <div class="parent">
        <slot></slot>
      </div>
    `}};bO.styles=oi`
    :host {
      display: grid;
      min-width: 0;
      min-height: 0;
      height: 100%;
    }

    .parent {
      overflow: hidden;
      position: relative;
    }
  `;var vO=bO;c4([ze({type:String,reflect:!0})],vO.prototype,"name");var yO="important",h4=" !"+yO,kr=bP(class extends Jf{constructor(s){var e;if(super(s),s.type!==gP.ATTRIBUTE||s.name!=="style"||((e=s.strings)==null?void 0:e.length)>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(s){return Object.keys(s).reduce((e,t)=>{let i=s[t];return i==null?e:e+`${t=t.includes("-")?t:t.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${i};`},"")}update(s,[e]){let{style:t}=s.element;if(this.ft===void 0)return this.ft=new Set(Object.keys(e)),this.render(e);for(let i of this.ft)e[i]==null&&(this.ft.delete(i),i.includes("-")?t.removeProperty(i):t[i]=null);for(let i in e){let n=e[i];if(n!=null){this.ft.add(i);let r=typeof n=="string"&&n.endsWith(h4);i.includes("-")||r?t.setProperty(i,r?n.slice(0,-11):n,r?yO:""):t[i]=n}}return Ga}}),d4=s=>{let{components:e}=s,t=e.get(CE);return Me`
    <bim-button
      data-ui-id="import-ifc"
      label="Load IFC"
      icon="mage:box-3d-fill"
      @click=${()=>{let i=document.createElement("input");i.type="file",i.accept=".ifc",i.onchange=()=>ie(void 0,null,function*(){if(i.files===null||i.files.length===0)return;let n=i.files[0];i.remove();let r=yield n.arrayBuffer(),o=new Uint8Array(r),a=yield t.load(o);a.name=n.name.replace(".ifc","")}),i.click()}}
    ></bim-button>
  `},u4=s=>Vi.create(d4,s),p4=Object.freeze(Object.defineProperty({__proto__:null,loadIfc:u4},Symbol.toStringTag,{value:"Module"})),lK=Se({},p4),Gf={users:{"jhon.doe@example.com":{name:"Jhon Doe"}},priorities:{"On hold":{icon:"flowbite:circle-pause-outline",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#767676"}},Minor:{icon:"mingcute:arrows-down-fill",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#4CAF50"}},Normal:{icon:"fa6-solid:grip-lines",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}},Major:{icon:"mingcute:arrows-up-fill",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Critical:{icon:"ph:warning",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}}},statuses:{Active:{icon:"prime:circle-fill",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)"}},"In Progress":{icon:"prime:circle-fill",style:{backgroundColor:"#fa89004d","--bim-label--c":"#FB8C00","--bim-icon--c":"#FB8C00"}},"In Review":{icon:"prime:circle-fill",style:{backgroundColor:"#9c6bff4d","--bim-label--c":"#9D6BFF","--bim-icon--c":"#9D6BFF"}},Done:{icon:"prime:circle-fill",style:{backgroundColor:"#4CAF504D","--bim-label--c":"#4CAF50","--bim-icon--c":"#4CAF50"}},Closed:{icon:"prime:circle-fill",style:{backgroundColor:"#414141","--bim-label--c":"#727272","--bim-icon--c":"#727272"}}},types:{Clash:{icon:"gg:close-r",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}},Issue:{icon:"mdi:bug-outline",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Failure:{icon:"mdi:bug-outline",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Inquiry:{icon:"majesticons:comment-line",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Fault:{icon:"ph:warning",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Remark:{icon:"ph:note-blank-bold",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}},Request:{icon:"mynaui:edit-one",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#9D6BFF"}}}},sy={padding:"0.25rem 0.5rem",borderRadius:"999px","--bim-label--c":"var(--bim-ui_bg-contrast-100)"},OT=(s,e)=>{let t=(e?.users??Gf.users)[s],i=t?.name??s,n=i.trim().split(/\s+/),r,o;return n[0]&&n[0][0]&&(r=n[0][0].toUpperCase(),n[0][1]&&(o=n[0][1].toUpperCase())),n[1]&&n[1][0]&&(o=n[1][0].toUpperCase()),Me`
  <div style="display: flex; gap: 0.25rem; overflow: hidden;">
    ${!(t!=null&&t.picture)&&(r||o)?Me`
      <bim-label
        style=${kr({borderRadius:"999px",padding:"0.375rem",backgroundColor:"var(--bim-ui_bg-contrast-20)",aspectRatio:"1",fontSize:"0.7rem"})}>${r}${o}</bim-label>
      `:null}
    <bim-label .img=${t?.picture}>${i}</bim-label>
  </div>
`},f4=s=>{let{components:e,dataStyles:t,onTopicEnter:i}=s,n=e.get(ml),r=s.topics??n.list.values();return Me`
    <bim-table @cellcreated=${({detail:o})=>{let{cell:a}=o;a.style.marginLeft="0"}} ${vs(o=>{if(!o)return;let a=o;a.hiddenColumns=["Guid"],a.columns=["Title"],a.selectableRows=!0,a.dataTransform={Title:(l,c)=>{let{Guid:d}=c;if(typeof d!="string")return l;let h=n.list.get(d);return h?Me`
        <div style="display: flex; overflow: hidden;">
          <style>
            #BBETO {
              background-color: transparent
            }
  
            #BBETO:hover {
              --bim-label--c: var(--bim-ui_accent-base)
            }
          </style> 
          <bim-button @click=${()=>{i&&i(h)}} id="BBETO" icon="iconamoon:enter-duotone"></bim-button>
          <bim-label>${l}</bim-label>
        </div>`:l},Priority:l=>{if(typeof l!="string")return l;let c=(t?.priorities??Gf.priorities)[l];return Me`
          <bim-label
            .icon=${c?.icon}
            style=${kr(Se(Se({},sy),c?.style))}
          >${l}
          </bim-label>
        `},Status:l=>{if(typeof l!="string")return l;let c=(t?.statuses??Gf.statuses)[l];return Me`
          <bim-label
            .icon=${c?.icon}
            style=${kr(Se(Se({},sy),c?.style))}
          >${l}
          </bim-label>
        `},Type:l=>{if(typeof l!="string")return l;let c=(t?.types??Gf.types)[l];return Me`
          <bim-label
            .icon=${c?.icon}
            style=${kr(Se(Se({},sy),c?.style))}
          >${l}
          </bim-label>
        `},Author:l=>typeof l!="string"?l:OT(l,t),Assignee:l=>typeof l!="string"?l:OT(l,t)},a.data=[...r].map(l=>{var c;return{data:{Guid:l.guid,Title:l.title,Status:l.status,Description:l.description??"",Author:l.creationAuthor,Assignee:l.assignedTo??"",Date:l.creationDate.toDateString(),DueDate:((c=l.dueDate)==null?void 0:c.toDateString())??"",Type:l.type,Priority:l.priority??""}}})})}>
      <bim-label slot="missing-data" icon="ph:warning-fill" style="--bim-icon--c: gold;">There are no topics to display</bim-label>
    </bim-table>`},_O=(s,e=!0)=>{let t=Vi.create(f4,s);if(e){let{components:i,topics:n}=s,[,r]=t,o=i.get(ml);if(o.list.onItemUpdated.add(()=>r()),o.list.onItemDeleted.add(()=>r()),n)for(let a of n)a.relatedTopics.onItemAdded.add(()=>r()),a.relatedTopics.onItemDeleted.add(()=>r()),a.relatedTopics.onCleared.add(()=>r());else o.list.onItemSet.add(()=>r())}return t},m4=Object.freeze(Object.defineProperty({__proto__:null,topicsList:_O},Symbol.toStringTag,{value:"Module"})),g4=s=>{var e;let{components:t,topic:i,actions:n}=s,r=Se({selectComponents:!0,colorizeComponent:!0,resetColors:!0,updateCamera:!0,delete:!0,unlink:!!i},n),o=t.get(Gu),a=((e=s.topic)==null?void 0:e.viewpoints)??o.list.keys(),l=[];for(let c of a){let d=o.list.get(c);d&&l.push(d)}return Me`
    <bim-table ${vs(c=>{if(!c)return;let d=c;d.addEventListener("cellcreated",({detail:h})=>{let{cell:u}=h;u.style.padding="0.25rem"}),d.headersHidden=!0,d.hiddenColumns=["Guid"],d.columns=["Title",{name:"Actions",width:"auto"}],d.dataTransform={Actions:(h,u)=>{let{Guid:p}=u;if(!(p&&typeof p=="string"))return p;let f=o.list.get(p);return f?Me`
          <bim-button icon="ph:eye-fill" @click=${()=>f.go()}></bim-button>
          ${Object.values(r).includes(!0)?Me`
                <bim-button icon="prime:ellipsis-v">
                  <bim-context-menu>
                    ${r.selectComponents?Me`<bim-button label="Select Components" @click=${()=>console.log(f.selection)}></bim-button> `:null}
                    ${r.colorizeComponent?Me`<bim-button label="Colorize Components" @click=${()=>f.colorize()}></bim-button> `:null}
                    ${r.resetColors?Me`<bim-button label="Reset Colors" @click=${()=>f.resetColors()}></bim-button> `:null}
                    ${r.updateCamera?Me`<bim-button label="Update Camera" @click=${()=>f.updateCamera()}></bim-button> `:null}
                    ${r.unlink?Me`<bim-button .disabled=${!i} label="Unlink" @click=${()=>i?.viewpoints.delete(f.guid)}></bim-button> `:null}
                    ${r.delete?Me`<bim-button label="Delete" @click=${()=>o.list.delete(f.guid)}></bim-button>`:null}
                  </bim-context-menu>
                </bim-button>
              `:null}
        `:p}},d.data=l.map((h,u)=>({data:{Guid:h.guid,Title:h.title??`Viewpoint ${s.topic?u+1:""}`,Actions:""}}))})}>
      <bim-label slot="missing-data" icon="ph:warning-fill" style="--bim-icon--c: gold;">No viewpoints to show</bim-label>
    </bim-table>
  `},e_=(s,e=!0)=>{let t=Vi.create(g4,s),{components:i,topic:n}=s;if(e){let[,r]=t,o=i.get(Gu);o.list.onItemUpdated.add(()=>r()),o.list.onItemDeleted.add(()=>r()),o.list.onCleared.add(()=>r()),n?(n.viewpoints.onItemAdded.add(()=>r()),n.viewpoints.onItemDeleted.add(()=>r()),n.viewpoints.onCleared.add(()=>r())):o.list.onItemSet.add(()=>r())}return t},b4=Object.freeze(Object.defineProperty({__proto__:null,viewpointsList:e_},Symbol.toStringTag,{value:"Module"})),v4={"jhon.doe@example.com":{name:"Jhon Doe",picture:"https://www.profilebakery.com/wp-content/uploads/2023/04/Profile-Image-AI.jpg"}},y4=(s,e)=>{let t=(e??v4)[s],i=t?.name??s,n=i.trim().split(/\s+/),r,o;return n[0]&&n[0][0]&&(r=n[0][0].toUpperCase(),n[0][1]&&(o=n[0][1].toUpperCase())),n[1]&&n[1][0]&&(o=n[1][0].toUpperCase()),Me`
  <div style="display: flex; gap: 0.25rem; overflow: hidden;">
    ${!(t!=null&&t.picture)&&(r||o)?Me`
      <bim-label
        style=${kr({borderRadius:"999px",padding:"0.375rem",backgroundColor:"var(--bim-ui_bg-contrast-20)",aspectRatio:"1",fontSize:"0.7rem"})}>${r}${o}</bim-label>
      `:null}
    <bim-label .img=${t?.picture}>${i}</bim-label>
  </div>
`},_4=s=>{let{topic:e,styles:t,viewpoint:i,actions:n}=s,r=Se({delete:!0},n);return Me`<bim-table @cellcreated=${({detail:o})=>{let{cell:a}=o;a.style.marginLeft="0"}} ${vs(o=>{if(!o)return;let a=o;a.headersHidden=!0,a.hiddenColumns=["guid","author"],a.dataTransform={Comment:(c,d)=>{let{guid:h}=d;if(typeof h!="string")return c;let u=e.comments.get(h);if(!u)return c;let p=()=>{e.comments.delete(h)};return Me`
        <div style="display: flex; flex-direction: column; gap: 0.25rem; flex: 1">
          <div style="display: flex; justify-content: space-between;">
            <div style="display: flex; gap: 0.375rem;">
              ${y4(u.author,t)}
              <bim-label style="color: var(--bim-ui_bg-contrast-40)">@ ${u.date.toDateString()}</bim-label>
            </div>
            <div>
              <style>
                #TCDBT {
                  background-color: transparent;
                  --bim-label--c: var(--bim-ui_bg-contrast-60)
                }

                #TCDBT:hover {
                  --bim-label--c: #FF5252;
                }
              </style>
              ${r!=null&&r.delete?Me`<bim-button @click=${p} id="TCDBT" icon="majesticons:delete-bin"></bim-button>`:null}
            </div>
          </div>
          <bim-label style="margin-left: 1.7rem; white-space: normal">${u.comment}</bim-label>
        </div>
      `}};let l=e.comments.values();i&&(l=[...e.comments.values()].filter(c=>c.viewpoint===i)),a.data=[...l].map(c=>({data:{guid:c.guid,Comment:c.comment,author:(()=>{let d=t;if(!d)return c.author;let h=d[c.author];return h?.name??c.author})()}}))})}><bim-label slot="missing-data" icon="ph:warning-fill" style="--bim-icon--c: gold;">This topic has no comments</bim-label></bim-table>`},wO=(s,e=!0)=>{let t=Vi.create(_4,s);if(e){let{topic:i}=s,[n,r]=t;i.comments.onItemSet.add(()=>r()),i.comments.onItemUpdated.add(()=>r()),i.comments.onItemDeleted.add(()=>r()),i.comments.onCleared.add(()=>r())}return t},w4=Object.freeze(Object.defineProperty({__proto__:null,topicComments:wO},Symbol.toStringTag,{value:"Module"})),Wf={users:{"jhon.doe@example.com":{name:"Jhon Doe"}},priorities:{"On hold":{icon:"flowbite:circle-pause-outline",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#767676"}},Minor:{icon:"mingcute:arrows-down-fill",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#4CAF50"}},Normal:{icon:"fa6-solid:grip-lines",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}},Major:{icon:"mingcute:arrows-up-fill",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Critical:{icon:"ph:warning",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}}},statuses:{Active:{icon:"prime:circle-fill",style:{backgroundColor:"#2E2E2E"}},"In Progress":{icon:"prime:circle-fill",style:{backgroundColor:"#fa89004d","--bim-label--c":"#FB8C00","--bim-icon--c":"#FB8C00"}},"In Review":{icon:"prime:circle-fill",style:{backgroundColor:"#9c6bff4d","--bim-label--c":"#9D6BFF","--bim-icon--c":"#9D6BFF"}},Done:{icon:"prime:circle-fill",style:{backgroundColor:"#4CAF504D","--bim-label--c":"#4CAF50","--bim-icon--c":"#4CAF50"}},Closed:{icon:"prime:circle-fill",style:{backgroundColor:"#2E2E2E","--bim-label--c":"#727272","--bim-icon--c":"#727272"}}},types:{Clash:{icon:"gg:close-r",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}},Issue:{icon:"mdi:bug-outline",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Failure:{icon:"mdi:bug-outline",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Inquiry:{icon:"majesticons:comment-line",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Fault:{icon:"ph:warning",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FF5252"}},Remark:{icon:"ph:note-blank-bold",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#FB8C00"}},Request:{icon:"mynaui:edit-one",style:{backgroundColor:"var(--bim-ui_bg-contrast-20)","--bim-icon--c":"#9D6BFF"}}}},ry={padding:"0.25rem 0.5rem",borderRadius:"999px","--bim-label--c":"white"},oy=(s,e)=>{let t=(e?.users??Wf.users)[s],i=t?.name??s,n=i.trim().split(/\s+/),r,o;return n[0]&&n[0][0]&&(r=n[0][0].toUpperCase(),n[0][1]&&(o=n[0][1].toUpperCase())),n[1]&&n[1][0]&&(o=n[1][0].toUpperCase()),Me`
  <div style="display: flex; gap: 0.25rem; overflow: hidden;">
    ${!(t!=null&&t.picture)&&(r||o)?Me`
      <bim-label
        style=${kr({borderRadius:"999px",padding:"0.375rem",backgroundColor:"var(--bim-ui_bg-contrast-20)",aspectRatio:"1",fontSize:"0.7rem"})}>${r}${o}</bim-label>
      `:null}
    <bim-label .img=${t?.picture}>${i}</bim-label>
  </div>
`},[rm,E4]=Vi.create(s=>{let{topic:e}=s,t=document.createElement("bim-text-input");t.type="area";let i=()=>{t.value="",rm.close(),rm.remove()};return Me`
     <dialog>
      ${e?Me`
            <bim-panel style="border-radius: var(--bim-ui_size-base); outline: 2px solid var(--bim-ui_bg-contrast-20); width: 20rem;">
              <bim-panel-section label="New Comment" fixed>
                ${t}
                <div style="justify-content: right; display: flex; gap: 0.375rem">
                  <style>
                    #PAISD {
                      background-color: transparent;
                    }

                    #PAISD:hover {
                      --bim-label--c: #FF5252;
                    }

                    #MDOG9:hover {
                      background-color: #329936;
                    }
                  </style>
                  <bim-button @click=${i} style="flex: 0" id="PAISD" label="Cancel"></bim-button>
                  <bim-button @click=${()=>{let n=t.value;!e||n.trim()===""||(e.createComment(n),i())}} style="flex: 0" id="MDOG9" label="Add Comment"} icon="mi:add"}></bim-button>
                </div>
              </bim-panel-section>
            </bim-panel> 
          `:Me`<bim-label>No topic refereced</bim-label>`}
     </dialog> 
    `},{}),[om,C4]=Vi.create(s=>{let{components:e,topic:t}=s,i;e&&(i=e_({components:e,actions:{delete:!1,updateCamera:!1,colorizeComponent:!1,resetColors:!1,selectComponents:!1}})[0],i.selectableRows=!0);let n=()=>{om.close(),om.remove(),i?.remove()};return Me`
     <dialog>
      ${t?Me`
            <bim-panel style="border-radius: var(--bim-ui_size-base); outline: 2px solid var(--bim-ui_bg-contrast-20); width: 20rem;">
              <bim-panel-section label="Link Viewpoints" fixed>
                ${i}
                <div style="justify-content: right; display: flex; gap: 0.375rem">
                  <style>
                    #PAISD {
                      background-color: transparent;
                    }

                    #PAISD:hover {
                      --bim-label--c: #FF5252;
                    }

                    #MDOG9:hover {
                      background-color: #329936;
                    }
                  </style>
                  <bim-button @click=${n} style="flex: 0" id="PAISD" label="Cancel"></bim-button>
                  <bim-button @click=${()=>{if(!(i&&t))return;let r=i.selection;for(let o of r){let{Guid:a}=o;typeof a=="string"&&t.viewpoints.add(a)}n()}} style="flex: 0" id="MDOG9" label="Link Viewpoints"} icon="mi:add"}></bim-button>
                </div>
              </bim-panel-section>
            </bim-panel> 
          `:Me`<bim-label>No topic refereced</bim-label>`}
     </dialog> 
    `},{}),[am,x4]=Vi.create(s=>{let{components:e,topic:t}=s,i;if(e){let r=[...e.get(ml).list.values()].filter(o=>o!==t);i=_O({components:e,topics:r})[0],i.selectableRows=!0,i.hiddenColumns=["Guid","Author","Assignee","Date","DueDate"]}let n=()=>{am.close(),am.remove(),i?.remove()};return Me`
     <dialog>
        <bim-panel style="border-radius: var(--bim-ui_size-base); outline: 2px solid var(--bim-ui_bg-contrast-20); width: 50rem;">
          <bim-panel-section label="Link Viewpoints" fixed>
            ${i}
            <div style="justify-content: right; display: flex; gap: 0.375rem">
              <style>
                #PAISD {
                  background-color: transparent;
                }

                #PAISD:hover {
                  --bim-label--c: #FF5252;
                }

                #MDOG9:hover {
                  background-color: #329936;
                }
              </style>
              <bim-button @click=${n} style="flex: 0" id="PAISD" label="Cancel"></bim-button>
              <bim-button @click=${()=>{if(!(i&&t))return;let r=i.selection;for(let o of r){let{Guid:a}=o;typeof a=="string"&&t.relatedTopics.add(a)}n()}} style="flex: 0" id="MDOG9" label="Link Topics"} icon="mi:add"}></bim-button>
            </div>
          </bim-panel-section>
        </bim-panel> 
     </dialog> 
    `},{}),S4=s=>{let{components:e,topic:t,styles:i,onUpdateInformation:n,actions:r,world:o}=s,a=Se({update:!0,addComments:!0,linkViewpoints:!0,addViewpoints:!0,linkTopics:!0},r),l=i?.priorities??Wf.priorities,c=i?.statuses??Wf.statuses,d=i?.types??Wf.types,h;t!=null&&t.priority&&(h=l[t.priority]);let u;t!=null&&t.type&&(u=d[t.type]);let p;t!=null&&t.type&&(p=c[t.status]);let f,m,g;t&&(f=wO({topic:t,styles:i?.users})[0],m=e_({components:e,topic:t})[0]);let b=()=>{if(!(t&&o))return;let w=e.get(Gu).create(o);t.viewpoints.add(w.guid)},v=()=>{E4({topic:t}),document.body.append(rm),rm.showModal()},E=()=>{C4({components:e,topic:t}),document.body.append(om),om.showModal()},y=()=>{x4({components:e,topic:t}),document.body.append(am),am.showModal()};return Me`
   <bim-panel>
    ${t?Me`
      <bim-panel-section label="Information" icon="ph:info-bold" collapsed>
      <div>
        <bim-label>Title</bim-label> 
        <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100)">${t.title}</bim-label> 
      </div>
      <div>
        <bim-label>Description</bim-label> 
        <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100)">${t.description}</bim-label> 
      </div>
      <div style="display: flex; gap: 0.375rem">
        <bim-label>Status</bim-label> 
        <bim-label .icon=${p?.icon} style=${kr(Se(Se({},ry),p?.style))}
        >${t.status}
        </bim-label>
      </div>
      <div style="display: flex; gap: 0.375rem">
        <bim-label>Type</bim-label> 
        <bim-label .icon=${u?.icon} style=${kr(Se(Se({},ry),u?.style))}
        >${t.type}
        </bim-label>
      </div>
      ${t.priority?Me`
            <div style="display: flex; gap: 0.375rem">
              <bim-label>Priority</bim-label> 
              <bim-label .icon=${h?.icon} style=${kr(Se(Se({},ry),h?.style))}
              >${t.priority}
              </bim-label>
            </div>`:null}
      <div style="display: flex; gap: 0.375rem">
        <bim-label>Author</bim-label> 
        ${oy(t.creationAuthor,i)}
      </div>
      ${t.assignedTo?Me`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Assignee</bim-label> 
            ${oy(t.assignedTo,i)}
          </div>`:null}
      ${t.dueDate?Me`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Due Date</bim-label> 
            <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100)">${t.dueDate.toDateString()}</bim-label>
          </div>`:null}
      ${t.modifiedAuthor?Me`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Modified By</bim-label> 
            ${oy(t.modifiedAuthor,i)}
          </div>`:null}
      ${t.modifiedDate?Me`
            <div style="display: flex; gap: 0.375rem">
              <bim-label>Modified Date</bim-label> 
              <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100)">${t.modifiedDate.toDateString()}</bim-label>
            </div>`:null}
      ${t.labels.size!==0?Me`
          <div style="display: flex; gap: 0.375rem">
            <bim-label>Labels</bim-label> 
            <bim-label style="--bim-label--c: var(--bim-ui_bg-contrast-100)">${[...t.labels].join(", ")}</bim-label>
          </div>`:null}
      ${a.update?Me`
            <bim-button @click=${()=>{n&&n(t)}} label="Update Information" icon="tabler:refresh"></bim-button> 
          `:null}
    </bim-panel-section>
    <bim-panel-section label="Comments" icon="majesticons:comment-line">
      ${f}
      ${a.addComments?Me`
            <bim-button @click=${v} label="Add Comment" icon="majesticons:comment-line"></bim-button>
          `:null}
    </bim-panel-section>
    <bim-panel-section label="Viewpoints" icon="tabler:camera">
      ${m}
      ${a.linkViewpoints||a.addViewpoints?Me`
          <div style="display: flex; gap: 0.375rem">
            ${a.addViewpoints?Me`<bim-button @click=${b} .disabled=${!o} label="Add Viewpoint" icon="mi:add"></bim-button> `:null}
            ${a.linkViewpoints?Me`<bim-button @click=${E} label="Link Viewpoint" icon="tabler:camera"></bim-button>`:null}
          </div>
          `:null}
    </bim-panel-section>
    <!-- <bim-panel-section label="Related Topics" icon="material-symbols:topic-outline">
      ${g}
      ${a.linkViewpoints?Me`
            <bim-button @click=${y} label="Link Topic" icon="material-symbols:topic-outline"></bim-button> 
          `:null}
    </bim-panel-section> -->
    `:Me`<bim-label>No topic selected!</bim-label>`}
   </bim-panel> 
  `},A4=(s,e=!0)=>{let t=Vi.create(S4,s);if(e){let{components:i}=s,[n,r]=t;i.get(ml).list.onItemUpdated.add(({value:o})=>{let{topic:a}=r(),{guid:l}=o;l===a?.guid&&r()})}return t},I4=Object.freeze(Object.defineProperty({__proto__:null,topicData:A4},Symbol.toStringTag,{value:"Module"})),cK=Se({},I4),T4=s=>{let{components:e,actions:t,tags:i}=s,n=t?.dispose??!0,r=t?.download??!0,o=t?.visibility??!0,a=i?.schema??!0,l=i?.viewDefinition??!0,c=e.get(Gi),d=document.createElement("bim-table");d.addEventListener("cellcreated",({detail:u})=>{let{cell:p}=u;p.style.padding="0.25rem 0"}),d.hiddenColumns=["modelID"],d.headersHidden=!0;let h=[];for(let[,u]of c.groups){if(!u)continue;let p={data:{Name:u.name||u.uuid,modelID:u.uuid}};h.push(p)}return d.dataTransform={Name:(u,p)=>{let{modelID:f}=p;if(typeof f!="string")return u;let m=c.groups.get(f);if(!m)return f;let g={};for(let A of m.items)g[A.id]=A.ids;let b,{schema:v}=m.ifcMetadata;a&&v&&(b=Me`
          <bim-label style="background-color: var(--bim-ui_main-base); padding: 0 0.25rem; color: var(--bim-ui_main-contrast); border-radius: 0.25rem;">${v}</bim-label>
          `);let E;if(l&&"viewDefinition"in m.ifcMetadata){let A=m.ifcMetadata.viewDefinition;E=Me`
          ${A.split(",").map(D=>Me`<bim-label style="background-color: var(--bim-ui_main-base); padding: 0 0.25rem; color: var(--bim-ui_main-contrast); border-radius: 0.25rem;">${D}</bim-label>`)}
        `}let y;n&&(y=Me`<bim-button @click=${()=>c.disposeGroup(m)} icon="mdi:delete"></bim-button>`);let w;o&&(w=Me`<bim-button @click=${A=>{let D=e.get(hh),M=A.target;D.set(M.hasAttribute("data-model-hidden"),g),M.toggleAttribute("data-model-hidden"),M.icon=M.hasAttribute("data-model-hidden")?"mdi:eye-off":"mdi:eye"}} icon="mdi:eye"></bim-button>`);let C;return r&&(C=Me`<bim-button @click=${()=>{let A=document.createElement("input");A.type="file",A.accept=".ifc",A.multiple=!1,A.addEventListener("change",()=>ie(void 0,null,function*(){if(!(A.files&&A.files.length===1))return;let D=A.files[0],M=yield D.arrayBuffer(),I=yield e.get(xE).saveToIfc(m,new Uint8Array(M)),O=new File([I],D.name),F=document.createElement("a");F.href=URL.createObjectURL(O),F.download=O.name,F.click(),URL.revokeObjectURL(F.href)})),A.click()}} icon="flowbite:download-solid"></bim-button>`),Me`
       <div style="display: flex; flex: 1; gap: var(--bim-ui_size-4xs); justify-content: space-between; overflow: auto;">
        <div style="display: flex; flex-wrap: wrap; align-items: center; gap: 0 var(--bim-ui_size-4xs); flex-grow: 1; overflow: auto;">
          <div style="min-height: 1.75rem; overflow: auto; display: flex;">
            <bim-label style="white-space: normal;">${u}</bim-label>
          </div>
          <div style="display: flex; flex-wrap: wrap; gap: var(--bim-ui_size-4xs); overflow: auto;">
            ${b}
            ${E}
          </div>
        </div>
        <div style="display: flex; align-self: flex-start; flex-shrink: 0;">
          ${C}
          ${w}
          ${y}
        </div>
       </div>
      `}},d.data=h,Me`
    <div>
      ${h.length===0?Me`<bim-label>No models has been loaded yet</bim-label>`:d}
    </div>
  `},P4=(s,e=!0)=>{let t=Vi.create(T4,s);if(e){let{components:i}=s,n=i.get(Gi),[,r]=t;n.onFragmentsLoaded.add(()=>setTimeout(()=>r())),n.onFragmentsDisposed.add(()=>r())}return t},O4=Object.freeze(Object.defineProperty({__proto__:null,modelsList:P4},Symbol.toStringTag,{value:"Module"})),EO=["Name","ContainedInStructure","ForLayerSet","LayerThickness","HasProperties","HasAssociations","HasAssignments","HasPropertySets","PredefinedType","Quantities","ReferencedSource","Identification",s=>s.includes("Value"),s=>s.startsWith("Material"),s=>s.startsWith("Relating"),s=>{let e=["IsGroupedBy","IsDecomposedBy"];return s.startsWith("Is")&&!e.includes(s)}];function Yf(r,o,a){return ie(this,arguments,function*(s,e,t,i=EO,n=!1){let l=s.get(Nn),c=yield e.getProperties(t);if(!c)return{data:{Entity:`${t} properties not found...`}};let d=l.relationMaps[e.uuid],h={data:{}};for(let u in c){let p=i.map(m=>typeof m=="string"?u===m:m(u)).includes(!0);if(!(u==="type"||p))continue;let f=c[u];if(f)if(f.type===5){h.children||(h.children=[]);let m=yield Yf(s,e,f.value,i,n);h.children.push(m)}else if(typeof f=="object"&&!Array.isArray(f)){let{value:m,type:g}=f;if(n)g===1||g===2||g===3||(h.data[u]=m);else{let b=typeof m=="number"?Number(m.toFixed(3)):m;h.data[u]=b}}else if(Array.isArray(f))for(let m of f){if(m.type!==5)continue;h.children||(h.children=[]);let g=yield Yf(s,e,m.value,i,n);h.children.push(g)}else if(u==="type"){let m=ch[f];h.data.Entity=m}else h.data[u]=f}if(d&&d.get(c.expressID)){let u=d.get(c.expressID);for(let p of i){let f=[];if(typeof p=="string"){let m=l._inverseAttributes.indexOf(p);m!==-1&&f.push(m)}else{let m=l._inverseAttributes.filter(g=>p(g));for(let g of m){let b=l._inverseAttributes.indexOf(g);f.push(b)}}for(let m of f){let g=u.get(m);if(g)for(let b of g){let v=yield Yf(s,e,b,i,n);h.children||(h.children=[]),h.children.push(v)}}}}return h})}var M4=s=>{let{components:e,fragmentIdMap:t,attributesToInclude:i,editable:n,tableDefinition:r}=s,o=e.get(Gi),a;return typeof i=="function"?a=i(EO):a=i,Me`<bim-table ${vs(l=>ie(void 0,null,function*(){if(!l)return;let c=l,d=[],h=[];for(let u in t){let p=o.list.get(u);if(!(p&&p.group))continue;let f=p.group,m=h.find(g=>g.model===f);if(m)for(let g of t[u])m.expressIDs.add(g);else{let g={model:f,expressIDs:new Set(t[u])};h.push(g)}}for(let u of h){let{model:p,expressIDs:f}=u;for(let m of f){let g=yield Yf(e,p,m,a,n);d.push(g)}}c.dataTransform=r,c.data=d,c.columns=[{name:"Entity",width:"minmax(15rem, 1fr)"}]}))}></bim-table>`},R4=s=>Vi.create(M4,s),D4=Object.freeze(Object.defineProperty({__proto__:null,entityAttributes:R4},Symbol.toStringTag,{value:"Module"})),Po,L4=s=>{let{components:e,classifications:t}=s,i=e.get(SE),n=e.get(hh);Po||(Po=document.createElement("bim-table"),Po.headersHidden=!0,Po.hiddenColumns=["system"],Po.columns=["Name",{name:"Actions",width:"auto"}],Po.dataTransform={Actions:(o,a)=>{let{system:l,Name:c}=a;if(!(typeof l=="string"&&typeof c=="string"))return o;let d=i.list[l];if(!(d&&d[c]))return o;let h=d[c],{map:u}=h;return Me`
          <div>
            <bim-checkbox checked @change=${p=>{let f=p.target;n.set(f.value,u)}}></bim-checkbox>
          </div>
        `}});let r=[];for(let o of t){let a=typeof o=="string"?o:o.system,l=typeof o=="string"?o:o.label,c=i.list[a];c&&r.push({data:{Name:l,system:a},children:Object.keys(c).map(d=>({data:{Name:d,system:a,Actions:""}}))})}return Po.data=r,Me`${Po}`},F4=(s,e=!0)=>{let t=Vi.create(L4,s);if(e){let{components:i}=s,n=i.get(Gi),[,r]=t;n.onFragmentsDisposed.add(()=>r())}return t},k4=Object.freeze(Object.defineProperty({__proto__:null,classificationTree:F4},Symbol.toStringTag,{value:"Module"})),CO=(s,e,t)=>ie(void 0,null,function*(){var i,n,r,o;let a=s.get(Nn),l={data:{Name:(i=t.Name)==null?void 0:i.value},children:[{data:{Name:"Identification",Value:(n=t.Identification)==null?void 0:n.value}},{data:{Name:"Name",Value:(r=t.Name)==null?void 0:r.value}},{data:{Name:"Description",Value:(o=t.Description)==null?void 0:o.value}}]},c=a.getEntityRelations(e,t.expressID,"IsNestedBy");if(!c)return l;l.children||(l.children=[]);let d=[];l.children.push({data:{Name:"Tasks"},children:d});for(let h of c){let u=yield e.getProperties(h);if(!u)continue;let p=yield CO(s,e,u);d.push(p)}return l}),N4=(s,e,t)=>ie(void 0,null,function*(){let i=[];for(let n of t){let r=yield CO(s,e,n);i.push(r)}return{data:{Name:"Tasks"},children:i}}),U4=(s,e)=>ie(void 0,null,function*(){var t,i;let n={data:{Name:"Classifications"}};for(let r of e){let{value:o}=r.ReferencedSource,a=yield s.getProperties(o);if(!a)continue;let l={data:{Name:a.Name.value},children:[{data:{Name:"Identification",Value:((t=r.Identification)==null?void 0:t.value)||((i=r.ItemReference)==null?void 0:i.value)}},{data:{Name:"Name",Value:r.Name.value}}]};n.children||(n.children=[]),n.children.push(l)}return n}),B4=(s,e)=>ie(void 0,null,function*(){let t={data:{Name:"Materials"}};for(let i of e){if(i.type===Mg){let n=i.ForLayerSet.value,r=yield s.getProperties(n);if(!r)continue;for(let o of r.MaterialLayers){let{value:a}=o,l=yield s.getProperties(a);if(!l)continue;let c=yield s.getProperties(l.Material.value);if(!c)continue;let d={data:{Name:"Layer"},children:[{data:{Name:"Thickness",Value:l.LayerThickness.value}},{data:{Name:"Material",Value:c.Name.value}}]};t.children||(t.children=[]),t.children.push(d)}}if(i.type===Og)for(let n of i.Materials){let{value:r}=n,o=yield s.getProperties(r);if(!o)continue;let a={data:{Name:"Name",Value:o.Name.value}};t.children||(t.children=[]),t.children.push(a)}if(i.type===Rg){let n={data:{Name:"Name",Value:i.Name.value}};t.children||(t.children=[]),t.children.push(n)}}return t}),z4=(s,e)=>ie(void 0,null,function*(){let t={data:{Name:"PropertySets"}};for(let i of e){let n={data:{Name:i.Name.value}};if(i.type===ra){for(let r of i.HasProperties){let{value:o}=r,a=yield s.getProperties(o);if(!a)continue;let l=Object.keys(a).find(d=>d.includes("Value"));if(!(l&&a[l]))continue;let c={data:{Name:a.Name.value,Value:a[l].value}};n.children||(n.children=[]),n.children.push(c)}n.children&&(t.children||(t.children=[]),t.children.push(n))}}return t}),V4=(s,e)=>ie(void 0,null,function*(){let t={data:{Name:"QuantitySets"}};for(let i of e){let n={data:{Name:i.Name.value}};if(i.type===lh){for(let r of i.Quantities){let{value:o}=r,a=yield s.getProperties(o);if(!a)continue;let l=Object.keys(a).find(d=>d.includes("Value"));if(!(l&&a[l]))continue;let c={data:{Name:a.Name.value,Value:a[l].value}};n.children||(n.children=[]),n.children.push(c)}n.children&&(t.children||(t.children=[]),t.children.push(n))}}return t}),j4=["OwnerHistory","ObjectPlacement","CompositionType"],xO=(s,e)=>ie(void 0,null,function*(){let t=Se({groupName:"Attributes",includeClass:!1},e),{groupName:i,includeClass:n}=t,r={data:{Name:i}};n&&(r.children||(r.children=[]),r.children.push({data:{Name:"Class",Value:ch[s.type]}}));for(let o in s){if(j4.includes(o))continue;let a=s[o];if(a&&typeof a=="object"&&!Array.isArray(a)){if(a.type===bE)continue;let l={data:{Name:o,Value:a.value}};r.children||(r.children=[]),r.children.push(l)}}return r}),xc=(s,...e)=>{s.children||(s.children=[]),s.children.push(...e)},H4=(s,e,t,i)=>ie(void 0,null,function*(){let n=s.get(Nn).getEntityRelations(e,t,"IsDefinedBy");if(n){let r=[],o=[];for(let l of n){let c=yield e.getProperties(l);c&&(c.type===ra&&r.push(c),c.type===lh&&o.push(c))}let a=yield z4(e,r);a.children&&xc(i,a),(yield V4(e,o)).children&&xc(i,a)}}),G4=(s,e,t,i)=>ie(void 0,null,function*(){let n=s.get(Nn).getEntityRelations(e,t,"HasAssociations");if(n){let r=[],o=[];for(let c of n){let d=yield e.getProperties(c);d&&(d.type===cE&&r.push(d),(d.type===Mg||d.type===uE||d.type===pE||d.type===Rg||d.type===Og)&&o.push(d))}let a=yield U4(e,r);a.children&&xc(i,a);let l=yield B4(e,o);l.children&&xc(i,l)}}),W4=(s,e,t,i)=>ie(void 0,null,function*(){let n=s.get(Nn).getEntityRelations(e,t,"HasAssignments");if(n){let r=[];for(let a of n){let l=yield e.getProperties(a);l&&l.type===lE&&r.push(l)}let o=yield N4(s,e,r);o.children&&xc(i,o)}}),Y4=(s,e,t,i)=>ie(void 0,null,function*(){let n=s.get(Nn).getEntityRelations(e,t,"ContainedInStructure");if(n&&n[0]){let r=n[0],o=yield e.getProperties(r);if(o){let a=yield xO(o,{groupName:"SpatialContainer"});xc(i,a)}}}),Vf={},q4=(s,e)=>ie(void 0,null,function*(){var t;let i=s.get(Nn),n=s.get(Gi),r=n.getModelIdMap(e);Object.keys(e).length===0&&(Vf={});let o=[];for(let a in r){let l=n.groups.get(a);if(!l)continue;let c=i.relationMaps[l.uuid];if(!c)continue;a in Vf||(Vf[a]=new Map);let d=Vf[a],h=r[a];for(let u of h){let p=d.get(u);if(p){o.push(p);continue}let f=yield l.getProperties(u);if(!f)continue;p={data:{Name:(t=f.Name)==null?void 0:t.value}},o.push(p),d.set(u,p);let m=yield xO(f,{includeClass:!0});p.children||(p.children=[]),p.children.push(m),c.get(u)&&(yield H4(s,l,u,p),yield G4(s,l,u,p),yield W4(s,l,u,p),yield Y4(s,l,u,p))}}return o}),X4=new Event("datacomputed"),Dr,K4=s=>{let e=Se({emptySelectionWarning:!0},s),{components:t,fragmentIdMap:i,emptySelectionWarning:n}=e;if(!Dr&&(Dr=document.createElement("bim-table"),Dr.columns=[{name:"Name",width:"12rem"}],Dr.headersHidden=!0,Dr.addEventListener("cellcreated",({detail:r})=>{let{cell:o}=r;o.column==="Name"&&!("Value"in o.rowData)&&(o.style.gridColumn="1 / -1")}),n)){let r=document.createElement("bim-label");r.style.setProperty("--bim-icon--c","gold"),r.slot="missing-data",r.icon="ic:round-warning",r.textContent="Select some elements to display its properties",Dr.append(r)}return q4(t,i).then(r=>{Dr.data=r,r.length!==0&&Dr.dispatchEvent(X4)}),Me`${Dr}`},$4=s=>Vi.create(K4,s),Z4=Object.freeze(Object.defineProperty({__proto__:null,elementProperties:$4},Symbol.toStringTag,{value:"Module"})),Oy=(s,e,t,i)=>ie(void 0,null,function*(){var n;let r=[],o=s.get(Nn),a=yield e.getProperties(t);if(!a)return r;let{type:l}=a,c={data:{Entity:ch[l],Name:(n=a.Name)==null?void 0:n.value,modelID:e.uuid,expressID:t}};for(let d of i){let h=o.getEntityRelations(e,t,d);if(!h)continue;c.children||(c.children=[]),c.data.relations=JSON.stringify(h);let u={};for(let p of h){let f=yield Oy(s,e,p,i);for(let m of f)if(m.data.relations)c.children.push(m);else{let g=e.data.get(p);if(!g){c.children.push(m);continue}let b=g[1][1],v=ch[b];v in u||(u[v]=[]),m.data.Entity=m.data.Name,delete m.data.Name,u[v].push(m)}}for(let p in u){let f=u[p],m=f.map(b=>b.data.expressID),g={data:{Entity:p,modelID:e.uuid,relations:JSON.stringify(m)},children:f};c.children.push(g)}}return r.push(c),r}),Q4=(s,e,t,i)=>ie(void 0,null,function*(){let n=s.get(Nn),r=[];for(let o of e){let a;if(i)a={data:{Entity:o.name!==""?o.name:o.uuid},children:yield Oy(s,o,i,t)};else{let l=n.relationMaps[o.uuid],c=yield o.getAllPropertiesOfType(pl);if(!(l&&c))continue;let{expressID:d}=Object.values(c)[0];a={data:{Entity:o.name!==""?o.name:o.uuid},children:yield Oy(s,o,d,t)}}r.push(a)}return r}),Lr,J4=(s,e)=>{let t=s.get(Gi),{modelID:i,expressID:n,relations:r}=e.data;if(!i)return null;let o=t.groups.get(i);return o?o.getFragmentMap([n,...JSON.parse(r??"[]")]):null},e6=s=>{let{components:e,models:t,expressID:i}=s,n=s.selectHighlighterName??"select",r=s.hoverHighlighterName??"hover";Lr||(Lr=document.createElement("bim-table"),Lr.hiddenColumns=["modelID","expressID","relations"],Lr.columns=["Entity","Name"],Lr.headersHidden=!0,Lr.addEventListener("cellcreated",({detail:a})=>{let{cell:l}=a;l.column==="Entity"&&!("Name"in l.rowData)&&(l.style.gridColumn="1 / -1")})),Lr.addEventListener("rowcreated",a=>{a.stopImmediatePropagation();let{row:l}=a.detail,c=e.get(Hl),d=J4(e,l);d&&Object.keys(d).length!==0&&(l.onmouseover=()=>{r&&(l.style.backgroundColor="var(--bim-ui_bg-contrast-20)",c.highlightByID(r,d,!0,!1,c.selection[n]??{}))},l.onmouseout=()=>{l.style.backgroundColor="",c.clear(r)},l.onclick=()=>{n&&c.highlightByID(n,d,!0,!0)})});let o=s.inverseAttributes??["IsDecomposedBy","ContainsElements"];return Q4(e,t,o,i).then(a=>Lr.data=a),Me`${Lr}`},t6=(s,e=!0)=>{let t=Vi.create(e6,s);if(e){let[,i]=t,{components:n}=s,r=n.get(Gi),o=n.get(Nn),a=()=>i({models:r.groups.values()});o.onRelationsIndexed.add(a),r.onFragmentsDisposed.add(a)}return t},i6=Object.freeze(Object.defineProperty({__proto__:null,relationsTree:t6},Symbol.toStringTag,{value:"Module"})),Ed=(s,e)=>[...s.get(Hu).list.values()].find(t=>t.world===e),n6=(s,e)=>Me`
    <bim-color-input @input=${t=>{let i=t.target;s.color=new zt(i.color)}} color=${e}></bim-color-input>
  `,s6=(s,e)=>{let{postproduction:t}=s,i=t.n8ao.configuration;return Me`
    <bim-color-input @input=${n=>{let r=n.target;i.color=new zt(r.color)}} color=${e}></bim-color-input>
  `},r6=(s,e)=>{let{color:t,opacity:i}=JSON.parse(e),{postproduction:n}=s,{customEffects:r}=n;return Me`
    <bim-color-input @input=${o=>{let{color:a,opacity:l}=o.target;r.lineColor=new zt(a).getHex(),l&&(r.opacity=l/100)}} color=${t} opacity=${i*100}></bim-color-input>
  `},o6=(s,e)=>Me`
    <bim-color-input @input=${t=>{let i=t.target,n=new zt(i.color);s.material.uniforms.uColor.value=n}} color=${e}></bim-color-input>
  `,a6=(s,e)=>{let{postproduction:t}=s;return Me`
    <bim-checkbox @change=${i=>{let n=i.target;t.setPasses({ao:n.checked})}} .checked=${e}></bim-checkbox>
  `},l6=(s,e)=>{let{postproduction:t}=s;return Me`
    <bim-checkbox @change=${i=>{let n=i.target;t.setPasses({gamma:n.checked})}} .checked=${e}></bim-checkbox>
  `},c6=(s,e)=>{let{postproduction:t}=s;return Me`
    <bim-checkbox @change=${i=>{let n=i.target;t.setPasses({custom:n.checked})}} .checked=${e}></bim-checkbox>
  `},Oo=(s,e,t,i=()=>{})=>Me`
    <bim-checkbox .checked="${t}" @change="${n=>{let r=n.target.checked;s[e]=r,i(r)}}"></bim-checkbox> 
  `,xi=(s,e,t,i)=>{let n=Se({slider:!1,min:0,max:100,step:1,prefix:null,suffix:null,onInputSet:()=>{}},i),{slider:r,min:o,max:a,step:l,suffix:c,prefix:d,onInputSet:h}=n;return Me`
    <bim-number-input
      .pref=${d}
      .suffix=${c}
      .slider=${r} 
      min=${o} 
      value="${t}" 
      max=${a} 
      step=${l} 
      @change="${u=>{let p=u.target.value;s[e]=p,h(p)}}"
    ></bim-number-input> 
  `},h6=s=>{let{components:e}=s,t=e.get(Hi);return Me`<bim-table ${vs(i=>ie(void 0,null,function*(){var n,r,o,a,l;if(!i)return;let c=i;c.preserveStructureOnFilter=!0,c.dataTransform={Value:(h,u)=>{let p=u.World,f=t.list.get(p);if(!f)return h;let{scene:m,camera:g,renderer:b}=f,v=u.Name;if(v==="Grid"&&u.IsGridConfig&&typeof h=="boolean"){let E=Ed(e,f);return E?Oo(E,"visible",h):h}if(v==="Color"&&u.IsGridConfig&&typeof h=="string"){let E=Ed(e,f);return E?o6(E,h):h}if(v==="Distance"&&u.IsGridConfig&&typeof h=="number"){let E=Ed(e,f);return E?xi(E.material.uniforms.uDistance,"value",h,{slider:!0,min:300,max:1e3}):h}if(v==="Size"&&u.IsGridConfig&&typeof h=="string"){let E=Ed(e,f);if(!E)return h;let{x:y,y:w}=JSON.parse(h),C=xi(E.material.uniforms.uSize1,"value",y,{slider:!0,suffix:"m",prefix:"A",min:1,max:20}),A=xi(E.material.uniforms.uSize2,"value",w,{slider:!0,suffix:"m",prefix:"B",min:1,max:20});return Me`
            <div style="display: flex; gap: 0.25rem; width: 100%; flex-wrap: wrap">${C}${A}</div>
          `}if(v==="Near Frustum"&&g.three instanceof eo&&typeof h=="number"){let E=g.three;return xi(g.three,"near",h,{slider:!0,min:.1,max:10,step:.1,onInputSet:()=>E.updateProjectionMatrix()})}if(v==="Far Frustum"&&g.three instanceof eo&&typeof h=="number"){let E=g.three;return xi(g.three,"far",h,{slider:!0,min:300,max:2e3,step:10,onInputSet:()=>E.updateProjectionMatrix()})}if(v==="Field of View"&&g.three instanceof eo&&typeof h=="number"){let E=g.three;return xi(g.three,"fov",h,{slider:!0,min:10,max:120,onInputSet:()=>E.updateProjectionMatrix()})}if(v==="Invert Drag"&&g.hasCameraControls()&&typeof h=="boolean")return Oo(g.controls,"dollyDragInverted",h);if(v==="Dolly Speed"&&g.hasCameraControls()&&typeof h=="number")return xi(g.controls,"dollySpeed",h,{slider:!0,min:.5,max:3,step:.1});if(v==="Truck Speed"&&g.hasCameraControls()&&typeof h=="number")return xi(g.controls,"truckSpeed",h,{slider:!0,min:.5,max:6,step:.1});if(v==="Smooth Time"&&g.hasCameraControls()&&typeof h=="number")return xi(g.controls,"smoothTime",h,{slider:!0,min:.01,max:2,step:.01});if(v==="Intensity"&&typeof h=="number"){if(u.Light&&typeof u.Light=="string"){let E=m.three.children.find(y=>y.uuid===u.Light);return E&&E instanceof ul?xi(E,"intensity",h,{slider:!0,min:0,max:10,step:.1}):h}if(u.IsAOConfig&&b instanceof si)return xi(b.postproduction.n8ao.configuration,"intensity",h,{slider:!0,max:16,step:.1})}if(v==="Color"&&typeof h=="string"){let E=u.Light,y=m.three.children.find(w=>w.uuid===E);if(y&&y instanceof ul)return n6(y,h);if(u.IsAOConfig&&b instanceof si)return s6(b,h)}if(v==="Ambient Oclussion"&&typeof h=="boolean"&&u.IsAOConfig&&b instanceof si)return a6(b,h);if(v==="Half Resolution"&&u.IsAOConfig&&b instanceof si&&typeof h=="boolean")return Oo(b.postproduction.n8ao.configuration,"halfRes",h);if(v==="Screen Space Radius"&&u.IsAOConfig&&b instanceof si&&typeof h=="boolean")return Oo(b.postproduction.n8ao.configuration,"screenSpaceRadius",h);if(v==="Radius"&&u.IsAOConfig&&b instanceof si&&typeof h=="number")return xi(b.postproduction.n8ao.configuration,"aoRadius",h,{slider:!0,max:2,step:.1});if(v==="Denoise Samples"&&u.IsAOConfig&&b instanceof si&&typeof h=="number")return xi(b.postproduction.n8ao.configuration,"denoiseSamples",h,{slider:!0,min:1,max:16});if(v==="Samples"&&u.IsAOConfig&&b instanceof si&&typeof h=="number")return xi(b.postproduction.n8ao.configuration,"aoSamples",h,{slider:!0,min:1,max:16});if(v==="Denoise Radius"&&u.IsAOConfig&&b instanceof si&&typeof h=="number")return xi(b.postproduction.n8ao.configuration,"denoiseRadius",h,{slider:!0,min:0,max:16,step:.1});if(v==="Distance Falloff"&&u.IsAOConfig&&b instanceof si&&typeof h=="number")return xi(b.postproduction.n8ao.configuration,"distanceFalloff",h,{slider:!0,min:0,max:4,step:.1});if(v==="Directional Light"&&u.Light&&typeof u.Light=="string"&&typeof h=="boolean"){let E=m.three.children.find(y=>y.uuid===u.Light);return E&&E instanceof ul?Oo(E,"visible",h):h}if(v==="Ambient Light"&&u.Light&&typeof u.Light=="string"&&typeof h=="boolean"){let E=m.three.children.find(y=>y.uuid===u.Light);return E&&E instanceof ul?Oo(E,"visible",h):h}if(v==="Position"&&u.Light&&typeof u.Light=="string"&&typeof h=="string"){let E=m.three.children.find(I=>I.uuid===u.Light);if(!(E&&E instanceof ul))return h;let{x:y,y:w,z:C}=JSON.parse(h),A=xi(E.position,"x",y,{slider:!0,prefix:"X",suffix:"m",min:-50,max:50}),D=xi(E.position,"y",w,{slider:!0,prefix:"Y",suffix:"m",min:-50,max:50}),M=xi(E.position,"z",C,{slider:!0,prefix:"Z",suffix:"m",min:-50,max:50});return Me`
            <div style="display: flex; gap: 0.25rem; width: 100%; flex-wrap: wrap">${A}${D}${M}</div>
          `}return v==="Custom Effects"&&u.IsCEConfig&&b instanceof si&&typeof h=="boolean"?c6(b,h):v==="Color"&&u.IsOutlineConfig&&b instanceof si&&typeof h=="string"?r6(b,h):v==="Tolerance"&&u.IsOutlineConfig&&b instanceof si&&typeof h=="number"?xi(b.postproduction.customEffects,"tolerance",h,{slider:!0,min:0,max:6,step:.01}):v==="Outline"&&u.IsOutlineConfig&&b instanceof si&&typeof h=="boolean"?Oo(b.postproduction.customEffects,"outlineEnabled",h):v==="Gloss"&&u.IsGlossConfig&&b instanceof si&&typeof h=="boolean"?Oo(b.postproduction.customEffects,"glossEnabled",h):v==="Min"&&u.IsGlossConfig&&b instanceof si&&typeof h=="number"?xi(b.postproduction.customEffects,"minGloss",h,{slider:!0,min:-.5,max:.5,step:.01}):v==="Max"&&u.IsGlossConfig&&b instanceof si&&typeof h=="number"?xi(b.postproduction.customEffects,"maxGloss",h,{slider:!0,min:-.5,max:.5,step:.01}):v==="Exponent"&&u.IsGlossConfig&&b instanceof si&&typeof h=="number"?xi(b.postproduction.customEffects,"glossExponent",h,{slider:!0,min:0,max:5,step:.01}):v==="Gamma Correction"&&u.IsGammaConfig&&b instanceof si&&typeof h=="boolean"?l6(b,h):h}},c.addEventListener("cellcreated",({detail:h})=>{let u=h.cell.parentNode;if(!u)return;let p=u.querySelector("bim-table-cell[column='Name']"),f=u.querySelector("bim-table-cell[column='Value']");p&&!f&&(p.style.gridColumn="1 / -1")});let d=[];for(let[,h]of t.list){let{scene:u,camera:p,renderer:f}=h,m=Ed(e,h),g={data:{Name:h instanceof yE&&h.name||h.uuid},children:[]};if(u){let b={data:{Name:"Scene"}};if(m){let y={data:{Name:"Grid",Value:m.three.visible,World:h.uuid,IsGridConfig:!0},children:[{data:{Name:"Color",get Value(){return`#${m.material.uniforms.uColor.value.getHexString()}`},World:h.uuid,IsGridConfig:!0}},{data:{Name:"Size",get Value(){let w=m.material.uniforms.uSize1.value,C=m.material.uniforms.uSize2.value;return JSON.stringify({x:w,y:C})},World:h.uuid,IsGridConfig:!0}},{data:{Name:"Distance",Value:m.material.uniforms.uDistance.value,World:h.uuid,IsGridConfig:!0}}]};b.children||(b.children=[]),b.children.push(y)}let v=u.three.children.filter(y=>y instanceof Zw);for(let y of v){let w={data:{Name:"Directional Light",Value:y.visible,World:h.uuid,Light:y.uuid},children:[{data:{Name:"Position",Value:JSON.stringify(y.position),World:h.uuid,Light:y.uuid}},{data:{Name:"Intensity",Value:y.intensity,World:h.uuid,Light:y.uuid}},{data:{Name:"Color",Value:`#${y.color.getHexString()}`,World:h.uuid,Light:y.uuid}}]};b.children||(b.children=[]),b.children.push(w)}let E=u.three.children.filter(y=>y instanceof Qw);for(let y of E){let w={data:{Name:"Ambient Light",Value:y.visible,World:h.uuid,Light:y.uuid},children:[{data:{Name:"Intensity",Value:y.intensity,World:h.uuid,Light:y.uuid}},{data:{Name:"Color",Value:`#${y.color.getHexString()}`,World:h.uuid,Light:y.uuid}}]};b.children||(b.children=[]),b.children.push(w)}b.children&&((n=b.children)==null?void 0:n.length)>0&&((r=g.children)==null||r.push(b))}if(p.three instanceof eo){let b={data:{Name:"Perspective Camera"},children:[{data:{Name:"Near Frustum",Value:p.three.near,World:h.uuid}},{data:{Name:"Far Frustum",Value:p.three.far,World:h.uuid}},{data:{Name:"Field of View",Value:p.three.fov,World:h.uuid}}]};if(p.hasCameraControls()){let{controls:v}=p,E={dollyDragInverted:"Invert Drag",dollySpeed:"Dolly Speed",truckSpeed:"Truck Speed",smoothTime:"Smooth Time"};for(let y in E){let w=v[y];w!=null&&((o=b.children)==null||o.push({data:{Name:E[y],Value:w,World:h.uuid}}))}}(a=g.children)==null||a.push(b)}if(f instanceof si){let{postproduction:b}=f,v=b.n8ao.configuration,E={data:{Name:"Renderer"},children:[{data:{Name:"Gamma Correction",Value:b.settings.gamma??!1,World:h.uuid,IsGammaConfig:!0}},{data:{Name:"Ambient Oclussion",Value:b.settings.ao??!1,World:h.uuid,IsAOConfig:!0},children:[{data:{Name:"Samples",Value:v.aoSamples,World:h.uuid,IsAOConfig:!0}},{data:{Name:"Color",Value:`#${v.color.getHexString()}`,World:h.uuid,IsAOConfig:!0}},{data:{Name:"Half Resolution",Value:v.halfRes,World:h.uuid,IsAOConfig:!0}},{data:{Name:"Screen Space Radius",Value:v.screenSpaceRadius,World:h.uuid,IsAOConfig:!0}},{data:{Name:"Radius",Value:v.aoRadius,World:h.uuid,IsAOConfig:!0}},{data:{Name:"Intensity",Value:v.intensity,World:h.uuid,IsAOConfig:!0}},{data:{Name:"Distance Falloff",Value:v.distanceFalloff,World:h.uuid,IsAOConfig:!0}},{data:{Name:"Denoise Samples",Value:v.denoiseSamples,World:h.uuid,IsAOConfig:!0}},{data:{Name:"Denoise Radius",Value:v.denoiseRadius,World:h.uuid,IsAOConfig:!0}}]},{data:{Name:"Custom Effects",Value:b.settings.custom??!1,World:h.uuid,IsCEConfig:!0},children:[{data:{Name:"Gloss",Value:b.customEffects.glossEnabled,World:h.uuid,IsGlossConfig:!0},children:[{data:{Name:"Min",Value:b.customEffects.minGloss,World:h.uuid,IsGlossConfig:!0}},{data:{Name:"Max",Value:b.customEffects.maxGloss,World:h.uuid,IsGlossConfig:!0}},{data:{Name:"Exponent",Value:b.customEffects.glossExponent,World:h.uuid,IsGlossConfig:!0}}]},{data:{Name:"Outline",Value:b.customEffects.outlineEnabled,World:h.uuid,IsOutlineConfig:!0},children:[{data:{Name:"Color",get Value(){let y=new zt(b.customEffects.lineColor),w=b.customEffects.opacity;return JSON.stringify({color:`#${y.getHexString()}`,opacity:w})},World:h.uuid,IsOutlineConfig:!0}},{data:{Name:"Tolerance",Value:b.customEffects.tolerance,World:h.uuid,IsOutlineConfig:!0}}]}]}]};(l=g.children)==null||l.push(E)}d.push(g)}c.columns=[{name:"Name",width:"11rem"}],c.hiddenColumns=["World","Light","IsAOConfig","IsCEConfig","IsGlossConfig","IsOutlineConfig","IsGammaConfig","IsGridConfig"],c.data=d}))} headers-hidden expanded></bim-table>`},d6=(s,e=!0)=>{let t=Vi.create(h6,s);if(e){let[i]=t,n=()=>t[1](),{components:r}=s,o=r.get(Hi);o.onDisposed.add(i.remove);for(let[,a]of o.list)a.onDisposed.add(n);i.addEventListener("disconnected",()=>{o.onDisposed.remove(i.remove);for(let[,a]of o.list)a.onDisposed.remove(n)})}return t},u6=Object.freeze(Object.defineProperty({__proto__:null,worldsConfiguration:d6},Symbol.toStringTag,{value:"Module"})),hK=Se(Se(Se(Se(Se(Se(Se(Se(Se({},O4),D4),k4),Z4),i6),u6),m4),w4),b4);var lm=globalThis,cm=lm.trustedTypes,MT=cm?cm.createPolicy("lit-html",{createHTML:s=>s}):void 0,SO="$lit$",Do=`lit$${Math.random().toFixed(9).slice(2)}$`,AO="?"+Do,p6=`<${AO}>`,Wa=document,Nd=()=>Wa.createComment(""),Ud=s=>s===null||typeof s!="object"&&typeof s!="function",t_=Array.isArray,f6=s=>t_(s)||typeof s?.[Symbol.iterator]=="function",ay=`[ 	
\f\r]`,Cd=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,RT=/-->/g,DT=/>/g,Ua=RegExp(`>|${ay}(?:([^\\s"'>=/]+)(${ay}*=${ay}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),LT=/'/g,FT=/"/g,IO=/^(?:script|style|textarea|title)$/i,m6=s=>(e,...t)=>({_$litType$:s,strings:e,values:t}),TO=m6(1),Sc=Symbol.for("lit-noChange"),Ki=Symbol.for("lit-nothing"),kT=new WeakMap,za=Wa.createTreeWalker(Wa,129);function PO(s,e){if(!t_(s)||!s.hasOwnProperty("raw"))throw Error("invalid template strings array");return MT!==void 0?MT.createHTML(e):e}var g6=(s,e)=>{let t=s.length-1,i=[],n,r=e===2?"<svg>":e===3?"<math>":"",o=Cd;for(let a=0;a<t;a++){let l=s[a],c,d,h=-1,u=0;for(;u<l.length&&(o.lastIndex=u,d=o.exec(l),d!==null);)u=o.lastIndex,o===Cd?d[1]==="!--"?o=RT:d[1]!==void 0?o=DT:d[2]!==void 0?(IO.test(d[2])&&(n=RegExp("</"+d[2],"g")),o=Ua):d[3]!==void 0&&(o=Ua):o===Ua?d[0]===">"?(o=n??Cd,h=-1):d[1]===void 0?h=-2:(h=o.lastIndex-d[2].length,c=d[1],o=d[3]===void 0?Ua:d[3]==='"'?FT:LT):o===FT||o===LT?o=Ua:o===RT||o===DT?o=Cd:(o=Ua,n=void 0);let p=o===Ua&&s[a+1].startsWith("/>")?" ":"";r+=o===Cd?l+p6:h>=0?(i.push(c),l.slice(0,h)+SO+l.slice(h)+Do+p):l+Do+(h===-2?a:p)}return[PO(s,r+(s[t]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),i]},Bd=class s{constructor({strings:e,_$litType$:t},i){let n;this.parts=[];let r=0,o=0,a=e.length-1,l=this.parts,[c,d]=g6(e,t);if(this.el=s.createElement(c,i),za.currentNode=this.el.content,t===2||t===3){let h=this.el.content.firstChild;h.replaceWith(...h.childNodes)}for(;(n=za.nextNode())!==null&&l.length<a;){if(n.nodeType===1){if(n.hasAttributes())for(let h of n.getAttributeNames())if(h.endsWith(SO)){let u=d[o++],p=n.getAttribute(h).split(Do),f=/([.?@])?(.*)/.exec(u);l.push({type:1,index:r,name:f[2],strings:p,ctor:f[1]==="."?Ry:f[1]==="?"?Dy:f[1]==="@"?Ly:Ic}),n.removeAttribute(h)}else h.startsWith(Do)&&(l.push({type:6,index:r}),n.removeAttribute(h));if(IO.test(n.tagName)){let h=n.textContent.split(Do),u=h.length-1;if(u>0){n.textContent=cm?cm.emptyScript:"";for(let p=0;p<u;p++)n.append(h[p],Nd()),za.nextNode(),l.push({type:2,index:++r});n.append(h[u],Nd())}}}else if(n.nodeType===8)if(n.data===AO)l.push({type:2,index:r});else{let h=-1;for(;(h=n.data.indexOf(Do,h+1))!==-1;)l.push({type:7,index:r}),h+=Do.length-1}r++}}static createElement(e,t){let i=Wa.createElement("template");return i.innerHTML=e,i}};function Ac(s,e,t=s,i){var n,r;if(e===Sc)return e;let o=i!==void 0?(n=t.o)==null?void 0:n[i]:t.l,a=Ud(e)?void 0:e._$litDirective$;return o?.constructor!==a&&((r=o?._$AO)==null||r.call(o,!1),a===void 0?o=void 0:(o=new a(s),o._$AT(s,t,i)),i!==void 0?(t.o??(t.o=[]))[i]=o:t.l=o),o!==void 0&&(e=Ac(s,o._$AS(s,e.values),o,i)),e}var My=class{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){let{el:{content:t},parts:i}=this._$AD,n=(e?.creationScope??Wa).importNode(t,!0);za.currentNode=n;let r=za.nextNode(),o=0,a=0,l=i[0];for(;l!==void 0;){if(o===l.index){let c;l.type===2?c=new zd(r,r.nextSibling,this,e):l.type===1?c=new l.ctor(r,l.name,l.strings,this,e):l.type===6&&(c=new Fy(r,this,e)),this._$AV.push(c),l=i[++a]}o!==l?.index&&(r=za.nextNode(),o++)}return za.currentNode=Wa,n}p(e){let t=0;for(let i of this._$AV)i!==void 0&&(i.strings!==void 0?(i._$AI(e,i,t),t+=i.strings.length-2):i._$AI(e[t])),t++}},zd=class s{get _$AU(){var e;return((e=this._$AM)==null?void 0:e._$AU)??this.v}constructor(e,t,i,n){this.type=2,this._$AH=Ki,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=i,this.options=n,this.v=n?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode,t=this._$AM;return t!==void 0&&e?.nodeType===11&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Ac(this,e,t),Ud(e)?e===Ki||e==null||e===""?(this._$AH!==Ki&&this._$AR(),this._$AH=Ki):e!==this._$AH&&e!==Sc&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):f6(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==Ki&&Ud(this._$AH)?this._$AA.nextSibling.data=e:this.T(Wa.createTextNode(e)),this._$AH=e}$(e){var t;let{values:i,_$litType$:n}=e,r=typeof n=="number"?this._$AC(e):(n.el===void 0&&(n.el=Bd.createElement(PO(n.h,n.h[0]),this.options)),n);if(((t=this._$AH)==null?void 0:t._$AD)===r)this._$AH.p(i);else{let o=new My(r,this),a=o.u(this.options);o.p(i),this.T(a),this._$AH=o}}_$AC(e){let t=kT.get(e.strings);return t===void 0&&kT.set(e.strings,t=new Bd(e)),t}k(e){t_(this._$AH)||(this._$AH=[],this._$AR());let t=this._$AH,i,n=0;for(let r of e)n===t.length?t.push(i=new s(this.O(Nd()),this.O(Nd()),this,this.options)):i=t[n],i._$AI(r),n++;n<t.length&&(this._$AR(i&&i._$AB.nextSibling,n),t.length=n)}_$AR(e=this._$AA.nextSibling,t){var i;for((i=this._$AP)==null?void 0:i.call(this,!1,!0,t);e&&e!==this._$AB;){let n=e.nextSibling;e.remove(),e=n}}setConnected(e){var t;this._$AM===void 0&&(this.v=e,(t=this._$AP)==null||t.call(this,e))}},Ic=class{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,i,n,r){this.type=1,this._$AH=Ki,this._$AN=void 0,this.element=e,this.name=t,this._$AM=n,this.options=r,i.length>2||i[0]!==""||i[1]!==""?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=Ki}_$AI(e,t=this,i,n){let r=this.strings,o=!1;if(r===void 0)e=Ac(this,e,t,0),o=!Ud(e)||e!==this._$AH&&e!==Sc,o&&(this._$AH=e);else{let a=e,l,c;for(e=r[0],l=0;l<r.length-1;l++)c=Ac(this,a[i+l],t,l),c===Sc&&(c=this._$AH[l]),o||(o=!Ud(c)||c!==this._$AH[l]),c===Ki?e=Ki:e!==Ki&&(e+=(c??"")+r[l+1]),this._$AH[l]=c}o&&!n&&this.j(e)}j(e){e===Ki?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}},Ry=class extends Ic{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Ki?void 0:e}},Dy=class extends Ic{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==Ki)}},Ly=class extends Ic{constructor(e,t,i,n,r){super(e,t,i,n,r),this.type=5}_$AI(e,t=this){if((e=Ac(this,e,t,0)??Ki)===Sc)return;let i=this._$AH,n=e===Ki&&i!==Ki||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,r=e!==Ki&&(i===Ki||n);n&&this.element.removeEventListener(this.name,this,i),r&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t;typeof this._$AH=="function"?this._$AH.call(((t=this.options)==null?void 0:t.host)??this.element,e):this._$AH.handleEvent(e)}},Fy=class{constructor(e,t,i){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(e){Ac(this,e)}},NT=lm.litHtmlPolyfillSupport;NT?.(Bd,zd),(lm.litHtmlVersions??(lm.litHtmlVersions=[])).push("3.2.0");var b6=(s,e,t)=>{let i=t?.renderBefore??e,n=i._$litPart$;if(n===void 0){let r=t?.renderBefore??null;i._$litPart$=n=new zd(e.insertBefore(Nd(),r),r,void 0,t??{})}return n._$AI(s),n};var v6=()=>new ky,ky=class{},y6=s=>{let{components:e,topic:t,onCancel:i,onSubmit:n,styles:r}=s,o=n??(()=>{}),a=e.get(ml),l=t?.title??null,c=t?.status??null,d=t?.type??null,h=t?.priority??null,u=t?.assignedTo??null,p=t?.labels??null,f=t?.stage??null,m=t?.description??null,g=t!=null&&t.dueDate?t.dueDate.toISOString().split("T")[0]:null,b=new Set([...a.config.statuses]);c&&b.add(c);let v=new Set([...a.config.types]);d&&v.add(d);let E=new Set([...a.config.priorities]);h&&E.add(h);let y=new Set([...a.config.users]);u&&y.add(u);let w=new Set([...a.config.labels]);if(p)for(let M of p)w.add(M);let C=new Set([...a.config.stages]);f&&C.add(f);let A=v6(),D=()=>ie(void 0,null,function*(){let{value:M}=A;if(!M)return;Object.values(M.valueTransform).length===0&&(M.valueTransform={dueDate:O=>{if(typeof O=="string"&&O.trim()!=="")return new Date(O)},status:O=>{if(Array.isArray(O)&&O.length!==0)return O[0]},type:O=>{if(Array.isArray(O)&&O.length!==0)return O[0]},priority:O=>{if(Array.isArray(O)&&O.length!==0)return O[0]},assignedTo:O=>{if(Array.isArray(O)&&O.length!==0)return O[0]}});let I=M.value;if(t)t.set(I),yield o(t);else{let O=a.create(I);yield o(O)}});return Me`
    <bim-panel style="border-radius: var(--bim-ui_size-base); outline: 2px solid var(--bim-ui_bg-contrast-20); width: 22rem;">
      <bim-panel-section ${vs(A)} fixed label="New Topic" name="topic">
        <div style="display: flex; gap: 0.375rem">
          <bim-text-input vertical label="Title" name="title" .value=${l}></bim-text-input>
          ${t?Me`
              <bim-dropdown vertical label="Status" name="status" required>
                ${[...b].map(M=>Me`<bim-option label=${M} .checked=${c===M}></bim-option>`)}
              </bim-dropdown>`:Me``}
        </div>
        <div style="display: flex; gap: 0.375rem">
          <bim-dropdown vertical label="Type" name="type" required>
            ${[...v].map(M=>Me`<bim-option label=${M} .checked=${d===M}></bim-option>`)}
          </bim-dropdown>
          <bim-dropdown vertical label="Priority" name="priority">
            ${[...E].map(M=>Me`<bim-option label=${M} .checked=${h===M}></bim-option>`)}
          </bim-dropdown>
        </div>
        <div style="display: flex; gap: 0.375rem">
          <bim-dropdown vertical label="Labels" name="labels" multiple>
            ${[...w].map(M=>Me`<bim-option label=${M} .checked=${p?.has(M)}></bim-option>`)}
          </bim-dropdown>
          <bim-dropdown vertical label="Assignee" name="assignedTo">
            ${[...y].map(M=>{let I=r!=null&&r.users?r.users[M]:null,O=I?I.name:M,F=I?.picture;return Me`<bim-option label=${O} value=${M} .img=${F} .checked=${u===M}></bim-option>`})}
          </bim-dropdown>
        </div>
        <div style="display: flex; gap: 0.375rem">
          <bim-text-input vertical type="date" label="Due Date" name="dueDate" .value=${g}></bim-text-input> 
          <bim-dropdown vertical label="Stage" name="stage">
            ${[...C].map(M=>Me`<bim-option label=${M} .checked=${f===M}></bim-option>`)}
          </bim-dropdown>
        </div>
        <bim-text-input vertical label="Description" name="description" type="area" .value=${m??null}></bim-text-input>
        <div style="justify-content: right; display: flex; gap: 0.375rem">
          <style>
            #A7T9K {
              background-color: transparent;
            }

            #A7T9K:hover {
              --bim-label--c: #FF5252;
            }

            #W3F2J:hover {
              background-color: #329936;
            }
          </style>
          <bim-button @click=${i} style="flex: 0" id="A7T9K" label="Cancel"></bim-button>
          <bim-button @click=${D} style="flex: 0" id="W3F2J" label=${t?"Update Topic":"Add Topic"} icon=${t?"tabler:refresh":"mi:add"}></bim-button>
        </div>
      </bim-panel-section>
    </bim-panel>
  `},_6=s=>Vi.create(y6,s),w6=Object.freeze(Object.defineProperty({__proto__:null,createTopic:_6},Symbol.toStringTag,{value:"Module"})),dK=Se({},w6);var qf=globalThis,i_=qf.ShadowRoot&&(qf.ShadyCSS===void 0||qf.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,n_=Symbol(),UT=new WeakMap,OO=class{constructor(s,e,t){if(this._$cssResult$=!0,t!==n_)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=s,this.t=e}get styleSheet(){let s=this.o,e=this.t;if(i_&&s===void 0){let t=e!==void 0&&e.length===1;t&&(s=UT.get(e)),s===void 0&&((this.o=s=new CSSStyleSheet).replaceSync(this.cssText),t&&UT.set(e,s))}return s}toString(){return this.cssText}},E6=s=>new OO(typeof s=="string"?s:s+"",void 0,n_),MO=(s,...e)=>{let t=s.length===1?s[0]:e.reduce((i,n,r)=>i+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+s[r+1],s[0]);return new OO(t,s,n_)},C6=(s,e)=>{if(i_)s.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet);else for(let t of e){let i=document.createElement("style"),n=qf.litNonce;n!==void 0&&i.setAttribute("nonce",n),i.textContent=t.cssText,s.appendChild(i)}},BT=i_?s=>s:s=>s instanceof CSSStyleSheet?(e=>{let t="";for(let i of e.cssRules)t+=i.cssText;return E6(t)})(s):s;var{is:x6,defineProperty:S6,getOwnPropertyDescriptor:A6,getOwnPropertyNames:I6,getOwnPropertySymbols:T6,getPrototypeOf:P6}=Object,Tc=globalThis,zT=Tc.trustedTypes,O6=zT?zT.emptyScript:"",VT=Tc.reactiveElementPolyfillSupport,Td=(s,e)=>s,hm={toAttribute(s,e){switch(e){case Boolean:s=s?O6:null;break;case Object:case Array:s=s==null?s:JSON.stringify(s)}return s},fromAttribute(s,e){let t=s;switch(e){case Boolean:t=s!==null;break;case Number:t=s===null?null:Number(s);break;case Object:case Array:try{t=JSON.parse(s)}catch{t=null}}return t}},s_=(s,e)=>!x6(s,e),jT={attribute:!0,type:String,converter:hm,reflect:!1,hasChanged:s_};Symbol.metadata??(Symbol.metadata=Symbol("metadata")),Tc.litPropertyMetadata??(Tc.litPropertyMetadata=new WeakMap);var Lo=class extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??(this.l=[])).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=jT){if(t.state&&(t.attribute=!1),this._$Ei(),this.elementProperties.set(e,t),!t.noAccessor){let i=Symbol(),n=this.getPropertyDescriptor(e,i,t);n!==void 0&&S6(this.prototype,e,n)}}static getPropertyDescriptor(e,t,i){let{get:n,set:r}=A6(this.prototype,e)??{get(){return this[t]},set(o){this[t]=o}};return{get(){return n?.call(this)},set(o){let a=n?.call(this);r.call(this,o),this.requestUpdate(e,a,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??jT}static _$Ei(){if(this.hasOwnProperty(Td("elementProperties")))return;let e=P6(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(Td("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Td("properties"))){let t=this.properties,i=[...I6(t),...T6(t)];for(let n of i)this.createProperty(n,t[n])}let e=this[Symbol.metadata];if(e!==null){let t=litPropertyMetadata.get(e);if(t!==void 0)for(let[i,n]of t)this.elementProperties.set(i,n)}this._$Eh=new Map;for(let[t,i]of this.elementProperties){let n=this._$Eu(t,i);n!==void 0&&this._$Eh.set(n,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){let t=[];if(Array.isArray(e)){let i=new Set(e.flat(1/0).reverse());for(let n of i)t.unshift(BT(n))}else e!==void 0&&t.push(BT(e));return t}static _$Eu(e,t){let i=t.attribute;return i===!1?void 0:typeof i=="string"?i:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$ES=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach(t=>t(this))}addController(e){var t;(this._$EO??(this._$EO=new Set)).add(e),this.renderRoot!==void 0&&this.isConnected&&((t=e.hostConnected)==null||t.call(e))}removeController(e){var t;(t=this._$EO)==null||t.delete(e)}_$E_(){let e=new Map,t=this.constructor.elementProperties;for(let i of t.keys())this.hasOwnProperty(i)&&(e.set(i,this[i]),delete this[i]);e.size>0&&(this._$Ep=e)}createRenderRoot(){let e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return C6(e,this.constructor.elementStyles),e}connectedCallback(){var e;this.renderRoot??(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(e=this._$EO)==null||e.forEach(t=>{var i;return(i=t.hostConnected)==null?void 0:i.call(t)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$EO)==null||e.forEach(t=>{var i;return(i=t.hostDisconnected)==null?void 0:i.call(t)})}attributeChangedCallback(e,t,i){this._$AK(e,i)}_$EC(e,t){var i;let n=this.constructor.elementProperties.get(e),r=this.constructor._$Eu(e,n);if(r!==void 0&&n.reflect===!0){let o=(((i=n.converter)==null?void 0:i.toAttribute)!==void 0?n.converter:hm).toAttribute(t,n.type);this._$Em=e,o==null?this.removeAttribute(r):this.setAttribute(r,o),this._$Em=null}}_$AK(e,t){var i;let n=this.constructor,r=n._$Eh.get(e);if(r!==void 0&&this._$Em!==r){let o=n.getPropertyOptions(r),a=typeof o.converter=="function"?{fromAttribute:o.converter}:((i=o.converter)==null?void 0:i.fromAttribute)!==void 0?o.converter:hm;this._$Em=r,this[r]=a.fromAttribute(t,o.type),this._$Em=null}}requestUpdate(e,t,i){if(e!==void 0){if(i??(i=this.constructor.getPropertyOptions(e)),!(i.hasChanged??s_)(this[e],t))return;this.P(e,t,i)}this.isUpdatePending===!1&&(this._$ES=this._$ET())}P(e,t,i){this._$AL.has(e)||this._$AL.set(e,t),i.reflect===!0&&this._$Em!==e&&(this._$Ej??(this._$Ej=new Set)).add(e)}_$ET(){return ie(this,null,function*(){this.isUpdatePending=!0;try{yield this._$ES}catch(t){Promise.reject(t)}let e=this.scheduleUpdate();return e!=null&&(yield e),!this.isUpdatePending})}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??(this.renderRoot=this.createRenderRoot()),this._$Ep){for(let[r,o]of this._$Ep)this[r]=o;this._$Ep=void 0}let n=this.constructor.elementProperties;if(n.size>0)for(let[r,o]of n)o.wrapped!==!0||this._$AL.has(r)||this[r]===void 0||this.P(r,this[r],o)}let t=!1,i=this._$AL;try{t=this.shouldUpdate(i),t?(this.willUpdate(i),(e=this._$EO)==null||e.forEach(n=>{var r;return(r=n.hostUpdate)==null?void 0:r.call(n)}),this.update(i)):this._$EU()}catch(n){throw t=!1,this._$EU(),n}t&&this._$AE(i)}willUpdate(e){}_$AE(e){var t;(t=this._$EO)==null||t.forEach(i=>{var n;return(n=i.hostUpdated)==null?void 0:n.call(i)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Ej&&(this._$Ej=this._$Ej.forEach(t=>this._$EC(t,this[t]))),this._$EU()}updated(e){}firstUpdated(e){}};Lo.elementStyles=[],Lo.shadowRootOptions={mode:"open"},Lo[Td("elementProperties")]=new Map,Lo[Td("finalized")]=new Map,VT?.({ReactiveElement:Lo}),(Tc.reactiveElementVersions??(Tc.reactiveElementVersions=[])).push("2.0.4");var Fo=class extends Lo{constructor(){super(...arguments),this.renderOptions={host:this},this.o=void 0}createRenderRoot(){var e;let t=super.createRenderRoot();return(e=this.renderOptions).renderBefore??(e.renderBefore=t.firstChild),t}update(e){let t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this.o=b6(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this.o)==null||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this.o)==null||e.setConnected(!1)}render(){return Sc}},HT;Fo._$litElement$=!0,Fo.finalized=!0,(HT=globalThis.litElementHydrateSupport)==null||HT.call(globalThis,{LitElement:Fo});var GT=globalThis.litElementPolyfillSupport;GT?.({LitElement:Fo});(globalThis.litElementVersions??(globalThis.litElementVersions=[])).push("4.1.0");var M6={attribute:!0,type:String,converter:hm,reflect:!1,hasChanged:s_},R6=(s=M6,e,t)=>{let{kind:i,metadata:n}=t,r=globalThis.litPropertyMetadata.get(n);if(r===void 0&&globalThis.litPropertyMetadata.set(n,r=new Map),r.set(t.name,s),i==="accessor"){let{name:o}=t;return{set(a){let l=e.get.call(this);e.set.call(this,a),this.requestUpdate(o,l,s)},init(a){return a!==void 0&&this.P(o,void 0,s),a}}}if(i==="setter"){let{name:o}=t;return function(a){let l=this[o];e.call(this,a),this.requestUpdate(o,l,s)}}throw Error("Unsupported decorator location: "+i)};function Wn(s){return(e,t)=>typeof t=="object"?R6(s,e,t):((i,n,r)=>{let o=n.hasOwnProperty(r);return n.constructor.createProperty(r,o?yt(Se({},i),{wrapped:!0}):i),o?Object.getOwnPropertyDescriptor(n,r):void 0})(s,e,t)}function D6(s){return Wn(yt(Se({},s),{state:!0,attribute:!1}))}var Ny=class extends Gs{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Bt(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this.center=e.center,this}};new ce;new lt;new lt;new ce;new ce;var Uy=class{constructor(e,t){this._group=new qs,this._frustum=new Gw,this._frustumMat=new lt,this._regenerateDelay=200,this._regenerateCounter=0,this.material=new Mn({color:"#2e3338"}),this.numbers=new qs,this.maxRegenerateRetrys=4,this.gridsFactor=5,this._scaleX=1,this._scaleY=1,this._offsetX=0,this._offsetY=0,this._camera=e,this._container=t;let i=this.newGrid(-1),n=this.newGrid(-2);this.grids={main:i,secondary:n},this._group.add(n,i,this.numbers)}set scaleX(e){this._scaleX=e,this.regenerate()}get scaleX(){return this._scaleX}set scaleY(e){this._scaleY=e,this.regenerate()}get scaleY(){return this._scaleY}set offsetX(e){this._offsetX=e,this.regenerate()}get offsetX(){return this._offsetX}set offsetY(e){this._offsetY=e,this.regenerate()}get offsetY(){return this._offsetY}get(){return this._group}dispose(){let{main:e,secondary:t}=this.grids;e.removeFromParent(),t.removeFromParent(),e.geometry.dispose(),e.material.dispose(),t.geometry.dispose(),t.material.dispose()}regenerate(){if(!this.isGridReady()){if(this._regenerateCounter++,this._regenerateCounter>this.maxRegenerateRetrys)throw new Error("Grid could not be regenerated");setTimeout(()=>this.regenerate,this._regenerateDelay);return}this._regenerateCounter=0,this._camera.updateMatrix(),this._camera.updateMatrixWorld();let e=this._frustumMat.multiplyMatrices(this._camera.projectionMatrix,this._camera.matrixWorldInverse);this._frustum.setFromProjectionMatrix(e);let{planes:t}=this._frustum,i=t[0].constant*-t[0].normal.x,n=t[1].constant*-t[1].normal.x,r=t[2].constant*-t[2].normal.y,o=t[3].constant*-t[3].normal.y,a=Math.abs(i-n),l=Math.abs(o-r),{clientWidth:c,clientHeight:d}=this._container,h=Math.max(c,d),u=Math.max(a,l)/h,p=Math.ceil(Math.log10(a/this.scaleX)),f=Math.ceil(Math.log10(l/this.scaleY)),m=10**(p-2)*this.scaleX,g=10**(f-2)*this.scaleY,b=m*this.gridsFactor,v=g*this.gridsFactor,E=Math.ceil(l/v),y=Math.ceil(a/b),w=Math.ceil(l/g),C=Math.ceil(a/m),A=m*Math.ceil(n/m),D=g*Math.ceil(r/g),M=b*Math.ceil(n/b),I=v*Math.ceil(r/v),O=[...this.numbers.children];for(let W of O)W.removeFromParent();this.numbers.children=[];let F=[],V=9*u,x=1e4,N=M+this._offsetX,z=Math.round(Math.abs(N/this.scaleX)*x)/x,G=(y-1)*b,X=Math.round(Math.abs((N+G)/this.scaleX)*x)/x,k=Math.max(z,X).toString().length*V,B=Math.ceil(k/b)*b;for(let W=0;W<y;W++){let Q=M+W*b;F.push(Q,o,0,Q,r,0),Q=Math.round(Q*x)/x,B=Math.round(B*x)/x;let te=Q%B;if(!(b<1||v<1)&&Math.abs(te)>.01)continue;let J=this.newNumber((Q+this._offsetX)/this.scaleX),oe=12*u;J.position.set(Q,r+oe,0)}for(let W=0;W<E;W++){let Q=I+W*v;F.push(n,Q,0,i,Q,0);let te=this.newNumber(Q/this.scaleY),J=12;te.element.textContent&&(J+=4*te.element.textContent.length);let oe=J*u;te.position.set(n+oe,Q,0)}let R=[];for(let W=0;W<C;W++){let Q=A+W*m;R.push(Q,o,0,Q,r,0)}for(let W=0;W<w;W++){let Q=D+W*g;R.push(n,Q,0,i,Q,0)}let j=new Ti(new Float32Array(F),3),$=new Ti(new Float32Array(R),3),{main:T,secondary:U}=this.grids;T.geometry.setAttribute("position",j),U.geometry.setAttribute("position",$)}newNumber(e){let t=document.createElement("bim-label");t.textContent=String(Math.round(e*100)/100);let i=new Ny(t);return this.numbers.add(i),i}newGrid(e){let t=new kt,i=new Ou(t,this.material);return i.frustumCulled=!1,i.renderOrder=e,i}isGridReady(){let e=this._camera.projectionMatrix.elements;for(let t=0;t<e.length;t++){let i=e[t];if(Number.isNaN(i))return!1}return!0}},L6=Object.defineProperty,F6=Object.getOwnPropertyDescriptor,Zd=(s,e,t,i)=>{for(var n=F6(e,t),r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&L6(e,t,n),n},RO=class extends Fo{constructor(){super(...arguments),this._grid=null,this._world=null,this.resize=()=>{this._world&&this._grid&&this._grid.regenerate()}}set gridColor(e){if(this._gridColor=e,!(e&&this._grid))return;let t=Number(e.replace("#","0x"));Number.isNaN(t)||this._grid.material.color.setHex(t)}get gridColor(){return this._gridColor}set gridScaleX(e){this._gridScaleX=e,e&&this._grid&&(this._grid.scaleX=e)}get gridScaleX(){return this._gridScaleX}set gridScaleY(e){this._gridScaleY=e,e&&this._grid&&(this._grid.scaleY=e)}get gridScaleY(){return this._gridScaleY}get gridOffsetX(){var e;return((e=this._grid)==null?void 0:e.offsetX)||0}set gridOffsetX(e){this._grid&&(this._grid.offsetX=e)}get gridOffsetY(){var e;return((e=this._grid)==null?void 0:e.offsetY)||0}set gridOffsetY(e){this._grid&&(this._grid.offsetY=e)}set components(e){this.dispose();let t=e.get(Hi).create();this._world=t,t.scene=new ju(e),t.scene.setup(),t.renderer=new kh(e,this);let i=new aa(e);t.camera=i;let n=new Uy(i.threeOrtho,this);this._grid=n,t.scene.three.add(n.get()),i.controls.addEventListener("update",()=>n.regenerate()),setTimeout(()=>ie(this,null,function*(){t.camera.updateAspect(),i.set("Plan"),yield i.controls.setLookAt(0,0,100,0,0,0),yield i.projection.set("Orthographic"),i.controls.dollySpeed=3,i.controls.draggingSmoothTime=.085,i.controls.maxZoom=1e3,i.controls.zoom(4)}))}get world(){return this._world}dispose(){var e;(e=this.world)==null||e.dispose(),this._world=null,this._grid=null}connectedCallback(){super.connectedCallback(),new ResizeObserver(this.resize).observe(this)}disconnectedCallback(){super.disconnectedCallback(),this.dispose()}render(){return TO`<slot></slot>`}};RO.styles=MO`
    :host {
      position: relative;
      display: flex;
      min-width: 0px;
      height: 100%;
      background-color: var(--bim-ui_bg-base);
    }
  `;var Uc=RO;Zd([Wn({type:String,attribute:"grid-color",reflect:!0})],Uc.prototype,"gridColor");Zd([Wn({type:Number,attribute:"grid-scale-x",reflect:!0})],Uc.prototype,"gridScaleX");Zd([Wn({type:Number,attribute:"grid-scale-y",reflect:!0})],Uc.prototype,"gridScaleY");Zd([Wn({type:Number,attribute:"grid-offset-x",reflect:!0})],Uc.prototype,"gridOffsetX");Zd([Wn({type:Number,attribute:"grid-offset-y",reflect:!0})],Uc.prototype,"gridOffsetY");var k6=Object.defineProperty,Ho=(s,e,t,i)=>{for(var n=void 0,r=s.length-1,o;r>=0;r--)(o=s[r])&&(n=o(e,t,n)||n);return n&&k6(e,t,n),n},DO=class extends Fo{constructor(){super(...arguments),this._defaults={size:60},this._cssMatrix3D="",this._matrix=new lt,this._onRightClick=new Event("rightclick"),this._onLeftClick=new Event("leftclick"),this._onTopClick=new Event("topclick"),this._onBottomClick=new Event("bottomclick"),this._onFrontClick=new Event("frontclick"),this._onBackClick=new Event("backclick"),this._camera=null,this._epsilon=e=>Math.abs(e)<1e-10?0:e}set camera(e){this._camera=e,this.updateOrientation()}get camera(){return this._camera}updateOrientation(){if(!this.camera)return;this._matrix.extractRotation(this.camera.matrixWorldInverse);let{elements:e}=this._matrix;this._cssMatrix3D=`matrix3d(
      ${this._epsilon(e[0])},
      ${this._epsilon(-e[1])},
      ${this._epsilon(e[2])},
      ${this._epsilon(e[3])},
      ${this._epsilon(e[4])},
      ${this._epsilon(-e[5])},
      ${this._epsilon(e[6])},
      ${this._epsilon(e[7])},
      ${this._epsilon(e[8])},
      ${this._epsilon(-e[9])},
      ${this._epsilon(e[10])},
      ${this._epsilon(e[11])},
      ${this._epsilon(e[12])},
      ${this._epsilon(-e[13])},
      ${this._epsilon(e[14])},
      ${this._epsilon(e[15])})
    `}render(){let e=this.size??this._defaults.size;return TO`
      <style>
        .face,
        .cube {
          width: ${e}px;
          height: ${e}px;
          transform: translateZ(-300px) ${this._cssMatrix3D};
        }

        .face-right {
          translate: ${e/2}px 0 0;
        }

        .face-left {
          translate: ${-e/2}px 0 0;
        }

        .face-top {
          translate: 0 ${e/2}px 0;
        }

        .face-bottom {
          translate: 0 ${-e/2}px 0;
        }

        .face-front {
          translate: 0 0 ${e/2}px;
        }

        .face-back {
          translate: 0 0 ${-e/2}px;
        }
      </style>
      <div class="parent">
        <div class="cube">
          <div
            class="face x-direction face-right"
            @click=${()=>this.dispatchEvent(this._onRightClick)}
          >
            ${this.rightText}
          </div>
          <div
            class="face x-direction face-left"
            @click=${()=>this.dispatchEvent(this._onLeftClick)}
          >
            ${this.leftText}
          </div>
          <div
            class="face y-direction face-top"
            @click=${()=>this.dispatchEvent(this._onTopClick)}
          >
            ${this.topText}
          </div>
          <div
            class="face y-direction face-bottom"
            @click=${()=>this.dispatchEvent(this._onBottomClick)}
          >
            ${this.bottomText}
          </div>
          <div
            class="face z-direction face-front"
            @click=${()=>this.dispatchEvent(this._onFrontClick)}
          >
            ${this.frontText}
          </div>
          <div
            class="face z-direction face-back"
            @click=${()=>this.dispatchEvent(this._onBackClick)}
          >
            ${this.backText}
          </div>
        </div>
      </div>
    `}};DO.styles=MO`
    :host {
      position: absolute;
      z-index: 999;
      bottom: 1rem;
      right: 1rem;
    }

    .parent {
      perspective: 400px;
    }

    .cube {
      position: relative;
      transform-style: preserve-3d;
    }

    .face {
      position: absolute;
      display: flex;
      justify-content: center;
      user-select: none;
      align-items: center;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
      color: var(--bim-view-cube--c, white);
      font-size: var(--bim-view-cube--fz, --bim-ui_size-2xl);
    }

    .x-direction {
      // background-color: var(--bim-view-cube_x--bgc, #c93830DD);
      background-color: var(--bim-view-cube_x--bgc, #01a6bcde);
    }

    .x-direction:hover {
      background-color: var(--bim-ui_accent-base, white);
    }

    .y-direction {
      // background-color: var(--bim-view-cube_y--bgc, #54ff19DD);
      background-color: var(--bim-view-cube_y--bgc, #8d0ec8de);
    }

    .y-direction:hover {
      background-color: var(--bim-ui_accent-base, white);
    }

    .z-direction {
      // background-color: var(--bim-view-cube_z--bgc, #3041c9DD);
      background-color: var(--bim-view-cube_z--bgc, #2718afde);
    }

    .z-direction:hover {
      background-color: var(--bim-ui_accent-base, white);
    }

    .face-front {
      transform: rotateX(180deg);
    }

    .face-back {
      transform: rotateZ(180deg);
    }

    .face-top {
      transform: rotateX(90deg);
    }

    .face-bottom {
      transform: rotateX(270deg);
    }

    .face-right {
      transform: rotateY(-270deg) rotateX(180deg);
    }

    .face-left {
      transform: rotateY(-90deg) rotateX(180deg);
    }
  `;var zr=DO;Ho([Wn({type:Number,reflect:!0})],zr.prototype,"size");Ho([Wn({type:String,attribute:"right-text",reflect:!0})],zr.prototype,"rightText");Ho([Wn({type:String,attribute:"left-text",reflect:!0})],zr.prototype,"leftText");Ho([Wn({type:String,attribute:"top-text",reflect:!0})],zr.prototype,"topText");Ho([Wn({type:String,attribute:"bottom-text",reflect:!0})],zr.prototype,"bottomText");Ho([Wn({type:String,attribute:"front-text",reflect:!0})],zr.prototype,"frontText");Ho([Wn({type:String,attribute:"back-text",reflect:!0})],zr.prototype,"backText");Ho([D6()],zr.prototype,"_cssMatrix3D");var dm=class{static init(){Iy.defineCustomElement("bim-view-cube",zr),Iy.defineCustomElement("bim-world-2d",Uc)}};var N6=["cube"];function U6(s,e){if(s&1&&_t(0,"bim-view-cube",2,0),s&2){let t=Ze();$r("--bim-view-cube_x--bgc",t.backgroundColorX)("--bim-view-cube_y--bgc",t.backgroundColorY)("--bim-view-cube_z--bgc",t.backgroundColorZ),Le("size",t.size)("topText",t.settings.labels.navCube.topText)("bottomText",t.settings.labels.navCube.bottomText)("frontText",t.settings.labels.navCube.frontText)("backText",t.settings.labels.navCube.backText)("leftText",t.settings.labels.navCube.leftText)("rightText",t.settings.labels.navCube.rightText)}}var LO=(()=>{let e=class e{set cube(i){i&&(this._navCube=i.nativeElement,this._initEventListeners())}constructor(){this._service=qe(yn),this._state=qe(vt),this.size=80,this.settings=new qt,this.backgroundColorX="#07C8CC",this.backgroundColorY="#0D5BE9",this.backgroundColorZ="#CEE602",dm.init(),Gt(()=>{this._service.world()!==void 0&&(this._navCube.camera=this._service.world()?.camera.three,this._initEventListeners())})}_initEventListeners(){let i=this._service.world();i!==void 0&&(i.camera?.controls?.addEventListener("update",()=>this._navCube.updateOrientation()),this._navCube.addEventListener("topclick",()=>ie(this,null,function*(){yield this._setCam(0,100,0)})),this._navCube.addEventListener("bottomclick",()=>ie(this,null,function*(){yield this._setCam(0,-100,0)})),this._navCube.addEventListener("frontclick",()=>ie(this,null,function*(){yield this._setCam(0,0,100)})),this._navCube.addEventListener("backclick",()=>ie(this,null,function*(){yield this._setCam(0,0,-100)})),this._navCube.addEventListener("rightclick",()=>ie(this,null,function*(){yield this._setCam(100,0,0)})),this._navCube.addEventListener("leftclick",()=>ie(this,null,function*(){yield this._setCam(-100,0,0)})))}_setCam(i,n,r){return ie(this,null,function*(){let o=this._service.world()?.camera.controls;o!==void 0&&(yield o.setLookAt(i,n,r,0,0,0,!0),this._fit())})}_fit(){let i=this._service.world(),n=i?.camera;n===void 0||i===void 0||n instanceof aa&&i.meshes.size>0&&n.fit(i.meshes,.5)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-nav-cube"]],viewQuery:function(n,r){if(n&1&&fi(N6,5),n&2){let o;mi(o=gi())&&(r.cube=o.first)}},inputs:{size:"size",settings:"settings",backgroundColorX:"backgroundColorX",backgroundColorY:"backgroundColorY",backgroundColorZ:"backgroundColorZ"},standalone:!0,features:[st],decls:1,vars:1,consts:[["cube",""],["style","right: -0.3rem; bottom: -0.3rem; transform: scale(0.7);",3,"size","topText","bottomText","frontText","backText","leftText","rightText","--bim-view-cube_x--bgc","--bim-view-cube_y--bgc","--bim-view-cube_z--bgc",4,"ngIf"],[2,"right","-0.3rem","bottom","-0.3rem","transform","scale(0.7)",3,"size","topText","bottomText","frontText","backText","leftText","rightText"]],template:function(n,r){n&1&&dt(0,U6,2,13,"bim-view-cube",1),n&2&&Le("ngIf",r.settings.visibility.showNavCube)},dependencies:[at,bt],encapsulation:2});let s=e;return s})();var FO=(()=>{let e=class e{constructor(){this._service=qe(yn),this.settings=new Gh,this._appended=!1}ngOnInit(){this._updateFrame()}ngOnChanges(){this._updateFrame()}ngOnDestroy(){let i=this._service.components.get(Ds).culler.renderer.domElement;document.body.removeChild(i)}_updateFrame(){return ie(this,null,function*(){yield Uf(1e3);let i=this._service.components.get(Ds);if(i.culler.renderDebugFrame=this.settings.showDebugFrame,!this._appended){let n=i.culler.renderer.domElement;document.body.appendChild(n),n.style.position="fixed",n.style.left="0",n.style.bottom="0",this._appended=!0}})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-debug-frame"]],inputs:{settings:"settings"},standalone:!0,features:[Tn,st],decls:0,vars:0,template:function(n,r){},encapsulation:2});let s=e;return s})();var Dn=Cs(o_()),ln=Cs(VO());function jO(s,e){let t=new s.EventBus;return B6(t,e),t}function B6(s,e){Ai(s,"documentload").pipe(ai(e)).subscribe(()=>{let t=document.createEvent("CustomEvent");t.initCustomEvent("documentload",!0,!0,{}),window.dispatchEvent(t)}),Ai(s,"pagerendered").pipe(ai(e)).subscribe(({pageNumber:t,cssTransform:i,source:n})=>{let r=document.createEvent("CustomEvent");r.initCustomEvent("pagerendered",!0,!0,{pageNumber:t,cssTransform:i}),n.div.dispatchEvent(r)}),Ai(s,"textlayerrendered").pipe(ai(e)).subscribe(({pageNumber:t,source:i})=>{let n=document.createEvent("CustomEvent");n.initCustomEvent("textlayerrendered",!0,!0,{pageNumber:t}),i.textLayerDiv.dispatchEvent(n)}),Ai(s,"pagechanging").pipe(ai(e)).subscribe(({pageNumber:t,source:i})=>{let n=document.createEvent("UIEvents");n.initEvent("pagechanging",!0,!0),n.pageNumber=t,i.container.dispatchEvent(n)}),Ai(s,"pagesinit").pipe(ai(e)).subscribe(({source:t})=>{let i=document.createEvent("CustomEvent");i.initCustomEvent("pagesinit",!0,!0,null),t.container.dispatchEvent(i)}),Ai(s,"pagesloaded").pipe(ai(e)).subscribe(({pagesCount:t,source:i})=>{let n=document.createEvent("CustomEvent");n.initCustomEvent("pagesloaded",!0,!0,{pagesCount:t}),i.container.dispatchEvent(n)}),Ai(s,"scalechange").pipe(ai(e)).subscribe(({scale:t,presetValue:i,source:n})=>{let r=document.createEvent("UIEvents");r.initEvent("scalechange",!0,!0),r.scale=t,r.presetValue=i,n.container.dispatchEvent(r)}),Ai(s,"updateviewarea").pipe(ai(e)).subscribe(({location:t,source:i})=>{let n=document.createEvent("UIEvents");n.initEvent("updateviewarea",!0,!0),n.location=t,i.container.dispatchEvent(n)}),Ai(s,"find").pipe(ai(e)).subscribe(({source:t,type:i,query:n,phraseSearch:r,caseSensitive:o,highlightAll:a,findPrevious:l})=>{if(t===window)return;let c=document.createEvent("CustomEvent");c.initCustomEvent("find"+i,!0,!0,{query:n,phraseSearch:r,caseSensitive:o,highlightAll:a,findPrevious:l}),window.dispatchEvent(c)}),Ai(s,"attachmentsloaded").pipe(ai(e)).subscribe(({attachmentsCount:t,source:i})=>{let n=document.createEvent("CustomEvent");n.initCustomEvent("attachmentsloaded",!0,!0,{attachmentsCount:t}),i.container.dispatchEvent(n)}),Ai(s,"sidebarviewchanged").pipe(ai(e)).subscribe(({view:t,source:i})=>{let n=document.createEvent("CustomEvent");n.initCustomEvent("sidebarviewchanged",!0,!0,{view:t}),i.outerContainer.dispatchEvent(n)}),Ai(s,"pagemode").pipe(ai(e)).subscribe(({mode:t,source:i})=>{let n=document.createEvent("CustomEvent");n.initCustomEvent("pagemode",!0,!0,{mode:t}),i.pdfViewer.container.dispatchEvent(n)}),Ai(s,"namedaction").pipe(ai(e)).subscribe(({action:t,source:i})=>{let n=document.createEvent("CustomEvent");n.initCustomEvent("namedaction",!0,!0,{action:t}),i.pdfViewer.container.dispatchEvent(n)}),Ai(s,"presentationmodechanged").pipe(ai(e)).subscribe(({active:t,switchInProgress:i})=>{let n=document.createEvent("CustomEvent");n.initCustomEvent("presentationmodechanged",!0,!0,{active:t,switchInProgress:i}),window.dispatchEvent(n)}),Ai(s,"outlineloaded").pipe(ai(e)).subscribe(({outlineCount:t,source:i})=>{let n=document.createEvent("CustomEvent");n.initCustomEvent("outlineloaded",!0,!0,{outlineCount:t}),i.container.dispatchEvent(n)})}function xm(s,e,t){s[e]=t}function Bc(){return typeof window>"u"}function HO(s){let e=document.createElement("div");e.classList.add("bbox"),e.style.position="absolute",e.style.top=`${s.xywh.y}%`,e.style.left=`${s.xywh.x}%`,e.style.height=`${s.xywh.h}%`,e.style.width=`${s.xywh.w}%`;let t=document.createElement("div");if(t.style.position="relative",t.style.height="100%",t.style.width="100%",t.style.backgroundColor=s.color,t.style.pointerEvents=s.clickable?"all":"none",t.style.cursor=s.clickable?"pointer":"default",e.appendChild(t),s.label){let i=document.createElement("div");i.innerHTML=s.label,i.style.position="absolute",i.style.top="-1.2em",i.style.fontSize="0.8em",i.style.left="50%",i.style.transform="translateX(-50%)",i.style.color="black",i.style.textAnchor="start",e.appendChild(i)}return s.clickable&&t.addEventListener("click",i=>{s.onClick!==void 0&&s.onClick(s,i,e)}),t.addEventListener("mouseover",i=>{s.onHover!==void 0&&s.onHover(s,i,e)}),e}var Qd=function(s){return s[s.DISABLED=0]="DISABLED",s[s.ENABLED=1]="ENABLED",s[s.ENHANCED=2]="ENHANCED",s}(Qd||{});var z6=["pdfViewerContainer"];Bc()||xm(Dn,"verbosity",Dn.VerbosityLevel.INFOS);var GO=(()=>{let e=class e{set cMapsUrl(i){this._cMapsUrl=i}set page(i){i=parseInt(i,10)||1;let n=i;this._pdf&&(i=this._getValidPageNumber(i)),this._page=i,n!==i&&this.pageChange.emit(i)}set renderText(i){this._renderText=i}set renderTextMode(i){this._renderTextMode=i}set originalSize(i){this._originalSize=i}set showAll(i){this._showAll=i}set stickToPage(i){this._stickToPage=i}set zoom(i){i<=0||(this._zoom=i)}get zoom(){return this._zoom}set zoomScale(i){this._zoomScale=i}get zoomScale(){return this._zoomScale}set rotation(i){if(!(typeof i=="number"&&i%90===0)){console.warn("Invalid pages rotation angle.");return}this._rotation=i}set externalLinkTarget(i){this._externalLinkTarget=i}set autoresize(i){this._canAutoResize=!!i}set fitToPage(i){this._fitToPage=!!i}set showBorders(i){this._showBorders=!!i}static getLinkTarget(i){switch(i){case"blank":return ln.LinkTarget.BLANK;case"none":return ln.LinkTarget.NONE;case"self":return ln.LinkTarget.SELF;case"parent":return ln.LinkTarget.PARENT;case"top":return ln.LinkTarget.TOP}return null}constructor(i,n){if(this.element=i,this.ngZone=n,this._cdRef=qe(Iu),this.isVisible=!1,this._cMapsUrl=typeof Dn<"u"?`https://unpkg.com/pdfjs-dist@${Dn.version}/cmaps/`:null,this._imageResourcesPath=typeof Dn<"u"?`https://unpkg.com/pdfjs-dist@${Dn.version}/web/images/`:void 0,this._renderText=!0,this._renderTextMode=Qd.ENABLED,this._stickToPage=!1,this._originalSize=!0,this._page=1,this._zoom=1,this._zoomScale="page-width",this._rotation=0,this._showAll=!0,this._canAutoResize=!0,this._fitToPage=!1,this._externalLinkTarget="blank",this._showBorders=!1,this.pageScrollTimeout=null,this.isInitialized=!1,this.destroy$=new pi,this._document=qe(al),this._bboxes=[],this.afterLoadComplete=new Vt,this.pageRendered=new Vt,this.pageInitialized=new Vt,this.textLayerRendered=new Vt,this.loadingError=new Vt,this.loadingProgress=new Vt,this.pageChange=new Vt(!0),this.annotations=[],Bc())return;let r,o=Dn.version,a=window[`pdfWorkerSrc${o}`];a?r=a:window.hasOwnProperty("pdfWorkerSrc")&&typeof window.pdfWorkerSrc=="string"&&window.pdfWorkerSrc?r=window.pdfWorkerSrc:r=`https://cdn.jsdelivr.net/npm/pdfjs-dist@${o}/legacy/build/pdf.worker.min.js`,xm(Dn.GlobalWorkerOptions,"workerSrc",r)}ngAfterViewChecked(){if(this.isInitialized)return;let i=this.pdfViewerContainer.nativeElement.offsetParent;if(this.isVisible===!0&&i==null){this.isVisible=!1;return}this.isVisible===!1&&i!=null&&(this.isVisible=!0,setTimeout(()=>{this._initialize(),this.ngOnChanges({src:this.src,annotations:this.annotations})}))}ngOnInit(){this._initialize(),this._setupResizeListener()}ngOnDestroy(){this.clear(),this.destroy$.next(),this.loadingTask=null}ngOnChanges(i){if(!(Bc()||!this.isVisible)){if("src"in i)this._loadPDF();else if(this._pdf){if("renderText"in i?(this.pdfViewer.textLayerMode=this._renderText?this._renderTextMode:Qd.DISABLED,this._resetPdfDocument()):"showAll"in i&&(this._setupViewer(),this._resetPdfDocument()),"page"in i){let{page:n}=i;if(n.currentValue===this._latestScrolledPage)return;this.pdfViewer.scrollPageIntoView({pageNumber:this._page})}"annotations"in i&&this._setAnnotations(),this._update()}}}updateSize(){ag(this._pdf.getPage(this.pdfViewer.currentPageNumber)).pipe(ai(this.destroy$)).subscribe({next:i=>{let n=this._rotation+i.rotate,r=i.getViewport({scale:this._zoom,rotation:n}).width*e.CSS_UNITS,o=this._zoom,a=!0;if(!this._originalSize||this._fitToPage&&r>this.pdfViewerContainer.nativeElement.clientWidth){let l=i.getViewport({scale:1,rotation:n});o=this._getScale(l.width,l.height),a=!this._stickToPage}this.pdfViewer._setScale(o,a)}})}clear(){this.loadingTask&&!this.loadingTask.destroyed&&this.loadingTask.destroy(),this._pdf&&(this._latestScrolledPage=0,this._pdf.destroy(),this._pdf=void 0),this.pdfViewer&&this.pdfViewer.setDocument(null),this.pdfLinkService&&this.pdfLinkService.setDocument(null,null),this.pdfFindController&&this.pdfFindController.setDocument(null)}_setAnnotations(){return ie(this,null,function*(){let i=this.annotations;if(this._clearAnnotations(),!i.length||this._pdf===void 0)return;let{pageNumber:n,xywh:r}=i[0],o=yield this._pdf?.getPage(n),a=this._getDestArray(r,o);this.pdfViewer.scrollPageIntoView({pageNumber:n,destArray:a});let l=this._document.getElementsByClassName("page");for(let c in l){let d=l[c],h=parseInt(c)+1;i.filter(p=>p.pageNumber===h).forEach(p=>{let f=HO(p);this._bboxes.push(f),d.appendChild(f),this._cdRef.detectChanges()})}})}_clearAnnotations(){this._bboxes.forEach(i=>{let n=i.parentNode;n&&n.removeChild(i)}),this._bboxes=[]}_getPDFLinkServiceConfig(){let i=e.getLinkTarget(this._externalLinkTarget);return i?{externalLinkTarget:i}:{}}_initEventBus(){this.eventBus=jO(ln,this.destroy$),Ai(this.eventBus,"pagerendered").pipe(ai(this.destroy$)).subscribe(i=>{this.pageRendered.emit(i)}),Ai(this.eventBus,"pagesinit").pipe(ai(this.destroy$)).subscribe(i=>{this.pageInitialized.emit(i)}),Ai(this.eventBus,"pagechanging").pipe(ai(this.destroy$)).subscribe(({pageNumber:i})=>{this.pageScrollTimeout&&clearTimeout(this.pageScrollTimeout),this.pageScrollTimeout=window.setTimeout(()=>{this._latestScrolledPage=i,this.pageChange.emit(i)},100)}),Ai(this.eventBus,"textlayerrendered").pipe(ai(this.destroy$)).subscribe(i=>{this.textLayerRendered.emit(i),this._setAnnotations()})}_initPDFServices(){this.pdfLinkService=new ln.PDFLinkService(Se({eventBus:this.eventBus},this._getPDFLinkServiceConfig())),this.pdfFindController=new ln.PDFFindController({eventBus:this.eventBus,linkService:this.pdfLinkService})}_getPDFOptions(){return{eventBus:this.eventBus,container:this.element.nativeElement.querySelector("div"),removePageBorders:!this._showBorders,linkService:this.pdfLinkService,textLayerMode:this._renderText?this._renderTextMode:Qd.DISABLED,findController:this.pdfFindController,l10n:new ln.GenericL10n("en"),imageResourcesPath:this._imageResourcesPath}}_setupViewer(){xm(Dn,"disableTextLayer",!this._renderText),this._initPDFServices(),this._showAll?this.pdfViewer=new ln.PDFViewer(this._getPDFOptions()):this.pdfViewer=new ln.PDFSinglePageViewer(this._getPDFOptions()),this.pdfLinkService.setViewer(this.pdfViewer),this.pdfViewer._currentPageNumber=this._page}_getValidPageNumber(i){return i<1?1:i>this._pdf.numPages?this._pdf.numPages:i}_getDocumentParams(){let i=typeof this.src;if(!this._cMapsUrl)return this.src;let n={cMapUrl:this._cMapsUrl,cMapPacked:!0,enableXfa:!0};return i==="string"?n.url=this.src:i==="object"&&(this.src.byteLength!==void 0?n.data=this.src:Object.assign(n,this.src)),n}_loadPDF(){if(!this.src)return;if(this.lastLoaded===this.src){this._update();return}this.clear(),this._setupViewer(),this.loadingTask=Dn.getDocument(this._getDocumentParams()),this.loadingTask.onProgress=n=>{this.loadingProgress.emit(n)};let i=this.src;ag(this.loadingTask.promise).pipe(ai(this.destroy$)).subscribe({next:n=>{this._pdf=n,this.lastLoaded=i,this.afterLoadComplete.emit(n),this._resetPdfDocument(),this._update()},error:n=>{this.lastLoaded=null,this.loadingError.emit(n)}})}_update(){this.page=this._page,this._render()}_render(){this._page=this._getValidPageNumber(this._page),(this._rotation!==0||this.pdfViewer.pagesRotation!==this._rotation)&&setTimeout(()=>{this.pdfViewer.pagesRotation=this._rotation}),this._stickToPage&&setTimeout(()=>{this.pdfViewer.currentPageNumber=this._page}),this.updateSize()}_getScale(i,n){let r=this._showBorders?2*e.BORDER_WIDTH:0,o=this.pdfViewerContainer.nativeElement.clientWidth-r,a=this.pdfViewerContainer.nativeElement.clientHeight-r;if(a===0||n===0||o===0||i===0)return 1;let l=1;switch(this._zoomScale){case"page-fit":l=Math.min(a/n,o/i);break;case"page-height":l=a/n;break;case"page-width":default:l=o/i;break}return this._zoom*l/e.CSS_UNITS}_getDestArray(i,n,r=5){let o=n.view[3],c=(100-i.y+r)*o/100;return[void 0,{name:"XYZ"},0,c]}_resetPdfDocument(){this.pdfLinkService.setDocument(this._pdf,null),this.pdfFindController.setDocument(this._pdf),this.pdfViewer.setDocument(this._pdf)}_initialize(){Bc()||!this.isVisible||(this.isInitialized=!0,this._initEventBus(),this._setupViewer())}_setupResizeListener(){Bc()||this.ngZone.runOutsideAngular(()=>{Ai(window,"resize").pipe(pw(100),uw(()=>this._canAutoResize&&!!this._pdf),ai(this.destroy$)).subscribe(()=>{this.updateSize()})})}};e.CSS_UNITS=96/72,e.BORDER_WIDTH=9,e.\u0275fac=function(n){return new(n||e)(Qi(eh),Qi(ol))},e.\u0275cmp=nt({type:e,selectors:[["lib-pdf-viewer"]],viewQuery:function(n,r){if(n&1&&fi(z6,5),n&2){let o;mi(o=gi())&&(r.pdfViewerContainer=o.first)}},inputs:{src:"src",annotations:"annotations",cMapsUrl:"cMapsUrl",page:"page",renderText:"renderText",renderTextMode:"renderTextMode",originalSize:"originalSize",showAll:"showAll",stickToPage:"stickToPage",zoom:"zoom",zoomScale:"zoomScale",rotation:"rotation",externalLinkTarget:"externalLinkTarget",autoresize:"autoresize",fitToPage:"fitToPage",showBorders:"showBorders"},outputs:{afterLoadComplete:"afterLoadComplete",pageRendered:"pageRendered",pageInitialized:"pageInitialized",textLayerRendered:"textLayerRendered",loadingError:"loadingError",loadingProgress:"loadingProgress",pageChange:"pageChange"},standalone:!0,features:[Tn,st],decls:3,vars:0,consts:[["pdfViewerContainer",""],[1,"ng2-pdf-viewer-container"],[1,"pdfViewer"]],template:function(n,r){n&1&&(He(0,"div",1,0),_t(2,"div",2),We())},dependencies:[at],styles:[`.ng2-pdf-viewer-container[_ngcontent-%COMP%]{overflow-x:auto;position:absolute;height:100%;width:100%;-webkit-overflow-scrolling:touch}  .bbox{position:absolute;background-color:#ffff0080;pointer-events:none;box-shadow:#00000026 1.95px 1.95px 2.6px}  .bbox:hover{box-shadow:#0000004d 1.95px 1.95px 2.6px}[_nghost-%COMP%]{display:block;position:relative}[_nghost-%COMP%]    {--pdfViewer-padding-bottom: 0;--page-margin: 1px auto -8px;--page-border: 9px solid transparent;--spreadHorizontalWrapped-margin-LR: -3.5px;--viewer-container-height: 0;--annotation-unfocused-field-background: url("data:image/svg+xml;charset=UTF-8,<svg width='1px' height='1px' xmlns='http://www.w3.org/2000/svg'><rect width='100%' height='100%' style='fill:rgba(0, 54, 255, 0.13);'/></svg>");--xfa-unfocused-field-background: var( --annotation-unfocused-field-background );--page-border-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAA1ElEQVQ4jbWUWw6EIAxFy2NFs/8NzR4UJhpqLsdi5mOmSSMUOfYWqv3S0gMr4XlYH/64gZa/gN3ANYA7KAXALt4ktoQ5MI9YxqaG8bWmsIysMuT6piSQCa4whZThCu8CM4zP9YJaKci9jicPq3NcBWYoPMGUlhG7ivtkB+gVyFY75wXghOvh8t5mto1Mdim6e+MBqH6XsY+YAwjpq3vGF7weTWQptLEDVCZvPTMl5JZZsdh47FHW6qFMyvLYqjcnmdFfY9Xk/KDOlzCusX2mi/ofM7MPkzBcSp4Q1/wAAAAASUVORK5CYII=) 9 9 repeat;--scale-factor: 1;--focus-outline: solid 2px blue;--hover-outline: dashed 2px blue;--freetext-line-height: 1.35;--freetext-padding: 2px;--editorInk-editing-cursor: pointer}@media screen and (forced-colors: active){[_nghost-%COMP%]    {--pdfViewer-padding-bottom: 9px;--page-margin: 8px auto -1px;--page-border: 1px solid CanvasText;--page-border-image: none;--spreadHorizontalWrapped-margin-LR: 3.5px}}@media (forced-colors: active){[_nghost-%COMP%]    {--focus-outline: solid 3px ButtonText;--hover-outline: dashed 3px ButtonText}}[_nghost-%COMP%]     .textLayer{position:absolute;text-align:initial;inset:0;overflow:hidden;opacity:.2;line-height:1;-webkit-text-size-adjust:none;-moz-text-size-adjust:none;text-size-adjust:none;forced-color-adjust:none}[_nghost-%COMP%]     .textLayer span, [_nghost-%COMP%]     .textLayer br{color:transparent;position:absolute;white-space:pre;cursor:text;transform-origin:0% 0%}[_nghost-%COMP%]     .textLayer span.markedContent{top:0;height:0}[_nghost-%COMP%]     .textLayer .highlight{margin:-1px;padding:1px;background-color:#b400aa;border-radius:4px}[_nghost-%COMP%]     .textLayer .highlight.appended{position:initial}[_nghost-%COMP%]     .textLayer .highlight.begin{border-radius:4px 0 0 4px}[_nghost-%COMP%]     .textLayer .highlight.end{border-radius:0 4px 4px 0}[_nghost-%COMP%]     .textLayer .highlight.middle{border-radius:0}[_nghost-%COMP%]     .textLayer .highlight.selected{background-color:#006400}[_nghost-%COMP%]     .textLayer ::-moz-selection{background:#00f}[_nghost-%COMP%]     .textLayer ::selection{background:#00f}[_nghost-%COMP%]     .textLayer br::-moz-selection{background:transparent}[_nghost-%COMP%]     .textLayer br::selection{background:transparent}[_nghost-%COMP%]     .textLayer .endOfContent{display:block;position:absolute;inset:100% 0 0;z-index:-1;cursor:default;-webkit-user-select:none;-moz-user-select:none;user-select:none}[_nghost-%COMP%]     .textLayer .endOfContent.active{top:0}@media (forced-colors: active){[_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation input:required, [_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation textarea:required, [_nghost-%COMP%]     .annotationLayer .choiceWidgetAnnotation select:required, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input:required, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.radioButton input:required{outline:1.5px solid selectedItem}}[_nghost-%COMP%]     .annotationLayer{position:absolute;top:0;left:0;pointer-events:none;transform-origin:0 0}[_nghost-%COMP%]     .annotationLayer section{position:absolute;text-align:initial;pointer-events:auto;box-sizing:border-box;transform-origin:0 0}[_nghost-%COMP%]     .annotationLayer .linkAnnotation>a, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.pushButton>a{position:absolute;font-size:1em;top:0;left:0;width:100%;height:100%}[_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.pushButton>canvas{width:100%;height:100%}[_nghost-%COMP%]     .annotationLayer .linkAnnotation>a:hover, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.pushButton>a:hover{opacity:.2;background:#ff0;box-shadow:0 2px 10px #ff0}[_nghost-%COMP%]     .annotationLayer .textAnnotation img{position:absolute;cursor:pointer;width:100%;height:100%}[_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation input, [_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation textarea, [_nghost-%COMP%]     .annotationLayer .choiceWidgetAnnotation select, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.radioButton input{background-image:var(--annotation-unfocused-field-background);border:1px solid transparent;box-sizing:border-box;font:calc(9px * var(--scale-factor)) sans-serif;height:100%;margin:0;vertical-align:top;width:100%}[_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation input:required, [_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation textarea:required, [_nghost-%COMP%]     .annotationLayer .choiceWidgetAnnotation select:required, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input:required, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.radioButton input:required{outline:1.5px solid red}[_nghost-%COMP%]     .annotationLayer .choiceWidgetAnnotation select option{padding:0}[_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.radioButton input{border-radius:50%}[_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation textarea{resize:none}[_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation input[disabled], [_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation textarea[disabled], [_nghost-%COMP%]     .annotationLayer .choiceWidgetAnnotation select[disabled], [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input[disabled], [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.radioButton input[disabled]{background:none;border:1px solid transparent;cursor:not-allowed}[_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation input:hover, [_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation textarea:hover, [_nghost-%COMP%]     .annotationLayer .choiceWidgetAnnotation select:hover, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input:hover, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.radioButton input:hover{border:1px solid rgb(0,0,0)}[_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation input:focus, [_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation textarea:focus, [_nghost-%COMP%]     .annotationLayer .choiceWidgetAnnotation select:focus{background:none;border:1px solid transparent}[_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation input :focus, [_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation textarea :focus, [_nghost-%COMP%]     .annotationLayer .choiceWidgetAnnotation select :focus, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox :focus, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.radioButton :focus{background-image:none;background-color:transparent;outline:auto}[_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input:checked:before, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input:checked:after, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.radioButton input:checked:before{background-color:CanvasText;content:"";display:block;position:absolute}[_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input:checked:before, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input:checked:after{height:80%;left:45%;width:1px}[_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input:checked:before{transform:rotate(45deg)}[_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input:checked:after{transform:rotate(-45deg)}[_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.radioButton input:checked:before{border-radius:50%;height:50%;left:30%;top:20%;width:50%}[_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation input.comb{font-family:monospace;padding-left:2px;padding-right:0}[_nghost-%COMP%]     .annotationLayer .textWidgetAnnotation input.comb:focus{width:103%}[_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.checkBox input, [_nghost-%COMP%]     .annotationLayer .buttonWidgetAnnotation.radioButton input{-webkit-appearance:none;-moz-appearance:none;appearance:none}[_nghost-%COMP%]     .annotationLayer .popupTriggerArea{height:100%;width:100%}[_nghost-%COMP%]     .annotationLayer .popupWrapper{position:absolute;font-size:calc(9px * var(--scale-factor));width:100%;min-width:calc(180px * var(--scale-factor));pointer-events:none}[_nghost-%COMP%]     .annotationLayer .popup{position:absolute;max-width:calc(180px * var(--scale-factor));background-color:#ff9;box-shadow:0 calc(2px * var(--scale-factor)) calc(5px * var(--scale-factor)) #888;border-radius:calc(2px * var(--scale-factor));padding:calc(6px * var(--scale-factor));margin-left:calc(5px * var(--scale-factor));cursor:pointer;font:message-box;white-space:normal;word-wrap:break-word;pointer-events:auto}[_nghost-%COMP%]     .annotationLayer .popup>*{font-size:calc(9px * var(--scale-factor))}[_nghost-%COMP%]     .annotationLayer .popup h1{display:inline-block}[_nghost-%COMP%]     .annotationLayer .popupDate{display:inline-block;margin-left:calc(5px * var(--scale-factor))}[_nghost-%COMP%]     .annotationLayer .popupContent{border-top:1px solid rgb(51,51,51);margin-top:calc(2px * var(--scale-factor));padding-top:calc(2px * var(--scale-factor))}[_nghost-%COMP%]     .annotationLayer .richText>*{white-space:pre-wrap;font-size:calc(9px * var(--scale-factor))}[_nghost-%COMP%]     .annotationLayer .highlightAnnotation, [_nghost-%COMP%]     .annotationLayer .underlineAnnotation, [_nghost-%COMP%]     .annotationLayer .squigglyAnnotation, [_nghost-%COMP%]     .annotationLayer .strikeoutAnnotation, [_nghost-%COMP%]     .annotationLayer .freeTextAnnotation, [_nghost-%COMP%]     .annotationLayer .lineAnnotation svg line, [_nghost-%COMP%]     .annotationLayer .squareAnnotation svg rect, [_nghost-%COMP%]     .annotationLayer .circleAnnotation svg ellipse, [_nghost-%COMP%]     .annotationLayer .polylineAnnotation svg polyline, [_nghost-%COMP%]     .annotationLayer .polygonAnnotation svg polygon, [_nghost-%COMP%]     .annotationLayer .caretAnnotation, [_nghost-%COMP%]     .annotationLayer .inkAnnotation svg polyline, [_nghost-%COMP%]     .annotationLayer .stampAnnotation, [_nghost-%COMP%]     .annotationLayer .fileAttachmentAnnotation{cursor:pointer}[_nghost-%COMP%]     .annotationLayer section svg{position:absolute;width:100%;height:100%}[_nghost-%COMP%]     .annotationLayer .annotationTextContent{position:absolute;width:100%;height:100%;opacity:0;color:transparent;-webkit-user-select:none;-moz-user-select:none;user-select:none;pointer-events:none}[_nghost-%COMP%]     .annotationLayer .annotationTextContent span{width:100%;display:inline-block}@media (forced-colors: active){[_nghost-%COMP%]     .xfaLayer *:required{outline:1.5px solid selectedItem}}[_nghost-%COMP%]     .xfaLayer .highlight{margin:-1px;padding:1px;background-color:#efcbed;border-radius:4px}[_nghost-%COMP%]     .xfaLayer .highlight.appended{position:initial}[_nghost-%COMP%]     .xfaLayer .highlight.begin{border-radius:4px 0 0 4px}[_nghost-%COMP%]     .xfaLayer .highlight.end{border-radius:0 4px 4px 0}[_nghost-%COMP%]     .xfaLayer .highlight.middle{border-radius:0}[_nghost-%COMP%]     .xfaLayer .highlight.selected{background-color:#cbdfcb}[_nghost-%COMP%]     .xfaLayer ::-moz-selection{background:#00f}[_nghost-%COMP%]     .xfaLayer ::selection{background:#00f}[_nghost-%COMP%]     .xfaPage{overflow:hidden;position:relative}[_nghost-%COMP%]     .xfaContentarea{position:absolute}[_nghost-%COMP%]     .xfaPrintOnly{display:none}[_nghost-%COMP%]     .xfaLayer{position:absolute;text-align:initial;top:0;left:0;transform-origin:0 0;line-height:1.2}[_nghost-%COMP%]     .xfaLayer *{color:inherit;font:inherit;font-style:inherit;font-weight:inherit;font-kerning:inherit;letter-spacing:-.01px;text-align:inherit;text-decoration:inherit;box-sizing:border-box;background-color:transparent;padding:0;margin:0;pointer-events:auto;line-height:inherit}[_nghost-%COMP%]     .xfaLayer *:required{outline:1.5px solid red}[_nghost-%COMP%]     .xfaLayer div{pointer-events:none}[_nghost-%COMP%]     .xfaLayer svg{pointer-events:none}[_nghost-%COMP%]     .xfaLayer svg *{pointer-events:none}[_nghost-%COMP%]     .xfaLayer a{color:#00f}[_nghost-%COMP%]     .xfaRich li{margin-left:3em}[_nghost-%COMP%]     .xfaFont{color:#000;font-weight:400;font-kerning:none;font-size:10px;font-style:normal;letter-spacing:0;text-decoration:none;vertical-align:0}[_nghost-%COMP%]     .xfaCaption{overflow:hidden;flex:0 0 auto}[_nghost-%COMP%]     .xfaCaptionForCheckButton{overflow:hidden;flex:1 1 auto}[_nghost-%COMP%]     .xfaLabel{height:100%;width:100%}[_nghost-%COMP%]     .xfaLeft{display:flex;flex-direction:row;align-items:center}[_nghost-%COMP%]     .xfaRight{display:flex;flex-direction:row-reverse;align-items:center}[_nghost-%COMP%]     .xfaLeft>.xfaCaption, [_nghost-%COMP%]     .xfaLeft>.xfaCaptionForCheckButton, [_nghost-%COMP%]     .xfaRight>.xfaCaption, [_nghost-%COMP%]     .xfaRight>.xfaCaptionForCheckButton{max-height:100%}[_nghost-%COMP%]     .xfaTop{display:flex;flex-direction:column;align-items:flex-start}[_nghost-%COMP%]     .xfaBottom{display:flex;flex-direction:column-reverse;align-items:flex-start}[_nghost-%COMP%]     .xfaTop>.xfaCaption, [_nghost-%COMP%]     .xfaTop>.xfaCaptionForCheckButton, [_nghost-%COMP%]     .xfaBottom>.xfaCaption, [_nghost-%COMP%]     .xfaBottom>.xfaCaptionForCheckButton{width:100%}[_nghost-%COMP%]     .xfaBorder{background-color:transparent;position:absolute;pointer-events:none}[_nghost-%COMP%]     .xfaWrapped{width:100%;height:100%}[_nghost-%COMP%]     .xfaTextfield:focus, [_nghost-%COMP%]     .xfaSelect:focus{background-image:none;background-color:transparent;outline:auto;outline-offset:-1px}[_nghost-%COMP%]     .xfaCheckbox:focus, [_nghost-%COMP%]     .xfaRadio:focus{outline:auto}[_nghost-%COMP%]     .xfaTextfield, [_nghost-%COMP%]     .xfaSelect{height:100%;width:100%;flex:1 1 auto;border:none;resize:none;background-image:var(--xfa-unfocused-field-background)}[_nghost-%COMP%]     .xfaTop>.xfaTextfield, [_nghost-%COMP%]     .xfaTop>.xfaSelect, [_nghost-%COMP%]     .xfaBottom>.xfaTextfield, [_nghost-%COMP%]     .xfaBottom>.xfaSelect{flex:0 1 auto}[_nghost-%COMP%]     .xfaButton{cursor:pointer;width:100%;height:100%;border:none;text-align:center}[_nghost-%COMP%]     .xfaLink{width:100%;height:100%;position:absolute;top:0;left:0}[_nghost-%COMP%]     .xfaCheckbox, [_nghost-%COMP%]     .xfaRadio{width:100%;height:100%;flex:0 0 auto;border:none}[_nghost-%COMP%]     .xfaRich{white-space:pre-wrap;width:100%;height:100%}[_nghost-%COMP%]     .xfaImage{-o-object-position:left top;object-position:left top;-o-object-fit:contain;object-fit:contain;width:100%;height:100%}[_nghost-%COMP%]     .xfaLrTb, [_nghost-%COMP%]     .xfaRlTb, [_nghost-%COMP%]     .xfaTb{display:flex;flex-direction:column;align-items:stretch}[_nghost-%COMP%]     .xfaLr{display:flex;flex-direction:row;align-items:stretch}[_nghost-%COMP%]     .xfaRl{display:flex;flex-direction:row-reverse;align-items:stretch}[_nghost-%COMP%]     .xfaTb>div{justify-content:left}[_nghost-%COMP%]     .xfaPosition{position:relative}[_nghost-%COMP%]     .xfaArea{position:relative}[_nghost-%COMP%]     .xfaValignMiddle{display:flex;align-items:center}[_nghost-%COMP%]     .xfaTable{display:flex;flex-direction:column;align-items:stretch}[_nghost-%COMP%]     .xfaTable .xfaRow{display:flex;flex-direction:row;align-items:stretch}[_nghost-%COMP%]     .xfaTable .xfaRlRow{display:flex;flex-direction:row-reverse;align-items:stretch;flex:1}[_nghost-%COMP%]     .xfaTable .xfaRlRow>div{flex:1}[_nghost-%COMP%]     .xfaNonInteractive input, [_nghost-%COMP%]     .xfaNonInteractive textarea, [_nghost-%COMP%]     .xfaDisabled input, [_nghost-%COMP%]     .xfaDisabled textarea, [_nghost-%COMP%]     .xfaReadOnly input, [_nghost-%COMP%]     .xfaReadOnly textarea{background:initial}@media print{[_nghost-%COMP%]     .xfaTextfield, [_nghost-%COMP%]     .xfaSelect{background:transparent}[_nghost-%COMP%]     .xfaSelect{-webkit-appearance:none;-moz-appearance:none;appearance:none;text-indent:1px;text-overflow:""}}[_nghost-%COMP%]     [data-editor-rotation="90"]{transform:rotate(90deg)}[_nghost-%COMP%]     [data-editor-rotation="180"]{transform:rotate(180deg)}[_nghost-%COMP%]     [data-editor-rotation="270"]{transform:rotate(270deg)}[_nghost-%COMP%]     .annotationEditorLayer{background:transparent;position:absolute;top:0;left:0;font-size:calc(100px * var(--scale-factor));transform-origin:0 0}[_nghost-%COMP%]     .annotationEditorLayer .selectedEditor{outline:var(--focus-outline);resize:none}[_nghost-%COMP%]     .annotationEditorLayer .freeTextEditor{position:absolute;background:transparent;border-radius:3px;padding:calc(var(--freetext-padding) * var(--scale-factor));resize:none;width:auto;height:auto;z-index:1;transform-origin:0 0;touch-action:none}[_nghost-%COMP%]     .annotationEditorLayer .freeTextEditor .internal{background:transparent;border:none;top:0;left:0;overflow:visible;white-space:nowrap;resize:none;font:10px sans-serif;line-height:var(--freetext-line-height)}[_nghost-%COMP%]     .annotationEditorLayer .freeTextEditor .overlay{position:absolute;display:none;background:transparent;top:0;left:0;width:100%;height:100%}[_nghost-%COMP%]     .annotationEditorLayer .freeTextEditor .overlay.enabled{display:block}[_nghost-%COMP%]     .annotationEditorLayer .freeTextEditor .internal:empty:before{content:attr(default-content);color:gray}[_nghost-%COMP%]     .annotationEditorLayer .freeTextEditor .internal:focus{outline:none}[_nghost-%COMP%]     .annotationEditorLayer .inkEditor.disabled{resize:none}[_nghost-%COMP%]     .annotationEditorLayer .inkEditor.disabled.selectedEditor{resize:horizontal}[_nghost-%COMP%]     .annotationEditorLayer .freeTextEditor:hover:not(.selectedEditor), [_nghost-%COMP%]     .annotationEditorLayer .inkEditor:hover:not(.selectedEditor){outline:var(--hover-outline)}[_nghost-%COMP%]     .annotationEditorLayer .inkEditor{position:absolute;background:transparent;border-radius:3px;overflow:auto;width:100%;height:100%;z-index:1;transform-origin:0 0;cursor:auto}[_nghost-%COMP%]     .annotationEditorLayer .inkEditor.editing{resize:none;cursor:var(--editorInk-editing-cursor),pointer}[_nghost-%COMP%]     .annotationEditorLayer .inkEditor .inkEditorCanvas{position:absolute;top:0;left:0;width:100%;height:100%;touch-action:none}[_nghost-%COMP%]     [data-main-rotation="90"]{transform:rotate(90deg) translateY(-100%)}[_nghost-%COMP%]     [data-main-rotation="180"]{transform:rotate(180deg) translate(-100%,-100%)}[_nghost-%COMP%]     [data-main-rotation="270"]{transform:rotate(270deg) translate(-100%)}[_nghost-%COMP%]     .pdfViewer{padding-bottom:var(--pdfViewer-padding-bottom)}[_nghost-%COMP%]     .pdfViewer .canvasWrapper{overflow:hidden}[_nghost-%COMP%]     .pdfViewer .page{direction:ltr;width:816px;height:1056px;margin:var(--page-margin);position:relative;overflow:visible;border:var(--page-border);-o-border-image:var(--page-border-image);border-image:var(--page-border-image);background-clip:content-box;background-color:#fff}[_nghost-%COMP%]     .pdfViewer .dummyPage{position:relative;width:0;height:var(--viewer-container-height)}[_nghost-%COMP%]     .pdfViewer.removePageBorders .page{margin:0 auto 10px;border:none}[_nghost-%COMP%]     .pdfViewer.singlePageView{display:inline-block}[_nghost-%COMP%]     .pdfViewer.singlePageView .page{margin:0;border:none}[_nghost-%COMP%]     .pdfViewer.scrollHorizontal, [_nghost-%COMP%]     .pdfViewer.scrollWrapped, [_nghost-%COMP%]     .spread{margin-left:3.5px;margin-right:3.5px;text-align:center}[_nghost-%COMP%]     .pdfViewer.scrollHorizontal, [_nghost-%COMP%]     .spread{white-space:nowrap}[_nghost-%COMP%]     .pdfViewer.removePageBorders, [_nghost-%COMP%]     .pdfViewer.scrollHorizontal .spread, [_nghost-%COMP%]     .pdfViewer.scrollWrapped .spread{margin-left:0;margin-right:0}[_nghost-%COMP%]     .spread .page, [_nghost-%COMP%]     .spread .dummyPage, [_nghost-%COMP%]     .pdfViewer.scrollHorizontal .page, [_nghost-%COMP%]     .pdfViewer.scrollWrapped .page, [_nghost-%COMP%]     .pdfViewer.scrollHorizontal .spread, [_nghost-%COMP%]     .pdfViewer.scrollWrapped .spread{display:inline-block;vertical-align:middle}[_nghost-%COMP%]     .spread .page, [_nghost-%COMP%]     .pdfViewer.scrollHorizontal .page, [_nghost-%COMP%]     .pdfViewer.scrollWrapped .page{margin-left:var(--spreadHorizontalWrapped-margin-LR);margin-right:var(--spreadHorizontalWrapped-margin-LR)}[_nghost-%COMP%]     .pdfViewer.removePageBorders .spread .page, [_nghost-%COMP%]     .pdfViewer.removePageBorders.scrollHorizontal .page, [_nghost-%COMP%]     .pdfViewer.removePageBorders.scrollWrapped .page{margin-left:5px;margin-right:5px}[_nghost-%COMP%]     .pdfViewer .page canvas{margin:0;display:block}[_nghost-%COMP%]     .pdfViewer .page canvas[hidden]{display:none}[_nghost-%COMP%]     .pdfViewer .page .loadingIcon{position:absolute;display:block;inset:0;background:url(data:image/gif;base64,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) center no-repeat}[_nghost-%COMP%]     .pdfViewer .page .loadingIcon.notVisible{background:none}[_nghost-%COMP%]     .pdfViewer.enablePermissions .textLayer span{-webkit-user-select:none!important;-moz-user-select:none!important;user-select:none!important;cursor:not-allowed}[_nghost-%COMP%]     .pdfPresentationMode .pdfViewer{padding-bottom:0}[_nghost-%COMP%]     .pdfPresentationMode .spread{margin:0}[_nghost-%COMP%]     .pdfPresentationMode .pdfViewer .page{margin:0 auto;border:2px solid transparent}`]});let s=e;return s})();var WO=function(s){let e=[],t=0;for(let i=0;i<s.length;i++){let n=s.charCodeAt(i);n<128?e[t++]=n:n<2048?(e[t++]=n>>6|192,e[t++]=n&63|128):(n&64512)===55296&&i+1<s.length&&(s.charCodeAt(i+1)&64512)===56320?(n=65536+((n&1023)<<10)+(s.charCodeAt(++i)&1023),e[t++]=n>>18|240,e[t++]=n>>12&63|128,e[t++]=n>>6&63|128,e[t++]=n&63|128):(e[t++]=n>>12|224,e[t++]=n>>6&63|128,e[t++]=n&63|128)}return e},V6=function(s){let e=[],t=0,i=0;for(;t<s.length;){let n=s[t++];if(n<128)e[i++]=String.fromCharCode(n);else if(n>191&&n<224){let r=s[t++];e[i++]=String.fromCharCode((n&31)<<6|r&63)}else if(n>239&&n<365){let r=s[t++],o=s[t++],a=s[t++],l=((n&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;e[i++]=String.fromCharCode(55296+(l>>10)),e[i++]=String.fromCharCode(56320+(l&1023))}else{let r=s[t++],o=s[t++];e[i++]=String.fromCharCode((n&15)<<12|(r&63)<<6|o&63)}}return e.join("")},j6={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(s,e){if(!Array.isArray(s))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let n=0;n<s.length;n+=3){let r=s[n],o=n+1<s.length,a=o?s[n+1]:0,l=n+2<s.length,c=l?s[n+2]:0,d=r>>2,h=(r&3)<<4|a>>4,u=(a&15)<<2|c>>6,p=c&63;l||(p=64,o||(u=64)),i.push(t[d],t[h],t[u],t[p])}return i.join("")},encodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(s):this.encodeByteArray(WO(s),e)},decodeString(s,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(s):V6(this.decodeStringToByteArray(s,e))},decodeStringToByteArray(s,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let n=0;n<s.length;){let r=t[s.charAt(n++)],a=n<s.length?t[s.charAt(n)]:0;++n;let c=n<s.length?t[s.charAt(n)]:64;++n;let h=n<s.length?t[s.charAt(n)]:64;if(++n,r==null||a==null||c==null||h==null)throw new l_;let u=r<<2|a>>4;if(i.push(u),c!==64){let p=a<<4&240|c>>2;if(i.push(p),h!==64){let f=c<<6&192|h;i.push(f)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let s=0;s<this.ENCODED_VALS.length;s++)this.byteToCharMap_[s]=this.ENCODED_VALS.charAt(s),this.charToByteMap_[this.byteToCharMap_[s]]=s,this.byteToCharMapWebSafe_[s]=this.ENCODED_VALS_WEBSAFE.charAt(s),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[s]]=s,s>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(s)]=s,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(s)]=s)}}},l_=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},H6=function(s){let e=WO(s);return j6.encodeByteArray(e,!0)},c_=function(s){return H6(s).replace(/\./g,"")};function YO(){try{return typeof indexedDB=="object"}catch{return!1}}function qO(){return new Promise((s,e)=>{try{let t=!0,i="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(i);n.onsuccess=()=>{n.result.close(),t||self.indexedDB.deleteDatabase(i),s(!0)},n.onupgradeneeded=()=>{t=!1},n.onerror=()=>{var r;e(((r=n.error)===null||r===void 0?void 0:r.message)||"")}}catch(t){e(t)}})}var G6="FirebaseError",Vr=class s extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=G6,Object.setPrototypeOf(this,s.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Jd.prototype.create)}},Jd=class{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){let i=t[0]||{},n=`${this.service}/${e}`,r=this.errors[e],o=r?W6(r,i):"Error",a=`${this.serviceName}: ${o} (${n}).`;return new Vr(n,a,i)}};function W6(s,e){return s.replace(Y6,(t,i)=>{let n=e[i];return n!=null?String(n):`<${i}?>`})}var Y6=/\{\$([^}]+)}/g;var iZ=4*60*60*1e3;function h_(s){return s&&s._delegate?s._delegate:s}var Go=class{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var q6=[],vi=function(s){return s[s.DEBUG=0]="DEBUG",s[s.VERBOSE=1]="VERBOSE",s[s.INFO=2]="INFO",s[s.WARN=3]="WARN",s[s.ERROR=4]="ERROR",s[s.SILENT=5]="SILENT",s}(vi||{}),X6={debug:vi.DEBUG,verbose:vi.VERBOSE,info:vi.INFO,warn:vi.WARN,error:vi.ERROR,silent:vi.SILENT},K6=vi.INFO,$6={[vi.DEBUG]:"log",[vi.VERBOSE]:"log",[vi.INFO]:"info",[vi.WARN]:"warn",[vi.ERROR]:"error"},Z6=(s,e,...t)=>{if(e<s.logLevel)return;let i=new Date().toISOString(),n=$6[e];if(n)console[n](`[${i}]  ${s.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},Sm=class{constructor(e){this.name=e,this._logLevel=K6,this._logHandler=Z6,this._userLogHandler=null,q6.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in vi))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?X6[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,vi.DEBUG,...e),this._logHandler(this,vi.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,vi.VERBOSE,...e),this._logHandler(this,vi.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,vi.INFO,...e),this._logHandler(this,vi.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,vi.WARN,...e),this._logHandler(this,vi.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,vi.ERROR,...e),this._logHandler(this,vi.ERROR,...e)}};var Q6=(s,e)=>e.some(t=>s instanceof t),XO,KO;function J6(){return XO||(XO=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ez(){return KO||(KO=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var $O=new WeakMap,u_=new WeakMap,ZO=new WeakMap,d_=new WeakMap,f_=new WeakMap;function tz(s){let e=new Promise((t,i)=>{let n=()=>{s.removeEventListener("success",r),s.removeEventListener("error",o)},r=()=>{t(pr(s.result)),n()},o=()=>{i(s.error),n()};s.addEventListener("success",r),s.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&$O.set(t,s)}).catch(()=>{}),f_.set(e,s),e}function iz(s){if(u_.has(s))return;let e=new Promise((t,i)=>{let n=()=>{s.removeEventListener("complete",r),s.removeEventListener("error",o),s.removeEventListener("abort",o)},r=()=>{t(),n()},o=()=>{i(s.error||new DOMException("AbortError","AbortError")),n()};s.addEventListener("complete",r),s.addEventListener("error",o),s.addEventListener("abort",o)});u_.set(s,e)}var p_={get(s,e,t){if(s instanceof IDBTransaction){if(e==="done")return u_.get(s);if(e==="objectStoreNames")return s.objectStoreNames||ZO.get(s);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return pr(s[e])},set(s,e,t){return s[e]=t,!0},has(s,e){return s instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in s}};function QO(s){p_=s(p_)}function nz(s){return s===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let i=s.call(Am(this),e,...t);return ZO.set(i,e.sort?e.sort():[e]),pr(i)}:ez().includes(s)?function(...e){return s.apply(Am(this),e),pr($O.get(this))}:function(...e){return pr(s.apply(Am(this),e))}}function sz(s){return typeof s=="function"?nz(s):(s instanceof IDBTransaction&&iz(s),Q6(s,J6())?new Proxy(s,p_):s)}function pr(s){if(s instanceof IDBRequest)return tz(s);if(d_.has(s))return d_.get(s);let e=sz(s);return e!==s&&(d_.set(s,e),f_.set(e,s)),e}var Am=s=>f_.get(s);function e2(s,e,{blocked:t,upgrade:i,blocking:n,terminated:r}={}){let o=indexedDB.open(s,e),a=pr(o);return i&&o.addEventListener("upgradeneeded",l=>{i(pr(o.result),l.oldVersion,l.newVersion,pr(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{r&&l.addEventListener("close",()=>r()),n&&l.addEventListener("versionchange",c=>n(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}var rz=["get","getKey","getAll","getAllKeys","count"],oz=["put","add","delete","clear"],m_=new Map;function JO(s,e){if(!(s instanceof IDBDatabase&&!(e in s)&&typeof e=="string"))return;if(m_.get(e))return m_.get(e);let t=e.replace(/FromIndex$/,""),i=e!==t,n=oz.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(n||rz.includes(t)))return;let r=function(o,...a){return ie(this,null,function*(){let l=this.transaction(o,n?"readwrite":"readonly"),c=l.store;return i&&(c=c.index(a.shift())),(yield Promise.all([c[t](...a),n&&l.done]))[0]})};return m_.set(e,r),r}QO(s=>yt(Se({},s),{get:(e,t,i)=>JO(e,t)||s.get(e,t,i),has:(e,t)=>!!JO(e,t)||s.has(e,t)}));var b_=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(az(t)){let i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}};function az(s){let e=s.getComponent();return e?.type==="VERSION"}var v_="@firebase/app",t2="0.10.3";var $a=new Sm("@firebase/app"),lz="@firebase/app-compat",cz="@firebase/analytics-compat",hz="@firebase/analytics",dz="@firebase/app-check-compat",uz="@firebase/app-check",pz="@firebase/auth",fz="@firebase/auth-compat",mz="@firebase/database",gz="@firebase/database-compat",bz="@firebase/functions",vz="@firebase/functions-compat",yz="@firebase/installations",_z="@firebase/installations-compat",wz="@firebase/messaging",Ez="@firebase/messaging-compat",Cz="@firebase/performance",xz="@firebase/performance-compat",Sz="@firebase/remote-config",Az="@firebase/remote-config-compat",Iz="@firebase/storage",Tz="@firebase/storage-compat",Pz="@firebase/firestore",Oz="@firebase/vertexai-preview",Mz="@firebase/firestore-compat",Rz="firebase",Dz="10.12.0";var Lz={[v_]:"fire-core",[lz]:"fire-core-compat",[hz]:"fire-analytics",[cz]:"fire-analytics-compat",[uz]:"fire-app-check",[dz]:"fire-app-check-compat",[pz]:"fire-auth",[fz]:"fire-auth-compat",[mz]:"fire-rtdb",[gz]:"fire-rtdb-compat",[bz]:"fire-fn",[vz]:"fire-fn-compat",[yz]:"fire-iid",[_z]:"fire-iid-compat",[wz]:"fire-fcm",[Ez]:"fire-fcm-compat",[Cz]:"fire-perf",[xz]:"fire-perf-compat",[Sz]:"fire-rc",[Az]:"fire-rc-compat",[Iz]:"fire-gcs",[Tz]:"fire-gcs-compat",[Pz]:"fire-fst",[Mz]:"fire-fst-compat",[Oz]:"fire-vertex","fire-js":"fire-js",[Rz]:"fire-js-all"};var Fz=new Map,kz=new Map,i2=new Map;function n2(s,e){try{s.container.addComponent(e)}catch(t){$a.debug(`Component ${e.name} failed to register with FirebaseApp ${s.name}`,t)}}function eu(s){let e=s.name;if(i2.has(e))return $a.debug(`There were multiple attempts to register component ${e}.`),!1;i2.set(e,s);for(let t of Fz.values())n2(t,s);for(let t of kz.values())n2(t,s);return!0}var Nz={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},w_=new Jd("app","Firebase",Nz);var a2=Dz;function jr(s,e,t){var i;let n=(i=Lz[s])!==null&&i!==void 0?i:s;t&&(n+=`-${t}`);let r=n.match(/\s|\//),o=e.match(/\s|\//);if(r||o){let a=[`Unable to register library "${n}" with version "${e}":`];r&&a.push(`library name "${n}" contains illegal characters (whitespace or "/")`),r&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),$a.warn(a.join(" "));return}eu(new Go(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}var Uz="firebase-heartbeat-database",Bz=1,tu="firebase-heartbeat-store",g_=null;function l2(){return g_||(g_=e2(Uz,Bz,{upgrade:(s,e)=>{switch(e){case 0:try{s.createObjectStore(tu)}catch(t){console.warn(t)}}}}).catch(s=>{throw w_.create("idb-open",{originalErrorMessage:s.message})})),g_}function zz(s){return ie(this,null,function*(){try{let t=(yield l2()).transaction(tu),i=yield t.objectStore(tu).get(c2(s));return yield t.done,i}catch(e){if(e instanceof Vr)$a.warn(e.message);else{let t=w_.create("idb-get",{originalErrorMessage:e?.message});$a.warn(t.message)}}})}function s2(s,e){return ie(this,null,function*(){try{let i=(yield l2()).transaction(tu,"readwrite");yield i.objectStore(tu).put(e,c2(s)),yield i.done}catch(t){if(t instanceof Vr)$a.warn(t.message);else{let i=w_.create("idb-set",{originalErrorMessage:t?.message});$a.warn(i.message)}}})}function c2(s){return`${s.name}!${s.options.appId}`}var Vz=1024,jz=30*24*60*60*1e3,y_=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new __(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}triggerHeartbeat(){return ie(this,null,function*(){var e,t;let n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=r2();if(!(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null))&&!(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(o=>o.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{let a=new Date(o.date).valueOf();return Date.now()-a<=jz}),this._storage.overwrite(this._heartbeatsCache)})}getHeartbeatsHeader(){return ie(this,null,function*(){var e;if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=r2(),{heartbeatsToSend:i,unsentEntries:n}=Hz(this._heartbeatsCache.heartbeats),r=c_(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r})}};function r2(){return new Date().toISOString().substring(0,10)}function Hz(s,e=Vz){let t=[],i=s.slice();for(let n of s){let r=t.find(o=>o.agent===n.agent);if(r){if(r.dates.push(n.date),o2(t)>e){r.dates.pop();break}}else if(t.push({agent:n.agent,dates:[n.date]}),o2(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}var __=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return ie(this,null,function*(){return YO()?qO().then(()=>!0).catch(()=>!1):!1})}read(){return ie(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield zz(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return ie(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let n=yield this.read();return s2(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return ie(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let n=yield this.read();return s2(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}else return})}};function o2(s){return c_(JSON.stringify({version:2,heartbeats:s})).length}function Gz(s){eu(new Go("platform-logger",e=>new b_(e),"PRIVATE")),eu(new Go("heartbeat",e=>new y_(e),"PRIVATE")),jr(v_,t2,s),jr(v_,t2,"esm2017"),jr("fire-js","")}Gz("");var Wz="firebase",Yz="10.12.0";jr(Wz,Yz,"app");function zc(){}var qz=class{zone;task=null;constructor(s){this.zone=s}call(s,e){let t=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",zc,{},zc,zc)),e.pipe(Cu({next:t,complete:t,error:t})).subscribe(s).add(t)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}};function Im(){let s=globalThis.\u0275AngularFireScheduler;if(!s)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return s}function Xz(s){return Im().ngZone.runOutsideAngular(()=>s())}function Za(s){return Im().ngZone.run(()=>s())}function Kz(s){return $z(Im())(s)}function $z(s){return function(t){return t=t.lift(new qz(s.ngZone)),t.pipe(og(s.outsideAngular),rg(s.insideAngular))}}var Zz=(s,e)=>function(){let i=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),Za(()=>s.apply(void 0,i))},E_=(s,e)=>function(){let t,i=arguments;for(let r=0;r<arguments.length;r++)typeof i[r]=="function"&&(e&&(t||=Za(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",zc,{},zc,zc))),i[r]=Zz(i[r],t));let n=Xz(()=>s.apply(this,i));if(!e)if(n instanceof rl){let r=Im();return n.pipe(og(r.outsideAngular),rg(r.insideAngular))}else return Za(()=>n);return n instanceof rl?n.pipe(Kz):n instanceof Promise?Za(()=>new Promise((r,o)=>n.then(a=>Za(()=>r(a)),a=>Za(()=>o(a))))):typeof n=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),n.apply(this,arguments)}:Za(()=>n)};var m2="firebasestorage.googleapis.com",g2="storageBucket",Qz=2*60*1e3,Jz=10*60*1e3;var Zi=class s extends Vr{constructor(e,t,i=0){super(C_(e),`Firebase Storage: ${t} (${C_(e)})`),this.status_=i,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,s.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return C_(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}},hn=function(s){return s.UNKNOWN="unknown",s.OBJECT_NOT_FOUND="object-not-found",s.BUCKET_NOT_FOUND="bucket-not-found",s.PROJECT_NOT_FOUND="project-not-found",s.QUOTA_EXCEEDED="quota-exceeded",s.UNAUTHENTICATED="unauthenticated",s.UNAUTHORIZED="unauthorized",s.UNAUTHORIZED_APP="unauthorized-app",s.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",s.INVALID_CHECKSUM="invalid-checksum",s.CANCELED="canceled",s.INVALID_EVENT_NAME="invalid-event-name",s.INVALID_URL="invalid-url",s.INVALID_DEFAULT_BUCKET="invalid-default-bucket",s.NO_DEFAULT_BUCKET="no-default-bucket",s.CANNOT_SLICE_BLOB="cannot-slice-blob",s.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",s.NO_DOWNLOAD_URL="no-download-url",s.INVALID_ARGUMENT="invalid-argument",s.INVALID_ARGUMENT_COUNT="invalid-argument-count",s.APP_DELETED="app-deleted",s.INVALID_ROOT_OPERATION="invalid-root-operation",s.INVALID_FORMAT="invalid-format",s.INTERNAL_ERROR="internal-error",s.UNSUPPORTED_ENVIRONMENT="unsupported-environment",s}(hn||{});function C_(s){return"storage/"+s}function b2(){let s="An unknown error occurred, please check the error payload for server response.";return new Zi(hn.UNKNOWN,s)}function eV(s){return new Zi(hn.OBJECT_NOT_FOUND,"Object '"+s+"' does not exist.")}function tV(s){return new Zi(hn.QUOTA_EXCEEDED,"Quota for bucket '"+s+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function iV(){let s="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Zi(hn.UNAUTHENTICATED,s)}function nV(){return new Zi(hn.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function sV(s){return new Zi(hn.UNAUTHORIZED,"User does not have permission to access '"+s+"'.")}function rV(){return new Zi(hn.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function oV(){return new Zi(hn.CANCELED,"User canceled the upload/download.")}function aV(s){return new Zi(hn.INVALID_URL,"Invalid URL '"+s+"'.")}function lV(s){return new Zi(hn.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+s+"'.")}function cV(){return new Zi(hn.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+g2+"' property when initializing the app?")}function hV(){return new Zi(hn.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function x_(s){return new Zi(hn.INVALID_ARGUMENT,s)}function v2(){return new Zi(hn.APP_DELETED,"The Firebase app was deleted.")}function dV(s){return new Zi(hn.INVALID_ROOT_OPERATION,"The operation '"+s+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function iu(s){throw new Zi(hn.INTERNAL_ERROR,"Internal error: "+s)}var Us=class s{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let i;try{i=s.makeFromUrl(e,t)}catch{return new s(e,"")}if(i.path==="")return i;throw lV(e)}static makeFromUrl(e,t){let i=null,n="([A-Za-z0-9.\\-_]+)";function r(y){y.path.charAt(y.path.length-1)==="/"&&(y.path_=y.path_.slice(0,-1))}let o="(/(.*))?$",a=new RegExp("^gs://"+n+o,"i"),l={bucket:1,path:3};function c(y){y.path_=decodeURIComponent(y.path)}let d="v[A-Za-z0-9_]+",h=t.replace(/[.]/g,"\\."),u="(/([^?#]*).*)?$",p=new RegExp(`^https?://${h}/${d}/b/${n}/o${u}`,"i"),f={bucket:1,path:3},m=t===m2?"(?:storage.googleapis.com|storage.cloud.google.com)":t,g="([^?#]*)",b=new RegExp(`^https?://${m}/${n}/${g}`,"i"),E=[{regex:a,indices:l,postModify:r},{regex:p,indices:f,postModify:c},{regex:b,indices:{bucket:1,path:2},postModify:c}];for(let y=0;y<E.length;y++){let w=E[y],C=w.regex.exec(e);if(C){let A=C[w.indices.bucket],D=C[w.indices.path];D||(D=""),i=new s(A,D),w.postModify(i);break}}if(i==null)throw aV(e);return i}},S_=class{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}};function uV(s,e,t){let i=1,n=null,r=null,o=!1,a=0;function l(){return a===2}let c=!1;function d(...g){c||(c=!0,e.apply(null,g))}function h(g){n=setTimeout(()=>{n=null,s(p,l())},g)}function u(){r&&clearTimeout(r)}function p(g,...b){if(c){u();return}if(g){u(),d.call(null,g,...b);return}if(l()||o){u(),d.call(null,g,...b);return}i<64&&(i*=2);let E;a===1?(a=2,E=0):E=(i+Math.random())*1e3,h(E)}let f=!1;function m(g){f||(f=!0,u(),!c&&(n!==null?(g||(a=2),clearTimeout(n),h(0)):g||(a=1)))}return h(0),r=setTimeout(()=>{o=!0,m(!0)},t),m}function pV(s){s(!1)}function fV(s){return s!==void 0}function mV(s){return typeof s=="object"&&!Array.isArray(s)}function y2(s){return typeof s=="string"||s instanceof String}function h2(s,e,t,i){if(i<e)throw x_(`Invalid value for '${s}'. Expected ${e} or greater.`);if(i>t)throw x_(`Invalid value for '${s}'. Expected ${t} or less.`)}function _2(s,e,t){let i=e;return t==null&&(i=`https://${e}`),`${t}://${i}/v0${s}`}function w2(s){let e=encodeURIComponent,t="?";for(let i in s)if(s.hasOwnProperty(i)){let n=e(i)+"="+e(s[i]);t=t+n+"&"}return t=t.slice(0,-1),t}var jc=function(s){return s[s.NO_ERROR=0]="NO_ERROR",s[s.NETWORK_ERROR=1]="NETWORK_ERROR",s[s.ABORT=2]="ABORT",s}(jc||{});function gV(s,e){let t=s>=500&&s<600,n=[408,429].indexOf(s)!==-1,r=e.indexOf(s)!==-1;return t||n||r}var A_=class{constructor(e,t,i,n,r,o,a,l,c,d,h,u=!0){this.url_=e,this.method_=t,this.headers_=i,this.body_=n,this.successCodes_=r,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=l,this.timeout_=c,this.progressCallback_=d,this.connectionFactory_=h,this.retry=u,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((p,f)=>{this.resolve_=p,this.reject_=f,this.start_()})}start_(){let e=(i,n)=>{if(n){i(!1,new Vc(!1,null,!0));return}let r=this.connectionFactory_();this.pendingConnection_=r;let o=a=>{let l=a.loaded,c=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,c)};this.progressCallback_!==null&&r.addUploadProgressListener(o),r.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&r.removeUploadProgressListener(o),this.pendingConnection_=null;let a=r.getErrorCode()===jc.NO_ERROR,l=r.getStatus();if(!a||gV(l,this.additionalRetryCodes_)&&this.retry){let d=r.getErrorCode()===jc.ABORT;i(!1,new Vc(!1,null,d));return}let c=this.successCodes_.indexOf(l)!==-1;i(!0,new Vc(c,r))})},t=(i,n)=>{let r=this.resolve_,o=this.reject_,a=n.connection;if(n.wasSuccessCode)try{let l=this.callback_(a,a.getResponse());fV(l)?r(l):r()}catch(l){o(l)}else if(a!==null){let l=b2();l.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,l)):o(l)}else if(n.canceled){let l=this.appDelete_?v2():oV();o(l)}else{let l=rV();o(l)}};this.canceled_?t(!1,new Vc(!1,null,!0)):this.backoffId_=uV(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&pV(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}},Vc=class{constructor(e,t,i){this.wasSuccessCode=e,this.connection=t,this.canceled=!!i}};function bV(s,e){e!==null&&e.length>0&&(s.Authorization="Firebase "+e)}function vV(s,e){s["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function yV(s,e){e&&(s["X-Firebase-GMPID"]=e)}function _V(s,e){e!==null&&(s["X-Firebase-AppCheck"]=e)}function wV(s,e,t,i,n,r,o=!0){let a=w2(s.urlParams),l=s.url+a,c=Object.assign({},s.headers);return yV(c,e),bV(c,t),vV(c,r),_V(c,i),new A_(l,s.method,c,s.body,s.successCodes,s.additionalRetryCodes,s.handler,s.errorHandler,s.timeout,s.progressCallback,n,o)}function E2(s){let e;try{e=JSON.parse(s)}catch{return null}return mV(e)?e:null}function EV(s){if(s.length===0)return null;let e=s.lastIndexOf("/");return e===-1?"":s.slice(0,e)}function CV(s,e){let t=e.split("/").filter(i=>i.length>0).join("/");return s.length===0?t:s+"/"+t}function C2(s){let e=s.lastIndexOf("/",s.length-2);return e===-1?s:s.slice(e+1)}function xV(s,e){return e}var cn=class{constructor(e,t,i,n){this.server=e,this.local=t||e,this.writable=!!i,this.xform=n||xV}},Tm=null;function SV(s){return!y2(s)||s.length<2?s:C2(s)}function AV(){if(Tm)return Tm;let s=[];s.push(new cn("bucket")),s.push(new cn("generation")),s.push(new cn("metageneration")),s.push(new cn("name","fullPath",!0));function e(r,o){return SV(o)}let t=new cn("name");t.xform=e,s.push(t);function i(r,o){return o!==void 0?Number(o):o}let n=new cn("size");return n.xform=i,s.push(n),s.push(new cn("timeCreated")),s.push(new cn("updated")),s.push(new cn("md5Hash",null,!0)),s.push(new cn("cacheControl",null,!0)),s.push(new cn("contentDisposition",null,!0)),s.push(new cn("contentEncoding",null,!0)),s.push(new cn("contentLanguage",null,!0)),s.push(new cn("contentType",null,!0)),s.push(new cn("metadata","customMetadata",!0)),Tm=s,Tm}function IV(s,e){function t(){let i=s.bucket,n=s.fullPath,r=new Us(i,n);return e._makeStorageReference(r)}Object.defineProperty(s,"ref",{get:t})}function TV(s,e,t){let i={};i.type="file";let n=t.length;for(let r=0;r<n;r++){let o=t[r];i[o.local]=o.xform(i,e[o.server])}return IV(i,s),i}function PV(s,e,t){let i=E2(e);return i===null?null:TV(s,i,t)}function OV(s,e,t,i){let n=E2(e);if(n===null||!y2(n.downloadTokens))return null;let r=n.downloadTokens;if(r.length===0)return null;let o=encodeURIComponent;return r.split(",").map(c=>{let d=s.bucket,h=s.fullPath,u="/b/"+o(d)+"/o/"+o(h),p=_2(u,t,i),f=w2({alt:"media",token:c});return p+f})[0]}var I_=class{constructor(e,t,i,n){this.url=e,this.method=t,this.handler=i,this.timeout=n,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}};function MV(s){if(!s)throw b2()}function RV(s,e){function t(i,n){let r=PV(s,n,e);return MV(r!==null),OV(r,n,s.host,s._protocol)}return t}function DV(s){function e(t,i){let n;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?n=nV():n=iV():t.getStatus()===402?n=tV(s.bucket):t.getStatus()===403?n=sV(s.path):n=i,n.status=t.getStatus(),n.serverResponse=i.serverResponse,n}return e}function LV(s){let e=DV(s);function t(i,n){let r=e(i,n);return i.getStatus()===404&&(r=eV(s.path)),r.serverResponse=n.serverResponse,r}return t}function FV(s,e,t){let i=e.fullServerUrl(),n=_2(i,s.host,s._protocol),r="GET",o=s.maxOperationRetryTime,a=new I_(n,r,RV(s,t),o);return a.errorHandler=LV(e),a}var WZ=256*1024;var d2=null,T_=class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=jc.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=jc.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=jc.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,i,n){if(this.sent_)throw iu("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),n!==void 0)for(let r in n)n.hasOwnProperty(r)&&this.xhr_.setRequestHeader(r,n[r].toString());return i!==void 0?this.xhr_.send(i):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw iu("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw iu("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw iu("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw iu("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}},P_=class extends T_{initXhr(){this.xhr_.responseType="text"}};function kV(){return d2?d2():new P_}var Hc=class s{constructor(e,t){this._service=e,t instanceof Us?this._location=t:this._location=Us.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new s(e,t)}get root(){let e=new Us(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return C2(this._location.path)}get storage(){return this._service}get parent(){let e=EV(this._location.path);if(e===null)return null;let t=new Us(this._location.bucket,e);return new s(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw dV(e)}};function NV(s){s._throwIfRoot("getDownloadURL");let e=FV(s.storage,s._location,AV());return s.storage.makeRequestWithTokens(e,kV).then(t=>{if(t===null)throw hV();return t})}function UV(s,e){let t=CV(s._location.path,e),i=new Us(s._location.bucket,t);return new Hc(s.storage,i)}function BV(s){return/^[A-Za-z]+:\/\//.test(s)}function zV(s,e){return new Hc(s,e)}function x2(s,e){if(s instanceof nu){let t=s;if(t._bucket==null)throw cV();let i=new Hc(t,t._bucket);return e!=null?x2(i,e):i}else return e!==void 0?UV(s,e):s}function VV(s,e){if(e&&BV(e)){if(s instanceof nu)return zV(s,e);throw x_("To use ref(service, url), the first argument must be a Storage instance.")}else return x2(s,e)}function u2(s,e){let t=e?.[g2];return t==null?null:Us.makeFromBucketSpec(t,s)}var nu=class{constructor(e,t,i,n,r){this.app=e,this._authProvider=t,this._appCheckProvider=i,this._url=n,this._firebaseVersion=r,this._bucket=null,this._host=m2,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Qz,this._maxUploadRetryTime=Jz,this._requests=new Set,n!=null?this._bucket=Us.makeFromBucketSpec(n,this._host):this._bucket=u2(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Us.makeFromBucketSpec(this._url,e):this._bucket=u2(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){h2("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){h2("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){return ie(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=yield e.getToken();if(t!==null)return t.accessToken}return null})}_getAppCheckToken(){return ie(this,null,function*(){let e=this._appCheckProvider.getImmediate({optional:!0});return e?(yield e.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Hc(this,e)}_makeRequest(e,t,i,n,r=!0){if(this._deleted)return new S_(v2());{let o=wV(e,this._appId,i,n,t,this._firebaseVersion,r);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}makeRequestWithTokens(e,t){return ie(this,null,function*(){let[i,n]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,i,n).getPromise()})}},p2="@firebase/storage",f2="0.12.5";var jV="storage";function S2(s){return s=h_(s),NV(s)}function A2(s,e){return s=h_(s),VV(s,e)}function HV(s,{instanceIdentifier:e}){let t=s.getProvider("app").getImmediate(),i=s.getProvider("auth-internal"),n=s.getProvider("app-check-internal");return new nu(t,i,n,e,a2)}function GV(){eu(new Go(jV,HV,"PUBLIC").setMultipleInstances(!0)),jr(p2,f2,""),jr(p2,f2,"esm2017")}GV();var I2=class{constructor(s){return s}};var T2=E_(S2,!0);var P2=E_(A2,!0);function YV(s,e){if(s&1){let t=mt();He(0,"lib-pdf-viewer",3),rt("afterLoadComplete",function(n){pt(t);let r=Ze(2);return ft(r.afterLoadComplete(n))}),We()}if(s&2){let t=Ze(2);Le("src",t.fileURL)("originalSize",!1)}}function qV(s,e){if(s&1){let t=mt();He(0,"lib-draggable-panel",1),rt("clickedClose",function(){pt(t);let n=Ze();return ft(n.close())}),dt(1,YV,1,2,"lib-pdf-viewer",2),We()}if(s&2){let t=Ze();Le("label",t.label())("position",t.panelPosition),Ge(),Le("ngIf",t.fileURL)}}var O2=(()=>{let e=class e{constructor(){this._state=qe(vt),this._storage=qe(I2),this.settings=new yo,this.viewedDocument=this._state.viewedDocument,this.label=zi(()=>this.viewedDocument()?.name??""),this.panelPosition=us.BottomLeft,this.fileURL="",Gt(()=>ie(this,null,function*(){let i=this.viewedDocument();i!==void 0&&(this.fileURL=yield this.settings.urlAuthenticator(i.iri))}))}close(){this._state.viewedDocument=void 0}afterLoadComplete(i){this.pdf=i}_getDownloadURL(i){return ie(this,null,function*(){let n=i.split("https://qaecy.com/r/")[1],r=P2(this._storage,`${n}.pdf`);this.fileURL=yield T2(r),console.log(this.fileURL)})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-document-viewer"]],inputs:{settings:"settings"},standalone:!0,features:[st],decls:1,vars:1,consts:[[3,"label","position","clickedClose",4,"ngIf"],[3,"clickedClose","label","position"],["style","height: 400px; width: 300px;",3,"src","originalSize","afterLoadComplete",4,"ngIf"],[2,"height","400px","width","300px",3,"afterLoadComplete","src","originalSize"]],template:function(n,r){n&1&&dt(0,qV,2,3,"lib-draggable-panel",0),n&2&&Le("ngIf",r.viewedDocument())},dependencies:[at,bt,ar,GO],encapsulation:2});let s=e;return s})();var XV=["bimViewer"];function KV(s,e){if(s&1&&_t(0,"lib-element-menu",4),s&2){let t=Ze(2);Le("settings",t.settings)}}function $V(s,e){s&1&&_t(0,"lib-debug-frame")}function ZV(s,e){if(s&1&&($n(0),He(1,"div",3),_t(2,"lib-toolbar",4),We(),_t(3,"lib-context-menu",4)(4,"lib-project-models",4),dt(5,KV,1,1,"lib-element-menu",5),_t(6,"lib-spatial-decomposition",4)(7,"lib-document-viewer",4)(8,"lib-nav-cube",4),dt(9,$V,1,0,"lib-debug-frame",2),Zn()),s&2){let t=Ze();Ge(2),Le("settings",t.settings),Ge(),Le("settings",t.settings),Ge(),Le("settings",t.settings),Ge(),Le("ngIf",t.queryEndpointProvided()),Ge(),Le("settings",t.settings),Ge(),Le("settings",t.settings.loading),Ge(),Le("settings",t.settings),Ge(),Le("ngIf",t.settings.visibility.showDebugFrame)}}var O_=(()=>{let e=class e{set bimViewer(i){i&&(hd.init(),this._container=i.nativeElement,this.init())}constructor(){this._service=qe(yn),this._queryService=qe(Pt),this._state=qe(vt),this.settings=new qt,this.hoveredElement=new Vt,this.selectionChange=new Vt,this.clickedGoToResource=new Vt,this.viewerReady=new Vt,this.queryEndpointProvided=Ft(!1),this.sceneHasModels=zi(()=>this._state.selectedModel()!==void 0),Gt(()=>{this._service.world()!==void 0&&this.viewerReady.emit()})}ngOnChanges(i){"settings"in i&&(this._service.settings=this.settings,this.settings.querySettings!==void 0?(this._queryService.settings=this.settings.querySettings,this.queryEndpointProvided.set(!0)):this.queryEndpointProvided.set(!1))}ngOnDestroy(){return ie(this,null,function*(){this._state.destroy(),yield this._service.destroy(),this._queryService.destroy()})}init(){if(this._container===void 0)throw new Error("Container is not ready");let i=this._service.initViewer(this._container);this._initEventListeners(i)}unloadAll(){return ie(this,null,function*(){return this._service.unloadAll()})}loadStream(i,n){return ie(this,null,function*(){yield this._service.loadStream(i),n!==void 0&&(yield this._state.setModelStyles(i.modelUUID,n))})}resourceLoad(i,n,r){return ie(this,null,function*(){yield this._service.resourceLoad(i,n),r!==void 0&&(yield this._state.setModelStyles(n,r))})}resourceSubsetLoad(i,n,r){return ie(this,null,function*(){console.log(r),yield this._service.resourceLoad(i,n,r)})}_initEventListeners(i){let n=i.get(Gl);n.events.addListener("hoveredElement",r=>this.hoveredElement.emit(r)),n.events.addListener("selectionChange",r=>this.selectionChange.emit(r)),this._state.events.addListener("clickedGoToResource",r=>{this.clickedGoToResource.emit(r)})}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["lib-ng-bim-viewer"]],viewQuery:function(n,r){if(n&1&&fi(XV,5),n&2){let o;mi(o=gi())&&(r.bimViewer=o.first)}},inputs:{settings:"settings"},outputs:{hoveredElement:"hoveredElement",selectionChange:"selectionChange",clickedGoToResource:"clickedGoToResource",viewerReady:"viewerReady"},standalone:!0,features:[Tn,st],decls:3,vars:1,consts:[["bimViewer",""],["id","viewer",2,"height","100%","z-index","100","position","relative"],[4,"ngIf"],[1,"toolbar-container"],[3,"settings"],[3,"settings",4,"ngIf"]],template:function(n,r){n&1&&(He(0,"div",1,0),dt(2,ZV,10,8,"ng-container",2),We()),n&2&&(Ge(2),Le("ngIf",r.settings.visibility.ui.enabled))},dependencies:[at,bt,bI,II,PI,NI,HI,LO,FO,O2],styles:[".toolbar-container[_ngcontent-%COMP%]{position:absolute;display:flex;flex-direction:row;justify-content:center;pointer-events:none;right:0;bottom:0;width:100%;z-index:100}"]});let s=e;return s})();var M_=new qt,M2=M_.visibility;M2.showStats=!1;var R_=M2.ui.contextMenu;R_.showFocusElementOption=!1;R_.showHideElementOption=!0;R_.showIsolateElementOption=!0;var Pm=M_.loading.culler;Pm.threshold=10;Pm.bboxThreshold=200;Pm.maxHiddenTime=1e4;Pm.maxLostTime=3e4;var R2=M_;var JQ=(()=>{let e=class e{constructor(){this.bucketURL="./assets/duplex-2.1.16/",this.settings=R2}ngAfterViewInit(){this.loadModel()}loadModel(i="./assets/duplex-2.1.16.json"){return ie(this,null,function*(){let r=yield(yield fetch(i)).json(),o=new Nf;o.focused=["ab10c52e-1f33-521d-bf95-4c2b9b132499"],yield this.bimViewer?.loadStream(r,o)})}onSelectionChange(i){console.log(i)}};e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=nt({type:e,selectors:[["app-model-viewer"]],viewQuery:function(n,r){if(n&1&&fi(O_,5),n&2){let o;mi(o=gi())&&(r.bimViewer=o.first)}},standalone:!0,features:[st],decls:3,vars:1,consts:[[2,"height","calc(100vh - 250px)"],[3,"hoveredElement","selectionChange","settings"]],template:function(n,r){n&1&&(He(0,"lib-page-section")(1,"div",0)(2,"lib-ng-bim-viewer",1),rt("hoveredElement",function(a){return r.hoveredElement=a})("selectionChange",function(a){return r.onSelectionChange(a)}),We()()()),n&2&&(Ge(2),Le("settings",r.settings))},dependencies:[at,O_,Mw]});let s=e;return s})();export{JQ as ModelViewerComponent};
