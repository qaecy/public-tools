import{c as q,d as we,e as Ee}from"./chunk-YDSTWWR6.js";import{l as ye,m as Se}from"./chunk-JIEVXC7M.js";import{b as _e,c as xe}from"./chunk-FOT4I5NM.js";import"./chunk-UDNVTHBX.js";import{a as de}from"./chunk-US4LGVEV.js";import{b as pe,c as he,d as ge}from"./chunk-XH644ECB.js";import{b as ce,e as fe,f as ue}from"./chunk-2ELQPX5B.js";import"./chunk-AESYL7IM.js";import{b as ne}from"./chunk-HGQPUHNU.js";import{b as T,n as D,t as oe}from"./chunk-ASG7CGOZ.js";import{a as P,c as L,d as E}from"./chunk-RLQXEM26.js";import{a as ae}from"./chunk-6ARMVIWK.js";import{b as re,f as le,h as se,k as me}from"./chunk-C5TAFYHE.js";import{c as ie}from"./chunk-OIPN42EH.js";import{X,ea as Z,ha as ee,ia as te}from"./chunk-L6BWHE7V.js";import{$b as w,Bb as N,Cb as k,Db as $,Eb as m,Fb as s,Gb as G,Jc as J,Mb as B,Mc as K,Nb as z,Wb as u,Xb as H,Yb as V,Za as c,Zb as y,_ as O,_b as S,bc as Y,ea as j,ia as A,sb as Q,ub as x}from"./chunk-NZYFJ7MV.js";import{h as Pe,j as g}from"./chunk-RZZ4GCVR.js";var De=Pe(Ee());oe();oe();function Fe(t){let e=t.split(".");return e.length>1?"."+e.pop():""}var{namedNode:a,literal:p}=T,Ie=a("http://www.w3.org/1999/02/22-rdf-syntax-ns#type");function Te(t,e=""){return P(`${e}${t}`)}function Me(t,e,f,o=xe.GCP,r=""){e.startsWith("/")||(e=`/${e}`);let i=`inst:${f}`,l=Te(e,r),n=`inst:${l}`,F=new Date().toISOString(),R=ve(e),W=Fe(e);t.addQuad(a(i),a("qcy:hasLocation"),a(n)),t.addQuad(a(n),Ie,a("qcy:File")),t.addQuad(a(n),a("schema:dateCreated"),p(F)),t.addQuad(a(n),a("schema:dateModified"),p(F)),t.addQuad(a(n),a("qcy:foldername"),p(e)),t.addQuad(a(n),a("qcy:name"),p(R)),t.addQuad(a(n),a("qcy:remoteProvider"),p(o)),t.addQuad(a(n),a("qcy:suffix"),p(`.${W}`));let C=qe(e);Ce(t,C,r,n);let I=C.split("/"),d="",M=[C];for(let _=1;_<I.length;_++){let h=d+"/"+I[_];if(!M.includes(d)){let v=`inst:${P(`${r}${h}`)}`;d===""&&(d="/"),Ce(t,d,r,v),M.push(d)}d=h}return{fileUUID:l}}function Ce(t,e,f,o){let r=ve(e),l=`inst:${P(`${f}${e}`)}`;t.addQuad(a(l),Ie,a("qcy:Folder")),t.addQuad(a(l),a("qcy:contains"),a(o)),t.addQuad(a(l),a("qcy:foldername"),p(e)),t.addQuad(a(l),a("qcy:name"),p(r))}function ve(t){let e=t.split("/").pop();return e?.length?e:"root"}function qe(t){let e=t.split("/");return e.pop(),e.join("/").length?e.join("/"):"/"}var{namedNode:b,literal:We}=T,be=(()=>{let e=class e{constructor(){this._writer=new D,this.delimiter=",",this.hasHeaderRow=!0,this.filePathIndex="0",this.prefixes={qcy:L.qcy,schema:E.schema}}set namespace(o){this.prefixes.inst=o,this._writer=new D({prefixes:this.prefixes})}processDocument(o,r,i=1/0){return g(this,null,function*(){this._writer=new D({prefixes:this.prefixes});let l=(0,De.parse)(o,{header:!1,delimiter:this.delimiter}),n=[],F=new Set,R=l.data.length;l.data.slice(0,i+1).forEach((C,I)=>{if(this.hasHeaderRow&&I===0)return;let d="",M=this.filePathIndex.split(",").map(v=>parseInt(v));M.forEach(v=>{d+=C[M[v]]}),d=d.replace(/\\/g,"/"),d=this._removeLeadingSlashes(d);let _=this._getFileName(d),h=this._getFileSuffix(_),U=_e[h];U===void 0&&h&&F.add(h),this._writeFile(d,U),n.length<10&&n.push({filePath:d,fileName:_,suffix:h}),r(I/R*100)});let W=yield this._getRDF();return{tableData:n,unmatchedSuffixes:F,rdf:W}})}_getRDF(){return new Promise((o,r)=>{this._writer.end((i,l)=>{i&&r(i),o(l)})})}_removeLeadingSlashes(o){return o.replace(/^\/+/,"")}_getFileName(o){return o.split("/").pop()??""}_getFileSuffix(o){let r=/\.(?<suffix>[^.]+)$/,i=o.match(r);return i&&i.groups&&i.groups.suffix?`.${i.groups.suffix.toLowerCase()}`:null}_writeFile(o,r){let i=ae();this._writer.addQuad(b(`inst:${i}`),b(`${E.rdf}type`),b("qcy:Document")),this._writer.addQuad(b(`inst:${i}`),b("qcy:resourceType"),We(r?.type??"unknown")),Me(this._writer,o,i)}};e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=O({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function Ue(t,e){if(t&1&&(m(0,"mat-option",5),u(1),s()),t&2){let f=e.$implicit;x("value",f.value),c(),H(f.label)}}function Qe(t,e){if(t&1&&(m(0,"p"),u(1),s()),t&2){let f=z();c(),V("Found ",f.unmatchedSuffixes.length," file suffixes that couldn't be matched")}}function Ne(t,e){if(t&1&&(m(0,"span",9),u(1),s()),t&2){let f=e.$implicit;c(),H(f)}}function ke(t,e){t&1&&(m(0,"p"),u(1,"Sample table"),s())}function $e(t,e){if(t&1&&(m(0,"div",11),G(1,"lib-ng-simple-table",12),s()),t&2){let f=z();c(),x("data",f.tableData)("columnDefs",f.columnDefs)("displayFilter",!1)}}var vt=(()=>{let e=class e{constructor(){this._service=j(be),this.documentContent="",this.delimiter=",",this.sampleSize=1/0,this.sampleSizeOptions=[{label:"20",value:20},{label:"50",value:50},{label:"100",value:100},{label:"500",value:500},{label:"1000",value:1e3},{label:"2000",value:2e3},{label:"5000",value:5e3},{label:"\u221E",value:1/0}],this.filePathIndex="0",this.hasHeaderRow=!0,this.filePathUsesBackslash=!1,this.namespace="https://example.com/",this.pct=0,this.unmatchedSuffixes=[],this.tableData=[],this.columnDefs=[new q("filePath","Path"),new q("fileName","Name"),new q("suffix","Suffix")]}runSample(){return g(this,null,function*(){let o=yield fetch("./assets/brennertunnel.csv");this.documentContent=yield o.text(),this.delimiter=",",this.filePathIndex="0,1",this.hasHeaderRow=!0,this._run()})}useOwnFile(){return g(this,null,function*(){this.documentContent=yield ne(".csv"),this._run()})}_run(){return g(this,null,function*(){this._service.delimiter=this.delimiter,this._service.hasHeaderRow=this.hasHeaderRow,this._service.filePathIndex=this.filePathIndex,this._service.namespace=this.namespace;let o=n=>{console.log(n.toFixed(0)+" %")},{tableData:r,unmatchedSuffixes:i,rdf:l}=yield this._service.processDocument(this.documentContent,o,this.sampleSize);this.tableData=r,this.unmatchedSuffixes=Array.from(i),ie(l,"file-structure-data.ttl","text/ttl")})}};e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=A({type:e,selectors:[["app-file-structure"]],standalone:!0,features:[Y],decls:36,vars:8,consts:[["title","File structure"],[2,"display","flex","flex-direction","column","gap","1rem"],["matInput","",3,"ngModelChange","ngModel"],[3,"ngModelChange","ngModel"],[1,"row"],[3,"value"],["mat-stroked-button","",2,"margin-bottom","5px",3,"click"],[4,"ngIf"],[2,"display","flex","flex-direction","row","flex-wrap","wrap"],[2,"padding","0.1rem","font-size","0.6rem"],["class","row","style","overflow-x: auto",4,"ngIf"],[1,"row",2,"overflow-x","auto"],[3,"data","columnDefs","displayFilter"]],template:function(r,i){r&1&&(m(0,"lib-page-section",0)(1,"p"),u(2," Takes a spreadsheet with filenames and other metadata and returns a QAECY file structure RDF file "),s(),m(3,"div",1)(4,"mat-form-field")(5,"mat-label"),u(6,"Delimiter"),s(),m(7,"input",2),w("ngModelChange",function(n){return S(i.delimiter,n)||(i.delimiter=n),n}),s()(),m(8,"mat-slide-toggle",3),w("ngModelChange",function(n){return S(i.hasHeaderRow,n)||(i.hasHeaderRow=n),n}),u(9,"Has header row"),s(),m(10,"mat-form-field")(11,"mat-label"),u(12,"Filepath cell Index"),s(),m(13,"input",2),w("ngModelChange",function(n){return S(i.filePathIndex,n)||(i.filePathIndex=n),n}),s()(),m(14,"mat-form-field")(15,"mat-label"),u(16,"Namespace"),s(),m(17,"input",2),w("ngModelChange",function(n){return S(i.namespace,n)||(i.namespace=n),n}),s()()(),m(18,"div",4)(19,"mat-form-field")(20,"mat-label"),u(21,"Sample size"),s(),m(22,"mat-select",3),w("ngModelChange",function(n){return S(i.sampleSize,n)||(i.sampleSize=n),n}),k(23,Ue,2,2,"mat-option",5,N),s()()(),m(25,"div",4)(26,"button",6),B("click",function(){return i.runSample()}),u(27," Use example "),s(),m(28,"button",6),B("click",function(){return i.useOwnFile()}),u(29," Use own file "),s()(),Q(30,Qe,2,1,"p",7),m(31,"div",8),k(32,Ne,2,1,"span",9,N),s(),Q(34,ke,2,0,"p",7)(35,$e,2,3,"div",10),s()),r&2&&(c(7),y("ngModel",i.delimiter),c(),y("ngModel",i.hasHeaderRow),c(5),y("ngModel",i.filePathIndex),c(4),y("ngModel",i.namespace),c(5),y("ngModel",i.sampleSize),c(),$(i.sampleSizeOptions),c(7),x("ngIf",i.unmatchedSuffixes.length),c(2),$(i.unmatchedSuffixes),c(2),x("ngIf",i.tableData.length),c(),x("ngIf",i.tableData.length))},dependencies:[K,J,te,ue,fe,ce,Se,ye,X,de,ge,he,pe,me,re,le,se,ee,Z,we],styles:[".row[_ngcontent-%COMP%]{display:flex;gap:5px;font-size:.8em}"]});let t=e;return t})();export{vt as FileStructureComponent};
