import{a as Re,b as Fe,c as R,d as ke,e as qe}from"./chunk-YDSTWWR6.js";import{l as Ae,m as Pe}from"./chunk-JIEVXC7M.js";import{a as we}from"./chunk-FOT4I5NM.js";import"./chunk-UDNVTHBX.js";import{c as ye,d as Me}from"./chunk-XH644ECB.js";import{b as Ne,e as Se,f as ve}from"./chunk-2ELQPX5B.js";import"./chunk-AESYL7IM.js";import{b as xe}from"./chunk-HGQPUHNU.js";import"./chunk-6ARMVIWK.js";import{b as be,f as _e,h as Ce,i as Ee,k as Te}from"./chunk-C5TAFYHE.js";import{c as ge}from"./chunk-OIPN42EH.js";import{X as ce,ca as me,da as de,ea as pe,ga as ue,ha as fe,ia as he}from"./chunk-L6BWHE7V.js";import{$b as D,Ba as ee,Cb as ne,Db as ie,Eb as d,Fb as p,Gb as P,Kb as L,Lc as se,Mb as v,Mc as z,Nb as C,Va as te,Wb as g,Xb as oe,Yb as K,Za as _,Zb as O,_b as V,bc as $,fc as ae,gc as re,ia as B,ra as N,sa as S,sb as j,tc as le,ub as w,zb as A}from"./chunk-NZYFJ7MV.js";import{f as He,h as J,j as X}from"./chunk-RZZ4GCVR.js";var Le=He((Je,Ie)=>{"use strict";var Be=function(){"use strict";var r={},u=/\[\^?]?(?:[^\\\]]+|\\[\S\s]?)*]?|\\(?:0(?:[0-3][0-7]{0,2}|[4-7][0-7]?)?|[1-9][0-9]*|x[0-9A-Fa-f]{2}|u[0-9A-Fa-f]{4}|c[A-Za-z]|[\S\s]?)|\((?:\?[:=!]?)?|(?:[?*+]|\{[0-9]+(?:,[0-9]*)?\})\??|[^.?*+^${[()|\\]+|./g,i=/[^\\-]+|-|\\(?:[0-3][0-7]{0,2}|[4-7][0-7]?|x[0-9A-Fa-f]{2}|u[0-9A-Fa-f]{4}|c[A-Za-z]|[\S\s]?)/g,o=/^(\[\^?)(]?(?:[^\\\]]+|\\[\S\s]?)*)(]?)$/,t=/^(?:[?*+]|\{[0-9]+(?:,[0-9]*)?\})\??$/,n={NONE:0,RANGE_HYPHEN:1,SHORT_CLASS:2,ALTERNATOR:3},c={UNCLOSED_CLASS:"Unclosed character class",INCOMPLETE_TOKEN:"Incomplete regex token",INVALID_RANGE:"Reversed or invalid range",INVALID_GROUP_TYPE:"Invalid or unsupported group type",UNBALANCED_LEFT_PAREN:"Unclosed grouping",UNBALANCED_RIGHT_PAREN:"No matching opening parenthesis",INTERVAL_OVERFLOW:"Interval quantifier cannot use value over 65,535",INTERVAL_REVERSED:"Interval quantifier range is reversed",UNQUANTIFIABLE:"Quantifiers must be preceded by a token that can be repeated",IMPROPER_EMPTY_ALTERNATIVE:"Empty alternative effectively truncates the regex here"};function l(f,e){return'<b class="err"'+(e?' title="'+e+'"':"")+">"+f+"</b>"}function h(f,e){return'<b class="g'+e+'">'+f+"</b>"}function T(f){return f.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function F(f){if(document.getElementsByClassName)return document.body.getElementsByClassName(f);var e=document.body.getElementsByTagName("*"),E=new RegExp("(?:^|\\s)"+f+"(?:\\s|$)"),m=[],x=e.length,a;for(a=0;a<x;a++)E.test(e[a].className)&&m.push(e[a]);return m}function b(f){if(f.length>1&&f.charAt(0)==="\\"){var e=f.slice(1);if(/^c[A-Za-z]$/.test(e))return"ABCDEFGHIJKLMNOPQRSTUVWXYZ".indexOf(e.charAt(1).toUpperCase())+1;if(/^(?:x[0-9A-Fa-f]{2}|u[0-9A-Fa-f]{4})$/.test(e))return parseInt(e.slice(1),16);if(/^(?:[0-3][0-7]{0,2}|[4-7][0-7]?)$/.test(e))return parseInt(e,8);if(e.length===1&&"cuxDdSsWw".indexOf(e)>-1)return NaN;if(e.length===1)switch(e){case"b":return 8;case"f":return 12;case"n":return 10;case"r":return 13;case"t":return 9;case"v":return 11;default:return e.charCodeAt(0)}}return f!=="\\"?f.charCodeAt(0):NaN}function W(f){var e="",E=o.exec(f),m={rangeable:!1,type:n.NONE},x,a;for(E={opening:E[1],content:E[2],closing:E[3]},e+=E.closing?E.opening:l(E.opening,c.UNCLOSED_CLASS);x=i.exec(E.content);)if(a=x[0],a.charAt(0)==="\\")/^\\[cux]$/.test(a)?(e+=l(a,c.INCOMPLETE_TOKEN),m={rangeable:m.type!==n.RANGE_HYPHEN}):/^\\[dsw]$/i.test(a)?(e+="<b>"+a+"</b>",m={rangeable:m.type!==n.RANGE_HYPHEN,type:n.SHORT_CLASS}):a==="\\"?e+=l(a,c.INCOMPLETE_TOKEN):(e+="<b>"+T(a)+"</b>",m={rangeable:m.type!==n.RANGE_HYPHEN,charCode:b(a)});else if(a==="-")if(m.rangeable){var H=i.lastIndex,s=i.exec(E.content);if(s){var y=b(s[0]);!isNaN(y)&&m.charCode>y||m.type===n.SHORT_CLASS||/^\\[dsw]$/i.test(s[0])?e+=l("-",c.INVALID_RANGE):e+="<u>-</u>",m={rangeable:!1,type:n.RANGE_HYPHEN}}else E.closing?e+="-":e+="<u>-</u>";i.lastIndex=H}else e+="-",m={rangeable:m.type!==n.RANGE_HYPHEN};else e+=T(a),m={rangeable:a.length>1||m.type!==n.RANGE_HYPHEN,charCode:a.charCodeAt(a.length-1)};return e+E.closing}return r.colorizeText=function(f){for(var e="",E=0,m=0,x=[],a={quantifiable:!1,type:n.NONE},H,s,y,q;H=u.exec(f);)if(s=H[0],y=s.charAt(0),q=s.charAt(1),y==="[")e+="<i>"+W(s)+"</i>",a={quantifiable:!0};else if(y==="(")s.length===2?e+=l(s,c.INVALID_GROUP_TYPE):(s.length===1&&E++,m=m===5?1:m+1,x.push({index:e.length+14,opening:s}),e+=h(s,m)),a={quantifiable:!1};else if(y===")")x.length?(e+=h(")",m),a={quantifiable:!/^[=!]/.test(x[x.length-1].opening.charAt(2)),style:"g"+m},m=m===1?5:m-1,x.pop()):(e+=l(")",c.UNBALANCED_RIGHT_PAREN),a={quantifiable:!1});else if(y==="\\")if(/^[1-9]/.test(q)){for(var G="",k=+s.slice(1);k>E;)G=/[0-9]$/.exec(k)[0]+G,k=Math.floor(k/10);if(k>0)e+="<b>\\"+k+"</b>"+G;else{var Q=/^\\([0-3][0-7]{0,2}|[4-7][0-7]?|[89])([0-9]*)/.exec(s);e+="<b>\\"+Q[1]+"</b>"+Q[2]}a={quantifiable:!0}}else/^[0bBcdDfnrsStuvwWx]/.test(q)?/^\\[cux]$/.test(s)?(e+=l(s,c.INCOMPLETE_TOKEN),a={quantifiable:!1}):"bB".indexOf(q)>-1?(e+="<b>"+s+"</b>",a={quantifiable:!1}):(e+="<b>"+s+"</b>",a={quantifiable:!0}):s==="\\"?e+=l(s,c.INCOMPLETE_TOKEN):(e+=T(s),a={quantifiable:!0});else if(t.test(s)){if(a.quantifiable){var M=/^\{([0-9]+)(?:,([0-9]*))?/.exec(s);M&&(+M[1]>65535||M[2]&&+M[2]>65535)?e+=l(s,c.INTERVAL_OVERFLOW):M&&M[2]&&+M[1]>+M[2]?e+=l(s,c.INTERVAL_REVERSED):e+=(a.style?'<b class="'+a.style+'">':"<b>")+s+"</b>"}else e+=l(s,c.UNQUANTIFIABLE);a={quantifiable:!1}}else s==="|"?(a.type===n.NONE||a.type===n.ALTERNATOR&&!x.length?e+=l(s,c.IMPROPER_EMPTY_ALTERNATIVE):e+=x.length?h("|",m):"<b>|</b>",a={quantifiable:!1,type:n.ALTERNATOR}):s==="^"||s==="$"?(e+="<b>"+s+"</b>",a={quantifiable:!1}):s==="."?(e+="<b>.</b>",a={quantifiable:!0}):(e+=T(s),a={quantifiable:!0});var Z=0,Y,I;for(I=0;I<x.length;I++)Y=x[I].index+Z,e=e.slice(0,Y)+l(x[I].opening,c.UNBALANCED_LEFT_PAREN)+e.slice(Y+x[I].opening.length),Z+=l("",c.UNBALANCED_LEFT_PAREN).length;return e},r.colorizeAll=function(f){f=f||"regex";var e=F(f),E=e.length,m,x;for(x=0;x<E;x++)m=e[x],m.innerHTML=r.colorizeText(m.textContent||m.innerText)},r.addStyleSheet=function(){var f=document.createElement("style"),e=".regex       {font-family: Monospace;} .regex b     {background: #aad1f7;} .regex i     {background: #e3e3e3;} .regex i b   {background: #9fb6dc;} .regex i u   {background: #c3c3c3;} .regex b.g1  {background: #b4fa50; color: #000;} .regex b.g2  {background: #8cd400; color: #000;} .regex b.g3  {background: #26b809; color: #fff;} .regex b.g4  {background: #30ea60; color: #000;} .regex b.g5  {background: #0c8d15; color: #fff;} .regex b.err {background: #e30000; color: #fff;} .regex b, .regex i, .regex u {font-weight: normal; font-style: normal; text-decoration: none;}";f.id="regex-colorizer-ss",document.getElementsByTagName("head")[0].appendChild(f),f.styleSheet?f.styleSheet.cssText=e:f.innerHTML=e},r}();Ie.exports=Be});var U=J(qe());var Oe=J(Le());var{colorizeText:ze}=Oe.default,Ve=(()=>{let u=class u{constructor(){this.value=ee("^\\d{2}"),this.regexHTML=le(()=>ze(this.value()))}};u.\u0275fac=function(t){return new(t||u)},u.\u0275cmp=B({type:u,selectors:[["lib-regex-highlighter"]],inputs:{value:[1,"value"]},standalone:!0,features:[$],decls:1,vars:1,consts:[[1,"regex",3,"innerHTML"]],template:function(t,n){t&1&&P(0,"code",0),t&2&&w("innerHTML",n.regexHTML(),te)},dependencies:[z],styles:['.regex{font-family:Consolas,"Source Code Pro",Monospace;white-space:pre-wrap;word-break:break-all;overflow-wrap:anywhere}  .regex b{font-weight:400}  .regex i{font-style:normal}  .regex u{text-decoration:none}  .regex *{border-radius:.25em}  .regex span{background:#eee}  .regex b{background:#00c8cc;color:#092e7f}  .regex b.bref{background:#86e9ff;color:#0d47c4}  .regex b.err{background:#e30000;color:#fff;font-style:normal}  .regex i{background:#e3e3e3;font-style:italic}  .regex i span{background:#c3c3c3;font-style:normal}  .regex i b{background:#c3c3c3}  .regex i u{background:#d3d3d3}  .regex b.g1{background:#cee602;color:#074d0b}  .regex b.g2{background:#8cd400;color:#053c08}  .regex b.g3{background:#26b809;color:#fff}  .regex b.g4{background:#30ea60;color:#125824}  .regex b.g5{background:#0c8d15;color:#fff}']});let r=u;return r})();function De(r){let u=r[0].rawPath.includes("\\")?"\\":"/",i=Object.values(we),o={},t=0;r.forEach(h=>{let b=h.rawPath.split(u).pop()?.split(".").pop()?.trim()?.toLowerCase();if(b&&b!==void 0&&b.length<4&&b.length>1){if(/^\d+$/.test(b)||!/^[a-z0-9]+$/.test(b))return;Object.keys(o).includes(`.${b}`)||(o[`.${b}`]=0),o[`.${b}`]++,t++}});let n=1,c={};return Object.keys(o).forEach(h=>{let T=o[h];i.includes(h)?(Object.assign(c),c[h]=T):T/t*100>=n?(c[h]=T,console.info(`${h}: ${T/t*100} %`)):console.info(`${h}: ${T/t*100} %`)}),console.log(c),{filtered:r.filter(h=>{let b=h.rawPath.split(u).pop()?.split(".").pop()?.trim();return!!(b&&b!==void 0&&Object.keys(c).includes(`.${b}`)&&Object.keys(c).includes(`.${b}`))}),suffixMap:c}}var Ue=(r,u)=>u.value;function We(r,u){if(r&1){let i=L();d(0,"p",1),g(1,"Load data"),p(),d(2,"div",2)(3,"mat-form-field")(4,"mat-label"),g(5,"Delimiter"),p(),d(6,"input",3),D("ngModelChange",function(t){N(i);let n=C();return V(n.delimiter,t)||(n.delimiter=t),S(t)}),p()(),d(7,"mat-form-field")(8,"mat-label"),g(9,"Column index"),p(),d(10,"input",4),D("ngModelChange",function(t){N(i);let n=C();return V(n.columnIndex,t)||(n.columnIndex=t),S(t)}),p()()(),d(11,"div",2)(12,"button",5),v("click",function(){N(i);let t=C();return S(t.load())}),g(13," Load list "),p()()}if(r&2){let i=C();_(6),O("ngModel",i.delimiter),_(4),O("ngModel",i.columnIndex)}}function Ge(r,u){if(r&1&&(d(0,"div",2)(1,"p"),g(2),p()()),r&2){let i=C(2);_(2),K("Filtered out common subpath: ",i.commonSubpath,"")}}function Ye(r,u){if(r&1&&(d(0,"div",2)(1,"p"),g(2),ae(3,"json"),p()()),r&2){let i=C(2);_(2),K("Found files with the following extensions: ",re(3,1,i.suffixMap),"")}}function je(r,u){if(r&1&&(d(0,"mat-option",14),g(1),p()),r&2){let i=u.$implicit;w("value",i.value),_(),oe(i.label)}}function Ke(r,u){if(r&1){let i=L();d(0,"p",1),g(1,"Cleaning"),p(),d(2,"div",2)(3,"button",6),v("click",function(){N(i);let t=C();return S(t.replaceBackslashes())}),g(4," \\ -> / "),p(),d(5,"button",7),v("click",function(){N(i);let t=C();return S(t.findAndRemoveCommonSubpath())}),g(6," Remove common "),p(),d(7,"button",8),v("click",function(){N(i);let t=C();return S(t.removeDirs())}),g(8," Remove dirs "),p(),d(9,"button",9),v("click",function(){N(i);let t=C();return S(t.removeFirst())}),g(10," Remove first "),p()(),j(11,Ge,3,1,"div",2)(12,Ye,4,3,"div",2),d(13,"p",1),g(14,"Paths"),p(),d(15,"div",2),P(16,"lib-ng-simple-table",10),p(),d(17,"p",1),g(18,"Matching"),p(),d(19,"div",11)(20,"mat-form-field",12)(21,"mat-label"),g(22,"Regex"),p(),d(23,"input",3),D("ngModelChange",function(t){N(i);let n=C();return V(n.regex,t)||(n.regex=t),S(t)}),p()(),d(24,"mat-form-field",12)(25,"mat-label"),g(26,"Predefined patterns"),p(),d(27,"mat-select",13),D("ngModelChange",function(t){N(i);let n=C();return V(n.regex,t)||(n.regex=t),S(t)}),ne(28,je,2,2,"mat-option",14,Ue),p()()(),d(30,"div",2),P(31,"lib-regex-highlighter",15),p(),d(32,"div",2)(33,"button",5),v("click",function(){N(i);let t=C();return S(t.findMatches())}),g(34," Find matches "),p()()}if(r&2){let i=C();_(11),A(i.commonSubpath?11:-1),_(),A(i.filteredOnlyFiles?12:-1),_(4),w("data",i.pathTable)("columnDefs",i.pathColumnDefs)("displayFilter",!1),_(7),O("ngModel",i.regex),_(4),O("ngModel",i.regex),_(),ie(i.predefinedRegexes),_(3),w("value",i.regex)}}function Qe(r,u){if(r&1){let i=L();d(0,"p",1),g(1,"Matches"),p(),d(2,"div",2),P(3,"lib-ng-simple-table",10),p(),d(4,"button",16),v("click",function(){N(i);let t=C();return S(t.toCSV(t.matchTable))}),d(5,"mat-icon"),g(6,"download"),p()()}if(r&2){let i=C();_(3),w("data",i.matchTable)("columnDefs",i.matchColumnDefs)("displayFilter",!1)}}function Ze(r,u){if(r&1){let i=L();d(0,"p",1),g(1,"Unique Matches"),p(),d(2,"div",2),P(3,"lib-ng-simple-table",10),p(),d(4,"button",16),v("click",function(){N(i);let t=C();return S(t.toCSV(t.uniqMatchTable))}),d(5,"mat-icon"),g(6,"download"),p()()}if(r&2){let i=C();_(3),w("data",i.uniqMatchTable)("columnDefs",i.uniqMatchColumnDefs)("displayFilter",!1)}}var Pt=(()=>{let u=class u{constructor(){this.columnIndex=0,this.delimiter=",",this.predefinedRegexes=[{label:"Numbering of inventory objects",value:"(\\d{2})\\.(\\d{2})\\.(\\d{2})\\.(\\d{3}\\.\\d{2})"},{label:"Location",value:"(\\d{2})\\.(\\d{2})\\.(\\d{2})(?:\\.\\d{3}\\.\\d{2})?"},{label:"Object",value:"(?:\\d{2}\\.\\d{2}\\.\\d{2})\\.(\\d{3}\\.\\d{2})"},{label:"Document type",value:"(K\\d\\.\\d{1,2})"}],this.regex=this.predefinedRegexes[0].value,this.regexColored="",this.pathTable=[],this.pathColumnDefs=[new R("rawPath","Original path"),new R("path","Resulting path")],this.commonSubpath="",this.suffixMap={},this.filteredOnlyFiles=!1,this.matchTable=[],this.matchColumnDefs=[],this.uniqMatchTable=[],this.uniqMatchColumnDefs=[new R("match","Match")]}ngOnInit(){console.log("Init")}load(){return X(this,null,function*(){let o=yield xe(),t=(0,U.parse)(o,{header:!1,delimiter:this.delimiter});this.pathTable=t.data.map(n=>({rawPath:n[this.columnIndex],path:n[this.columnIndex]}))})}replaceBackslashes(){this.pathTable=this.pathTable.map(o=>(o.path=o.path.replace(/\\/g,"/"),o))}toCSV(o){let t=(0,U.unparse)(o);ge(t,"data.csv")}removeFirst(){let o=[...this.pathTable];o.shift(),this.pathTable=o}findMatches(){let o=new RegExp(this.regex),t=[],n=new Set,c=[];this.pathTable.forEach(l=>{let h=o.exec(l.path);if(h){let T=h?.length;c.length||(c=this._regexColDefOfSize(T));let F={path:l.path};n.add(h[0]),c.forEach((b,W)=>{F[b.key]=h[W]}),t.push(F)}}),c=[new R("path","Path"),...c],this.matchTable=t,this.matchColumnDefs=c,this.uniqMatchTable=Array.from(n).map(l=>({match:l}))}findAndRemoveCommonSubpath(){let o=this.pathTable.map(l=>l.path);if(o.length===0)return;let t=o.reduce((l,h)=>l.length<h.length?l:h),n="";for(let l=0;l<t.length;l++){let h=t.substring(0,l+1);if(o.every(T=>T.startsWith(h)))n=h;else break}this.commonSubpath=n;let c=this.pathTable.map(l=>(l.path=l.path.replace(n,"").trim(),l));this.pathTable=c}removeDirs(){let{filtered:o,suffixMap:t}=De(this.pathTable);console.log(o),this.pathTable=o,this.suffixMap=t,this.filteredOnlyFiles=!0}_regexColDefOfSize(o){let t=[new R("col0","Full match")];for(let n=1;n<o;n++){let c=`col${n}`,l=`Group ${n}`;t.push(new R(c,l))}return t}};u.\u0275fac=function(t){return new(t||u)},u.\u0275cmp=B({type:u,selectors:[["app-file-path-context"]],standalone:!0,features:[$],decls:7,vars:4,consts:[["title","File path context"],[1,"header"],[1,"row"],["matInput","",3,"ngModelChange","ngModel"],["matInput","","type","number",3,"ngModelChange","ngModel"],["mat-stroked-button","",2,"margin-bottom","5px",3,"click"],["mat-stroked-button","","matTooltip","Replace backslashes with forward slashes",2,"margin-bottom","5px",3,"click"],["mat-stroked-button","","matTooltip","Find and remove common subpath",2,"margin-bottom","5px",3,"click"],["mat-stroked-button","","matTooltip","Remove directories from the list",2,"margin-bottom","5px",3,"click"],["mat-stroked-button","","matTooltip","Remove the first (header) row",2,"margin-bottom","5px",3,"click"],[2,"width","100%",3,"data","columnDefs","displayFilter"],[1,"row",2,"align-items","center"],[2,"width","50%"],[3,"ngModelChange","ngModel"],[3,"value"],[2,"font-size","1.2rem","line-height","1.4rem","margin-bottom","1rem",3,"value"],["mat-icon-button","","matTooltip","Download CSV",3,"click"]],template:function(t,n){t&1&&(d(0,"lib-page-section",0)(1,"p"),g(2," Provides tools to derive context from file paths. In AEC projects it's typical that a contextual meaning can be derived from the file naming convention. This section contains tools to extract and formalise this meaning. "),p(),j(3,We,14,2)(4,Ke,35,8)(5,Qe,7,3)(6,Ze,7,3),p()),t&2&&(_(3),A(n.pathTable.length?-1:3),_(),A(n.pathTable.length?4:-1),_(),A(n.matchTable.length?5:-1),_(),A(n.uniqMatchTable.length?6:-1))},dependencies:[z,se,he,fe,pe,ue,ke,Fe,Re,ve,Se,Ne,Pe,Ae,ce,Te,be,Ee,_e,Ce,Me,ye,Ve,de,me],styles:[".row[_ngcontent-%COMP%]{display:flex;gap:5px;font-size:.8em;overflow-y:auto}.header[_ngcontent-%COMP%]{font-size:1.3rem;margin-top:2rem}"]});let r=u;return r})();export{Pt as FilePathContextComponent};
