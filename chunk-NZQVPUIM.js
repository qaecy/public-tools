import{a as b,b as xe,c as E,d as g}from"./chunk-RLQXEM26.js";import{$a as De,A as et,Ab as se,Bb as oe,D as Pe,Db as yt,Ea as st,Eb as _t,Fb as Ct,G as tt,Gb as St,Ha as ot,Hb as Tt,J as X,Jb as ae,Kb as wt,L as it,Lb as Et,M as nt,Ma as at,N as rt,Na as Re,Nb as ce,Ob as U,Pb as G,Qa as Z,Qb as le,Ra as ct,Rb as $,Sa as lt,Sb as bt,Ta as dt,Ua as mt,Va as pt,Wa as ut,Xa as ft,Ya as ht,Za as It,_a as Fe,ab as C,ac as Pt,bb as M,cb as L,db as V,eb as gt,fb as x,gb as F,hb as D,ic as Rt,jb as ee,kb as te,lb as ie,nb as ne,nc as Ae,ob as B,qb as Q,rb as ve,sb as Me,tb as re,tc as Ft,ub as k,uc as Dt,vc as vt,wc as Mt,xb as H,z as I}from"./chunk-4NDDJHS7.js";import{a as be,b as Ze,j as d}from"./chunk-RZZ4GCVR.js";var de=class{constructor(){this.ifcStreamingSettings=new Ft,this.propertiesStreamingSettings=new Oe,this.namespace="https://web-bim/resources/",this.filePrefix="",this.includeLBDTriples=!0,this.lbdParserSettings=new Be,this.wasmPath={path:"https://unpkg.com/web-ifc@0.0.56/",absolute:!0}}},N=class{constructor(){this.tripleCount={bot:0,fso:0,products:0,qcy:0,dicon:0,bpo:0,geometry:0,total:0},this.progress={bot:0,fso:0,products:0,qcy:0,dicon:0,bpo:0,geometry:0,total:0},this.triples=""}},Oe=class extends vt{constructor(){super(...arguments),this.limitTypesTo=new Set}},Be=class{constructor(){this.namespace="https://web-bim/resources/",this.enabledParsers={products:!1,fso:!1,bot:!0,qcy:!1,dicon:!1,bpo:!1,geometry:!0},this.subSettings={products:new Ne,fso:new Le,bot:new ke,qcy:new Ue,dicon:new je,bpo:new Ge,geometry:new We},this.fileName="lbd.ttl"}},Ne=class{constructor(){this.includeParents=!0}},Le=class{constructor(){this.includePorts=!1,this.includePortPlacements=!0}};var ke=class{constructor(){this.includeInterfaces=!1}},Ue=class{constructor(){this.includeSelectors=!0,this.includeFamilyTypes=!0}};var Ge=class{constructor(){this.volumeProportionPredicate=`${E.qcy}volumeProportion`}},je=class{constructor(){this.includeMaterialLayers=!0}},We=class{constructor(){this.writeOBCData=!0,this.makeSpacesTransparent=!0,this.makeOpeningsInvisible=!0}};function me(s){let e=[],t=[s],i=0;for(;t.length;){let n=t.pop();switch(typeof n){case"boolean":i+=4;break;case"string":i+=n.length*2;break;case"number":i+=8;break;case"object":if(!e.includes(n)){e.push(n);for(let r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.push(n[r])}break}}return i}function pe(s,e=!1,t=1){let i=e?1e3:1024;if(Math.abs(s)<i)return s+" B";let n=e?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],r=-1,o=10**t;do s/=i,++r;while(Math.round(Math.abs(s)*o)/o>=i&&r<n.length-1);return s.toFixed(t)+" "+n[r]}var z=class{constructor(e){this._callback=e,this._idMap={},this._typeMap={},this._properties={},this._lastProgress=0,this._loggingIntervalPct=10}buildIDMap(e,t=!1){return d(this,null,function*(){return this._idMap={},this._typeMap={},this._streamer=e,e.onPropertiesStreamed.add(i=>d(this,null,function*(){for(let n of Object.keys(i.data)){let r=i.data[parseInt(n)];this._properties[parseInt(n)]=r;let o=yield this._buildUUID(r);o!==void 0&&(this._idMap[r.expressID]=o),r.type!==void 0&&(this._typeMap[r.expressID]=r.type)}})),new Promise(i=>{e.onProgress.add(n=>d(this,null,function*(){let r=Math.round(n*100);(r-this._lastProgress>=this._loggingIntervalPct||r===100)&&(this._lastProgress=r,this._callback!==void 0&&this._callback(r),t&&this._logStatus(n)),n===1&&i([this._idMap,this._typeMap,this._properties])}))})})}dispose(){this._streamer?.dispose()}_buildUUID(e){return d(this,null,function*(){let t=e.GlobalId?.value;if(t!==void 0)return yield b(t)})}_logStatus(e){let t=e*100,i=me(this._idMap),n=me(this._typeMap),r=me(this._properties),o=Object.keys(this._properties).length;console.info(`Property processing ${t} %. idMap: ${pe(i)}, typeMap: ${pe(n)}, properties: ${pe(r)} (${o} entities)`)}};var Ve={children:[{children:[{children:[{name:"IfcProject",id:103090709},{name:"IfcProjectLibrary",id:653396225}],name:"IfcContext",id:3419103109},{children:[{children:[{name:"IfcOccupant",id:4143007308}],name:"IfcActor",id:2296667514},{children:[{name:"IfcActionRequest",id:3821786052},{name:"IfcCostItem",id:3895139033},{name:"IfcCostSchedule",id:1419761937},{name:"IfcPerformanceHistory",id:2382730787},{name:"IfcPermit",id:3327091369},{name:"IfcProjectOrder",id:2904328755},{name:"IfcWorkCalendar",id:4088093105},{children:[{name:"IfcWorkPlan",id:4218914973},{name:"IfcWorkSchedule",id:3342526732}],name:"IfcWorkControl",id:1028945134}],name:"IfcControl",id:3293443760},{children:[{name:"IfcAsset",id:3460190687},{name:"IfcInventory",id:2391368822},{children:[{name:"IfcStructuralLoadCase",id:385403989}],name:"IfcStructuralLoadGroup",id:1252848954},{name:"IfcStructuralResultGroup",id:2986769608},{children:[{name:"IfcBuildingSystem",id:1177604601},{children:[{name:"IfcDistributionCircuit",id:562808652}],name:"IfcDistributionSystem",id:3205830791},{name:"IfcStructuralAnalysisModel",id:2515109513},{name:"IfcZone",id:1033361043}],name:"IfcSystem",id:2254336722}],name:"IfcGroup",id:2706460486},{children:[{name:"IfcEvent",id:4148101412},{name:"IfcProcedure",id:2744685151},{name:"IfcTask",id:3473067441}],name:"IfcProcess",id:2945172077},{children:[{name:"IfcAnnotation",id:1674181508},{children:[{children:[{children:[{name:"IfcBeamStandardCase",id:2906023776}],name:"IfcBeam",id:753842376},{name:"IfcBuildingElementProxy",id:1095909175},{name:"IfcChimney",id:3296154744},{children:[{name:"IfcColumnStandardCase",id:905975707}],name:"IfcColumn",id:843113511},{name:"IfcCovering",id:1973544240},{name:"IfcCurtainWall",id:3495092785},{children:[{name:"IfcDoorStandardCase",id:3242481149}],name:"IfcDoor",id:395920057},{name:"IfcFooting",id:900683007},{children:[{name:"IfcMemberStandardCase",id:1911478936}],name:"IfcMember",id:1073191201},{name:"IfcPile",id:1687234759},{children:[{name:"IfcPlateStandardCase",id:1156407060}],name:"IfcPlate",id:3171933400},{name:"IfcRailing",id:2262370178},{name:"IfcRamp",id:3024970846},{name:"IfcRampFlight",id:3283111854},{name:"IfcRoof",id:2016517767},{name:"IfcShadingDevice",id:1329646415},{children:[{name:"IfcSlabElementedCase",id:3127900445},{name:"IfcSlabStandardCase",id:3027962421}],name:"IfcSlab",id:1529196076},{name:"IfcStair",id:331165859},{name:"IfcStairFlight",id:4252922144},{children:[{name:"IfcWallElementedCase",id:4156078855},{name:"IfcWallStandardCase",id:3512223829}],name:"IfcWall",id:2391406946},{children:[{name:"IfcWindowStandardCase",id:486154966}],name:"IfcWindow",id:3304561284}],name:"IfcBuildingElement",id:3299480353},{name:"IfcCivilElement",id:1677625105},{children:[{children:[{name:"IfcActuator",id:4288193352},{name:"IfcAlarm",id:3087945054},{name:"IfcController",id:25142252},{name:"IfcFlowInstrument",id:182646315},{name:"IfcProtectiveDeviceTrippingUnit",id:2295281155},{name:"IfcSensor",id:4086658281},{name:"IfcUnitaryControlElement",id:630975310}],name:"IfcDistributionControlElement",id:1062813311},{children:[{name:"IfcDistributionChamberElement",id:1052013943},{children:[{name:"IfcAirToAirHeatRecovery",id:2056796094},{name:"IfcBoiler",id:32344328},{name:"IfcBurner",id:2938176219},{name:"IfcChiller",id:3902619387},{name:"IfcCoil",id:639361253},{name:"IfcCondenser",id:2272882330},{name:"IfcCooledBeam",id:4136498852},{name:"IfcCoolingTower",id:3640358203},{name:"IfcElectricGenerator",id:264262732},{name:"IfcElectricMotor",id:402227799},{name:"IfcEngine",id:2814081492},{name:"IfcEvaporativeCooler",id:3747195512},{name:"IfcEvaporator",id:484807127},{name:"IfcHeatExchanger",id:3319311131},{name:"IfcHumidifier",id:2068733104},{name:"IfcMotorConnection",id:2474470126},{name:"IfcSolarDevice",id:3420628829},{name:"IfcTransformer",id:3825984169},{name:"IfcTubeBundle",id:3026737570},{name:"IfcUnitaryEquipment",id:4292641817}],name:"IfcEnergyConversionDevice",id:1658829314},{children:[{name:"IfcAirTerminalBox",id:177149247},{name:"IfcDamper",id:4074379575},{name:"IfcElectricDistributionBoard",id:862014818},{name:"IfcElectricTimeControl",id:1003880860},{name:"IfcFlowMeter",id:2188021234},{name:"IfcProtectiveDevice",id:738039164},{name:"IfcSwitchingDevice",id:1162798199},{name:"IfcValve",id:4207607924}],name:"IfcFlowController",id:2058353004},{children:[{name:"IfcCableCarrierFitting",id:635142910},{name:"IfcCableFitting",id:1051757585},{name:"IfcDuctFitting",id:342316401},{name:"IfcJunctionBox",id:2176052936},{name:"IfcPipeFitting",id:310824031}],name:"IfcFlowFitting",id:4278956645},{children:[{name:"IfcCompressor",id:3571504051},{name:"IfcFan",id:3415622556},{name:"IfcPump",id:90941305}],name:"IfcFlowMovingDevice",id:3132237377},{children:[{name:"IfcCableCarrierSegment",id:3758799889},{name:"IfcCableSegment",id:4217484030},{name:"IfcDuctSegment",id:3518393246},{name:"IfcPipeSegment",id:3612865200}],name:"IfcFlowSegment",id:987401354},{children:[{name:"IfcElectricFlowStorageDevice",id:3310460725},{name:"IfcTank",id:812556717}],name:"IfcFlowStorageDevice",id:707683696},{children:[{name:"IfcAirTerminal",id:1634111441},{name:"IfcAudioVisualAppliance",id:277319702},{name:"IfcCommunicationsAppliance",id:3221913625},{name:"IfcElectricAppliance",id:1904799276},{name:"IfcFireSuppressionTerminal",id:1426591983},{name:"IfcLamp",id:76236018},{name:"IfcLightFixture",id:629592764},{name:"IfcMedicalDevice",id:1437502449},{name:"IfcOutlet",id:3694346114},{name:"IfcSanitaryTerminal",id:3053780830},{name:"IfcSpaceHeater",id:1999602285},{name:"IfcStackTerminal",id:1404847402},{name:"IfcWasteTerminal",id:4237592921}],name:"IfcFlowTerminal",id:2223149337},{children:[{name:"IfcDuctSilencer",id:1360408905},{name:"IfcFilter",id:819412036},{name:"IfcInterceptor",id:4175244083}],name:"IfcFlowTreatmentDevice",id:3508470533}],name:"IfcDistributionFlowElement",id:3040386961}],name:"IfcDistributionElement",id:1945004755},{name:"IfcElementAssembly",id:4123344466},{children:[{name:"IfcBuildingElementPart",id:2979338954},{name:"IfcDiscreteAccessory",id:1335981549},{name:"IfcFastener",id:647756555},{name:"IfcMechanicalFastener",id:377706215},{children:[{name:"IfcReinforcingBar",id:979691226},{name:"IfcReinforcingMesh",id:2320036040},{name:"IfcTendon",id:3824725483},{name:"IfcTendonAnchor",id:2347447852}],name:"IfcReinforcingElement",id:3027567501},{name:"IfcVibrationIsolator",id:2391383451}],name:"IfcElementComponent",id:1623761950},{children:[{children:[{name:"IfcProjectionElement",id:3651124850}],name:"IfcFeatureElementAddition",id:2143335405},{children:[{children:[{name:"IfcOpeningStandardCase",id:3079942009}],name:"IfcOpeningElement",id:3588315303},{name:"IfcVoidingFeature",id:926996030}],name:"IfcFeatureElementSubtraction",id:1287392070},{name:"IfcSurfaceFeature",id:3101698114}],name:"IfcFeatureElement",id:2827207264},{children:[{name:"IfcFurniture",id:1509553395},{name:"IfcSystemFurnitureElement",id:413509423}],name:"IfcFurnishingElement",id:263784265},{name:"IfcGeographicElement",id:3493046030},{name:"IfcTransportElement",id:1620046519},{name:"IfcVirtualElement",id:2769231204}],name:"IfcElement",id:1758889154},{name:"IfcGrid",id:3009204131},{children:[{name:"IfcDistributionPort",id:3041715199}],name:"IfcPort",id:3740093272},{name:"IfcProxy",id:3219374653},{children:[{children:[{name:"IfcExternalSpatialElement",id:1209101575}],name:"IfcExternalSpatialStructureElement",id:2853485674},{children:[{name:"IfcBuilding",id:4031249490},{name:"IfcBuildingStorey",id:3124254112},{name:"IfcSite",id:4097777520},{name:"IfcSpace",id:3856911033}],name:"IfcSpatialStructureElement",id:2706606064},{name:"IfcSpatialZone",id:463610769}],name:"IfcSpatialElement",id:1412071761},{children:[{children:[{children:[{name:"IfcStructuralLinearAction",id:1807405624}],name:"IfcStructuralCurveAction",id:1004757350},{name:"IfcStructuralPointAction",id:2082059205},{children:[{name:"IfcStructuralPlanarAction",id:1621171031}],name:"IfcStructuralSurfaceAction",id:3657597509}],name:"IfcStructuralAction",id:682877961},{children:[{name:"IfcStructuralCurveReaction",id:2757150158},{name:"IfcStructuralPointReaction",id:1235345126},{name:"IfcStructuralSurfaceReaction",id:603775116}],name:"IfcStructuralReaction",id:3689010777}],name:"IfcStructuralActivity",id:3544373492},{children:[{children:[{name:"IfcStructuralCurveConnection",id:4243806635},{name:"IfcStructuralPointConnection",id:734778138},{name:"IfcStructuralSurfaceConnection",id:1975003073}],name:"IfcStructuralConnection",id:1179482911},{children:[{children:[{name:"IfcStructuralCurveMemberVarying",id:2445595289}],name:"IfcStructuralCurveMember",id:214636428},{children:[{name:"IfcStructuralSurfaceMemberVarying",id:2218152070}],name:"IfcStructuralSurfaceMember",id:3979015343}],name:"IfcStructuralMember",id:530289379}],name:"IfcStructuralItem",id:3136571912}],name:"IfcProduct",id:4208778838},{children:[{children:[{name:"IfcConstructionEquipmentResource",id:3898045240},{name:"IfcConstructionMaterialResource",id:1060000209},{name:"IfcConstructionProductResource",id:488727124},{name:"IfcCrewResource",id:3295246426},{name:"IfcLaborResource",id:3827777499},{name:"IfcSubContractResource",id:148013059}],name:"IfcConstructionResource",id:2559216714}],name:"IfcResource",id:2914609552}],name:"IfcObject",id:3888040117},{children:[{children:[{name:"IfcEventType",id:4024345920},{name:"IfcProcedureType",id:569719735},{name:"IfcTaskType",id:3206491090}],name:"IfcTypeProcess",id:3736923433},{children:[{name:"IfcDoorStyle",id:526551008},{children:[{children:[{name:"IfcBeamType",id:819618141},{name:"IfcBuildingElementProxyType",id:1909888760},{name:"IfcChimneyType",id:2197970202},{name:"IfcColumnType",id:300633059},{name:"IfcCoveringType",id:1916426348},{name:"IfcCurtainWallType",id:1457835157},{name:"IfcDoorType",id:2323601079},{name:"IfcFootingType",id:1893162501},{name:"IfcMemberType",id:3181161470},{name:"IfcPileType",id:1158309216},{name:"IfcPlateType",id:4017108033},{name:"IfcRailingType",id:2893384427},{name:"IfcRampFlightType",id:2324767716},{name:"IfcRampType",id:1469900589},{name:"IfcRoofType",id:2781568857},{name:"IfcShadingDeviceType",id:4074543187},{name:"IfcSlabType",id:2533589738},{name:"IfcStairFlightType",id:1039846685},{name:"IfcStairType",id:338393293},{name:"IfcWallType",id:1898987631},{name:"IfcWindowType",id:4009809668}],name:"IfcBuildingElementType",id:1950629157},{name:"IfcCivilElementType",id:3893394355},{children:[{children:[{name:"IfcActuatorType",id:2874132201},{name:"IfcAlarmType",id:3001207471},{name:"IfcControllerType",id:578613899},{name:"IfcFlowInstrumentType",id:4037862832},{name:"IfcProtectiveDeviceTrippingUnitType",id:655969474},{name:"IfcSensorType",id:1783015770},{name:"IfcUnitaryControlElementType",id:3179687236}],name:"IfcDistributionControlElementType",id:2063403501},{children:[{name:"IfcDistributionChamberElementType",id:1599208980},{children:[{name:"IfcAirToAirHeatRecoveryType",id:1871374353},{name:"IfcBoilerType",id:231477066},{name:"IfcBurnerType",id:2188180465},{name:"IfcChillerType",id:2951183804},{name:"IfcCoilType",id:2301859152},{name:"IfcCondenserType",id:2816379211},{name:"IfcCooledBeamType",id:335055490},{name:"IfcCoolingTowerType",id:2954562838},{name:"IfcElectricGeneratorType",id:1534661035},{name:"IfcElectricMotorType",id:1217240411},{name:"IfcEngineType",id:132023988},{name:"IfcEvaporativeCoolerType",id:3174744832},{name:"IfcEvaporatorType",id:3390157468},{name:"IfcHeatExchangerType",id:1251058090},{name:"IfcHumidifierType",id:1806887404},{name:"IfcMotorConnectionType",id:977012517},{name:"IfcSolarDeviceType",id:1072016465},{name:"IfcTransformerType",id:1692211062},{name:"IfcTubeBundleType",id:1600972822},{name:"IfcUnitaryEquipmentType",id:1911125066}],name:"IfcEnergyConversionDeviceType",id:2107101300},{children:[{name:"IfcAirTerminalBoxType",id:1411407467},{name:"IfcDamperType",id:3961806047},{name:"IfcElectricDistributionBoardType",id:2417008758},{name:"IfcElectricTimeControlType",id:712377611},{name:"IfcFlowMeterType",id:3815607619},{name:"IfcProtectiveDeviceType",id:1842657554},{name:"IfcSwitchingDeviceType",id:2315554128},{name:"IfcValveType",id:728799441}],name:"IfcFlowControllerType",id:3907093117},{children:[{name:"IfcCableCarrierFittingType",id:395041908},{name:"IfcCableFittingType",id:2674252688},{name:"IfcDuctFittingType",id:869906466},{name:"IfcJunctionBoxType",id:4288270099},{name:"IfcPipeFittingType",id:804291784}],name:"IfcFlowFittingType",id:3198132628},{children:[{name:"IfcCompressorType",id:3850581409},{name:"IfcFanType",id:346874300},{name:"IfcPumpType",id:2250791053}],name:"IfcFlowMovingDeviceType",id:1482959167},{children:[{name:"IfcCableCarrierSegmentType",id:3293546465},{name:"IfcCableSegmentType",id:1285652485},{name:"IfcDuctSegmentType",id:3760055223},{name:"IfcPipeSegmentType",id:4231323485}],name:"IfcFlowSegmentType",id:1834744321},{children:[{name:"IfcElectricFlowStorageDeviceType",id:3277789161},{name:"IfcTankType",id:5716631}],name:"IfcFlowStorageDeviceType",id:1339347760},{children:[{name:"IfcAirTerminalType",id:3352864051},{name:"IfcAudioVisualApplianceType",id:1532957894},{name:"IfcCommunicationsApplianceType",id:400855858},{name:"IfcElectricApplianceType",id:663422040},{name:"IfcFireSuppressionTerminalType",id:4222183408},{name:"IfcLampType",id:1051575348},{name:"IfcLightFixtureType",id:1161773419},{name:"IfcMedicalDeviceType",id:1114901282},{name:"IfcOutletType",id:2837617999},{name:"IfcSanitaryTerminalType",id:1768891740},{name:"IfcSpaceHeaterType",id:1305183839},{name:"IfcStackTerminalType",id:3112655638},{name:"IfcWasteTerminalType",id:1133259667}],name:"IfcFlowTerminalType",id:2297155007},{children:[{name:"IfcDuctSilencerType",id:2030761528},{name:"IfcFilterType",id:1810631287},{name:"IfcInterceptorType",id:3946677679}],name:"IfcFlowTreatmentDeviceType",id:3009222698}],name:"IfcDistributionFlowElementType",id:3849074793}],name:"IfcDistributionElementType",id:3256556792},{name:"IfcElementAssemblyType",id:2397081782},{children:[{name:"IfcBuildingElementPartType",id:39481116},{name:"IfcDiscreteAccessoryType",id:2635815018},{name:"IfcFastenerType",id:2489546625},{name:"IfcMechanicalFastenerType",id:2108223431},{children:[{name:"IfcReinforcingBarType",id:2572171363},{name:"IfcReinforcingMeshType",id:2310774935},{name:"IfcTendonAnchorType",id:3081323446},{name:"IfcTendonType",id:2415094496}],name:"IfcReinforcingElementType",id:964333572},{name:"IfcVibrationIsolatorType",id:3313531582}],name:"IfcElementComponentType",id:2590856083},{children:[{name:"IfcFurnitureType",id:1268542332},{name:"IfcSystemFurnitureElementType",id:1580310250}],name:"IfcFurnishingElementType",id:4238390223},{name:"IfcGeographicElementType",id:4095422895},{name:"IfcTransportElementType",id:2097647324}],name:"IfcElementType",id:339256511},{children:[{children:[{name:"IfcSpaceType",id:3812236995}],name:"IfcSpatialStructureElementType",id:3893378262},{name:"IfcSpatialZoneType",id:2481509218}],name:"IfcSpatialElementType",id:710998568},{name:"IfcWindowStyle",id:1299126871}],name:"IfcTypeProduct",id:2347495698},{children:[{children:[{name:"IfcConstructionEquipmentResourceType",id:2185764099},{name:"IfcConstructionMaterialResourceType",id:4105962743},{name:"IfcConstructionProductResourceType",id:1525564444},{name:"IfcCrewResourceType",id:1815067380},{name:"IfcLaborResourceType",id:428585644},{name:"IfcSubContractResourceType",id:4095615324}],name:"IfcConstructionResourceType",id:2574617495}],name:"IfcTypeResource",id:3698973494}],name:"IfcTypeObject",id:1628702193}],name:"IfcObjectDefinition",id:219451334},{children:[{children:[{children:[{name:"IfcDoorLiningProperties",id:2963535650},{name:"IfcDoorPanelProperties",id:1714330368},{name:"IfcPermeableCoveringProperties",id:3566463478},{name:"IfcReinforcementDefinitionProperties",id:3765753017},{name:"IfcWindowLiningProperties",id:336235671},{name:"IfcWindowPanelProperties",id:512836454}],name:"IfcPreDefinedPropertySet",id:3967405729},{name:"IfcPropertySet",id:1451395588},{children:[{name:"IfcElementQuantity",id:1883228015}],name:"IfcQuantitySet",id:2090586900}],name:"IfcPropertySetDefinition",id:3357820518},{children:[{name:"IfcPropertySetTemplate",id:492091185},{children:[{name:"IfcComplexPropertyTemplate",id:3875453745},{name:"IfcSimplePropertyTemplate",id:3663146110}],name:"IfcPropertyTemplate",id:3521284610}],name:"IfcPropertyTemplateDefinition",id:1482703590}],name:"IfcPropertyDefinition",id:1680319473},{children:[{children:[{name:"IfcRelAssignsToActor",id:1683148259},{name:"IfcRelAssignsToControl",id:2495723537},{children:[{name:"IfcRelAssignsToGroupByFactor",id:1027710054}],name:"IfcRelAssignsToGroup",id:1307041759},{name:"IfcRelAssignsToProcess",id:4278684876},{name:"IfcRelAssignsToProduct",id:2857406711},{name:"IfcRelAssignsToResource",id:205026976}],name:"IfcRelAssigns",id:3939117080},{children:[{name:"IfcRelAssociatesApproval",id:4095574036},{name:"IfcRelAssociatesClassification",id:919958153},{name:"IfcRelAssociatesConstraint",id:2728634034},{name:"IfcRelAssociatesDocument",id:982818633},{name:"IfcRelAssociatesLibrary",id:3840914261},{name:"IfcRelAssociatesMaterial",id:2655215786}],name:"IfcRelAssociates",id:1865459582},{children:[{children:[{name:"IfcRelConnectsPathElements",id:3945020480},{name:"IfcRelConnectsWithRealizingElements",id:3678494232}],name:"IfcRelConnectsElements",id:1204542856},{name:"IfcRelConnectsPortToElement",id:4201705270},{name:"IfcRelConnectsPorts",id:3190031847},{name:"IfcRelConnectsStructuralActivity",id:2127690289},{children:[{name:"IfcRelConnectsWithEccentricity",id:504942748}],name:"IfcRelConnectsStructuralMember",id:1638771189},{name:"IfcRelContainedInSpatialStructure",id:3242617779},{name:"IfcRelCoversBldgElements",id:886880790},{name:"IfcRelCoversSpaces",id:2802773753},{name:"IfcRelFillsElement",id:3940055652},{name:"IfcRelFlowControlElements",id:279856033},{name:"IfcRelInterferesElements",id:427948657},{name:"IfcRelReferencedInSpatialStructure",id:1245217292},{name:"IfcRelSequence",id:4122056220},{name:"IfcRelServicesBuildings",id:366585022},{children:[{children:[{name:"IfcRelSpaceBoundary2ndLevel",id:1521410863}],name:"IfcRelSpaceBoundary1stLevel",id:3523091289}],name:"IfcRelSpaceBoundary",id:3451746338}],name:"IfcRelConnects",id:826625072},{name:"IfcRelDeclares",id:2565941209},{children:[{name:"IfcRelAggregates",id:160246688},{name:"IfcRelNests",id:3268803585},{name:"IfcRelProjectsElement",id:750771296},{name:"IfcRelVoidsElement",id:1401173127}],name:"IfcRelDecomposes",id:2551354335},{children:[{name:"IfcRelDefinesByObject",id:1462361463},{name:"IfcRelDefinesByProperties",id:4186316022},{name:"IfcRelDefinesByTemplate",id:307848117},{name:"IfcRelDefinesByType",id:781010003}],name:"IfcRelDefines",id:693640335}],name:"IfcRelationship",id:478536968}],name:"IfcRoot",id:2341007311};function q(s,e,t=!1){return d(this,null,function*(){return new Promise(i=>{let r=[..._(e),e],o=Object.values(s).filter(a=>r.includes(a.type)).map(a=>t?a:a.expressID);i(o)})})}function _(s){let e=[],t=i(Ve,s);return t&&n(t,e),e;function i(r,o){if(r.id==o)return r;if(r.children!=null){let a,c=null;for(a=0;c==null&&a<r.children.length;a++)c=i(r.children[a],o);return c}return null}function n(r,o=[]){if(o.push(r.id),r.children)for(let a=0;a<r.children.length;a++)n(r.children[a],o)}}function At(s,e){let t=xt(Ve,s);if(e===void 0)return t;let i=t.indexOf(e);return t.slice(i)}function xt(s,e,t=[]){if(s.id===e)return[...t,s.id];if(s.children)for(let i of s.children){let n=xt(i,e,[...t,s.id]);if(n.length>0)return n}return[]}function Ot(s){return d(this,null,function*(){return new Promise(e=>{let t={};Object.values(s).forEach(i=>{i.RelatingPort?.value!==void 0&&i.RelatedPort?.value!==void 0&&(t[i.RelatingPort.value]=i.RelatedPort.value)}),e(t)})})}function Bt(s){return d(this,null,function*(){return new Promise(e=>{let t={};Object.values(s).forEach(i=>{i.RelatingPort?.value!==void 0&&i.RelatedElement?.value!==void 0&&(t[i.RelatingPort.value]=i.RelatedElement.value)}),Object.values(s).forEach(i=>{i.RelatedObjects?.value!==void 0&&i.RelatingObject?.value!==void 0&&i.RelatedObjects.forEach(n=>{t[n.value]=i.RelatingObject.value})}),e(t)})})}var Nt={2254336722:["fso:DistributionSystem"],3740093272:["fso:Port"],987401354:["fso:Segment","fso:Component"],4278956645:["fso:Fitting","fso:Component"],2058353004:["fso:FlowController","fso:Component"],1658829314:["fso:EnergyConversionDevice","fso:Component"],3132237377:["fso:FlowMovingDevice","fso:Component"],707683696:["fso:StorageDevice","fso:Component"],2223149337:["fso:Terminal","fso:Component"],3508470533:["fso:TreatmentDevice","fso:Component"]};function Lt(s){return d(this,null,function*(){return new Promise(e=>{let t=Object.keys(Nt),i={};Object.values(s).filter(n=>n.type!==void 0).filter(n=>t.includes(n.type.toString())).forEach(n=>{i[n.expressID]=Nt[n.type]}),e(i)})})}function kt(s){return d(this,null,function*(){return new Promise(e=>{let t={};Object.values(s).filter(i=>i.type===H).filter(i=>i.RelatingGroup!==void 0&&i.RelatedObjects!==void 0).forEach(i=>{let n=i.RelatingGroup.value;i.RelatedObjects.forEach(r=>{let o=r.value;Object.keys(t).includes(n.toString())?t[n].push(o):t[n]=[o]})}),e(t)})})}function Qe(s){return`inst:${b(s)}`}function ue(s,e){return Qe(`LayerSet_${e}_${s}`)}function fe(s,e){return Qe(`element_parentUUID_${s}`)}function Ut(s,e){let t=e[s];return Qe(`geometry_${t}`)}function f(s,e,t){let i=e[s];if(i===void 0)if(t!==void 0)i=b(t+s),e[s]=i;else throw new Error(`ExpressId ${s} not in idMap and modelUUID is not defined`);return`inst:${i}`}function w(){return d(this,null,function*(){return typeof window>"u"&&typeof process=="object"?yield import("./chunk-ZGN6ROUQ.js"):yield import("./chunk-CL7YQ3JL.js")})}var Y,he="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",Ie=class{constructor(e,t,i,n){this._writer=e,this._idMap=t,this._settings=i,this._callback=n,this._tripleCount=0,this._pct=0,this._properties={}}init(e){return d(this,null,function*(){Y=(yield w()).DataFactory,this._properties=e})}full(){return d(this,null,function*(){let e=7.6923076923076925;return yield Promise.all([this.getSites(e),this.getBuildings(e),this.getStoreys(e),this.getSpaces(e),this.getElements(e),this.getSpaceAdjacentElementRelationships(e),this.getSpaceContainedElementRelationships(e),this.getStoreyElementRelationships(e),this.getSubElementRelationships(e),this.getAdjacentElementRelationships(e),this.getStoreySpaceRelationships(e),this.getBuildingStoreyRelationships(e),this.getSiteBuildingRelationships(e)]),this._setFinish(),this._tripleCount})}getSites(e){return d(this,null,function*(){yield this._writeClasses([M],"bot:Site"),this._incrementPct(e)})}getBuildings(e){return d(this,null,function*(){yield this._writeClasses([D],"bot:Building"),this._incrementPct(e)})}getStoreys(e){return d(this,null,function*(){yield this._writeClasses([F],"bot:Storey"),this._incrementPct(e)})}getSpaces(e){return d(this,null,function*(){yield this._writeClasses([C],"bot:Space"),this._incrementPct(e)})}getElements(e){return d(this,null,function*(){let t=_(x);yield this._writeClasses(t,"bot:Element"),this._incrementPct(e)})}getSpaceAdjacentElementRelationships(e){return d(this,null,function*(){let t=_(te);yield this._writeOneToOneRel(t,"RelatingSpace","RelatedBuildingElement","bot:adjacentElement"),this._incrementPct(e)})}getSpaceContainedElementRelationships(e){return d(this,null,function*(){let t=_(Q);yield this._writeOneToManyRel(t,"RelatingStructure","RelatedElements","bot:containsElement",[C]),this._incrementPct(e)})}getStoreyElementRelationships(e){return d(this,null,function*(){let t=_(Q);yield this._writeOneToManyRel(t,"RelatingStructure","RelatedElements","bot:hasElement",[F]),this._incrementPct(e)})}getSubElementRelationships(e){return d(this,null,function*(){yield this._writeOpeningFills(),this._incrementPct(e)})}getAdjacentElementRelationships(e){return d(this,null,function*(){let t=_(re);yield this._writeOneToOneRel(t,"RelatingElement","RelatedElement","bot:adjacentElement"),this._incrementPct(e)})}getStoreySpaceRelationships(e){return d(this,null,function*(){yield this._writeOneToManyRel([L],"RelatingObject","RelatedObjects","bot:hasSpace",[F],[C]),this._incrementPct(e)})}getBuildingStoreyRelationships(e){return d(this,null,function*(){yield this._writeOneToManyRel([L],"RelatingObject","RelatedObjects","bot:hasStorey",[D],[F]),this._incrementPct(e)})}getSiteBuildingRelationships(e){return d(this,null,function*(){yield this._writeOneToManyRel([L],"RelatingObject","RelatedObjects","bot:hasBuilding",[M],[D]),this._incrementPct(e)})}_writeClasses(e,t){return d(this,null,function*(){let i=Object.values(this._properties).filter(n=>e.includes(n.type));for(let n of i){let r=f(n.expressID,this._idMap),{namedNode:o}=Y;this._writer.addQuad(o(r),o(he),o(t)),this._tripleCount++}})}_getOneToOneRel(e,t,i){return Object.values(this._properties).filter(n=>e.includes(n.type)).filter(n=>n[t]?.value!==void 0).filter(n=>n[i]?.value!==void 0).map(n=>{let r=n[t].value,o=n[i].value;return{sourceId:r,targetId:o,relationshipItem:n}})}_writeOneToOneRel(e,t,i,n){return d(this,null,function*(){let r=this._getOneToOneRel(e,t,i),{namedNode:o}=Y;for(let a of r){let c=f(a.sourceId,this._idMap),l=f(a.targetId,this._idMap);if(this._writer.addQuad(o(c),o(n),o(l)),this._incrementTripleCount(),this._settings.includeInterfaces){let m=f(a.relationshipItem.expressID,this._idMap);this._writer.addQuad(o(m),o(he),o("bot:Interface")),this._writer.addQuad(o(m),o("bot:interfaceOf"),o(c)),this._writer.addQuad(o(m),o("bot:interfaceOf"),o(l)),this._incrementTripleCount(3)}}})}_writeOneToManyRel(e,t,i,n,r,o){return d(this,null,function*(){let{namedNode:a}=Y,c=Object.values(this._properties).filter(l=>l!==void 0).filter(l=>e.includes(l.type)).filter(l=>l[t]!==void 0).filter(l=>l[i]!==void 0);for(let l of c){let m=l[t].value,p=l[i],u=this._properties[m];if(u===void 0||r!==void 0&&!r.includes(u.type))continue;let h=f(m,this._idMap);for(let y of p){let P=this._properties[y.value];if(!P){console.warn(`${y.value} not available in properties - because it's an asset?`);continue}if(o!==void 0&&!o.includes(P.type))continue;let S=f(y.value,this._idMap);if(this._writer.addQuad(a(h),a(n),a(S)),this._incrementTripleCount(),this._settings.includeInterfaces){let T=f(l.expressID,this._idMap);this._writer.addQuad(a(T),a(he),a("bot:Interface")),this._writer.addQuad(a(T),a("bot:interfaceOf"),a(h)),this._writer.addQuad(a(T),a("bot:interfaceOf"),a(S)),this._incrementTripleCount(3)}}}})}_writeOpeningFills(){return d(this,null,function*(){let{namedNode:e}=Y,t=this._getOneToOneRel([ee],"RelatingBuildingElement","RelatedOpeningElement"),i=this._getOneToOneRel([ne],"RelatingOpeningElement","RelatedBuildingElement");for(let n of i){let r=n.sourceId,o=t.find(p=>p.targetId===r);if(o===void 0)continue;let a=o.targetId,c=n.sourceId,l=f(a,this._idMap),m=f(c,this._idMap);if(this._writer.addQuad(e(l),e("bot:hasSubElement"),e(m)),this._incrementTripleCount(),this._settings.includeInterfaces){let p=f(r,this._idMap);this._writer.addQuad(e(p),e(he),e("bot:Interface")),this._writer.addQuad(e(p),e("bot:interfaceOf"),e(l)),this._writer.addQuad(e(p),e("bot:interfaceOf"),e(m)),this._incrementTripleCount(3)}}})}_incrementTripleCount(e=1){this._tripleCount+=e,this._callback!==void 0&&this._callback(this._tripleCount,this._pct)}_incrementPct(e=10){this._pct+=e,this._callback!==void 0&&this._callback(this._tripleCount,this._pct)}_setFinish(){this._pct=100,this._callback!==void 0&&this._callback(this._tripleCount,this._pct)}};function $e(s,e,t=[0,0,0]){let i=s[e],n=s[i.RelativePlacement.value],o=s[n.Location.value].Coordinates,a=[];if(o!=null&&o.length==3){let c=He(o[0].value),l=He(o[1].value),m=He(o[2].value);a=[c,l,m]}return t=si(a,t),i.PlacementRelTo?$e(s,i.PlacementRelTo.value,t):t}function si(s,e){let t=s[0]+e[0],i=s[1]+e[1],n=s[2]+e[2];return[t,i,n]}function He(s){return Math.round(s*1e5)/1e5}var ze=function(s){return s.LENGTHUNIT="LENGTHUNIT",s.AREAUNIT="AREAUNIT",s.VOLUMEUNIT="VOLUMEUNIT",s}(ze||{}),Gt={MILLI:.001,CENTI:.01,DECI:.1,NONE:1,DECA:10,HECTO:100,KILO:1e3};var ge=class s{constructor(e){this._properties=e}static getInstance(e){return this._instance?this._instance:(this._instance=new s(e),this._instance)}getLengthMultiplicationFactor(){return d(this,null,function*(){let e=this._allUnits;return this._allUnits===void 0&&(e=yield this.getUnitsOfModel()),e[ze.LENGTHUNIT]})}getUnitsOfModel(){return d(this,null,function*(){let e=yield q(this._properties,ae);if(!e.length)throw new Error("Found no units in model. Did you include IFCUNITASSIGNMENT in property types?");let t=this._properties[e[0]].Units.map(i=>this._properties[i.value]??i.value);return this._allUnits={},Object.values(ze).forEach(i=>{let n=t.find(r=>r.UnitType&&r.UnitType.value===i);if(n){let r=n.Prefix,o;r===null?o=Gt.NONE:o=Gt[r.value],this._allUnits[i]=o}}),this._allUnits})}};var O,ye="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",_e=class{constructor(e,t,i,n){this._writer=e,this._idMap=t,this._settings=i,this._callback=n,this._tripleCount=0,this._pct=0,this._properties={}}init(e){return d(this,null,function*(){O=(yield w()).DataFactory,this._properties=e,this._units=ge.getInstance(e)})}full(){return d(this,null,function*(){let t=yield this.addPorts(20);return yield Promise.all([this.addTypes(20),this.addSystems(t,20),this.getConnections(20),this._getPortPlacements(20)]),this._setFinish(),this._tripleCount})}addTypes(e){return d(this,null,function*(){let{namedNode:t}=O,i=yield Lt(this._properties),n=e/Object.keys(i).length;for(let r of Object.keys(i)){let o=f(parseInt(r),this._idMap);i[parseInt(r)].forEach(c=>{this._writer.addQuad(t(o),t(ye),t(c)),this._incrementTripleCount()}),this._incrementPct(n)}})}addSystems(e,t){return d(this,null,function*(){let i=yield kt(this._properties),{namedNode:n,literal:r}=O,o=t/Object.keys(i).length;for(let a of Object.keys(i)){let c=this._properties[parseInt(a)];if(c===void 0){console.info("Skipping unknown system "+a);continue}let l=f(parseInt(a),this._idMap);this._writer.addQuad(n(l),n("rdfs:label"),r(c.Name.value)),this._incrementTripleCount();for(let m of i[a])if(!e.includes(m)){let p=f(m,this._idMap);this._writer.addQuad(n(l),n("fso:hasComponent"),n(p)),this._incrementTripleCount()}this._incrementPct(o)}})}addPorts(e){return d(this,null,function*(){let{namedNode:t,literal:i}=O,n=yield q(this._properties,V,!0),r=[],o=!1,a=e/n.length;for(let c of n){if(this._settings.includePorts){let l=f(c.expressID,this._idMap);this._writer.addQuad(t(l),t(ye),t("fso:Port")),this._writer.addQuad(t(l),t("rdfs:label"),i(c.Name.value)),this._writer.addQuad(t(l),t("schema:name"),i(c.Name.value)),this._incrementTripleCount(3);let m=c.FlowDirection.value,p={SINK:"fso:InPort",SOURCE:"fso:OutPort",SOURCEANDSINK:"fso:BidirectionalPort",NOTDEFINED:"fso:BidirectionalPort"};Object.keys(p).includes(m)&&(!o&&p[m]!="fso:BidirectionalPort"&&(o=!0),this._writer.addQuad(t(l),t(ye),t(p[m])),this._incrementTripleCount())}r.push(c.expressID),this._incrementPct(a)}return o||console.warn("None of the ports in the model are directed, and therefore, it was not possible to determine flow directions!"),r})}getConnections(e){return d(this,null,function*(){let{namedNode:t}=O,[i,n]=yield Promise.all([this._getPortPortConnections(),this._getPortComponentConnections()]),r=Object.keys(n).map(a=>parseInt(a)),o=e/r.length;for(let a of r){let c=n[a],l=i[a],m=n[l];if(c!==void 0&&m!==void 0){let p=f(c,this._idMap),u=f(m,this._idMap);this._writer.addQuad(t(p),t("fso:connectedWith"),t(u)),this._writer.addQuad(t(u),t("fso:connectedWith"),t(p)),this._incrementTripleCount(2);let h=this._properties[a].FlowDirection?.value;h&&(h==="SOURCE"?(this._writer.addQuad(t(p),t("fso:suppliesFluidTo"),t(u)),this._writer.addQuad(t(u),t("fso:hasFluidSuppliedBy"),t(p)),this._incrementTripleCount(2)):h==="SINK"&&(this._writer.addQuad(t(p),t("fso:hasFluidSuppliedBy"),t(u)),this._writer.addQuad(t(u),t("fso:suppliesFluidTo"),t(p)),this._incrementTripleCount(2)))}this._incrementPct(o)}})}_getPortPortConnections(){return d(this,null,function*(){let{namedNode:e}=O,t=yield Ot(this._properties);if(this._settings.includePorts)for(let i of Object.keys(t)){let n=t[i],r=f(parseInt(i),this._idMap),o=f(n,this._idMap);this._writer.addQuad(e(r),e("fso:connectedPort"),e(o)),this._writer.addQuad(e(o),e("fso:connectedPort"),e(r)),this._incrementTripleCount(2)}return t})}_getPortComponentConnections(){return d(this,null,function*(){let{namedNode:e}=O,t=yield Bt(this._properties);if(this._settings.includePorts)for(let i of Object.keys(t)){let n=t[i],r=f(parseInt(i),this._idMap),o=f(n,this._idMap);this._writer.addQuad(e(r),e("fso:connectedElement"),e(o)),this._writer.addQuad(e(o),e("fso:connectedPort"),e(r)),this._incrementTripleCount(2)}return t})}_getPortPlacements(e){return d(this,null,function*(){if(!this._settings.includePortPlacements)return;let{namedNode:t,literal:i}=O,n=yield q(this._properties,V,!0),r=(yield this._units?.getLengthMultiplicationFactor())??1,o=e/n.length;for(let a of n){let c=a.ObjectPlacement.value;if(c===void 0)continue;let l=$e(this._properties,c),m=`POINT Z(${l[0]*r} ${l[1]*r} ${l[2]*r})`,p=f(parseInt(a.expressID),this._idMap),u=Ut(parseInt(a.expressID),this._idMap);this._writer.addQuad(t(p),t("omg:hasGeometry"),t(u)),this._writer.addQuad(t(u),t(ye),t("omg:Geometry")),this._writer.addQuad(t(u),t("omg:hasSimpleGeometryDescription"),i(m)),this._incrementTripleCount(3),this._incrementPct(o)}})}_incrementTripleCount(e=1){this._tripleCount+=e,this._callback!==void 0&&this._callback(this._tripleCount,this._pct)}_incrementPct(e=10){this._pct+=e,this._callback!==void 0&&this._callback(this._tripleCount,this._pct)}_setFinish(){this._pct=100,this._callback!==void 0&&this._callback(this._tripleCount,this._pct)}};var oi="Bumper GuideBearing ImpactProtectionDevice StraightRunStair Vessel OdorFilter DuctEntry MultipositionController SignalAssembly DirectDrive Refrigerator InductionMotor NavigationElement FrostSensor Geoslice Counterweigth MedicalDevice Stair SphericalBearing RoofingCovering Cistern Bearing AdiabaticRigidMediaHumidifier Bidet SticthWire EarthquakeSensor TwoQuarterTurnRamp OilRetentionTray HatstoneBeam ContactWireSegment ElementedWall SmokeSensor ReinforcingBar GableRoof GullySump EvaporativeCooler SwitchDisconnector SoundAbsortion CableTrunkingSegment RailLubrication OpticalNetworkUnit BeamGrid Ceiling IntelligentPeripheral Two-positionController Faucet PressureReliefValve RackRail Printer RailJoint Signal ElectricTimeControl FiberSegment StudShearConnector TwoStairRunRamp CohesionPile WaterCoolingCoil Tiebar PipeExit WeatherStation Wall Chain EnergyConversionDevice Ladder Inverter Sprinkler FluorescentLamp Brace LandingSlab AdiabaticCompressedAirNozzleHumidifier TrasnportUnit WasteDisposalUnit RooftopUnit Telecommand HumiditySensor Insulation CableCarrierBend ButterflyRoof TendonDuct Post TransportElement GroutingDuct Coupling SafetyCage HighPressureSodiumLamp Ligature DomeRoof Trench SteaminjectionHumidifier DirectEvaporativeRandomMediaAirCooler CableTransition RotaryVaneCompressor FlowInstrument VoltmeterPeak SolarPanel BusBarSegment MansardRoof Feed-AirUnit AntivacuumValve AirTerminalBox DoubleRegulatingValve RadiationSensor TendonConduitCoupler BackdraftDamper SolidStratum MasterUnit Backfill FreestandingWaterCooler Air-cooledCondenser PointMachineLockingDevice BasebandUnit InternalCombustionMotor StraightRampFlight DuctSilencer ProtectiveDeviceTrippingUnit ThermostaticActuator PhaseAngleMeter GeotechnicalStratum BreakglassButton ReinforcedSoil FreestandingFan ControlPanel Switcher Reciever HipRoof PneumaticActuator DirectEvaporativePackagedRotaryAirCooler ElectronicFilter RailMechanicalEquipment SlabField NailPlate Shutter BlockingDevice LinesideElectronicUnit Trasnponder ThermalTrippingUnit Course TurnoutClosureSensor FlowSegment Hosereel ReplacedSoil QuarterTurnRamp FootingBeam InductorBank Microphone FlatRoof BallastedCourse Bath CompressionIsolator HippedGableRoof DeckAssembly LiquidTerminal StraightRunRamp RemoteUnit GeotechnicalAssembly Strand BirdProtection VoidStratum STRIPFOOTING ThermosiphonSealedTubeHeatExchanger DirectExpansionShell-and-TubeEvaporator WearingSlab Geomodel StraightStairFlight TendonConduit ControlDamper Bell DynamicallyCompactedSoil FuseDisconnector ManualPullBox RotaryCompressor CentrifugalBackward-InclinedCurvedFan FrictionPile Light Door ReluctanceSynchronousMotor TwoCurvedRunStair BaseIsolator Truss StayCable Telephone SuspensionAssembly Balustrade TendonAnchor DoubleReturnStair PipeJunction PowerJuntionBox Jalouise StackTerminal Molding Blade Semi-hermeticCompressor PHSensor RigidFrame Handrail Fender ShearConnector TimeDelay HeatExchanger PierAssembly WashingMachine DuctFitting RubberDamper DispatchingBoard ShearWall IndirectEvaporativeWetCoil Fan SumpBuster CommunicationsAppliance CircuitBreaker CargoVehicle Stud BarTendon GullyTrap Ramp BRACKET Gate VacuumMooringDevice Boiler DXCoolingCoil BaseStationController ResidualCurrentTrippingUnit Roller QuarterTurnStair StartandStopSwitch ProgrammableController Evaporator Dowel Fence PierStem AirTerminal CompactFluorescentLamp Chimney SumpPump ProtectiveDevice Bolt CombinedControlElement ValveChamber HermeticCompressor CapacitorBank PowerFactorMeter StopCock DistributionChamberElement Flashing SteamBoiler CombinedFlowInstrument VoltmeterRMS MotorConnection RadiactivitySensor Pile LineTensioner HALFTURNRAMP DeepFoundation Mast InspectionChamber DuctBend FixedPlateCounterFlowExchanger SolarCollector TechnicalGabinet OxygenGenerator FireHydrant Speaker Guardrail FinnedTubeBundle PylonAssembly Membrane Buoy NaturalDraftCoolingTower DirectVaporativeWasher MixedSignalingDevice HighPressureMercuryLamp IonConcentrationSensor RailwayCrocodile FloorSlab Pump Plate DCMotor AdiabaticAtomizingHumidifier CO2Sensor LevelSensor ConductorSegment TransitionComponent Elevator ThinScrewCompressor Compressor AudioVisualAppliance DiscreteAccessory Insulator WindSensor DuctJuntion ProtectionCourse Pictoral ShearBar Railing CrossBracing DuctObstruction Timelock DampingSystem RigidDuctSegment Thermometer AirVehicle RollingStock PierCap Siren Condenser Apron FixedPlateParallelFlowExchanger WaterHeatingCoil Recharger CableArranger HalogenLamp DuctTransition GasCock PressureVessel RailMechanicalEquipmentAssembly SubscriberServer GasDetectionPanel UPS IndirectEvaporativeCoolingTowerorCoilCooler Pavement FiberTube MainBar Strainer ConductanceSensor CoatedTendon CurtainPanel SystemFurnitureElement Water-cooledBrazed-plateCondenser BuildingElementPart Water-cooledCondenser ShellandTubeExchanger Water-cooledShellTubeCondenser ResidualCurrentCircuitBreaker CableJunction Derailer ReinforcementRing Diaphragm CurrentTransformer RoofSlab Bed Coupler FlowMovingDevice ESCALATOR OpenTypeCompressor WheelSensor ApproachSlab GuardRail HydraulicActuator CoreSegment HarmonicFilter GasMeter Furniture SuspensionCable Terrain TurnoutHeating ScrollCompressor Table TumbleDryer JetGroutingPile ElectricFlowStorageDevice FireHosereel Weld Trumpet TensionEquipment WebPlate CentrfugalForward-CurvedFan Starter RainSensor SpiralStairFlight CableCarrierJunction Varistor BlastDamper CableSegment Sensor Chiller HeatPipe BreechingInlet Subgrade Transformer BeltDrive SubgradeBed Computer Arch ShedRoof TransitionSection ExpansionJointDevice Display Register RectangularSilencer ChangeoverValve SkirtingBoard TwoQuarterWindingStair ReciprocatingCompressor WirePairSegment DistributionFrame AnchorBolt Freezer FurnishingElement FreestandingElectricHeater RetainingWall AirHandler TrackElement LoadingArm FloorWaste WheeledVehicle Shelf AssitedButaneHumidifier SteamTrap Manhole DistributionControlElement Sleeving Sink Trunstile SlopeFill OpticalCableSegment Contactor IndicatorPanel CraneWaySystem SanitaryTerminal Modem ConduitSegment PlumbingWall Bending-yieldDamper Diffuser PipeFitting SmokeDamper EmergencyStop CableConnector PointMachineMountingDevice. ElectricGenerator VendingMachine Awning Rivet FlowFitting FixedEndAnchor Dropper VehicleStop CheckRail StructuralCable EarthworksElement PropellorAxialFan Ammeter TrafficCalminfgDevice Pilaster MechanicalForcedDraftCoolingTower Coil WaterCooledChiller PassiveCooledBeam FlowSensor TBeam Stringer DataOutlet SecurityLightning TelephoneOutlet PileCap DirectionSourceLightFixture LEDLamp FlowMeter Embankment SparkGap MovementSensor AudioSignalingDevice WallStud AirStation FireSensor IndirectEvaporativePackageAirCooler Damper Camera Actuator QuarterWindingStair PartitioningWall LightSensor PressureReducingValve GasSensor PavementCourse WaterBoiler MarineVehicle MomentarySwitch GroutedSoil TrochoidalCompressor ProportionalController CommunicationOutlet SolidWall RotaryWheel Humidistat SupportPile VisualSignalingDevice SteamHeatingCoil ElasticCushion HalfTurnStair DuctExit MechanicalInducedDraftCoolingTower E-UtranNodeB FireSmokeDamper CableCarrierConnector UnitaryControlElement COSensor HaulingGear Chopper ResidualCurrentSwitch DimmerSwitch EntranceWorks ChuteConveyor BalancingDamper BreakPressureTank Anti-ArcingDevice Burner Panel Shear-yieldDamper DuctSegment BeltConveyor Axial-yieldDamper OilMeter Thermostat HeatSensor CableExit SynchronousMotor FlowTreatmentDevice VariableFlowPressureIndependantTerminalBox HandOperatedActuator DynamicCompressor Amplifier WaterMeter EdgeBar Alarm SplicePlate Microwave GreaseInterceptor EarthingSwitch CoreCourse AircooledChiller Cladding EndSuctionPump CooledBeam BorePile Gravity-reliefDamper ScrewConveyor ElectricAppliance NetworkBridge Cowl Shelter WaveWall CaissonFoundation Caisson RailFastening AirToAirHeatRecovery Basin Grid MixingValve PipeBend EvaporativeCooledCondenser VibrationDamper DirectEvaporativeSlingersPackagedAirCooler WasteTrap ReinforcingMesh ElementComponent FreestandingWaterHeater SpeedRegulator SpiralRamp StairFlight Desk FloatingController CableEntry PavingSlab MimicPanel GeotechnicalElement FlowStorageDevice ExternalCombustionMotor PavilionRoof FreeFormRoof Ligthdome DrivenPile FlexiblePavement MovingWalkway RainbowRoof WasteTerminal RadioBlockCenter WaterStratum Grille Coping Purlin CoolingTower Voltmeter TendonCoupler AirConditioningUnit ConsumerUnit Kerb SpaceHeater TungstenFilamentLamp FormedDuct CylindricalBearing CombinedTransformer Radiator InsulationElement Tuner AirReleaseValve Booster Antenna ReliefDamper Footing PolyphaseMotor RailPad VibrationIsolator Flat-ovalSilencer Sump NetworkHub IsolatingValve StockRail TwoStraightRunStair Armour Sleeper Keypad PressureSensor ObstacleSensor ConveyorSegment RoofDrain InspectionPit Beam ElectricCooker DirectEvaporativeRigidMediaAirCooler Draw-OffCock BracedFrame DuctConnector GeographicElement PlateMember SoundSensor PierStemSegment Chord WaterFilter AssistedPropaneHumidifier Vehicle Wrapping Sprandel FilterCourse AccessoryAssembly DistributionBoard Covering TransportationDevice ElementAssembly SantirayFountain Mirror CatenaryWire ElectromagneticTrippingUnit HeatRecoveryChiller RoundSilencer Shoe Element FloodedShellandTubeEvaporator AdiabaticPan FrequencyTransformer DoubleCheckValve TubeAxialFan MobileTelecommunicationsAppliance Inductor PipeObstruction ElectricFlowTreatmentDevice GasTap FeedandExpansionTank FlowController BuildingElementProxy Beacon ShadingDevice Water-cooledShellCoilCondenser MovableWall HalfSetofBlades UnitaryEquipment TrackSlab Culvert ElectricMotor IndirectDirectCombination ServiceGPRSSupportNode TrackEndofAlignment CableBracket OLEDLamp Fax FireDamper Controller AnchoringBar StandaloneGenerator BasePlate CableCarrierTransition DirectExpansionEvaporator LiftingGear SpaceBar FlexibleDuctSegment CirculatorPump Skylight Slab TelephonyExchange DataJuntionBox Fastener RainwaterHopper AssistedSteamHumidifier Spool GravityDamper EarthworksFill VoltageLimiter Player CrashCushion Tank PadFooting IndentifierSensor AdiabaticUltrasonicHumidifier Vegetation Suspender ArmourUnit Filler Run-aroundCoilLoop BaseTranscieverStation GambrelRoof VerticallyDrainedSoil ContactSensor GussetPlate Rectifier Borehole PowerOutlet ElectricActuator DivertingValve OxygenPlant Rocker HalfWindingStair EnergyMeter CableFanout Rafter CHP Bollard Router CentrifugalAirfoilFan DilatationPanel AssistedElectricHumidifier AdiabaticWettedElement Valve ToggleSwitch Dishwasher RollerCompactedSoil DistributionElement ElectronicTrippingUnit MeterChamber PANELSTRENGTHENING AirParticlefilter VariableFlowPressureDependantTerminalBOx PipeConector BarrelRoof AlarmPanel RigidPipeSegment BirdCage StiffenerPlate RecordingEquipment SpringIsolator ArchSegement SnowDepthSensor TwoQuarterTurnStair ToiletPan SecurityCut-offValve FloorTrap PacketControlUnit Strut GatewayGPRSNodeSupport Lintel MooringDevice HollowcoreBeam SpiralRampFlight Glue Capacitor CheckValve RailBrace WorkSurface CoverPlate Well FreeFormStairFlight SwitchingDevice CompressedAirFilter OpticalLineTerminal FireMonitor ThreeQuarterWindingStair ReinforcingElement VerticalInlinePump Chair GasHeatCoil Diabolo BucketConveyor Whistle AbutmentAssembly GirderSegment TrainSensor RigidPavement Girder WeldedShellHermeticCompressor SolarDevice Filter LightFixture JunctionBox OilFilter AchorPlate ExpansionTank Outlet RollingPiston ShellandCoilEvaporator RampFlight ThermosiphonCoilTypeHeatExchanger Wire Gutter TimeRelay Sofa SidewalkSlab MobileSwitchingCenter Mullion CableFitting ElectricHeatingCoil PressureGauge TubeBundle Dehumidifier Repeater Collar TemperatureSensor SplitSystem ForeignObjectDetectionSensor Compensator Tendon ActiveCooledBeam CurvedStairFlight AdiabaticAirWasher SupportingGasAssembly Interceptor OilInterceptor Trapdoor EarthLeakerCircuitBreaker Lamp TrackedVehicle Lock StiffeningRib DistributionFlowElement Roof SingleScrewCompressor JoistBeam BoomBarrier WashHandBasin Scanner ConstantFlowTerminalBox Window Shower Water-cooledTube-in-TubeCondenser Urinal HandDryer Subrack Rail DiskBearing SubmersiblePump Automaton ViscousDamper SwitchBoard FlangePlate RemoteRadioUnit HydronicCoil ElastomericBearing PipeTransition NetworkAppliance Topping SpiralStair PlateHeatExchanger Mortar TensioningEndAnchor DirectExpansionTube-in-TubeEvaporator Relay CableCarrierFitting SurchargePreloadedSoil CurvedRunStair TurnoutPanel Photocopier PetrolInterceptor MSCServer MetalHalideLamp FireSuppressionTerminal ReinforcmentUnit Gateway PointSourceLightFixture Staple SplitCasePump MooringHooks FrequencyMeter KitchenMachine ThreeQuarterTurnStair RegulatingValve DirectExpansionBrazedPlateEvaporator PrecastPanel FlushingValve Frog EdgeBeam Column CyclonicInterceptor Louvre Battery SelectorSwitch VerticalTurbinePump MageneticMooringDevice FileCabinet FrictionDamper CableCarrierSegment Fridge-Freezer VacuumStation VoltageTransformer Convector CommissioningValve PunchingBar StorageTank BaseSlab FlowTerminal AssistedNaturalGasHumidifier TractionSwitchingAssembly TrackPanel Member FlexiblePipeSegment Sign WinderStairFlight Accesspoint IPNetworkEquipment FumeHoodExhaustDamper Nail PipeEntry CentrifugalRadialFan Engine Marker CurtainWall FixedPlateCrossFlowExchanger RailwayDetonator Rope AudiovisualOutlet VaneAxialFan EngineGenerator Cornice Sheet Screw CommunicationTerminal BuiltElement STANDCOLUMN MotorControlCentre Pot PipeSegment Projector CableLadderSegment MechanicalFastener TwinTowerEnthalpyRecoveryLoops CableTraySegment SlidingChair Flooring Humidifier SingleStageCompressor Parapet",jt=()=>oi.split(" ");var qe,Wt="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",Qt=jt(),ai=Qt.map(s=>s.toLowerCase()),Ce=class{constructor(e,t,i,n){this._writer=e,this._idMap=t,this._settings=i,this._callback=n,this._tripleCount=0,this._pct=0,this._properties={}}init(e){return d(this,null,function*(){qe=(yield w()).DataFactory,this._properties=e})}full(){return d(this,null,function*(){return qe=(yield w()).DataFactory,this._tripleCount=0,yield this.addProducts(),this._tripleCount})}addProducts(){return d(this,null,function*(){let{namedNode:e}=qe,t=_(x),i=Object.values(this._properties).filter(r=>t.includes(r.type)),n=100/i.length;for(let r of i){let o=f(r.expressID,this._idMap),a=Ae[r.type];if(a===void 0&&(console.info(`No mapping available for type ${r.type}`),console.info(r)),o!==void 0&&a!==void 0)if(this._settings.includeParents)At(r.type,x).forEach(c=>{let l=Ae[c];if(l!==void 0){let m=Vt(l);m&&(this._writer.addQuad(e(o),e(Wt),e(`beo:${m}`)),this._incrementTripleCount())}});else{let c=Vt(a);c&&(this._writer.addQuad(e(o),e(Wt),e(`beo:${c}`)),this._incrementTripleCount())}this._incrementPct(n)}this._setFinish()})}_incrementTripleCount(e=1){this._tripleCount+=e,this._callback!==void 0&&this._callback(this._tripleCount,this._pct)}_incrementPct(e=10){this._pct+=e,this._callback!==void 0&&this._callback(this._tripleCount,this._pct)}_setFinish(){this._pct=100,this._callback!==void 0&&this._callback(this._tripleCount,this._pct)}};function Vt(s){let e=ai.indexOf(s.toLowerCase().split("ifc")[1]);return e!==-1?Qt[e]:null}var Ye,ci,Je="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",Se=class{constructor(e,t,i,n,r){this._writer=e,this._idMap=t,this._settings=i,this._modelUUID=n,this._callback=r,this._tripleCount=0,this._pct=0,this._properties={}}init(e){return d(this,null,function*(){let t=yield w();Ye=t.DataFactory,ci=t.NamedNode,this._properties=e})}full(){return d(this,null,function*(){let{namedNode:e}=Ye,t=yield this.getRelevantEntities();this._incrementPct(20);let i=e(`inst:${this._modelUUID}`);return this._writer.addQuad(i,e(Je),e(`${E.qcy}BIMModel`)),this._incrementTripleCount(),yield Promise.all([this.writeEntityData(t,i,80)]),this._setFinish(),this._tripleCount})}getRelevantEntities(){return d(this,null,function*(){return new Promise(e=>{let t=_(x);t.push(M),t.push(D),t.push(F),t.push(C);let i=Object.values(this._properties).filter(n=>t.includes(n.type)).map(n=>{let r=f(n.expressID,this._idMap),o=n.GlobalId.value,a=n.Name?.value;return{iri:r,globalId:o,label:a,expressId:n.expressID}});e(i)})})}writeEntityData(e,t,i){return d(this,null,function*(){let{namedNode:n,literal:r}=Ye,o=i/e.length;return new Promise(a=>{e.forEach(c=>{this._writer.addQuad(t,n(`${E.qcy}hasFragment`),n(c.iri)),this._writer.addQuad(n(c.iri),n(Je),n(`${E.qcy}Fragment`)),c.label!==void 0&&this._writer.addQuad(n(c.iri),n(`${E.qcy}name`),r(c.label));let l=n(`${c.iri}_selector`);this._writer.addQuad(n(c.iri),n(`${E.qcy}hasSelector`),l),this._writer.addQuad(l,n(Je),n(`${E.qcy}IdSelector`)),this._writer.addQuad(l,n(`${g.rdf}value`),r(c.globalId)),this._incrementTripleCount(6),this._incrementPct(o)}),a()})})}_incrementTripleCount(e=1){this._tripleCount+=e,this._callback!==void 0&&this._callback(this._tripleCount,this._pct)}_incrementPct(e=10){this._pct+=e,this._callback!==void 0&&this._callback(this._tripleCount,this._pct)}_setFinish(){this._pct=100,this._callback!==void 0&&this._callback(this._tripleCount,this._pct)}};var J,j="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",Te=class{constructor(e,t,i,n,r){this._writer=e,this._idMap=t,this._typeMap=i,this._settings=n,this._callback=r,this._tripleCount=0,this._pct=0,this._properties={},this._writtenMaterials=[]}init(e){return d(this,null,function*(){J=(yield w()).DataFactory,this._properties=e})}full(){return d(this,null,function*(){this._cleanUp();let{layerSet:e,entityAssigned:t,typeAssigned:i}=this._getMaterialAssosiationRels();return yield Promise.all([this.writeFamilyTypes(i),this.writeLayeredTypes(e),this.writeDirectlyAssigned(t)]),this._setFinish(),this._tripleCount})}writeFamilyTypes(e){return d(this,null,function*(){let t={};e.map(i=>{let n=i.RelatingType.value,r=this._properties[n];if(r===void 0)return;let o=r.Name?.value;o!==void 0&&(t[o]===void 0&&(t[o]=new Set),i.RelatedObjects.forEach(a=>t[o].add(a.value)))});for(let i of Object.keys(t)){let n=Array.from(t[i]);if(!n.length)continue;let r=this._typeMap[parseInt(n[0])],o=yield ue(i,r);this._classifyProduct(o,i);let a=n.map(c=>f(parseInt(c),this._idMap));this._assignProductEntities(o,a)}})}writeLayeredTypes(e){return d(this,null,function*(){let t={},i={};e.forEach(n=>{let r=this._properties[n.RelatingMaterial?.value],o=this._processMaterialConstituents(r);if(!o.length)return;let a=o[0].setName;a!==void 0&&(t[a]===void 0&&(t[a]=new Set,i[a]=o),n.RelatedObjects.map(c=>t[a].add(c.value)))});for(let n of Object.keys(t)){let r=Array.from(t[n]);if(!r.length)continue;let o=this._typeMap[parseInt(r[0])],a=yield ue(n,o);this._classifyProduct(a,n);let c=r.map(m=>f(parseInt(m),this._idMap));this._assignProductEntities(a,c);let l=i[n];yield Promise.all([this._assignProductElements(a,l),this._writeConnections(a,l)])}})}writeDirectlyAssigned(e){return d(this,null,function*(){let t={},i={};e.forEach(r=>{r.RelatedObjects.forEach(o=>{let a=this._properties[o.value];if(a===void 0){console.warn(`No props found for ${o.value}`);return}let c=a.ObjectType?.value??a.Name?.value;if(c===void 0&&(console.warn("Object type name unknown"),console.log(a)),!Object.keys(t).includes(c)){t[c]=new Set;let l=this._properties[r.RelatingMaterial?.value],m=this._processMaterialConstituents(l);i[c]=m}if(a.ObjectType?.value!==void 0)t[c].add(o.value);else{let l=this._getTypeEntities(o.value);l[0]!==void 0&&t[c].add(l[0].toString())}})});let n=[];for(let r of Object.keys(t)){let o=Array.from(t[r]);if(!o.length)continue;let a=this._typeMap[parseInt(o[0])],c=yield ue(r,a);this._classifyProduct(c,r);let l=o.map(p=>f(parseInt(p),this._idMap));this._assignProductEntities(c,l);let m=i[r];n.push(this._assignProductElements(c,m))}yield Promise.all(n)})}_cleanUp(){this._tripleCount=0,this._writtenMaterials=[]}_getMaterialAssosiationRels(){let e=[],t=[],i=[];return Object.values(this._properties).filter(n=>n!==void 0).filter(n=>n.RelatedObjects!==void 0).forEach(n=>{if(n.type===k){let r=this._properties[n.RelatingMaterial?.value];if(r===void 0){console.warn("No relating material"),console.warn(n);return}r.ForLayerSet!==void 0?e.push(n):t.push(n)}else n.type===B&&i.push(n)}),{layerSet:e,entityAssigned:t,typeAssigned:i}}_getTypeEntities(e){return Object.values(this._properties).filter(t=>t!==void 0).filter(t=>t.type===B).filter(t=>t.RelatingType?.value===e).flatMap(t=>t.RelatedObjects.map(i=>i.value))}_processMaterialConstituents(e){if(e.type===$){let t=e.Name?.value;if(t===void 0)return console.warn("Product name unknown"),console.warn(e.Name),console.warn(e),[];let i=e.Category?.value;return[{materialName:t,category:i}]}else{if(e.type===Z)return e.MaterialConstituents.map(t=>{let i=this._properties[t.value],n=this._properties[i.Material?.value],r=i.Fraction?.value;return{constituentName:i.Name?.value,materialName:n.Name?.value,fraction:r}});if(e.type===U){let t=this._properties[e.ForLayerSet?.value];return t.MaterialLayers.map(i=>{let n=this._properties[i.value],r=this._properties[n.Material?.value],o=n.LayerThickness?.value,a=n.IsVentilated??!1;return{setName:t.LayerSetName?.value,materialName:r.Name?.value,thickness:o,isVentilated:a}})}else{if(e.type===G)return e.MaterialLayers.map(t=>{let i=this._properties[t.value],n=this._properties[i.Material?.value],r=i.LayerThickness?.value,o=i.IsVentilated??!1;return{setName:n.LayerSetName?.value,materialName:n.Name?.value,thickness:r,isVentilated:o}});if(e.type===ce)return e.Materials.map(t=>({materialName:this._properties[t.value].Name?.value}))}}return console.warn("Unknown material type"),console.warn(e),[]}_classifyProduct(e,t){let{namedNode:i,literal:n}=J;this._writer.addQuad(i(e),i(j),i(`${g.bpo}Product`)),this._writer.addQuad(i(e),i(j),i(`${g.bpo}Assembly`)),this._writer.addQuad(i(e),i(j),i(`${g.bpo}Component`)),this._incrementTripleCount(3),t!==void 0&&(this._writer.addQuad(i(e),i(`${g.schema}name`),n(t)),this._incrementTripleCount())}_assignProductEntities(e,t){let{namedNode:i}=J;t.forEach(n=>{this._writer.addQuad(i(n),i(j),i(`${g.bpo}Entity`)),this._writer.addQuad(i(n),i(`${g.bpo}realisesObject`),i(e)),this._incrementTripleCount(2)})}_assignProductElements(e,t){return d(this,null,function*(){let{namedNode:i,literal:n}=J,r=e.split(":")[1],o=0;t.forEach(c=>{c.thickness!==void 0&&(o+=c.thickness)}),o!==0&&(this._writer.addQuad(i(e),i(`${g.schema}depth`),n(o)),this._incrementTripleCount());let a=[];for(let c of t){let l=c.constituentName??c.materialName,m=yield fe(l,r);a.push(m)}a.forEach(c=>{this._writer.addQuad(i(e),i(`${g.bpo}consistsOf`),i(c)),this._incrementTripleCount()}),t.forEach((c,l)=>{let m=a[l];if(this._writer.addQuad(i(m),i(`${g.bpo}isPartOf`),i(e)),this._incrementTripleCount(),this._writtenMaterials.includes(m))return;let p=c.constituentName??c.materialName;if(this._writtenMaterials.push(m),this._writer.addQuad(i(m),i(j),i(`${g.bpo}Element`)),this._writer.addQuad(i(m),i(j),i(`${g.bpo}Component`)),this._writer.addQuad(i(m),i(`${g.schema}name`),n(p)),this._writer.addQuad(i(m),i(`${g.schema}material`),n(c.materialName)),this._incrementTripleCount(4),c.thickness!==void 0){let u=c.thickness/o;this._writer.addQuad(i(m),i(`${g.schema}depth`),n(c.thickness)),this._writer.addQuad(i(m),i(this._settings.volumeProportionPredicate),n(u)),this._incrementTripleCount(2)}})})}_writeConnections(e,t){return d(this,null,function*(){let{namedNode:i}=J,n=e.split(":")[1];for(let r in t){let o=t[r],a=t[parseInt(r)+1];if(a===void 0)continue;let c=yield fe(o.constituentName??o.materialName,n),l=yield fe(a.constituentName??a.materialName,n);this._writer.addQuad(i(c),i(`${g.bpo}connectedTo`),i(l)),this._writer.addQuad(i(l),i(`${g.bpo}connectedFrom`),i(c)),this._incrementTripleCount(2)}})}_incrementTripleCount(e=1){this._tripleCount+=e,this._callback!==void 0&&this._callback(this._tripleCount,this._pct)}_incrementPct(e=10){this._pct+=e,this._callback!==void 0&&this._callback(this._tripleCount,this._pct)}_setFinish(){this._pct=100,this._callback!==void 0&&this._callback(this._tripleCount,this._pct)}};function li(s){return s.index?s.index.count:s.attributes.position.count}function Ht(s){return li(s)/3}var A=new tt,$t=new I,zt=new I;function Yt(s){let e,t;s.isBufferGeometry?(e=s,t=null):(e=s.geometry,t=Math.abs(s.matrixWorld.determinant()-1)<1e-15?null:s.matrixWorld);let i=e.index,n=e.attributes.position,r=e.drawRange,o=Math.min(Ht(e),r.count/3);A.setFromAttributeAndIndices(n,0,1,2),qt(A,t),A.getNormal($t),A.getMidpoint(zt).add($t);let a=0,c=r.start/3;for(let l=c,m=c+o;l<m;l++){let p=3*l+0,u=3*l+1,h=3*l+2;i&&(p=i.getX(p),u=i.getX(u),h=i.getX(h)),A.setFromAttributeAndIndices(n,p,u,h),qt(A,t),mi(A,zt),a+=di(A.a,A.b,A.c)}return Math.abs(a)}function di(s,e,t){let i=t.x*e.y*s.z,n=e.x*t.y*s.z,r=t.x*s.y*e.z,o=s.x*t.y*e.z,a=e.x*s.y*t.z,c=s.x*e.y*t.z;return 1/6*(-i+n+r-o-a+c)}function mi(s,e){s.a.sub(e),s.b.sub(e),s.c.sub(e)}function qt(s,e=null){e!==null&&(s.a.applyMatrix4(e),s.b.applyMatrix4(e),s.c.applyMatrix4(e))}function tr(s,e,t){let i=Kt(s),n=null,r=null;for(let{normal:o,center:a}of i){let c=e.clone().sub(a),l=t.clone().sub(a),m=o.dot(c),p=o.dot(l);if(n===null&&(n=m>=0?"positive":"negative"),r===null&&(r=p>=0?"positive":"negative"),n!==r)return!1}return n===r}function Jt(s){return[new I(s.min.x,s.min.y,s.min.z),new I(s.min.x,s.min.y,s.max.z),new I(s.min.x,s.max.y,s.min.z),new I(s.min.x,s.max.y,s.max.z),new I(s.max.x,s.min.y,s.min.z),new I(s.max.x,s.min.y,s.max.z),new I(s.max.x,s.max.y,s.min.z),new I(s.max.x,s.max.y,s.max.z)]}function pi(s,e=Jt(s)){return[[e[0],e[1],e[2],e[3]],[e[4],e[5],e[6],e[7]],[e[0],e[1],e[4],e[5]],[e[2],e[3],e[6],e[7]],[e[1],e[3],e[5],e[7]],[e[0],e[2],e[4],e[6]]]}function Kt(s){let e=Jt(s),t=[],i=new I;return e.forEach(r=>i.add(r)),i.divideScalar(e.length),pi(s,e).forEach(r=>{let o=new I().subVectors(r[1],r[0]),a=new I().subVectors(r[2],r[0]),c=new I().crossVectors(o,a).normalize(),l=new I().add(r[0]).add(r[1]).add(r[2]).add(r[3]).divideScalar(4),m=new I().subVectors(l,i);c.dot(m)<0&&c.negate(),t.push({normal:c,center:l})}),t}function ir(s,e,t=3){let i=s.getCenter(new I),n=new I().subVectors(e,i).normalize(),r=null,o=-1/0;return Kt(s).forEach(a=>{let{normal:c,center:l}=a,m=new I().subVectors(l,i).length(),u=-c.dot(n)-m*t;u>o&&(o=u,r=c)}),r}function nr(s){let e=0,t=s[0];return s.forEach(i=>{let n=i.getSize(new I),r=n.x*n.y*n.z;r>e&&(e=r,t=i)}),t}function ui(s){let e=new Pe;e.fromArray(s);let t=fi(e);return hi(t)}function Xt(s,e){let t=ui(s),i=new Pe;return i.fromArray(e),t.applyMatrix4(i)}function fi(s){let e=new rt(1,1,1),t=new nt(e);return t.applyMatrix4(s),new et().setFromObject(t)}function hi(s){let e=new I;s.getSize(e);let t=e.multiplyScalar(.5);return s.min.add(t),s.max.add(t),s}function cr(s){let e={north:new I(0,0,-1),south:new I(0,0,1),east:new I(1,0,0),west:new I(-1,0,0),up:new I(0,1,0),down:new I(0,-1,0)},t=null,i=-1/0;for(let[n,r]of Object.entries(e)){let o=r.dot(s);o>i&&(i=o,t=n)}return t}var K,Ke="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",we=class{constructor(e,t,i,n,r){this._writer=e,this._idMap=t,this._typeMap=i,this._settings=n,this._tripleCountCB=r,this._tripleCount=0,this._filePrefix="",this._modelUUID="",this._transGeometryMap={},this._geometryMap={},this._tripleCount=0}init(){return d(this,null,function*(){K=(yield w()).DataFactory})}writeContext(e,t){this._modelUUID=b(e),this._filePrefix=t;let i=`inst:${this._modelUUID}`,{namedNode:n,literal:r}=K;this._writer.addQuad(n(i),n(Ke),n("omg:GeometryContext")),this._writer.addQuad(n(i),n("qcy:md5hash"),r(e)),this._incrementTripleCount(2),this._settings.writeOBCData&&(this._writer.addQuad(n(i),n("obc:idMapId"),r(`${t}${this._modelUUID}-ids`)),this._writer.addQuad(n(i),n("obc:globalDataFileId"),r(`${t}${this._modelUUID}-global`)),this._incrementTripleCount(2))}appendAssetChunk(e){return d(this,null,function*(){if(this._typeMap===void 0)throw new Error("TypeMap is undefined");if(this._idMap===void 0)throw new Error("IdMap not defined");return new Promise(t=>{for(let i of e){let n=i.id,r=f(n,this._idMap),o=this._typeMap[n];for(let a of i.geometries){let c=f(a.geometryID,this._idMap,this._modelUUID);c===void 0&&console.log(a.geometryID),this._settings.makeSpacesTransparent&&o===3856911033&&(a.color=[.3,.3,.3,.5]),this._settings.makeOpeningsInvisible&&o===3588315303&&(a.color=[0,0,0,0]);let l=r.split("inst:")[1],m=c.split("inst:")[1],u=`inst:${b(l+m)}`;this._transGeometryMap[u]={transformation:a.transformation,geometryIRI:c};let{namedNode:h,literal:y}=K;this._writer.addQuad(h(u),h(Ke),h("omg:Geometry")),this._writer.addQuad(h(r),h("omg:hasGeometry"),h(u)),this._writer.addQuad(h(u),h("omg:transformsGeometry"),h(c)),this._writer.addQuad(h(u),h("omg:hasGeometryContext"),h(`inst:${this._modelUUID}`)),this._incrementTripleCount(4),this._settings.writeOBCData&&(this._writer.addQuad(h(r),h("obc:expressID"),y(n)),this._writer.addQuad(h(u),h("obc:transformation"),y(JSON.stringify(a.transformation))),this._writer.addQuad(h(u),h("obc:color"),y(JSON.stringify(a.color))),this._incrementTripleCount(3))}t()}})})}appendGeometryChunk(e,t,i){return d(this,null,function*(){return new Promise((n,r)=>{this._idMap===void 0&&r(new Error("IdMap not defined"));let{namedNode:o,literal:a}=K,c=this._getGeometryVolume(t);for(let l of Object.keys(e)){let m=f(parseInt(l),this._idMap,this._modelUUID),p=e[parseInt(l)];this._geometryMap[m]=p.boundingBox;let u=c[l];this._writer.addQuad(o(m),o(Ke),o("omg:Geometry")),this._writer.addQuad(o(m),o("omg:hasGeometryContext"),o(`inst:${this._modelUUID}`)),this._incrementTripleCount(2),this._settings.writeOBCData&&(this._writer.addQuad(o(m),o("obc:expressID"),a(parseInt(l))),this._writer.addQuad(o(m),o("obc:oobb"),a(JSON.stringify(p.boundingBox))),this._writer.addQuad(o(m),o("obc:hasHoles"),a(JSON.stringify(p.hasHoles))),this._writer.addQuad(o(m),o("obc:geometryFile"),a(`${this._filePrefix}${i}`)),this._writer.addQuad(o(m),o("obc:bvhVolume"),a(u)),this._incrementTripleCount(5))}n()})})}calculateCentroids(){return d(this,null,function*(){if(this._settings.writeOBCData)return new Promise(e=>{Object.keys(this._transGeometryMap).forEach(t=>{let{geometryIRI:i,transformation:n}=this._transGeometryMap[t],r=this._geometryMap[i];if(r===void 0){console.warn("No OOBB for "+i);return}let a=Xt(r,n).getCenter(new I),{namedNode:c,literal:l}=K;this._writer.addQuad(c(t),c("obc:oobbCentroid"),l(`POINT Z(${a.x} ${a.y} ${a.z})`)),this._incrementTripleCount()}),e()})})}_getGeometryVolume(e){let i=new ot().import(e),n={};return Array.from(i.keys()).forEach(r=>{let o=new it,a=i.get(r);if(a===void 0)return;let{position:c,normal:l,index:m}=a;o.setAttribute("position",new X(c,3)),o.setAttribute("normal",new X(l,3)),o.setIndex(new X(m,1));let p=Yt(o);n[r]=Number(p)}),n}_incrementTripleCount(e=1){this._tripleCount+=e,this._tripleCountCB!==void 0&&this._tripleCountCB(this._tripleCount)}};var Ee=class{constructor(e,t,i,n){this._settings=e,this._idMap=t,this._typeMap=i,this._callback=n,this._results=new N,this._lastProgress=0,this._assetFactPromises=[],this._geometryFactPromises=[]}set settings(e){this._settings=e}init(e,t){return d(this,null,function*(){this._modelUUID=b(e);let i=yield w();this._writer=new i.Writer({prefixes:{ifc:g.ifc,fso:g.fso,beo:g.beo,bot:g.bot,bpo:g.bpo,fog:g.fog,omg:g.omg,obc:"https://w3id.org/obc#",rdf:g.rdf,rdfs:g.rdfs,schema:g.schema,qcy:E.qcy,dice:E.dice,dicbm:E.dicbm,dicv:E.dicv,xsd:g.xsd,inst:this._settings.namespace}}),this._setProcessors(),this._settings.enabledParsers.geometry&&(yield this._geometryProcessor?.init(),this._geometryProcessor?.writeContext(e,t))})}get results(){return this._results}writeTriples(){return new Promise((e,t)=>{this._writer.end((i,n)=>{i&&t(i),this._results.triples=n,e(this._results)})})}processProperties(e){return d(this,null,function*(){let t=this._settings;if(this._modelUUID===void 0)throw new Error("Model UUID not calculated. Did you run init?");t.enabledParsers.bot&&(console.time("BOT parsed"),yield this._botProcessor?.init(e),yield this._botProcessor?.full(),console.timeEnd("BOT parsed"),console.info(`${this._results.tripleCount.bot} triples`)),t.enabledParsers.fso&&(console.time("FSO parsed"),yield this._fsoProcessor?.init(e),yield this._fsoProcessor?.full(),console.timeEnd("FSO parsed"),console.info(`${this._results.tripleCount.fso} triples`)),t.enabledParsers.products&&(console.time("PRODUCTS parsed"),yield this._productProcessor?.init(e),yield this._productProcessor?.full(),console.timeEnd("PRODUCTS parsed"),console.info(`${this._results.tripleCount.products} triples`)),t.enabledParsers.qcy&&(console.time("QAECY parsed"),yield this._qcyProcessor?.init(e),yield this._qcyProcessor?.full(),console.timeEnd("QAECY parsed"),console.info(`${this._results.tripleCount.qcy} triples`)),t.enabledParsers.dicon&&(console.time("DiCon parsed"),yield this._diconProcessor?.init(e),yield this._diconProcessor?.full(),console.timeEnd("DiCon parsed"),console.info(`${this._results.tripleCount.dicon} triples`)),t.enabledParsers.bpo&&(console.time("BPO parsed"),yield this._bpoProcessor?.init(e),yield this._bpoProcessor?.full(),console.timeEnd("BPO parsed"),console.info(`${this._results.tripleCount.bpo} triples`)),this._results.progress.total=100})}appendAssetChunk(e){return d(this,null,function*(){if(!this._settings.enabledParsers.geometry)return;if(this._geometryProcessor===void 0)throw new Error("Geometry processor not available");let t=this._geometryProcessor.appendAssetChunk(e);this._assetFactPromises.push(t),yield t})}appendGeometryChunk(e,t,i){return d(this,null,function*(){if(!this._settings.enabledParsers.geometry)return;if(this._geometryProcessor===void 0)throw new Error("Geometry processor not available");let n=this._geometryProcessor.appendGeometryChunk(e,t,i);this._geometryFactPromises.push(n),yield n})}finishGeometryProcessing(){return d(this,null,function*(){this._settings.enabledParsers.geometry&&(yield Promise.all(this._assetFactPromises),yield Promise.all(this._geometryFactPromises),yield this._geometryProcessor?.calculateCentroids(),this._results.progress.geometry=100,this._updateTotals())})}_setProcessors(){if(this._modelUUID===void 0)throw new Error("Model UUID not calculated. Did you run init?");this._geometryProcessor=new we(this._writer,this._idMap,this._typeMap,this._settings.subSettings.geometry,e=>{this._results.tripleCount.geometry=e,this._updateTotals()}),this._botProcessor=new Ie(this._writer,this._idMap,this._settings.subSettings.bot,(e,t)=>{this._results.tripleCount.bot=e,this._results.progress.bot=t,this._updateTotals()}),this._productProcessor=new Ce(this._writer,this._idMap,this._settings.subSettings.products,(e,t)=>{this._results.tripleCount.products=e,this._results.progress.products=t,this._updateTotals()}),this._fsoProcessor=new _e(this._writer,this._idMap,this._settings.subSettings.fso,(e,t)=>{this._results.tripleCount.fso=e,this._results.progress.fso=t,this._updateTotals()}),this._bpoProcessor=new Te(this._writer,this._idMap,this._typeMap,this._settings.subSettings.bpo,(e,t)=>{this._results.tripleCount.bpo=e,this._results.progress.bpo=t,this._updateTotals()}),this._qcyProcessor=new Se(this._writer,this._idMap,this._settings.subSettings.qcy,this._modelUUID,(e,t)=>{this._results.tripleCount.qcy=e,this._results.progress.qcy=t,this._updateTotals()})}_updateTotals(){let e=0;Object.keys(this._results.tripleCount).forEach(n=>{n!=="total"&&(e+=parseInt(this._results.tripleCount[n]))}),this._results.tripleCount.total=e;let t=[];Object.keys(this._settings.enabledParsers).forEach(n=>{this._settings.enabledParsers[n]&&t.push(n)});let i=0;t.forEach(n=>{i+=parseFloat(this._results.progress[n])/t.length}),this._results.progress.total=i,this._callback!==void 0&&(i-this._lastProgress>=1||i===100)&&(this._lastProgress=i,this._callback(this._results))}};var Zt=new Set([1123145078,574549367,1675464909,2059837836,3798115385,32440307,3125803723,3207858831,2740243338,2624227202,4240577450,3615266464,3724593414,220341763,477187591,1878645084,1300840506,3303107099,1607154358,1878645084,846575682,1351298697,2417041796,3049322572,3331915920,1416205885,776857604,3285139300,3958052878,2827736869,2732653382,673634403,3448662350,4142052618,2924175390,803316827,2556980723,1809719519,2205249479,807026263,3737207727,1660063152,2347385850,2705031697,3732776249,2485617015,2611217952,1704287377,2937912522,2770003689,1281925730,1484403080,3448662350,4142052618,3800577675,4006246654,3590301190,1383045692,2775532180,2047409740,370225590,3593883385,2665983363,4124623270,812098782,3649129432,987898635,1105321065,3510044353,1635779807,2603310189,3406155212,1310608509,4261334040,2736907675,3649129432,1136057603,1260505505,4182860854,2713105998,2898889636,59481748,3749851601,3486308946,3150382593,1062206242,3264961684,15328376,1485152156,370225590,1981873012,2859738748,45288368,2614616156,2732653382,775493141,2147822146,2601014836,2629017746,1186437898,2367409068,1213902940,3632507154,3900360178,476780140,1472233963,2804161546,3008276851,738692330,374418227,315944413,3905492369,3570813810,2571569899,178912537,2294589976,1437953363,2133299955,572779678,3092502836,388784114,2624227202,1425443689,3057273783,2347385850,1682466193,2519244187,2839578677,3958567839,2513912981,2830218821,427810014]);function ei(s){return d(this,null,function*(){s.streamAllProperties=function(){return d(this,null,function*(){let t=this.settings,{propertiesSize:i}=t,n=t.limitTypesTo.size!==0?t.limitTypesTo:new Set(this.webIfc.GetIfcEntityList(0)),r=new Set([se,M,D,F,C]);if(t.limitTypesTo.size===0)for(let m of r)n.add(m);let o=.01,a=0;for(let m of n){if(a++,Zt.has(m)&&t.limitTypesTo.size===0)continue;let p=r.has(m),u=this.webIfc.GetLineIDsWithType(0,m),h=u.size(),y=0;for(let S=0;S<h-i;S+=i){let T={};for(let R=0;R<i;R++){y++;let v=u.get(S+R);try{let W=this.webIfc.GetLine(0,v,p);T[W.expressID]=W}catch{console.log(`Could not get property: ${v}`),console.log(m)}}yield this.onPropertiesStreamed.trigger({type:m,data:T})}if(y!==h){let S={};for(let T=y;T<h;T++){let R=u.get(T);try{let v=this.webIfc.GetLine(0,R,p);S[v.expressID]=v}catch{console.log(`Could not get property: ${R}`)}}yield this.onPropertiesStreamed.trigger({type:m,data:S})}a/n.size>o&&(o=Math.round(o*100)/100,yield this.onProgress.trigger(o),o+=.01)}yield this.onProgress.trigger(1);let l=yield this.components.get(Rt).processFromWebIfc(this.webIfc,0);yield this.onIndicesStreamed.trigger(l)})}})}var Xe=()=>{let s=new Set;return _(x).forEach(e=>s.add(e)),s.add(se),s.add(M),s.add(D),s.add(F),s.add(C),s},Ii=()=>[ae,Et,bt],ti=s=>{let e=Xe();return s.includeLBDTriples&&(s.lbdParserSettings.enabledParsers.bot&&(_(re).forEach(t=>e.add(t)),e.add(M),e.add(D),e.add(F),e.add(C),e.add(L),e.add(Q),e.add(ne),e.add(te),e.add(ee),e.add(at)),s.lbdParserSettings.enabledParsers.fso&&(_(V).forEach(t=>e.add(t)),e.add(Fe),e.add(ve),e.add(Me),e.add(H),e.add(ie),e.add(Re),e.add(De),e.add(pt),e.add(ft),e.add(ht),e.add(It),e.add(ut),e.add(mt),e.add(dt),e.add(lt),e.add(ie),s.lbdParserSettings.subSettings.fso.includePortPlacements&&(Ii().forEach(t=>e.add(t)),e.add(Tt),e.add(_t),e.add(yt))),s.lbdParserSettings.enabledParsers.qcy&&(_(oe).forEach(t=>e.add(t)),e.add(B),e.add(k),e.add(le),e.add(G),e.add(U)),s.lbdParserSettings.enabledParsers.dicon&&s.lbdParserSettings.subSettings.dicon.includeMaterialLayers&&(_(oe).forEach(t=>e.add(t)),e.add($),e.add(B),e.add(k),e.add(le),e.add(G),e.add(U)),s.lbdParserSettings.enabledParsers.bpo&&(_(oe).forEach(t=>e.add(t)),_(Ct).forEach(t=>e.add(t)),e.add($),e.add(B),e.add(k),e.add(le),e.add(G),e.add(U),e.add(Z),e.add(ct),e.add(ce),e.add(St),e.add(wt))),e};function ii(s){return d(this,null,function*(){s.streamAllGeometries=function(){return d(this,null,function*(){let{minGeometrySize:e,minAssetsSize:t}=this.settings;this._spatialTree.setUp(this.webIfc);let i=this.webIfc.GetIfcEntityList(0),n=[[]],r=new st;r.ifcMetadata=Ze(be(be({name:"",description:""},this._metaData.getNameInfo(this.webIfc)),this._metaData.getDescriptionInfo(this.webIfc)),{schema:this.webIfc.GetModelSchema(0)||"IFC2X3",maxExpressID:this.webIfc.GetMaxExpressID(0)});let o=0,a=0;for(let y of i){if(!this.webIfc.IsIfcElement(y)&&y!==C){y===C&&console.log("IS SPACE");continue}if(this.settings.excludedCategories.has(y)){console.log(this.settings.excludedCategories);continue}let P=this.webIfc.GetLineIDsWithType(0,y),S=P.size();for(let T=0;T<S;T++){o>e&&(o=0,a++,n.push([]));let R=P.get(T);n[a].push(R);let v=this.webIfc.GetLine(0,R);if(v.GlobalId){let ri=v?.GlobalId.value||v?.GlobalId;r.globalToExpressIDs.set(ri,R)}let W=this._spatialTree.itemsByFloor[R]||0;r.data.set(R,[[],[W,y]]),o++}}this._spatialTree.cleanUp();let c=.01,l=0;for(let y of n){l++,this.webIfc.StreamMeshes(0,y,S=>{this.getMesh(this.webIfc,S,r)}),this._geometryCount>e&&(yield this.streamGeometries()),this._assets.length>t&&(yield this.streamAssets());let P=l/n.length;P>c&&(c+=.01,c=Math.max(c,P),this.onProgress.trigger(Math.round(c*100)/100))}this._geometryCount&&(yield this.streamGeometries()),this._assets.length&&(yield this.streamAssets());let{opaque:m,transparent:p}=r.geometryIDs;for(let[y,{index:P,uuid:S}]of this._visitedGeometries)r.keyFragments.set(P,S),(y>1?m:p).set(y,P);let u=this.webIfc.GetCoordinationMatrix(0);r.coordinationMatrix.fromArray(u),r.civilData=this._civil.read(this.webIfc);let h=this._groupSerializer.export(r);this.onIfcLoaded.trigger(h),r.dispose(!0)})}})}var ni=class{constructor(){this._settings=new de,this._components=new Pt,this._propsProcessor=new z,this._modelUUID="",this._assetIDMap={},this._globalFile=new Uint8Array,this._geometries={},this._assetsCount=0,this._geometryCount=0,this._geometryProgress=0,this._assets=[],this._geometryMap={},this._lbdResults=new N,this._tiler=new Dt(this._components),ii(this._tiler),this._propsStreamer=this._components.get(Mt),ei(this._propsStreamer),this._tiler.settings.wasm=this._settings.wasmPath,this._propsStreamer.settings.wasm=this._settings.wasmPath}dispose(){this._components.dispose(),this._propsProcessor.dispose(),this._tiler.dispose(),this._propsStreamer.dispose(),this.reset()}reset(){this._globalFile=new Uint8Array,this._geometries={},this._assetsCount=0,this._geometryCount=0,this._assets=[],this._geometryMap={},this._assetIDMap={},this._lbdResults=new N}get settings(){return this._settings}set settings(e){e.ifcStreamingSettings.wasm=e.wasmPath,e.propertiesStreamingSettings.wasm=e.wasmPath,this._tiler.settings=e.ifcStreamingSettings,this._propsStreamer.settings=e.propertiesStreamingSettings,this._settings=e,this._lbdParser!==void 0&&(this._lbdParser.settings=e.lbdParserSettings)}loadModel(e,t=!0,i,n){return d(this,null,function*(){let r=yield fetch(e);t&&console.info("Fetched file");let o=yield r.arrayBuffer();return t&&console.info("Read buffer"),this.loadModelBuffer(o,t,i,n)})}loadModelBuffer(e,t=!0,i,n){return d(this,null,function*(){this.reset(),this._initEventHandlers();let r=yield xe(e);this._modelUUID=b(r);let o=new Uint8Array(e),a=this._propsStreamer.settings;a.limitTypesTo=ti(this._settings),this._propsProcessor=new z(i);let c=this._propsProcessor.buildIDMap(this._propsStreamer);this._propsStreamer.streamFromBuffer(o),t&&console.info("Started property streaming");let[l,m,p]=yield c;t&&console.info("Read properties"),this._idMap=l,this._typeMap=m,this._settings.includeLBDTriples&&(this._lbdParser=new Ee(this._settings.lbdParserSettings,l,m,n),yield this._lbdParser.init(r,this._settings.filePrefix),t&&console.info("LBD parser initialized")),this._tiler.streamFromBuffer(o),this._settings.includeLBDTriples&&c!==void 0&&(this._propertyWritePromise=this._lbdParser?.processProperties(p)),yield this._allWritingResolved()})}getStats(){return{geometryCount:Object.keys(this._geometries).length,assetsCount:this._assetsCount,tripleCount:this._lbdResults.tripleCount}}getProcessingResult(){return d(this,null,function*(){if(this._idMap===void 0)throw new Error("ID Map is not defined");let e=this._buildMinimalIDMap();return yield this._lbdParser?.writeTriples(),{globalModel:this._globalFile,geometryTiles:this._geometries,idMap:e,globalDataFileId:`${this._settings.filePrefix}${this._modelUUID}-global`,modelUUID:this._modelUUID,lbdTriples:this._lbdParser?.results.triples??""}})}getGeometryDefinition(e=!1){let t=e?this._filterOnlyTangible():this._assets,i={};return t.forEach(n=>{this._typeMap!==void 0&&(i[n.id]=this._typeMap[n.id])}),{assets:t,geometries:this._geometryMap,globalDataFileId:`${this._settings.filePrefix}${this._modelUUID}-global`,idMap:this._assetIDMap,typeMap:i,modelUUID:this._modelUUID}}_buildMinimalIDMap(){let e={};if(this._idMap===void 0)return e;let t=Xe();return Object.keys(this._idMap).forEach(i=>{if(this._typeMap===void 0||this._idMap===void 0)return;let n=this._typeMap[parseInt(i)];t.has(n)&&(e[parseInt(i)]=this._idMap[parseInt(i)])}),e}_filterOnlyTangible(){let e=[C,gt];return this._assets.filter(t=>{if(this._typeMap===void 0)return!0;let i=this._typeMap[t.id];return!e.includes(i)})}_initEventHandlers(){this._tiler.onGeometryStreamed.add(e=>d(this,null,function*(){this._geometryCount+=Object.keys(e.data).length;let t=yield xe(e.buffer),i=b(t);this._settings.includeLBDTriples&&this._lbdParser!==void 0?this._lbdParser.appendGeometryChunk(e.data,e.buffer,i):this._settings.includeLBDTriples&&console.error("LBD Parser is not ready");for(let n of Object.keys(e.data)){let r=e.data[parseInt(n)];r.geometryFile=i,this._geometryMap[parseInt(n)]=r}this._geometries[i]=e.buffer})),this._tiler.onAssetStreamed.add(e=>{this._assetsCount+=e.length,this._manipulateAssetColors(e),this._assets.push(...e),this._appendAssets(e),this._settings.includeLBDTriples&&this._lbdParser!==void 0?this._lbdParser.appendAssetChunk(e):this._settings.includeLBDTriples&&console.error("LBD Parser is not ready")}),this._tiler.onIfcLoaded.add(e=>{this._globalFile=e}),this._ifcLoadPromise=this._ifcLoaded(),this._tiler.onProgress.add(e=>d(this,null,function*(){this._geometryProgress=e*100,console.log(this._geometryProgress)}))}_geometryDonePromise(){return new Promise(e=>{this._tiler.onProgress.add(t=>d(this,null,function*(){t===1&&e()}))})}_ifcLoaded(){return d(this,null,function*(){return new Promise(e=>{this._tiler.onIfcLoaded.add(()=>{e()})})})}_appendAssets(e){if(this._idMap===void 0)throw new Error("ID Map is not defined");for(let t of e){let i=t.id,r=f(i,this._idMap).split("inst:")[1];this._assetIDMap[i]=r}}_allWritingResolved(){return d(this,null,function*(){yield this._geometryDonePromise(),yield this._lbdParser?.finishGeometryProcessing(),yield this._propertyWritePromise,yield this._ifcLoadPromise,console.info("All writing resolved")})}_manipulateAssetColors(e){let{makeSpacesTransparent:t,makeOpeningsInvisible:i}=this._settings.lbdParserSettings.subSettings.geometry;!t&&!i||e.forEach(n=>{if(this._typeMap===void 0)throw new Error("TypeMap is undefined");let r=this._typeMap[n.id];n.geometries.forEach(o=>{t&&r===3856911033&&(o.color=[.3,.3,.3,.5]),i&&r===3588315303&&(o.color=[0,0,0,0])})})}};function rs(s,e,t){return d(this,null,function*(){return new Promise(i=>{let n=[],r={};Object.keys(s.idMap).forEach(o=>{let a=s.idMap[parseInt(o)];if(!e.includes(a))delete s.idMap[parseInt(o)],s.typeMap!==void 0&&delete s.typeMap[parseInt(o)];else{let c=s.assets.find(l=>l.id===parseInt(o));c!==void 0&&(n.push(c),c.geometries.forEach(l=>{t.length?t.includes(l.geometryID)&&(r[l.geometryID]=s.geometries[l.geometryID]):r[l.geometryID]=s.geometries[l.geometryID]}))}}),s.geometries=r,s.assets=n,i()})})}export{de as a,tr as b,Kt as c,ir as d,nr as e,Xt as f,cr as g,ni as h,rs as i};
